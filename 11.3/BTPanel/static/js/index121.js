import{L as e,p as a,x as l,l as t,$ as s,_ as n}from"./utils-lib.js?v=1763689792";import{c as o,aB as i,$ as d,r,o as u,g as m,e as c,ba as v,a9 as p,aJ as b,v as f,a8 as g,I as x,x as y,y as h,z as k,O as w,C as _,D as C,B as V,A as D,G as z,S as j,J as S,F as U,b1 as A,L,P as N,R as K,bP as T,bO as q,V as B,aA as F,bz as H,bA as R,aT as M}from"./base-lib.js?v=1763689792";import{b as P,j as Y,h as I}from"./form-item.js?v=1763689792";import{a as J,c as $,b as G,i as O,e as E,f as W,g as Q,h as X,w as Z,j as ee,$ as ae,k as le,t as te,l as se,s as ne,m as oe,n as ie,q as de,r as re,u as ue,v as me,x as ce,y as ve,z as pe,A as be,B as fe,C as ge,D as xe,E as ye,F as he,G as ke,H as we,I as _e,J as Ce,K as Ve}from"./useMethod3.js?v=1763689792";import{d as De}from"./useMethod2.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./config.js?v=1763689792";import"./validator.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const ze={class:"p-2rem"},je={key:0},Se={key:1,class:"w-[80rem] mb-[1.2rem]"},Ue=["title"],Ae={key:0,class:"text-small text-secondary min-w-[8rem] text-right mr-[2rem]"},Le={class:"flex items-center"},Ne={key:1,class:"text-secondary text-small"},Ke={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},Te={class:"flex items-center"},qe={key:1,class:"text-secondary text-small"},Be={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},Fe={class:"flex items-center"},He={key:1,class:"text-secondary text-small ml-[0.4rem]"},Re={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},Me={class:"flex items-center"},Pe={key:1,class:"text-secondary text-small ml-[0.4rem]"},Ye={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},Ie={class:"flex items-center"},Je={class:"font-bold"},$e={key:2,class:"text-secondary text-small ml-[0.4rem]"},Ge={key:3,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},Oe={key:0,class:"w-full max-h-[96px] overflow-y-auto border-css"},Ee={class:"w-[33.33%] inline-flex items-center px-[0.8rem] border-darker"},We={class:"check-name"},Qe={key:0},Xe={key:1,class:"empty-box"},Ze={class:"flex items-center"},ea={key:1,class:"text-secondary text-small ml-[0.4rem]"},aa={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},la={class:"flex items-center"},ta={key:1,class:"text-secondary text-small ml-[0.4rem]"},sa={key:2,class:"svgtofont-el-loading text-secondary text-small animate-spin ml-[0.4rem]"},na={key:1,class:"w-[80rem] mt-12px flex justify-end flex-col items-end"},oa={class:"list-disc text-secondary"},ia={class:"flex items-center"},da={key:1},ra={key:2,class:"text-dangerDark inline-block !mb-[2rem] !ml-[3rem]"},ua=n(o({__name:"index",props:{data:{default:()=>({})},compData:{default:()=>({})}},setup(n,{expose:o}){const ua=i("confirmBtn"),ma=i("buttonText"),ca=i("popupClose"),va=n,pa=d("siteTableRef"),ba=d("dbTableRef"),fa=r({site:!1,database:!1,wptools:!0,plugin:!0,runtime:!0,Ftp:!0,Crontab:!0,Vmail:!0,Terminal:!0,Firewall:!0,node:!0}),ga=u({site:!1,database:!1}),xa=m(()=>{var e,a,l,t;try{return 1.5*((fa.value.plugin?J.value.reduce((e,a)=>e+Number(a.size),0):0)+(fa.value.database?null==(a=null==(e=ba.value)?void 0:e.tableSelectList)?void 0:a.reduce((e,a)=>e+Number(a.size),0):0)+(fa.value.site?null==(t=null==(l=pa.value)?void 0:l.tableSelectList)?void 0:t.reduce((e,a)=>e+Number(a.size),0):0))}catch(s){return 0}}),{BtForm:ya,submit:ha}=e({data:()=>({name:$(),path:"local",exec_time:""}),options:e=>m(()=>[P("备份名称","name",{attrs:{class:"!w-[600px]",clearable:!0,placeholder:"请输入用户名",rules:[{required:!0,message:"请输入备份名称",trigger:"blur"}]}}),Y("存储位置","path",G.value,{attrs:{class:"!w-[600px]",placeholder:"请选择存储位置",rules:[{required:!0,message:"请选择存储位置",trigger:"change"}]}}),I("执行时间",()=>c(v,{"disabled-date":e=>e.getTime()<Date.now()-864e5,class:"!w-[600px]",modelValue:e.value.exec_time,"onUpdate:modelValue":a=>e.value.exec_time=a,type:"datetime",placeholder:"为空则立即执行",format:"YYYY/MM/DD hh:mm:ss","value-format":"x"},null),"exec_time")]),submit:async(e,l,t)=>{var s,n;const o=p((null==(s=pa.value)?void 0:s.tableSelectList)||[]),i=p((null==(n=ba.value)?void 0:n.tableSelectList)||[]);if(O.value||va.compData.saveConfig||await l(),va.compData&&va.compData.saveConfig)return va.compData.saveConfig(e.value,fa.value,o,i),void ca();return await a({title:"确认"+(O.value?"还原":"备份"),content:O.value?'<span class="text-secondary">还原将覆盖现有数据，是否继续操作？</span><br /><span class="text-dangerDark">在还原数据库备份时，网站将不可访问</span>':'<span class="text-dangerDark text-base">在备份时，对应网站将不可访问，是否继续操作？</span>',type:"calc",isHtml:!0}),ca(),await E(e.value,fa.value,o,i)}});b(()=>{var e,a;W.value?xa.value<Q.current?(ua.disabled=!1,ma.value=(null==(e=va.compData)?void 0:e.saveConfig)?"保存":"备份"):xa.value>=Q.current&&(ua.disabled=!0,0===xa.value&&0===Q.current||(ma.value="磁盘空间不足")):Q.size<Q.current?(ua.disabled=!1,ma.value=O.value?"还原":(null==(a=va.compData)?void 0:a.saveConfig)?"保存":"备份"):Q.size>=Q.current&&(ua.disabled=!0,0===Q.size&&0===Q.current||(ma.value="磁盘空间不足"))});const ka=(e,a)=>{var l,t,s,n;if(fa.value[a]=e,e)switch(a){case"site":null==(l=pa.value)||l.handleAllChange(e),ga.site=!1;break;case"database":null==(t=ba.value)||t.handleAllChange(e),ga.database=!1}else switch(a){case"site":null==(s=pa.value)||s.clearAllSelect(),ga.site=!1;break;case"database":null==(n=ba.value)||n.clearAllSelect(),ga.database=!1}},wa=e=>{var a,l;switch(e){case"site":if(0===Z.value.length)return fa.value.site=!1,void(ga.site=!1);const e=null==(a=pa.value)?void 0:a.tableSelectNumber;e===Z.value.length?(fa.value.site=!0,ga.site=!1):0===e?(fa.value.site=!1,ga.site=!1):(fa.value.site=!1,ga.site=!0);break;case"database":if(0===ee.value.length)return fa.value.database=!1,void(ga.database=!1);const t=null==(l=ba.value)?void 0:l.tableSelectNumber;t===ee.value.length?(fa.value.database=!0,ga.database=!1):0===t?(fa.value.database=!1,ga.database=!1):(fa.value.database=!1,ga.database=!0)}};return f(async()=>{var e,a,l,t;ma.value="正在获取数据中...",ua.disabled=!0,Q.size=0,Q.current=0,await X(va.data||{}),Q.size<Q.current?(ua.disabled=!1,ma.value=O.value?"还原":(null==(e=va.compData)?void 0:e.saveConfig)?"保存":"备份"):(ua.disabled=!0,ma.value=O.value?"还原":(null==(a=va.compData)?void 0:a.saveConfig)?"保存":"备份"),W.value&&(Z.value.length>0&&(fa.value.site=!0,null==(l=pa.value)||l.handleAllChange(!0)),ee.value.length>0&&(fa.value.database=!0,null==(t=ba.value)||t.handleAllChange(!0)))}),g(ae),o({onConfirm:ha,init:async()=>{await X()}}),(e,a)=>{const n=T,o=q,i=B,d=F,r=t,u=H,m=R,v=M,p=s,b=x("bt-loading");return y(),h("div",ze,[k(le)||va.compData.saveConfig?z("",!0):(y(),h("div",je,[k(W)?(y(),w(k(ya),{key:0})):k(O)?(y(),h("div",Se,[c(o,{class:"margin-top table-descriptions",title:"还原详情",column:2,size:"small",border:""},{default:_(()=>[c(n,null,{label:_(()=>[...a[21]||(a[21]=[C(" 名称 ",-1)])]),default:_(()=>[C(V(k(De).backup_name),1)]),_:1}),c(n,null,{label:_(()=>[...a[22]||(a[22]=[C(" 创建时间 ",-1)])]),default:_(()=>[C(V(k(De).create_time),1)]),_:1}),c(n,null,{label:_(()=>[...a[23]||(a[23]=[C(" 备份大小 ",-1)])]),default:_(()=>[C(V(k(l)(Number(k(De).backup_file_size))),1)]),_:1}),c(n,null,{label:_(()=>[...a[24]||(a[24]=[C("存储位置 ",-1)])]),default:_(()=>[C(V(k(De).backup_path),1)]),_:1}),c(n,null,{label:_(()=>[...a[25]||(a[25]=[C("SHA-256 ",-1)])]),default:_(()=>[D("span",{title:k(De).backup_file_sha256},V(k(De).backup_file_sha256),9,Ue)]),_:1})]),_:1})])):z("",!0)])),D("div",{class:L("flex flex-row w-[".concat(k(O)?80:70,"rem]"))},[k(O)||k(le)?z("",!0):(y(),h("span",Ae,"备份数据")),c(m,{modelValue:k(ke),"onUpdate:modelValue":a[17]||(a[17]=e=>K(ke)?ke.value=e:null),class:"flex-1",accordion:""},{default:_(()=>{var e,t,s,n,o,m;return[(null==(e=k(Z))?void 0:e.length)||k(W)?(y(),w(u,{key:0,name:"site"},{title:_(()=>{var e;return[D("div",Le,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).site,"onUpdate:modelValue":a[0]||(a[0]=e=>k(fa).site=e),class:"!mr-[0.4rem]",indeterminate:k(ga).site,disabled:k(te).site,onChange:a[1]||(a[1]=e=>ka(e,"site")),onClick:a[2]||(a[2]=j(()=>{},["stop"]))},null,8,["modelValue","indeterminate","disabled"])):z("",!0),a[27]||(a[27]=D("i",{class:"svgtofont-left-home desc-i"},null,-1)),a[28]||(a[28]=D("span",{class:"font-bold"},"网站",-1)),c(d,{trigger:"hover",placement:"top-start",width:"400",content:"备份网站是会自动备份Nginx配置，SSL证书，PHP配置，重定向和反向代理等除插件外与该网站相关的配置"},{reference:_(()=>[...a[26]||(a[26]=[D("i",{class:"svgtofont-el-question-filled text-warning text-base mx-[0.4rem]"},null,-1)])]),_:1}),k(te).site?(y(),h("i",Ke)):(y(),h("span",Ne,"(共"+V((null==(e=k(Z))?void 0:e.length)||0)+"个，共"+V(k(se))+")",1))])]}),default:_(()=>[S(c(r,{ref_key:"siteTableRef",ref:pa,column:k(ne),data:k(Z),"max-height":200,onSelectionChange:a[3]||(a[3]=e=>wa("site"))},null,8,["column","data"]),[[b,k(te).site],[b,"正在获取网站中，请稍后...","title"]])]),_:1})):z("",!0),(null==(t=k(ee))?void 0:t.length)||!k(O)?(y(),w(u,{key:1,name:"database"},{title:_(()=>{var e;return[D("div",Te,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).database,"onUpdate:modelValue":a[4]||(a[4]=e=>k(fa).database=e),class:"!mr-[0.4rem]",disabled:k(te).database,indeterminate:k(ga).database,onChange:a[5]||(a[5]=e=>ka(e,"database")),onClick:a[6]||(a[6]=j(()=>{},["stop"]))},null,8,["modelValue","disabled","indeterminate"])):z("",!0),a[29]||(a[29]=D("i",{class:"svgtofont-left-database desc-i"},null,-1)),a[30]||(a[30]=D("span",{class:"font-bold"},"数据库",-1)),k(te).database?(y(),h("i",Be)):(y(),h("span",qe,"(共"+V((null==(e=k(ee))?void 0:e.length)||0)+"个，共"+V(k(oe))+")",1))])]}),default:_(()=>[S(c(r,{ref_key:"dbTableRef",ref:ba,column:k(ie),data:k(ee),"max-height":200,onSelectionChange:a[7]||(a[7]=e=>wa("database"))},null,8,["column","data"]),[[b,k(te).database],[b,"正在获取数据库中，请稍后...","title"]])]),_:1})):z("",!0),!(null==(s=k(de))?void 0:s.length)&&k(O)||k(le)?z("",!0):(y(),w(u,{key:2,name:"wptools"},{title:_(()=>{var e;return[D("div",Fe,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).wptools,"onUpdate:modelValue":a[8]||(a[8]=e=>k(fa).wptools=e),class:"!mr-[0.4rem]",disabled:k(te).wptools,onClick:a[9]||(a[9]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):z("",!0),a[31]||(a[31]=D("i",{class:"svgtofont-left-wp desc-i"},null,-1)),a[32]||(a[32]=D("span",{class:"font-bold"},"Wp Tools",-1)),k(te).wptools?(y(),h("i",Re)):(y(),h("span",He,"(共"+V((null==(e=k(de))?void 0:e.length)||0)+"个，共"+V(k(re))+")",1))])]}),default:_(()=>[S(c(r,{column:k(ue),data:k(de),"max-height":150},null,8,["column","data"]),[[b,k(te).wptools],[b,"正在获取网站中，请稍后...","title"]])]),_:1})),(null==(n=k(me))?void 0:n.length)||!k(O)?(y(),w(u,{key:3,name:"node"},{title:_(()=>{var e;return[D("div",Me,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).node,"onUpdate:modelValue":a[10]||(a[10]=e=>k(fa).node=e),class:"!mr-[0.4rem]",disabled:k(te).node,onClick:a[11]||(a[11]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):z("",!0),a[33]||(a[33]=D("i",{class:"svgtofont-left-node desc-i"},null,-1)),a[34]||(a[34]=D("span",{class:"font-bold"},"多机节点",-1)),k(te).node?(y(),h("i",Ye)):(y(),h("span",Pe,"(共"+V((null==(e=k(me))?void 0:e.length)||0)+"个)",1))])]}),default:_(()=>[S(c(r,{column:k(ce),data:k(me),"max-height":150},null,8,["column","data"]),[[b,k(te).node],[b,"正在获取多机节点中，请稍后...","title"]])]),_:1})):z("",!0),(y(!0),h(U,null,A(k(ve),(e,t)=>{var s;return y(),h(U,{key:t},[(null==(s=k(pe)[e.dataKey])?void 0:s.length)||!k(O)?(y(),w(u,{key:0,name:t.toLowerCase()},{title:_(()=>{var l;return[D("div",Ie,[k(W)?(y(),w(i,{key:0,modelValue:k(fa)[t],"onUpdate:modelValue":e=>k(fa)[t]=e,class:"!mr-[0.4rem]",disabled:k(te)[e.loadingKey.toLowerCase()],onClick:a[12]||(a[12]=j(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","disabled"])):z("",!0),D("i",{class:L("svgtofont-left-".concat(e.icon," desc-i"))},null,2),D("span",Je,V(e.title),1),e.tooltip?(y(),w(d,{key:1,trigger:"hover",placement:"top-start",width:"400",content:e.tooltip},{reference:_(()=>[...a[35]||(a[35]=[D("i",{class:"svgtofont-el-question-filled text-warning text-base ml-[0.4rem]"},null,-1)])]),_:1},8,["content"])):z("",!0),k(te)[e.loadingKey.toLowerCase()]?(y(),h("i",Ge)):(y(),h("span",$e,"(共"+V((null==(l=k(pe)[e.dataKey])?void 0:l.length)||0)+"个"+V(e.count?"，共"+k(be)(e.dataKey):"")+")",1)),e.extraComponent?(y(),w(N(e.extraComponent),{key:4})):z("",!0)])]}),default:_(()=>{var a;return[S((y(),h("div",null,[(null==(a=k(pe)[e.dataKey])?void 0:a.length)||k(W)?(y(),h("div",Oe,[(y(!0),h(U,null,A(k(pe)[e.dataKey],(a,t)=>(y(),h(U,{key:t},[D("span",Ee,[D("span",We,V(a.name)+V(a.size?"(".concat(k(l)(Number(a.size)),")"):"")+" "+V(a.total?"(".concat(a.total,"条)"):""),1)]),t+1!==0&&(t+1)%3==0&&t+1!==k(pe)[e.dataKey].length?(y(),h("hr",Qe)):z("",!0)],64))),128))])):(y(),h("div",Xe,"暂无数据"))])),[[b,k(te)[e.loadingKey.toLowerCase()]],[b,"正在获取".concat(e.title,"中，请稍后..."),"title"]])]}),_:2},1032,["name"])):z("",!0)],64)}),128)),(null==(o=k(J))?void 0:o.length)||!k(O)?(y(),w(u,{key:4,name:"plugin"},{title:_(()=>{var e;return[D("div",Ze,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).plugin,"onUpdate:modelValue":a[13]||(a[13]=e=>k(fa).plugin=e),class:"!mr-[0.4rem]",disabled:k(te).plugin,onClick:a[14]||(a[14]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):z("",!0),a[36]||(a[36]=D("i",{class:"svgtofont-left-soft desc-i"},null,-1)),a[37]||(a[37]=D("span",{class:"font-bold"},"插件",-1)),k(te).plugin?(y(),h("i",aa)):(y(),h("span",ea,"(共"+V((null==(e=k(J))?void 0:e.length)||0)+"个,共"+V(k(fe))+")",1))])]}),default:_(()=>[S(c(r,{column:k(ge),data:k(J),"max-height":160},null,8,["column","data"]),[[b,k(te).plugin],[b,"正在获取插件中，请稍后...","title"]])]),_:1})):z("",!0),(null==(m=k(xe))?void 0:m.length)||!k(O)?(y(),w(u,{key:5,name:"runtime"},{title:_(()=>{var e;return[D("div",la,[k(W)?(y(),w(i,{key:0,modelValue:k(fa).runtime,"onUpdate:modelValue":a[15]||(a[15]=e=>k(fa).runtime=e),class:"!mr-[0.4rem]",disabled:k(te).runtime,onClick:a[16]||(a[16]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):z("",!0),a[38]||(a[38]=D("i",{class:"svgtofont-el-monitor desc-i"},null,-1)),a[39]||(a[39]=D("span",{class:"font-bold"},"运行环境",-1)),k(te).runtime?(y(),h("i",sa)):(y(),h("span",ta,"(共"+V((null==(e=k(xe))?void 0:e.length)||0)+"个，共"+V(k(ye))+")",1))])]}),default:_(()=>[S(c(r,{column:k(he),data:k(xe),"max-height":160},null,8,["column","data"]),[[b,k(te).runtime],[b,"正在获取运行环境中，请稍后...","title"]])]),_:1})):z("",!0)]}),_:1},8,["modelValue"])],2),k(le)?z("",!0):(y(),h("div",na,[c(i,{modelValue:k(we),"onUpdate:modelValue":a[18]||(a[18]=e=>K(we)?we.value=e:null),class:"!mr-0"},{default:_(()=>[...a[40]||(a[40]=[C("出现失败后自动停止操作",-1)])]),_:1},8,["modelValue"]),k(O)?(y(),w(i,{key:0,modelValue:k(_e),"onUpdate:modelValue":a[19]||(a[19]=e=>K(_e)?_e.value=e:null)},{default:_(()=>[...a[41]||(a[41]=[C("存在同名时是否覆盖还原",-1)])]),_:1},8,["modelValue"])):z("",!0)])),D("div",{class:L(["flex items-center",{"mt-[2rem]":k(O),"ml-[3rem]":!0}])},[D("ul",oa,[k(le)?z("",!0):(y(),h("li",{key:0,class:L({"text-dangerDark":k(Q).size>=k(Q).current})},[D("div",ia,[c(v,{class:"item",effect:"dark",placement:"top-start"},{content:_(()=>[C(" 推断所需迁移空间:"+V(k(l)(Number(k(W)?k(xa):k(Q).size)))+" ",1),a[42]||(a[42]=D("br",null,null,-1)),a[43]||(a[43]=C(" 说明:因数据备份需要复制后压缩，会比实际占用更多的空间，因此推断大小为迁移数据大小的1.5倍 ",-1))]),default:_(()=>[a[44]||(a[44]=D("i",{class:"svgtofont-el-warning-filled text-warning text-base mr-[0.4rem]"},null,-1))]),_:1}),C(" 预计需要空间："+V(k(l)(Number(k(W)?k(xa):k(Q).size)))+" 当前磁盘剩余空间:"+V(k(l)(Number(k(Q).current))),1)])],2)),k(le)?(y(),h("li",da,"wp tools站点将在网站中显示")):z("",!0)]),k(le)?z("",!0):(y(),h("i",{key:0,class:L(["mt-2px ml-4px cursor-pointer",{"animate-spin cursor-not-allowed svgtofont-el-loading text-secondary":k(Ce),"svgtofont-el-refresh text-primary":!k(Ce)}]),onClick:a[20]||(a[20]=e=>k(Ve)(k(ua)))},null,2))],2),k(O)?(y(),h("p",ra,"提示：若遇到还原失败会自动恢复到还原前")):z("",!0),k(W)&&!va.compData.saveConfig?(y(),w(p,{key:3,options:[{content:"出现备份失败后自动停止备份,节点管理仅备份面板节点配置信息，备份wp_tools请在网站勾选wp站点"}],class:"ml-[3rem]"})):z("",!0)])}}}),[["__scopeId","data-v-795a4aed"]]);export{ua as default};
