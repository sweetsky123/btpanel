import{M as e,Q as t,aK as a,k as s,$ as l}from"./utils-lib.js?v=1763689792";import{r,g as u,o,w as n,c as i,v as p,I as d,J as m,z as c,x as f,y as _,e as g,C as v,D as j,O as x,G as h,ad as y,V as b,H as V,ab as w}from"./base-lib.js?v=1763689792";import{batchPhpReferer as R,setProxyAntiLeech as C,setSecurity as U,getSecurity as E}from"./site.js?v=1763689792";import{o as L}from"./useController6.js?v=1763689792";import{u as k}from"./useStore4.js?v=1763689792";import{h as H,i as D}from"./validator.js?v=1763689792";import{p as P}from"./useController16.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const{siteInfo:T,isRefreshList:q}=k(),F=r(),S=u(()=>{var e,t,a;return Array.isArray(null==(e=F.value)?void 0:e.selectedList)&&(null==(a=null==(t=F.value)?void 0:t.selectedList)?void 0:a.length)>0}),z=r(!1),A=o({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),I=r(null),G=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],J=t=>{if(!A.status)return e.error("请先启用防盗链!")},K=e=>{A.status=e,e||(A.http_status=!1)},M=async e=>{var a;await I.value.validate();let s={...A,domains:null==(a=A.domains)?void 0:a.replace(/\n/g,",")};if(S.value){const{enable:e,exclude:t}=F.value.config,a=H(F.value.selectedList,t,e,{params:{project_type:"PHP"}});s={...s,...a}}else s.id=T.value.id,s.site_name=T.value.name;const l=S.value?R:"proxy"===T.value.project_type?C:U,r=await t({loading:"正在设置防盗链，请稍后...",request:l({...s,..."proxy"===T.value.project_type?{proxy_path:P.value.proxy_path}:{}}),message:!S.value});if(S.value){const{data:t}=D(r.data);L({resultData:t,title:"批量设置防盗链"}),q.value=!0,Q(),e&&e()}else O(F.value)},O=async e=>{var t,s;if(F.value=e||[],S.value&&Q(),"proxy"!==T.value.project_type){if(!e){const{id:e,name:r}=T.value;try{z.value=!0;const{data:a}=await E({id:e,site_name:r});a&&(A.fix=a.fix||"jpg,jpeg,gif,png,js,css",A.domains=(null==(s=null==(t=a.domains)?void 0:t.toString())?void 0:s.replace(/,/g,"\n"))||"",A.return_rule=a.return_rule||"404",A.http_status=a.http_status||!1,A.status=a.status||!1)}catch(l){a(l)}finally{z.value=!1}}}else n(()=>P.value.security_referer,e=>{var t,a;A.fix=e.fix||"jpg,jpeg,gif,png,js,css",A.domains=(null==(a=null==(t=e.domains)?void 0:t.toString())?void 0:a.replace(/,/g,"\n"))||"",A.return_rule=e.return_rule||"404",A.http_status=e.http_status||!1,A.status=e.status||!1})},Q=()=>{A.fix="jpg,jpeg,gif,png,js,css",A.domains="",A.return_rule="404",A.http_status=!1,A.status=!1},$={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},B={class:"p-[20px]"},N=i({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:t,emit:a}){const r=e,u=()=>{O(r.compData)};return p(u),t({onConfirm:M,init:u}),(e,t)=>{const a=s,r=y,u=b,o=V,n=w,i=l,p=d("bt-loading");return m((f(),_("div",B,[g(n,{ref_key:"hotFormRef",ref:I,model:c(A),rules:c($)},{default:v(()=>[g(r,{label:"URL后缀",prop:"fix"},{default:v(()=>[g(a,{modelValue:c(A).fix,"onUpdate:modelValue":t[0]||(t[0]=e=>c(A).fix=e),width:"30rem"},null,8,["modelValue"])]),_:1}),g(r,{label:"许可域名"},{default:v(()=>[g(a,{width:"30rem",modelValue:c(A).domains,"onUpdate:modelValue":t[1]||(t[1]=e=>c(A).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])]),_:1}),g(r,{label:"响应资源",prop:"return_rule"},{default:v(()=>[g(a,{width:"30rem",modelValue:c(A).return_rule,"onUpdate:modelValue":t[2]||(t[2]=e=>c(A).return_rule=e)},null,8,["modelValue"])]),_:1}),g(r,{label:" "},{default:v(()=>[g(u,{modelValue:c(A).status,"onUpdate:modelValue":t[3]||(t[3]=e=>c(A).status=e),onChange:c(K)},{default:v(()=>[...t[6]||(t[6]=[j("启用防盗链",-1)])]),_:1},8,["modelValue","onChange"]),g(u,{disabled:!c(A).status,title:"".concat(c(A).status?"":"需开启防盗链"),modelValue:c(A).http_status,"onUpdate:modelValue":t[4]||(t[4]=e=>c(A).http_status=e),onChange:c(J)},{default:v(()=>[...t[7]||(t[7]=[j(" 允许空HTTP_REFERER请求 ",-1)])]),_:1},8,["disabled","title","modelValue","onChange"])]),_:1}),c(S)?h("",!0):(f(),x(r,{key:0,label:" "},{default:v(()=>[g(o,{type:"primary",onClick:t[5]||(t[5]=e=>c(M)())},{default:v(()=>[...t[8]||(t[8]=[j("保存",-1)])]),_:1})]),_:1}))]),_:1},8,["model","rules"]),c(S)?h("",!0):(f(),x(i,{key:0,options:c(G),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[p,c(z)]])}}});export{N as default};
