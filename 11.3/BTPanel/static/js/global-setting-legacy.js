!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function u(n,a,l,o){var u=a&&a.prototype instanceof c?a:c,s=Object.create(u.prototype);return r(s,"_invoke",function(n,r,a){var l,o,u,c=0,s=a||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return l=t,o=0,u=e,d.n=n,i}};function p(n,r){for(o=n,u=r,t=0;!f&&c&&!a&&t<s.length;t++){var a,l=s[t],p=d.p,g=l[2];n>3?(a=g===r)&&(u=l[(o=l[4])?5:(o=3,3)],l[4]=l[5]=e):l[0]<=p&&((a=n<2&&p<l[1])?(o=0,d.v=r,d.n=l[1]):p<g&&(a=n<3||l[0]>r||r>g)&&(l[4]=n,l[5]=r,d.n=g,o=0))}if(a||n>1)return i;throw f=!0,r}return function(a,s,g){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,g),o=s,u=g;(t=o<2?e:u)||!f;){l||(o?o<3?(o>1&&(d.n=-1),p(o,u)):d.n=u:d.v=u);try{if(c=2,l){if(o||(a="next"),t=l[a]){if(!(t=t.call(l,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,o<2&&(o=0)}else 1===o&&(t=l.return)&&t.call(l),o<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),o=1);l=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==i)break}catch(t){l=e,o=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,l,o),!0),s}var i={};function c(){}function s(){}function f(){}t=Object.getPrototypeOf;var d=[][l]?t(t([][l]())):(r(t={},l,function(){return this}),t),p=f.prototype=c.prototype=Object.create(d);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=f,r(p,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,o,"GeneratorFunction"),r(p),r(p,o,"Generator"),r(p,l,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:u,m:g}})()}function r(e,t,n,a){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}r=function(e,t,n,a){function o(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?l?l(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},r(e,t,n,a)}function a(e,t,n,r,a,l,o){try{var u=e[l](o),i=u.value}catch(e){return void n(e)}u.done?t(i):Promise.resolve(i).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,l){var o=e.apply(t,n);function u(e){a(o,r,l,u,i,"next",e)}function i(e){a(o,r,l,u,i,"throw",e)}u(void 0)})}}System.register(["./base-lib-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792","./validator-legacy.js?v=1763689792","./useController-legacy6.js?v=1763689792","./site-legacy.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./column-legacy.js?v=1763689792","./useStore-legacy4.js?v=1763689792"],function(t,r){"use strict";var a,o,u,i,c,s,f,d,p,g,m,_,v,h,y,b,w,x,C,P,I,j,F,S,V,k,T,O,A,X,G,U,R,q,E,H,D,K,L,W;return{setters:[function(e){a=e.c,o=e.r,u=e.o,i=e.aE,c=e.v,s=e.I,f=e.J,d=e.z,p=e.x,g=e.y,m=e.A,_=e.e,v=e.C,h=e.D,y=e.F,b=e.K,w=e.G,x=e.ap,C=e.ad,P=e.H,I=e.ab,j=e.b2,F=e.c5},function(e){S=e.u,V=e.p,k=e.Q,T=e.$,O=e.aK,A=e.b,X=e._},function(e){G=e._},function(e){U=e.f},function(e){R=e.o},function(e){q=e.getGloalSetting,E=e.setSitesLogStatus,H=e.openCdnIp,D=e.setFreeTotalStatus,K=e.getCdnIp,L=e.getFreeTotalStatus,W=e.setSitesLogPath},null,null,null,null],execute:function(){var r={class:"flex flex-col site-globa-setting-module"},$={class:"flex items-center"},z={class:"flex items-center"},B={class:"flex items-center"},J={class:"flex items-center"},M={class:"flex items-center"},N={class:"flex items-center"},Q={class:"flex items-center"},Y=a({__name:"global-setting",setup:function(t){var a=A(),X=S().plugin.value.webserver,Y=o(!1),Z=o(),ee=u({log_split:!1,log_path:""}),te=u({page_index:!1,page_404:!1}),ne=u({total_flow:!1}),re=u({cdn_ip:"",header:""}),ae="",le=u({log_path:[{required:!0,message:"请选择日志路径",trigger:"change"}]}),oe=o([{label:"名称",prop:"site_name"},{label:"结果",render:function(e){return i("span",{class:e.status?"text-primary":"text-danger"},e.status?"操作成功":"操作失败")}}]),ue=[{value:"X-Forwarded-For",label:"X-Forwarded-For"},{value:"X-Real-IP",label:"X-Real-IP"},{value:"X-Forwarded",label:"X-Forwarded"},{value:"Forwarded-For",label:"Forwarded-For"},{value:"Forwarded",label:"Forwarded"},{value:"True-Client-IP",label:"True-Client-IP"},{value:"Client-IP",label:"Client-IP"},{value:"Ali-Cdn-Real-IP",label:"Ali-Cdn-Real-IP"},{value:"Cdn-Src-IP",label:"Cdn-Src-IP"},{value:"Cdn-Real-IP",label:"Cdn-Real-IP"},{value:"Cf-Connecting-IP",label:"Cf-Connecting-IP"},{value:"X-Cluster-Client-IP",label:"X-Cluster-Client-IP"},{value:"Wl-Proxy-Client-IP",label:"Wl-Proxy-Client-IP"},{value:"Proxy-Client-IP",label:"Proxy-Client-IP"}],ie=function(e,t){t(ue)},ce=function(){var e=l(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return Y.value=!0,e.p=1,e.n=2,q();case 2:t=e.v,r=t.data,ee.log_path=r.log_path,ee.log_split=r.log_split,te.page_index=r.page_index,te.page_404=r.page_404,re.cdn_ip=r.cdn_ip,e.n=4;break;case 3:e.p=3,e.v;case 4:return e.p=4,Y.value=!1,e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(){return e.apply(this,arguments)}}(),se=function(){var e=l(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Z.value.validate();case 1:return e.n=2,V({title:"修改日志路径",content:"是否修改日志预设路径,继续执行?",type:"check",icon:"warning-filled",check:{content:"更改已有网站日志",value:!0,onConfirm:function(){var e=l(n().m(function e(t){var r,l;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,W({mv_log:"1",change_sites:t?"1":"0",log_path:ee.log_path});case 1:r=e.v,t?R({resultColumn:oe.value,resultData:r.data,resultTitle:"修改日志路径",title:"修改日志路径结果"}):a.request(r),e.n=3;break;case 2:e.p=2,l=e.v,O(l);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()}});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),fe=function(){U({type:"dir",path:ee.log_path,change:function(e){ee.log_path=e}})},de=function(){var e=l(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:k({loading:"正在设置，请稍后...",request:E({log_split:ee.log_split,page_index:te.page_index,page_404:te.page_404}),message:!0});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=l(n().m(function e(t){return n().w(function(e){for(;;)switch(e.n){case 0:k({loading:"正在设置，请稍后...",request:H({cdn_ip:t,header_cdn:re.header}),message:!0,success:ce});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=l(n().m(function e(){return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,ne.total_flow){e.n=1;break}return e.n=1,V({title:"关闭日流量统计",content:"关闭全局日流量统计后,网站的单独设置将失效,是否继续执行?"});case 1:k({loading:"正在设置，请稍后...",message:!0,request:D({site_id:"global",status:ne.total_flow?1:0}),success:function(e){e.status||(ne.total_flow=!ne.total_flow)}}),e.n=3;break;case 2:e.p=2,e.v,ne.total_flow=!ne.total_flow;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),me=function(){var e=l(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,K();case 1:t=e.v,r=t.data,re.header=r.header_cdn||"X-Forwarded-For";case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),_e=function(){ae=re.header,re.header=""},ve=function(){""===re.header&&(re.header=ae)},he=function(){var e=l(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,L({site_id:"global"});case 1:t=e.v,r=t.data,ne.total_flow=r.data.status;case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return c(function(){ce(),me(),he()}),function(t,n){var a=x,l=C,o=G,u=P,i=I,c=j,S=T,V=F,k=s("bt-loading");return f((p(),g("div",r,[m("div",null,[_(i,{ref_key:"globalSettingRef",ref:Z,model:d(ee),rules:d(le)},{default:v(function(){return[_(l,{label:"日志切割"},{default:v(function(){return[m("div",$,[_(a,{onChange:de,modelValue:d(ee).log_split,"onUpdate:modelValue":n[0]||(n[0]=function(e){return d(ee).log_split=e})},null,8,["modelValue"]),n[8]||(n[8]=m("span",{class:"text-tertiary ml-[4px]"},"*提示：开启该选项将自动创建网站日志切割任务，当存在所有网站日志切割任务时不会新建",-1))])]}),_:1}),_(l,{label:"预设日志路径",prop:"log_path"},{default:v(function(){return[m("div",z,[_(o,{modelValue:d(ee).log_path,"onUpdate:modelValue":n[1]||(n[1]=function(e){return d(ee).log_path=e}),icon:"icon-file_mode",onIconClick:fe},null,8,["modelValue"]),_(u,{type:"primary",class:"!ml-1rem",onClick:se},{default:v(function(){return e(n[9]||(n[9]=[h("保存",-1)]))}),_:1})])]}),_:1})]}),_:1},8,["model","rules"])]),_(c),_(i,{model:d(te)},{default:v(function(){return[_(l,{label:"默认页面设置"},{default:v(function(){return[m("div",B,[_(a,{onChange:de,modelValue:d(te).page_index,"onUpdate:modelValue":n[2]||(n[2]=function(e){return d(te).page_index=e})},null,8,["modelValue"]),n[10]||(n[10]=m("span",{class:"ml-[4px] mb-[2px]"},"自动生成index.html(默认首页)",-1))])]}),_:1}),_(l,{label:" "},{default:v(function(){return[m("div",J,[_(a,{onChange:de,modelValue:d(te).page_404,"onUpdate:modelValue":n[3]||(n[3]=function(e){return d(te).page_404=e})},null,8,["modelValue"]),n[11]||(n[11]=m("span",{class:"ml-[4px] mb-[2px]"},"自动生成404.html(默认404页面)",-1))])]}),_:1})]}),_:1},8,["model"]),_(S,{options:[{content:"请注意，仅对后续创建的PHP网站生效。"}],class:"ml-[20px] mt-[20px]"}),_(c),_(i,{model:d(ne)},{default:v(function(){return[_(l,{label:"网站统计"},{default:v(function(){return[m("div",M,[_(a,{onChange:ge,modelValue:d(ne).total_flow,"onUpdate:modelValue":n[4]||(n[4]=function(e){return d(ne).total_flow=e})},null,8,["modelValue"]),n[12]||(n[12]=m("span",{class:"text-tertiary ml-[4px]"},"*提示：开启会适量占用服务器内存，如需针对某个网站单独开关请到 网站设置->其它设置 中调整。",-1))])]}),_:1})]}),_:1},8,["model"]),_(S,{options:[{content:"注意，关闭后网站的单独设置将失效。"},{content:"不影响监控报表插件的配置。"}],class:"ml-[20px] mt-[20px]"}),"nginx"===d(X)?(p(),g(y,{key:0},[_(c),_(i,{model:d(re)},{default:v(function(){return[_(l,{label:"cdn来源IP解析"},{default:v(function(){return[m("div",N,[_(a,{onChange:pe,modelValue:d(re).cdn_ip,"onUpdate:modelValue":n[5]||(n[5]=function(e){return d(re).cdn_ip=e})},null,8,["modelValue"]),n[13]||(n[13]=m("span",{class:"ml-[4px] mb-[2px]"},[h(" * 请确保使用 "),m("span",{class:"text-danger"},"安全可靠"),h(" 的cdn ")],-1))])]}),_:1}),f(_(l,{label:"来源的请求头"},{default:v(function(){return[m("div",Q,[_(V,{modelValue:d(re).header,"onUpdate:modelValue":n[6]||(n[6]=function(e){return d(re).header=e}),"fetch-suggestions":ie,placeholder:"请选择或输入来源的请求头",onFocus:_e,onBlur:ve},{suffix:v(function(){return e(n[14]||(n[14]=[m("span",{class:"svgtofont-el-arrow-down"},null,-1)]))}),_:1},8,["modelValue"]),_(u,{type:"primary",class:"!ml-1rem",onClick:n[7]||(n[7]=function(e){return pe(d(re).cdn_ip)})},{default:v(function(){return e(n[15]||(n[15]=[h("保存",-1)]))}),_:1})])]}),_:1},512),[[b,d(re).cdn_ip]])]}),_:1},8,["model"])],64)):w("",!0)])),[[k,d(Y)]])}}});t("default",X(Y,[["__scopeId","data-v-ce5033ca"]]))}}})}();
