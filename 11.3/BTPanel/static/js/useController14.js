import{Q as t,aK as a,M as e,u as s,n as r,H as n,aS as o,p as l}from"./utils-lib.js?v=1763689792";import{j as i,r as c,s as u,e as p,D as m,F as y,n as d,o as _}from"./base-lib.js?v=1763689792";import{l as h,f as g}from"./validator.js?v=1763689792";import{u as w,S as v}from"./useStore4.js?v=1763689792";import{delProxyProject as x,batchDelNginx as f,addProxyProject as E,proxyTcpAction as b,getProxyConfigFile as S}from"./site.js?v=1763689792";import{o as T}from"./useController6.js?v=1763689792";const k=i("SITE-PROXY-STORE",()=>{const{isRefreshList:s}=w();return{proxyType:c("http"),deleteProxySiteEvent:async(a,e)=>{try{let r={remove_path:e?1:0,id:a.id,site_name:a.name};const n=await t({loading:"正在删除反向代理项目，请稍候...",request:x(r),message:!0});return s.value=!0,{status:n.status,msg:n.msg}}catch(r){return{status:!1,msg:"删除项目失败"}}},multDeleteProxySiteEvent:async a=>{try{const e=await t({loading:"正在删除反向代理项目，请稍候...",request:f(a),message:!1});return s.value=!0,{status:e.status,msg:e.msg,data:e.data.data.map(t=>({...t,name:t.site_name}))}}catch(e){return{status:!1,msg:"删除项目失败",data:[]}}},addProxySiteEvent:async t=>{try{return{...await E(t)}}catch(e){a(e)}},addProxyTcpEvent:async t=>{try{return{...await b(t)}}catch(e){a(e)}},getConfigEvent:async t=>{try{const{data:a}=await S(t);return a.status||e.error(a.msg),{data:a.data,status:a.status}}catch(a){return{msg:"获取配置失败",status:!1}}}}},{persist:[{storage:localStorage,paths:["proxyType"]}]}),{plugin:C}=s(),{isRefreshList:L}=w(),{setSiteInfo:N}=v(),{deleteProxySiteEvent:P,multDeleteProxySiteEvent:j,addProxySiteEvent:R,addProxyTcpEvent:I,getConfigEvent:D}=k(),{proxyType:U}=u(k()),A=()=>{r({title:"添加反向代理项目",area:62,component:()=>n(()=>import("./index376.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},q=(t,a="")=>{N(t,a),r({title:"反向代理项目管理["+t.name+"] -- 添加时间["+t.addtime+"]",area:[84,70],component:()=>n(()=>import("./index377.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},O=async(t,a)=>{var e,s;"monitor"===a&&o("total_website",t.name);const r="nginx"===(null==(s=null==(e=C.value)?void 0:e.web)?void 0:s.type)?"btwaf":"btwaf_httpd";await h({name:"total"===a?"total":"monitor"===a?"monitor":r,callback:e=>{if("monitor"!==a&&e&&!["total","monitor"].includes(a)&&"btwaf"===r){const a=setInterval(()=>{var s;const r=e.document.getElementsByClassName("layui-layer-page")[0];if(e.site_waf_config&&r){clearInterval(a),r&&(r.style.display="none"),e.site_waf_config(t.name);const n=e.document.getElementsByClassName("layui-layer-page")[1];n&&(null==(s=n.querySelector(".layui-layer-close"))||s.addEventListener("click",()=>{var t;null==(t=r.querySelector(".layui-layer-close"))||t.click()}))}},50)}}})},H=async t=>{await l({title:"".concat("删除反向代理项目【".concat(t.name,"】")),content:"".concat("风险操作，此操作不可逆，删除【".concat(t.name,"】项目后您将无法管理该项目，是否继续操作？")),type:"check",check:{content:"同时删除网站根目录",onConfirm:async a=>await P(t,a)}})},M=async(t,a)=>{await l({title:"批量删除反向代理项目",content:"批量删除选中的项目后，项目将无法恢复，是否继续操作？",type:"check",check:{content:"同时删除网站根目录",onConfirm:async e=>{let s={remove_path:e?1:0,site_list:JSON.stringify(t.map(t=>({id:t.id,site_name:t.name})))};const{data:r}=await j(s);T({resultData:r,resultTitle:"批量删除反向代理项目"}),a()}}})},V=[{content:"目标：可以填写你需要代理的站点，目标如果选URL地址则必须为可正常访问的URL，如果选UNIX则必须是套接字文件"},{content:"http地址示例：http://127.0.0.1:15700"},{content:"unix地址示例：/tmp/panel.sock"},{content:()=>p(y,null,[m("发送域名：将域名添加到请求头传递到后端服务器，默认为目标URL域名，若设置不当可能导致代理无法正常访问，例如："),p("br",null,null),m("http://192.168.100.20:19888，则发送域名保持$http_host即可"),p("br",null,null),m("http://www.bt.cn，则发送域名应当改为www.bt.cn"),p("br",null,null),m("上面例子仅为常见情况，请以实际为准")])}],B=[{value:"url",label:"URL地址"},{value:"unix",label:"unix地址"}],F=c(!1),X=async(t,a,s)=>{let r;try{await a();const{ps:s,listen_port:n,protocol:o,proxy_pass:l,isEdit:i}=t.value,c={ps:s,listen_port:n,protocol:o,proxy_pass:l,handle:i?"update":"create"};r=e.load("正在"+(i?"编辑":"添加")+"项目，请稍后...");const u=await I(c);return e.msg({dangerouslyUseHTMLString:!0,message:u.msg,type:u.status?"success":"error",duration:u.status?2e3:0,showClose:!u.status,customClass:"!max-w-[66rem] bt-message-error-html"}),u.status&&(F.value=!0),u.status}catch(n){return!1}finally{null==r||r.close()}},J=async a=>{try{const e=await t({request:b({handle:"list"}),data:{data:Array}});return Array.isArray(e.data)?{data:e.data.map(t=>{const[a,e]=t.listen_port.split(" ");return{...t,listen_port:a,protocol:e||"tcp"}}).filter(t=>!a.search||t.listen_port.toString().includes(a.search)).sort((t,a)=>{try{const e=parseInt(t.id),s=parseInt(a.id);return isNaN(e)&&isNaN(s)?0:isNaN(e)?1:isNaN(s)?-1:s-e}catch(e){return 0}}),total:e.data.length}:{data:[],total:0}}catch(e){return{data:[],total:0}}},K=async(a,e)=>{await l({title:"删除代理【".concat(a.listen_port,"】"),width:"35rem",icon:"warning-filled",content:"您真的要删除代理【".concat(a.listen_port,"】吗？")});(await t({loading:"正在删除，请稍后...",request:b({handle:"delete",protocol:a.protocol,listen_port:a.listen_port,proxy_pass:a.proxy_pass}),message:!0})).status&&e()},Q=t=>{r({isAsync:!0,title:"".concat(t.protocol.toUpperCase(),"代理设置【").concat(t.listen_port,"】"),area:[76,60],component:()=>n(()=>import("./setting2.js?v=1763689792").then(t=>t.s),__vite__mapDeps([]),import.meta.url),compData:{row:t}})},Y=async(t,a,s)=>{let r;try{await a();const{remark:s,targetType:n,proxysite:o,domains:l,todomain:i}=t.value,c={remark:s,proxy_type:"url"===n?"http":"unix",proxy_pass:o,domains:l,proxy_host:i};r=e.load("正在添加项目，请稍后...");const u=await R(c);return e.msg({dangerouslyUseHTMLString:!0,message:u.msg,type:u.status?"success":"error",duration:u.status?2e3:0,showClose:!u.status,customClass:"!max-w-[66rem] bt-message-error-html"}),u.status&&(U.value="http",d(()=>{L.value=!0})),u.status}catch(n){return!1}finally{null==r||r.close()}},$=t=>{g({type:"file",path:t.proxysite,change:a=>{t.proxysite=a}})},z=_({title:"标题",body:"网页内",keywords:"关键词",descriptions:"描述",title_update:"标题更新",keywords_update:"关键词更新",description_update:"描述更新",tail_hash_update:"尾部script代码块更新",title_hash_update:"头部head代码块更新"});export{k as S,q as a,A as b,Q as c,H as d,K as e,Y as f,J as g,V as h,$ as i,X as j,z as k,M as m,O as o,F as r,B as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
