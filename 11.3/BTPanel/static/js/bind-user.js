import{c as e,z as t,r as a,o as l,v as s,x as n,O as r,C as o,J as i,K as c,A as d,e as u,B as p,L as m,Q as v,y as f,D as w,G as g,M as h,b2 as y}from"./base-lib.js?v=1763689792";import{_ as b}from"./bt_logo_new.js?v=1763689792";import{s as x,p as k,t as D,q as _,r as V,v as E}from"./api.js?v=1763689792";import{_ as j}from"./utils-lib.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const C={class:"flex !justify-center !w-full items-center"},I={class:"text-extraLarge text-default inline-block mr-2 font-bold mt-12x"},q={key:0,class:"absolute el-form-item__error"},z={class:"flex justify-end items-center text-small mt-[1rem]"},M={key:0,class:"view-con",style:{background:"var(--el-color-white)"}},B={class:"w-full mt-[1.5rem]"},L={class:"w-full mt-[1.5rem]"},S={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-primary",size:"default"},U={key:3,class:"flex justify-end items-center text-small mt-[1rem] h-[1.68rem]"},H={key:0},K={class:"more-bind"},N=j(e({__name:"bind-user",props:{compData:{default:()=>({})}},setup(e,{expose:j}){const N=e,{BtLink:O,BtDivider:T,ElForm:J,ElFormItem:F,ElPopover:A,ElInput:R,ElButton:$}=t(N.compData.dependencies.components),{Message:G,isUndefined:P,inputFocus:Q,rsaEncrypt:X,useAxios:Y}=t(N.compData.dependencies.hooks);x(Y);const W=a(!1),Z=a("获取验证码"),ee=l({username:"",password:"",code:""}),te=l({username:!1,password:!1,code:!1}),ae=a(""),le=a(0),se=a(),ne=a(!1),re=a(1),oe=l({order:"",uin:""}),ie=a({username:[{validator:(e,t,a)=>{var l,s;if((null==(l=N.compData)?void 0:l.dependencies.title)&&(ne.value=!1),/^1[3456789]\d{9}$/.test(t))a();else if(""===t)a(new Error("请输入宝塔官网账号"));else{if(null==(s=N.compData)?void 0:s.dependencies.title)return ne.value=!0,void a(new Error(" "));a(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,t,a)=>{t.length>=8?a():a(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,t,a)=>{W.value||a(),6===t.length?a():a(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ce=()=>{se.value.validate(async e=>{if(!e)return!1;{const e={...ee};if(W.value){if(!ee.code)return G.error("请输入验证码");e.token=ae.value,delete e.password}else delete e.code;const a=G.load("绑定堡塔账号，请稍候 ...");try{e.username=await X(e.username),e.password=await X(e.password);const t=await k({...e});if(G.request(t),t.status)return window.location.reload();if(P(t.data))return!1;if(!t.status&&"[]"===JSON.stringify(t.data))return G.request(t);-1===t.data.code&&(ae.value=t.data.token,W.value=!0)}catch(t){}finally{a.close()}}})},de=a(3);let ue=null,pe=null;const me=e=>{"string"==typeof e.data&&JSON.parse(e.data).code&&(async e=>{const t=JSON.parse(e.data);let a;try{a=G.load("正在绑定中......");const{data:e}=await D({...t,client:1});e.success||e.status?(window.removeEventListener("message",me),window.location.href="/"):(a.close(),G.error(e.res||String(e.msg)),pe.parent.postMessage({msg:e.res||e.msg,success:!1},"*"))}catch(l){null==a||a.close()}})(e)},ve=async()=>{if(oe.order){const e={client:1,order_no:oe.order,uin:oe.uin},t=await E(e);t.status&&"string"==typeof t.data.data?fe(t.data.data):G.error(t.data.res||t.data.msg||t.data.data)}else oe.uin?G.error("请输入订单号"):G.error("请输入腾讯云账号ID")},fe=e=>{const t=(window.screen.width-600)/2,a=(window.screen.height-800)/2;window.removeEventListener("message",me),window.addEventListener("message",me),pe&&pe.close(),pe=window.open(e,"popup","width=600,height=800,left=".concat(t,",top=").concat(a,",noopener,noreferrer")),pe||G.error("授权弹窗被浏览器阻止，请允许弹窗以继续操作。")},we=async()=>{var e;if(be.value)return void ve();let t;try{de.value=3,ue&&clearInterval(ue),t=G.load("正在绑定中......");const{data:a}=await D({client:1});if(a.status||a.success)window.location.href="/";else{t.close();const l=a.msg||a.res,s=document.querySelector(".location-con");let n=16;if(s){const e=s.getBoundingClientRect();n=e.top+window.scrollY-50}G.msg({customClass:(null==(e=N.compData)?void 0:e.dependencies.title)?"customMsgDiv":"",type:"warning",dangerouslyUseHTMLString:!0,duration:3e3,offset:n,message:"".concat(l,'<div style="align-items:center;"><span style="display:inline-block;color:var(--el-color-danger);" class="loginErrorNum">').concat(de.value,"</span>秒后切换到宝塔账号登录</div>")}),setTimeout(()=>{if(s){const e=s.getBoundingClientRect().left+window.scrollX,t=document.querySelector(".customMsgDiv");t&&(t.style.left="".concat(e+143,"px"),t.style.opacity="1")}},0),ue=setInterval(()=>{if(de.value<=1)return clearInterval(ue),void he(1);de.value-=1;const e=document.querySelector(".loginErrorNum");e&&(e.innerHTML="".concat(de.value))},1e3)}}catch(a){null==t||t.close()}},ge=async()=>{if(!ee.username||!ee.password)return void G.error("请先输入手机号和密码");te.username=!0,te.password=!0,(e=>{le.value&&clearInterval(le.value);const t=()=>{if(--e<=0)return clearInterval(le.value),Z.value="获取验证码",void(te.code=!1);Z.value="重新获取验证码(".concat(e,"s)")};t(),le.value=setInterval(t,1e3),te.code=!0})(60);const e=await _({username:ee.username,token:ae.value});G.request(e)},he=e=>{var t;re.value=e,(null==(t=N.compData)?void 0:t.dependencies.onChangeType)&&N.compData.dependencies.onChangeType(1===e?"bind":"other")},ye=a(!1),be=a(!1),xe=async e=>{try{if(1===e)return void he(1);if(2===e)return void he(2);const t=await V();t.status?(ye.value=1===t.data.client&&1===t.data.login,1===t.data.client&&1===t.data.login?he(2):1===t.data.client&&0!==t.data.login?(he(2),be.value=!0):he(1)):he(1)}catch(t){he(1)}};return xe(),j({onOpen:()=>{Q(se.value.$el,"username")},onCancel:()=>{se.value.clearValidate()}}),s(()=>{var e;null==(e=se.value)||e.clearValidate()}),(a,l)=>{var s;const x=y;return n(),r(t(J),{ref_key:"bindUserInfo",ref:se,size:"medium",rules:t(ie),model:t(ee),autocomplete:"off",class:m(["bind-user-info",{"bind-form":!!(null==(s=e.compData)?void 0:s.dependencies.title)}])},{default:o(()=>{var a,s,y,k,D,_,V,E,j,N,J,G,P,Q,X;return[i(d("div",null,[u(t(F),{class:"text-center !mb-5 flex justify-center"},{default:o(()=>{var a;return[d("div",C,[d("h3",I,p((null==(a=e.compData)?void 0:a.dependencies.title)||"切换宝塔官网账号"),1),u(t(A),{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:o(()=>[...l[11]||(l[11]=[d("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(n(),r(t(F),{key:1,prop:"username",class:m({"!mb-[3rem]":!!(null==(a=e.compData)?void 0:a.dependencies.title)})},{default:o(()=>{var a;return[u(t(R),{modelValue:t(ee).username,"onUpdate:modelValue":l[0]||(l[0]=e=>t(ee).username=e),clearable:"",required:"",class:"!leading-[4rem] !h-[4rem]",name:"username",autocomplete:"off",placeholder:"宝塔官网账号",disabled:t(te).username,onKeyup:l[1]||(l[1]=v(e=>ce(),["enter"]))},null,8,["modelValue","disabled"]),(null==(a=e.compData)?void 0:a.dependencies.title)&&t(ne)?(n(),f("span",q,[l[13]||(l[13]=d("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),u(t(O),{class:"!text-small",href:"https://www.bt.cn/register"},{default:o(()=>[...l[12]||(l[12]=[w(" 免费注册 ",-1)])]),_:1})])):g("",!0)]}),_:1},8,["class"])),(n(),r(t(F),{key:2,prop:"password"},{default:o(()=>[u(t(R),{modelValue:t(ee).password,"onUpdate:modelValue":l[2]||(l[2]=e=>t(ee).password=e),clearable:"",required:"",type:"password",class:"!leading-[4rem] !h-[4rem]",name:"password",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:t(te).password,onKeyup:l[3]||(l[3]=v(e=>ce(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),i(u(t(F),{prop:"code"},{default:o(()=>[u(t(R),{modelValue:t(ee).code,"onUpdate:modelValue":l[4]||(l[4]=e=>t(ee).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",type:"text",onKeyup:l[5]||(l[5]=v(e=>ce(),["enter","native"]))},{append:o(()=>[u(t($),{class:"relative top-0 rounded-none rounded-r-base",type:"primary",size:"default",disabled:t(te).code,plain:"",onClick:ge},{default:o(()=>[w(p(t(Z)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[c,t(W)]]),u(t($),{class:"w-[100%] mt-[1.2rem]",type:"primary",size:"default",onClick:l[6]||(l[6]=e=>ce())},{default:o(()=>{var t,a;return[w(p((null==(t=e.compData)?void 0:t.dependencies.btn)||((null==(a=e.compData)?void 0:a.dependencies.title)?"绑定账号":"切换账号")),1)]}),_:1}),d("div",z,[u(t(O),{href:"https://www.bt.cn/register"},{default:o(()=>[...l[14]||(l[14]=[w("注册账号",-1)])]),_:1}),u(t(T)),u(t(O),{href:"https://www.bt.cn/login.html?page=reset"},{default:o(()=>[...l[15]||(l[15]=[w("忘记密码",-1)])]),_:1}),u(t(T)),u(t(O),{href:"https://www.bt.cn/bbs"},{default:o(()=>[...l[16]||(l[16]=[w("问题反馈",-1)])]),_:1})])],512),[[c,1===t(re)]]),i(d("div",null,[(null==(s=e.compData)?void 0:s.dependencies.title)?g("",!0):(n(),f("div",{key:0,class:"view-con",style:h((null==(y=e.compData)?void 0:y.dependencies.title)?"":"background:var(--el-color-white);")},[d("div",{class:"app-box",style:h((null==(k=e.compData)?void 0:k.dependencies.title)?"":"background:var(--el-color-white);")},[...l[17]||(l[17]=[d("img",{alt:"",src:b},null,-1)])],4),l[19]||(l[19]=d("div",{class:"change-icon"},[d("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[d("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1)),d("div",{class:"app-box",style:h((null==(D=e.compData)?void 0:D.dependencies.title)?"":"background:var(--el-color-white);")},[...l[18]||(l[18]=[d("div",{class:"tencent-icon"},null,-1)])],4)],4)),d("div",{class:m({"bg-light":null==(_=e.compData)?void 0:_.dependencies.title,"rounded-base":null==(V=e.compData)?void 0:V.dependencies.title}),style:h({border:(null==(E=e.compData)?void 0:E.dependencies.title)?"1px solid #ddd":"none","padding-top":(null==(j=e.compData)?void 0:j.dependencies.title)?"2rem":"0"})},[(null==(N=e.compData)?void 0:N.dependencies.title)?(n(),f("div",M,[...l[20]||(l[20]=[d("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[d("img",{alt:"",src:b})],-1),d("div",{class:"change-icon"},[d("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[d("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1),d("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[d("div",{class:"tencent-icon"})],-1)])])):g("",!0),t(be)?g("",!0):(n(),r(t(F),{key:1,class:m(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(J=e.compData)?void 0:J.dependencies.title,"!pt-0":null==(G=e.compData)?void 0:G.dependencies.title}])},{default:o(()=>[u(x),l[21]||(l[21]=d("h3",{class:"text-base w-full text-secondary inline-block font-bold"},"腾讯云用户专享特权：",-1)),l[22]||(l[22]=d("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] flex items-center"},[d("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 免费使用原本需要付费的功能： ")],-1)),l[23]||(l[23]=d("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] ml-[1.9rem] flex items-center location-con"},[d("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),w(" 异常监控推送 ")],-1)),l[24]||(l[24]=d("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1.5rem] flex items-center"},[d("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"])),t(be)?(n(),r(t(F),{key:2,class:m(["!mb-0 flex justify-center",{"p-[2.5rem]":null==(P=e.compData)?void 0:P.dependencies.title,"!pt-0":null==(Q=e.compData)?void 0:Q.dependencies.title}])},{default:o(()=>[u(x),l[25]||(l[25]=d("h3",{class:"text-base w-full text-secondary inline-block font-bold text-center"},"腾讯云账号绑定",-1)),d("div",B,[u(t(R),{modelValue:t(oe).uin,"onUpdate:modelValue":l[7]||(l[7]=e=>t(oe).uin=e),size:"large",clearable:"",name:"uin",autocomplete:"off",placeholder:"请输入腾讯云账号ID"},null,8,["modelValue"])]),d("div",L,[u(t(R),{modelValue:t(oe).order,"onUpdate:modelValue":l[8]||(l[8]=e=>t(oe).order=e),size:"large",clearable:"",name:"order",autocomplete:"off",placeholder:"请输入腾讯云市场订单号",onKeyup:v(ve,["enter","native"])},null,8,["modelValue"])])]),_:1},8,["class"])):g("",!0),u(t($),{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:we},{default:o(()=>[w(p(t(ye)?"一键激活专享特权":"绑定腾讯云账号"),1)]),_:1}),d("div",S,[d("span",{class:"cursor-pointer hover:text-primaryDark",onClick:l[9]||(l[9]=e=>he(1))},"已有宝塔账号登录")]),(null==(X=e.compData)?void 0:X.dependencies.title)?(n(),f("div",U)):g("",!0)],6)],512),[[c,2===t(re)]]),1===t(re)&&(t(ye)||t(be))?(n(),f("div",H,[l[27]||(l[27]=d("div",{class:"more-title"},[d("span",null,"更多绑定方式")],-1)),d("div",K,[i(d("div",{class:"bind-box",onClick:l[10]||(l[10]=e=>xe(2))},[...l[26]||(l[26]=[d("i",{class:"tencent_ico"},null,-1),w(" 腾讯云账号 ",-1)])],512),[[c,1===t(re)]])])])):g("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-4017e3ca"]]);export{N as default};
