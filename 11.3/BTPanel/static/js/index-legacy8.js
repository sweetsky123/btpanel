!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function u(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function u(n,r,a,u){var o=r&&r.prototype instanceof l?r:l,s=Object.create(o.prototype);return i(s,"_invoke",function(n,r,a){var u,o,i,l=0,s=a||[],f=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return u=e,o=0,i=t,p.n=n,c}};function m(n,r){for(o=n,i=r,e=0;!f&&l&&!a&&e<s.length;e++){var a,u=s[e],m=p.p,d=u[2];n>3?(a=d===r)&&(i=u[(o=u[4])?5:(o=3,3)],u[4]=u[5]=t):u[0]<=m&&((a=n<2&&m<u[1])?(o=0,p.v=r,p.n=u[1]):m<d&&(a=n<3||u[0]>r||r>d)&&(u[4]=n,u[5]=r,p.n=d,o=0))}if(a||n>1)return c;throw f=!0,r}return function(a,s,d){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&m(s,d),o=s,i=d;(e=o<2?t:i)||!f;){u||(o?o<3?(o>1&&(p.n=-1),m(o,i)):p.n=i:p.v=i);try{if(l=2,u){if(o||(a="next"),e=u[a]){if(!(e=e.call(u,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,o<2&&(o=0)}else 1===o&&(e=u.return)&&e.call(u),o<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),o=1);u=t}else if((e=(f=p.n<0)?i:n.call(r,p))!==c)break}catch(e){u=t,o=1,i=e}finally{l=1}}return{value:e,done:f}}}(n,a,u),!0),s}var c={};function l(){}function s(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(i(e={},r,function(){return this}),e),m=f.prototype=l.prototype=Object.create(p);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,i(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t}return s.prototype=f,i(m,"constructor",f),i(f,"constructor",s),s.displayName="GeneratorFunction",i(f,a,"GeneratorFunction"),i(m),i(m,a,"Generator"),i(m,r,function(){return this}),i(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m:d}})()}function i(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}i=function(t,e,n,r){function u(e,n){i(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(u("next",0),u("throw",1),u("return",2))},i(t,e,n,r)}function c(t,e,n,r,a,u,o){try{var i=t[u](o),c=i.value}catch(t){return void n(t)}i.done?e(c):Promise.resolve(c).then(r,a)}function l(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var u=t.apply(e,n);function o(t){c(u,r,a,o,i,"next",t)}function i(t){c(u,r,a,o,i,"throw",t)}o(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./column-legacy.js?v=1763689792","./useMethod-legacy2.js?v=1763689792","./config-legacy.js?v=1763689792","./useMethod-legacy3.js?v=1763689792","./site-legacy.js?v=1763689792","./index-legacy123.js?v=1763689792"],function(t,n){"use strict";var r,u,i,c,s,f,p,m,d,v,b,y,h,_,g,w,k,j,x,O,S,P,T,C,z,E,F,A,q,D,H,G,M,V,B,I,N,J,R,U,$,K,L,Q,W,X,Y,Z,tt,et,nt,rt,at,ut;return{setters:[function(t){r=t.p,u=t.Q,i=t.M,c=t.n,s=t.H,f=t.R,p=t.ak,m=t.al,d=t.am,v=t.u,b=t.an,y=t.x,h=t.ao,_=t.ap,g=t.j,w=t.$},function(t){k=t.o,j=t.r,x=t.e,O=t.V,S=t.c,P=t.g,T=t.D,C=t.v,z=t.x,E=t.y,F=t.C,A=t.A,q=t.z,D=t.J,H=t.K,G=t.R,M=t.H,V=t.b4,B=t.b6,I=t.O},function(t){N=t._},function(t){J=t.a,R=t.d,U=t.u,$=t.o,K=t.c},function(t){L=t.i,Q=t.d},function(t){W=t.$,X=t.a0,Y=t.a1,Z=t.a2},function(t){tt=t.p,et=t.o,nt=t.d},function(t){rt=t.restorePhpSiteData,at=t.restorePhpSiteDataLog},function(t){ut=t._}],execute:function(){var ot=function(){var t=l(o().m(function t(){var e,n;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,W();case 1:return e=t.v,n=e.data,t.a(2,{data:n.data,total:n.data.length,other:{}});case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),it=function(){var t=l(o().m(function t(e){return o().w(function(t){for(;;)switch(t.n){case 0:window.open("/download?filename=".concat(e.backup_file),"_blank","noopener,noreferrer");case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),ct=function(){var t=l(o().m(function t(e){return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,r({title:"删除备份",content:"是否删除备份文件？",type:"calc"});case 1:return t.n=2,u({loading:"正在删除备份，请稍后...",request:X({timestamp:e.timestamp}),message:!0});case 2:L.value=!0,t.n=4;break;case 3:t.p=3,t.v;case 4:return t.a(2)}},t,null,[[0,3]])}));return function(e){return t.apply(this,arguments)}}(),lt=function(){var t=l(o().m(function t(e,u){var f,p,m;return o().w(function(t){for(;;)switch(t.n){case 0:if("confirm"!==u){t.n=2;break}return f=j(!1),p=0,t.n=1,r({title:"还原备份",content:function(){return x("div",null,[x("div",null,["网站【".concat(e.name,"】数据即将被覆盖，是否继续？")]),x("div",null,[x(O,{modelValue:f.value,"onUpdate:modelValue":function(t){return f.value=t},label:"还原网站配置文件"},null)])])},type:"calc"});case 1:try{rt({id:e.id,reconf:f.value?"True":"False"}),m=S({setup:function(){var t=j("获取中..."),n=function(){var r=l(o().m(function r(){var a;return o().w(function(r){for(;;)switch(r.n){case 0:return clearTimeout(p),r.n=1,at({pid:e.pid});case 1:a=r.v,t.value=a.log,a.restore_status?i.request(a):p=setTimeout(function(){n()},1500);case 2:return r.a(2)}},r)}));return function(){return r.apply(this,arguments)}}();return n(),function(){return x("div",{class:"flex-wrap"},[x(ut,{class:"h-[40rem] !rounded-none",content:t.value},null)])}}}),c({title:"还原日志",component:function(){return x(m,null,null)},area:55})}catch(d){}t.n=4;break;case 2:if(Q.value=a({operateType:"restore"},e),"backup-running"!==e.status){t.n=3;break}return i.error("备份正在运行，请稍后再试"),t.a(2);case 3:"restore-running"===e.status&&(tt.value=et()),c({title:"还原备份",component:function(){return s(function(){return n.import("./index-legacy121.js?v=1763689792")},void 0,n.meta.url)},area:84,btn:["确定还原","取消"],showFooter:!0});case 4:return t.a(2)}},t)}));return function(e,n){return t.apply(this,arguments)}}(),st=function(){var t=l(o().m(function t(e){return o().w(function(t){for(;;)switch(t.n){case 0:Q.value=a({operateType:"detail"},e),c({title:"【".concat(e.backup_name,"】备份还原详情"),component:function(){return s(function(){return n.import("./detail-back-legacy.js?v=1763689792")},void 0,n.meta.url)},area:78});case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),ft=function(t){c({title:"上传文件",area:"72",component:function(){return s(function(){return n.import("./index-legacy122.js?v=1763689792")},void 0,n.meta.url)},compData:{path:"/www/backup/backup_restore"},onOpen:function(){var t=document.querySelector(".upload-files-tips");if(t){var e,n=document.createElement("ul");n.className="text-secondary mt-[2px] leading-[2rem] text-small ml-[20px] list-disc";var r=document.createElement("li");r.textContent="只有在此处备份的文件，才会在备份列表中显示",n.appendChild(r),null===(e=t.parentNode)||void 0===e||e.insertBefore(n,t.nextSibling)}},onCancel:function(){t()}})},pt=function(){var t=l(o().m(function t(e){return o().w(function(t){for(;;)switch(t.n){case 0:Q.value=a({operateType:"log"},e),c({title:"备份日志",component:function(){return s(function(){return n.import("./log-back-legacy.js?v=1763689792")},void 0,n.meta.url)},area:60});case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),mt=t("b",k({backup_time:"",file_size:"",time_count:"",size:"",path:"","SHA-256":""})),dt=function(){var t=l(o().m(function t(e){return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Y({timestamp:e.timestamp});case 1:t.v,tt.value=et(),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),vt=t("a",j()),bt=(t("s",j(!1)),t("g",l(o().m(function t(){var e,n,r,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,nt.value=!0,e={timestamp:Q.value.timestamp,type:gt.value},t.n=1,Z(e);case 1:return n=t.v,r=n.data.data,mt.time_count=r.total_time,mt.size=r.backup_file_size,mt["SHA-256"]=r.backup_file_sha256,mt.path=r.backup_file,mt.backup_time=r.done_time,vt.value=r.data_status,a=bt(r.data_status),t.a(2,{data:a,total:a.length,other:{}});case 2:t.p=2,t.v;case 3:return t.p=3,nt.value=!1,t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))),function(t){var e={ssh_list:"防火墙",crontab_list:"计划任务",term_list:"终端",database_list:"数据库",site_list:"网站",ftp_list:"FTP",plugin_list:"插件",env_list:"运行环境"},n=Object.keys(t),r=[];return n.forEach(function(n){if(f(t[n])&&t[n].length>0){var a=t[n].filter(function(t){return t.status&&3===t.status});a.length>0&&a.forEach(function(t){r.push({name:t.name,msg:t.err_msg||"未知错误"})})}else p(t[n])&&3===t[n].status&&r.push({name:e[n],msg:t[n].err_msg||"未知错误"})}),r});j(!1),j([]),j([]),j([]),j([]),j([]),j([]);var yt=j(!1),ht=j(0),_t=function(){var t=l(o().m(function t(e){var n,r,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,(n=new FormData).append("blob",e.file),n.append("f_size",e.data.f_size),n.append("f_path",e.data.f_path),n.append("f_name",e.data.f_name),n.append("f_start",e.data.f_start),r={headers:{"Content-Type":"multipart/form-data","x-http-token":window.vite_public_request_token}},t.n=1,m.post("/files?action=upload",n,r);case 1:a=t.v,d(a.data)?(yt.value||(yt.value=!0),ht.value=Math.floor(a.data/e.data.f_size*100),_t(e)):(yt.value=!1,i.request(a.data)),t.n=3;break;case 2:t.p=2,t.v,i.error("导入失败"),yt.value=!1,L.value=!0;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),gt=t("d",j("backup")),wt=function(){var t=l(o().m(function t(){return o().w(function(t){for(;;)switch(t.n){case 0:Q.value={operateType:"add"},c({title:"创建备份",area:84,showFooter:!0,component:function(){return s(function(){return n.import("./index-legacy121.js?v=1763689792")},void 0,n.meta.url)},btn:["备份","取消"]});case 1:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),kt={database:"数据库",site:"网站",ftp:"FTP",crontab:"计划任务",term:"终端",firewall:"防火墙",plugin:"插件",other:"其他",runtime:"运行环境"};j(Object.keys(kt).reduce(function(t,e){return t[e]={name:kt[e],list:[]},t},{}));var jt={class:"flex items-center"},xt={class:"p-[20px]"},Ot=S({__name:"index",setup:function(t){var n,r=v().panel,a=_([{label:"删除",value:"delete",event:(n=l(o().m(function t(e,n,r,a,u,i){var c;return o().w(function(t){for(;;)switch(t.n){case 0:return c=function(){var t=l(o().m(function t(e,n){var r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,X({timestamp:e.timestamp});case 1:return r=t.v,t.a(2,r)}},t)}));return function(e,n){return t.apply(this,arguments)}}(),t.n=1,e({title:"删除备份",column:[{label:"备份名称",prop:"backup_name"},K()],content:"删除后不可恢复，确定删除吗？",onConfirm:function(){var t=l(o().m(function t(){return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,n(c);case 1:return L.value=!0,t.a(2,!1)}},t)}));return function(){return t.apply(this,arguments)}}()});case 1:return t.a(2)}},t)})),function(t,e,r,a,u,o){return n.apply(this,arguments)})}]),u=b({request:ot,columns:P(function(){return[J({key:"timestamp"}),{label:"备份名称",prop:"backup_name"},{label:"状态",render:function(t){var e=1===t.backup_status||1===t.restore_status,n=0===t.backup_status,r=1===t.restore_status,a=x("div",null,[x("span",null,[T("成功("),t.backup_count.success||0,T(")")]),x("span",{class:"!ml-[4px]"},[T("失败("),t.backup_count.failed||0,T(")")])]),u=e||n;return x("div",{class:"inline-flex items-center"},[x("span",{style:"background:".concat(t.backup_count.failed?"var(--el-color-danger)":"var(--el-color-primary)"),class:"rounded-full w-[6px] h-[6px] mr-[4px] ".concat(u?"!hidden":"")},null),e&&x("span",{class:"ml-2px text-[var(--el-color-warning-light-3)] cursor-pointer",onClick:function(){Q.value.operateType=r?"restore":"backup",tt.value=et()}},[r?"还原中":"备份中"]),n&&x("span",{class:"ml-2px text-tertiary"},[T("等待备份")]),!e&&!n&&a])}},R({prop:"backup_path",label:"备份文件"}),{label:"备份大小",prop:"backup_file_size",sortable:!0,render:function(t){return x("span",null,[y(Number(t.backup_file_size))])}},{label:"备份时间",prop:"backup_time",sortable:!0},{label:"创建时间",prop:"create_time",sortable:!0},U([{title:"立即备份",width:70,onClick:dt,isHide:function(t){return 0!==t.backup_status&&1!==t.backup_status}},{title:"下载",onClick:it,isHide:function(t){return 0===t.backup_status||1===t.backup_status}},{title:"还原",onClick:lt,isHide:function(t){return 0===t.backup_status||1===t.backup_status}},{title:"详情",onClick:st},{title:"日志",onClick:pt},{title:"删除",onClick:ct}])]}),extension:[h(L),a],empty:function(){return x("span",null,[T("您的列表为空，您可以"),x("span",{class:"bt-link",onClick:wt},[T("创建一个备份")])])}}),c=u.BtTable,s=u.BtBatch,f=u.BtRefresh,p={"x-http-token":window.vite_public_request_token},m=j(null),d=j(null),O=k({f_size:0,f_path:"/www/backup/backup_restore/",f_name:"",f_start:0}),S=function(t){O.f_size=t.size,O.f_name=t.name},I=function(t,e,n){i.error("导入失败"),yt.value=!1,L.value=!0},W=function(t,e,n){yt.value=!1,L.value=!0};return C(function(){window.openFilePath=function(){return $({path:"/www/backup/whole_machine_backup"})},setTimeout(function(){var t=localStorage.getItem("hasJump");r.value.migration&&t&&(et("restore"),localStorage.removeItem("hasJump"))},1e3)}),function(t,n){var r=M,a=V,u=N,o=B,i=g,l=w;return z(),E("div",null,[x(u,null,{"header-left":F(function(){return[A("div",jt,[x(a,{class:"upload-demo h-[0] w-[0]",ref_key:"upload",ref:m,name:"blob",data:q(O),action:"#",headers:p,"http-request":q(_t),accept:".tar,.gz","show-file-list":!1,multiple:!1,"auto-upload":!0,"on-error":I,"on-success":W,"on-change":S},{default:F(function(){return[D(x(r,{ref_key:"open",ref:d,size:"default",type:"default"},{default:F(function(){return e(n[2]||(n[2]=[T(" 选择文件 ",-1)]))}),_:1},512),[[H,!1]])]}),_:1},8,["data","http-request"]),x(r,{type:"primary",onClick:q(wt)},{default:F(function(){return e(n[3]||(n[3]=[T("创建备份",-1)]))}),_:1},8,["onClick"]),x(r,{onClick:n[0]||(n[0]=function(t){return q(ft)(W)})},{default:F(function(){return e(n[4]||(n[4]=[T("上传文件",-1)]))}),_:1}),n[5]||(n[5]=A("span",{class:"text-tertiary ml-4px"},"上传格式为.tar,.gz文件",-1))])]}),"header-right":F(function(){return[x(q(f))]}),content:F(function(){return[x(q(c))]}),"footer-left":F(function(){return[x(q(s))]}),_:1}),x(i,{modelValue:q(yt),"onUpdate:modelValue":n[1]||(n[1]=function(t){return G(yt)?yt.value=t:null}),area:52,title:!1},{default:F(function(){return[A("div",xt,[n[6]||(n[6]=A("span",{class:"mb-[0.8rem]"},null,-1)),x(o,{"text-inside":!0,"stroke-width":20,percentage:q(ht)},null,8,["percentage"])])]}),_:1},8,["modelValue"]),x(l,{class:"mt-[1rem]",options:[{isHtml:!0,content:"9.5以前版本的备份还原不会在备份列表中显示，如有需要请<span class='bt-link' onClick='openFilePath()'>点击查看</span>"}]})])}}}),St=S({__name:"index",setup:function(t){return function(t,e){return z(),I(Ot)}}}),Pt=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"}));t("i",Pt)}}})}();
