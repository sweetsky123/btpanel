import{_ as a}from"./index109.js?v=1763689792";import{p as e,aK as t,Q as l,L as s,n,l as o,j as i,k as r,$ as d,b as u}from"./utils-lib.js?v=1763689792";import{c as p,r as c,o as m,v,aG as y,I as f,x as g,y as x,e as h,C as w,z as b,R as _,D,O as k,G as O,J as V,A as j,K as C,b2 as G,c5 as R,al as q,aj as P,H as X,ad as Y,ab as A}from"./base-lib.js?v=1763689792";import{h as U}from"./form-item.js?v=1763689792";import{m as H}from"./validator.js?v=1763689792";import{getPyVersion as z,getVersionList as L,setGoEnvironment as M,installPyVersionNew as J,installVersion as K,uninstallVersion as S,setGoProxy as T}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const B={class:"p-[20px]"},F={class:"bg-default p-[12px] h-[36rem] text-white overflow-auto logMsg"},I=["innerHTML"],N={class:"p-2rem"},Q=p({__name:"index",props:{compData:{default:{}}},setup(p){const Q=p,$=c(""),E=u(),W=c(!1),Z=c("正在请求安装..."),aa=c([]),ea=c(""),ta=[{label:"版本号",width:200,render:a=>h("div",null,[a.version.replace(Q.compData.type,""),D(" "),"stable"===a.type&&"go"===Q.compData.type?"(正式版)":""])},{label:"安装状态",render:a=>("string"==typeof a.installed&&(a.installed="1"===a.installed),h("div",null,[!0===a.is_install?h("span",{class:"text-tertiary"},[D("安装中")]):a.installed?h("span",{class:"text-primary"},[D("已安装")]):h("span",{class:"text-danger"},[D("未安装")])]))},{label:"操作",align:"right",render:a=>(a.version.replace(Q.compData.type,""),h("div",null,[V(h("div",{class:"inline-block"},[a.installed&&a.version!==$.value&&"go"===Q.compData.type?h("span",{class:"cursor-pointer bt-link",onClick:()=>{ua(a.version)}},[D("应用至命令行")]):"go"===Q.compData.type&&a.installed?h("span",{class:"shrink-0 text-secondary"},[D("正在使用")]):null,h(G,{direction:"vertical"},null)]),[[C,"go"===Q.compData.type]]),a.installed?h("span",{class:"cursor-pointer text-danger",onClick:()=>{ca(a.version)}},[D("卸载")]):!0===a.is_install||!0===a.installing?h("span",{class:"cursor-pointer text-tertiary",onClick:()=>{H()}},[D("安装中...")]):h("span",{class:"cursor-pointer bt-link",onClick:()=>{pa(a.version)}},[D("安装")])]))}],la=c([]),sa=c(!1);c("");const na=c([]),oa=c("py"===Q.compData.type?"常用版本":"所有版本"),ia=m({version:"",extended:"",status:!1}),ra=c([{content:"填写时请勿添加换行符等特殊符号，这可能会导致参数不生效"},{content:"多个参数时以空格隔开"},{content:'"--prefix"参数已被使用'},{content:"验证参数是否生效，可查看安装日志并搜索对应名称"}]),da=async a=>{var l;let s="all";"常用版本"===oa.value&&(s="streamline");try{let t;if("py"===Q.compData.type){!0===a&&await e({title:"提示",width:"35rem",icon:"warning-filled",content:"将从镜像源获取版本列表，是否继续？"});let n={force:!0===a?"true":"false"};sa.value=!0,t=await z(n),la.value=t.data.sdk[s],$.value=(null==(l=t.data.command_path.find(a=>a.python_path===t.data.used))?void 0:l.version)||""}else!0===a&&await e({title:"提示",width:"35rem",icon:"warning-filled",content:"将从镜像源获取版本列表，是否继续？"}),sa.value=!0,t=await L(Q.compData.type,!0===a?"true":"false"),na.value=t.data,ea.value=t.data.goproxy.now||"",aa.value=t.data.goproxy.list.map(a=>({label:"".concat(a.name,"(").concat(a.proxy,")"),value:a.proxy})),t.data.sdk[s].sort((a,e)=>e.installed-a.installed),$.value=t.data.used,la.value=t.data.sdk[s]}catch(n){t(n)}finally{sa.value=!1}},ua=async a=>{var e;(await l({loading:"正在设置默认版本，请稍后...",request:M({name:a}),message:!0})).status&&da(),Q.compData&&"function"==typeof(null==(e=Q.compData)?void 0:e.refresh)&&Q.compData.refresh()},pa=async a=>{var t;if("py"===Q.compData.type){if(ia.status){const a={data:JSON.stringify({version:ia.version,extended:ia.extended})};await l({request:J(a),message:!0}),ia.status=!1,H(),Q.compData&&"function"==typeof(null==(t=Q.compData)?void 0:t.refresh)&&Q.compData.refresh(),da()}else ia.version=a,ia.status=!0;return}await e({title:"安装",content:"是否安装[".concat(a,"]版本？"),icon:"warning-filled"});(await l({loading:"正在安装，请稍后...",request:K({version:a}),message:!0})).status&&H()},ca=async a=>{var t,s;await e({title:"卸载sdk",content:"卸载[".concat(a,"]版本后，相关项目将无法启动，是否继续？"),icon:"warning-filled"});const n=await l({loading:"正在卸载，请稍后...",request:S({version:a},Q.compData.type)});(n.status||Array.isArray(n.data)&&n.data[0].status)&&da(),Array.isArray(n.data)&&!n.data[0].status&&E.error(null==(s=null==(t=n.data)?void 0:t[0])?void 0:s.msg)},ma=async()=>{const a=(a,e)=>{e(aa.value)},{BtForm:e,submit:t}=s({data:{proxy:ea.value},options:e=>c([U("GOPROXY源",()=>h(R,{modelValue:e.value.proxy,"onUpdate:modelValue":a=>e.value.proxy=a,placeholder:"请输入或选择GOPROXY源","value-key":"label","fetch-suggestions":a,onSelect:a=>{e.value.proxy=a.value}},{default:({item:a})=>h("div",{class:a.value===e.value.proxy?" bt-link":""},[a.label])}),"proxy",{rules:[{required:!0,message:"请输入或选择GOPROXY源"}]})]),submit:async(a,e,t)=>{await e();const s=await l({loading:"正在设置GOPROXY源，请稍后...",request:T({proxy:a.value.proxy}),message:!0});return da(),s.status}});n({title:"切换GOPROXY源",area:65,btn:!0,component:h(e,{class:"!p-[2rem]"},null),onConfirm:t})};return v(()=>{da()}),y(()=>{}),(e,t)=>{const l=q,s=P,n=X,u=o,p=i,c=r,m=Y,v=A,y=d,C=a,G=f("bt-loading");return g(),x("div",B,[h(C,null,{"header-left":w(()=>[h(s,{modelValue:b(oa),"onUpdate:modelValue":t[0]||(t[0]=a=>_(oa)?oa.value=a:null),size:"default",onChange:da},{default:w(()=>[h(l,{value:"常用版本"},{default:w(()=>[...t[7]||(t[7]=[D("常用版本",-1)])]),_:1}),h(l,{value:"所有版本"},{default:w(()=>[...t[8]||(t[8]=[D("所有版本",-1)])]),_:1})]),_:1},8,["modelValue"])]),"header-right":w(()=>["go"===Q.compData.type?(g(),k(n,{key:0,type:"default",onClick:ma},{default:w(()=>[...t[9]||(t[9]=[D(" 切换GOPROXY源 ",-1)])]),_:1})):O("",!0),h(n,{type:"default",onClick:t[1]||(t[1]=a=>da(!0))},{default:w(()=>[...t[10]||(t[10]=[D(" 更新版本列表 ",-1)])]),_:1})]),content:w(()=>[V(h(u,{height:"400",column:ta,data:b(la)},null,8,["data"]),[[G,b(sa)]])]),popup:w(()=>[h(p,{title:"安装信息",modelValue:b(W),"onUpdate:modelValue":t[2]||(t[2]=a=>_(W)?W.value=a:null),area:[50,36],onCancel:t[3]||(t[3]=()=>Z.value="正在请求安装...")},{default:w(()=>[j("div",F,[j("pre",{innerHTML:b(Z),class:"whitespace-pre-wrap"},null,8,I)])]),_:1},8,["modelValue"]),h(p,{title:"安装版本【".concat(b(ia).version,"】"),modelValue:b(ia).status,"onUpdate:modelValue":t[5]||(t[5]=a=>b(ia).status=a),area:50,"show-footer":!0,onConfirm:t[6]||(t[6]=a=>pa(b(ia).version))},{default:w(()=>[j("div",N,[h(v,{model:b(ia)},{default:w(()=>[h(m,{label:"自定义参数"},{default:w(()=>[h(c,{modelValue:b(ia).extended,"onUpdate:modelValue":t[4]||(t[4]=a=>b(ia).extended=a),name:"extended",width:"32rem",placeholder:"可为空，实例：--enable-optimizations"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),h(y,{class:"pl-4rem mt-1rem",options:b(ra)},null,8,["options"])])]),_:1},8,["title","modelValue"])]),_:1})])}}});export{Q as default};
