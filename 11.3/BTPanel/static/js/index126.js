import{k as e,b as a,_ as t,p as s,$ as l,j as i}from"./utils-lib.js?v=1763689792";import{_ as n}from"./index123.js?v=1763689792";import{c as r,r as u,o,w as c,a8 as m,x as v,y as d,A as p,e as f,C as x,z as g,O as w,B as b,G as y,J as h,D as _,K as C,b6 as k,H as j,ap as I,aA as F,s as T,n as V,g as D,v as S,F as H,b1 as z,R as N,b2 as O,b9 as A,ba as B}from"./base-lib.js?v=1763689792";import{C as L,w as U,s as q,i as G,o as J}from"./index14.js?v=1763689792";import{A as M,B as R,C as K}from"./useController3.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index109.js?v=1763689792";import"./index118.js?v=1763689792";import"./index130.js?v=1763689792";import"./index131.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";const $={class:"mr-[10px]"},E={class:"flex items-center"},P={class:"flex items-center"},Q={class:"text-primary"},W={class:"flex flex-col text-secondary p-12px"},X={class:"flex items-center"},Y={class:"flex items-center mt-[8px] w-full"},Z=t(r({__name:"index",props:{refreshFn:{type:Function,default:()=>({})},sessionConfig:{default:()=>{}}},emits:["save"],setup(t,{expose:s,emit:l}){const i=t,n=a(),r=l,T=u(!1),V=u(),D=u(!0),S=u(0),H=u(100),z=u(5),N=u(5),O=o({status:!1,time:5,timer:0});let A=!1;const B=async e=>{O.status=e,O.time=N.value,(!O.time||O.time<1)&&(O.time=5,N.value=5),e?(O.timer=setInterval(()=>{A||i.refreshFn()},1e3*N.value),S.value=setInterval(()=>{A||(z.value--,0===z.value&&(z.value=N.value),H.value=z.value/N.value*100)},1e3)):(clearInterval(O.timer),clearInterval(S.value),z.value=N.value,H.value=100,D.value||n.success("关闭成功")),r("save",O)},L=async()=>{O.time<1||!Number.isInteger(parseFloat(O.time.toString()))||O.time>99?n.error("时间间隔须在范围1~99秒内的整数"):(z.value=O.time,N.value=O.time,n.success("保存成功"),clearInterval(O.timer),clearInterval(S.value),B(!0),r("save",O))},U=async()=>{await i.refreshFn(),n.success("刷新成功")},q=()=>{T.value=!1,O.time=N.value};c(()=>i.sessionConfig,e=>{V.value=e,(null==e?void 0:e.time)&&D.value&&(N.value=e.time,z.value=e.time,B(e.status),D.value=!1)},{deep:!0});const G=()=>{clearInterval(O.timer),clearInterval(S.value)};return m(()=>{A=!0,G()}),s({clearIntervalFn:G}),(a,t)=>{const s=k,l=j,i=I,n=e,r=F;return v(),d("div",$,[p("div",E,[f(l,{class:"h-[3.2rem] refresh-btn",onClick:U},{default:x(()=>[p("div",P,[g(O).status?(v(),w(s,{key:0,class:"mr-8px",width:22,"show-text":!0,"stroke-width":1,type:"circle",color:"var(--el-color-primary)","text-color":"var(--el-color-primary)",percentage:g(H)},{default:x(()=>[p("span",Q,b(Number(g(z))),1)]),_:1},8,["percentage"])):y("",!0),t[3]||(t[3]=p("span",null,"刷新日志",-1))])]),_:1}),f(r,{placement:"bottom-start",width:"280",trigger:"click","popper-class":"el-tooltip-white",onHide:q},{reference:x(()=>[f(l,{class:"down-button !ml-0",onClick:t[2]||(t[2]=e=>T.value=!g(T))},{default:x(()=>[...t[7]||(t[7]=[p("i",{class:"svgtofont-el-arrow-down"},null,-1)])]),_:1})]),default:x(()=>[p("div",W,[p("div",X,[t[4]||(t[4]=p("span",{class:"mr-4px"},"定时刷新",-1)),f(i,{modelValue:g(O).status,"onUpdate:modelValue":t[0]||(t[0]=e=>g(O).status=e),onChange:B},null,8,["modelValue"])]),h(p("div",Y,[t[6]||(t[6]=p("span",{class:"mr-4px flex-nowrap"},"时间间隔",-1)),f(n,{modelValue:g(O).time,"onUpdate:modelValue":t[1]||(t[1]=e=>g(O).time=e),"text-type":"秒",min:1,type:"number",class:"!w-[10rem]"},null,8,["modelValue"]),f(l,{class:"!ml-4px",type:"primary",onClick:L},{default:x(()=>[...t[5]||(t[5]=[_("保存",-1)])]),_:1})],512),[[C,g(O).status]])])]),_:1})])])}}}),[["__scopeId","data-v-66473ffd"]]),ee=a(),ae=L(),{rowData:te}=T(ae),se=u("正在获取中...."),le=u({log_path:"",size:""}),ie=u(!1),ne=u(""),re=u([]),ue=u(0),oe=u(""),ce=u(),me=u(),ve=o({status:!1,time:3}),de=u([new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,999))]),pe=u(),fe=[{label:"全部",value:0},{label:"近7天",value:1},{label:"近30天",value:2},{label:"自定义时间",value:3}],xe=e=>{ue.value=e,3!==e?(oe.value="",we(!1)):ce.value.focus()},ge=e=>{ue.value=3,oe.value=e,we(!1)},we=async e=>{try{e&&(me.value=(e=>{let a=Number(e);return a=a<3?3:a,a})(ve.time));let a=0,t=0;if(0!==ue.value){const e=1===ue.value?7:30,s=(new Date).getTime();a=(new Date(s-24*e*60*60*1e3).getTime()/1e3).toFixed(0),t=(s/1e3).toFixed(0),3===ue.value&&(a=(new Date(oe.value[0]).getTime()/1e3).toFixed(0),t=(new Date(oe.value[1]).getTime()/1e3).toFixed(0))}else a="",t="";const s=await M({id:te.value.id,start_timestamp:a,end_timestamp:t});se.value=s.data.msg||"暂无日志",be(),e&&ye()}catch(a){}},be=()=>{V(()=>{const e=document.querySelector(".pre-box");e&&(e.scrollTop=e.scrollHeight)})},ye=async()=>{try{const{data:e}=await R({id:te.value.id});le.value.log_path=e.log_path,le.value.size=e.size}catch(e){}},he=e=>{ve.status=e.status,ve.time=e.time,pe.value[te.value.id]=ve,pe.value[te.value.id].id=te.value.id,sessionStorage.setItem("CRONTAB-LOGS",JSON.stringify(pe.value))},_e=()=>{const e=sessionStorage.getItem("CRONTAB-LOGS");pe.value=e?JSON.parse(e):{},pe.value&&pe.value[te.value.id]?(ve.status=pe.value[te.value.id].status,ve.time=Number(pe.value[te.value.id].time)||3,pe.value[te.value.id].id=te.value.id):he({status:!1,time:5,id:te.value.id}),ye(),we()},Ce=async()=>{try{await s({title:"提示",content:"确定清空日志吗？"});const e=await K({id:te.value.id});ee.request(e),we(!0)}catch(e){}},ke=e=>{const a=new Date;return a.setHours(23,59,59,999),e.getTime()>a.getTime()},je=async()=>{await q(!1,!0),_e()},Ie={class:"p-[20px]"},Fe={class:"pb-2rem flex gap-2rem leading-2rem"},Te={class:"max-w-[54rem] truncate"},Ve=["title"],De={class:"flex justify-between items-end"},Se={class:"flex items-center"},He={class:"flex refresh-btn"},ze={class:"flex items-center relative"},Ne={class:"pre-box bg-[#333] mt-[12px] text-white h-[48rem] overflow-auto p-[20px]"},Oe=["innerHTML"],Ae={class:"flex-wrap"},Be=t(r({__name:"index",emits:["close"],setup(e,{emit:a}){const t=a,s=D(()=>[...G.value?[{content:f("span",{class:"bt-link",onClick:()=>J(r)},[_("一键跳转至本地备份目录")])}]:[],{content:()=>f("span",null,[_("若您发现任务无法定时执行，可尝试点击"),f("span",{class:"bt-link",onClick:()=>(async()=>{try{ie.value=!0,ne.value="",re.value=[],U.request("/crontab/set_execute_script",{customType:"model",onMessage:e=>{!0!==e&&"successful"!==e&&(re.value.push(e),ne.value=re.value.join("\n"))}})}catch(e){}})()},[_("【重装Crontab】")]),_("进行重新安装")])}]),r=()=>{t("close")};return S(_e),(e,a)=>{const t=Z,r=j,u=O,o=A,c=B,m=l,y=n,h=i;return v(),d("div",Ie,[p("div",Fe,[p("div",Te,"日志路径："+b(g(le).log_path),1),p("div",{class:"w-[20rem] truncate",title:"大小：".concat(g(le).size)},"大小： "+b(g(le).size),9,Ve)]),p("div",De,[p("div",Se,[p("div",He,[f(t,{refreshFn:()=>g(we)(!0),"session-config":g(ve),onSave:g(he)},null,8,["refreshFn","session-config","onSave"])]),f(r,{onClick:g(Ce)},{default:x(()=>[...a[2]||(a[2]=[_(" 清空日志 ",-1)])]),_:1},8,["onClick"]),f(u,{direction:"vertical",class:"!h-[2rem] !mx-1rem"}),f(r,{onClick:g(je)},{default:x(()=>[...a[3]||(a[3]=[_("执行任务",-1)])]),_:1},8,["onClick"])]),p("div",ze,[f(o,{size:"default",class:"control-btn"},{default:x(()=>[(v(!0),d(H,null,z(g(fe),(e,a)=>(v(),w(r,{key:a,type:g(ue)===a?"primary":"",onClick:a=>g(xe)(e.value)},{default:x(()=>[_(b(e.label),1)]),_:2},1032,["type","onClick"]))),128))]),_:1}),f(c,{modelValue:g(oe),"onUpdate:modelValue":a[0]||(a[0]=e=>N(oe)?oe.value=e:null),type:"daterange",ref_key:"player",ref:ce,align:"right",size:"default",class:"!absolute right-0 top-0 opacity-0 !w-0 !h-0","range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期","disabled-date":g(ke),"default-time":g(de),onChange:g(ge)},null,8,["modelValue","disabled-date","default-time","onChange"])])]),p("div",Ne,[p("pre",{class:"whitespace-pre-wrap",innerHTML:g(se)},null,8,Oe)]),f(m,{options:g(s),"list-style":"disc",class:"mt-[1rem] mx-[1rem]"},null,8,["options"]),f(h,{title:"正在检查Crontab，请耐心等候",modelValue:g(ie),"onUpdate:modelValue":a[1]||(a[1]=e=>N(ie)?ie.value=e:null),area:[60]},{default:x(()=>[p("div",Ae,[f(y,{class:"h-[40rem] !rounded-none",content:g(ne)},null,8,["content"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-7174226c"]]);export{Be as default};
