import{_ as e}from"./index109.js?v=1763689792";import{u as a,x as l,k as t,cf as s,bb as o,aK as n,Q as d,W as r,M as i,aH as u,V as m,p as c,l as p,d as h,j as y,_ as v}from"./utils-lib.js?v=1763689792";import{r as b,o as _,e as f,n as g,W as w,ap as x,D as V,c as k,v as C,I as j,x as U,O as D,C as z,z as I,J as q,A,y as F,b1 as O,F as E,B as R,G as S,R as T,H,aZ as P,an as B,ad as L,al as M,aj as N,ab as W,am as G}from"./base-lib.js?v=1763689792";import{p as J,l as K,cU as Q}from"./validator.js?v=1763689792";import{_ as Z}from"./index118.js?v=1763689792";import{_ as X}from"./index130.js?v=1763689792";import{u as Y}from"./useStore4.js?v=1763689792";import{u as $}from"./column.js?v=1763689792";import{getBoceList as ee,modifyBoce as ae,createBoce as le,getBoceLog as te,getAlarmList as se,startBoce as oe,removeBoce as ne,removeTaskLog as de}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const{siteInfo:re}=Y(),{payment:ie}=a(),ue=b([]),me=b(!1);b(null);const ce=b(null),pe=b(!1),he=_({url:"",channel:[],name:"",cycle:10,method:"",alarm_count:5,address:"localhost",methodData:""}),ye=_({p:1,limit:12,total:0}),ve=b([]),be=b([]),_e=[{label:"ISP",prop:"isp"},{label:"解析IP",prop:"primary_ip"},{label:"状态",prop:"http_code"},{label:"总耗时",prop:"total_time",render:e=>Ce(1e3,500,e.total_time,"ms")},{label:"解析耗时",prop:"namelookup_time",render:e=>Ce(500,100,e.namelookup_time,"ms")},{label:"连接耗时",prop:"connect_time",render:e=>Ce(500,100,e.connect_time,"ms")},{label:"处理耗时",prop:"starttransfer_time",render:e=>Ce(1e3,500,e.starttransfer_time,"ms")},{label:"响应大小",prop:"size_download",render:e=>l(e.size_download)},{label:"传输速度",prop:"speed_download",render:e=>l(e.speed_download)},{label:"响应头",prop:"header",width:280,render:e=>f(t,{type:"textarea",readOnly:!0,rows:6,"model-value":e.header,class:"!w-full"},null)}],fe=b([]),ge=b(!1),we=_({p:1,total:0,pid:0,url:""}),xe=b(!1),Ve=b([]),ke=_({name:[s({message:"请输入任务名称"})],cycle:[s({message:"请输入监控频率"})],alarm_count:[s({message:"请输入告警次数"})],channel:[s({message:"请选择告警方式"})],methodData:[{validator:(e,a,l)=>{["delay","keyword"].includes(he.method)&&""===a?l(new Error("请输入告警条件")):l()},trigger:["blur","change"]}]}),Ce=(e,a,l,t)=>{var s="";return l>e?s="text-warning":l>a&&(s="text-[var(--el-color-warning-light-3)]"),f("span",{class:s},[l.toFixed(2)+t])},je=e=>{he.channel=e},Ue=async()=>{var e,a,l;await De(),delete he.id,he.name="".concat(null==(a=null==(e=be.value)?void 0:e.find(e=>"status_code"===e.id))?void 0:a.name," 【").concat(null==(l=ve.value[0])?void 0:l.name,"】"),pe.value=!0},De=async()=>{var e,a;me.value=!0;try{const l=await o({table:"domain",list:"True",search:re.value.id});ve.value=[],null==(e=l.data)||e.forEach(e=>{ve.value.push({name:"http://"+e.name,id:e.id}),ve.value.push({name:"https://"+e.name,id:e.id})}),he.url=null==(a=ve.value[0])?void 0:a.name}catch(l){n(l)}me.value=!1},ze=async()=>{const e=await d({loading:me,request:ee({sid:re.value.id,p:ye.p,row:ye.limit}),data:{data:[Array,ue],page:r(ye),row:String}});ye.limit=Number(e.row)},Ie=async()=>{if("ltd"!==ie.value.authType&&"node"===he.address)return i.error("多节点测试为企业版专享功能，请升级为企业版后使用"),!1;await ce.value.validate();let e={...he,channel:Array.isArray(he.channel)?he.channel:he.channel.join(","),[he.method]:["delay","keyword"].includes(he.method)?he.methodData:1};delete e.methodData;const a=he.id?ae:le,l=await d({loading:"正在提交,请稍候...",request:a(e),data:{status:Boolean,msg:String}});l.status?(i.success(l.msg),ze()):i.msg({customClass:"el-error-html-message",dangerouslyUseHTMLString:!0,message:l.msg,showClose:!0,type:"error",duration:5e3}),Se()},qe=async e=>{await c({title:"删除日志【".concat(e.id,"】"),content:"删除后，该条日志将永久删除，是否继续操作？"});(await d({loading:"正在删除，请稍后...",request:de({id:e.id}),message:!0})).status&&Fe()},Ae=async e=>{let a=i.load("正在获取日志，请稍候...");try{we.pid=e.id,we.url=e.url,we.p=1,Fe(e=>{if(!e.data.length)return i.success("暂无日志");xe.value=!0})}catch(l){}finally{a.close()}},Fe=async e=>{const a=await d({request:te({pid:we.pid,p:we.p}),data:{data:[Array,Ve],"page.page":r(we)}});e&&e(a)},Oe=async e=>{if(he.address="localhost","node"===e){await Re()&&(he.address="node")}},Ee=e=>{g(()=>{var a,l;ce.value.clearValidate("methodData"),he.methodData="status_code"===e||"size"===e?"1":"",he.name="".concat(null==(l=null==(a=be.value)?void 0:a.find(a=>a.id===e))?void 0:l.name," 【").concat(he.url,"】")})},Re=async()=>{try{const{data:e}=await u({sName:"bt_boce"});return!!e.status||(e.endtime<0?J({disablePro:!0,sourceId:182}):await K({name:"bt_boce",softData:e}),!1)}catch(e){}},Se=()=>{pe.value=!1,ce.value.resetFields(),ce.value.clearValidate()},Te=async e=>{await c({title:"".concat(e.status?"停用拨测告警":"启用拨测告警"),content:"".concat(e.status?"停用后,检测到问题时将不会发送告警通知，是否继续？":"启用后,检测到问题时将会发送告警通知，是否继续？"),icon:"warning-filled"});(await d({loading:"正在设置，请稍后...",request:ae({id:e.id,status:e.status?0:1}),message:!0})).status&&ze()},He=e=>{var a;he.name="".concat(null==(a=be.value[0])?void 0:a.name," 【").concat(e,"】")},Pe=w([{label:"任务名称",prop:"name",showOverflowTooltip:!0},{label:"监控频率",render:e=>"".concat(e.cycle,"分钟")},{label:"触发条件",prop:"trigger_condition",showOverflowTooltip:!0},{label:"最后执行时间",width:148,render:e=>m(e.last_run_time)||"--"},{label:"状态\t",prop:"method",width:54,render:e=>f(x,{modelValue:!!e.status,size:"small",onChange:()=>Te(e)},null)},$([{onClick:async e=>{let a=i.load("正在执行，请稍候...");try{const a=await oe({id:e.id});a.status?(ge.value=!0,fe.value=a.data,ze()):i.request(a)}catch(l){n(l)}finally{a.close()}},title:"执行"},{onClick:e=>{pe.value=!0,Object.keys(he).forEach(a=>{var l;switch(a){case"method":he.method=e.status_code?"status_code":e.size?"size":e.delay?"delay":"keyword";break;case"methodData":he.methodData=e.delay||e.size||e.keyword||e.status_code;break;case"channel":he.channel=null==(l=e.channel)?void 0:l.split(",");break;default:he[a]=e[a]}}),he.id=e.id},title:"编辑"},{onClick:Ae,title:"日志"},{onClick:async e=>{(await d({loading:"正在删除，请稍后...",request:ne({id:e.id,action:"del"}),message:!0})).status&&ze()},title:"删除"}])]),Be=w([{label:"ID",prop:"id",width:80},{label:"平均耗时",prop:"avgrage"},{label:"最快",prop:"min_isp",render:e=>f("span",null,[e.min_isp,V("（"),e.min,V("ms）")])},{label:"最快",prop:"max_isp",render:e=>f("span",null,[e.max_isp,V("（"),e.max,V("ms）")])},{label:"执行时间",prop:"addtime",width:150,render:e=>m(e.addtime)||"--"},{label:"状态",prop:"status",width:75,render:e=>{const a=1==e.status;return f("span",{class:a?"text-primary":"text-danger"},[a?"执行成功":"执行错误"])}},$([{onClick:qe,title:"删除"}])]),Le={class:"p-[20px]"},Me={class:"flex items-center justify-center"},Ne={class:"flex items-center"},We={class:"inline-block text-secondary text-small mr-[4px]"},Ge={class:"ml-4px"},Je={key:0,class:"inline-block text-secondary text-small mr-[4px]"},Ke={key:1,class:"inline-block text-secondary text-small mr-[4px]"},Qe={class:"flex items-center"},Ze={class:"p-[20px]"},Xe={class:"p-[20px]"},Ye=v(k({__name:"index",setup(a,{expose:l}){const{siteInfo:s}=Y(),o=()=>{ze(),(async()=>{var e;me.value=!0;try{const a=await se();be.value=[],Object.keys(a.data).forEach(e=>{be.value.push({id:e,name:a.data[e]})}),be.value=null==(e=be.value)?void 0:e.filter(e=>"sensitive"!==e.id&&"similarity"!==e.id),he.method="status_code"}catch(a){}me.value=!1})()};return C(o),l({init:o}),(a,l)=>{const o=H,n=X,d=p,r=Z,i=P,u=G,m=B,c=L,v=t,b=M,_=h,g=N,w=Q,x=W,k=y,C=e,J=j("bt-loading");return U(),D(C,null,{"header-left":z(()=>[f(o,{type:"primary",onClick:I(Ue)},{default:z(()=>[...l[17]||(l[17]=[V(" 添加拨测告警 ",-1)])]),_:1},8,["onClick"])]),"header-right":z(()=>[f(n,{onRefresh:I(ze)},null,8,["onRefresh"])]),content:z(()=>[q(f(d,{column:I(Pe),data:I(ue)},null,8,["column","data"]),[[J,I(me)]])]),"footer-left":z(()=>[...l[18]||(l[18]=[])]),"footer-right":z(()=>[f(r,{page:I(ye).p,"onUpdate:page":l[0]||(l[0]=e=>I(ye).p=e),row:I(ye).limit,"onUpdate:row":l[1]||(l[1]=e=>I(ye).limit=e),total:I(ye).total,onChange:l[2]||(l[2]=e=>I(ze)())},null,8,["page","row","total"])]),popup:z(()=>[f(k,{title:"拨测告警",modelValue:I(pe),"onUpdate:modelValue":l[11]||(l[11]=e=>T(pe)?pe.value=e:null),area:54,showFooter:"",onCancel:I(Se),onConfirm:I(Ie)},{default:z(()=>[A("div",Le,[f(i,{type:"success",closable:!1},{title:z(()=>[...l[19]||(l[19]=[A("div",{class:"text-secondary text-small py-[8px]"},[A("div",null,[A("b",null,"本地测试"),V(" ：本机发送请求，可能导致测试结果不准确等结果 ")]),A("div",null,[A("b",null,"多节点测试"),V(" （推荐）：通过宝塔部署在全国的多个节点上来实现更全面的覆盖和测试 ")])],-1)])]),_:1}),f(x,{"label-position":"right",ref_key:"boceFormRef",ref:ce,model:I(he),class:"mt-[16px]",rules:I(ke)},{default:z(()=>[f(c,{label:"监控网站URL",prop:"url"},{default:z(()=>[f(m,{class:"!w-[32rem]",modelValue:I(he).url,"onUpdate:modelValue":l[3]||(l[3]=e=>I(he).url=e),onChange:I(He)},{default:z(()=>[(U(!0),F(E,null,O(I(ve),(e,a)=>(U(),D(u,{key:a,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),f(c,{label:"任务名称",prop:"name"},{default:z(()=>[f(v,{modelValue:I(he).name,"onUpdate:modelValue":l[4]||(l[4]=e=>I(he).name=e),width:"32rem"},null,8,["modelValue"])]),_:1}),f(c,{label:"检测节点",prop:"address"},{default:z(()=>[f(g,{class:"node-custom-radio",modelValue:I(he).address,"onUpdate:modelValue":l[5]||(l[5]=e=>I(he).address=e),onChange:I(Oe)},{default:z(()=>[f(b,{value:"localhost",disabled:!!I(he).id},{default:z(()=>[...l[20]||(l[20]=[V(" 本地测试 ",-1)])]),_:1},8,["disabled"]),f(b,{value:"node",disabled:!!I(he).id},{default:z(()=>[A("div",Me,[f(_,{icon:"icon-ltd",color:"#A88E5F",class:"mr-[4px]"}),l[21]||(l[21]=V(" 多节点测试 ",-1))])]),_:1},8,["disabled"])]),_:1},8,["modelValue","onChange"])]),_:1}),f(c,{label:"监控频率",prop:"cycle"},{default:z(()=>[f(v,{"text-type":"分钟",modelValue:I(he).cycle,"onUpdate:modelValue":l[6]||(l[6]=e=>I(he).cycle=e),type:"number",min:10},null,8,["modelValue"])]),_:1}),f(c,{label:"告警类型",prop:"method"},{default:z(()=>[f(m,{disabled:!!I(he).id,class:"!w-[32rem]",modelValue:I(he).method,"onUpdate:modelValue":l[7]||(l[7]=e=>I(he).method=e),onChange:I(Ee)},{default:z(()=>[(U(!0),F(E,null,O(I(be),(e,a)=>(U(),D(u,{key:a,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue","onChange"])]),_:1}),["delay","keyword"].includes(I(he).method)?(U(),D(c,{key:0,label:" ",prop:"methodData"},{default:z(()=>[A("div",Ne,[A("span",We,R("delay"===I(he).method?"平均响应延迟大于":"当响应内容不包含"),1),f(v,{disabled:!!I(he).id,modelValue:I(he).methodData,"onUpdate:modelValue":l[8]||(l[8]=e=>I(he).methodData=e),width:"18rem",class:"w-18rem",placeholder:"请输入关键词,分割"},null,8,["disabled","modelValue"]),A("span",Ge,R("delay"===I(he).method?"ms":"内容，触发告警"),1)])]),_:1})):S("",!0),["size","status_code"].includes(I(he).method)?(U(),D(c,{key:1,label:" "},{default:z(()=>["size"===I(he).method?(U(),F("span",Je," 网站大小变化告警 当网站响应内容大小发生变化达到20%时，将触发告警 ")):(U(),F("span",Ke," 当网站响应状态不为正常状态(200、300、302)，将触发告警 "))]),_:1})):S("",!0),f(c,{label:"告警次数",prop:"alarm_count"},{default:z(()=>[A("div",Qe,[l[22]||(l[22]=A("span",{class:"inline-block text-secondary text-small mr-[4px]"}," 每日最多触发 ",-1)),f(v,{"text-type":"次",width:"12rem",class:"w-12rem",type:"number",min:1,modelValue:I(he).alarm_count,"onUpdate:modelValue":l[9]||(l[9]=e=>I(he).alarm_count=e)},null,8,["modelValue"]),l[23]||(l[23]=A("span",{class:"ml-4px"},"告警",-1))])]),_:1}),f(c,{label:"告警方式",prop:"channel"},{default:z(()=>[f(w,{modelValue:I(he).channel,"onUpdate:modelValue":l[10]||(l[10]=e=>I(he).channel=e),limit:["sms"],needAll:!1,name:"channel",class:"!w-32rem",onChange:I(je)},null,8,["modelValue","onChange"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","onCancel","onConfirm"]),f(k,{title:"查看扫描拨测结果-"+I(s).name,modelValue:I(ge),"onUpdate:modelValue":l[12]||(l[12]=e=>T(ge)?ge.value=e:null),area:120},{default:z(()=>[A("div",Ze,[f(d,{column:I(_e),data:I(fe),"max-height":500},null,8,["column","data"])])]),_:1},8,["title","modelValue"]),f(k,{title:"查看任务记录【".concat(I(we).url,"】"),modelValue:I(xe),"onUpdate:modelValue":l[16]||(l[16]=e=>T(xe)?xe.value=e:null),area:82},{default:z(()=>[A("div",Xe,[f(C,null,{content:z(()=>[f(d,{column:I(Be),data:I(Ve)},null,8,["column","data"])]),"footer-right":z(()=>[f(r,{page:I(we).p,"onUpdate:page":l[13]||(l[13]=e=>I(we).p=e),row:I(ye).limit,"onUpdate:row":l[14]||(l[14]=e=>I(ye).limit=e),total:I(we).total,layout:"prev, pager, next, total",onChange:l[15]||(l[15]=e=>I(Fe)())},null,8,["page","row","total"])]),_:1})])]),_:1},8,["title","modelValue"])]),_:1})}}}),[["__scopeId","data-v-a52c699f"]]);export{Ye as default};
