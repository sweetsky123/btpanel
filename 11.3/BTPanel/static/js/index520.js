import{_ as e}from"./index124.js?v=1763689792";import{c as a,r as s,o as n,g as t,v as l,I as r,J as i,z as o,x as c,y as d,A as u,e as m,O as p,F as g,D as v,B as f,G as b,C as y,L as w,b1 as x,M as k,K as _,H as h,b2 as S,bz as E,bA as T}from"./base-lib.js?v=1763689792";import{u as j,p as C,V as M,d as H,f as L,e as I,b as z,ay as D,_ as O}from"./utils-lib.js?v=1763689792";import{j as J,p as P}from"./validator.js?v=1763689792";import{scanSingleSite as q}from"./site.js?v=1763689792";import{u as A}from"./useStore4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const F={id:"safeDetectList"},N={key:0},B={class:"progress-header"},G={class:"progress-header-cot"},K={class:"flex items-center"},R={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},V={key:1},Q={class:"progress-header-cot"},U={class:"scanning-progress-title"},W={class:"text-danger"},X={class:"scanning-progress-cont"},Y={class:"progress-header-cot"},Z={class:"progress-cont-list"},$={key:0},ee={class:"inline-grid grid-cols-4 w-full mt-20px"},ae=["onClick"],se={class:"progress_type"},ne={class:"flex-1"},te={key:0,class:"text-danger mr-4px"},le={key:1},re={key:2,class:"text-primary"},ie={key:3},oe={class:"progress_fold text-small flex items-center"},ce={class:"mr-4px"},de={class:"progress_item_body"},ue={class:"flex items-center justify-between w-full"},me={class:"flex items-center ml-12px"},pe=["innerHTML"],ge={class:"flex flex-col py-[1rem] px-[1.6rem] text-small progress_item_info"},ve={class:"flex items-center"},fe=["innerHTML"],be={class:"flex"},ye=["innerHTML"],we=O(a({__name:"index",setup(a,{expose:O}){const we=z(),{siteInfo:xe}=A(),{payment:ke}=j(),_e=s(!1),he=s([{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链检测"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),Se=s(0),Ee=s(""),Te=s(""),je=n({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"var(--el-color-primary)",progressConfig:{},statusTotal:{},result:{},progressStatus:{},active:{}});let Ce=null;const Me=n({0:{text:"警告",bg:"rgba(var(--el-color-warning-rgb), 0.1)",color:"var(--el-color-warning-light-3)"},1:{text:"低危",bg:"rgba(var(--el-color-warning-rgb), 0.1)",color:"var(--el-color-warning-light-3)"},2:{text:"中危",bg:"rgba(var(--el-color-warning-rgb), 0.2)",color:"var(--el-color-warning)"},3:{text:"高危",bg:"rgba(var(--el-color-danger-rgb), 0.1)",color:"var(--el-color-danger)"}}),He=n({title:"安全扫描-功能介绍",height:36,ps:"扫描服务器系统的漏洞，异常用户，已安装软件的安全问题并提供修复方案.",source:66,desc:["漏洞扫描","网站配置安全性","文件泄露","备份文件","木马程序"],tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/security-Introduction.png"]}),Le=e=>{"free"==ke.value.authType&&P({sourceId:65})},Ie=t(()=>je.scanStatus&&!je.isEnd?"正在扫描":"定期扫描网站，提升网站安全性"),ze=t(()=>je.scanStatus&&!je.isEnd?"".concat(Ee.value||""):je.time?"上次检测时间：".concat(je.time):"当前安全风险未知，请立即检测"),De=(e,a)=>{var s,n;if(a.data){const e=JSON.parse(a.data.replace(/'/g,'"'));if(e.hasOwnProperty("end")&&e.end){if((null==(n=null==(s=e.webinfo)?void 0:s.result)?void 0:n[e.type].length)>0?(je.progressConfig[e.type]=e.webinfo.result[e.type],je.statusTotal[e.type]=e.webinfo.result[e.type].length):je.statusTotal[e.type]=0,Ee.value=e.info,Se.value===he.value.length-1)return null==Ce||Ce.close(),Se.value=0,je.scanStatus=!1,void(je.isEnd=!0);let a=(new Date).getTime();Se.value++,null==Ce||Ce.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:a,name:xe.value.name,scan_list:[he.value[Se.value].name]})}else Ee.value=e.info,Te.value=e.type,e.is_error&&je.error++}},Oe=async()=>{if(je.scanStatus&&!je.isEnd||je.isEnd,je.scanStatus&&!je.isEnd)return await C({title:"取消扫描",content:"确定取消扫描吗?",icon:"warning"}),null==Ce||Ce.close(),Se.value=0,void Je();je.isEnd&&(await(null==Ce?void 0:Ce.close()),Se.value=0,await Je()),je.scanStatus=!0,Ce=D({route:"/ws_project",onMessage:De});let e=(new Date).getTime();null==Ce||Ce.send({"x-http-token":window.vite_public_request_token}),null==Ce||Ce.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:e,name:xe.value.name,scan_list:[he.value[Se.value].name]})},Je=()=>{je.scanStatus=!1,je.isEnd=!1,je.error=0,je.warn=0,je.time=0,je.progress=0,je.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],webshell:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},je.statusTotal={},je.result={},je.progressStatus={},je.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,webshell:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}},Pe=async()=>{if("ltd"===ke.value.authType){_e.value=!0;try{const e=await q({data:JSON.stringify({name:xe.value.name})});if(!e.status)return void we.request(e);je.isEnd=je.time||!1,je.time=M(e.data.time,"yyyy-MM-dd")}catch(e){}finally{_e.value=!1}}};return l(()=>{Pe(),Je()}),O({onRefresh:async()=>{Pe(),Je()}}),(a,s)=>{const n=H,t=h,l=S,j=L,C=I,M=E,z=T,D=e,O=r("bt-loading");return i((c(),d("div",F,["ltd"===o(ke).authType?(c(),d("div",N,[u("div",B,[u("div",G,[u("div",K,[o(je).scanStatus&&!o(je).isEnd?(c(),d("div",R,[s[0]||(s[0]=u("div",{class:"animate-spin absolute top-0 border-warning border-b-2 rounded-full h-full w-full"},null,-1)),m(n,{icon:"scanning-danger",size:60,color:"var(--el-color-warning)",class:"m-auto"})])):(c(),d("div",V,[o(je).warn||o(je).error?(c(),p(n,{key:0,icon:"scanning-danger",size:70,color:"var(--el-color-danger)"})):(c(),p(n,{key:1,icon:"scanning-"+(o(je).isEnd?"success":"danger"),size:72,color:o(je).isEnd?"var(--el-color-primary)":"var(--el-color-warning)"},null,8,["icon","color"]))]))])]),u("div",Q,[u("div",U,[o(je).isEnd?(c(),d(g,{key:1},[s[3]||(s[3]=v(" 检测完成 ",-1)),o(je).error>0||o(je).warn>0?(c(),d(g,{key:0},[s[2]||(s[2]=v(" ，共发现 ",-1)),o(je).error>0?(c(),d(g,{key:0},[u("span",W,f(o(je).error),1),s[1]||(s[1]=v(" 项风险 ",-1))],64)):b("",!0)],64)):b("",!0)],64)):(c(),d(g,{key:0},[v(f(o(Ie)),1)],64))]),u("div",X,f(o(ze)),1)]),u("div",Y,[m(t,{class:w({"warning-hover":o(je).scanStatus&&!o(je).isEnd}),type:o(je).scanStatus&&!o(je).isEnd?"warning":"primary",onClick:Oe,plain:!(!o(je).scanStatus||o(je).isEnd)},{default:y(()=>[v(f(o(je).scanStatus&&!o(je).isEnd?"取消扫描":o(je).isEnd?"重新检测":"立即检测"),1)]),_:1},8,["class","type","plain"]),o(je).isEnd?(c(),p(t,{key:0,type:"default",onClick:o(J)},{default:y(()=>[...s[4]||(s[4]=[v(" 立即修复 ",-1)])]),_:1},8,["onClick"])):b("",!0)])]),m(l,{class:"!mt-0 !mb-20px !bg-base"}),u("div",Z,[o(je).scanStatus||o(je).isEnd?b("",!0):(c(),d("div",$,[s[5]||(s[5]=u("div",{class:"font-bold text-medium text-secondary mb-[2rem]"},"支持网站以下安全扫描项:",-1)),u("div",ee,[(c(!0),d(g,null,x(o(he),(e,a)=>(c(),d("div",{key:a,class:"flex flex-col inline-block items-center mb-[20px]"},[m(j,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),v(" "+f(e.title),1)]))),128))])])),o(je).scanStatus||o(je).isEnd?(c(!0),d(g,{key:1},x(o(he),(e,a)=>(c(),d("div",{key:a,class:w([e.name+"_item "+(o(je).active[e.name]?"active":""),"progress_item"])},[u("div",{class:"progress_item_header",onClick:a=>(e=>{je.active[e]=!je.active[e]})(e.name)},[u("div",se,[u("span",null,f(e.title),1)]),u("div",ne,[o(je).statusTotal[e.name]?(c(),d("span",te," 发现"+f(o(je).statusTotal[e.name])+"项危险 ",1)):b("",!0),o(je).scanStatus&&o(Te)==e.name?(c(),d("span",le," 正在扫描... ")):b("",!0),o(je).scanStatus||o(je).statusTotal[e.name]?b("",!0):(c(),d("span",re," 无风险项 ")),o(je).scanStatus&&o(Te)!=e.name&&!o(je).statusTotal[e.name]?(c(),d("span",ie," 等待扫描 ")):b("",!0)]),u("div",oe,[u("span",ce,f(o(je).active[e.name]?"收起":"展开"),1),u("i",{class:w(o(je).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,ae),i(u("div",de,[m(z,{accordion:""},{default:y(()=>[(c(!0),d(g,null,x(o(je).progressConfig[e.name],(e,a)=>(c(),p(M,{key:a},{title:y(()=>[u("div",ue,[u("div",me,[u("span",{class:"text-small h-[2.2rem] flex items-center px-[8px] rounded-small mr-[1rem]",style:k({color:o(Me)[e.dangerous||0].color,backgroundColor:o(Me)[e.dangerous||0].bg})},f(o(Me)[e.dangerous||0].text),5),u("span",{innerHTML:e.name,class:"w-[46rem] truncate"},null,8,pe)]),m(C,{class:"mb-2px mr-4px",onClick:Le},{default:y(()=>[...s[6]||(s[6]=[v(" 详情 ",-1)])]),_:1})])]),default:y(()=>[u("div",ge,[u("div",ve,[s[7]||(s[7]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),u("span",{class:"leading-[1.6rem]",innerHTML:e.name},null,8,fe)]),m(l,{class:"!my-8px"}),u("div",be,[s[8]||(s[8]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),u("span",{innerHTML:e.repair},null,8,ye)])])]),_:2},1024))),128))]),_:2},1024)],512),[[_,o(je).active[e.name]]])],2))),128)):b("",!0)])])):(c(),p(D,{key:1,class:"h-full max-h-[62.5rem] overflow-auto",data:o(He)},null,8,["data"]))])),[[O,o(_e)]])}}}),[["__scopeId","data-v-17754910"]]);export{we as default};
