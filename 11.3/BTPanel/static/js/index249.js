import{x as e,aw as a,kc as t,e as s,l}from"./utils-lib.js?v=1763689792";import{c as r,r as n,o as i,aE as o,v as u,x as p,y as d,A as m,e as c,C as y,F as g,b1 as b,z as f,O as h,R as v,D as _,G as x,bp as j,am as k,an as w,al as C,aj as P}from"./base-lib.js?v=1763689792";import{createIpRules as O,removeIpRules as D,getIpFlowsAreasInfo as V,getIpFlowTrend as I}from"./site.js?v=1763689792";import{f as E}from"./useController5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useMethod5.js?v=1763689792";const S={class:"p-[2rem]"},q={class:"flex items-center justify-between mb-[8px]"},A={key:1},N=r({__name:"index",props:{compData:{default:()=>({})}},setup(r){var N,H;const J=r,{proxy:M}=j(),Q=n("PHPMOD"===(null==(H=null==(N=J.compData)?void 0:N.project_config)?void 0:H.type)),T=n(),U=n("today"),$=i([{label:"IP地址",prop:"ip",render:e=>o("span",{class:e.deny_status?"line-through text-disabled cursor-pointer":"text-primary cursor-pointer",on:{click:async()=>{try{await M.$confirm({title:"IP地址",message:"确定要".concat(e.deny_status?"解封":"封禁","当前ip吗？"),icon:"warning"});let a=null;if(e.deny_status)a=await D({data:JSON.stringify({address:e.ip})});else{let t={choose:"address",address:e.ip,domain:"",types:"drop",brief:"网站流量点击IP手动封禁"};a=await O({data:JSON.stringify(t)})}M.$message.request(a),X()}catch(a){}}}},e.ip)},{label:"归属地",render:e=>o("div",{class:"flex",style:{gap:"4px"}},[o("span",e.country),o("span",e.province),o("span",e.city)])},{label:"造成流量",prop:"flow",render:a=>o("span",e(a.flow))}]),z=n([{title:"今天",key:"today"},{title:"昨天",key:"yesterday"},{title:"近7天",key:"l7"},{title:"近30天",key:"l30"},{title:"近1小时",key:"h1"}]),B=n([]),F=n("流量趋势"),{BtECharts:G,getEChart:L,setOption:R,setQuickOption:K}=a({options:{xAxis:{type:"category",data:[]},yAxis:{type:"value",name:"单位:字节",axisLabel:{margin:2,formatter:function(e,a){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},grid:{show:!1,bottom:"20%",right:"5%"},series:[{data:[],type:"line"}]}}),W=async()=>{let e=[],a=[0,0,0,0,0,0,0],t=!1;try{const s=await I({site_name:J.compData.name,query_date:U.value});s&&(a=[]),s.forEach(s=>{"h1"!=U.value&&"today"!=U.value&&"yesterday"!=U.value||(t=!0),e.push(ae(String(s.time),t)),a.push(s.flow)})}catch(s){}K(e,a)},X=async()=>{try{const e=await V({site_name:J.compData.name,query_date:U.value});B.value=e}catch(e){}},Y=e=>{F.value=e,"流量趋势"===e?W():X()},Z=e=>{U.value=e,"流量趋势"===F.value?W():X()},ee=()=>{E({...J.compData,tabName:"flowQuota"},"limit")},ae=(e,a)=>{let t="";return a?(t=e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"),t):(12===e.length||10===e.length?t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)+" "+e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"):8===e.length&&(t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)),t)};return u(()=>{W()}),(e,a)=>{const r=k,n=w,i=C,o=P,u=s,j=l;return p(),d("div",S,[m("div",q,[c(n,{modelValue:f(U),"onUpdate:modelValue":a[0]||(a[0]=e=>v(U)?U.value=e:null),onChange:Z,class:"!w-[10rem]"},{default:y(()=>[(p(!0),d(g,null,b(f(z),(e,a)=>(p(),h(r,{key:a,label:e.title,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c(o,{modelValue:f(F),"onUpdate:modelValue":a[1]||(a[1]=e=>v(F)?F.value=e:null),onChange:Y},{default:y(()=>[c(i,{label:"流量趋势"}),c(i,{label:"IP TOP 10"})]),_:1},8,["modelValue"]),f(t)||f(Q)?x("",!0):(p(),h(u,{key:0,onClick:ee},{default:y(()=>[...a[2]||(a[2]=[_("流量限额>>",-1)])]),_:1}))]),m("div",null,["流量趋势"===f(F)?(p(),h(f(G),{key:0,ref_key:"totalCharts",ref:T,class:"h-[32rem]"},null,512)):x("",!0),"IP TOP 10"===f(F)?(p(),d("div",A,[c(j,{column:f($),data:f(B)},null,8,["column","data"])])):x("",!0)])])}}});export{N as default};
