import{Q as a,aK as e,j as s,e as t,P as l,l as o,ah as n,W as r,n as i,H as u}from"./utils-lib.js?v=1763689792";import{_ as d}from"./index109.js?v=1763689792";import{_ as m}from"./index118.js?v=1763689792";import{c as p,r as c,x as _,y as f,e as g,C as v,D as y,A as b,z as x,R as h,H as j,ap as w,o as C,W as k,g as S,w as V,v as U,I as D,O,G as R,L as q,F as A,b1 as H,J,am as L,an as T,B as N}from"./base-lib.js?v=1763689792";import{_ as z}from"./index137.js?v=1763689792";import{setAuthStatus as B,getModulesCloudServer as E,getMongodbConfig as F,getModulesList as I}from"./database.js?v=1763689792";import{a as M,f as P,g as W,u as G}from"./column.js?v=1763689792";import{g as K}from"./useStore2.js?v=1763689792";import{o as Q,e as X,a as Y,d as Z,f as $,i as aa,l as ea,g as sa,h as ta,j as la}from"./useMethod4.js?v=1763689792";import{e as oa}from"./validator.js?v=1763689792";import{_ as na}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1763689792";import{_ as ra}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./index107.js?v=1763689792";const ia={class:"p-20px"},ua={class:"flex items-center"},da=p({__name:"index",setup(t){const{refs:{safetyStatus:l}}=K(),o=c(!1),n=async()=>{try{await a({loading:"正在设置安全状态，请稍候...",request:B({data:JSON.stringify({status:l.value?"1":"0"})}),message:!0,success:a=>{a.status||(l.value=!l.value)}})}catch(s){e(s,"changeSafety")}};return(a,e)=>{const t=j,r=w,i=s;return _(),f("div",null,[g(t,{type:"default",onClick:e[0]||(e[0]=a=>o.value=!0)},{default:v(()=>[...e[3]||(e[3]=[y("安全认证",-1)])]),_:1}),g(i,{title:"安全认证",modelValue:x(o),"onUpdate:modelValue":e[2]||(e[2]=a=>h(o)?o.value=a:null),area:40},{default:v(()=>[b("div",ia,[b("div",ua,[e[4]||(e[4]=b("span",{class:"mr-8px"},"安全认证：",-1)),g(r,{modelValue:x(l),"onUpdate:modelValue":e[1]||(e[1]=a=>h(l)?l.value=a:null),width:36,onChange:n},null,8,["modelValue"])]),e[5]||(e[5]=b("ul",{class:"mt-8px leading-8 text-small list-disc ml-20px"},[b("li",null,"安全认证：开启后访问数据需要使用帐号和密码")],-1))])]),_:1},8,["modelValue"])])}}}),ma={class:"flex items-center"},pa={class:"w-[20rem] truncate inline-block"},ca=p({__name:"index",setup(e){const{refs:{isRefreshTable:s,isLoading:p,safetyStatus:w,envStatus:B,isHaveServer:ia},resetRefresh:ua,refreshTableList:ca}=K(),_a=C({total:0,page:1,row:10}),fa=c([]),ga=k([]),va=c(null),ya=c("all"),ba=c(""),xa=c(""),ha=c([]),ja=Z(),wa=S(()=>!B.value.setup&&!ia.value),Ca=()=>[M(),...$(aa),P({event:(a,e)=>ea(a,e)}),sa(ha.value,"mongodb"),W({table:"databases"}),G([{onClick:a=>(a=>{i({title:"【".concat(a.name,"】权限配置"),area:53,compData:a,showFooter:!0,component:()=>u(()=>import("./index139.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})})(a),title:"权限"},{onClick:a=>ta(a),title:"工具"},{onClick:a=>aa(a),title:"改密"},{onClick:a=>la(a),title:"删除"}])],ka=async()=>(await a({request:E({data:JSON.stringify({type:"mongodb"})},"mongodb"),data:[Array,ha]}),ha.value.length||(ia.value=!1),ha.value),Sa=async()=>{let e={p:_a.page,limit:_a.row,tables:"databases",search:ba.value,sid:"all"===ya.value?"":ya.value};""===e.sid&&delete e.sid,await a({loading:p,request:I({data:JSON.stringify(e)},"mongodb"),data:{data:[Array,fa],page:r(_a)}})},Va=async()=>{const e=await a({request:F(),data:{root:[String,xa],authorization:[String,a=>({status:"enabled"===a||!1})]}});w.value=e.status};return V(()=>s.value,async a=>{a&&await Sa(),ua()}),U(()=>(async()=>{Sa(),!wa.value&&Va(),await ka(),ga.value=Ca()})()),(a,e)=>{const s=z,r=j,i=t,u=L,c=T,C=l,k=o,S=n,V=m,U=d,B=D("bt-loading");return _(),f("div",null,[x(wa)?(_(),O(s,{key:0},{content:v(()=>[g(ra,{type:"MongoDB"})]),_:1})):R("",!0),g(U,null,{"header-left":v(()=>[b("div",ma,[g(r,{type:"primary",onClick:e[0]||(e[0]=a=>x(Q)(ka))},{default:v(()=>[...e[7]||(e[7]=[y("添加数据库",-1)])]),_:1}),x(w)?(_(),O(r,{key:0,onClick:e[1]||(e[1]=a=>x(X)(x(xa),()=>Va()))},{default:v(()=>[...e[8]||(e[8]=[y("root密码",-1)])]),_:1})):R("",!0),g(r,{onClick:x(Y)},{default:v(()=>[...e[9]||(e[9]=[y("远程数据库",-1)])]),_:1},8,["onClick"]),g(da,{class:"mx-[10px]"}),g(na,{"comp-data":x(ha)},null,8,["comp-data"]),g(i,{onClick:e[2]||(e[2]=a=>x(oa)({name:"数据库",type:12})),icon:"desired",class:"ml-[12px]",iconClass:"text-medium"},{default:v(()=>[...e[10]||(e[10]=[y("需求反馈",-1)])]),_:1})])]),"header-right":v(()=>[g(c,{modelValue:x(ya),"onUpdate:modelValue":e[3]||(e[3]=a=>h(ya)?ya.value=a:null),onChange:x(ca),class:q(["!w-[14rem] mr-[8px]",{"custom-types-bg-green":"all"!==x(ya)}])},{default:v(()=>[g(u,{label:"全部",value:"all"}),(_(!0),f(A,null,H(x(ha),(a,e)=>(_(),O(u,{key:e,label:"".concat("all"!==x(ya)?"已选：":"").concat(a.ps),value:a.id},{default:v(()=>[b("span",pa,N(a.ps),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange","class"]),g(C,{class:"w-[26rem]",modelValue:x(ba),"onUpdate:modelValue":e[4]||(e[4]=a=>h(ba)?ba.value=a:null),onSearch:x(ca),placeholder:"请输入数据库名称/备注"},null,8,["modelValue","onSearch"])]),content:v(()=>[J(g(k,{ref_key:"mongoDbTableRef",ref:va,column:x(ga),data:x(fa)},null,8,["column","data"]),[[B,x(p)]])]),"footer-left":v(()=>[g(S,{options:x(ja),"table-ref":x(va)},null,8,["options","table-ref"])]),"footer-right":v(()=>[g(V,{total:x(_a).total,page:x(_a).page,"onUpdate:page":e[5]||(e[5]=a=>x(_a).page=a),row:x(_a).row,"onUpdate:row":e[6]||(e[6]=a=>x(_a).row=a),onChange:x(ca)},null,8,["total","page","row","onChange"])]),_:1})])}}});export{ca as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
