import{Q as t,bb as e,u as a,n as r,H as s,p as n,bR as i,M as c}from"./utils-lib.js?v=1763689792";import{modifyRedirect as u,removeRedirect as l,getRedirectFile as o,getFileBody as d,getRedirectList as m,createRedirect as v,getProjectDomain as p,setErrorRedirect as h,MulDelRedirect as y}from"./site.js?v=1763689792";import{s as g,j as f,r as w}from"./base-lib.js?v=1763689792";import{c as _}from"./column.js?v=1763689792";import{u as E,S as R}from"./useStore4.js?v=1763689792";const b=f("SITE-REDIRECT-STORE",()=>{const{siteType:a,siteInfo:r}=E();return{getDomainEvent:async r=>{try{const s=["php","html"].includes(a.value),{data:n}=await t({request:s?e(r):p(r,a.value)});return"proxy"===a.value?{data:n.data.domain_list,status:!0}:{data:Array.isArray(n)?n:n.data,status:!0}}catch(s){return{status:!1,msg:"获取域名失败"}}},changeStatusEvent:async e=>{try{const r=await t({loading:"正在修改，请稍后...",request:u(e,a.value),message:!0});return{status:r.status,msg:r.msg}}catch(r){return{status:!1,msg:"修改状态失败"}}},delRedirectEvent:async e=>{try{const r=await t({loading:"正在删除，请稍后...",request:l(e,a.value),message:!0});return{status:r.status,msg:r.msg}}catch(r){return{status:!1,msg:"删除重定向失败"}}},getRedirectFileEvent:async e=>{try{const r=["php","html","proxy"].includes(a.value),s=await t({loading:"正在获取内容，请稍候...",request:r?o(e,a.value):d(e)});return"php"===a.value||"html"===a.value?{data:{content:s.data[0].data,redirect_conf_file:s.data[1]},status:!0}:{data:{content:s.data.data,redirect_conf_file:e.path},status:!0}}catch(r){return{status:!1,msg:"获取配置文件失败"}}},getRedirectDataEvent:async e=>{try{const r=await t({request:m(e,a.value),data:Array});return{data:r,total:r.length,other:{}}}catch(r){return{data:[],total:0,other:{}}}},submitRedirectEvent:async(e,r)=>{try{const s=await t({loading:"正在提交，请稍后...",request:r?u(e,a.value):v(e,a.value),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{status:!1,msg:"添加重定向失败"}}},submitErrorRedirectEvent:async(e,r)=>{try{const s=await t({loading:"正在保存，请稍后...",request:r||"html"===a.value?u(e,a.value):h(e),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{status:!1,msg:"添加错误重定向失败"}}},isRefreshList:w(!1)}}),j=()=>g(b()),{plugin:x}=a(),{siteInfo:D,siteType:S,isBindExtranet:T}=E(),{saveFileEvent:I}=R(),{isRefreshList:L}=j(),{getDomainEvent:O,changeStatusEvent:U,delRedirectEvent:q,getRedirectDataEvent:A,getRedirectFileEvent:N,submitRedirectEvent:J,submitErrorRedirectEvent:F}=b(),M=w(!1),C=w(!1),P=w(""),V=w(""),k=w(!1),B=w(),H=w(!1),Q=w(),z=w(),G=[{content:"设置域名重定向后，该域名的404重定向将失效"},{content:"取消重定向时，由于浏览器会缓存重定向信息，在清除缓存前，浏览器仍会根据缓存自动重定向"}],K=[{content:"重定向类型：表示访问选择的“域名”或输入的“路径”时将会重定向到指定URL"},{content:"目标URL：可以填写你需要重定向到的站点，目标URL必须为可正常访问的URL，否则将返回错误"},{content:"重定向方式：使用301表示永久重定向，使用302表示临时重定向"},{content:"保留URI参数：表示重定向后访问的URL是否带有子路径或参数如设置访问http://b.com"},{content:"重定向到http://a.com 保留URI参数： http://b.com/1.html ---\x3e http://a.com/1.html"},{content:"不保留URI参数：http://b.com/1.html ---\x3e http://a.com"}],W=(t,e=S.value)=>{let a={...t,type:t.type?0:1,redirectdomain:JSON.stringify(t.redirectdomain)};return delete a.redirect_conf_file,"proxy"===e&&(a.site_name=D.value.name,delete a.sitename),a},X=async(t,e,a,r)=>{const{label:s,value:n}=r,c=new Map([["start","批量启用选中的规则后，配置的重定向域名/目录将会生效"],["stop","批量停用选中的规则后，配置的重定向域名/目录将会失效"],["delete","批量删除当前选中的规则后，配置的重定向域名/目录将会彻底失效"]]),l=async t=>{const e=new Map([["start",u],["stop",u],["delete",y]]),{redirectname:a}=t,r=e.get(n);switch(n){case"start":case"stop":if(r){const e=W({...t,type:"stop"===n?1:0});return await r(e,S.value)}case"delete":if(r)return await r({site_id:D.value.id,redirectnames:a},S.value)}};await t({title:"批量".concat(s),content:"".concat(c.get(n),"，是否继续操作？"),column:[{label:"规则名称",render:t=>{var e;return t.errorpage?"404错误页面":"domain"===t.domainorpath?null==(e=i(t.redirectdomain,"array",[]))?void 0:e.join("、"):t.redirectpath}},_()],onConfirm:async()=>(await e(l),L.value=!0,!1)})},Y=async t=>{try{const e=W(t),a=await U(e);return a.status&&(L.value=!0),a}catch(e){return{status:!1,msg:"修改状态失败"}}},Z=async(t,e=S.value)=>{var a;try{await n({title:"删除重定向【".concat("domain"===t.domainorpath?null==(a=i(t.redirectdomain,"array",[]))?void 0:a.join("、"):t.redirectpath,"】"),content:"删除选中的规则后，配置的重定向域名/目录将指向源地址，是否继续操作？",icon:"warning-filled",type:"calc"});const{name:r}=D.value,{redirectname:s}=t,c={proxy:{site_name:r,redirectname:s},default:{sitename:r,redirectname:s}},u=await q(c[e]||c.default);return u.status&&(L.value=!0),u}catch(r){return{status:!1,msg:"删除重定向失败"}}},$=async t=>{var e,a;try{C.value=!0;const r=["php","html"].includes(S.value);let s={};s=r?{sitename:D.value.name,redirectname:t.redirectname,webserver:x.value.webserver}:{path:t.redirect_conf_file};const n=await N(s);n.status?(M.value=!0,P.value=null==(e=n.data)?void 0:e.content,V.value=null==(a=n.data)?void 0:a.redirect_conf_file):(c.error(n.msg),M.value=!1),C.value=!1}catch(r){M.value=!1}},tt=async(t={data:P.value,encoding:"utf-8",path:V.value})=>await I(t),et=t=>{H.value=!!t,z.value=t||!1,r({title:"".concat(t?"编辑":"添加","重定向").concat(t?"【".concat(t.sitename,"】"):""),area:68,component:()=>s(()=>import("./add-redirect2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),btn:!0})},at=t=>{!t&&k.value&&(t=B.value),z.value=t||!1,r({title:"404重定向设置",area:42,component:()=>s(()=>import("./error-redirect.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{rowData:t,siteType:S.value,refresh:()=>L.value=!0},btn:!0})},rt=async()=>{var t;try{const{project_type:e,project_config:a}=D.value;T.value=!!(null==a?void 0:a.bind_extranet);["php","html","proxy","phpasync"].includes(e)&&(T.value=!0);const r=await(async(t=!1)=>{const e={sitename:D.value.name};try{const a=await A(e);return t&&c.success("刷新成功"),k.value=!1,B.value=null,Array.isArray(a.data)&&a.data.forEach(t=>{t.errorpage&&(k.value=!0,B.value=t)}),a}catch(a){return{data:[],total:0,other:{}}}})();return nt.value=r.data,{...r,data:(null==(t=r.data)?void 0:t.map((t,e)=>({...t,id:e+1})))||[]}}catch(e){}},st=async t=>{try{const e=(t=>{const{name:e}=D.value,{holdpath:a,type:r,redirectdomain:s}=t;let n={...t,sitename:e,holdpath:a?"1":"0",type:r?"1":"0",redirectdomain:JSON.stringify(s),redirectname:t.redirectname||(new Date).getTime()};return"proxy"===S.value&&(n.site_name=e,delete n.sitename),n})(t),a=await J(e,H.value);return a.status&&(L.value=!0),a.status}catch(e){return!1}},nt=w([]),it=async()=>{try{const t=(t=>{if(t)return{table:"domain",list:"True",search:D.value.id};const e={python:{data:JSON.stringify({name:D.value.name})},phpasync:{data:JSON.stringify({sitename:D.value.name})},proxy:{id:D.value.id,site_name:D.value.name},default:{data:JSON.stringify({project_name:D.value.name})}};return e[S.value]||e.default})(["php","html"].includes(S.value)),e=await O(t);if(H.value)Q.value=e.data;else{let t=nt.value.map(t=>t.redirectdomain).flat();Q.value=e.data.filter(e=>!t.includes(e.name))}return e}catch(t){return{status:!1,msg:"获取域名失败"}}},ct=async t=>{try{const e=(t=>{var e;const{name:a}=D.value;let r={...t,sitename:a,type:Number(t.type)};return r.redirectname=(null==(e=B.value)?void 0:e.redirectname)||(new Date).getTime(),"html"===S.value&&(r.domainorpath="path",r.holdpath=999,r.redirectpath=""),"/"===r.topath&&(r.tourl=""),r})(t),a=await F(e,k.value);return L.value=!0,a.status}catch(e){return!1}};export{at as a,P as b,C as c,M as d,et as e,Y as f,$ as g,G as h,rt as i,Z as j,X as k,st as l,it as m,Q as n,K as o,ct as p,z as r,tt as s,j as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
