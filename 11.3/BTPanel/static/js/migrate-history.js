import{an as a,V as e,Q as t,M as l,p as s,B as n,j as u,$ as i,_ as o}from"./utils-lib.js?v=1763689792";import{c as r,r as m,e as d,x as p,y as c,z as _,C as f,A as v,R as b,D as g,B as j,bP as y,bO as h,H as w}from"./base-lib.js?v=1763689792";import{_ as k}from"./index123.js?v=1763689792";import{ar as V,as as x,at as q,au as C}from"./config.js?v=1763689792";import{u as B}from"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const H={class:"p-2rem"},z={class:"p-[2rem]"},I={class:"p-[2rem]"},P={class:"flex justify-end mt-[1rem]"},R=o(r({__name:"migrate-history",setup(o){const r=m(!1),R=m(""),U=m(!1),A=m({}),D=m({}),M=async a=>{const e=await t({loading:"正在获取迁移日志，请稍后...",request:V({timestamp:D.value.timestamp})});R.value=e.data.data,a&&l.success("日志刷新成功")},O=()=>{n({value:"目标服务器信息：".concat(A.value.panel_info.panel_url,"\n登录账号：").concat(A.value.panel_info.username,"\n登录密码：").concat(A.value.panel_info.password)})},{BtTable:Q,refresh:T}=a({request:async()=>{const a=await t({loading:"正在获取迁移历史，请稍后...",request:x()});return{data:a.data,total:a.data.length}},columns:[{label:"迁移时间",render:a=>d("span",null,[e(a.timestamp)])},{label:"服务器IP",prop:"migrate_ip"},B([{title:"日志",onClick:a=>{r.value=!0,D.value=a,M()}},{title:"信息",onClick:a=>{U.value=!0,D.value=a,(async()=>{const{data:a}=await t({loading:"正在获取迁移详情，请稍后...",request:q({timestamp:D.value.timestamp})});A.value.name=a.data.task_info.task_name,A.value.ip=a.data.server_ip,A.value.user=a.data.ssh_user,A.value.pass=a.data.password,A.value.start_time=a.data.start_time,A.value.last_update=a.data.last_update,A.value.panel_info=a.data.task_info.panel_info})()}},{title:"删除",onClick:a=>{D.value=a,(async()=>{await s({title:"删除迁移历史",content:"是否删除迁移历史？",type:"calc"}),await t({loading:"正在删除迁移历史，请稍后...",request:C({timestamp:D.value.timestamp}),message:!0}),T()})()}}])]});return(a,e)=>{const t=k,l=u,s=y,n=h,o=w,m=i;return p(),c("div",H,[d(_(Q),{"max-height":400}),d(l,{modelValue:_(r),"onUpdate:modelValue":e[0]||(e[0]=a=>b(r)?r.value=a:null),area:54,title:"【".concat(_(D).migrate_ip,"】迁移日志")},{default:f(()=>[v("div",z,[d(t,{content:_(R),isHtml:!0,"full-screen":{title:"全屏查看服务日志",onRefresh:()=>M(!0)},class:"h-41rem"},null,8,["content","full-screen"])])]),_:1},8,["modelValue","title"]),d(l,{modelValue:_(U),"onUpdate:modelValue":e[1]||(e[1]=a=>b(U)?U.value=a:null),area:48,title:"详情信息"},{default:f(()=>[v("div",I,[d(n,{title:!1,column:1,size:"small",border:"",class:"table-descriptions"},{default:f(()=>[d(s,{label:"名称："},{default:f(()=>[g(j(_(A).name),1)]),_:1}),d(s,{label:"服务器："},{default:f(()=>{var a;return[g(j((null==(a=_(A).panel_info)?void 0:a.panel_url)||"--"),1)]}),_:1}),d(s,{label:"用户："},{default:f(()=>{var a;return[g(j((null==(a=_(A).panel_info)?void 0:a.username)||"--"),1)]}),_:1}),d(s,{label:"密码："},{default:f(()=>{var a;return[g(j((null==(a=_(A).panel_info)?void 0:a.password)||"--"),1)]}),_:1}),d(s,{label:"开始时间："},{default:f(()=>[g(j(_(A).start_time),1)]),_:1}),d(s,{label:"最后更新时间："},{default:f(()=>[g(j(_(A).last_update),1)]),_:1})]),_:1}),v("div",P,[d(o,{type:"default",onClick:O},{default:f(()=>[...e[2]||(e[2]=[g("复制服务器信息",-1)])]),_:1})]),d(m,{options:[{content:"迁移进度请在新服务器中的[面板设置] - [备份还原]中查看"}],class:"mt-[1rem]"})])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0ccb0b48"]]);export{R as default};
