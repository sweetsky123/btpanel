import{u as e,an as a,f2 as t,ao as l,ag as s,P as r,Q as n,n as o,H as i,p as u,M as c,ax as m,aC as d,_ as p}from"./utils-lib.js?v=1763689792";import{c as y,x as g,O as v,C as f,e as h,D as _,z as w,H as b,s as x,I as V,y as S,A as C,G as k,J as L,M as A,ap as j,aT as D,V as W,ba as O,r as T,v as E,R,B as P,N as M}from"./base-lib.js?v=1763689792";import{L as z,q as H}from"./useStore7.js?v=1763689792";import{u as I,A as N}from"./index350.js?v=1763689792";import{_ as J}from"./index109.js?v=1763689792";import{L as U,u as q,d as B,a as F}from"./useController10.js?v=1763689792";import{_ as Y}from"./index130.js?v=1763689792";import{_ as K}from"./index123.js?v=1763689792";import{p as G}from"./validator.js?v=1763689792";import{o as Q}from"./column.js?v=1763689792";import{z as $,A as X}from"./firewall.js?v=1763689792";const Z=y({__name:"index",setup(s,{expose:r}){e();const n=U(),{getOperateLog:o,outLogs:i}=n,{isRefreshList:u}=q(),{BtTable:c,BtPage:m,BtSearch:d,BtRefresh:p,refresh:y}=a({request:e=>{const{search:a,...t}=e;return o({keywords:a,...t,stype:"网站管理"})},columns:[{label:"用户",prop:"username",width:180},{label:"操作类型",prop:"type",width:100},{label:"详情",render:function(e){const a=(new DOMParser).parseFromString(e.log,"text/html");return h("span",{innerHTML:t(a.body.innerHTML)},null)}},{label:"操作时间",width:150,prop:"addtime",align:"right"}],extension:[l(u)]});return r({init:y}),(e,a)=>{const t=b,l=J;return g(),v(l,null,{"header-left":f(()=>[h(t,{onClick:w(i)},{default:f(()=>[...a[0]||(a[0]=[_("导出日志",-1)])]),_:1},8,["onClick"])]),"header-right":f(()=>[h(w(d),{class:"mr-1rem !w-[24rem]",placeholder:"请输入搜索关键字"}),h(w(p))]),content:f(()=>[h(w(c))]),"footer-right":f(()=>[h(w(m))]),_:1})}}}),ee={class:"flex flex-col"},ae={class:"flex items-center justify-end mb-[12px]"},te={class:"flex justify-between w-full flex-wrap"},le={class:"flex items-center text-small"},se={class:"pl-[1rem] mr-[8px]"},re={class:"flex items-center mt-4px"},ne={class:"ml-1rem"},oe=y({__name:"index",setup(a,{expose:t}){const{mainHeight:l}=e(),n=U(),{logParams:o,logMsg:i,preLoading:u}=x(n),c=[{label:"运行日志",value:"access"},{label:"异常日志",value:"error"}];return t({init:()=>Je("WebLogs")}),(e,a)=>{const t=b,n=j,m=D,d=W,p=s,y=O,x=r,T=Y,E=V("bt-loading");return g(),S("div",ee,[C("div",ae,[C("div",te,[C("div",le,[h(t,{type:"default",onClick:w(Oe)},{default:f(()=>[...a[6]||(a[6]=[_(" 清理日志 ",-1)])]),_:1},8,["onClick"]),h(t,{type:"default",class:"!mr-[8px]",onClick:w(Te)},{default:f(()=>[...a[7]||(a[7]=[_(" 导出日志 ",-1)])]),_:1},8,["onClick"]),h(n,{modelValue:w(o).keywordSwitch,"onUpdate:modelValue":a[0]||(a[0]=e=>w(o).keywordSwitch=e),width:36,onChange:w(Pe)},null,8,["modelValue","onChange"]),C("span",se,[h(m,{content:"点击开启日志关键词告警",placement:"top"},{default:f(()=>[...a[8]||(a[8]=[C("span",null,[C("span",{class:"lt-xl:hidden"},"关键词"),_("告警 ")],-1)])]),_:1}),C("span",{class:"cursor-pointer text-primary",onClick:a[1]||(a[1]=(...e)=>w(Re)&&w(Re)(...e))}," [配置] ")]),"access"===w(o).typeValue?(g(),v(d,{key:0,modelValue:w(o).ipArea,"onUpdate:modelValue":a[2]||(a[2]=e=>w(o).ipArea=e),class:"pr-[2rem]",onChange:w(Me)},{default:f(()=>[...a[9]||(a[9]=[C("div",{class:"flex items-center"},[C("span",{class:"text-small"},"显示IP归属地"),C("i",{class:"svgtofont-icon-ltd text-ltd !text-extraLarge"})],-1)])]),_:1},8,["modelValue","onChange"])):k("",!0)]),C("div",re,[h(p,{type:"button",size:"default",class:"mr-1rem",modelValue:w(o).typeValue,"onUpdate:modelValue":a[3]||(a[3]=e=>w(o).typeValue=e),onChange:w(Ee),options:c},null,8,["modelValue","onChange"]),h(y,{modelValue:w(o).timeValue,"onUpdate:modelValue":a[4]||(a[4]=e=>w(o).timeValue=e),format:"YYYY/MM/DD","value-format":"x",onChange:w(Ee),type:"daterange","range-separator":"-","disabled-date":w(We),"start-placeholder":"开始",class:"!lt-xl:w-[12rem] !at-lg:w-[12rem] !at-xl:w-[12rem] !w-[20rem]","end-placeholder":"结束"},null,8,["modelValue","onChange","disabled-date"]),C("div",ne,[h(x,{class:"!lt-xl:w-[16rem] !w-[24rem]",modelValue:w(o).searchValue,"onUpdate:modelValue":a[5]||(a[5]=e=>w(o).searchValue=e),placeholder:"请输入搜索关键字",onSearch:w(Ee)},null,8,["modelValue","onSearch"])]),h(T,{class:"ml-1rem",onRefresh:w(Ee)},null,8,["onRefresh"])])])]),L(h(K,{content:w(i),isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-日志",onRefresh:()=>w(Je)("WebLogs")},style:A("height:"+(w(l)-292)+"px;min-height:400px;")},null,8,["content","fullScreen","style"]),[[E,w(u)]])])}}}),{selectedWebSite:ie,webTabActive:ue,outDataForm:ce,configData:me}=x(z()),{clearWebLogEvent:de,outWebLogEvent:pe,setKeyWordConfigEvent:ye,onConfirmKeyConfig:ge,getKeywordAlarmData:ve,delLogSourceEvent:fe,sendSourceConfirm:he,getLogSystemSite:_e,getSiteLogsData:we,logSystemConfirm:be}=U(),{logParams:xe,isRefreshLogSystem:Ve,isRefreshList:Se,logSystemList:Ce}=q(),{payment:ke}=e(),{isRefreshList:Le,routeData:Ae}=I(),je=[{label:"网站日志",name:"WebLogs",lazy:!0,render:()=>h(oe,null,null)},{label:"操作日志",name:"OperateLog",lazy:!0,render:()=>h(Z,null,null)},{label:"web日志分析",name:"WebLogAnalysis",lazy:!0,render:()=>h(N,null,null)}],De=T([]),We=e=>e.getTime()>Date.now(),Oe=()=>{o({title:"清理【"+ie.value+"】网站日志",area:44,component:()=>i(()=>import("./index348.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{tips:"清理相关日志可能会导致故障排查困难，请谨慎操作",type:"website",clearEvent:async(e,a)=>{const t=B(e),l=await de(t,a);return Ee(),l.status}},showFooter:!0})},Te=()=>{ce.value.type=z().getType("website"),me.value={type:"website"},o({title:"导出日志",area:44,component:()=>i(()=>import("./index303.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:{type:"website"}})},Ee=()=>{const e=(()=>{let e={ip_area:xe.value.ipArea?1:0,siteName:ie.value,search:xe.value.searchValue};return xe.value.timeValue&&(xe.value.timeValue[0]=new Date(xe.value.timeValue[0]).setHours(0,0,0,0),xe.value.timeValue[1]=new Date(xe.value.timeValue[1]).setHours(23,59,59,0),e.time_search=JSON.stringify([xe.value.timeValue[0]/1e3,xe.value.timeValue[1]/1e3])),xe.value.searchValue||delete e.search,e})();we(e),"error"!==xe.value.typeValue&&ve()},Re=()=>{o({title:"关键字告警配置",area:62,component:()=>i(()=>import("./keyword-config.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Pe=async e=>{const{keywordConfig:a}=xe.value;if((!a.keys.length||!a.channel||!a.cycle)&&e)return xe.value.keywordSwitch=!e,void Re();const t={sitename:ie.value};e&&(t.cycle=xe.value.keywordConfig.cycle,t.keys=JSON.stringify(xe.value.keywordConfig.keys),t.channel=xe.value.keywordConfig.channel);const{status:l}=await ye(t);l&&(xe.value.keywordSwitch=e)},Me=e=>{if("ltd"!==ke.value.authType)return xe.value.ipArea=!e,G({sourceId:107});Ee()},ze=async(e,a,t)=>{try{await a();const t={cycle:e.value.cycle,channel:e.value.give.join(","),keys:JSON.stringify(e.value.keyword.split(","))},l=await ge(t);return ve(),l.status}catch(l){}},He=async e=>{await u({title:"删除【"+e.site_name+"】日志源",icon:"warning-filled",content:"是否删除【"+e.site_name+"】?"});const a={server_id:e.server.id,source_type:e.source_type,source_list:JSON.stringify([e.site_name])};await fe(a)},Ie=async e=>{var a;try{let t=Ce.value.length>0,l={server_data:JSON.stringify({ip:e.ip,port:e.port})};t?l.server_id=null==(a=Ce.value[0])?void 0:a.id:l.server_type="bt_log_server";const s=await be(l);return s.status&&_e(),s.status}catch(t){}},Ne=async e=>{try{const a={server_id:e.server_id,source_type:"site",source_list:JSON.stringify(e.site)},t=await he(a);return Ve.value=!0,t.status}catch(a){}},Je=e=>{"WebLogs"===e?Ee():"WebLogAnalysis"===e?(Le.value=!0,Ae.value.name=ie.value):Se.value=!0},Ue={class:"flex items-center mb-[20px]"},qe={key:0},Be={class:"flex items-center"},Fe={class:"mx-[0.4rem]"},Ye=p(y({__name:"index",setup(e){const{selectedWebSite:a,webTabActive:t}=x(z()),l=T(""),s=T(""),r=()=>{o({title:"日志服务系统",area:60,component:()=>i(()=>import("./index349.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})};return E(async()=>{await(async()=>{const{msg:e}=await n({loading:"正在获取网站列表，请稍后...",request:H(),data:{msg:Array}});return Array.isArray(e)?(ie.value=Array.isArray(e)&&e[0]||"",De.value=e.map(e=>({label:e,value:e})),e):(De.value=[],[])})(),(async()=>{await n({request:$(),data:{size:[String,l],log_path:[String,s]}})})(),"WebLogs"===t.value&&Ee()}),(e,o)=>{const i=m,p=b,y=d;return g(),S("div",null,[C("div",Ue,[o[10]||(o[10]=_(" 网站： ",-1)),h(i,{modelValue:w(a),"onUpdate:modelValue":o[0]||(o[0]=e=>R(a)?a.value=e:null),options:w(De),onChange:o[1]||(o[1]=e=>w(Je)(w(t))),placeholder:"请选择网站",class:"!w-[22rem]",filterable:""},null,8,["modelValue","options"]),"WebLogs"===w(t)?(g(),S("div",qe,[h(p,{class:"!ml-12px",onClick:r},{default:f(()=>[...o[6]||(o[6]=[_(" 日志服务系统 ",-1)])]),_:1})])):k("",!0),o[11]||(o[11]=C("div",{class:"bg-dark w-[1px] h-2rem mx-8"},null,-1)),C("div",Be,[o[7]||(o[7]=C("span",null,"Web日志：",-1)),C("span",{onClick:o[2]||(o[2]=e=>w(Q)({path:w(s)})),class:"bt-link"},[_(P(w(s)||"--")+" ",1),M(e.$slots,"default",{},void 0,!0)]),C("span",Fe,P(w(l)),1)]),h(p,{onClick:o[3]||(o[3]=e=>(async()=>{await u({icon:"question-filled",type:"calc",title:"清空Web日志",content:"清空Web日志后，网站访问数据将彻底删除，此操作不可逆，是否继续操作？"}),await n({loading:"正在清空Web日志，请稍后...",request:X(),data:[String,l]}),c.success("清空Web日志成功")})())},{default:f(()=>[...o[8]||(o[8]=[_("清空",-1)])]),_:1}),C("div",{class:"flex items-center ml-[16px]",onClick:o[4]||(o[4]=e=>w(F)())},[...o[9]||(o[9]=[C("i",{class:"svgtofont-desired text-medium"},null,-1),C("span",{class:"bt-link"},"需求反馈",-1)])])]),h(y,{type:"card",modelValue:w(t),"onUpdate:modelValue":o[5]||(o[5]=e=>R(t)?t.value=e:null),options:w(je)},null,8,["modelValue","options"])])}}}),[["__scopeId","data-v-ce1405e8"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{De as a,Ne as b,ze as c,He as d,Ke as i,Ie as s};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
