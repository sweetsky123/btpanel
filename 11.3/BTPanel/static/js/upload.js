import{c as e,aB as a,r as t,g as s,W as l,o,w as r,x as i,y as u,e as n,C as p,D as c,z as m,A as d,B as f,F as _,O as v,J as h,K as w,H as b,b4 as g,ax as x,b6 as y,ay as D,az as k}from"./base-lib.js?v=1763689792";import{bi as z,x as j,b as q}from"./utils-lib.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const C={class:"p-[2rem]"},O={class:"h-[40rem] border border-lighter mt-[1rem]"},E={class:"ml-[0.5rem]"},B={class:"mt-8px leading-8 text-small list-disc ml-2rem"},F=e({__name:"upload",props:{compData:{default:()=>({path:"",size:100,uploadData:()=>({multiple:!0,limit:1e3}),refreshEvent:()=>{}})}},setup(e,{expose:F}){const H=q(),I=e,A=a("popupSetFooter"),J=a("buttonText"),K=a("popupClose");let M=!0;const S=t(),T=t([]),W=s(()=>I.compData.uploadData.accept||l([".json"].join(","))),G=s(()=>I.compData.uploadData.multiple),L=s(()=>I.compData.uploadData.limit),N={"x-http-token":window.vite_public_request_token},P=z(),Q=window.location.protocol+"//"+window.location.host+"/files?action=upload",R=o({f_size:0,f_path:I.compData.path,f_name:"",f_start:0,request_time:P.request_time,request_token:P.request_token}),U=()=>{H.success("导入成功"),I.compData.refreshEvent&&I.compData.refreshEvent(T.value,K)},V=(e,a,t)=>{t.push(a),H.error("导入失败")},X=e=>{R.f_size=e.size,R.f_name=e.name,R.f_start=0},Y=(e,a)=>{const t=e.name.substring(e.name.lastIndexOf(".")+1),s=W.value;if(-1===s.indexOf(t))return!1;T.value=a.filter(e=>{let a=e.name.substring(e.name.lastIndexOf(".")+1);return-1!==s.indexOf(a)})||[]},Z=(e,a,t)=>{R.f_start=e.percent,T.value=t.map(t=>(t.uid===a.uid&&(t.percentage=e.percent),t))};return r(()=>T.value.length,e=>{if(0===e)return void A(!1);const a=["success","fail","ready"];for(let t=0;t<T.value.length;t++)if(!a.includes(T.value[t].status))return void A(!1);T.value.some(e=>"success"!==e.status)&&(J.value=M?"开始上传":"重新上传",A(!0))}),F({onConfirm:()=>{T.value.map(e=>{"success"!==e.status&&(e.status="ready")}),M=!1,S.value.submit(),A(!1)}}),(e,a)=>{const t=b,s=g,l=x,o=y,r=D,z=k;return i(),u("div",C,[n(s,{class:"upload-demo",ref_key:"upload",ref:S,name:"blob",data:m(R),action:Q,headers:N,accept:m(W),limit:m(L),multiple:m(G),"show-file-list":!1,"auto-upload":!1,"file-list":m(T),"on-error":V,"on-success":U,"on-progress":Z,"on-change":Y,"before-upload":X},{default:p(()=>[n(t,{type:"primary"},{default:p(()=>[...a[0]||(a[0]=[c("选择文件",-1)])]),_:1})]),_:1},8,["data","accept","limit","multiple","file-list"]),d("div",O,[n(z,{height:"400",data:m(T)},{empty:p(()=>[n(r,{description:"只支持'".concat(m(W),"'文件格式导入")},null,8,["description"])]),default:p(()=>[n(l,{prop:"name","show-overflow-tooltip":!0,label:"名称"},{default:p(e=>[a[1]||(a[1]=d("i",{class:"text-supplement svgtofont-el-document"},null,-1)),d("span",E,f(e.row.name),1)]),_:1}),n(l,{prop:"name",label:"是否成功",width:"300"},{default:p(e=>["success"===e.row.status?(i(),u(_,{key:0},[c("上传成功！")],64)):"fail"===e.row.status?(i(),u(_,{key:1},[c("上传失败!")],64)):"ready"===e.row.status?(i(),u(_,{key:2},[c("等待上传")],64)):(i(),v(o,{key:3,percentage:Math.floor(e.row.percentage)},null,8,["percentage"]))]),_:1}),n(l,{width:"120",prop:"size",label:"大小"},{default:p(e=>[c(f(m(j)(e.row.size)),1)]),_:1}),n(l,{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},{default:p(e=>[h(n(t,{type:"text",size:"small",onClick:a=>{return t=e.row,void(T.value=T.value.filter(e=>e.name!==t.name));var t}},{default:p(()=>[...a[2]||(a[2]=[c("删除",-1)])]),_:1},8,["onClick"]),[[w,"ready"===e.row.status||"fail"===e.row.status]])]),_:1})]),_:1},8,["data"])]),d("ul",B,[d("li",null,"仅支持"+f(m(W)),1)])])}}});export{F as default};
