import{c as e,r as a,o as t,v as l,aG as s,x as r,O as o,C as n,J as i,K as c,z as d,A as u,e as m,B as p,L as v,Q as f,y as g,D as w,G as h,F as b,M as y,aA as x,ad as k,U as D,H as _,b2 as C,ab as V}from"./base-lib.js?v=1763689792";import{_ as z}from"./index110.js?v=1763689792";import{u as j,M as I,io as M,bL as E,t as L,r as U,e as q,ip as B,_ as H}from"./utils-lib.js?v=1763689792";import{_ as S}from"./bt_logo_new.js?v=1763689792";import{u as T,b as K,f as N}from"./useController.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const O={class:"flex !justify-center !w-full items-center"},J={class:"text-extraLarge text-default inline-block mr-2 font-bold mt-12x"},A={key:0,class:"absolute el-form-item__error"},G={class:"flex justify-end items-center text-base mt-[1rem]"},R={key:0,class:"view-con",style:{background:"var(--el-color-white)"}},W={class:"w-full mt-[1.5rem]"},$={class:"w-full mt-[1.5rem]"},F={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-primary",size:"default"},Q={key:3,class:"flex justify-end items-center text-small mt-[1rem] h-[1.68rem]"},X={key:0},Y={class:"more-bind"},P=H(e({__name:"tencent-bind-user",props:{compData:{default:()=>({})}},setup(e,{expose:H}){var P;const Z=e,{payment:ee}=j(),ae=a(!1),te=a("获取验证码"),le=t({username:"",password:"",code:""}),se=t({username:!1,password:!1,code:!1}),re=a(""),oe=a(0),ne=a(),ie=a(!1),ce=a(Z.compData.authData),de=a(1),ue=t({order:"",uin:""}),me=a({username:[{validator:(e,a,t)=>{var l,s;if((null==(l=Z.compData)?void 0:l.title)&&(ie.value=!1),/^1[3456789]\d{9}$/.test(a))t();else if(""===a)t(new Error("请输入宝塔官网账号"));else{if(null==(s=Z.compData)?void 0:s.title)return ie.value=!0,void t(new Error(" "));t(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,t)=>{a.length>=8?t():t(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,t)=>{ae.value||t(),6===a.length?t():t(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),pe=()=>{ne.value.validate(async e=>{e&&K({isCheck:ae,userInfo:le,userToken:re})})},ve=a(3);let fe=null,ge=null;const we=e=>{"string"==typeof e.data&&JSON.parse(e.data).code&&(async e=>{const a=JSON.parse(e.data);let t=I.load("正在绑定中......");try{const{data:e}=await M({...a,client:1});e.success||e.status?(window.removeEventListener("message",we),N(Z.compData.redirect)):(t.close(),I.error(e.res||String(e.msg)),ge.parent.postMessage({msg:e.res||e.msg,success:!1},"*"))}catch(l){null==t||t.close()}})(e)},he=async()=>{if(ue.order){const e={client:1,order_no:ue.order,uin:ue.uin},a=await B(e);a.status&&(a.data.success||a.data.status)?be(a.data.data||a.data.res):I.error(a.data.res||a.data.msg||a.data.data)}else ue.uin?I.error("请输入订单号"):I.error("请输入腾讯云账号ID")},be=e=>{const a=(window.screen.width-600)/2,t=(window.screen.height-800)/2;window.removeEventListener("message",we),window.addEventListener("message",we),ge&&ge.close(),ge=window.open(e,"popup","width=600,height=800,left=".concat(a,",top=").concat(t,",noopener,noreferrer")),ge||I.error("授权弹窗被浏览器阻止，请允许弹窗以继续操作。")},ye=async()=>{var e;if(Ce.value)return void he();let a=I.load("正在绑定中......");try{ve.value=3,fe&&clearInterval(fe);const{data:t}=await M({client:1});if(t.status||t.success)window.location.href=Z.compData.redirect||"/";else{a.close();const l=t.msg||t.res,s=document.querySelector(".location-con");let r=16;if(s){const e=s.getBoundingClientRect();r=e.top+window.scrollY-50}I.msg({customClass:(null==(e=Z.compData)?void 0:e.title)?"customMsgDiv":"",type:"warning",dangerouslyUseHTMLString:!0,duration:3e3,offset:r,message:"".concat(l,'<div style="align-items:center;"><span style="display:inline-block;color:var(--el-color-danger);" class="loginErrorNum">').concat(ve.value,"</span>秒后切换到宝塔账号登录</div>")}),setTimeout(()=>{if(s){const e=s.getBoundingClientRect().left+window.scrollX,a=document.querySelector(".customMsgDiv");a&&(a.style.left="".concat(e+143,"px"),a.style.opacity="1")}},0),fe=setInterval(()=>{if(ve.value<=1)return clearInterval(fe),void De(1);ve.value-=1;const e=document.querySelector(".loginErrorNum");e&&(e.innerHTML="".concat(ve.value))},1e3)}}catch(t){null==a||a.close()}},xe=async()=>{if(!le.username||!le.password)return void I.error("请先输入手机号和密码");se.username=!0,se.password=!0,(e=>{oe.value&&clearInterval(oe.value);const a=()=>{if(--e<=0)return clearInterval(oe.value),te.value="获取验证码",void(se.code=!1);te.value="重新获取验证码(".concat(e,"s)")};a(),oe.value=setInterval(a,1e3),se.code=!0})(60);const e=await E({username:le.username,token:re.value});I.request(e)},ke=()=>{ne.value.clearValidate(),Me()},De=e=>{var a;de.value=e,(null==(a=Z.compData)?void 0:a.onChangeType)&&Z.compData.onChangeType(1===e?"bind":"other")},_e=a(!1),Ce=a(!1),Ve=async e=>{try{if(1===e)return void De(1);if(2===e)return void De(2);_e.value=1===ce.value.client&&1===ce.value.login,1===ce.value.client&&1===ce.value.login?De(2):1===ce.value.client&&0!==ce.value.login?(De(2),Ce.value=!0):De(1)}catch(a){De(1)}},ze=()=>{U.push("/"),ke()},{qrcodeLoading:je,openWechatLogin:Ie,onCancelWechat:Me}=T(null==(P=Z.compData)?void 0:P.redirect);return Ve(),H({onOpen:()=>{L(ne.value.$el,"username")},onCancel:ke}),l(()=>{var e;null==(e=ne.value)||e.clearValidate()}),s(()=>{Me()}),(a,t)=>{var l;const s=x,j=k,I=D,M=q,E=_,L=q,U=z,B=C,H=D,T=z,K=V;return r(),o(K,{ref_key:"bindUserInfo",ref:ne,size:"medium",rules:d(me),model:d(le),autocomplete:"off",class:v(["bind-user-info",{"bind-form":!!(null==(l=e.compData)?void 0:l.title)}])},{default:n(()=>{var a,l,x,k,D,_,C,V,z,q,K,N,P,Z,re;return[i(u("div",null,[m(j,{class:"text-center !mb-5 flex justify-center"},{default:n(()=>{var a;return[u("div",O,[u("h3",J,p((null==(a=e.compData)?void 0:a.title)||"切换宝塔官网账号"),1),m(s,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:n(()=>[...t[12]||(t[12]=[u("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(r(),o(j,{key:1,prop:"username",class:v({"!mb-[3rem]":!!(null==(a=e.compData)?void 0:a.title)})},{default:n(()=>{var a;return[m(I,{modelValue:d(le).username,"onUpdate:modelValue":t[0]||(t[0]=e=>d(le).username=e),clearable:"",required:"",class:"!leading-[4rem] !h-[4rem]",name:"username",autocomplete:"off",placeholder:"宝塔官网账号",disabled:d(se).username,onKeyup:t[1]||(t[1]=f(e=>pe(),["enter"]))},null,8,["modelValue","disabled"]),(null==(a=e.compData)?void 0:a.title)&&d(ie)?(r(),g("span",A,[t[14]||(t[14]=u("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),m(M,{class:"!text-small",href:"https://www.bt.cn/register"},{default:n(()=>[...t[13]||(t[13]=[w(" 免费注册 ",-1)])]),_:1})])):h("",!0)]}),_:1},8,["class"])),(r(),o(j,{key:2,prop:"password"},{default:n(()=>[m(I,{modelValue:d(le).password,"onUpdate:modelValue":t[2]||(t[2]=e=>d(le).password=e),clearable:"",required:"",type:"password",class:"!leading-[4rem] !h-[4rem]",name:"password",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:d(se).password,onKeyup:t[3]||(t[3]=f(e=>pe(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),i(m(j,{prop:"code"},{default:n(()=>[m(I,{modelValue:d(le).code,"onUpdate:modelValue":t[4]||(t[4]=e=>d(le).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",type:"text",onKeyup:t[5]||(t[5]=f(e=>pe(),["enter","native"]))},{append:n(()=>[m(E,{class:"relative top-0 rounded-none rounded-r-small",type:"primary",size:"default",disabled:d(se).code,plain:"",onClick:xe},{default:n(()=>[w(p(d(te)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[c,d(ae)]]),m(E,{class:"w-[100%] mt-[1.2rem]",type:"primary",size:"default",onClick:t[6]||(t[6]=e=>pe())},{default:n(()=>{var a,t;return[w(p((null==(a=e.compData)?void 0:a.btn)||((null==(t=e.compData)?void 0:t.title)?"绑定账号":"切换账号")),1)]}),_:1}),u("div",G,[d(ee).bindUser?h("",!0):(r(),g(b,{key:0},[m(L,{onClick:ze},{default:n(()=>[...t[15]||(t[15]=[w("暂不绑定",-1)])]),_:1}),m(U)],64)),m(L,{href:"https://www.bt.cn/register"},{default:n(()=>[...t[16]||(t[16]=[w("注册账号",-1)])]),_:1}),m(U),m(L,{href:"https://www.bt.cn/login.html?page=reset"},{default:n(()=>[...t[17]||(t[17]=[w("忘记密码",-1)])]),_:1}),m(U),m(L,{href:"https://www.bt.cn/bbs"},{default:n(()=>[...t[18]||(t[18]=[w("问题反馈",-1)])]),_:1})])],512),[[c,1===d(de)]]),i(u("div",null,[(null==(l=e.compData)?void 0:l.title)?h("",!0):(r(),g("div",{key:0,class:"view-con",style:y((null==(x=e.compData)?void 0:x.title)?"":"background:var(--el-color-white);")},[u("div",{class:"app-box",style:y((null==(k=e.compData)?void 0:k.title)?"":"background:var(--el-color-white);")},[...t[19]||(t[19]=[u("img",{alt:"",src:S},null,-1)])],4),t[21]||(t[21]=u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1)),u("div",{class:"app-box",style:y((null==(D=e.compData)?void 0:D.title)?"":"background:var(--el-color-white);")},[...t[20]||(t[20]=[u("div",{class:"tencent-icon"},null,-1)])],4)],4)),u("div",{class:v({"bg-light":null==(_=e.compData)?void 0:_.title,"rounded-base":null==(C=e.compData)?void 0:C.title}),style:y({border:(null==(V=e.compData)?void 0:V.title)?"1px solid var(--el-border-color)":"none","padding-top":(null==(z=e.compData)?void 0:z.title)?"2rem":"0"})},[(null==(q=e.compData)?void 0:q.title)?(r(),g("div",R,[...t[22]||(t[22]=[u("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[u("img",{alt:"",src:S})],-1),u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1),u("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[u("div",{class:"tencent-icon"})],-1)])])):h("",!0),d(Ce)?h("",!0):(r(),o(j,{key:1,class:v(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(K=e.compData)?void 0:K.title,"!pt-0":null==(N=e.compData)?void 0:N.title}])},{default:n(()=>[m(B),t[23]||(t[23]=u("h3",{class:"text-base w-full text-secondary inline-block font-bold"},"腾讯云用户专享特权：",-1)),t[24]||(t[24]=u("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 免费使用原本需要付费的功能： ")],-1)),t[25]||(t[25]=u("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] ml-[1.9rem] flex items-center location-con"},[u("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),w(" 异常监控推送 ")],-1)),t[26]||(t[26]=u("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1.5rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"])),d(Ce)?(r(),o(j,{key:2,class:v(["!mb-0 flex justify-center",{"p-[2.5rem]":null==(P=e.compData)?void 0:P.title,"!pt-0":null==(Z=e.compData)?void 0:Z.title}])},{default:n(()=>[m(B),t[27]||(t[27]=u("h3",{class:"text-base w-full text-secondary inline-block font-bold text-center"},"腾讯云账号绑定",-1)),u("div",W,[m(H,{modelValue:d(ue).uin,"onUpdate:modelValue":t[7]||(t[7]=e=>d(ue).uin=e),size:"large",clearable:"",name:"uin",autocomplete:"off",placeholder:"请输入腾讯云账号ID"},null,8,["modelValue"])]),u("div",$,[m(H,{modelValue:d(ue).order,"onUpdate:modelValue":t[8]||(t[8]=e=>d(ue).order=e),size:"large",clearable:"",name:"order",autocomplete:"off",placeholder:"请输入腾讯云市场订单号",onKeyup:f(he,["enter","native"])},null,8,["modelValue"])])]),_:1},8,["class"])):h("",!0),m(E,{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:ye},{default:n(()=>[w(p(d(_e)?"一键激活专享特权":"绑定腾讯云账号"),1)]),_:1}),u("div",F,[d(ee).bindUser?h("",!0):(r(),g(b,{key:0},[m(M,{onClick:ze},{default:n(()=>[...t[28]||(t[28]=[w("暂不绑定",-1)])]),_:1}),m(T)],64)),u("span",{class:"cursor-pointer hover:text-primaryDark",onClick:t[9]||(t[9]=e=>De(1))},"已有宝塔账号登录")]),(null==(re=e.compData)?void 0:re.title)?(r(),g("div",Q)):h("",!0)],6)],512),[[c,2===d(de)]]),1===d(de)?(r(),g("div",X,[t[31]||(t[31]=u("div",{class:"more-title"},[u("span",null,"更多绑定方式")],-1)),u("div",Y,[i(u("div",{class:"wechat-login-container",onClick:t[10]||(t[10]=e=>Ve(2))},[...t[29]||(t[29]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon tencent_ico"})],-1),u("div",{class:"wechat-text"},"腾讯云",-1)])],512),[[c,1===d(de)&&(d(_e)||d(Ce))]]),i(u("div",{class:v(["wechat-login-container",{"ml-[1.4rem]":d(_e)||d(Ce)}]),onClick:t[11]||(t[11]=(...e)=>d(Ie)&&d(Ie)(...e))},[...t[30]||(t[30]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon"},[u("svg",{t:"1749545795651",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9096",width:"20",height:"20"},[u("path",{d:"M391.95 175.27c-159.03 0-289.29 108.4-289.29 246.04 0 79.45 43.35 144.67 115.74 195.2l-28.93 87.05 101.12-50.74c36.19 7.19 65.22 14.54 101.33 14.54 9.08 0 18.09-0.45 27.01-1.16-5.64-19.37-8.92-39.61-8.92-60.62 0-126.32 108.54-228.89 245.97-228.89 9.37 0 18.64 0.69 27.86 1.71C658.8 261.87 534.2 175.27 391.95 175.27z m-93.97 195.31c-21.67 0-43.56-14.52-43.56-36.21 0-21.77 21.89-36.09 43.56-36.09s36.12 14.33 36.12 36.09c-0.02 21.69-14.45 36.21-36.12 36.21z m202.46 0c-21.69 0-43.45-14.52-43.45-36.21 0-21.77 21.76-36.09 43.45-36.09 21.79 0 36.21 14.33 36.21 36.09 0 21.69-14.43 36.21-36.21 36.21z m0 0",fill:"#3CB034","p-id":"9097"}),u("path",{d:"M920.01 602.12c0-115.59-115.74-209.86-245.72-209.86-137.64 0-246.05 94.27-246.05 209.86 0 115.84 108.41 209.92 246.05 209.92 28.81 0 57.85-7.25 86.79-14.51l79.36 43.44-21.76-72.3c58.06-43.53 101.33-101.3 101.33-166.55z m-325.5-36.14c-14.41 0-28.95-14.31-28.95-28.92 0-14.44 14.54-28.96 28.95-28.96 21.89 0 36.21 14.52 36.21 28.96 0 14.61-14.33 28.92-36.21 28.92z m159.13 0c-14.31 0-28.74-14.31-28.74-28.92 0-14.44 14.43-28.96 28.74-28.96 21.67 0 36.21 14.52 36.21 28.96 0 14.61-14.54 28.92-36.21 28.92z m0 0",fill:"#3CB034","p-id":"9098"})])])],-1),u("div",{class:"wechat-text"},"微信",-1)])],2),[[c,1===d(de)]])])])):h("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-b6522d56"]]);export{P as default};
