import{s as e,aE as a,g as l,r as t,e as s,c1 as u,c4 as o,c as n,o as r,aJ as i,v,x as c,y as p,C as m,A as d,z as h,F as b,b1 as y,O as w,G as _,D as g,R as f,N as x,J as k,K as L,am as T,an as V,ad as S,V as N,aA as A,ab as U,B as C,t as I,a8 as D,ax as E,az as j,H as B}from"./base-lib.js?v=1763689792";import{n as q,H as M,bg as P,M as R,k as H,ax as O,_ as z,u as F,b6 as W,q as G,L as J}from"./utils-lib.js?v=1763689792";import{j as Q,d as K,c as $,g as X,f as Y,F as Z,l as ee,m as ae,h as le,b as te,i as se,k as ue}from"./form-item.js?v=1763689792";import{F as oe,G as ne,H as re,I as ie,J as ve,K as ce,L as pe,M as me,N as de,O as he,P as be}from"./useController3.js?v=1763689792";import{C as ye,g as we}from"./index14.js?v=1763689792";import{f as _e,cT as ge,cU as fe,l as xe,p as ke}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index123.js?v=1763689792";import"./index109.js?v=1763689792";import"./index118.js?v=1763689792";import"./index130.js?v=1763689792";import"./index131.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const{shellOptions:Le}=e(ye()),Te=async e=>{q({title:"选择脚本",area:40,component:()=>M(()=>import("./index443.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{value:e.value.sBody,onConfirm:a=>{e.value.sBody=a.scriptText,e.value.version=a.args}},showFooter:!0})};(async()=>{try{const e=await(async()=>{try{const{data:e}=await oe({all_user:!0});return e.map(e=>({label:e,value:e}))||[]}catch(e){}})();Le.value=e}catch(e){}})();const{shellOptions:Ve,pythonEnvOptions:Se}=e(ye()),Ne=async e=>{q({title:"选择脚本",area:40,component:()=>M(()=>import("./index443.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{value:e.value.sBody,type:"python",onConfirm:a=>{e.value.sBody=a.scriptText,e.value.version=a.args}},showFooter:!0})},Ae=()=>{q({isAsync:!0,title:"Python环境管理",area:105,component:()=>M(()=>import("./index395.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Ue()}})},Ue=async()=>{try{const e=await(async()=>{const{data:e}=await ne();return e.env_list.map(e=>({label:e.name,value:e.bin_path}))||[]})();Se.value=e}catch(e){}};Ue();const{rowData:Ce,typeInit:Ie}=e(ye()),De=l(()=>!!Ce.value.id),Ee=l(()=>!Ce.value.id&&!Ce.value),je=t([{label:"全部",value:"ALL"}]),Be=e=>{_e({type:"dir",path:e.value.log_cut_path,change:a=>{e.value.log_cut_path=a}})},qe=async e=>{Ie.value=!1,Ee.value&&(e.value.name="切割日志[所有]",e.value.save=180,e.value.log_cut_path||(e.value.log_cut_path="/www/wwwlogs"),(async e=>{try{const{data:a}=await re({type:"sites"});je.value=[{label:"全部",value:"ALL"}].concat(a.data.map(e=>({label:e.name,value:e.name})))||[],e.value.sName="ALL"}catch(a){}})(e))},{rowData:Me,typeInit:Pe}=e(ye()),Re=t([{label:"全部",value:"ALL"}]),He=l(()=>!!Me.value.id),Oe=l(()=>!Me.value.id&&!Me.value);l(()=>Me.value&&!Me.value.id);const ze=e=>{!He.value&&(async e=>{try{const{data:a}=await re({type:"sites"});Re.value=[{label:"全部",value:"ALL"}].concat(a.data.map(e=>({label:e.name,value:e.name})))||[],e.value.sName="ALL"}catch(a){}})(e),Pe.value=!1,Oe.value&&(e.value.name="木马查杀[全部]")},{rowData:Fe,typeInit:We}=e(ye()),Ge=t([]),Je=t([]);l(()=>!!Fe.value.id);const Qe=l(()=>!Fe.value.id&&!Fe.value),Ke=e=>{try{We.value=!1,Qe.value?(e.value.name="定期同步服务器时间[Asia/Shangehai]",e.value.sName="Asia/Shanghai",Je.value=["Asia","Shanghai"]):Je.value=e.value.sName.split("/"),(async()=>{try{const e=await ie();Ge.value=Object.keys(e.data).map(a=>({value:a,label:a,children:e.data[a].map(e=>({value:e,label:e}))}))}catch(e){}})()}catch(a){}},{rowData:$e}=e(ye());l(()=>!!$e.value.id);const Xe=l(()=>!$e.value.id&&!$e.value),Ye=async e=>{if(!P(e.value.urladdress))return R.error("请输入正确的url地址");{const l=R.load("正在测试，请稍候...");try{const a=await ve({url:e.value.urladdress});q({title:"测试URL结果",area:59,component:()=>M(()=>import("./index444.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{result:a.data}})}catch(a){}finally{l.close()}}},Ze=t([{paramName:"",paramValue:""}]),{rowData:ea}=e(ye());l(()=>!!ea.value.id);const aa=l(()=>!ea.value.id&&!ea.value),la=e=>{e.row.xh=e.rowIndex+1},ta=t(),sa=e=>{var a,l;e.length>1&&(null==(a=ta.value)||a.clearSelection(),null==(l=ta.value)||l.toggleRowSelection(e.pop()))},ua=()=>{Ze.value.push({paramName:"",paramValue:""})},oa=(e,a)=>{Ze.value.splice(a,1)},na=t([{label:"所有[所有网站]",value:"ALL"}]),{rowData:ra,typeInit:ia}=e(ye()),va=t(""),ca=t(""),pa=l(()=>!!ra.value.id),ma=l(()=>!ra.value.id&&!ra.value),da=e=>{ca.value="",va.value="",ia.value=!1,!pa.value&&(async e=>{try{const{data:a}=await re({type:"sites"});na.value=[{label:"所有[所有网站]",value:"ALL"}].concat(a.data.map(e=>({label:e.name+"[".concat(e.ps,"]"),value:e.name})))||[],ma.value&&(e.value.sName="ALL")}catch(a){}})(e),ma.value&&(e.value.name="网站启停[所有]"),ma.value||(va.value=e.value.special_time.split(",")[0],ca.value=e.value.special_time.split(",")[1],e.value.startTime=va.value,e.value.stopTime=ca.value)},ha=t(1),{rowData:ba,typeInit:ya}=e(ye()),wa=l(()=>!!ba.value.id),_a=l(()=>ba.value&&!ba.value.id),ga=[{value:"all",label:"所有日志"},{value:"system_log",label:"系统日志"},{value:"panel_log",label:"面板日志"},{value:"www_log",label:"网站日志"},{value:"usranalyse_log",label:"堡塔防入侵日志"},{value:"mysql_log",label:"MySQL日志"},{value:"Recycle",label:"回收站日志"},{value:"mail_log",label:"邮件日志"},{value:"php_session",label:"PHP会话日志"},{value:"total_log",label:"网站统计报表日志"},{value:"user_config",label:"用户配置日志"}],fa=e=>{_e({type:"dir",path:e.value.logText,change:a=>{e.value.logText=e.value.logText+(e.value.logText?"\n":"")+a,e.value.log_cut_path=e.value.logText.split("\n").filter(e=>""!==e).join(","),e.value.name=xa(e.value.logText,1)}})},xa=(e,a)=>{const l=e.split("\n").filter(e=>""!==e);return l.length<=a?"日志清理[".concat(l.join(","),"]"):"日志清理[".concat(l.slice(0,a).join(","),"...等").concat(l.length,"项]")},ka=e=>{ya.value=!1,wa.value||_a.value||(ha.value=1,e.value.radioType=1,e.value.name="日志清理"),(wa.value||_a.value)&&(e.value.clearLogType=e.value.sName.split(","),e.value.radioType=""!==e.value.log_cut_path?2:1,ha.value=e.value.radioType,e.value.logText=e.value.log_cut_path.split(",").join("\n"))},La={class:"flex items-center"},Ta={class:"defineClass"},Va={class:"flex items-center"},Sa={class:"flex items-center"},Na={class:"flex items-center"},Aa={class:"flex items-center"},Ua=z(n({__name:"alert-form-item",props:{isEdit:{type:Boolean,default:!1},showKeyword:{type:Boolean,default:!1},showNotice:{type:Boolean,default:!0},needAll:{type:Boolean,default:!1},showSecond:{type:Boolean,default:!1},labelWidth:{default:""},showStopWeb:{type:Boolean,default:!1},stopSite:{type:Boolean,default:!0}},emits:["crontab","siteWeb"],setup(a,{expose:l,emit:u}){const{rowData:o}=e(ye()),n=a,C=t("1"===o.value.stop_site||!1),I=u,D=t(),E=t(0),j=t(!1),B=t([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1},{type:"second-n",text:"N秒",showDay:!1,showHour:!1,showMinute:!1,showSecond:!0},{type:"sweek",text:"自定义",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1}]),q=r({where1:[{validator:(e,a,l)=>{"day-n"===Bl.value.type||"month"===Bl.value.type?Number.parseInt(a)>31||Number.parseInt(a)<1||!Number.isInteger(parseFloat(a))?l(new Error("请输入1-31的整数")):""===a?l(new Error("请输入天数")):l():l()},trigger:["blur","change"]}],hour:[{validator:(e,a,l)=>{"minute-n"!==Bl.value.type&&"hour"!==Bl.value.type&&"second-n"!==Bl.value.type||l(),Number.parseInt(a)>23||Number.parseInt(a)<0||!Number.isInteger(parseFloat(a))?l(new Error("请输入0-23的整数")):""===a?l(new Error("请输入小时")):"hour-n"===Bl.value.type&&0===Number.parseInt(a)?l(new Error("小时不能为0")):l()},trigger:["blur","change"]}],minute:[{validator:(e,a,l)=>{Number.parseInt(a)>59||Number.parseInt(a)<0||!Number.isInteger(parseFloat(a))?l(new Error("请输入0-59的整数")):""===a?l(new Error("请输入分钟")):"minute-n"===Bl.value.type&&(Number.parseInt(a)<1||!/^[1-9]\d*$/.test(a))?l(new Error("请输入1-59的整数")):l()},trigger:["blur","change"]}],second:[{validator:(e,a,l)=>{"second-n"===Bl.value.type?!Number.isInteger(parseFloat(a))||Number.parseInt(a)>59||Number.parseInt(a)<1?l(new Error("请输入1-59的整数")):""===a?l(new Error("请输入秒")):l():l()},trigger:["blur","change"]}],timeSet:[{validator:(e,a,l)=>{"sweek"!==Bl.value.type||a.length?l():l(new Error("请选择时间"))},trigger:"change"}],specialHour:[{validator:(e,a,l)=>{"sweek"!==Bl.value.type||a.length?l():l(new Error("请选择小时"))},trigger:"change"}],specialMinute:[{validator:(e,a,l)=>{"sweek"!==Bl.value.type||a.length?l():l(new Error("请选择分钟"))},trigger:"change"}]}),M=e=>{ql.value.notice_channel=e},P=e=>{D.value.clearValidate()},R=e=>{ql.value.notice=e,1===e&&(ql.value.notice_channel="all")},z=(e,a=!1)=>{n.isEdit||(ql.value.notice=0,a&&Wl()),Bl.value.type=e,E.value=B.value.findIndex(a=>a.type===e),"minute-n"===Bl.value.type&&(Bl.value.where1=Bl.value.minute),"hour-n"===Bl.value.type&&(Bl.value.where1=Bl.value.hour),"second-n"===Bl.value.type?(ql.value.flock=!1,j.value=!0):j.value=!1,D.value&&D.value.clearValidate(),I("crontab","custom"==e)};i(()=>{z(Bl.value.type)}),v(()=>{z(Bl.value.type,!0)});const F=e=>{I("siteWeb",e)};return l({validate:()=>{var e;return null==(e=D.value)?void 0:e.validate()},WebStopSite:C}),(e,l)=>{const t=T,u=V,o=S,n=H,r=N,i=A,v=O,I=fe,W=U;return c(),p("div",null,[s(W,{ref_key:"alertFormRef",ref:D,rules:h(q),"label-width":a.labelWidth,inline:!0,model:h(Bl),class:"demo-form-inline"},{default:m(()=>[s(o,{class:"!w-full"},{default:m(()=>[s(o,{label:"执行周期"},{default:m(()=>{var e,r,i,v;return[d("div",La,[s(o,{class:"el-form-item-item"},{default:m(()=>[s(u,{onChange:l[0]||(l[0]=e=>z(h(Bl).type,!0)),class:"!w-[8rem]",modelValue:h(Bl).type,"onUpdate:modelValue":l[1]||(l[1]=e=>h(Bl).type=e)},{default:m(()=>[(c(!0),p(b,null,y(h(B),(e,l)=>(c(),p(b,null,["second-n"!==e.type||a.showSecond?(c(),w(t,{key:l,label:e.text,value:e.type},null,8,["label","value"])):_("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1}),"sweek"==h(Bl).type?(c(),p(b,{key:0},[s(o,{class:"el-form-item-item"},{default:m(()=>[s(u,{class:"!w-[8rem]",modelValue:h(Bl).timeType,"onUpdate:modelValue":l[2]||(l[2]=e=>h(Bl).timeType=e),onChange:P},{default:m(()=>[s(t,{label:"每天",value:"sday"}),s(t,{label:"每周",value:"sweek"}),s(t,{label:"每月",value:"smonth"})]),_:1},8,["modelValue"])]),_:1}),"sweek"===h(Bl).timeType?(c(),w(o,{key:0,class:"el-form-item-item",prop:"timeSet"},{default:m(()=>[s(u,{class:"!w-[16rem]",modelValue:h(Bl).timeSet,"onUpdate:modelValue":l[3]||(l[3]=e=>h(Bl).timeSet=e),multiple:"","collapse-tags":""},{default:m(()=>[s(t,{label:"周一",value:"1"}),s(t,{label:"周二",value:"2"}),s(t,{label:"周三",value:"3"}),s(t,{label:"周四",value:"4"}),s(t,{label:"周五",value:"5"}),s(t,{label:"周六",value:"6"}),s(t,{label:"周日",value:"7"})]),_:1},8,["modelValue"])]),_:1})):_("",!0),"smonth"===h(Bl).timeType?(c(),w(o,{key:1,class:"el-form-item-item",prop:"timeSet"},{default:m(()=>[s(u,{class:"!w-[14rem] cycle-select",modelValue:h(Bl).timeSet,"onUpdate:modelValue":l[4]||(l[4]=e=>h(Bl).timeSet=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:m(()=>[(c(),p(b,null,y(30,(e,a)=>s(t,{key:e,label:e,value:"".concat(e)},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l[17]||(l[17]=d("span",{class:"el-input-group__append cycle-unit"},"号",-1))]),_:1})):_("",!0),s(o,{class:"el-form-item-item",prop:"specialHour"},{default:m(()=>[s(u,{class:"!w-[14rem] cycle-select",modelValue:h(Bl).specialHour,"onUpdate:modelValue":l[5]||(l[5]=e=>h(Bl).specialHour=e),multiple:"","collapse-tags":""},{default:m(()=>[(c(),p(b,null,y(24,(e,a)=>s(t,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l[18]||(l[18]=d("span",{class:"el-input-group__append cycle-unit"},"点",-1))]),_:1}),s(o,{class:"el-form-item-item",prop:"specialMinute"},{default:m(()=>[s(u,{class:"!w-[14rem] cycle-select",modelValue:h(Bl).specialMinute,"onUpdate:modelValue":l[6]||(l[6]=e=>h(Bl).specialMinute=e),multiple:"","collapse-tags":""},{default:m(()=>[(c(),p(b,null,y(60,(e,a)=>(c(),p(b,null,[a%5==0?(c(),w(t,{key:a,label:a,value:a},null,8,["label","value"])):_("",!0)],64))),64))]),_:1},8,["modelValue"]),l[19]||(l[19]=d("span",{class:"el-input-group__append cycle-unit"},"分",-1))]),_:1})],64)):(c(),p(b,{key:1},["week"==h(Bl).type?(c(),w(o,{key:0,class:"el-form-item-item"},{default:m(()=>[s(u,{class:"!w-[8rem]",modelValue:h(Bl).week,"onUpdate:modelValue":l[7]||(l[7]=e=>h(Bl).week=e)},{default:m(()=>[s(t,{label:"周一",value:"1"}),s(t,{label:"周二",value:"2"}),s(t,{label:"周三",value:"3"}),s(t,{label:"周四",value:"4"}),s(t,{label:"周五",value:"5"}),s(t,{label:"周六",value:"6"}),s(t,{label:"周日",value:"7"})]),_:1},8,["modelValue"])]),_:1})):_("",!0),(null==(e=h(B)[h(E)])?void 0:e.showDay)?(c(),w(o,{key:1,class:"el-form-item-item",prop:"where1"},{default:m(()=>[s(n,{modelValue:h(Bl).where1,"onUpdate:modelValue":l[8]||(l[8]=e=>h(Bl).where1=e),min:1,width:"10rem",textType:"天",type:"number"},{append:m(()=>[...l[20]||(l[20]=[g(" 天 ",-1)])]),_:1},8,["modelValue"])]),_:1})):_("",!0),(null==(r=h(B)[h(E)])?void 0:r.showHour)?(c(),w(o,{key:2,class:"el-form-item-item",prop:"hour"},{default:m(()=>[s(n,{modelValue:h(Bl).hour,"onUpdate:modelValue":l[9]||(l[9]=e=>h(Bl).hour=e),width:"10rem",textType:"小时",max:"23",min:"0",type:"number"},{append:m(()=>[...l[21]||(l[21]=[g(" 小时 ",-1)])]),_:1},8,["modelValue"])]),_:1})):_("",!0),(null==(i=h(B)[h(E)])?void 0:i.showMinute)?(c(),w(o,{key:3,class:"el-form-item-item",prop:"minute"},{default:m(()=>{var e;return[(null==(e=h(B)[h(E)])?void 0:e.showMinute)?(c(),w(n,{key:0,modelValue:h(Bl).minute,"onUpdate:modelValue":l[10]||(l[10]=e=>h(Bl).minute=e),width:"10rem",max:"59",min:"0",type:"number"},{append:m(()=>[...l[22]||(l[22]=[g(" 分钟 ",-1)])]),_:1},8,["modelValue"])):_("",!0)]}),_:1})):_("",!0),(null==(v=h(B)[h(E)])?void 0:v.showSecond)?(c(),w(o,{key:4,class:"el-form-item-item",prop:"second"},{default:m(()=>{var e;return[(null==(e=h(B)[h(E)])?void 0:e.showSecond)?(c(),w(n,{key:0,modelValue:h(Bl).second,"onUpdate:modelValue":l[11]||(l[11]=e=>h(Bl).second=e),width:"10rem",max:"59",min:"0",type:"number"},{append:m(()=>[...l[23]||(l[23]=[g(" 秒 ",-1)])]),_:1},8,["modelValue"])):_("",!0)]}),_:1})):_("",!0)],64))])]}),_:1}),d("div",Ta,[s(o,{label:" ",class:"!mt-0 defineClass"},{default:m(()=>[d("div",Va,[s(r,{modelValue:h(ql).flock,"onUpdate:modelValue":l[12]||(l[12]=e=>h(ql).flock=e),disabled:h(j)},{default:m(()=>[...l[24]||(l[24]=[g(" 开启进程锁",-1)])]),_:1},8,["modelValue","disabled"]),s(i,{placement:"right-start",width:"440","popper-class":"white-tips-popover",trigger:"hover",content:""},{default:m(()=>[...l[25]||(l[25]=[d("div",{class:"p-12x"},[d("span",{class:"text-secondary"}," 在同一时间内只用一个进程在执行，若上一个进程未执行结束，下一次不执行 ")],-1),d("i",{slot:"reference",class:"el-icon-question text-warning ml-12x"},null,-1)])]),_:1})])]),_:1}),a.showStopWeb?(c(),w(o,{key:0,label:" ",class:"!mt-0 defineClass"},{default:m(()=>[d("div",Sa,[s(r,{modelValue:h(C),"onUpdate:modelValue":l[13]||(l[13]=e=>f(C)?C.value=e:null),onChange:F},{default:m(()=>[...l[26]||(l[26]=[g(" 网站停用时是否停止备份",-1)])]),_:1},8,["modelValue"]),s(i,{placement:"right-start",width:"220","popper-class":"white-tips-popover",trigger:"hover",content:""},{reference:m(()=>[...l[27]||(l[27]=[d("i",{class:"svgtofont-el-question-filled text-warning ml-[12px]"},null,-1)])]),default:m(()=>[l[28]||(l[28]=d("span",{class:"text-secondary"}," 该功能不支持反向代理和html项目 ",-1))]),_:1})])]),_:1})):_("",!0)])]),_:1}),x(e.$slots,"center",{},void 0,!0),a.showNotice?(c(),w(o,{key:0,label:"备份提醒",prop:"notice",class:"!mt-1.6rem"},{default:m(()=>[d("div",Na,[s(v,{class:"!w-[20rem]",modelValue:h(ql).notice,"onUpdate:modelValue":l[14]||(l[14]=e=>h(ql).notice=e),options:h(Al),onChange:R},null,8,["modelValue","options"]),1===h(ql).notice?(c(),w(o,{key:0,label:"消息通道"},{default:m(()=>[s(I,{modelValue:h(ql).notice_channel,"onUpdate:modelValue":l[15]||(l[15]=e=>h(ql).notice_channel=e),"is-show-api":!1,multiple:!1,"all-alarm":!0,onChange:M,class:"!w-16rem"},null,8,["modelValue"])]),_:1})):_("",!0),k(s(o,{label:"关键词匹配",class:"!mt-0"},{default:m(()=>[d("div",Aa,[s(i,{placement:"top-start",width:"290","popper-class":"white-tips-popover",trigger:"focus",content:""},{default:m(()=>[l[29]||(l[29]=d("div",{class:"p-[12px]"},[d("div",null,[g("1、在shell程序中不要"),d("span",{class:"text-danger"},"中断"),g("执行如（exit等）")]),d("div",null,[g("2、输出"),d("span",{class:"text-danger"},"关键词"),g("（建议5位且程序中不会出现）")]),d("div",null,[g("3、匹配到关键词"),d("span",{class:"text-danger"},"发送告警")])],-1)),s(n,{slot:"reference",class:"mr-[4px]",modelValue:h(ql).keyword,"onUpdate:modelValue":l[16]||(l[16]=e=>h(ql).keyword=e),disabled:a.isEdit,width:"16rem",placeholder:"请输入关键词",type:"text"},null,8,["modelValue","disabled"])]),_:1})])]),_:1},512),[[L,a.showKeyword&&1===h(ql).notice]])])]),_:1})):_("",!0),x(e.$slots,"bottom",{},void 0,!0)]),_:3},8,["rules","label-width","model"])])}}}),[["__scopeId","data-v-e5809429"]]),Ca={class:"flex items-center"},Ia={class:"text-small text-secondary flex items-center"},Da=n({__name:"file-split-item",props:{rowData:{default:()=>{}},isEnterprise:{type:Boolean,default:!1}},setup(e){const a=e,l=[{name:"不拆分",value:"0"},{name:"按文件大小拆分",value:"size"},{name:"按数量拆分",value:"num"}],u=t(a.rowData.split_type||"0"),o=t(Boolean(a.rowData.save_local)||!1),n=e=>{"num"==e?Ml.value.split_value=5:"size"==e&&(Ml.value.split_value=1024),Ml.value.split_type=e},r=e=>{Ml.value.save_local=Number(e)},i=e=>{Ml.value.split_value=Number(e.target.value)};return(a,t)=>{const v=T,x=V,k=H,L=S,A=N;return c(),p("div",null,[e.isEnterprise?_("",!0):(c(),w(L,{key:0,label:"文件拆分",class:"!mb-[14px]"},{default:m(()=>[d("div",Ca,[s(x,{modelValue:h(u),"onUpdate:modelValue":t[0]||(t[0]=e=>f(u)?u.value=e:null),class:"mr-[4px] !w-[13rem]",onChange:n},{default:m(()=>[(c(),p(b,null,y(l,e=>s(v,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),"0"!==h(u)?(c(),p("div",{key:0,onInput:i,class:"text-small flex items-center"},[s(k,{modelValue:h(Ml).split_value,"onUpdate:modelValue":t[1]||(t[1]=e=>h(Ml).split_value=e),type:"number",width:"14rem"},{append:m(()=>[g(C("num"==h(u)?"个":"MB"),1)]),_:1},8,["modelValue"])],32)):_("",!0),t[3]||(t[3]=d("span",{class:"text-secondary text-small leading-8 ml-8x"},"*为避免文件过大导致上传失败，可以选择按大小或数量拆分。仅文件超过 5GB 时支持拆分，小文件请忽略 ",-1))])]),_:1})),s(L,{label:"备份设置"},{default:m(()=>[d("div",Ia,[s(A,{modelValue:h(o),"onUpdate:modelValue":t[2]||(t[2]=e=>f(o)?o.value=e:null),class:"!mr-12x",onChange:r},{default:m(()=>[...t[4]||(t[4]=[g(" 同时保留本地备份（和云存储保留份数一致） ",-1)])]),_:1},8,["modelValue"])])]),_:1})])}}}),{panel:Ea}=F(),{backupPath:ja}=I(Ea.value),{rowData:Ba,typeInit:qa}=e(ye()),Ma=l(()=>!!Ba.value.id),Pa=l(()=>!Ba.value.id&&!Ba.value),Ra=t(ja.value),Ha=t([]),Oa=e=>{_e({type:"dir",path:e.value.sName,change:a=>{e.value.sName=a,e.value.name="备份目录[".concat(a,"]")}})},za=e=>{qa.value=!1,Pa.value&&(e.value.db_backup_path=Ra.value,e.value.save=3,e.value.sName="/www/wwwroot",e.value.name="备份目录[/www/wwwroot]",e.value.more="ALL"),(async e=>{var a,l,t;try{const{data:u}=await re({type:"sites"});Ha.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>s("div",{class:"flex items-center justify-between"},[s("span",null,[e.label]),s("span",{onClick:()=>{xe({name:e.value})},class:"float-right cursor-pointer text-small text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),Ha.value&&"localhost"===(null==(a=Ha.value[0])?void 0:a.value)||null==(l=Ha.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),Pa.value&&(e.value.backupTo=null==(t=Ha.value)?void 0:t[0].value)}catch(u){}})(e)},{panel:Fa}=F(),{backupPath:Wa}=I(Fa.value),{rowData:Ga,typeInit:Ja}=e(ye()),Qa=t([]),Ka=t([{label:"所有[所有网站]",value:"ALL"}]),$a=l(()=>!!Ga.value.id),Xa=l(()=>!Ga.value.id&&!Ga.value),Ya=e=>{try{return!("localhost"!==e.value.backupTo&&!Ml.value.save_local)}catch(a){}},Za=e=>{Ja.value=!1,Xa.value&&(e.value.name="备份网站[ 所有 ]",e.value.save=3,e.value.db_backup_path=Wa.value,e.value.more="ALL"),(async e=>{var a,l,t;try{const{data:u}=await re({type:"sites"});Qa.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>s("div",{class:"flex items-center justify-between"},[s("span",null,[e.label]),s("span",{onClick:()=>{xe({name:e.value})},class:"float-right cursor-pointer text-small text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),Qa.value&&"localhost"===(null==(a=Qa.value[0])?void 0:a.value)||null==(l=Qa.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),Xa.value&&(e.value.backupTo=null==(t=Qa.value)?void 0:t[0].value),Ka.value=[{label:"所有[所有网站]",value:"ALL"}].concat(u.data.map(e=>({label:e.name+"".concat(e.ps?"[".concat(e.ps,"]"):""),value:e.name})))||[],Xa.value&&(e.value.sName="ALL")}catch(u){}})(e)},el=e=>{_e({type:"dir",path:e.value.db_backup_path,change:a=>{e.value.db_backup_path=a}})},{panel:al}=F(),{backupPath:ll}=I(al.value),{rowData:tl,typeInit:sl}=e(ye()),ul=t([]),ol=t([{label:"所有[所有数据]",value:"ALL"}]),nl=t(!1),rl=t([]),il=l(()=>!!tl.value.id),vl=l(()=>!tl.value.id&&!tl.value),cl=[{value:"mysql",label:"MySQL"},{value:"mongodb",label:"MongoDB"},{value:"redis",label:"Redis"},{value:"pgsql",label:"PgSQL"}],pl=async e=>{var a;sl.value=!1,(async e=>{var a,l,t;try{const{data:u}=await re({type:"sites"});ul.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>s("div",{class:"flex items-center justify-between"},[s("span",null,[e.label]),s("span",{onClick:()=>{xe({name:e.value})},class:"float-right text-small text-danger cursor-pointer ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),ul.value&&"localhost"===(null==(a=ul.value[0])?void 0:a.value)||null==(l=ul.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),vl.value&&(e.value.backupTo=null==(t=ul.value)?void 0:t[0].value)}catch(u){}})(e),vl.value?(e.value.name="备份mysql数据库[ 所有 ]",e.value.db_type="mysql",e.value.backup_mode=0,e.value.sName="ALL",e.value.db_backup_path=ll.value,e.value.save=3,e.value.more="ALL",e.value.table_list="ALL",nl.value=!1,await ml("mysql"),e.value.table_list=rl.value[0].value):("mysql"===e.value.db_type&&(nl.value=!!(null==(a=tl.value)?void 0:a.backup_mode)),await ml(e.value.db_type),""===e.value.table_list?e.value.table_list="ALL":e.value.table_list)},ml=async e=>{var a,l;try{const t=await ce({db_type:e});ol.value=t.data.map(e=>({label:e.name+(e.ps?"[".concat(e.ps,"]"):""),value:e.name,table_list:e.table_list})),rl.value=null==(a=ol.value[0].table_list)?void 0:a.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})),null==(l=ol.value)||l.unshift({label:"所有[所有数据]",value:"ALL"})}catch(t){}},dl=e=>{_e({type:"dir",path:e.value.db_backup_path,change:a=>{e.value.db_backup_path=a}})},hl=t([]),bl=t([]),yl=t([]),{rowData:wl,typeInit:_l}=e(ye()),gl=l(()=>!!wl.value.id),fl=l(()=>!wl.value.id&&wl.value),xl=l(()=>!wl.value.id&&!wl.value),kl=e=>{_l.value=!1,xl.value?(e.value.name="[勿删]数据库增量备份[ --/-- ]",e.value.more="ALL"):(e.value.db_name=e.value.sName,e.value.tb_name=""===e.value.sBody?"ALL":e.value.sBody),(async e=>{var a,l,t;try{const{data:u}=await re({type:"sites"});hl.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>s("div",{class:"flex items-center justify-between"},[s("span",null,[e.label]),s("span",{onClick:()=>{xe({name:e.value})},class:"float-right cursor-pointer text-small text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),hl.value&&"localhost"===(null==(a=hl.value[0])?void 0:a.value)||null==(l=hl.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),xl.value&&(e.value.backupTo=null==(t=hl.value)?void 0:t[0].value)}catch(u){}})(e),Ll(e)},Ll=async e=>{var a,l,t,s,u,o;try{const{data:n}=await pe();bl.value=n.data.map(e=>({label:e.name,value:e.name,table_list:e.table_list})),yl.value=(null==(a=n.data[0].table_list)?void 0:a.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})))||[{label:"所有",value:"ALL"}],bl.value.length>0&&xl.value?(e.value.db_name=null==(l=bl.value[0])?void 0:l.value,e.value.tb_name=null==(t=yl.value[0])?void 0:t.value,e.value.name="[勿删]数据库增量备份[ ".concat(bl.value[0].label," - ").concat(null==(s=yl.value[0])?void 0:s.label," ]")):gl.value||xl.value||(yl.value=null==(o=null==(u=bl.value.find(a=>a.value===e.value.db_name))?void 0:u.table_list)?void 0:o.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})))}catch(n){}},{payment:Tl}=F(),{rowData:Vl,typeInit:Sl}=e(ye()),Nl=[{value:"toShell",label:"Shell脚本"},{value:"toPython",label:"Python脚本"},{value:"site",label:"备份网站"},{value:"database",label:"备份数据库"},{label:"数据库增量备份",value:"enterpriseBackup",render:e=>s("div",{class:"flex items-center"},[s("span",null,[g("数据库增量备份")]),s("i",{class:"svgtofont-icon-ltd ml-[0.4rem] text-ltd text-base"},null)])},{value:"logs",label:"网站日志切割"},{value:"path",label:"备份目录"},{value:"webshell",label:"木马查杀"},{value:"sync_time",label:"同步时间"},{value:"rememory",label:"释放内存"},{value:"toUrl",label:"访问URL-GET"},{value:"to_post",label:"访问URL-POST"},{value:"site_restart",label:"网站启停"},{value:"log_cleanup",label:"定时清理日志"}],Al=[{label:"不接收任何消息通知",value:0},{label:"任务执行失败接收通知",value:1}],Ul=e=>["site","database","enterpriseBackup","path"].includes(e),Cl=e=>!isNaN(Number(e))&&Number(e)<10?"0"+e:e,Il=l(()=>{var e,a,l,t,s;let u="",o={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},n=Bl.value.type,r=(null==(e=Bl.value.hour)?void 0:e.toString())||"--",i=(null==(a=Bl.value.minute)?void 0:a.toString())||"--",v=(null==(l=Bl.value.where1)?void 0:l.toString())||"--",c=(null==(t=Bl.value.week)?void 0:t.toString())||"--",p=(null==(s=Bl.value.second)?void 0:s.toString())||"--";if(["day","day-n","hour","week","month","minute-n","hour-n","second-n"].includes(n)){const e="".concat(Cl(r),":").concat(Cl(i)," 执行一次");switch(n){case"day":u="每天的 ".concat(e);break;case"day-n":u="每隔 ".concat(v," 天的 ").concat(e);break;case"hour":u="每小时的第 ".concat(i," 分钟执行一次");break;case"week":u="每周 ".concat(o[c]," 的 ").concat(e);break;case"month":u="每月 ".concat(v," 号 ").concat(e);break;case"minute-n":u="每小时的第0分钟开始，每隔 ".concat(i," 分钟执行一次");break;case"hour-n":u="每天0点开始，每隔 ".concat(r," 小时的第 ").concat(i," 分钟执行一次");break;case"second-n":u="每隔 ".concat(p," 秒执行一次")}}else u="";return u}),Dl=t(),El=e=>{const a="toShell"===e||"toUrl"===e||"to_post"===e;return le("",()=>s(Ua,{ref:e=>Dl.value=e,showNotice:Ul(e),showKeyword:"toShell"===e,showStopWeb:"site"===e,showSecond:a,isEdit:!!Vl.value},{center:()=>Il.value?s("div",{class:"text-small ml-[10rem] mt-[1.6rem] leading-[1rem]",innerHTML:Il.value},null):null,bottom:()=>ql.value.notice&&["site","database","path"].includes(e)?s("div",{class:"text-small ml-10rem mt-1.2rem leading-[1rem]"},[g("检查到磁盘剩余空间小于备份文件的 5 倍或者小于 1GB 时会发送磁盘不足的提示")]):null}))},jl=e=>le("",()=>s(Da,{rowData:Vl.value,isEnterprise:"enterpriseBackup"===e},null)),Bl=t({type:"day",week:"1",hour:"1",minute:"30",second:"5",where1:"1",timeSet:["1"],timeType:"sday",specialHour:[0],specialMinute:[0]}),ql=t({notice:0,notice_channel:"all",keyword:"",flock:!0}),Ml=t({split_value:5,split_type:"0",save_local:0}),Pl=(e,a,l)=>{const t=Number(a);t<0||0===t?l(new Error("请输入不为0的数字")):l()},Rl=e=>{let l=e.value.sType;switch(l||(l="toShell"),l){case"toShell":return t=e,[Q("执行用户","user",Le.value,{attrs:{class:"!w-[30rem]",placeholder:"默认使用root用户执行"}}),K([$("脚本内容","sBody",{attrs:{class:"w-[60rem]",rows:10,resize:"none",placeholder:"请输入脚本内容"},rules:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),X("选择脚本",{attrs:{class:"!ml-4px",onClick:()=>Te(t)}})]),Y("温馨提示",[{content:"为了保证服务器的安全稳定，shell脚本中以下命令不可使用：shutdown, init 0, mkfs, passwd, chpasswd, --stdin, mkfs.ext, mke2fs"}])];case"toPython":return(e=>[Q("执行用户","user",Ve.value,{attrs:{class:"!w-[30rem]",placeholder:"默认使用root用户执行"}}),K([Q("python环境","python_env",Se.value,{attrs:{class:"!w-[30rem]",placeholder:"请选择python环境"},rules:[{required:!0,message:"请选择python环境",trigger:"change"}]}),Z(()=>a("span",{class:"ml-[1.5rem] bt-link h-[3rem] leading-[3rem]",onClick:Ae},"python环境管理"))]),K([$("脚本内容","sBody",{attrs:{class:"w-[60rem]",rows:10,resize:"none",placeholder:"请输入脚本内容"},rules:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),X("选择脚本",{attrs:{class:"!ml-4px",onClick:()=>Ne(e)}})])])(e);case"logs":return(e=>(Ie.value&&qe(e),[ee("存储路径","log_cut_path",{attrs:{class:"w-[36rem]"},rules:[{required:!0,message:"请输入存储路径",trigger:"blur"}]},()=>Be(e)),K([Q("切割日志","sName",je.value,{attrs:{class:"!w-[16rem] mr-[8px]",disabled:De.value,onChange:a=>{e.value.name="切割日志["+("ALL"===a?"全部":a)+"]"}}}),ae("","save","份",{attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"请输入不为0的正整数",trigger:"blur"}]}),Y("温馨提示",[{content:"只切分项目的访问日志，如需对项目日志进行切分，请前往【网站-**项目-项目日志】进行配置"},{content:"日志切割后会在选择的目录下产生/history_backups文件夹，切割后的日志存储在这个文件夹中"}])])]))(e);case"webshell":return(e=>(Pe.value&&ze(e),[Q("查杀站点","sName",Re.value,{attrs:{class:"!w-[300px]",disabled:He.value,onChange:a=>{e.value.name="木马查杀["+("ALL"===a?"全部":a)+"]"}}}),ge("消息通道","urladdress",{attrs:{placeholder:"请选择消息通道",isShowApi:!1,isDefault:!0,isShowAll:!1,limit:["sms"],multiple:!1,class:"!w-[300px]"}})]))(e);case"sync_time":return(e=>(We.value&&Ke(e),[le("时区选择",()=>s(u,{class:"w-[32rem]",options:Ge.value,modelValue:Je.value,props:{expandTrigger:"hover"},onChange:a=>{e.value.name="定期同步服务器时间[".concat(a[0],"/").concat(a[1],"]"),e.value.sName="".concat(a[0],"/").concat(a[1]),Je.value=[a[0],a[1]],e.value.region=a[0],e.value.zone=a[1]}},null)),Y("温馨提示",[{content:"默认从NTP服务器同步时间，失败时将同步bt.cn的服务器时间。"}])]))(e);case"rememory":return!Vl.value&&(e.value.name="释放内存"),[Y("温馨提示",[{content:"释放PHP、MYSQL、PURE-FTPD、APACHE、NGINX的内存占用,建议在每天半夜执行!"}])];case"toUrl":return(e=>(Xe.value&&(e.value.name="访问URL-[ http:// ]",e.value.urladdress="http://"),[K([te("URL地址","urladdress",{attrs:{placeholder:"请输入URL地址",class:"!w-[30rem]",onInput:a=>{e.value.name="访问URL-[ ".concat(a," ]")}},rules:[{required:!0,message:"请输入URL地址",trigger:"blur"}]}),X("测试URL",{attrs:{class:"!ml-4px",onClick:()=>Ye(e)}})]),$("User-Agent","user_agent",{attrs:{placeholder:"请输入User-Agent",class:"w-[60rem]"}})]))(e);case"to_post":return(e=>(aa.value&&(e.value.name="访问URL-POST[ http:// ]",e.value.urladdress="http://"),[te("URL地址","urladdress",{attrs:{placeholder:"请输入URL地址",class:"!w-[30rem]",onInput:a=>{e.value.name="访问URL-POST[ ".concat(a," ]")}},rules:[{required:!0,message:"URL地址不可为空",trigger:["blur","input"]},{validator:(e,a,l)=>{"http://"===a||"https://"===a?l(new Error("输入内容不可为空")):l()},trigger:["blur","input"]}]}),$("User-Agent","user_agent",{attrs:{placeholder:"请输入User-Agent",class:"w-[60rem]"}})]))(e);case"site_restart":return(e=>(ia.value&&da(e),[Q("网站","sName",na.value,{attrs:{class:"!w-[30rem]",disabled:pa.value,onChange:a=>{e.value.name="网站启停["+("ALL"===a?"所有":a)+"]"}}}),K([le("开启时间",()=>s(o,{"prefix-icon":"none",clearable:!0,placeholder:"请选择开启时间",class:"!w-22rem",modelValue:va.value,"onUpdate:modelValue":e=>va.value=e,onChange:a=>{va.value=a,e.value.startTime=a,e.value.special_time="".concat(va.value,",").concat(ca.value)},start:"00:00",step:"00:05",end:"23:59"},null),"startTime",{rules:[{required:!0,message:"请选择开启时间",trigger:"change"}]}),le("停止时间",()=>s(o,{"prefix-icon":"none",clearable:!0,placeholder:"请选择停止时间",class:"!w-22rem",modelValue:ca.value,"onUpdate:modelValue":e=>ca.value=e,onChange:a=>{ca.value=a,e.value.stopTime=a,e.value.special_time="".concat(va.value,",").concat(ca.value)},start:"00:00",step:"00:05",end:"23:59"},null),"stopTime",{rules:[{required:!0,message:"请选择停止时间",trigger:"change"}]})]),Y("温馨提示",[{content:"执行周期为每天一次"}])]))(e);case"log_cleanup":return(e=>(ya.value&&ka(e),[se("清理类型","radioType",[{label:"选择类型",value:1},{label:"自定义路径",value:2}],{attrs:{disabled:wa.value,onChange:a=>{ha.value=a,e.value.radioType=a,e.value.clearLogType=[],e.value.sName="",e.value.name="日志清理",1===a&&(e.value.sName="user_config")}}}),1===ha.value?Q(" ","clearLogType",ga,{attrs:{multiple:!0,disabled:wa.value,class:"!w-[30rem]",placeholder:"请选择日志类型",onChange:a=>{e.value.clearLogType=a,e.value.sName=a.join(",");const l=a.map(e=>{var a;return null==(a=ga.find(a=>a.value===e))?void 0:a.label});e.value.name=a.length<=2?"日志清理[".concat(l.join(","),"]"):"日志清理[".concat(l.slice(0,2).join(","),"...等").concat(l.length,"项]")}},rules:[{required:!0,message:"请选择日志类型",trigger:"change"}]}):K([$(" ","logText",{attrs:{class:"!w-[32rem]",disabled:wa.value,placeholder:"请选择或输入自定义目录，一行一个",onInput:a=>{e.value.logText=a,e.value.log_cut_path=a.split("\n").filter(e=>""!==e).join(","),e.value.name=xa(a,2)}},rules:[{required:!0,message:"请输入自定义目录",trigger:"blur"}]}),X("添加目录",{attrs:{disabled:wa.value,class:"!ml-8px",onClick:()=>fa(e)}})]),Y("温馨提示",[{content:"自定义选择的目录支持切割的日志类型有：.log、.txt、.out、.err、.log.1"}])]))(e);case"path":return(e=>(qa.value&&za(e),[K([ee("备份目录","sName",{attrs:{disabled:Ma.value,placeholder:"请输入备份目录",class:"!w-[30rem]",onInput:a=>{e.value.name="备份目录[".concat(a,"]")}},rules:[{required:!0,message:"请输入备份目录",trigger:"blur"}]},()=>!Ma.value&&Oa(e)),Q("备份到","backupTo",Ha.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}}),ae("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Pl,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?jl(e.value.sType):null,$("排除目录","sBody",{attrs:{rows:10,resize:"none",class:"w-[60rem]",placeholder:"每行一条规则,目录不能以/结尾，\n 示例：data/config.php \n static/upload \n *.log,"}})]))(e);case"site":return(e=>(Ja.value&&Za(e),[K([Q("备份网站","sName",Ka.value,{attrs:{placeholder:"请选择备份网站",class:"!w-[30rem]",disabled:$a.value,onChange:a=>{e.value.name="备份网站[ ".concat("ALL"===a?"所有":a," ]")}}}),Q("备份到","backupTo",Qa.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}}),ae("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Pl,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?jl(e.value.sType):null,Ya(e)&&ee("备份路径","db_backup_path",{attrs:{placeholder:"请输入备份路径",class:"!w-[30rem]"},rules:[{required:!0,message:"备份路径不可为空",trigger:"blur"}]},()=>el(e)),$("排除规则","sBody",{attrs:{rows:10,resize:"none",class:"w-[60rem]",placeholder:"每行一条规则,目录不能以/结尾，\n 示例：data/config.php \n static/upload \n *.log,"}})]))(e);case"database":return(e=>{var a;return sl.value&&pl(e),[K([Q("数据库","db_type",cl,{attrs:{class:"!w-[9rem]",disabled:il.value,onChange:a=>{ml(a),e.value.name="备份".concat(a,"数据库[ 所有 ]"),e.value.sName="ALL",e.value.table_list="ALL"}}}),Q("数据库","sName",ol.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]",disabled:il.value,onChange:a=>{var l,t;e.value.sName=a,"ALL"===a?e.value.name="备份".concat(e.value.db_type,"数据库[ 所有 ]"):(rl.value=null==(t=null==(l=ol.value.find(e=>e.value===a))?void 0:l.table_list)?void 0:t.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})),e.value.name="备份".concat(e.value.db_type,"数据库[ ").concat(a," ]"))}}}),Q("","table_list",rl.value,{attrs:{disabled:il.value,class:"!w-[16rem] ml-8px"+("ALL"!==e.value.sName&&(null==(a=rl.value)?void 0:a.length)&&"mysql"===e.value.db_type?"":" !hidden"),onChange:a=>{e.value.name="备份".concat(e.value.db_type,"数据库[ ").concat(e.value.sName," - ").concat(a," ]")}}}),Q("备份到","backupTo",ul.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[12rem]"}}),ae("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[10rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Pl,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?jl(e.value.sType):null,ee("备份路径","db_backup_path",{attrs:{class:"!w-[42rem]"},rules:[{required:!0,message:"备份路径不可为空",trigger:"blur"}]},()=>dl(e)),le(" ",()=>s("div",{class:"text-small text-secondary flex items-center h-full"},[s(N,{class:"!mr-[12px]",modelValue:nl.value,"onUpdate:modelValue":e=>nl.value=e,onChange:()=>{e.value.backup_mode=nl.value?1:0}},{default:()=>[g("使用数据库对应账号备份")]}),s("span",{class:"text-tertiary text-small"},[g(" *注意：目前只支持mysql数据库的本地数据库备份 ")])])),Y("温馨提示",[{content:"远程数据库不支持备份表"}])]})(e);case"enterpriseBackup":return(e=>(_l.value&&kl(e),[K([Q("备份数据库","db_name",bl.value,{attrs:{class:"!w-[20rem] mr-8px",disabled:gl.value,onChange:a=>{var l;e.value.tb_name="ALL",e.value.name="[勿删]数据库增量备份[ ".concat(a," - 所有 ]"),yl.value=null==(l=bl.value.find(e=>e.value===a))?void 0:l.table_list.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value}))}}}),yl.value&&Q("","tb_name",yl.value,{attrs:{disabled:gl.value,class:"!w-[20rem]",onChange:a=>{var l;const t=null==(l=bl.value.find(a=>a.value===e.value.db_name))?void 0:l.label;e.value.name="[勿删]数据库增量备份[ ".concat(t," - ").concat("ALL"===a?"所有":a," ]")}}}),Q("备份到","backupTo",hl.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}})]),e.value.backupTo&&"localhost"!==e.value.backupTo?jl(e.value.sType):null,(xl.value||fl.value)&&ue("压缩密码","zip_password",{attrs:{class:"w-[32rem]",placeholder:"请输入压缩密码"}},()=>{e.value.zip_password=W(16)}),Y("温馨提示",[{content:'<span class="text-dangerDark">注意：请牢记压缩密码，以免因压缩密码导致无法恢复和下载数据</span>',isHtml:!0},{content:"【使用提醒】当前数据库暂不支持SQLServer、MongoDB、Redis、PgSQL备份"}])]))(e);default:return()=>[]}var t},Hl=e=>("log_cleanup"===e.sType?(1===e.radioType&&(e.log_cut_path=""),delete e.radioType,delete e.clearLogType,delete e.logText):"site_restart"===e.sType&&(delete e.startTime,delete e.stopTime),delete e.specialHour,delete e.specialMinute,delete e.echo,delete e.type_zh,delete e.type_name,delete e.sort,delete e.cycle,delete e.rname,e),Ol=async e=>{if("ltd"!==Tl.value.authType&&"enterpriseBackup"===e.sType)return ke({sourceId:53}),!1;let a=R.load("正在提交，请稍候...");try{const a="enterpriseBackup"===e.sType,l=(e=>{var a;let l={name:"",sType:"toShell",sBody:"",sName:"",backupTo:"",save:"",urladdress:"",save_local:0,notice:0,notice_channel:"",datab_name:e.db_name||"",tables_name:e.tb_name||"",keyword:"",flock:1,version:"",user:"",...e,stop_site:Number(null==(a=Dl.value)?void 0:a.WebStopSite)||0,...Bl.value};if(l=Object.assign(l,ql.value),l.flock=Number(ql.value.flock),"sweek"===l.type){l.where1="5",l.hour="1",l.minute="5",l.week="1";let e=[];l.specialHour.forEach(a=>{l.specialMinute.forEach(l=>{e.push((a<10?"0"+a:a)+":"+(l<10?"0"+l:l)),e=Array.from(new Set(e))})}),l.special_time=e.join(","),l.time_set=l.timeSet,l.time_type=l.timeType,delete l.timeSet,delete l.timeType}return"toPython"===e.sType&&(l.params=JSON.stringify({python_env:e.python_env}),delete l.python_env),"site_restart"===e.sType&&(l.minute="5",l.where1="5",l.type="sweek"),"second-n"!==Bl.value.type&&delete l.second,"to_post"===e.sType&&(l.post_param=JSON.stringify(Ze.value)),["database","enterpriseBackup","site","path"].includes(e.sType)&&!G(Ml.value.split_value)&&(l=Object.assign(l,Ml.value)),Hl(l)})(e);if(a)return await zl(l);{let e;return e=Vl.value.id?await me(l):await de(l),Fl(e),R.request(e),e.status&&we(),e.status}}catch(l){}finally{a.close()}},zl=async e=>{try{const a=Vl.value.id;"ALL"===e.tb_name&&(e.tb_name="");const l=a?await be(e):await he(e);return R.request(l),we(),l.status}catch(a){}},Fl=e=>{e.msg.includes("系统加固")&&q({title:"临时关闭系统加固",area:44,component:()=>M(()=>import("./index445.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Wl=()=>{Object.assign(Bl.value,{type:"day",week:"1",hour:"1",minute:"30",second:"5",where1:"1",timeSet:["1"],timeType:"sday",specialHour:[0],specialMinute:[0]}),Object.assign(ql.value,{notice:0,notice_channel:"",keyword:"",flock:!0})},Gl={class:"p-2rem"},Jl={class:"w-[60rem]"},Ql=["onClick"],Kl=z(n({__name:"index",setup(a,{expose:t}){const{rowData:u,typeInit:o}=e(ye()),n=l(()=>["logs","webshell","site_restart","path","site","database","enterpriseBackup"].includes(y.value.sType)),r=l(()=>!["site_restart"].includes(y.value.sType)),i=l(()=>u.value&&u.value.id),v=l(()=>u.value&&!u.value.id),{BtForm:b,param:y,submit:f,clearValidate:x}=J({data:()=>{if(u.value){(()=>{const e=Vl.value.special_time.split(",");let a=[],l=[];e.forEach(e=>{a.push(parseInt(e.split(":")[0])||0),l.push(parseInt(e.split(":")[1])||0),a=Array.from(new Set(a)),l=Array.from(new Set(l))});const t=Vl.value.timeSet?Vl.value.timeSet.split(","):Vl.value.time_set?Vl.value.time_set.split(","):["1"];Bl.value={type:Vl.value.type,hour:Vl.value.where_hour,minute:Vl.value.where_minute,where1:Vl.value.where1,week:Vl.value.where1,timeType:Vl.value.timeType||Vl.value.time_type,timeSet:t,specialHour:a,specialMinute:l,second:Vl.value.second||"5"};const s=["notice","notice_channel","keyword","flock"];for(let u in ql.value)s.includes(u)&&(ql.value[u]=Vl.value[u],"flock"===u&&(ql.value[u]=1===Vl.value[u]));Ml.value={split_value:Vl.value.split_value,split_type:Vl.value.split_type,save_local:Number(Vl.value.save_local)}})(),"to_post"===u.value.sType&&(Ze.value=JSON.parse(u.value.post_param));let e=u.value.sType;if("mysql_increment_backup"===e)e="enterpriseBackup";return{...u.value,sType:e,name:u.value.rname||u.value.name,..."toPython"===u.value.sType?{python_env:u.value.params.python_env}:{}}}return{sType:"toShell",name:""}},options:e=>l(()=>[K([Q("任务类型","sType",Nl,{attrs:{clearable:!1,class:"!w-[30rem]",disabled:i.value||v.value,onChange:()=>{x(),o.value=!0,e.value.name=""}}}),Z(()=>s(A,{placement:"top-start",width:"260","popper-class":"green-tips-popover",trigger:"hover"},{default:()=>s("div",null,[s("span",{class:"text-white"},[g("任务类型包含以下部分：Shell脚本、备份网站、备份数据库、数据库增量备份、网站日志切割、自定义日志切割、释放内存、访问URL-GET、访问URL-POST、备份目录、木马查杀、同步时间")])]),reference:()=>s("i",{class:"inline-block svgtofont-el-question-filled text-warning ml-[12px] mt-8px"},null)}))]),te("任务名称","name",{attrs:{placeholder:"请输入计划任务名称",disabled:n.value&&!i.value&&!v.value,class:"w-[30rem]"},rules:[{required:!0,message:"请输入计划任务名称",trigger:"blur"}]}),r.value?El(e.value.sType):null,...Rl(e),{type:"slots",key:"custom"}]),submit:async(e,a,l)=>{var t;return await a(),await(null==(t=Dl.value)?void 0:t.validate()),await Ol(e.value)}});return t({onConfirm:f}),D(()=>{ye().$resetForm(),Wl()}),(e,a)=>{const l=H,t=E,u=j,o=B,n=S;return c(),p("div",Gl,[s(h(b),null,{custom:m(()=>["to_post"===h(y).sType?(c(),w(n,{key:0,label:"参数配置"},{default:m(()=>[d("div",Jl,[s(u,{ref_key:"paramTableRef",ref:ta,class:"param-table",data:h(Ze),"row-class-name":h(la),"max-height":"200",onSelectionChange:h(sa)},{default:m(()=>[s(t,{label:"参数名",prop:"paramName",width:"240"},{default:m(({row:e})=>[s(l,{modelValue:e.paramName,"onUpdate:modelValue":a=>e.paramName=a,type:"text",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(t,{label:"参数值",prop:"paramValue"},{default:m(({row:e})=>[s(l,{modelValue:e.paramValue,"onUpdate:modelValue":a=>e.paramValue=a,type:"text",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(t,{label:"操作",align:"right",width:"70"},{default:m(({row:e,index:a})=>[d("span",{class:"bt-link",onClick:l=>h(oa)(e,a)},"删除",8,Ql)]),_:1})]),_:1},8,["data","row-class-name","onSelectionChange"]),s(o,{type:"primary",size:"small",class:"!mt-[1rem]",onClick:h(ua)},{default:m(()=>[...a[0]||(a[0]=[d("i",{class:"svgtofont-el-plus text-white font-bold mr-[0.4rem]"},null,-1),g("添加参数 ",-1)])]),_:1},8,["onClick"])])]),_:1})):_("",!0)]),_:1})])}}}),[["__scopeId","data-v-de1dff8f"]]);export{Kl as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
