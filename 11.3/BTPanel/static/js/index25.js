import{Q as a,aL as e,aA as t,b as l,u as s,aM as n,aN as i,aO as o,n as p,H as r,p as c,aP as d,e as u,_ as m,aQ as v,E as f,aR as _,aS as y,aT as g,aU as h,y as x,az as w,aV as k,aW as b,aX as C,aY as D,aZ as j,a_ as I,a$ as q,b0 as E,ay as T,O as A}from"./utils-lib.js?v=1763689792";import{o as z,av as R,s as O,j as S,r as V,W as L,c as M,w as P,v as H,a8 as N,x as F,y as U,A as G,e as W,z as B,Q as K,D as Q,C as J,L as $,F as X,b1 as Y,O as Z,J as aa,K as ea,B as ta,G as la,H as sa,as as na,ar as ia,aT as oa,at as pa,n as ra,V as ca,an as da,am as ua,i as ma,g as va,be as fa,b2 as _a,aA as ya,aG as ga,M as ha,ay as xa,I as wa}from"./base-lib.js?v=1763689792";import{g as ka}from"./useStore3.js?v=1763689792";import{_ as ba}from"./index107.js?v=1763689792";import{c as Ca,N as Da,g as ja}from"./useMethods.js?v=1763689792";import{j as Ia}from"./validator.js?v=1763689792";import{s as qa}from"./vue-virtual-scroller.esm.js?v=1763689792";import"./vue-virtual-scroller.js?v=1763689792";import{h as Ea,b as Ta,c as Aa}from"./form-item.js?v=1763689792";import{o as za}from"./useController4.js?v=1763689792";import{_ as Ra}from"./index.vue_vue_type_style_index_0_lang.js?v=1763689792";import{B as Oa}from"./index119.js?v=1763689792";const Sa=l(),{refs:{deployMenuData:Va}}=ka(),La=z({loading:!1,list:[],total:0}),Ma=z({p:1,row:200,query:"",force:0}),Pa=async(l={query:Ma.query,p:Ma.p,row:Ma.row,force:0})=>{const s="docker_app_list_timestamp",n=localStorage.getItem(s),i=Date.now();let o=!1;(!n||i-parseInt(n)>864e5)&&(o=!0),a({request:e({...l,app_type:Va.value.app_type,force:l.force||(o?1:0)}),loading:R(La,"loading"),success:a=>{a.status?((1===l.force||o)&&(localStorage.setItem(s,i.toString()),!o&&Sa.success("刷新成功")),La.list=a.data.data.map((a,e)=>({...a,index:"".concat(a.appname||Math.random().toString(36).substring(2,15),"_").concat(e)})),La.total=t(a.data.page),Va.value.maximum_cpu=a.data.maximum_cpu,Va.value.maximum_memory=a.data.maximum_memory+" MB"):Sa.error(a.msg)}})},Ha=S("DOCKER-APP-STORE-LOCAL",()=>({activeTabs:V("git"),apphubGitConfig:V({}),isSaveGitConfig:V(!1),usingHelpLink:V("https://www.bt.cn/bbs/thread-147864-1-1.html")})),Na=()=>O(Ha()),{apphubGitConfig:Fa,isSaveGitConfig:Ua}=Na(),Ga=l(),{refs:{deployMenuData:Wa}}=ka(),{mainWidth:Ba}=s(),Ka=L([]),Qa=L(""),Ja=()=>Math.floor((Ba.value-420)/140),$a=V(),Xa=async a=>{if(Ma.p=1,Ya(),"installed"===Wa.value.app_type)return await ae("all"),void(a&&Ga.success("刷新成功"));Ma.force=a?1:0,a&&await Ca(),await Pa(Ma)},Ya=async()=>await a({request:n(),data:[Array,Ka],success:a=>{$a.value=a.slice(Ja(),a.length)}}),Za=async a=>{var e,t;Qa.value=(null==(t=null==(e=$a.value)?void 0:e.find(e=>e.type===a))?void 0:t.desc)||"",Wa.value.app_type=a,Ma.query="",Ma.p=1,Ma.force=0,await Pa(Ma)},ae=async e=>{var l,s;La.loading=!0,Qa.value=(null==(s=null==(l=Ka.value)?void 0:l.find(a=>a.type===e))?void 0:s.desc)||"",Wa.value.app_type="installed",a({request:i({app_type:e,p:1,row:20,query:Ma.query||""}),loading:R(La,"loading"),success:a=>{a.status?(La.list=a.data.data.map((a,e)=>({...a,index:e}))||[],a.data.page?La.total=t(a.data.page):La.total=0):Ga.error(a.msg)}})},ee=()=>{"installed"===Wa.value.app_type&&ae("all"),Wa.value.app_type="installed"},te=()=>{Ka.value=[],Qa.value="",$a.value=[]},le=async a=>{const e=Ga.load("正在获取配置信息...");try{const a=await o(),e=a.data.git_config||{},{git_url:t="",git_branch:l="",user_config:s={}}=e;Fa.value={git_url:t,git_branch:l,name:s.name||"",password:s.password||""},a.status&&(Ua.value=!0),p({title:"导入应用",area:70,btn:["导入","取消"],component:()=>r(()=>import("./index145.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})}catch(t){}finally{null==e||e.close()}},se=async()=>{await c({title:"清理应用",content:"该操作将会清除所有外部应用，已安装的应用将会保留至已安装列表，是否继续？"}),await a({request:d(),message:!0,success:()=>{Pa(Ma)}})},ne={class:"flex flex-1 relative items-center mb-20px"},ie={class:"text-small text-secondary leading-[2rem] mx-[2rem] flex items-center"},oe={class:"w-full flex items-center"},pe={class:"flex flex-1 relative flex-wrap"},re=["onClick"],ce={key:0,class:"flex items-center"},de=m(M({__name:"index",setup(a,{expose:e}){const{refs:{deployMenuData:t}}=ka(),{mainWidth:l}=s();P(()=>l.value,()=>{var a,e,l;$a.value=Ka.value.slice(Ja(),null==(a=Ka.value)?void 0:a.length),Qa.value=(null==(l=null==(e=$a.value)?void 0:e.find(a=>a.type===t.value.app_type))?void 0:l.desc)||""}),H(Ya);const n=V();return N(te),e({testRef:n}),(a,e)=>{var l,s;const i=ba,o=u,p=sa,r=pa,c=na,d=ia,m=oa;return F(),U("div",{ref_key:"testRef",ref:n},[G("div",ne,[e[12]||(e[12]=G("span",{class:"w-[80px] pr-16px text-base flex justify-end flex-shrink-0"},"应用搜索",-1)),W(i,{class:"!w-[52rem]",ref:"searchRef",icon:"el-search",modelValue:B(Ma).query,"onUpdate:modelValue":e[0]||(e[0]=a=>B(Ma).query=a),clearable:"",onClear:e[1]||(e[1]=a=>B(Xa)(!1)),onIconClick:e[2]||(e[2]=a=>B(Xa)(!1)),placeholder:"支持应用名称、字段模糊搜索",onKeyup:e[3]||(e[3]=K(a=>B(Xa)(!1),["enter","native"]))},null,8,["modelValue"]),G("span",ie,[e[10]||(e[10]=Q(" 如果您希望添加其它Docker应用，请 ",-1)),G("span",{class:"bt-link",onClick:e[4]||(e[4]=a=>B(Ia)())},"联系客服"),e[11]||(e[11]=Q(" ,或进行 ",-1)),G("span",{class:"bt-link",onClick:e[5]||(e[5]=a=>B(Da)())},"需求反馈"),W(o,{href:"https://www.bt.cn/bbs/thread-137717-1-1.html",class:"ml-4px"},{default:J(()=>[...e[9]||(e[9]=[Q(">>使用帮助",-1)])]),_:1})])]),G("div",oe,[e[19]||(e[19]=G("span",{class:"w-[80px] pr-16px text-base flex justify-end"},"应用分类",-1)),G("div",{class:$(["class-item",{on:"all"===B(t).app_type}]),onClick:e[6]||(e[6]=a=>B(Za)("all"))},"全部",2),G("div",{class:$(["class-item flex-shrink-0",{on:"installed"===B(t).app_type}]),onClick:e[7]||(e[7]=(...a)=>B(ee)&&B(ee)(...a))},"已安装",2),G("div",pe,[(F(!0),U(X,null,Y(null==(l=B(Ka))?void 0:l.slice(0,B(Ja)()),(a,e)=>(F(),U("div",{key:e,onClick:e=>B(Za)(a.type),class:$(["class-item",B(t).app_type===a.type?"on":""])},ta(a.desc),11,re))),128)),(null==(s=B($a))?void 0:s.length)?(F(),Z(d,{key:0,"show-timeout":200,onCommand:B(Za)},{dropdown:J(()=>[W(c,null,{default:J(()=>[(F(!0),U(X,null,Y(B($a),(a,e)=>(F(),Z(r,{key:e,command:a.type},{default:J(()=>[Q(ta(a.desc),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:J(()=>[W(p,{type:"default",class:$(["AppClassButton",{on:B($a).some(a=>a.type===B(t).app_type)}])},{default:J(()=>[e[13]||(e[13]=Q(" 更多 ",-1)),aa(G("span",null,"（"+ta(B(Qa))+"）",513),[[ea,B(Qa)]]),e[14]||(e[14]=G("i",{class:"svgtofont-el-arrow-down ml-[.5rem]"},null,-1))]),_:1},8,["class"])]),_:1},8,["onCommand"])):la("",!0)]),aa(W(p,{title:"更新列表",class:"refresh !mr-[1.2rem]",onClick:e[8]||(e[8]=a=>B(Xa)(!0))},{default:J(()=>[...e[15]||(e[15]=[Q(" 更新应用列表 ",-1)])]),_:1},512),[[ea,"installed"!==B(t).app_type&&"AppHub"!==B(t).app_type]]),"AppHub"===B(t).app_type?(F(),U("div",ce,[W(p,{type:"default",title:"清理应用",class:"ml-[1rem]",onClick:B(se)},{default:J(()=>[...e[16]||(e[16]=[Q(" 清理应用 ",-1)])]),_:1},8,["onClick"]),W(m,{content:"支持从Git仓库或本地文件导入应用，自动扫描并识别多个应用，支持选择性导入和批量导入",enterable:!1,placement:"left"},{content:J(()=>[...e[17]||(e[17]=[G("div",{class:"flex flex-col pb-[4px]"},[G("div",null,"支持从Git仓库或本地文件导入应用"),G("div",null,"自动扫描并识别多个应用"),G("div",null,"支持选择性导入和批量导入")],-1)])]),default:J(()=>[W(p,{type:"primary",class:"refresh !mr-[1.2rem] ml-[1rem]",onClick:B(le)},{default:J(()=>[...e[18]||(e[18]=[Q(" 导入应用 ",-1)])]),_:1},8,["onClick"])]),_:1})])):la("",!0)])],512)}}}),[["__scopeId","data-v-8ac8f40f"]]),ue=l(),{refs:{deployMenuData:me}}=ka(),ve=V(!1),fe=V(!1);let _e=null;const ye=async()=>{ve.value||(ve.value=!0,fe.value=!0,La.list.length<La.total&&(Ma.p++,"installed"===me.value.app_type?await ge("all"):await Pa(Ma)),ve.value=!1)},ge=async(e,l)=>{try{1===Ma.p&&(La.total=0,La.list=[]),l||(La.loading=!0),me.value.app_type="installed",await a({request:i({app_type:e||"all",p:Ma.p,row:20,query:Ma.query||""}),success:a=>{if(a.status){const e=a.data.data.map((a,e)=>({...a,index:e}))||[];La.list=[...La.list,...e],a.data.page?La.total=t(a.data.page):La.total=0}else ue.error(a.msg)}})}catch(s){}finally{La.loading=!1}},he=()=>{La.list.some(a=>"initializing"===a.status)&&(_e=setTimeout(()=>{ge("all",!0),he()},3e4))},xe=""+new URL("../img/soft_ico/icon_plug.svg",import.meta.url).href;function we(a){return"function"==typeof a||"[object Object]"===Object.prototype.toString.call(a)&&!ma(a)}const ke=l(),{refs:{deployMenuData:be}}=ka(),{refs:{isRefreshInstallList:Ce}}=v(),De={mode:"ace/mode/yaml",theme:f.value?"ace/theme/clouds_midnight":"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},je=async(a,e)=>{const{appname:t,appid:l}=a,s=-1==l?"/static/img/soft_ico/apphub":"/static/img/soft_ico/dkapp",n=-1==l?"ico-apphub_":"ico-dkapp_",i=null==t?void 0:t.replace(/-+[{0-9},\.,]+$/,""),o="".concat(s,"/").concat(n).concat(i,".png");e.value=await ja(o)},Ie=a=>a.canUpdate&&a.installed,qe=async a=>{await lt({appData:a,openDependInstall:Ee}),tt(),p({title:"".concat(a.appname,"安装配置"),area:70,component:()=>r(()=>import("./add-app-soft.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{appData:a,openDependInstall:Ee},showFooter:!0})},Ee=async({name:a,type:e})=>{be.value.app_type=e,Ma.query="",await Pa(),ra(async()=>{const e=La.list.find(e=>e.appname===a);e&&(await lt({appData:e,openDependInstall:Ee}),tt(),p({title:"".concat(e.appname,"安装配置"),area:70,component:()=>r(()=>import("./add-app-soft.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{appData:e,openDependInstall:Ee},showFooter:!0}))})},Te=async a=>{p({title:"更新配置",area:42,component:()=>r(()=>import("./app-update.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:a,showFooter:!0})},Ae=a=>{p({title:"详情展示",area:64,component:()=>r(()=>import("./detail-view.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:a,btns:!1})},ze=(a,e,t)=>{switch(a){case"ollama":case"ollama_and_openwebui":case"deepseek_r1":p({title:"管理",area:[86,52],component:()=>r(()=>import("./index146.js?v=1763689792").then(a=>a.i),__vite__mapDeps([]),import.meta.url),compData:{...e,...t},btns:!1});break;case"mysql":case"redis":case"postgresql":case"tdengine":Oe(a,e)}},Re=M({name:"ContainerTerminalDialog",props:{compData:{type:Object,default:()=>({})}},setup(a,{expose:e}){const t=V(),l=V(a.compData.cmd);let s=V(null);return H(()=>{ra(()=>{s.value=t.value.socketInfo(),s.value.send("cd /www/wwwroot\r\n"),s.value.send("clear && ".concat(l.value,"\r\n"))})}),e({onCancel:()=>{s.value.close()}}),()=>W("div",{class:"p-[1rem] bg-black h-full"},[W(Ra,{id:"dockerTerminal",class:"h-full",active:!0,ref:t,url:"/webssh","host-info":{}},null)])}}),Oe=async(e,t)=>{const l=["redis_password","mysql_root_password","postgres_password"];let s="";for(const a of t.appinfo)if(l.includes(a.fieldKey)){s=a.fieldValue;break}const n=await a({request:_({appname:e,id:t.container_id,password:s}),loading:"正在获取数据库终端命令，请稍后..."});if(!n.status)return ke.error("连接数据库失败");p({component:()=>Re,title:"宝塔终端",area:[80,50],compData:{cmd:n.msg}})},Se=a=>"0.0.0.0"===a.host_ip&&"Database"!==a.apptype&&"System"!==a.apptype,Ve=(a,e,t)=>{"0.0.0.0"===a.host_ip&&"Database"!==a.apptype&&"System"!==a.apptype?window.open("".concat(t,"://").concat(a.server_ip,":").concat(e),"_blank","noopener,noreferrer"):ke.error("当前应用不支持IP+端口访问")},Le=async(a,e)=>{var t;if("path"===a){const{router:a}=await r(()=>import("./utils-lib.js?v=1763689792").then(a=>a.lW),__vite__mapDeps([]),import.meta.url),l=null==(t=e.appinfo.filter(a=>"app_path"===a.fieldKey)[0])?void 0:t.fieldValue;y("Path",l);let s=ke.load("正在跳转,请稍后...");a.push({path:"/files"}),s.close()}},Me=async a=>{za({id:a.site_id,name:a.site_name,addtime:a.site_addtime})},Pe=(a,e,t)=>{if(t&&"initializing"!==a.status)return;let l=!1;"log"===e&&"initializing"===a.status&&(l=!0);const s={back:{component:()=>r(()=>import("./backup-view.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:82,title:"应用备份",showFooter:!1},log:{component:()=>r(()=>import("./app-log.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:88,title:"应用日志",showFooter:!1},password:{component:()=>r(()=>import("./update-password.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:42,title:"修改mysql密码",showFooter:!0}};p({title:s[e].title,area:s[e].area,compData:{...a,isInit:l},component:s[e].component,showFooter:s[e].showFooter})},He=async(e,t,l)=>{await c({title:"提示",content:"确定要".concat({rebuild:"重建",start:"启动",restart:"重启",stop:"停止"}[t],"【").concat(l.service_name,"】吗?"),icon:"warning-filled"}),await a({request:g({service_name:l.service_name,status:t,app_name:l.appname}),loading:"正在操作,请稍后...",message:!0}),e("refresh")},Ne=async(e,t)=>{await c({title:"提示",content:"确定要删除【".concat(t.appname,"】吗?"),icon:"warning-filled",type:"check",check:{content:"同时删除此应用的所有数据",onConfirm:async l=>{await a({request:h({id:t.id,delete_data:Number(l)}),loading:"正在删除,请稍后...",message:!0}),e("refresh")}}})},Fe=a=>window.open("http://"+a,"_blank","noopener,noreferrer"),Ue=L({});let Ge=z({version:"",showCompose:"false",editcompose:""});const We=(a,e)=>{switch(a.type){case"password":return Ea(a.name,()=>W("div",{class:"flex flex-col items-start justify-center w-full"},[W(ba,{placeholder:"请输入".concat(a.name),width:"24rem","is-active":!0,modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,icon:"el-refresh",onInput:t=>Xe(a,t,e),onIconClick:()=>Ge[a.attr]=x(16)},null)]),a.attr,{rules:{}});case"checkbox":return Ea(a.name,()=>W(ca,{modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,label:a.name,class:"!my-0"},{default:()=>[W("span",{class:"unit"},[Q(" * "),a.suffix,Q(" ")])]}),a.attr);case"textarea":return Aa(a.name,a.attr,{attrs:{placeholder:"请输入".concat(a.name),autosize:{minRows:1,maxRows:15},class:"!w-[244px]",onInput:t=>Xe(a,t,e)},rules:[{required:!1,message:"请输入".concat(a.name),trigger:["change","blur"]}],slots:{unit:()=>Ye(a)}});default:if("string"==typeof a.type&&a.type.startsWith("ace:")){const t=a.type.split(":")[1]||"",l={...De,mode:t?"ace/mode/".concat(t):"ace/mode/text"};return Ea(a.name,()=>W("div",{class:"flex flex-col items-start justify-center w-full"},[W(Oa,{key:"editer1",class:"!w-[500px] h-[30rem]",modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,editorOption:l},null),a.suffix?W("span",{class:"text-secondary text-[1.2rem] leading-[1] mt-[1rem]",innerHTML:" * ".concat(a.suffix)},null):W("span",null,null)]),a.attr)}return Ta(a.name,a.attr,{attrs:{class:"!w-[244px] relative;",placeholder:"请输入".concat(a.name)},slots:{unit:()=>Ye(a)},rules:[{required:!1,message:"请输入".concat(a.name),trigger:"blur"}]})}},Be=(a,e,t)=>Ea(a.appTypeCN,()=>{var e;let l,s;return W("div",null,[(null==(e=Qe.value[Je(a)])?void 0:e.appname)&&W(da,{class:"!w-[12rem]",modelValue:Qe.value.form[a.apptype],"onUpdate:modelValue":e=>Qe.value.form[a.apptype]=e},we(l=a.appname.map(a=>W(ua,{label:a,value:a},null)))?l:{default:()=>[l]}),W(da,{modelValue:Qe.value[$e(a)].service_name,"onUpdate:modelValue":e=>Qe.value[$e(a)].service_name=e,placeholder:0==Qe.value[$e(a)].option.length?"未安装":"请选择",disabled:0==Qe.value[$e(a)].option.length,class:"ml-[0.8rem] !w-[16rem]"},we(s=Qe.value[$e(a)].option.map(a=>W(ua,{label:a.service_name+" "+a.version,value:a.service_name},null)))?s:{default:()=>[s]}),W("span",{class:"ml-[2rem] text-small leading-[2.2rem] text-tertiary"},[a.appDesc]),0==Qe.value[$e(a)].option.length&&W("div",null,[W("span",{class:"leading-[1] bt-link !text-small",onClick:()=>Ze({name:$e(a),type:a.apptype},t)},[Q("点击安装")])])])}),Ke=L([]),Qe=V({}),Je=({appname:a})=>w(a)?a:a[0],$e=a=>Qe.value.form[a.apptype],Xe=(a,e,t)=>{"domain"===a.attr&&""!==e&&(t.value.allow_access=!1)},Ye=a=>{const e="whitespace-nowrap absolute left-[250px] top-0 text-secondary";return"cpus"===a.attr?W("span",{class:e},[" * ".concat(a.suffix).concat(be.value.maximum_cpu)]):"memory_limit"===a.attr?W("span",{class:e},[" * ".concat(a.suffix).concat(be.value.maximum_memory)]):a.suffix?W("span",{class:e,innerHTML:" * ".concat(a.suffix)},null):W("span",null,null)},Ze=(a,e)=>{Ue.value.openDependInstall(a),e()},at=a=>{if(!(a.indexOf(".")>-1))return!1;const e=a.split(".");return 3===e.length?{x:e[0],yz:"".concat(e[1],".").concat(e[2])}:2===e.length&&{x:e[0],yz:e[1]}},et=async e=>{const t=await(()=>{try{if(Ge.domain&&!I(Ge.domain))return void ke.error("域名格式不正确");let a={...Ge,...-1==Ue.value.appData.appid?{appid:Number(Ue.value.appData.appid)}:{},app_name:Ue.value.appData.appname,disable_domain:Number(!Ge.domain),allow_access:Number(Ge.allow_access),..."true"===Ge.showCompose?{compose_file:Ge.editcompose}:{}};return at(Ge.version)?(a.m_version=at(Ge.version).x,a.s_version=at(Ge.version).yz):(a.m_version=Ge.version,a.s_version=""),Ue.value.appData.depend&&(a.depend_app=[],Object.keys(Qe.value.form).forEach(e=>{const t=Qe.value.form[e];Object.keys(Qe.value).forEach(e=>{if(t===e){if(!Qe.value[e].service_name)throw ke.error("未选择必须依赖项"),new Error("未选择必须依赖项");a.depend_app.push({appname:Qe.value[e].appname,service_name:Qe.value[e].service_name})}})}),a.depend_app=JSON.stringify(a.depend_app)),delete a.showCompose,a}catch(a){}})();t&&a({loading:"正在安装...",request:k(t),message:!0,success:a=>{a.status&&(be.value.app_type="installed",e())}})},tt=()=>{var a,e,t;Ke.value=[],null==(e=null==(a=Ue.value.appData)?void 0:a.appversion)||e.forEach(a=>{a.s_version.length?a.s_version.forEach(e=>{Ke.value.push({label:a.m_version+"."+e,value:a.m_version+"."+e})}):Ke.value.push({label:a.m_version,value:a.m_version})}),Ge.version=null==(t=Ke.value[0])?void 0:t.value},lt=async e=>{var t,l;let s=[];Qe.value.form={},Ue.value=e,(a=>{var e;null==(e=a.field)||e.forEach(a=>{Ge[a.attr]=a.default,"checkbox"===a.type&&(Ge[a.attr]=Boolean(a.default))}),Ge.service_name="".concat(a.appname,"_").concat(x(4))})(e.appData),null==(t=e.appData.depend)||t.forEach(a=>Qe.value.form[a.apptype]=""),null==(l=e.appData.depend)||l.forEach(a=>{a.appname.forEach((e,t)=>{!t&&(Qe.value.form[a.apptype]=e),Qe.value[e]={appname:e,apptype:a.apptype,version:"",service_name:"",option:[]},s.push({app_name:e,app_type:a.apptype})})}),a({request:b({depend_app:JSON.stringify(s)}),data:{data:Array},success:a=>{var e;null==(e=a.data)||e.forEach((a,e)=>{var t;Qe.value[a.appname].service_name=null==(t=a.installed[0])?void 0:t.service_name,Qe.value[a.appname].option=a.installed||[]})}})},st=()=>{Ue.value={},Ge=z({version:"",showCompose:"false",editcompose:""}),Ke.value=[],Qe.value={}};let nt=null,it=[],ot={};const pt=V("run"),rt=L(""),ct=(a,e)=>{try{const a=e.data;it.push(a),it.length>50?rt.value=null==it?void 0:it.slice(it.length-50).join(" "):rt.value=null==it?void 0:it.join(" "),(a.includes("bt_successful")||a.includes("bt_failed"))&&(null==nt||nt.close())}catch(t){null==nt||nt.close()}},dt=a=>{rt.value="",it=[],"run"===a?mt():ft()},ut=()=>{"run"===pt.value?mt():ft()},mt=async()=>{a({request:q({service_name:ot.service_name,app_name:ot.appname}),success:a=>{rt.value=a.data.data}})},vt=a=>{ot=a,ot.isInit?(pt.value="install",ft()):mt()},ft=async()=>{if(ot.isInit)return nt=T({route:"/sock_shell",onMessage:ct}),void(null==nt||nt.send("tail -f "+(null==(e=ot.appinfo.filter(a=>"installed_log"===a.fieldKey)[0])?void 0:e.fieldValue)));var e;a({request:E({service_name:ot.service_name}),success:a=>{rt.value=a.data.data||""}})},_t=()=>{null==nt||nt.close(),nt=null,it=[],ot={},pt.value="run",rt.value=""},yt=z({version:"",backup:!1,pull:!1,id:""}),gt=L([]),ht=async e=>{yt.id=e.id,await a({request:C({id:yt.id}),data:{data:[Array,gt]},success:a=>{yt.version=a.data[0].version}})},xt=async e=>{let t={id:yt.id,m_version:yt.version.split(".")[0],s_version:"".concat(yt.version.split(".")[1],".").concat(yt.version.split(".")[2]),backup:yt.backup,pull:yt.pull};await a({request:D(t),loading:"正在更新,请稍后...",message:!0}),Ce.value=!0,e()},wt=()=>{yt.version="",yt.backup=!1,yt.pull=!1,yt.id="",gt.value=[]},kt=(e,t,l,s)=>{"true"===e&&""===t.value.editcompose&&a({request:j({app_name:l,gpu:"boolean"==typeof t.value.gpu,appid:s}),success:a=>{t.value.editcompose=a.data.data}})},bt=["src"],Ct={src:xe,alt:"icon_plug",key:"icon_plug",class:"AppImg"},Dt={class:"AppContent"},jt={class:"w-full flex items-start justify-between"},It={class:"flex-col flex flex-grow-0"},qt={class:"AppRow"},Et=["title"],Tt={key:0,class:"flex items-center"},At={key:0,class:"flex items-center"},zt={key:1},Rt={class:"mx-8px"},Ot=["innerHTML","title"],St={key:1,class:"AppDescribe"},Vt={class:"AppRow"},Lt={class:"-m-[12px]"},Mt=["onClick"],Pt=["onClick"],Ht=["title","onClick"],Nt={class:"flex items-center flex-1"},Ft={class:"flex items-center"},Ut={class:"truncate max-w-[24rem]"},Gt={key:0,class:"flex"},Wt={key:0,class:"absolute bottom-14px w-[80%]"},Bt={key:1,class:"tag-container absolute bottom-6"},Kt=m(M({__name:"index",props:{data:{default:()=>({})}},emits:["refresh"],setup(a,{emit:e}){const t=a,{refs:{deployMenuData:l}}=ka(),s=V("");P(t,async()=>{s.value="",await je(t.data,s)}),H(async()=>{await je(t.data,s)});const n=e,i=va(()=>{switch(t.data.status){case"running":return["运行中","success"];case"exited":return["已停止","danger"];case"initializing":return["安装中","info"];default:return["异常","warning"]}});return(e,t)=>{const o=u,p=fa,r=oa,c=ya,d=sa,m=_a;return F(),U("div",{class:$(["AppItem relative",{"!h-[12.8rem]":!a.data.installed}])},[B(s)?(F(),U("img",{src:B(s),key:a.data.appname,class:"AppImg"},null,8,bt)):(F(),U("img",Ct)),G("div",Dt,[G("div",jt,[G("div",It,[G("div",qt,[G("span",{class:$(["text-medium font-600",{"truncate leading-[22px] !font-normal flex-1 max-w-[20rem]":a.data.installed,"flex items-center":!a.data.installed}]),title:a.data.installed?a.data.service_name:a.data.apptitle},[G("span",null,ta(a.data.installed?a.data.service_name:a.data.apptitle),1),a.data.installedCount?(F(),U("span",{key:0,class:"mx-8px bt-link text-small font-normal",onClick:t[0]||(t[0]=a=>B(l).app_type="installed")},"已安装 ("+ta(a.data.installedCount)+")",1)):la("",!0),a.data.help?(F(),Z(o,{key:1,href:a.data.help,target:"_blank",class:"ml-8px bt-link text-small font-normal"},{default:J(()=>[...t[17]||(t[17]=[Q(" >>帮助",-1)])]),_:1},8,["href"])):la("",!0)],10,Et),a.data.installed?(F(),U("div",Tt,[W(p,{type:B(i)[1],class:$(["mx-[0.8rem]",{"cursor-pointer":"initializing"===a.data.status}]),onClick:t[1]||(t[1]=e=>B(Pe)(a.data,"log",!0))},{default:J(()=>["initializing"===a.data.status?(F(),U("span",At,[...t[18]||(t[18]=[Q("正在安装 ",-1),G("i",{class:"svgtofont-el-loading !text-small animation-spin"},null,-1)])])):(F(),U("span",zt,ta(B(i)[0]),1))]),_:1},8,["type","class"]),W(r,{class:"item",effect:"dark",content:"进入安装目录",placement:"top"},{default:J(()=>[G("i",{class:"svgtofont-folder-open mr-[0.4rem]",onClick:t[2]||(t[2]=e=>B(Le)("path",a.data))})]),_:1}),W(r,{class:"item",effect:"dark",content:"打开日志",placement:"top"},{default:J(()=>[G("i",{class:"svgtofont-left-logs",onClick:t[3]||(t[3]=e=>B(Pe)(a.data,"log"))})]),_:1}),G("span",Rt,"已安装:"+ta(a.data.createat),1)])):la("",!0)]),G("div",null,[a.data.installed?la("",!0):(F(),U("span",{key:0,innerHTML:a.data.appdesc,title:a.data.appdesc,class:"AppNoSetDes"},null,8,Ot)),a.data.installed?(F(),U("div",St,[G("div",Vt,[W(p,{type:"info",class:"mr-[0.8rem]",effect:"plain"},{default:J(()=>[Q("版本:"+ta(a.data.m_version+(a.data.s_version?".":"")+a.data.s_version),1)]),_:1}),(F(!0),U(X,null,Y(a.data.port,(e,t)=>(F(),Z(c,{key:e,trigger:"hover",placement:"bottom",width:"12.5rem","popper-class":"!min-w-[12.5rem]"},{reference:J(()=>[aa(W(p,{type:"info",class:$(["mr-[0.8rem]",B(Se)(a.data)?"cursor-pointer":""]),effect:"plain",onClick:t=>B(Ve)(a.data,e,"http")},{default:J(()=>[Q("端口:"+ta(e),1)]),_:2},1032,["class","onClick"]),[[ea,t<2]])]),default:J(()=>[G("div",Lt,[G("div",{class:"px-[16px] py-[8px] cursor-pointer text-center hover:bg-light",onClick:t=>B(Ve)(a.data,e,"http")},"HTTP协议访问",8,Mt),G("div",{class:"px-[16px] py-[8px] cursor-pointer text-center hover:bg-light",onClick:t=>B(Ve)(a.data,e,"https")},"HTTPS协议访问",8,Pt)])]),_:2},1024))),128)),W(r,{placement:"top"},{content:J(()=>[G("div",null,[(F(!0),U(X,null,Y(a.data.port,(e,t)=>{var l;return aa((F(),U("span",{key:t,class:$(B(Se)(a.data)?"cursor-pointer":""),title:B(Se)(a.data)?"点击访问应用":"",onClick:t=>B(Ve)(a.data,e)},[Q(ta(e)+" ",1),aa(G("span",null,",",512),[[ea,t!==(null==(l=a.data.port)?void 0:l.length)-1]])],10,Ht)),[[ea,t>1]])}),128))])]),default:J(()=>{var e;return[(null==(e=a.data.port)?void 0:e.length)>=3?(F(),Z(p,{key:0,type:"info"},{default:J(()=>{var e;return[Q(" +"+ta((null==(e=a.data.port)?void 0:e.length)-2),1)]}),_:1})):la("",!0)]}),_:1})]),G("div",Nt,[a.data.domain?(F(),Z(p,{key:0,type:"info",class:"mr-[0.8rem] cursor-pointer",effect:"plain",onClick:t[4]||(t[4]=e=>B(Fe)(a.data.domain))},{default:J(()=>[G("div",Ft,[t[19]||(t[19]=G("i",{class:"svgtofont-icon-max-black mr-[0.4rem] !text-base"},null,-1)),W(r,{effect:"dark",content:"点击跳转域名:"+a.data.domain,placement:"top-start"},{default:J(()=>[G("span",Ut,"域名:"+ta(a.data.domain),1)]),_:1},8,["content"])])]),_:1})):la("",!0),a.data.domain?(F(),U("span",{key:1,class:"bt-link",onClick:t[5]||(t[5]=e=>B(Me)(a.data))}," >管理网站")):la("",!0)])])):la("",!0)])]),a.data.installed?(F(),U("div",Gt,["ollama"===a.data.appname||"ollama_and_openwebui"===a.data.appname||"deepseek_r1"===a.data.appname?(F(),Z(d,{key:0,size:"small",onClick:t[6]||(t[6]=e=>B(ze)(a.data.appname,a.data))},{default:J(()=>[...t[20]||(t[20]=[Q("模型管理",-1)])]),_:1})):la("",!0),"mysql"===a.data.appname||"redis"===a.data.appname||"postgresql"===a.data.appname||"tdengine"===a.data.appname?(F(),Z(d,{key:1,size:"small",onClick:t[7]||(t[7]=e=>B(ze)(a.data.appname,a.data))},{default:J(()=>[...t[21]||(t[21]=[Q("终端",-1)])]),_:1})):la("",!0)])):la("",!0),a.data.installed?la("",!0):(F(),Z(d,{key:1,type:"primary",onClick:t[8]||(t[8]=e=>B(qe)(a.data))},{default:J(()=>[...t[22]||(t[22]=[Q("安装",-1)])]),_:1}))]),a.data.installed?(F(),U("div",Wt,[W(m,{class:"!my-[0.8rem] w-full"}),W(d,{size:"small",onClick:t[9]||(t[9]=e=>B(Ae)(a.data))},{default:J(()=>[...t[23]||(t[23]=[Q("详情 ",-1)])]),_:1}),W(d,{size:"small",onClick:t[10]||(t[10]=e=>B(Pe)(a.data,"back"))},{default:J(()=>[...t[24]||(t[24]=[Q("备份",-1)])]),_:1}),"exited"===a.data.status?(F(),Z(d,{key:0,size:"small",onClick:t[11]||(t[11]=e=>B(He)(n,"start",{service_name:a.data.service_name,appname:a.data.appname}))},{default:J(()=>[...t[25]||(t[25]=[Q("启动 ",-1)])]),_:1})):la("",!0),"exited"!==a.data.status?(F(),Z(d,{key:1,size:"small",onClick:t[12]||(t[12]=e=>B(He)(n,"stop",{service_name:a.data.service_name,appname:a.data.appname}))},{default:J(()=>[...t[26]||(t[26]=[Q("停止 ",-1)])]),_:1})):la("",!0),W(d,{size:"small",onClick:t[13]||(t[13]=e=>B(He)(n,"restart",{service_name:a.data.service_name,appname:a.data.appname}))},{default:J(()=>[...t[27]||(t[27]=[Q("重启 ",-1)])]),_:1}),W(d,{type:"default",plain:"",size:"small",class:"danger-button",onClick:t[14]||(t[14]=e=>B(He)(n,"rebuild",{service_name:a.data.service_name,appname:a.data.appname}))},{default:J(()=>[...t[28]||(t[28]=[Q("重建 ",-1)])]),_:1}),W(d,{type:"default",plain:"",size:"small",class:"danger-button",onClick:t[15]||(t[15]=e=>B(Ne)(n,{appname:a.data.appname,id:a.data.id}))},{default:J(()=>[...t[29]||(t[29]=[Q("卸载",-1)])]),_:1}),B(Ie)(a.data)?(F(),Z(d,{key:2,size:"small",onClick:t[16]||(t[16]=e=>B(Te)(a.data))},{default:J(()=>[...t[30]||(t[30]=[Q("更新",-1)])]),_:1})):la("",!0)])):la("",!0),a.data.installed?la("",!0):(F(),U("div",Bt,[W(p,{type:"info"},{default:J(()=>[Q(ta(a.data.appTypeCN),1)]),_:1}),-1==a.data.appid?(F(),Z(p,{key:0,type:"success",class:"ml-4"},{default:J(()=>[...t[31]||(t[31]=[Q("外部应用",-1)])]),_:1})):la("",!0)]))])],2)}}}),[["__scopeId","data-v-234f2b3e"]]),Qt={class:"pr-[1.5rem]"},Jt={class:"w-full !h-[4rem] p-2rem inline-block flex justify-center items-center text-small"},$t={class:"text-small"},Xt=m(M({__name:"index",setup(a){const{mainHeight:e,mainWidth:t}=s(),{refs:{deployMenuData:l}}=ka(),{refs:{isRefreshAppList:n,isRefreshInstallList:i}}=v(),o=V(null),p=V(null),r=va(()=>t.value<1125?1:t.value<1632?2:3),c=va(()=>(t.value-35)/r.value);return P(()=>l.value.app_type,async a=>{o.value.scrollTop=0,fe.value=!1,"installed"===a?(clearTimeout(_e),await ge("all"),he()):clearTimeout(_e)}),P(()=>n.value,a=>{a&&(Pa(Ma),n.value=!1)}),P(()=>i.value,a=>{a&&(clearTimeout(_e),ge("all"),i.value=!1)}),P(()=>La.list.length,a=>{p.value.scrollToPosition(0),p.value.handleResize()}),H(()=>{"installed"===l.value.app_type?i.value=!0:n.value=!0}),ga(()=>{clearTimeout(_e)}),(a,t)=>{const s=u,n=_a,i=xa;return F(),U("div",{ref_key:"scrollContainerRef",ref:o,style:ha("height:".concat(B(e)-260,"px")),class:"overflow-hidden relative scrollBox"},[aa(W(B(qa),{ref_key:"virtualScrollRef",ref:p,class:"AppList",style:ha("height:".concat(B(e)-280,"px;width: calc(20px + ").concat(B(c),"px * ").concat(B(r),");")),items:B(La).list,"item-size":"installed"===B(l).app_type?175:145,itemSecondarySize:B(c),gridItems:B(r),buffer:290,"key-field":"index",itemClass:"app-item",onScrollEnd:B(ye)},{default:J(({item:a})=>[G("div",Qt,[W(Kt,{data:a,onRefresh:B(ge)},null,8,["data","onRefresh"])])]),after:J(()=>[B(fe)&&B(La).list.length&&"installed"!==B(l).app_type?(F(),Z(n,{key:0},{default:J(()=>[G("span",Jt,[t[2]||(t[2]=Q("没有更多了,如没有想要的应用可",-1)),W(s,{onClick:B(Da)},{default:J(()=>[...t[1]||(t[1]=[Q("提交需求反馈",-1)])]),_:1},8,["onClick"])])]),_:1})):la("",!0)]),_:1},8,["style","items","item-size","itemSecondarySize","gridItems","onScrollEnd"]),[[ea,B(La).list.length]]),B(La).list.length?la("",!0):(F(),Z(i,{key:0,class:"w-full"},{description:J(()=>[G("span",$t,[t[3]||(t[3]=Q("未查询到搜索内容,请尝试",-1)),G("span",{class:"inline-flex bt-link",onClick:t[0]||(t[0]=a=>B(Xa)(!0))},"更新应用列表"),t[4]||(t[4]=Q("或加入QQ群：767189639反馈",-1))])]),_:1}))],4)}}}),[["__scopeId","data-v-7a8f7a60"]]),Yt={class:"w-full"},Zt=m(M({__name:"index",setup:a=>(ga(()=>{A(["/mod/docker/com/get_apps","/mod/docker/com/get_tags","/mod/docker/com/get_installed_apps"])}),N(()=>{La.list=[],La.total=0,Ma.p=1,Ma.query=""}),(a,e)=>{const t=wa("bt-loading");return F(),U("div",Yt,[W(de,{class:"mb-8px"}),aa(W(Xt,null,null,512),[[t,B(La).loading],[t,"正在加载列表，请稍后...","title"]])])})}),[["__scopeId","data-v-02f5e14a"]]),al=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"}));export{We as a,Be as b,st as c,Qe as d,De as e,Ge as f,kt as g,ht as h,et as i,wt as j,xt as k,yt as l,gt as m,vt as n,_t as o,pt as p,dt as q,Xa as r,rt as s,ut as t,Na as u,Ke as v,al as w};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
