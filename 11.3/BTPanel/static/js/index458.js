import{p as a,n as e,H as t,Q as s,bb as o,W as i,l,ah as r,b as n}from"./utils-lib.js?v=1763689792";import{_ as p}from"./index109.js?v=1763689792";import{_ as u}from"./index118.js?v=1763689792";import{_ as m}from"./index130.js?v=1763689792";import{c,r as d,o as f,v as b,I as _,x as h,y as g,e as w,C as k,D as y,J as j,z as v,W as x,H as C}from"./base-lib.js?v=1763689792";import{c as H,a as R,h as D,g as q,u as A}from"./column.js?v=1763689792";import{q as T}from"./useController6.js?v=1763689792";import{DelBackup as z,BackupSite as E}from"./site.js?v=1763689792";import{u as I}from"./useStore4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";const L={class:"h-full"},O=c({__name:"index",props:{compData:{default:()=>[]}},setup(c){const O=c,{isRefreshList:S}=I(),U=n(),W=d(!1),B=d(),J=d([]),P=d(),Q=[{label:"删除",value:"delete",event:async(a,e,t,s)=>{const o=async a=>await z({id:a.id});await a({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},H()],onConfirm:async()=>(await e(o),await X(),S.value=!0,!1)})}}],{id:V,name:$}=O.compData,F=f({p:1,limit:10,search:V,type:0,table:"backup",total:0}),G=a=>{a.backup_status?U.error("备份中的文件不可下载"):window.open("/download?filename="+a.filename,"_self","noopener,noreferrer")},K=async(e,t=!1)=>{try{"boolean"!=typeof t&&(t=!1),t||await a({width:"40rem",title:"删除备份",content:'<p>删除选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});const s=await z({id:e.id});return t||(U.request(s),S.value=!0),await X(),0===J.value.length&&(F.p=1,X()),s}catch(s){}},M=a=>{e({isAsync:!0,title:"备份日志",area:64,compData:a,component:()=>t(()=>import("./backup-log.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},N=async()=>{(await s({loading:"正在备份站点...",request:E({id:V,backstage:1}),message:!0})).status&&(X(),S.value=!0)},X=async(a=!1,e=!0)=>{e&&(W.value=!0),await s({request:o({p:F.p,limit:F.limit,search:V,type:F.type.toString(),table:"backup"}),data:{data:[Array,J],page:i(F)}}),e&&(W.value=!1),a&&U.success("刷新成功"),clearTimeout(P.value),J.value.some(a=>1===a.backup_status)&&(P.value=setTimeout(()=>{X(!1,!1)},3e3))},Y=x([R(),{label:"文件名称",prop:"name"},{label:"存储位置",width:100,render:a=>{if(-1!=a.filename.indexOf("|")){let e=a.filename.match(/\|(.+)\|/,"$1");return w("span",null,[T[e[1]]])}return w("span",null,[y("本地")])}},D({prop:"size"}),{width:160,prop:"addtime",label:"备份时间"},q({table:"backup"}),A([{isHide:a=>1===a.backup_status,onClick:G,title:"下载"},{isHide:a=>1===a.backup_status,render:a=>w("span",{class:"cursor-pointer text-".concat(a.backup_status?"danger":"primary"),onClick:()=>{a.backup_status?M(a):K(a)}},[a.backup_status?"备份中":"删除",a.backup_status?w("span",{class:"omit"},null):""])}])]);return b(()=>{X()}),(a,e)=>{const t=C,s=m,o=l,i=r,n=u,c=p,d=_("bt-loading");return h(),g("div",L,[w(c,null,{"header-left":k(()=>[w(t,{type:"primary",onClick:N},{default:k(()=>[...e[3]||(e[3]=[y("备份站点",-1)])]),_:1})]),"header-right":k(()=>[w(s,{onRefresh:e[0]||(e[0]=()=>X(!0))})]),content:k(()=>[j(w(o,{ref_key:"routeBackupRef",ref:B,data:v(J),"max-height":408,column:v(Y)},null,8,["data","column"]),[[d,v(W)],[d,"正在加载中，请稍后...","title"]])]),"footer-left":k(()=>[w(i,{options:Q,tableRef:v(B)},null,8,["tableRef"])]),"footer-right":k(()=>[w(n,{page:v(F).p,"onUpdate:page":e[1]||(e[1]=a=>v(F).p=a),row:v(F).limit,"onUpdate:row":e[2]||(e[2]=a=>v(F).limit=a),total:v(F).total,onChange:X},null,8,["page","row","total"])]),_:1})])}}});export{O as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
