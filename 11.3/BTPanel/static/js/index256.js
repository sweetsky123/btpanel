import{bo as e,e as a,H as t}from"./utils-lib.js?v=1763689792";import{_ as l}from"./index110.js?v=1763689792";import{r as i,k as r,g as o,w as u,v as n,n as s,a8 as c,aP as v,x as d,y as f,A as p,F as y,b1 as m,e as _,C as x,D as w,z as b,R as g,G as h,bM as k,al as D,aj as j,B as V}from"./base-lib.js?v=1763689792";import{_ as S}from"./index111.js?v=1763689792";import"./validator.js?v=1763689792";import{getOverviewTop5 as T,getSiteOverviewTop5 as q}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const P={class:"p-16 relative"},z={class:"flex flex-col pb-12"},A={class:"flex"},B={class:"text-secondary text-[12px]"},L={class:"flex items-center gap-2 mt-0.5"},M={class:"text-[18px] font-bold text-darkPrimary"},O={class:"text-[12px] text-secondary mt-0.5"},U={class:"text-[12px] text-tertiary mt-0.5"},C={key:0,class:"flex flex-col pb-12"},E={class:"mb-1"},I={class:"flex flex-col"},N={class:"mb-1"},R={__name:"index",props:{compData:{type:Object,default:()=>({viewType:"all",siteName:""})},visibleMetrics:{type:Array,default:()=>["traffic","req_count","ip_count","uv","pv"]}},setup(R){const F=R,G=i(null),H=i(null),K=i(!1),W=i(null);i("点击领取七天试用");const J=r("siteStatisticsMetric","traffic"),Q=r("siteStatisticsCenterMetric","traffic"),X=r("siteStatisticsSortOrder","desc"),Y=i(null);let Z=null;const $=i(null);let ee=null;const ae=async e=>{K.value=!0,W.value=null;try{return(await T(e)).data.data}catch(a){return W.value=a,null}finally{K.value=!1}},te=e=>{var a,t,l,i,r,o,u,n,s,c,v,d,f,p,y;if(!e)return{today:{},yesterday:{},dayBefore:{}};const{overview_three_days:m}=e;return{today:{traffic:(null==(a=null==m?void 0:m.today)?void 0:a.traffic_bytes)||0,req_count:(null==(t=null==m?void 0:m.today)?void 0:t.req_count)||0,ip_count:(null==(l=null==m?void 0:m.today)?void 0:l.ip_count)||0,uv:(null==(i=null==m?void 0:m.today)?void 0:i.uv)||0,pv:(null==(r=null==m?void 0:m.today)?void 0:r.pv)||0},yesterday:{traffic:(null==(o=null==m?void 0:m.yesterday)?void 0:o.traffic_bytes)||0,req_count:(null==(u=null==m?void 0:m.yesterday)?void 0:u.req_count)||0,ip_count:(null==(n=null==m?void 0:m.yesterday)?void 0:n.ip_count)||0,uv:(null==(s=null==m?void 0:m.yesterday)?void 0:s.uv)||0,pv:(null==(c=null==m?void 0:m.yesterday)?void 0:c.pv)||0},dayBefore:{traffic:(null==(v=null==m?void 0:m.day_before)?void 0:v.traffic_bytes)||0,req_count:(null==(d=null==m?void 0:m.day_before)?void 0:d.req_count)||0,ip_count:(null==(f=null==m?void 0:m.day_before)?void 0:f.ip_count)||0,uv:(null==(p=null==m?void 0:m.day_before)?void 0:p.uv)||0,pv:(null==(y=null==m?void 0:m.day_before)?void 0:y.pv)||0}}},le=e=>{var a;return(null==(a=null==e?void 0:e.trend_7days)?void 0:a.points)?e.trend_7days.points.map(e=>({date:e.date,traffic:e.traffic_bytes,req_count:e.req_count,ip_count:e.ip_count,uv:e.uv,pv:e.pv})):[]},ie=o(()=>G.value?te(G.value):null),re=o(()=>H.value?te(H.value):null),oe=o(()=>{var e,a;return"all"===F.compData.viewType?(null==(e=ie.value)?void 0:e.today)||{}:(null==(a=re.value)?void 0:a.today)||{}}),ue=o(()=>{var e,a;return"all"===F.compData.viewType?(null==(e=ie.value)?void 0:e.yesterday)||{}:(null==(a=re.value)?void 0:a.yesterday)||{}}),ne=o(()=>{var e,a;return"all"===F.compData.viewType?(null==(e=ie.value)?void 0:e.dayBefore)||{}:(null==(a=re.value)?void 0:a.dayBefore)||{}}),se=o(()=>{return"all"!==F.compData.viewType?[]:(e=G.value,(null==(a=null==e?void 0:e.top5_sites)?void 0:a.items)?e.top5_sites.items.map(e=>({name:e.site,traffic:e.traffic_bytes,req_count:e.req_count,ip_count:e.ip_count,uv:e.uv,pv:e.pv})):[]);var e,a}),ce=o(()=>"all"===F.compData.viewType?le(G.value):le(H.value)),ve=async()=>{const a=e("正在获取网站概览数据，请稍后...");try{"all"===F.compData.viewType?G.value=await ae({metric:J.value,order:X.value}):H.value=await(async e=>{K.value=!0,W.value=null;try{return(await q(e)).data.data}catch(a){return W.value=a,null}finally{K.value=!1}})({site_name:F.compData.siteName}),await s(),await pe(),await ye()}finally{a.close()}};u([F.compData.viewType,F.compData.siteName],async()=>{await ve()},{immediate:!0}),u([J,X],async()=>{"all"===F.compData.viewType&&(G.value=await ae({metric:J.value,order:X.value}),await s(),await pe())}),u([Q,ce],async()=>{await s(),await ye()});const de=e=>"traffic"===J.value?_e(e):e,fe={ip_count:"IP",uv:"UV",pv:"PV",req_count:"请求数",traffic:"流量"},pe=async()=>{if("all"!==F.compData.viewType)return;if(await(async()=>{if(!Z&&Y.value){const e=await t(()=>import("./index305.js?v=1763689792"),__vite__mapDeps([]),import.meta.url);Z=e.init(Y.value)}})(),!Z)return;const e=(()=>{if("all"!==F.compData.viewType)return{};const e=se.value.map(e=>({name:e.name,value:e[J.value]}));e.sort((e,a)=>"desc"===X.value?e.value-a.value:a.value-e.value);const a=e.map(e=>e.name),t=e.map(e=>e.value);return{grid:{left:140,right:36,top:36,bottom:36},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{const a=Array.isArray(e)?e[0]:e,t=a.value,l="traffic"===J.value?_e(t):t;return"".concat(a.name,"<br/>").concat(a.seriesName,": ").concat(l)}},xAxis:{type:"value",axisLabel:{formatter:de,color:"#666",fontSize:11}},yAxis:{type:"category",data:a,axisLabel:{color:"#666",fontSize:12}},series:[{name:fe[J.value],type:"bar",data:t,barWidth:14,itemStyle:{color:"#18a058"},label:{show:!0,position:"right",color:"#333",fontSize:12,formatter:e=>"traffic"===J.value?_e(e.value):e.value}}]}})();Z.setOption(e,!0)},ye=async()=>{if(await(async()=>{if(!ee&&$.value){const e=await t(()=>import("./index305.js?v=1763689792"),__vite__mapDeps([]),import.meta.url);ee=e.init($.value)}})(),!ee)return;const e=(()=>{var e;if(!(null==(e=ce.value)?void 0:e.length))return{xAxis:{data:[]},series:[]};const a=Q.value,t=fe[a],l=[...ce.value].sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime());return{grid:{left:80,right:36,top:36,bottom:36},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:e=>{const t=Array.isArray(e)?e[0]:e,l=t.value,i="traffic"===a?_e(l):l;return"".concat(t.name,"<br/>").concat(t.seriesName,": ").concat(i)}},xAxis:{type:"category",data:l.map(e=>xe(e.date)),axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{formatter:e=>"traffic"===a?_e(e):e,color:"#666",fontSize:11}},series:[{name:t,type:"line",data:l.map(e=>e[a]),smooth:!0,areaStyle:{opacity:.1},itemStyle:{color:"#18a058"},lineStyle:{color:"#18a058",width:2},label:{show:!0,position:"top",color:"#333",fontSize:10,formatter:e=>"traffic"===a?_e(e.value):e.value}}]}})();ee.setOption(e,!0)},me=()=>{Z&&Z.resize(),ee&&ee.resize()};n(async()=>{await s(),await pe(),await ye(),window.addEventListener("resize",me)}),c(()=>{if(window.removeEventListener("resize",me),Z){try{Z.dispose()}catch(e){}Z=null}if(ee){try{ee.dispose()}catch(e){}ee=null}});const _e=e=>{if(0===e)return"0 B";if(e<1024)return e+" B";const a=["KB","MB","GB","TB"];let t=-1;do{e/=1024,t++}while(e>=1024&&t<a.length-1);return"".concat(e.toFixed(2)," ").concat(a[t])},xe=e=>{if(!e)return"";const a=new Date(e),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return"".concat(t,"-").concat(l)},we=[{key:"traffic",label:"流量",format:_e},{key:"req_count",label:"请求数"},{key:"ip_count",label:"IP"},{key:"uv",label:"UV"},{key:"pv",label:"PV"}],be=o(()=>we.filter(e=>F.visibleMetrics.includes(e.key)));return(e,t)=>{const i=k,r=a,o=S,u=D,n=j,s=l,c=v("n-text");return d(),f("div",P,[p("div",z,[p("div",A,[(d(!0),f(y,null,m(be.value,e=>(d(),f("div",{key:e.key,class:"text-left flex flex-col pl-[1rem] flex-1 gap-[0.2rem]"},[p("div",B,[_(i,{size:6},{default:x(()=>[t[3]||(t[3]=p("span",{class:"w-4 h-4 bg-primaryDark rounded-full inline-block"},null,-1)),p("span",null,V(e.label),1)]),_:2},1024)]),p("div",L,[p("div",M,V(e.format?e.format(oe.value[e.key]):oe.value[e.key]),1)]),p("div",O,"昨日 "+V(e.format?e.format(ue.value[e.key]):ue.value[e.key]),1),p("div",U,"前日 "+V(e.format?e.format(ne.value[e.key]):ne.value[e.key]),1)]))),128)),p("div",{class:"text-left flex flex-col items-center cursor-pointer pr-[1rem]",onClick:ve},[_(r,{href:"javascript:;",class:"flex items-center justify-center"},{default:x(()=>[...t[4]||(t[4]=[p("i",{title:"",class:"svgtofont-icon-refresh !text-[1.8rem] flex items-center justify-center mr-[0.5rem]"},null,-1),w("刷新",-1)])]),_:1}),_(o,{name:"tools-logo",class:"opacity-90",size:"40"})])])]),"all"===R.compData.viewType?(d(),f("div",C,[p("div",E,[_(i,{class:"w-full flex justify-between"},{default:x(()=>[t[12]||(t[12]=p("strong",{class:"text-[1.6rem] font-bold"},"今日网站排名TOP5",-1)),_(i,null,{default:x(()=>[_(n,{modelValue:b(X),"onUpdate:modelValue":t[0]||(t[0]=e=>g(X)?X.value=e:null)},{default:x(()=>[_(u,{value:"desc"},{default:x(()=>[...t[5]||(t[5]=[w("降序",-1)])]),_:1}),_(u,{value:"asc"},{default:x(()=>[...t[6]||(t[6]=[w("升序",-1)])]),_:1})]),_:1},8,["modelValue"]),_(n,{modelValue:b(J),"onUpdate:modelValue":t[1]||(t[1]=e=>g(J)?J.value=e:null)},{default:x(()=>[_(u,{value:"traffic"},{default:x(()=>[...t[7]||(t[7]=[w("流量",-1)])]),_:1}),_(u,{value:"req_count"},{default:x(()=>[...t[8]||(t[8]=[w("请求数",-1)])]),_:1}),_(u,{value:"ip_count"},{default:x(()=>[...t[9]||(t[9]=[w("IP",-1)])]),_:1}),_(u,{value:"uv"},{default:x(()=>[...t[10]||(t[10]=[w("UV",-1)])]),_:1}),_(u,{value:"pv"},{default:x(()=>[...t[11]||(t[11]=[w("PV",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),p("div",{ref_key:"rankingChartRef",ref:Y,class:"h-[180px]"},null,512)])):h("",!0),p("div",I,[p("div",N,[_(i,{class:"w-full flex justify-between"},{default:x(()=>[t[18]||(t[18]=p("strong",{class:"text-[1.6rem] font-bold"},"近7天统计数据",-1)),_(i,null,{default:x(()=>[_(n,{modelValue:b(Q),"onUpdate:modelValue":t[2]||(t[2]=e=>g(Q)?Q.value=e:null)},{default:x(()=>[_(u,{value:"traffic"},{default:x(()=>[...t[13]||(t[13]=[w("流量",-1)])]),_:1}),_(u,{value:"req_count"},{default:x(()=>[...t[14]||(t[14]=[w("请求数",-1)])]),_:1}),_(u,{value:"ip_count"},{default:x(()=>[...t[15]||(t[15]=[w("IP",-1)])]),_:1}),_(u,{value:"uv"},{default:x(()=>[...t[16]||(t[16]=[w("UV",-1)])]),_:1}),_(u,{value:"pv"},{default:x(()=>[...t[17]||(t[17]=[w("PV",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),p("div",{ref_key:"statsCenterChartRef",ref:$,class:"h-[220px]"},null,512)]),_(s,{direction:"horizontal",class:"!my-6"}),_(i,null,{default:x(()=>[_(c,{depth:"3"},{default:x(()=>[...t[19]||(t[19]=[w(" 此为简易网站数据统计，如需更详细的数据详情，请使用网站监控报表",-1)])]),_:1})]),_:1})])}}};export{R as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
