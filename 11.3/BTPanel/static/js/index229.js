import{c as e,r as a,g as s,v as l,x as r,y as d,e as o,C as t,z as u,F as i,b1 as m,O as n,D as p,S as c,U as _,ad as v,am as b,an as f,ab as g}from"./base-lib.js?v=1763689792";import{y as w,Q as h,M as j,k as y,e as V,_ as x}from"./utils-lib.js?v=1763689792";import{_ as k}from"./index107.js?v=1763689792";import{g as C}from"./useStore2.js?v=1763689792";import{a as S,m as U}from"./useMethod4.js?v=1763689792";import{addModulesDatabase as q}from"./database.js?v=1763689792";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";const A={class:"p-[24px]"},D=x(e({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(e,{expose:x}){const D=e,{refs:{tabActive:I},refreshTableList:E}=C(),F=a(),L=a(!1),Q=a([]),z=s(()=>{var e,a;return(null==(a=null==(e=Q.value)?void 0:e.find(e=>e.id===H.value.sid))?void 0:a.db_host)||""}),H=a({name:"",db_user:"",password:w(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MySQL",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),O={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]},{validator:(e,a,s)=>{/^\d/.test(a)&&s(new Error("数据库名不能以数字开头")),s()}}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},R=e=>{H.value.db_user=e,H.value.ps=e},T=async()=>{try{L.value=!0;const{status:e,msg:a,err_msg:s}=await U(H.value.sid);if(!e)throw j.error(s),new Error("服务器连接失败");L.value=!1}catch(e){}};return l(async()=>{var e,a;Q.value=await(null==(e=D.compData)?void 0:e.refresh())||[],H.value.sid=null==(a=Q.value[0])?void 0:a.id}),x({onConfirm:async e=>{await F.value.validate(),await T();let a={...H.value,sid:String(H.value.sid)};await h({loading:"正在添加数据库, 请稍后...",request:q(a,I.value),message:!0}),E(),e()}}),(e,a)=>{const s=_,l=v,h=y,j=k,x=b,C=f,U=V,q=g;return r(),d("div",A,[o(q,{disabled:u(L),model:u(H),ref_key:"addFormRef",ref:F,rules:O,onSubmit:a[5]||(a[5]=c(()=>{},["prevent"]))},{default:t(()=>[o(l,{label:"数据库名",prop:"name"},{default:t(()=>[o(s,{class:"w-[38rem]",ref:"data_name",placeholder:"新的数据库名称",modelValue:u(H).name,"onUpdate:modelValue":a[0]||(a[0]=e=>u(H).name=e),onInput:R},null,8,["modelValue"])]),_:1}),o(l,{label:"用户名",prop:"db_user"},{default:t(()=>[o(h,{width:"38rem",placeholder:"数据库用户",modelValue:u(H).db_user,"onUpdate:modelValue":a[1]||(a[1]=e=>u(H).db_user=e)},null,8,["modelValue"])]),_:1}),o(l,{label:"密码",prop:"password"},{default:t(()=>[o(j,{width:"38rem",icon:"el-refresh",modelValue:u(H).password,"onUpdate:modelValue":a[2]||(a[2]=e=>u(H).password=e),modelModifiers:{sync:!0},onIconClick:a[3]||(a[3]=()=>u(H).password=u(w)(16)),isActive:!0},null,8,["modelValue"])]),_:1}),o(l,{label:"添加至",prop:"sid",class:"!mb-0"},{default:t(()=>[o(C,{class:"!w-[24rem]",modelValue:u(H).sid,"onUpdate:modelValue":a[4]||(a[4]=e=>u(H).sid=e)},{default:t(()=>[(r(!0),d(i,null,m(u(Q),(e,a)=>(r(),n(x,{key:a,label:e.ps+(e.db_host?"（"+e.db_host+"）":""),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(U,{class:"ml-[8px]",onClick:u(S)},{default:t(()=>[...a[6]||(a[6]=[p("管理远程数据库",-1)])]),_:1},8,["onClick"])]),_:1}),o(l,{label:" ",class:"!mb-0"},{default:t(()=>[o(M,{server:{sid:u(H).sid,ip:u(z)}},null,8,["server"])]),_:1})]),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-293d7cff"]]);export{D as default};
