import{M as a,aK as e,Q as l,j as s}from"./utils-lib.js?v=1763689792";import{c as t,r as o,o as n,x as r,y as u,e as d,C as i,F as m,b1 as c,D as f,A as p,z as v,R as b,H as y,as as _,ar as x,an as w,ad as S,ab as T,B as g,O as h,at as j,am as V}from"./base-lib.js?v=1763689792";import{g as k}from"./useStore2.js?v=1763689792";import{syncDataToPanel as C,syncModuleDataToPanel as L}from"./database.js?v=1763689792";import{r as M,n as q}from"./useMethod4.js?v=1763689792";const D={class:"inline-block flex flex-col py-[1.2rem] mb-[0.8rem]"},F={class:"text-secondary text-base mb-[8px]"},H=["innerHTML"],R={class:"p-[16px]"},A=t({__name:"index",props:{compData:{default:()=>[]}},setup(t){var A;const N=t,{refs:{tabActive:O,isRefreshClassList:U},refreshTableList:z}=k(),B=o(N.compData),J=o((null==(A=B.value[0])?void 0:A.id)||""),K=n({}),P=o(),Q=o(!1),E=[{label:"从面板同步到服务器",name:"SyncToServer",description:"将面板的数据库同步到本地服务器中"},{label:"从服务器同步到面板",name:"SyncToPanel",description:"从服务器获取所有数据库，并同步到面板中<br>（数据库密码无法同步，需在面板重新配置）"}],G=async a=>{if("SyncToServer"===a)I();else{const a=await M();J.value=a[0].id,B.value=a,Q.value=!0}},I=async()=>{const l=a.load("正在同步...");try{const e=await q();a.request(e),z()}catch(s){e(s,"syncToServer")}finally{l.close()}},W=async()=>{await P.value.validate();let a={sid:Number(J.value)};await l({loading:"正在获取数据库,请稍候...",request:"mysql"===O.value?C(a):L({data:JSON.stringify(a)},O.value),message:!0}),U.value=!0,setTimeout(()=>{z()},1e3)};return(a,e)=>{const l=y,t=j,o=_,n=x,k=V,C=w,L=S,M=T,q=s;return r(),u("div",null,[d(n,{onCommand:G},{dropdown:i(()=>[d(o,null,{default:i(()=>[(r(),u(m,null,c(E,(a,e)=>d(t,{command:a.name,key:e},{default:i(()=>[p("div",D,[p("span",F,g(a.label),1),p("span",{class:"text-tertiary text-small leading-1.8rem",innerHTML:a.description},null,8,H)])]),_:2},1032,["command"])),64))]),_:1})]),default:i(()=>[d(l,{type:"default"},{default:i(()=>[...e[2]||(e[2]=[f(" 同步数据库 ",-1),p("i",{class:"svgtofont-el-arrow-down ml-4px"},null,-1)])]),_:1})]),_:1}),d(q,{title:"从服务器获取",modelValue:v(Q),"onUpdate:modelValue":e[1]||(e[1]=a=>b(Q)?Q.value=a:null),area:46,onConfirm:W,showFooter:""},{default:i(()=>[p("div",R,[d(M,{ref_key:"syncFormRef",ref:P,model:v(K)},{default:i(()=>[d(L,{label:"数据库位置"},{default:i(()=>[d(C,{modelValue:v(J),"onUpdate:modelValue":e[0]||(e[0]=a=>b(J)?J.value=a:null),class:"!w-[28rem]"},{default:i(()=>[(r(!0),u(m,null,c(v(B),(a,e)=>(r(),h(k,{key:e,value:a.id,label:a.ps+"（服务器地址："+a.db_host+"）"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}});export{A as _};
