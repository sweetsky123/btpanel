import{c as s,t,r as a,o as e,g as r,v as o,I as c,J as l,z as i,x as n,y as d,A as u,L as p,O as g,F as m,e as v,D as f,B as y,G as _,C as k,b1 as w,b6 as h,H as x}from"./base-lib.js?v=1763689792";import{u as S,fJ as b,V as C,aK as E,f as T,ay as j,_ as D}from"./utils-lib.js?v=1763689792";import{aa as A}from"./firewall.js?v=1763689792";import{H}from"./index344.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const I={id:"safeDetectList"},J={class:"progress-header"},M={class:"progress-header-cot"},O={key:0,class:"relative"},L={class:"absolute top-[1.6rem] left-[2.6rem] flex flex-col"},P={class:"progress-header-cot"},V={class:"scanning-progress-title"},z={class:"color-org"},B={class:"color-red"},F={class:"scanning-progress-cont"},G={class:"progress-header-cot"},K={class:"progress-cont-list"},N=["onClick"],q={class:"progress_type"},Q={class:"progress_status"},R={key:0,class:"text-danger"},U={key:1,class:"text-warning"},W={key:1},X={key:2,class:"text-secondary"},Y={key:0},Z={key:0,class:"progress_fold"},$={class:"progress_item_body"},ss={class:"info_cont"},ts={class:"info_cont_desc"},as=D(s({__name:"safeDetect",setup(s){const{payment:D}=S(),as=H(),{authType:es}=t(D.value),rs=a(!1),os=[{color:"#888",text:"未安装"},{color:"#666",text:"良好"},{color:"#e6a23c",text:"警告"},{color:"red",text:"危险"}],cs={system_account:"系统账户",sshd_service:"SSHD远程服务",file_mode:"重要文件权限及属性",software:"重点软件检测",other:"其他项目检测",backdoor:"后门检测",proc:"恶意进程",history:"历史命令",log:"日志排查",rootkit:"rootkit检测"},ls=a({}),is=e({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"var(--el-color-primary)",progressConfig:{system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},statusTotal:{},allArr:[],result:{},progressStatus:{},active:{system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}}),ns=s=>s+" 分";let ds=null;const us=r(()=>is.scanStatus&&!is.isEnd?"正在扫描":ls.value.status?"上次检测时间 "+("刚刚"===b(ls.value.msg.time)?"一分钟内":b(ls.value.msg.time)):"当前未进行安全检测"),ps=a(""),gs=a(""),ms=r(()=>is.scanStatus&&!is.isEnd?"正在扫描-".concat(ps.value):is.isEnd?"检测时间："+C(is.time/1e3,"yyyy-MM-dd"):ls.value.status?"若长时间未检测，服务器可能存在安全风险，建议立即检测":"当前安全风险未知，请立即检测"),vs=(s,t)=>{if(t.data){const s=JSON.parse(t.data.replace(/'/g,'"'));s.hasOwnProperty("callback")?(null==ds||ds.close(),is.scanStatus=!1,is.isEnd=!0,is.time=(new Date).getTime()):(ps.value=s.name,gs.value=s.topic,is.progress=parseInt(s.progress),is.progressConfig[s.topic].push(s),is.progressConfig[s.topic].sort((s,t)=>1===s.status&&1!==t.status?1:1!==s.status&&1===t.status?-1:t.status-s.status),is.statusTotal[s.topic]=fs(is.progressConfig[s.topic]),is.allArr.push(s),3===s.status&&is.error++,2!==s.status&&3!==s.status||is.warn++,1!==s.status&&(is.progressColor="#fc6d26"))}},fs=s=>{const t={};return s.forEach(s=>{t[s.status]?t[s.status]++:t[s.status]=1}),t},ys=()=>"ltd"!==es.value?as.openPayView():(is.scanStatus&&!is.isEnd||is.isEnd,is.scanStatus&&!is.isEnd?(null==ds||ds.close(),void _s()):(is.isEnd&&_s(),is.scanStatus=!0,ds=j({route:"/ws_project",onMessage:vs}),void(null==ds||ds.send({mod_name:"safe_detect",def_name:"get_safe_scan",ws_callback:""})))),_s=()=>{is.scanStatus=!1,is.isEnd=!1,is.error=0,is.warn=0,is.time=0,is.progress=0,is.progressColor="var(--el-color-primary)",is.progressConfig={system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},is.statusTotal={},is.allArr=[],is.result={},is.progressStatus={},is.active={system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}};return o(()=>{(async()=>{try{const s=await A();ls.value=s.data}catch(s){E(s)}})()}),(s,t)=>{var a,e,r;const o=T,S=h,b=x,C=c("bt-loading");return l((n(),d("div",I,[t[6]||(t[6]=u("div",{class:"text-large mb-6"},"服务器安全检测",-1)),u("div",J,[u("div",M,[u("div",{class:p("progresscirclebar "+(i(ls).status?"security ":"")+"text-["+(100===(null==(a=i(ls).msg)?void 0:a.security_count)?" var(--el-color-primary) ":" #fc6d26 ")+"]")},[i(ls).status?(n(),d(m,{key:1},[i(is).scanStatus&&!i(is).isEnd?(n(),d("div",O,[v(S,{class:"animate-spin",type:"circle",percentage:70,"show-text":!1,"stroke-width":4,"define-back-color":"#fff",color:i(is).warn||i(is).error?"#fc6d26":"var(--el-color-primary)",width:100},null,8,["color"]),u("div",L,[v(o,{class:"w-[full] px-[.4rem]",src:"/firewall/icon-safe-detect".concat(i(is).warn||i(is).error?"-org":"",".svg")},null,8,["src"]),t[0]||(t[0]=u("span",{class:"text-small font-bold py-[.4rem] leading-none"}," 安全检测 ",-1))])])):(n(),g(S,{key:1,type:"circle",percentage:null==(e=i(ls).msg)?void 0:e.security_count,format:ns,color:100===(null==(r=i(ls).msg)?void 0:r.security_count)?"var(--el-color-primary)":"#fc6d26",width:100},null,8,["percentage","color"]))],64)):(n(),g(o,{key:0,class:"w-[10rem]",src:"/firewall/icon-safe-detect.svg"}))],2)]),u("div",P,[u("div",V,[i(is).isEnd?(n(),d(m,{key:1},[t[5]||(t[5]=f(" 检测已完成 ",-1)),i(is).error>0||i(is).warn>0?(n(),d(m,{key:0},[t[4]||(t[4]=f(" ，一共发现 ",-1)),i(is).warn>0?(n(),d(m,{key:0},[u("span",z,y(i(is).warn),1),t[1]||(t[1]=f(" 项风险项 ",-1))],64)):_("",!0),i(is).error>0?(n(),d(m,{key:1},[t[2]||(t[2]=f(" （包含 ",-1)),u("span",B,y(i(is).error),1),t[3]||(t[3]=f(" 项危险项，请立即处理） ",-1))],64)):_("",!0)],64)):_("",!0)],64)):(n(),d(m,{key:0},[f(y(i(us)),1)],64))]),i(is).scanStatus?(n(),g(S,{key:0,percentage:i(is).progress,color:i(is).warn||i(is).error?"#fc6d26":"var(--el-color-primary)","stroke-width":10},null,8,["percentage","color"])):_("",!0),u("div",F,y(i(ms)),1)]),u("div",G,[v(b,{type:i(is).scanStatus&&!i(is).isEnd?"warning":"primary",onClick:ys,plain:!(!i(is).scanStatus||i(is).isEnd)},{default:k(()=>[f(y(i(is).scanStatus&&!i(is).isEnd?"取消扫描":i(is).isEnd?"重新检测":"立即检测"),1)]),_:1},8,["type","plain"])])]),u("div",K,[(n(),d(m,null,w(cs,(s,t)=>u("div",{key:t,class:p([t+"_item "+(i(is).active[t]?"active":""),"progress_item"])},[u("div",{class:"progress_item_header",onClick:s=>(s=>{is.active[s]=!is.active[s]})(t)},[u("div",q,[v(o,{class:"title-icon",src:"/firewall/icon-"+t+".svg"},null,8,["src"]),u("span",null,y(s),1)]),u("div",Q,[i(is).statusTotal[t]?(n(),d(m,{key:0},[i(is).statusTotal[t][3]||i(is).statusTotal[t][2]?(n(),d(m,{key:0},[i(is).statusTotal[t][3]?(n(),d("span",R," 发现"+y(i(is).statusTotal[t][3])+"项危险 ",1)):_("",!0),i(is).statusTotal[t][2]?(n(),d("span",U,y((i(is).statusTotal[t][3]?"":"发现")+i(is).statusTotal[t][2])+"项警告 ",1)):_("",!0)],64)):i(is).scanStatus&&i(gs)==t?(n(),d("span",W," 正在扫描... ")):(n(),d("span",X,"无风险项"))],64)):(n(),d(m,{key:1},[i(is).scanStatus&&!i(is).statusTotal[t]?(n(),d("span",Y," 等待扫描 ")):_("",!0)],64))]),i(is).progressConfig[t]&&i(is).progressConfig[t].length?(n(),d("div",Z,[v(o,{src:"/firewall/arrow-down.svg",class:"mt-[.6rem]"})])):_("",!0)],8,N),u("div",$,[i(is).progressConfig[t]&&i(is).progressConfig[t].length?(n(!0),d(m,{key:0},w(i(is).progressConfig[t],(s,t)=>(n(),d("div",{key:t,class:p([s.info?"active":"","progress_item_info"])},[u("div",ss,[u("div",null,y(s.name.replace("分析网站","")),1),u("div",{class:p("text-["+os[s.status<0?0:s.status].color+"]")},y(os[s.status<0?0:s.status].text),3)]),u("div",ts,y(s.info||""),1)],2))),128)):_("",!0)])],2)),64))])])),[[C,i(rs)]])}}}),[["__scopeId","data-v-5428693f"]]);export{as as default};
