import{Q as e,jz as a,jA as t,jB as s,M as n,jC as l,R as r,ch as o,a_ as i,p as u,hy as c,e as d,ao as m,ap as p,L as v,cf as g,ar as h,n as y,k as _,jD as f,aK as w,jE as b,jF as x,jG as k,jH as E,d as j,_ as V,jI as R,jJ as C,jK as P,u as L,jL as q,jM as D,$ as T,jN as I,jO as S,b as z,B as U,ax as O,aj as H,jP as A,jQ as F,jR as B,jS as N,bR as M,H as K,hx as J,j as G,jT as W,jU as Q,jV as X,jW as $,jX as Y,jY as Z,jZ as ee,j_ as ae,y as te,j$ as se,k0 as ne,k1 as le,k2 as re,k3 as oe,k4 as ie,k5 as ue,k6 as ce,k7 as de,k8 as me,k9 as pe,aC as ve,ka as ge,kb as he}from"./utils-lib.js?v=1763689792";import{s as ye,j as _e,r as fe,c as we,e as be,D as xe,aE as ke,x as Ee,y as je,A as Ve,C as Re,z as Ce,R as Pe,B as Le,J as qe,K as De,g as Te,aA as Ie,H as Se,an as ze,am as Ue,b2 as Oe,ap as He,v as Ae,a8 as Fe,i as Be,t as Ne,I as Me,F as Ke,b1 as Je,O as Ge,S as We,G as Qe,q as Xe,L as $e,o as Ye,a0 as Ze,ad as ea,V as aa,ab as ta,w as sa}from"./base-lib.js?v=1763689792";import{n as na,k as la,D as ra}from"./useController4.js?v=1763689792";import{_ as oa}from"./index109.js?v=1763689792";import{B as ia}from"./index442.js?v=1763689792";import{h as ua,F as ca,j as da,g as ma}from"./form-item.js?v=1763689792";import{i as pa,f as va}from"./validator.js?v=1763689792";import{a as ga,c as ha,b as ya,u as _a}from"./column.js?v=1763689792";import{B as fa}from"./index119.js?v=1763689792";import{S as wa}from"./useStore4.js?v=1763689792";import{saveFileBody as ba,getRedirectList as xa}from"./site.js?v=1763689792";import{_ as ka}from"./index123.js?v=1763689792";const Ea=_e("DOCKERSITE-DOMAIN-STORE",()=>{const o=fe();return{isRefreshDomain:fe(!1),port:o,delMultDomainEvent:async e=>{const a=n.load("正在删除域名，请稍后...");try{const{data:a}=await l(e),{data:t}=pa(a);return{data:t.map(e=>({name:e.domain,...e})),status:!0}}catch(t){return{status:!1,msg:"删除域名失败"}}finally{a.close()}},getDomainListEvent:async t=>{try{return{data:(await e({request:a(t)})).data,status:!0}}catch(s){return{status:!1,msg:"获取域名信息失败"}}},addDomainEvent:async a=>{try{const t=await e({loading:"正在添加域名，请稍后...",request:s(a)});return{status:t.status,msg:t.msg,data:t.data}}catch(t){return{status:!1,msg:"添加域名失败"}}},setPortEvent:async a=>{try{return{...await e({loading:"正在设置HTTPS端口，请稍候...",request:t(a),message:!0})}}catch(s){return{status:!1,msg:"设置https端口失败"}}},delDomainEvent:async e=>{var a;let t=n.load("正在删除域名，请稍后...");try{const t=await l(e),s=(null==(a=t.data)?void 0:a.hasOwnProperty("status"))?t.data:t;return r(s.data)?{status:s.status,msg:s.data[0].msg}:{status:s.status,msg:(null==s?void 0:s.data)||(null==s?void 0:s.error_msg)||s.msg}}catch(s){return{status:!1,msg:"删除域名失败"}}finally{t.close()}}}}),ja=()=>ye(Ea()),{siteInfo:Va}=na(),{port:Ra,isRefreshDomain:Ca}=ja(),{getDomainListEvent:Pa,setPortEvent:La,addDomainEvent:qa,delDomainEvent:Da,delMultDomainEvent:Ta}=Ea(),Ia=fe(!1),Sa=fe(""),za=async()=>{var e,a;try{const t=Sa.value,s=["21","25","443","888","8888","8443"];if(""===t)return n.error("域名不能为空"),!1;let l=String(t.match(/:(\d+)/g)).replace(/:/g,"");if(s.includes(l))return n.error("端口不能为常用端口21、25、443、888、8888、8443"),!1;if(!(await Oa()))return!1;const r=(e=>{const{name:a,id:t}=Va.value;return{id:t,site_name:a,domains:e}})(t),o=await qa(r);return o.status&&la({title:"域名添加结果",resultData:(null==(e=null==o?void 0:o.data)?void 0:e.domains)||(null==(a=null==o?void 0:o.data)?void 0:a.data)||[],autoTitle:"添加域名完成"}),Ca.value=!0,Sa.value="",o.status}catch(t){}},Ua=async()=>{try{const e=(()=>{const e=Va.value;return{site_name:e.name,id:e.id}})(),a=await Pa(e);return Ra.value=Number(a.data.https_port)||"未开启",{data:a.data.domain_list,total:a.data.domain_list.length,other:{port:a.data.https_port}}}catch(e){return{data:[],total:0,other:{}}}},Oa=async(e=Sa.value)=>{let a=e.trim().replace(" ","").split("\n");const t=a.findIndex(e=>e.split(":")[0].length<3);for(var s=0;s<a.length;s++){var l=a[s];let e=l.includes(":");if(e&&!o(l))return n.error("第"+(s+1)+"行【"+l+"】域名格式错误"),!1;if(!e&&!i(l))return n.error("第"+(s+1)+"行【"+l+"】域名格式错误"),!1}return-1!==t?(n.error("第 ".concat(t+1," 个域名长度不符合要求（必须大于3个字符）")),!1):a},Ha=async e=>{try{const a=await La({site_name:Va.value.name,https_port:e.value.port});(null==a?void 0:a.status)&&(Ra.value=Number(e.value.port))}catch(a){}},Aa=async e=>{try{await u({icon:"warning-filled",title:"删除【".concat(e.name,"】"),content:"删除".concat(e.name,"后，将无法使用该域名访问网站，是否继续操作？")});const a=(e=>{const{id:a,name:t}=Va.value;return{id:a,site_name:t,domain:e.name,port:e.port}})(e),t=await Da(a);return n.request(t),Ca.value=!0,t}catch(a){}},Fa=async e=>{try{await u({icon:"warning-filled",title:"批量删除",content:"同时删除选中的域名，是否继续？",type:"calc"});let a=[];const t=(e=>{const{name:a}=Va.value,t=e.map(e=>({id:e.id,port:e.port,domain:e.name,site_name:a}));return{del_domain_list:JSON.stringify(t)}})(e);return a=(await Ta(t)).data,await la({resultData:a,autoTitle:"删除域名完成"}),Ca.value=!0,{status:!0,msg:"删除域名成功"}}catch(a){return{status:!1,msg:"删除域名失败"}}},Ba=async()=>{try{return await Ua()}catch(e){return{data:[],total:0,other:{}}}},Na={class:""},Ma={class:"flex items-end mb-[12px]"},Ka=we({__name:"index",setup(e){const{isRefreshDomain:a,port:t}=ja(),s=p([{label:"删除",value:"delete",event:async(e,a,t,s)=>{Fa(t.value)}}]),{BtTable:n,BtBatch:l,config:r}=c({request:Ba,columns:[ga(),{label:"域名",prop:"name",width:400,render:e=>be("div",{class:"truncate"},[be(d,{class:"bt-link",href:"http://".concat(e.name,":").concat(e.port),target:"_blank"},{default:()=>[e.name]})])},{label:"端口",prop:"port"},{label:"操作",align:"right",render:e=>1===r.data.length?be("span",null,[xe("不可操作")]):ke("span",{class:"cursor-pointer bt-link",onClick:()=>{Aa(e)}},"删除")}],extension:[s,m(a)]}),o=()=>{const{BtForm:e,submit:a}=v({data:{port:t.value},options:e=>Te(()=>[ua("HTTPS端口",()=>be(ia,{modelValue:e.value.port,"onUpdate:modelValue":a=>e.value.port=a},null),"port",{attrs:{min:1,max:65535},rules:[g({message:"请输入端口号",trigger:"blur"}),h()]})]),submit:Ha});y({title:"更换端口",area:42,showFooter:!0,component:()=>be(e,{class:"p-2rem"},null),onConfirm:a})};return(e,a)=>{const s=_,r=Ie,i=Se,u=oa;return Ee(),je("div",Na,[Ve("div",Ma,[be(r,{ref:"popover",placement:"top-start",width:"41rem","popper-class":"green-tips-popover !p-0 !border-none",visible:Ce(Ia),"onUpdate:visible":a[2]||(a[2]=e=>Pe(Ia)?Ia.value=e:null),"trigger-keys":[],trigger:"focus"},{default:Re(()=>[...a[3]||(a[3]=[Ve("div",{class:"!p-[12px] bg-primary text-white"},[xe(" 如需绑定外网，请换行填写，每行一个域名，默认为80端口 "),Ve("br"),xe(" IP地址格式：192.168.1.199 "),Ve("br"),xe(" 泛解析添加方法 *.domain.com "),Ve("br"),xe(" 如另加端口格式为 www.domain.com:88 ")],-1)])]),reference:Re(()=>[be(s,{modelValue:Ce(Sa),"onUpdate:modelValue":a[0]||(a[0]=e=>Pe(Sa)?Sa.value=e:null),type:"textarea",resize:"none",rows:4,width:"42rem",onFocus:a[1]||(a[1]=e=>Ia.value=!0),placeholder:"如需绑定外网，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),_:1},8,["visible"]),be(i,{type:"primary",class:"absolute",style:{right:"4rem",top:"5rem"},onClick:Ce(za)},{default:Re(()=>[...a[4]||(a[4]=[xe("添加",-1)])]),_:1},8,["onClick"])]),be(u,null,{"header-right":Re(()=>[Ve("div",null,[xe(" HTTPS端口："+Le(Ce(t))+" ",1),qe(Ve("span",{class:"bt-link cursor-pointer",onClick:o},"更换",512),[[De,"number"==typeof Ce(t)]])])]),content:Re(()=>[be(Ce(n),{"max-height":440})]),"footer-left":Re(()=>[be(Ce(l))]),_:1}),a[5]||(a[5]=Ve("ul",{class:"mt-[.8rem] leading-8 text-small list-disc ml-2rem"},[Ve("li",null,"建议所有域名都使用默认的80端口")],-1))])}}}),Ja=_e("DOCKER-SITE-SITE-DIR-STORE",()=>{const{siteInfo:a}=na(),t=fe([]),s=fe({path:"",run_path:"",userini:!1});return{dirOptions:t,resetData:()=>{t.value=[],s.value.path="",s.value.run_path=""},getFormData:()=>s,getDir:async()=>{try{const t={id:a.value.id},n=await e({loading:"正在获取版本，请稍后...",request:f(t)});n.status?s.value.path=n.data.path:w(n)}catch(t){w(t)}},formData:s,saveDirPath:async(t,s)=>{if(!t)return void n.error("请选择目录");const l={site_name:a.value.name,id:a.value.id,..."path"===s?{path:t}:{run_path:t}};e({loading:"正在获取版本，请稍后...",message:!0,request:"path"===s?x(l):k(l)})},setDirUser:async t=>{const s={id:a.value.id,status:t?1:0};e({loading:"正在设置，请稍后...",message:!0,request:E(s)})},getUserini:async()=>{try{const n={id:a.value.id},l=await e({loading:"正在获取版本，请稍后...",request:b(n)});l.status?(s.value.userini=l.data.userini,s.value.run_path=l.data.runPath.runPath,t.value=l.data.runPath.dirs.map(e=>({label:e,value:e}))):w(l)}catch(n){w(n)}}}}),Ga={class:"p-[2rem] overflow-auto"};const Wa=V(we({__name:"index",setup(e,{expose:a}){const t=Ja(),{dirOptions:s,formData:n}=ye(t),{getDir:l,resetData:r,saveDirPath:o,setDirUser:i,getUserini:u}=t,{BtForm:c}=v({data:()=>n.value,options:e=>Te(()=>[ua("网站目录",()=>be("div",null,[be("div",{class:"formItem"},[be(_,{modelValue:e.value.path,"onUpdate:modelValue":a=>e.value.path=a,width:"32rem"},{append:()=>be(Se,{onClick:()=>(e=>{va({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(a,t)=>{e.value.path=a}})})(e)},{default:()=>[be(j,{icon:"icon-file_mode",class:"cursor-pointer"},null)]})}),be(Se,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.path,"path")},{default:()=>[xe("保存")]})]),be("span",{class:"formTips"},[xe("当前网站的部署目录，可以选择其他目录")])]),"path",{rules:[{required:!1,trigger:"change",message:"请选择网站目录"}]}),ua("运行目录",()=>{let a;return be("div",null,[be("div",{class:"formItem"},[be(ze,{class:"!w-[32rem]",modelValue:e.value.run_path,"onUpdate:modelValue":a=>e.value.run_path=a},(t=a=s.value.map(e=>be(Ue,{key:e.value,label:e.label,value:e.value},null)),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!Be(t)?a:{default:()=>[a]})),be(Se,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.run_path,"run_path")},{default:()=>[xe("保存")]})]),be("span",{class:"formTips"},[xe("部分程序需要指定二级目录作为运行目录，如ThinkPHP5,Laravel")])]);var t},"run_path",{rules:[{required:!1,trigger:"change",message:"请选择网站运行目录"}]}),ca(()=>be("div",null,[be(Oe,null,null),be("div",{class:"formItem"},[be("span",{class:"formLabel"},[xe("防跨站攻击")]),be(He,{class:"mr-[12px]",modelValue:e.value.userini,"onUpdate:modelValue":a=>e.value.userini=a,onChange:i},null),be("span",{class:"text-tertiary"},[xe("防跨站攻击(open_basedir)，防止黑客通过其他网站目录进行入侵攻击")])])]),{key:"userini",rules:[]})])});return Ae(()=>{l(),u()}),Fe(()=>{r()}),a({init:()=>{l(),u()}}),(e,a)=>(Ee(),je("div",Ga,[be(Ce(c))]))}}),[["__scopeId","data-v-9a7e95ec"]]),Qa=_e("SITE-PSEUDO-STORE",()=>({delPseudoStaticEvent:async a=>{try{await e({loading:"正在删除伪静态规则，请稍候...",request:R(a),message:!0})}catch(t){return{status:!1,msg:"删除失败"}}},getReWriteListEvent:async a=>{try{const{data:t}=await e({request:C(a)});return{data:t,status:status}}catch(t){return{status:!1,msg:"获取伪静态列表失败"}}},setTemplateEvent:async a=>{try{const t=await e({loading:"正在设置模板，请稍候...",request:P(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"设置模板失败"}}}})),{siteInfo:Xa}=na(),{getFileEvent:$a}=wa(),{plugin:Ya,getGlobalInfo:Za}=L(),{webserver:et}=Ne(Ya.value),{delPseudoStaticEvent:at,getReWriteListEvent:tt,setTemplateEvent:st}=Qa(),nt=fe(""),lt=fe([]),rt=fe(""),ot=fe([]),it=fe(!1),ut=fe(""),ct=fe(!1),dt=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],mt=e=>!lt.value.includes(e),pt=async e=>{await u({title:"删除伪静态模板【".concat(e.name,"】"),content:"删除后不可恢复，确定删除吗？",icon:"warning-filled"});(await at(e)).status&&(await vt(),await ht())},vt=async()=>{const e={siteName:Xa.value.name};ct.value=!0;const a=await tt(e);gt(a.data),ct.value=!1},gt=async e=>{ot.value=e.rewrite,lt.value=e.default_list,ut.value=e.sitePath+"/.htaccess",rt.value=e.rewrite[0]||""},ht=async(e={site_name:Xa.value.name})=>{try{ct.value=!0;const a=e.path?await $a(e):await q(e);return nt.value=a.data.data,ct.value=!1,a}catch(a){return ct.value=!1,{data:"获取伪静态内容失败"}}},yt=e=>{let a="/www/server/panel/rewrite/".concat(et.value,"/").concat(e,".conf");ht({path:"0.当前"===e?"":a})},_t=async(e={rewrite_conf:nt.value,site_name:"".concat(Xa.value.name)})=>{const a=await D(e);n.request(a),a.status&&vt()},ft=async()=>{await Za(),await vt(),await ht()},wt={class:"h-full"},bt={class:"flex items-center justify-between"},xt={class:"flex items-center justify-between"},kt=["onClick"],Et={class:"flex items-center"},jt={class:"my-[12px]"},Vt=we({__name:"index",setup(e){const a=()=>{const{BtForm:e,submit:a}=v({options:()=>Te(()=>[{type:"input",label:"模板名称",key:"name",attrs:{placeholder:"请输入模板名称"},rules:[{required:!0,message:"请输入模板名称",trigger:"blur"}]}]),submit:async(e,a)=>(await a(),await(async e=>{try{const a={...e,data:nt.value};if(a.name=a.name.trim(),a.name.includes(" "))return n.error("模板名称不能包含空格");if(""===a.name)return n.error("模板名称不能为空");if(ot.value.includes(a.name))return n.error("模板名称不能和已有的模板名称重复且不可为空");const t=await st(a);return t.status&&(it.value=!1,await vt(),await ht()),t.status}catch(a){return!1}})(e.value))});y({title:"另存为模板",area:42,showFooter:!0,component:()=>be(e,{class:"p-2rem"},null),onConfirm:a})};return Ae(ft),(e,t)=>{const s=Ue,n=ze,l=d,r=fa,o=Se,i=T,u=Me("bt-loading");return Ee(),je("div",wt,[qe((Ee(),je("div",null,[Ve("div",bt,[be(n,{class:"!w-[15rem]",modelValue:Ce(rt),"onUpdate:modelValue":t[0]||(t[0]=e=>Pe(rt)?rt.value=e:null),onChange:Ce(yt)},{default:Re(()=>[(Ee(!0),je(Ke,null,Je(Ce(ot),(e,a)=>(Ee(),Ge(s,{key:a,value:e},{default:Re(()=>[Ve("div",xt,[Ve("span",null,Le(e),1),Ce(mt)(e)?(Ee(),je("span",{key:0,class:"el-icon-close cursor-pointer text-base ml-1rem",onClick:We(a=>Ce(pt)({name:e}),["stop"])},null,8,kt)):Qe("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onChange"]),Ve("span",Et,[t[4]||(t[4]=xe("规则转换工具： ",-1)),be(l,{class:"bt-link",href:"https://www.bt.cn/Tools"},{default:Re(()=>[...t[3]||(t[3]=[xe("Apache转Nginx ",-1),Ve("i",{class:"svgtofont-el-link"},null,-1)])]),_:1})])]),Ve("div",jt,[be(r,{id:"staticContentRef",request:!1,class:"!h-[40rem] !w-full border border-dark rounded-base",modelValue:Ce(nt),"onUpdate:modelValue":t[1]||(t[1]=e=>Pe(nt)?nt.value=e:null),onSave:Ce(_t)},null,8,["modelValue","onSave"])]),Ve("div",null,[be(o,{type:"primary",onClick:t[2]||(t[2]=e=>Ce(_t)())},{default:Re(()=>[...t[5]||(t[5]=[xe("保存",-1)])]),_:1}),be(o,{onClick:a},{default:Re(()=>[...t[6]||(t[6]=[xe("另存为模板",-1)])]),_:1})]),be(i,{options:Ce(dt),class:"ml-[20px] mt-[20px]"},null,8,["options"])])),[[u,Ce(ct)],[u,"正在加载内容，请稍候...","title"]])])}}}),Rt=z(),{siteInfo:Ct}=na(),Pt=fe("master"),Lt=fe("server_block"),qt=[{label:"server块",value:"server_block"},{label:"HTTP块",value:"http_block"}],Dt=[{content:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"}],Tt=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'server块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server" target="_blank" rel="noreferrer noopener">点击跳转</a>'}],It=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'http块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#http" target="_blank" rel="noreferrer noopener">点击跳转</a>'}],St=fe(Tt),zt=fe(""),Ut=fe(!1),Ot=async()=>{try{Ut.value=!0;const{data:e}=await I({site_name:Ct.value.name});return e.status?"master"===Pt.value?zt.value=e.data.site_conf:(zt.value=e.data[Lt.value],St.value="server_block"===Lt.value?Tt:It):Rt.error(e.msg),{data:zt.value}}catch(e){return{data:""}}finally{Ut.value=!1}};Xe(()=>{Rt.error("主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作")},3e3);const Ht=async()=>{if("master"===Pt.value)return{status:!1,msg:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"};let e=Rt.load("正在保存内容，请稍候...");try{const e=await S({site_name:Ct.value.name,conf_type:Lt.value,body:zt.value});return Rt.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status}),e}catch(a){return w(a),{status:!1,msg:"保存文件失败"}}finally{e.close()}},At={class:"h-full"},Ft={key:0,class:"mb-1rem text-secondary flex items-center"},Bt={class:"mt-1rem"},Nt={key:0,class:"ml-[20px] mt-[2rem]"},Mt=we({__name:"files",props:{type:{}},setup(e){const a=e;return Ae(()=>{Ot()}),(e,t)=>{const s=O,n=T,l=fa,r=Se,o=Me("bt-loading");return Ee(),je("div",At,[Ve("div",null,["master"!==Ce(Pt)?(Ee(),je("div",Ft,[t[4]||(t[4]=Ve("span",null,"选择配置块：",-1)),be(s,{class:"!w-[16rem]",modelValue:Ce(Lt),"onUpdate:modelValue":t[0]||(t[0]=e=>Pe(Lt)?Lt.value=e:null),options:Ce(qt),onChange:t[1]||(t[1]=e=>Ce(Ot)())},null,8,["modelValue","options"])])):Qe("",!0),qe(be(n,{options:Ce(Dt),"list-style":"none",class:"ml-[12px] text-small mb-1rem"},null,8,["options"]),[[De,"master"===Ce(Pt)]]),qe(be(l,{class:$e(["!w-[64rem] border border-dark rounded-base","master"===a.type?"!h-[50rem]":"!h-[34rem]"]),modelValue:Ce(zt),"onUpdate:modelValue":t[2]||(t[2]=e=>Pe(zt)?zt.value=e:null),id:1e3*Math.random(),editorOption:{readOnly:"master"===Ce(Pt),mode:"ace/mode/nginx"}},null,8,["modelValue","class","id","editorOption"]),[[o,Ce(Ut)]]),Ve("div",Bt,["master"!==Ce(Pt)?(Ee(),Ge(r,{key:0,type:"primary",onClick:Ce(Ht)},{default:Re(()=>[...t[5]||(t[5]=[xe("保存",-1)])]),_:1},8,["onClick"])):Qe("",!0),be(r,{type:"default",onClick:t[3]||(t[3]=e=>Ce(U)({value:Ce(zt)}))},{default:Re(()=>[...t[6]||(t[6]=[xe("复制",-1)])]),_:1})])]),"master"!==Ce(Pt)?(Ee(),je("div",Nt,[be(n,{options:Ce(St)},null,8,["options"])])):Qe("",!0)])}}}),Kt=V(we({__name:"index",setup(e,{expose:a}){const t=Ye({site_conf:"",http_block:"",server_block:""});Ze("configList",t),Ze("tabActive",Pt);const{BtTabs:s}=H({type:"card",value:Pt,options:[{label:"主配置文件",name:"master",render:()=>be(Mt,{type:"master"},null)},{label:"自定义配置文件",name:"custom",lazy:!0,render:()=>be(Mt,{type:"custom"},null)}]});return a({init:Ot}),(e,a)=>(Ee(),je("div",null,[be(Ce(s),{onChange:Ce(Ot)},null,8,["onChange"])]))}}),[["__scopeId","data-v-4ed3f2da"]]),Jt=_e("DOCKERSITE-REDIRECT-STORE",()=>({changeStatusEvent:async a=>{try{const t=await e({loading:"正在修改，请稍后...",request:A(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"修改状态失败"}}},delRedirectEvent:async a=>{try{const t=await e({loading:"正在删除，请稍后...",request:F(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"删除重定向失败"}}},getRedirectFileEvent:async a=>{try{return{data:{content:(await e({loading:"正在获取内容，请稍候...",request:B(a)})).data.data,redirect_conf_file:a.path},status:!0}}catch(t){return{status:!1,msg:"获取配置文件失败"}}},getRedirectDataEvent:async a=>{try{const t=await e({request:xa(a,"proxy"),data:Array});return{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},submitRedirectEvent:async(a,t)=>{try{const s=await e({loading:"正在提交，请稍后...",request:t?A(a):N(a),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{status:!1,msg:"添加重定向失败"}}},isRefreshList:fe(!1),saveFileEvent:async a=>{try{const t=await e({loading:"正在保存内容，请稍候...",request:ba(a),data:{status:Boolean,msg:String},message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"保存文件失败"}}},getDomainListEvent:async t=>{try{return{data:(await e({request:a(t)})).data,status:!0}}catch(s){return{status:!1,msg:"获取域名信息失败"}}}})),Gt=()=>ye(Jt()),{siteInfo:Wt}=na(),{isRefreshList:Qt}=Gt(),{getDomainListEvent:Xt,changeStatusEvent:$t,delRedirectEvent:Yt,getRedirectDataEvent:Zt,getRedirectFileEvent:es,submitRedirectEvent:as,saveFileEvent:ts}=Jt(),ss=fe([]),ns=fe(!1),ls=fe(!1),rs=fe(""),os=fe(""),is=fe(!1),us=fe(),cs=fe(!1),ds=fe(),ms=fe(),ps=[{content:"设置域名重定向后，该域名的404重定向将失效"},{content:"取消重定向时，由于浏览器会缓存重定向信息，在清除缓存前，浏览器仍会根据缓存自动重定向"}],vs=[{content:"重定向类型：表示访问选择的“域名”或输入的“路径”时将会重定向到指定URL"},{content:"目标URL：可以填写你需要重定向到的站点，目标URL必须为可正常访问的URL，否则将返回错误"},{content:"重定向方式：使用301表示永久重定向，使用302表示临时重定向"},{content:"保留URI参数：表示重定向后访问的URL是否带有子路径或参数如设置访问http://b.com"},{content:"重定向到http://a.com 保留URI参数： http://b.com/1.html ---\x3e http://a.com/1.html"},{content:"不保留URI参数：http://b.com/1.html ---\x3e http://a.com"}],gs=e=>{let a={...e,type:e.type?0:1,redirectdomain:JSON.stringify(e.redirectdomain)};return delete a.redirect_conf_file,a.site_name=Wt.value.name,delete a.sitename,a},hs=async(e,a,t,s)=>{const{label:n,value:l}=s,r=new Map([["start","批量启用选中的规则后，配置的重定向域名/目录将会生效"],["stop","批量停用选中的规则后，配置的重定向域名/目录将会失效"],["delete","批量删除当前选中的规则后，配置的重定向域名/目录将会彻底失效"]]),o=async e=>{const a=new Map([["start",A],["stop",A],["delete",F]]),{redirectname:t}=e,s=a.get(l);switch(l){case"start":case"stop":if(s){const a=gs({...e,type:"stop"===l?1:0});return await s(a)}case"delete":if(s)return await s({site_name:Wt.value.name,redirectname:t})}};await e({title:"批量".concat(n),content:"".concat(r.get(l),"，是否继续操作？"),column:[{label:"规则名称",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},ha()],onConfirm:async()=>(await a(o),Qt.value=!0,!1)})},ys=async e=>{try{const a=gs(e),t=await $t(a);return t.status&&(Qt.value=!0),t}catch(a){return{status:!1,msg:"修改状态失败"}}},_s=async e=>{var a;try{await u({title:"删除重定向【".concat("domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath,"】"),content:"删除选中的规则后，配置的重定向域名/目录将指向源地址，是否继续操作？",icon:"warning-filled",type:"calc"});const{name:t}=Wt.value,{redirectname:s}=e,n={proxy:{site_name:t,redirectname:s}},l=await Yt(n.proxy);return l.status&&(Qt.value=!0),l}catch(t){return{status:!1,msg:"删除重定向失败"}}},fs=async(e={data:rs.value,encoding:"utf-8",path:os.value})=>await ts(e),ws=e=>{cs.value=!!e,ms.value=e||!1,y({title:"".concat(e?"编辑":"添加","重定向").concat(e?"【".concat(e.sitename,"】"):""),area:68,component:()=>K(()=>import("./add-redirect.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),btn:!0})},bs=async()=>{var e;try{const a=await(async(e=!1)=>{const a={sitename:Wt.value.name};try{const t=await Zt(a);return e&&n.success("刷新成功"),is.value=!1,us.value=null,Array.isArray(t.data)&&t.data.forEach(e=>{e.errorpage&&(is.value=!0,us.value=e)}),t}catch(t){return{data:[],total:0,other:{}}}})();return ss.value=Array.isArray(a.data)?a.data.map(e=>e.redirectdomain).flat():[],{...a,data:(null==(e=a.data)?void 0:e.map((e,a)=>({...e,id:a+1})))||[]}}catch(a){}},xs=async e=>{try{const a=(e=>{const{name:a}=Wt.value,{holdpath:t,type:s,redirectdomain:n}=e;return{...e,site_name:a,holdpath:t?"1":"0",type:s?"1":"0",redirectdomain:JSON.stringify(n),redirectname:e.redirectname||(new Date).getTime()}})(e),t=await as(a,cs.value);return t.status&&(Qt.value=!0),t.status}catch(a){return!1}},ks=async()=>{try{const e={site_name:Wt.value.name,id:Wt.value.id},a=await Xt(e);return ds.value=cs.value?a.data.domain_list:a.data.domain_list.filter(e=>!ss.value.some(a=>a.includes(e.name))),a}catch(e){return{status:!1,msg:"获取域名失败"}}},Es={class:"h-full"},js={class:"p-[20px]"},Vs=we({__name:"index",setup(e){const a=z(),{isRefreshList:t}=Gt(),s=p([{label:"启用重定向规则",value:"start",event:hs},{label:"停用重定向规则",value:"stop",event:hs},{label:"删除重定向规则",value:"delete",event:hs}]),{BtTable:l,BtRefresh:r,BtBatch:o}=c({request:bs,columns:[ga(),{label:"被重定向",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},{label:"重定向类型",prop:"domainorpath",render:e=>e.errorpage?"错误":"domain"===e.domainorpath?"域名":"路径"},{label:"重定向到",render:e=>e.topath?e.topath:e.tourl},ya({prop:"type",event:ys,data:["已停止","运行中"]}),_a([{width:70,title:"配置文件",onClick:e=>{if(!e.type)return a.warn("请先启用重定向规则再查看配置文件");(async e=>{try{ls.value=!0;let a={path:e.redirect_conf_file};const t=await es(a);t.status?(ns.value=!0,rs.value=t.data.content,os.value=t.data.redirect_conf_file):(n.error(t.msg),ns.value=!1),ls.value=!1}catch(a){ns.value=!1}})(e)}},{title:"编辑",onClick:e=>{ws(e)}},{onClick:_s,title:"删除"}])],extension:[J(),s,m(t)]});return(e,a)=>{const t=oa,s=T,n=G,i=Me("bt-loading");return Ee(),je("div",Es,[be(t,null,{"header-left":Re(()=>[be(Ce(Se),{type:"primary",onClick:a[0]||(a[0]=e=>Ce(ws)())},{default:Re(()=>[...a[5]||(a[5]=[xe("添加重定向",-1)])]),_:1})]),"header-right":Re(()=>[be(Ce(r))]),content:Re(()=>[be(Ce(l),{"max-height":460})]),"footer-left":Re(()=>[be(Ce(o))]),_:1}),be(s,{class:"mt-2rem",options:Ce(ps),"list-style":"disc"},null,8,["options"]),be(n,{title:"编辑配置文件",modelValue:Ce(ns),"onUpdate:modelValue":a[4]||(a[4]=e=>Pe(ns)?ns.value=e:null),area:54},{default:Re(()=>[Ve("div",js,[a[7]||(a[7]=xe(" 提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换 ",-1)),qe(be(Ce(fa),{class:"!h-[36rem] my-[8px]",ref:"aceEditor",modelValue:Ce(rs),"onUpdate:modelValue":a[1]||(a[1]=e=>Pe(rs)?rs.value=e:null),onSave:a[2]||(a[2]=e=>Ce(fs)())},null,8,["modelValue"]),[[i,Ce(ls)]]),be(Ce(Se),{type:"primary",onClick:a[3]||(a[3]=e=>Ce(fs)())},{default:Re(()=>[...a[6]||(a[6]=[xe("保存",-1)])]),_:1}),a[8]||(a[8]=Ve("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},[Ve("li",null,"此处为该重定向的配置文件，若您不了解配置规则,请勿随意修改。")],-1))])]),_:1},8,["modelValue"])])}}}),{siteInfo:Rs}=na(),Cs=fe(),Ps=fe(!1),Ls=fe(!1),qs=Ye({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),Ds=fe(null),Ts=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],Is=e=>{if(!qs.status)return n.error("请先启用防盗链!")},Ss=e=>{qs.status=e,e||(qs.http_status=!1)},zs=async a=>{var t;await Ds.value.validate();let s={...qs,domains:null==(t=qs.domains)?void 0:t.replace(/\n/g,",")};Ps.value?s.site_ids=JSON.stringify(Cs.value.map(e=>e.id)):(s.id=Rs.value.id,s.site_name=Rs.value.name);const n=Q;await e({loading:"正在设置防盗链，请稍后...",request:n(s),message:!Ps.value}),Us(Cs.value)},Us=async e=>{var a,t;if(Cs.value=e||[],!e){const{id:e,name:n}=Rs.value;try{Ls.value=!0;const{data:s}=await W({id:e,name:n});s&&(qs.fix=s.fix||"jpg,jpeg,gif,png,js,css",qs.domains=(null==(t=null==(a=s.domains)?void 0:a.toString())?void 0:t.replace(/,/g,"\n"))||"",qs.return_rule=s.return_rule||"404",qs.http_status=s.http_status||!1,qs.status=s.status||!1)}catch(s){w(s)}finally{Ls.value=!1}}},Os={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},Hs={class:"p-[20px]"},As=we({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:a,emit:t}){const s=e;return Ae(()=>{Us(s.compData)}),a({onConfirm:zs}),(e,a)=>{const t=_,s=ea,n=aa,l=Se,r=ta,o=T,i=Me("bt-loading");return qe((Ee(),je("div",Hs,[be(r,{ref_key:"hotFormRef",ref:Ds,model:Ce(qs),rules:Ce(Os)},{default:Re(()=>[be(s,{label:"URL后缀",prop:"fix"},{default:Re(()=>[be(t,{modelValue:Ce(qs).fix,"onUpdate:modelValue":a[0]||(a[0]=e=>Ce(qs).fix=e),width:"30rem"},null,8,["modelValue"])]),_:1}),be(s,{label:"许可域名"},{default:Re(()=>[be(t,{width:"30rem",modelValue:Ce(qs).domains,"onUpdate:modelValue":a[1]||(a[1]=e=>Ce(qs).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])]),_:1}),be(s,{label:"响应资源",prop:"return_rule"},{default:Re(()=>[be(t,{width:"30rem",modelValue:Ce(qs).return_rule,"onUpdate:modelValue":a[2]||(a[2]=e=>Ce(qs).return_rule=e)},null,8,["modelValue"])]),_:1}),be(s,{label:" "},{default:Re(()=>[be(n,{modelValue:Ce(qs).status,"onUpdate:modelValue":a[3]||(a[3]=e=>Ce(qs).status=e),onChange:Ce(Ss)},{default:Re(()=>[...a[6]||(a[6]=[xe("启用防盗链",-1)])]),_:1},8,["modelValue","onChange"]),be(n,{disabled:!Ce(qs).status,title:"".concat(Ce(qs).status?"":"需开启防盗链"),modelValue:Ce(qs).http_status,"onUpdate:modelValue":a[4]||(a[4]=e=>Ce(qs).http_status=e),onChange:Ce(Is)},{default:Re(()=>[...a[7]||(a[7]=[xe(" 允许空HTTP_REFERER请求 ",-1)])]),_:1},8,["disabled","title","modelValue","onChange"])]),_:1}),Ce(Ps)?Qe("",!0):(Ee(),Ge(s,{key:0,label:" "},{default:Re(()=>[be(l,{type:"primary",onClick:a[5]||(a[5]=e=>Ce(zs)())},{default:Re(()=>[...a[8]||(a[8]=[xe("保存",-1)])]),_:1})]),_:1}))]),_:1},8,["model","rules"]),Ce(Ps)?Qe("",!0):(Ee(),Ge(o,{key:0,options:Ce(Ts),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[i,Ce(Ls)]])}}}),Fs=_e("DOCKERSITE-LOGS-STORE",()=>({getErrorLogsEvent:async e=>{try{const{data:a}=await X(e);return{data:a,status:!0}}catch(a){return{msg:"获取错误日志失败",status:!1}}},getResLogEvent:async e=>{try{const a=await X(e);return{data:a.data,status:a.status}}catch(a){return{msg:"获取日志失败",status:!1}}}})),Bs=z(),{siteInfo:Ns}=na(),Ms=fe("cache"),Ks=fe({site_name:"",domain_list:[],site_port:[],port_conf:"",ssl_port_conf:"",site_path:"",ssl_info:{},err_age_404:"",err_age_502:"",ip_limit:{ip_black:[],ip_white:[]},basic_auth:[],proxy_cache:{},gzip:{},sub_filter:{},websocket:{},security:{},redirect:{},proxy_log:{},http_block:"",server_block:"",remark:"",proxy_info:[],ipv6_status:!1}),Js=async()=>{const e=await $({site_name:Ns.value.name});e.status?Ks.value=e.data:Bs.error(e.msg)},Gs=fe(!1),Ws=fe(!1),Qs=fe(),Xs=Ye({status:!1,time:"",unit:"m"}),$s=[{label:"分钟",value:"m"},{label:"小时",value:"h"},{label:"天",value:"d"}],Ys=[{content:"缓存是一种用于加速网站性能和提高用户体验的技术"},{content:"开启后资源会被缓存，如果影响网站访问请关闭"},{content:"缓存键由主机名、URI 和请求参数组成"},{content:"默认忽略的响应头有：Set-Cookie|Cache-Control|expires|X-Accel-Expires"},{content:"默认缓存的静态资源有：css|js|jpg|jpeg|gif|png|webp|woff|eot|ttf|svg|ico|css.map|js.map"}],Zs={time:[{required:!0,message:"请输入正确的缓存时间",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("目标URL不能为空"))}},{}]},en=async()=>{await u({title:"清理缓存【".concat(Ns.value.name,"】"),width:"35rem",icon:"warning-filled",content:"清理后包含所有URL的及站点的缓存都会被清空,是否继续？"}),await e({loading:"正在清理缓存，请稍后...",request:Y({site_name:Ns.value.name}),message:!0})},an=async()=>{let a={site_name:Ns.value.name,cache_status:Xs.status?1:0,expires:"".concat(Xs.time).concat(Xs.unit)};await Qs.value.validate(),await e({loading:Ws,request:Z(a),message:!0})},tn=fe(),sn=Ye({status:!1,type:"",level:1,minLength:"",unit:"m"}),nn=[{label:"k",value:"k"},{label:"m",value:"m"}],ln=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，例如：1为压缩速度最快，但压缩率较低；9为压缩速度最慢，但压缩率最高，建议默认"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],rn={type:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],minLength:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("压缩最小长度不能为空"))}},{}]},on=e=>{sn.status=e.gzip_status,sn.type=e.gzip_types,sn.level=e.gzip_comp_level;let a="",t="m";e.gzip_min_length&&e.gzip_min_length.length>1&&(a=e.gzip_min_length.slice(0,-1),t=e.gzip_min_length.slice(-1)),sn.minLength=a,sn.unit=t},un=async()=>{const a={site_name:Ns.value.name,gzip_status:sn.status?1:0,gzip_min_length:"".concat(sn.minLength).concat(sn.unit),gzip_comp_level:sn.level,gzip_types:sn.type};await tn.value.validate(),await e({loading:Ws,request:ee(a),message:!0})},cn=Ye({loading:!1,type:"black",white:[],black:[]}),dn=e=>{cn.type="ipBlackList"===Ms.value?"black":"white",hn.value.address="",hn.value.types=cn.type,cn.white=e.ip_white.map(e=>({ip:e,type:"white"})),cn.black=e.ip_black.map(e=>({ip:e,type:"black"}))},mn=async a=>{const t=!!Array.isArray(a);await u({title:"".concat(t?"批量删除IP":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】")),content:t?"批量删除选中的IP，是否继续操作？":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】，是否继续操作？")});let s={site_name:Ns.value.name};t?(s.ip_type=cn.type,s.ips=a.map(e=>e.ip).join("\n")):(s.ip_type=a.type,s.ip=a.ip);const n=t?me:pe;(await e({loading:"正在删除，请稍后...",request:n(s),message:!0})).status&&Js()},pn=fe([ga(),{label:"IP",prop:"ip",minWidth:120},_a([{title:"删除",onClick:e=>{mn(e)}}])]),vn=[{label:"删除IP",value:"delete",event:async(e,a,t,s)=>{mn(t.value)}}],gn=()=>{hn.value.address="",y({isAsync:!0,title:"添加IP".concat("ipBlackList"===Ms.value?"黑":"白","名单"),area:40,btn:"确认",component:()=>K(()=>import("./add-ip.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{listType:cn.type,refreshEvent:()=>{hn.value.address="",Js()}}})},hn=fe({types:cn.type,address:""}),yn=[{content:"一行一条配置，多个IP请换行"}],_n=fe(),fn={address:[{validator:(e,a,t)=>{a.length>0?t():t(new Error("请输入IP地址"))},trigger:["blur","change"]}]},wn=async a=>{const{types:t,address:s}=hn.value,n={site_name:Ns.value.name,ip_type:t,ips:s};(await e({loading:Ws,request:ae(n),message:!0})).status&&(hn.value.address="",Js(),a())},bn=fe([]),xn=e=>{jn.value=e||!1,y({isAsync:!0,title:"".concat(e?"编辑":"添加","http认证").concat(e?"【".concat(e.auth_name,"】"):""),area:48,btn:"确认",component:()=>K(()=>import("./http-auth-add.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{refreshEvent:Js,proxy_info:Ks.value.proxy_info,isEdit:!!e,row:e}})},kn=fe([{label:"名称",prop:"auth_name"},{label:"路径",prop:"auth_path"},_a([{onClick:xn,title:"编辑"},{onClick:async a=>{await u({title:"删除http认证【".concat(a.auth_name,"】"),content:"删除http认证【".concat(a.auth_name,"】，是否继续操作？")});(await e({loading:"正在删除http认证，请稍候...",request:ue({site_name:Ns.value.name,auth_path:a.auth_path,name:a.auth_name}),message:!0})).status&&Js()},title:"删除"}])]),En=e=>{bn.value=e||[]},jn=fe(),Vn=fe({name:te(5),path:"",user:"",password:""}),Rn=[{content:"例如我设置了加密访问/test/,那我访问http://aaa.com/test/时就要输入账号密码才能访问"}],Cn=fe(),Pn={name:[{required:!0,message:"请输入名称",trigger:["blur","change"]}],path:[{required:!0,message:"请输入路径",trigger:["blur","change"]}],user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},Ln=(e,a)=>{const t=Ks.value.proxy_info.map(e=>({value:e.proxy_path}));a(e?t.filter(a=>a.value.includes(e)):t)},qn=async a=>{let t=Vn.value;await Cn.value.validate();const s={site_name:Ns.value.name,auth_path:t.path,username:t.user,password:t.password,name:t.name},n=jn.value?se:ne;(await e({loading:Ws,request:n(s)})).status&&(Js(),a&&a())},Dn=()=>{Object.assign(Vn.value,{name:jn.value?jn.value.auth_name:te(5),path:jn.value?jn.value.auth_path:"",user:"",password:""})},Tn=fe(),In=Ye({type:"default",accessLog:"",address:"",port:"514"}),Sn={accessLog:[{validator:(e,a,t)=>{"file"!==In.type||a?t():t(new Error("请选择日志目录"))},trigger:["blur","change"]}],address:[{validator:(e,a,t)=>{"rsyslog"!==In.type||a?t():t(new Error("请输入接收地址"))},trigger:["blur","change"]}]},zn=[{content:"指定目录可选择自定义的日志存储目录，请注意此目录必须www用户可写"},{content:"发送到远程服务器设置之后本地不会保存日志内容，填写前请确保日志接收端可正常访问"}],Un=[{label:"默认",value:"default"},{label:"不记录日志",value:"off"},{label:"指定目录",value:"file"},{label:"发送到远程服务器",value:"rsyslog"}],On=e=>{va({type:"dir",path:"/www/wwwlogs",change:e=>{In.accessLog=e}})},Hn=e=>{e?(In.type=e.log_type,In.accessLog=e.log_path,In.address=e.rsyslog_host):In.type="default"},An=async()=>{await Tn.value.validate();const a={site_name:Ns.value.name,log_type:In.type,log_path:"file"==In.type?In.accessLog:In.address};await e({loading:"正在设置日志配置，请稍后...",request:ce(a),message:!0})},Fn=Ye({websocket:!1}),Bn=async a=>{(await e({loading:Ws,request:le({site_name:Ns.value.name,websocket_status:a?1:0}),message:!0})).status||(Fn.websocket=!a)},Nn=e=>{Fn.websocket=!!e&&e.websocket_status},Mn=a=>{e({loading:"正在设置，请稍后...",request:re({site_name:Ns.value.name,status:a?"1":"0"}),message:!0})},Kn=async(a,t,s,n)=>{try{const l=await e({loading:a,request:oe({site_name:Ns.value.name})});t.value=l.data.data,s.value=l.data.encoding||"utf-8",n.value=l.data.status}catch(l){}},Jn=async(a,t)=>{e({request:de({site_name:Ns.value.name,file_body:a,encoding:t}),message:!0})},Gn=async()=>{let a={site_name:Ns.value.name,ipv6_status:Ks.value.ipv6_status?"1":"0"};await Qs.value.validate(),await e({loading:Ws,request:ie(a),message:!0})},Wn={class:"h-full"},Qn={class:"mb-[1.6rem]"},Xn={class:"flex"},$n=we({__name:"error-log",setup:e=>(Ae(pl),(e,a)=>{const t=Me("bt-loading");return qe((Ee(),je("div",Wn,[Ve("div",Qn,"日志大小："+Le(Ce(ul).size),1),Ve("div",Xn,[be(ka,{content:Ce(ul).logs,isHtml:!0,fullScreen:{title:"全屏查看[错误]日志",onRefresh:Ce(pl)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"])])])),[[t,Ce(il)]])})}),Yn={class:"h-full"},Zn=we({__name:"response-log",setup:e=>(Ae(hl),(e,a)=>{const t=Me("bt-loading");return Ee(),je("div",Yn,[Ve("div",null,"日志大小："+Le(Ce(vl).size),1),qe(be(ka,{class:"mt-[16px]",content:Ce(vl).logs,isHtml:!0,fullScreen:{title:"全屏查看[响应]日志",onRefresh:Ce(gl)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"]),[[t,Ce(il)]])])})}),el={class:"p-[16px]"},al={class:"mt-[1.6rem]"},tl={class:"mt-[1.6rem]"},sl={class:"ml-[20px]"},nl=we({__name:"config",setup:(e,{expose:a})=>(sa(()=>Ks.value.proxy_log,e=>{Hn(e)}),Ae(()=>{Hn(Ks.value.proxy_log)}),a({onConfirm:An}),(e,a)=>{const t=O,s=ea,n=j,l=Se,r=_,o=ta,i=T,u=Me("bt-loading");return Ee(),je("div",el,[qe((Ee(),Ge(o,{ref_key:"logFormRef",ref:Tn,class:"h-[48rem]",model:Ce(In),"label-width":"60px",rules:Ce(Sn),disabled:Ce(Ws)},{default:Re(()=>[be(s,{label:"日志",prop:"type"},{default:Re(()=>[be(t,{class:"!w-[24rem]",modelValue:Ce(In).type,"onUpdate:modelValue":a[0]||(a[0]=e=>Ce(In).type=e),options:Ce(Un),placeholder:"请选择"},null,8,["modelValue","options"])]),_:1}),qe(Ve("div",al,[be(s,{label:"访问日志",prop:"accessLog"},{default:Re(()=>[be(r,{modelValue:Ce(In).accessLog,"onUpdate:modelValue":a[2]||(a[2]=e=>Ce(In).accessLog=e),placeholder:"请选择或输入目录，例如：/www/wwwlogs",width:"35rem"},{append:Re(()=>[be(l,{onClick:a[1]||(a[1]=e=>Ce(On)("accessLog"))},{default:Re(()=>[be(n,{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),_:1},8,["modelValue"])]),_:1})],512),[[De,"file"===Ce(In).type]]),qe(Ve("div",tl,[be(s,{label:"接收地址",prop:"address"},{default:Re(()=>[be(r,{modelValue:Ce(In).address,"onUpdate:modelValue":a[3]||(a[3]=e=>Ce(In).address=e),placeholder:"接收地址，如：202.96.128.86:9204",width:"24rem"},null,8,["modelValue"])]),_:1})],512),[[De,"rsyslog"===Ce(In).type]]),be(s,{class:"mt-[1.6rem]",label:" "},{default:Re(()=>[be(l,{type:"primary",onClick:Ce(An)},{default:Re(()=>[...a[4]||(a[4]=[xe("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","disabled"])),[[u,Ce(Gs)]]),Ve("div",sl,[be(i,{options:Ce(zn)},null,8,["options"])])])})}),{getErrorLogsEvent:ll,getResLogEvent:rl}=Fs(),{siteInfo:ol}=na(),il=fe(!1),ul=fe({logs:"",size:"0 b"}),cl=fe("response"),dl=fe([{label:"响应日志",name:"response",lazy:!0,render:()=>be(Zn,null,null)},{label:"错误日志",name:"error",lazy:!0,render:()=>be($n,null,null)},{label:"配置",name:"config",lazy:!0,render:()=>be(nl,null,null)}]),ml=()=>{var e;cl.value=(null==(e=ol.value)?void 0:e.tabName)||"response"},pl=async()=>{const e=ol.value.name;try{il.value=!0;const a=await ll({site_name:e,type:"error"});return ul.value.size=a.data.size||"0 b",ul.value.logs=a.data.msg||"暂无日志信息",a}catch(a){return w(a),{msg:"获取错误日志失败",status:!1}}finally{il.value=!1}},vl=Ye({alert:!1,showIp:!1,ipData:0,logs:"",size:"0 b"}),gl=async(e=ol.value.name)=>{try{il.value=!0;const a=await rl({site_name:e,type:"access"});return vl.logs=a.data.msg||"暂无日志信息",vl.size=a.data.size||"0 b",a}catch(a){return w(a),{msg:"获取日志失败",status:!1}}finally{il.value=!1}},hl=async()=>{await gl(),Js()},yl=we({__name:"index",setup:e=>(Ae(ml),(e,a)=>{const t=ve;return Ee(),je("div",null,[be(t,{type:"card",modelValue:Ce(cl),"onUpdate:modelValue":a[0]||(a[0]=e=>Pe(cl)?cl.value=e:null),options:Ce(dl)},null,8,["modelValue","options"])])})}),{siteInfo:_l}=na(),fl=fe([]),wl=()=>({version:"",oldVersion:""}),bl=async a=>{const t=await e({request:ge({id:_l.value.id})});t.status?(a.value.version="".concat(t.data.used.name,":").concat(t.data.used.version),a.value.oldVersion="".concat(t.data.used.name,":").concat(t.data.used.version),fl.value=t.data.runtime_list.map(e=>({label:"PHP-".concat(e.version,"(").concat(e.name,")"),value:"".concat(e.name,":").concat(e.version)}))):n.error(t.msg)},xl={class:"p-[16px]"},kl={class:"ml-[20px]"},El=we({__name:"index",setup(a,{expose:t}){const{BtForm:s,submit:l,param:r}=v({data:wl,options:()=>Te(()=>[da("PHP版本","version",fl.value,{attrs:{class:"!w-[22rem]"},rules:[{required:!0,message:"请选择PHP版本",trigger:"change"}]}),ma("切换",{label:" ",attrs:{type:"primary",onClick:l}})]),submit:async(a,t,s)=>{await t(),(async({version:a,oldVersion:t},s)=>{try{if(a===t)return void n.error("当前版本与原版本一致，无需切换");await u({title:"切换PHP版本",content:"切换PHP版本可能会导致无法访问，是否切换？"}),e({loading:"正在切换PHP版本，请稍后...",request:he({id:_l.value.id,runtime_name:a}),message:!0,success:e=>{e.status&&(s.value.oldVersion=a)}})}catch(l){}})(a.value,r)}});return Ae(()=>{bl(r)}),Fe(()=>{fl.value=[]}),t({init:()=>{bl(r)}}),(e,a)=>{const t=T;return Ee(),je("div",xl,[be(Ce(s)),Ve("div",kl,[be(t,{options:[{content:"切换PHP版本可能会导致网站无法访问"},{content:"如果网站访问异常，建议删除网站重新创建以选择新的PHP版本"}]})])])}}}),jl=V(we({__name:"index",setup(e){const{settingTabActive:a,siteInfo:t}=ye(ra()),s=fe(a.value||"domain"),{BtTabs:n}=H({type:"left-bg-card",value:s,options:[{label:"域名管理",name:"domain",lazy:!0,render:()=>be(Ka,null,null)},{label:"网站目录",name:"dir",lazy:!0,render:()=>be(Wa,null,null)},{label:"反向代理",name:"urlProxy",lazy:!0,render:()=>K(()=>import("./index454.js?v=1763689792").then(e=>e.af),__vite__mapDeps([]),import.meta.url)},{label:"全局配置",name:"golbalConfig",lazy:!0,render:()=>K(()=>import("./index455.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:"伪静态",name:"pseudo",lazy:!0,render:()=>be(Vt,null,null)},{label:"配置文件",name:"configFile",lazy:!0,render:()=>be(Kt,null,null)},{label:"SSL",name:"ssl",lazy:!0,render:()=>K(()=>import("./index456.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},..."PHP"===t.value.type?[{label:"PHP",name:"php",lazy:!0,render:()=>be(El,null,null)}]:[],{label:"重定向",name:"redirect",lazy:!0,render:()=>be(Vs,null,null)},{label:"防盗链",name:"antiLeech",lazy:!0,render:()=>be(As,null,null)},{label:"日志",name:"siteLogs",lazy:!0,render:()=>be(yl,null,null)}]});return sa(()=>a.value,e=>{e&&(s.value=a.value,a.value="")}),(e,a)=>(Ee(),Ge(Ce(n)))}}),[["__scopeId","data-v-59d4f08d"]]),Vl=Object.freeze(Object.defineProperty({__proto__:null,default:jl},Symbol.toStringTag,{value:"Module"}));export{Vl as $,Nn as A,Fn as B,Bn as C,Kn as D,Mn as E,Jn as F,Gn as G,Js as H,ms as I,xs as J,ks as K,ds as L,vs as M,wn as N,hn as O,yn as P,_n as Q,fn as R,Dn as S,vn as T,qn as U,Vn as V,jn as W,Ln as X,Rn as Y,Cn as Z,Pn as _,en as a,Qs as b,Xs as c,Zs as d,Ws as e,Gs as f,Ks as g,Ys as h,sn as i,un as j,tn as k,nn as l,rn as m,ln as n,an as o,dn as p,cn as q,Ms as r,on as s,$s as t,gn as u,pn as v,En as w,xn as x,bn as y,kn as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
