!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach(function(e){r(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function r(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,a,i){var s=r&&r.prototype instanceof c?r:c,p=Object.create(s.prototype);return o(p,"_invoke",function(n,r,a){var o,i,s,c=0,p=a||[],l=!1,f={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,n){return o=e,i=0,s=t,f.n=n,u}};function v(n,r){for(i=n,s=r,e=0;!l&&c&&!a&&e<p.length;e++){var a,o=p[e],v=f.p,h=o[2];n>3?(a=h===r)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=t):o[0]<=v&&((a=n<2&&v<o[1])?(i=0,f.v=r,f.n=o[1]):v<h&&(a=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,f.n=h,i=0))}if(a||n>1)return u;throw l=!0,r}return function(a,p,h){if(c>1)throw TypeError("Generator is already running");for(l&&1===p&&v(p,h),i=p,s=h;(e=i<2?t:s)||!l;){o||(i?i<3?(i>1&&(f.n=-1),v(i,s)):f.n=s:f.v=s);try{if(c=2,o){if(i||(a="next"),e=o[a]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=o.return)&&e.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=t}else if((e=(l=f.n<0)?s:n.call(r,f))!==u)break}catch(e){o=t,i=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,a,i),!0),p}var u={};function c(){}function p(){}function l(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(o(e={},r,function(){return this}),e),v=l.prototype=c.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,o(t,i,"GeneratorFunction")),t.prototype=Object.create(v),t}return p.prototype=l,o(v,"constructor",l),o(l,"constructor",p),p.displayName="GeneratorFunction",o(l,i,"GeneratorFunction"),o(v),o(v,i,"Generator"),o(v,r,function(){return this}),o(v,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:h}})()}function o(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}o=function(t,e,n,r){function i(e,n){o(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},o(t,e,n,r)}function i(t,e,n,r,a,o,i){try{var s=t[o](i),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,a)}function s(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./validator-legacy.js?v=1763689792","./site-legacy.js?v=1763689792","./useStore-legacy4.js?v=1763689792","./useController-legacy5.js?v=1763689792","./useController-legacy22.js?v=1763689792"],function(t,e){"use strict";var r,o,i,u,c,p,l,f,v,h,d,m,y,b,g,w,P,j,S,k,_,T,O,x,I,V,H,q,C,N;return{setters:[function(t){r=t.u,o=t.M,i=t.p,u=t.n,c=t.H,p=t.Q,l=t.aK,f=t.aH},function(t){v=t.s,h=t.r,d=t.o},function(t){m=t.k,y=t.p},function(t){b=t.modifyProjectAsync,g=t.setSitePhpVersion,w=t.setSessionStatus,P=t.setProtectStatus,j=t.getPhpSiteSafeLog,S=t.setPhpVersionSafe,k=t.getSessionStatus,_=t.getProjectRunState,T=t.getSitePhpVersion,O=t.getPhpVersion,x=t.getProtectStatus,I=t.getPhpVersionSafe,V=t.getPhpSiteSafe},function(t){H=t.u,q=t.S},function(t){C=t.u},function(t){N=t.u}],execute:function(){var D=r().payment.value.authType,E=H(),G=E.siteInfo,L=E.isRefreshList,A=q().setSiteInfo,R=v(C()).isRefreshLocalList,F=h(null),M=t("a",d({phpVersion:"",other:"",options:[],helpIndex:0,toggleShow:!1,noInstall:!1})),U=h(""),B=t("c",d({status:!1})),K=t("g",d({status:!1,version:"",deCompatible:!1,today:0,total:0,tips:!0,tipsIndex:0,safeTip:{show:!1,alarmTip:!1,safeTip:!1,allTip:!1}})),Q=t("r",d({list:[],path:""})),$=t("v",h(!1)),z=(t("p",[[{content:"请根据您的程序需求选择版本"}],[{content:"请根据您的程序需求选择版本"},{content:"【自定义】可自定义PHP连接信息，选择此项需填写可用的PHP连接配置"},{content:"【自定义】当前仅支持nginx，可配合[宝塔负载均衡 - 重构版]插件的TCP负载功能实现PHP负载集群"},{content:"【PHP连接配置】支持TCP或Unix配置，示例：192.168.1.25:9001 或 unix:/tmp/php8.sock"}],[{content:"请根据您的程序需求选择版本"},{content:"PHP7不支持mysql扩展，默认安装mysqli以及mysql-pdo。"}],[{content:"请根据您的程序需求选择版本"},{content:"若非必要,请尽量不要使用PHP5.2,这会降低您的服务器安全性；"}]]),t("f",[{content:"开启后将会把session文件存放到独立文件夹，不与其他站点公用存储位置"},{content:"若您在PHP配置中将session保存到memcache/redis等缓存器时，请不要开启此选项"}]),t("l",[{content:"基于PHP内核的监控工具，实时监控网站木马、漏洞等其他入侵行为，发现木马支持自动隔离"},{content:"安全告警默认会监视当前网站访问非当前网站文件的行为(例：你的站点A.com访问了站点B.com的文件或者目录)，通过添加监视器路径，当路径被访问时发送告警/redis等缓存器时，请不要开启此选项"}]),t("e",function(t){M.phpVersion=t,M.toggleShow=t!==K.version,M.noInstall=M.options.some(function(e){return e.key===t&&(null==e?void 0:e.noInstall)}),z(t)}),function(t){switch(t){case"other":M.helpIndex=1;break;case"52":M.helpIndex=3;break;default:"7"===t[0]?M.helpIndex=2:M.helpIndex=0}}),J=function(){var t=s(a().m(function t(){var e,n;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,_({sitename:G.value.name});case 1:e=t.v,(n=e.data).data.is_power_on=1===n.data.is_power_on,A(n.data),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),W=(t("h",function(t){M.other=t,t!==U.value?M.toggleShow=!0:M.toggleShow=!1}),t("s",s(a().m(function t(){var e,r,i,s,u;return a().w(function(t){for(;;)switch(t.n){case 0:if("phpasync"!==(null===(e=G.value)||void 0===e?void 0:e.project_type)){t.n=2;break}return r=o.load("正在保存，请稍后..."),delete(i=n(n(n({sitename:G.value.name},G.value),{},{is_power_on:G.value.is_power_on?1:0},G.value.project_config),{},{php_version:M.phpVersion})).status,delete i.ps,delete i.project_config,t.n=1,b(i);case 1:return s=t.v,r.close(),o.request(s),s.status&&(J(),L.value=!0,M.toggleShow=!1),t.a(2);case 2:if("other"!==M.phpVersion){t.n=3;break}if(""!==M.other){t.n=3;break}return o.error("自定义PHP版本时，PHP连接配置不能为空"),F.value.$refs.inputRef.focus(),t.a(2);case 3:return t.n=4,g({siteName:G.value.name,version:M.phpVersion,other:M.other});case 4:(u=t.v).status?(o.request(u),L.value=!0,R.value=!0,M.toggleShow=!1):o.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:u.msg||u,type:"error",duration:0,showClose:!0}),u.status&&(nt(),N());case 5:return t.a(2)}},t)}))),t("d",function(){var t=s(a().m(function t(e){var n,r;return a().w(function(t){for(;;)switch(t.n){case 0:return n=e?1:0,t.n=1,w({id:G.value.id,act:n});case 1:r=t.v,o.request(r),Z();case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),function(){var t=s(a().m(function t(e){var n,r,o;return a().w(function(t){for(;;)switch(t.n){case 0:if(K.tips=!0,K.version=e,n=["52","00","82"],K.tips=n.includes(e),!K.tips){t.n=1;break}return K.tipsIndex=0,t.a(2);case 1:return t.n=2,f({sName:"security_notice"});case 2:if(r=t.v,o=r.data,K.tips=!0,null!=o&&o.setup||!(o.endtime>=0)){t.n=3;break}K.tipsIndex=1,t.n=5;break;case 3:if(!(o.endtime<0)){t.n=4;break}K.tipsIndex=2,t.n=5;break;case 4:return K.tips=!1,t.n=5,tt();case 5:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),X=(t("j",function(){var t=s(a().m(function t(e){var n;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!K.safeTip.safeTip){t.n=1;break}return K.status=!K.status,o.error("请先开启PHP-".concat(K.version,"防护")),t.a(2);case 1:if(!K.deCompatible){t.n=2;break}return K.status=!K.status,t.a(2,o.error("当前版本不兼容安全防护功能"));case 2:return t.n=3,i({title:"".concat(e?"开启":"关闭","站点安全告警"),width:"35rem",icon:"warning-filled",content:e?"开启后，检测到安全问题时将会发送告警通知，是否继续？":"关闭后，该网站将不再接收安全告警，是否继续？"});case 3:return t.n=4,P({siteName:G.value.name},e);case 4:(n=t.v).status?o.request(n):(K.status=!K.status,o.error("当前PHP版本未开启防护，无法设置该站点！")),t.n=6;break;case 5:t.p=5,t.v,K.status=!K.status;case 6:return t.a(2)}},t,null,[[0,5]])}));return function(e){return t.apply(this,arguments)}}()),t("m",function(){u({area:93,isAsync:!0,title:"【".concat(G.value.name,"】监视器"),component:function(){return c(function(){return e.import("./index-legacy518.js?v=1763689792")},void 0,e.meta.url)},compData:{data:Q.list,name:G.value.name,path:Q.path}})}),t("t",s(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,j({siteName:G.value.name,page:1,limit:10});case 1:if((n=t.v).status){t.n=2;break}return o.error(n.msg),t.a(2);case 2:if(0!=n.data.data.length){t.n=3;break}return o.error("暂无日志"),t.a(2);case 3:u({area:93,isAsync:!0,title:"【".concat(G.value.name,"】网站安全日志"),component:function(){return c(function(){return e.import("./index-legacy519.js?v=1763689792").then(function(t){return t.f})},void 0,e.meta.url)},compData:{data:n.data.data,page:n.data.page}});case 4:return t.a(2)}},t)}))),t("k",s(a().m(function t(){return a().w(function(t){for(;;)if(0===t.n)return t.a(2)},t)}))),t("o",s(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,i({title:"开启【PHP-".concat(K.version,"】防护"),width:"35rem",icon:"warning-filled",content:"开启后，该版本下的所有站点将受到安全防护，是否继续？"});case 1:return t.n=2,p({loading:"正在开启防护，请稍后...",request:S({php_version:K.version,enable:1}),message:!0});case 2:nt();case 3:return t.a(2)}},t)}))),function(){var t=s(a().m(function t(){var e,n;return a().w(function(t){for(;;)switch(t.n){case 0:if("phpasync"!==(null===(e=G.value)||void 0===e?void 0:e.project_type)){t.n=1;break}M.phpVersion=G.value.php_version.replace(".",""),W(M.phpVersion),t.n=3;break;case 1:return t.n=2,T({siteName:G.value.name});case 2:(n=t.v).status&&(M.phpVersion=n.data.phpversion,"other"==M.phpVersion&&(U.value=n.data.php_other,M.other=n.data.php_other),W(n.data.phpversion));case 3:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}()),Y=function(){var t=s(a().m(function t(e){var n,r,o,i,s,u,c;return a().w(function(t){for(;;)switch(t.n){case 0:return r={s_type:1,all:1},"phpasync"===(null===(n=G.value)||void 0===n?void 0:n.project_type)&&delete r.s_type,t.n=1,O(r);case 1:(o=t.v).status&&o.data.length>0&&(u="phpasync"===(null===(i=G.value)||void 0===i?void 0:i.project_type)?null===(s=o.data)||void 0===s?void 0:s.filter(function(t){return"纯静态"!==t.name}):o.data,M.options=u.map(function(t){return{title:t.name+(t.status?"":" (未安装)"),label:t.name,key:t.version,status:t.status}}),c=M.options.find(function(t){return t.key===M.phpVersion}),M.toggleShow=!1,M.noInstall=!c.status,c||(M.options.push({title:"PHP-".concat(M.phpVersion,"(未安装)"),key:M.phpVersion,noInstall:!0}),M.noInstall=!0));case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),Z=function(){var t=s(a().m(function t(){var e,n;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,k({id:G.value.id});case 1:(e=t.v).status&&(B.status=e.data),t.n=3;break;case 2:t.p=2,n=t.v,l(n);case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),tt=function(){var t=s(a().m(function t(){var e,n,r,i,s,u,c,p,f,v,h,d;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,x();case 1:if(s=t.v,!(null!==(e=s.data.msg)&&void 0!==e&&e.includes("插件不存在")||null!==(n=s.data.msg)&&void 0!==n&&n.includes("未购买")||null!==(r=s.data.msg)&&void 0!==r&&r.includes("已到期"))){t.n=2;break}return K.tips=!0,K.tipsIndex=1,"ltd"!==D&&(K.tipsIndex=2),o.error(s.data.msg),t.a(2,!1);case 2:return u=s.data.send,t.n=3,I();case 3:return!1===(c=t.v).status&&o.error(c.msg),p=c.data.php_versions.filter(function(t){return t.v===K.version})||[],!(f=p.length>0&&1!==(null==p||null===(i=p.at(0))||void 0===i?void 0:i.state))&&u||(!u&&(K.safeTip.alarmTip=!0),f&&!u&&(K.safeTip.allTip=!0),f&&(K.safeTip.safeTip=!0),K.safeTip.show=!0),f||(K.safeTip.safeTip=!1,K.safeTip.allTip=!1),u&&(K.safeTip.alarmTip=!1,K.safeTip.allTip=!1),!f&&u&&(K.safeTip.show=!1),t.n=4,V();case 4:(v=t.v).status||o.error(v.msg),(h=v.data.sites.find(function(t){return t.path===G.value.path&&t.site_name===G.value.name}))&&(K.today=h.total.day_total||0,K.total=h.total.total||0,K.status=h.open,K.deCompatible=-1!=h.version.indexOf("暂不兼容"),et(h.config.file_info),Q.path=h.path),t.n=6;break;case 5:t.p=5,d=t.v,l(d);case 6:return t.a(2)}},t,null,[[0,5]])}));return function(){return t.apply(this,arguments)}}(),et=function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(n(n({},t[r]),{},{path:r}));Q.list=e},nt=(t("b",function(){var t=s(a().m(function t(e){var n,r;return a().w(function(t){for(;;)switch(t.n){case 0:try{n=(e||M.phpVersion).split(""),r="php-".concat(n[0],".").concat(n[1]),m({type:"i",name:r})}catch(a){}case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),t("n",s(a().m(function t(){return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,m({type:"i",name:"security_notice"});case 1:t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}))),t("q",function(){y({sourceId:114})}),t("i",s(a().m(function t(){var e;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if($.value=!0,t.p=1,"phpasync"!==(null===(e=G.value)||void 0===e?void 0:e.project_type)){t.n=2;break}return t.n=2,J();case 2:return t.n=3,X();case 3:return t.n=4,Y(!0);case 4:return t.n=5,Z();case 5:t.n=7;break;case 6:t.p=6,t.v;case 7:return t.p=7,$.value=!1,t.f(7);case 8:return t.a(2)}},t,null,[[1,6,7,8]])}))))}}})}();
