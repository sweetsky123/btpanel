import{Q as t,n as e,H as a,p as s,aK as r,cf as o,b as n}from"./utils-lib.js?v=1763689792";import{getProxyUrlData as i,editProxyUrlDataRemark as p,delProxyUrlData as c,editProxyUrlInfo as l,delProxyUrlReplace as u,addProxyUrlReplace as _,proxyUrlCache as m,proxyUrlCompress as y,proxyUrlAddLimit as d,addProxyUrlData as g,proxyUrlBatchDelLimit as h,proxyUrlDelLimit as v}from"./site.js?v=1763689792";import{r as w,o as x,g as b,e as f,aT as k,D as E}from"./base-lib.js?v=1763689792";import{u as q,a as j,c as T}from"./column.js?v=1763689792";import{f as L}from"./validator.js?v=1763689792";import{u as A}from"./useStore4.js?v=1763689792";const N=n(),{siteInfo:z}=A(),I=w({}),R=w(!1),$=[{content:"支持添加多个不同目录的代理"},{content:"如添加后访问异常请尝试清理浏览器缓存"}],P=async()=>{try{const e=await t({request:i({site_name:z.value.name}),data:{data:Array}});return Array.isArray(e.data)?{data:e.data,total:e.data.length}:{data:[],total:0}}catch(e){return{data:[],total:0}}},U=()=>{e({isAsync:!0,title:"添加URL代理",area:60,btn:"确认",component:()=>a(()=>import("./add-url-proxy.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},D=async(e,a)=>{t({loading:"正在修改URL代理备注，请稍后...",request:p({site_name:z.value.name,proxy_path:e.proxy_path,remark:a}),message:!0})},C=t=>{I.value=t,e({isAsync:!0,title:"URL代理设置【".concat(t.proxy_path,"】"),area:[76,60],component:()=>a(()=>import("./setting3.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:t}})},O=async e=>{if("/"===e.proxy_path)return void N.error("根目录不能删除");await s({title:"删除反向代理【".concat(e.proxy_path,"】"),width:"35rem",icon:"warning-filled",content:"您真的要删除反向代理【".concat(e.proxy_path,"】吗？")});(await t({loading:"正在删除，请稍后...",request:c({site_name:z.value.name,proxy_path:e.proxy_path}),message:!0})).status&&(R.value=!0)},B=[{content:"目标：可以填写你需要代理的站点，目标如果选URL地址则必须为可正常访问的URL，如果选UNIX则必须是套接字文件"},{content:"http地址示例：http://127.0.0.1:15700"},{content:"unix地址示例：/tmp/panel.sock"},{content:()=>f("span",null,[E("发送域名：将域名添加到请求头传递到后端服务器，默认为目标URL域名，若设置不当可能导致代理无法正常访问，例如："),f("br",null,null),E("http://192.168.100.20:19888，则发送域名保持$http_host即可"),f("br",null,null),E("http://www.bt.cn，则发送域名应当改为www.bt.cn"),f("br",null,null),E("上面例子仅为常见情况，请以实际为准")])}],V=[{label:"URL地址",value:"http"},{label:"UNIX地址",value:"unix"}],X=()=>{L({type:"file",path:rt.proxysite||"/www",change:t=>{rt.proxysite=t}})},H=x({targetType:"http",sitename:"",cachetime:1,proxysite:"http://",todomain:"$http_host",path:"",ps:"",websocket:!1}),S=w(!1),K=w(!1),Q=w(!1),W=w(),Z=x({proxyname:[{required:!0,message:"请输入代理名称",trigger:"blur"},{validator:(t,e,a)=>{e.length<3?a(new Error("代理名称必须大于3个字符串")):e.match(/^[a-zA-Z0-9_.-]+$/g)?a():a(new Error("代理名称不能包含特殊字符"))}}],proxysite:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(t,e,a)=>{if(!e)return void a(new Error("http"===H.targetType?"目标地址不能为空":"请选择sock文件"));if("unix"===H.targetType)return void a();let s=e.replace(/^http[s]?:\/\//,"");s=s.replace(/(:|\?|\/|\\)(.*)$/,""),/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(s)?H.todomain="$http_host":H.todomain=s,a()}},{}],todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}],path:[{required:!0,message:"请输入根目录",trigger:"blur"}]}),F=async()=>{H.proxysite="http"===H.targetType?"http://":""},G=t=>{if("unix"===H.targetType)return void(H.todomain="$http_host");let e=t.replace(/^http[s]?:\/\//,"");e=e.replace(/(:|\?|\/|\\)(.*)$/,""),H.todomain=e},J=t=>{if("unix"===rt.targetType)return void(rt.todomain="$http_host");let e=t.replace(/^http[s]?:\/\//,"");e=e.replace(/(:|\?|\/|\\)(.*)$/,""),rt.todomain=e},M=()=>{L({type:"file",path:H.proxysite,change:t=>{H.proxysite=t}})},Y=async()=>{const{path:e,proxysite:a,todomain:s,targetType:r,ps:o}=H;let n={site_name:z.value.name,proxy_path:e,proxy_pass:a,proxy_host:s,proxy_type:r,remark:o};await W.value.validate();const i=await t({loading:Q,request:g(n),message:!0});return i.status&&(R.value=!0),i.status},tt=w("proxy"),et=w({proxy_type:"",proxy_path:"",proxy_pass:"",proxy_host:"$http_host",ip_limit:{},basic_auth:{},proxy_cache:{},gzip:{},sub_filter:{},websocket:{},proxy_log:{},custom_config:[],security_referer:{},proxy_conf:"",remark:"",template_proxy_conf:""}),at=async()=>{try{const t=await i({site_name:z.value.name,proxy_path:I.value.proxy_path});if(!t.status)return void N.error(t.msg);et.value=t.data.data}catch(t){r(t)}},st=w(!1),rt=x({targetType:"http",sitename:"",proxysite:"",todomain:"$http_host",path:"",ps:"",websocket:!1,proxy_connect_timeout:30,proxy_send_timeout:30,proxy_read_timeout:30}),ot=b(()=>({proxysite:[{required:!0,message:"http"!==rt.targetType?"请选择sock文件":"请输入目标url",trigger:"blur",validator:(t,e,a)=>{e?a():a(new Error("http"!==rt.targetType?"请选择sock文件":"请输入目标url"))}}],todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}],proxy_connect_timeout:[{required:!0,message:"请输入连接超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("连接超时时间不能为空"))}}],proxy_send_timeout:[{required:!0,message:"请输入后端请求超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("后端请求超时时间不能为空"))}}],proxy_read_timeout:[{required:!0,message:"请输入代理响应超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("代理响应超时时间不能为空"))}}]})),nt=t=>{const{proxy_type:e,proxy_pass:a,proxy_host:s,proxy_path:r,remark:o,global_websocket:n,websocket:i,timeout:p}=t;rt.targetType=e,rt.proxysite=a,rt.todomain=s,rt.path=r,rt.ps=o,st.value=n,rt.websocket=null==i?void 0:i.websocket_status,rt.proxy_connect_timeout=null==p?void 0:p.proxy_connect_timeout,rt.proxy_send_timeout=null==p?void 0:p.proxy_send_timeout,rt.proxy_read_timeout=null==p?void 0:p.proxy_read_timeout},it=async()=>{const{path:e,proxysite:a,todomain:s,targetType:r,ps:o,websocket:n,proxy_connect_timeout:i,proxy_send_timeout:p,proxy_read_timeout:c}=rt,u={site_name:z.value.name,proxy_path:e,proxy_pass:a,proxy_host:s,proxy_type:r,remark:o,websocket:n?1:0,proxy_connect_timeout:i,proxy_send_timeout:p,proxy_read_timeout:c};await W.value.validate();return(await t({loading:Q,request:l(u),message:!0})).status};x({config:""});const pt=x({subfilter:[]}),ct=[{content:"规则解释如下"},{content:"g：替换所有匹配到的关键字"},{content:"i：不区分大小写"},{content:"o：只替换匹配到的第一个"},{content:"r：使用正则表达式"}],lt=async e=>{await t({loading:"正在删除，请稍后...",request:u({site_name:z.value.name,proxy_path:et.value.proxy_path,oldstr:e.oldstr,newstr:e.newstr}),message:!0}),at()},ut=t=>{const e=[t.oldstr,t.newstr],a=t.sub_type.replace(/g/g,""),s=a.includes("i")?"不区分大小写":"",r=a.includes("o")?"只替换第一个":"",o=a.includes("r")?"使用正则表达式":"";switch(a.length){case 0:return"效果:将全部'".concat(e[0],"'替换为'").concat(e[1],"''");case 1:return"效果:将".concat(r?"":"全部","'").concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s||r||o);case 2:return"效果:将".concat(r?"":"全部","'").concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s||r||o,"并且").concat(o||r||s);case 3:return"效果:将'".concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s,"、").concat(r,"并且").concat(o)}},_t=t=>{try{pt.subfilter=t.sub_filter_str}catch(e){}},mt=w([{label:"原关键词",prop:"oldstr"},{label:"替换词",prop:"newstr"},{label:"规则",prop:"mode",width:50,render:t=>f(k,{class:"item",effect:"dark","open-delay":500,content:ut(t),placement:"top-start"},{default:()=>[f("div",{class:"flex items-center"},["".concat(t.sub_type)])]})},q([{title:"删除",onClick:t=>{lt(t)}}])]),yt=()=>{Object.assign(dt,{oldstr:"",newstr:""}),ht.value=[],vt.value="默认效果:将全部'http://www.bt.cn'替换为'https://www.bt.cn'",e({isAsync:!0,title:"添加内容替换【".concat(et.value.proxy_path,"】"),area:60,btn:"确认",component:()=>a(()=>import("./setting-replace-add.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{proxy_path:et.value.proxy_path,subs_filter:et.value.subs_filter}})},dt=x({oldstr:"",newstr:""}),gt={oldstr:[o({message:"请输入原关键词"})]},ht=w([]),vt=w("默认效果:将全部'http://www.bt.cn'替换为'https://www.bt.cn'"),wt=w(),xt=t=>{bt(ht.value)},bt=t=>{const e=t.includes("i")?"不区分大小写":"",a=t.includes("o")?"只替换第一个":"",s=t.includes("r")?"使用正则表达式":"";switch(t.length){case 0:vt.value="默认效果:将全部".concat(dt.oldstr,"替换为").concat(dt.newstr);break;case 1:vt.value="效果:将".concat(a?"":"全部").concat(dt.oldstr,"替换为").concat(dt.newstr,"，匹配时").concat(e||a||s);break;case 2:vt.value="效果:将".concat(a?"":"全部").concat(dt.oldstr,"替换为").concat(dt.newstr,"，匹配时").concat(e||a||s,"并且").concat(s||a||e);break;case 3:vt.value="效果:将".concat(dt.oldstr,"替换为").concat(dt.newstr,"，匹配时").concat(e,"、").concat(a,"并且").concat(s)}},ft=async()=>{await wt.value.validate();const e={site_name:z.value.name,oldstr:dt.oldstr,newstr:dt.newstr,proxy_path:et.value.proxy_path,sub_type:ht.value.length?ht.value.join(""):"g"},a=await t({loading:Q,request:_(e),message:!0});return a.status&&at(),a.status},kt=w(),Et=x({status:!1,time:"1",unit:"d",cache_suffix:"css,js,jpe,jpeg,gif,png,webp,woff,eot,ttf,svg,ico,css.map,js.map"}),qt=[{label:"分钟",value:"m"},{label:"小时",value:"h"},{label:"天",value:"d"}],jt=[{content:"缓存是一种用于加速网站性能和提高用户体验的技术"},{content:"开启后资源会被缓存，如果影响网站访问请关闭"},{content:"缓存键由主机名、URI 和请求参数组成"},{content:"默认忽略的响应头有：Set-Cookie|Cache-Control|expires|X-Accel-Expires"},{content:"默认缓存的静态资源有：css|js|jpg|jpeg|gif|png|webp|woff|eot|ttf|svg|ico|css.map|js.map"}],Tt=t=>{Lt()},Lt=async()=>{const e={site_name:z.value.name,proxy_path:et.value.proxy_path,cache_status:Et.status?1:0,expires:"".concat(Et.time).concat(Et.unit),cache_suffix:Et.cache_suffix.replace(/，/g,",")};await kt.value.validate();return(await t({loading:Q,request:m(e),message:!0})).status},At=w(),Nt=x({status:!1,type:"",level:1,minLength:"",unit:"m"}),zt=[{label:"k",value:"k"},{label:"m",value:"m"}],It=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，例如：1为压缩速度最快，但压缩率较低；9为压缩速度最慢，但压缩率最高，建议默认"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],Rt={type:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],minLength:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):Number(e)<1?a(new Error("请输入正确数字")):a():a(new Error("压缩最小长度不能为空"))}},{}]},$t=t=>{Nt.status=t.gzip_status,Nt.type=t.gzip_types,Nt.level=t.gzip_comp_level;let e="",a="m";t.gzip_min_length&&t.gzip_min_length.length>1&&(e=t.gzip_min_length.slice(0,-1),a=t.gzip_min_length.slice(-1)),Nt.minLength=e,Nt.unit=a},Pt=t=>{Ut()},Ut=async()=>{const e={site_name:z.value.name,proxy_path:et.value.proxy_path,gzip_status:Nt.status?1:0,gzip_min_length:"".concat(Nt.minLength).concat(Nt.unit),gzip_comp_level:Nt.level,gzip_types:Nt.type};await At.value.validate();return(await t({loading:Q,request:y(e),message:!0})).status},Dt=w(),Ct=w(),Ot=x({loading:!1,type:"black",white:[],black:[]}),Bt=t=>{Ot.white=t.ip_white.map(t=>({ip:t,type:"white"})),Ot.black=t.ip_black.map(t=>({ip:t,type:"black"}))},Vt=async e=>{const a=!!Array.isArray(e);await s({title:"".concat(a?"批量删除":"删除").concat("white"===Ot.type?"白":"黑","名单"),content:"".concat(a?"批量删除选中的ip，是否继续操作？":"删除".concat("white"===Ot.type?"白":"黑","名单【").concat(e.ip,"】，是否继续操作？"))});let r={site_name:z.value.name,proxy_path:et.value.proxy_path};a?(r.ips=e.map(t=>t.ip).join("\n"),r.ip_type=Ot.type):(r.ip=e.ip,r.ip_type=e.type);const o=a?h:v;(await t({loading:"正在删除，请稍后...",request:o(r),message:!0})).status&&at()},Xt=w([j({key:"ip"}),{label:"IP",prop:"ip",minWidth:120},q([{title:"删除",onClick:t=>{Vt(t)}}])]),Ht=[{label:"删除IP",value:"delete",event:async(t,e,a,s,r)=>{const o=async t=>await v({site_name:z.value.name,proxy_path:et.value.proxy_path,ip:t.ip,ip_type:"ipBlackList"===tt.value?"black":"white"});await t({title:"批量删除",content:"批量删除选中的ip，是否继续操作？",column:[{prop:"ip",label:"IP"},T()],onConfirm:async()=>(await e(o),at(),!1)})}}],St=()=>{Ot.type="ipBlackList"===tt.value?"black":"white",Bt(et.value.ip_limit)},Kt=()=>{Qt.value.address="",e({isAsync:!0,title:"添加IP".concat("ipBlackList"===tt.value?"黑":"白","名单【").concat(et.value.proxy_path,"】"),area:40,btn:"确认",component:()=>a(()=>import("./setting-ip-add.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{name:z.value.name,proxy_path:et.value.proxy_path,listType:Ot.type,refreshEvent:()=>{at()}}})},Qt=w({types:Ot.type,address:""}),Wt=w(),Zt=[{content:"一行一条配置，多个IP请换行"}],Ft={address:[{validator:(t,e,a)=>{e.length>0?a():a(new Error("请输入IP地址"))},trigger:["blur","change"]}]},Gt=async()=>{const{address:e}=Qt.value,a={site_name:z.value.name,proxy_path:et.value.proxy_path,ip_type:"ipBlackList"===tt.value?"black":"white",ips:e};await Wt.value.validate();const s=await t({loading:Q,request:d(a),message:!0});return s.status&&at(),s.status};export{$t as $,Wt as A,Ft as B,P as C,$ as D,D as E,C as F,O as G,U as H,R as I,nt as J,rt as K,J as L,X as M,st as N,it as O,ot as P,_t as Q,yt as R,pt as S,mt as T,ct as U,Et as V,Tt as W,qt as X,Lt as Y,kt as Z,jt as _,M as a,Nt as a0,Pt as a1,zt as a2,Ut as a3,At as a4,Rt as a5,It as a6,Bt as a7,Ot as a8,Ct as a9,Dt as aa,Kt as ab,St as ac,Xt as ad,Ht as ae,S as b,W as c,Z as d,Q as e,K as f,B as g,G as h,tt as i,at as j,ft as k,dt as l,xt as m,bt as n,Y as o,et as p,vt as q,ht as r,F as s,V as t,H as u,wt as v,gt as w,Gt as x,Qt as y,Zt as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
