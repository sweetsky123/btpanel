import{b6 as e,B as t,M as a,u as n,d as s,n as o,H as l,p as i,Q as r,E as c}from"./utils-lib.js?v=1763689792";import{siteRname as u,getNpsQuestion as p,addSiteTypes as m,modifySiteTypes as d,removeSiteType as v,batchPhpType as _,removeProject as f}from"./site.js?v=1763689792";import{b as y,B as g,c as w}from"./column.js?v=1763689792";import{_ as h}from"./index110.js?v=1763689792";import{c as b,r as j,t as k,v as C,a8 as x,e as D,aA as E,D as S,J as O,I as T}from"./base-lib.js?v=1763689792";import{c as P,h as L}from"./validator.js?v=1763689792";import{u as I,S as A}from"./useStore4.js?v=1763689792";const M=new EventTarget,R=b({props:{onClick:{type:Function,default:()=>{}},row:{type:Object,default:()=>({})},refresh:{type:Function,default:()=>{}}},setup(n,s){const o=j(!1),l=j(!1),i=j(!1),{row:r}=k(n),c=j("site-name-".concat(e(5),"-").concat(r.value.id)),p=()=>{o.value=!1},m=()=>{l.value=!0,o.value=!0;const e=document.getElementById(c.value);e&&setTimeout(()=>{e.focus()},100)},d=e=>{"Enter"!==e.key&&13!==e.keyCode||v(e)},v=async e=>{try{if(r.value.rname===e.target.value)return l.value=!1,void(o.value=!1);const t=await u({id:r.value.id,rname:e.target.value});a.request(t),o.value=!1,l.value=!1,t.status&&n.refresh()}catch(t){o.value=!1}};return C(()=>{M.addEventListener("hide-all-popovers",p)}),x(()=>{M.removeEventListener("hide-all-popovers",p)}),()=>D("div",null,[D(E,{placement:"right",width:"220","popper-class":"myPopover",visible:o.value},{default:()=>D("div",{class:"web_name_hover",onMouseenter:()=>{i.value=!0},onMouseleave:()=>{i.value=!1,l.value||(o.value=!1)}},[D("div",{class:"web_name_title"},[S("网站名："),D("span",{class:"web_name_text"},[l.value?"":r.value.rname,D("input",{id:c.value,class:"bt-input ".concat(l.value?"":"hide"),onKeyup:d,onBlur:v,size:"mini",value:r.value.rname,placeholder:"点击编辑内容，按回车或失去焦点自动保存",style:"width: 140px;"},null)])]),D("div",{class:"web_name_setting"},[D("span",{class:"web_name_copy bt-link",onClick:()=>{t({value:r.value.rname})}},[D("i",{class:"svgtofont-icon-copy mr-4x text-secondary text-medium"},null),S("复制网站名")]),D("span",{onClick:m,class:"web_name_rename bt-link"},[D("i",{class:"svgtofont-icon-memo-active mr-4x text-secondary text-medium"},null),S("重命名")])])]),reference:()=>D("span",{onMouseenter:()=>{M.dispatchEvent(new CustomEvent("hide-all-popovers")),o.value=!0},onMouseleave:()=>{setTimeout(()=>{l.value||i.value||(o.value=!1)},500)},onClick:()=>{n.onClick(r)},class:"justify-start bt-link cursor-pointer"},[r.value.rname])})])}}),{plugin:V}=n(),{isRefreshList:q,activeType:W,batchConfig:F,isSiteMult:J}=I(),{delGeneralProjectEvent:N,getClassList:z,setProjectStatusEvent:B}=A(),G=j(),H=j([]),K=e=>({label:(null==e?void 0:e.label)||"项目名称",prop:"name",minWidth:120,sortable:!0,render:t=>{const a=V.value.web,n="java"===(null==e?void 0:e.type)&&!(t.is_file_ok||void 0===t.is_file_ok);return D("div",{class:"flex items-center inline-block truncate"},[(null==t?void 0:t.waf)&&((null==t?void 0:t.isWaf)||void 0===(null==t?void 0:t.isWaf))?D("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(t,"iconWaf")}},[D(s,{icon:"left-waf",class:"!text-extraLarge ".concat(t.waf.status&&"nginx"===(null==a?void 0:a.type)&&(null==a?void 0:a.status)&&(null==a?void 0:a.setup)?"!text-primary":"!text-tertiary"),size:20},null)]):"",D("span",{class:"!w-full !whitespace-pre-line flex ml-[4px]",title:(null==t?void 0:t.cn_name)&&t.name!==(null==t?void 0:t.cn_name)?null==t?void 0:t.cn_name:""},["php"===(null==e?void 0:e.type)?D(R,{row:t,onClick:()=>e.onClick(t),refresh:()=>{q.value=!0}},null):D("span",{onClick:()=>{n||e.onClick(t)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[t.name])])])}}),Q=e=>{const t=null==e?void 0:e.type;return y({prop:"run",event:e.onClick,data:["未启动","运行中"],width:80,function:a=>{let n=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(n=null!==a[e.prop]),"nodejs"===t&&"pm2"===a.project_config.project_type&&void 0===a.run?O(D("div",{class:"loading h-[2rem]"},null),[[T("bt-loading"),!0]]):D(E,{placement:"right",width:"160","popper-class":"detail-popover",trigger:"hover"},{default:()=>D("div",{class:"flex items-center"},[D("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a)},[n?"停止":"启动"]),D(h,null,null),D("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"restart")},[S("重启")]),D(h,null,null),D("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"setting")},[S("告警设置")])]),reference:()=>D(g,{modelValue:n?1:0,data:["未启动","运行中"],onClick:()=>e.onClick(a)},null)})}})},U=e=>({label:"到期时间",isCustom:!0,sortable:!0,prop:"edate",minWidth:100,width:100,render:e=>{const t=(new Date).setHours(0,0,0,0),a=Date.now(),n="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,s=n&&n<t;return D("span",{class:"cursor-pointer "+(s?"bt-danger":n&&n-a<6048e5?"bt-warn":"bt-link"),onClick:()=>X(e)},[s?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),X=(e,t=!1)=>{o({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>l(()=>import("./index241.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:t},showFooter:!0})},Y=e=>({label:"SSL证书",prop:"site_ssl",isCustom:!0,sortable:!0,minWidth:100,width:100,render:t=>{var a,n,s;return D("span",{class:"cursor-pointer ".concat(-1===t.ssl?"text-warning":(null==(a=t.ssl)?void 0:a.endtime)<0?"text-danger":"text-primary"),onClick:()=>{e.onClick(t)}},[-1===t.ssl?"未部署":(null==(n=t.ssl)?void 0:n.endtime)>0?"剩余".concat(null==(s=t.ssl)?void 0:s.endtime,"天"):"已过期"])}}),Z=()=>({label:"端口",prop:"port",width:120}),$=()=>({label:"部署证书",value:"deploy",event:async(e,t,a,n,s,o)=>{F.value=o,J.value=!0,de(a.value,s)}}),ee=e=>({label:"设置分类",value:"setClass",event:async(t,a,n,s,o,l)=>{await P({name:"分类",options:e.classList.value.filter(e=>"all"!==e.value&&"-2"!==e.value),selectList:n.value,request:async(t,a)=>{const{exclude:s,enable:i}=l,c=L(n.value,s,i,{params:{project_type:W.value.toUpperCase(),id:t.id}});await r({loading:"正在批量设置分类，请稍后...",request:_(c),message:!0}),o&&o(),q.value=!0,a(),e.callback&&e.callback()}})}}),te=(e,t)=>{o({title:(null==e?void 0:e.title)||"批量操作结果",area:t||42,component:()=>l(()=>import("./index125.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},ae=(e,t)=>{const a="go"===e;o({title:"".concat(a?"Go":"Python","-").concat(a?"SDK":"","版本管理"),area:50,component:()=>l(()=>import("./index254.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{type:e,refresh:t}})},ne=async(e,t=W.value)=>{await i({title:"".concat("删除".concat(t,"项目-").concat(e.name)),content:"".concat("风险操作，此操作不可逆，删除".concat(e.name,"项目后您将无法管理该项目，是否继续操作？")),type:"input",input:{content:"删除项目"}});try{const n={python:{data:JSON.stringify({name:e.name})},default:{data:JSON.stringify({project_name:e.name})}},s=n[t]||n.default,o=await N(s);a.request(o),o.status&&(q.value=!0)}catch(n){return a.error("删除失败"),{status:!1,msg:"删除失败"}}},se={get:async()=>{const{data:e}=await z();return H.value=e,e},add:e=>m({...e,ps:""},W.value),update:e=>{const{id:t,...a}=e;return d({type_id:t,...a,ps:""},W.value)},delete:e=>{const{id:t}=e;return v({type_id:t},W.value)}},oe=async(e,t,n=W.value)=>{try{const s=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<s/1e3)return void a.error("项目已过期，请设置站点到期时间后再操作");const o={start:"即将启动项目".concat(e.name,"，确定要启动项目吗？"),stop:"停用项目".concat(e.name,"后，项目将无法访问，确定要停用项目吗？"),restart:"即将重启项目".concat(e.name,"，确定要重启项目吗？")};await i({icon:"warning-filled",title:"设置项目状态",content:o[t]});const l={python:{data:JSON.stringify({name:e.name})},nodejs:{project_name:e.name,project_type:e.project_config.project_type||"nodejs",status:t},java:{project_name:e.name},phpasync:{sitename:e.name,project_action:t},default:{data:JSON.stringify({project_name:e.name})}};let r=l[n]||l.default;"nodejs"===n&&"pm2"===e.project_config.project_type&&(r.pm2_name=e.pm2_name||e.project_config.pm2_name);const c=await B(r,t,n);return q.value=!0,c}catch(s){return{status:!1,msg:"操作失败"}}},le=e=>o({title:"到期提醒配置",area:50,showFooter:!0,confirmText:"保存配置",component:()=>l(()=>import("./ssl-expire-configure.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:!!e,onCancel:(null==e?void 0:e.onCancel)||(()=>{})}),ie=async()=>{var e,t;const{data:n}=await r({request:p({version:-1,product_type:14})});if(!n.status)return a.error("请求失败，请稍候重试");o({component:()=>l(()=>import("./index196.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:52,compData:{name:"网站",type:14,id:null==(e=n.msg[0])?void 0:e.id,description:null==(t=n.msg[0])?void 0:t.question}})},re=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:c.value?"ace/theme/clouds_midnight":"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),ce=e=>o({title:e.title,area:68,component:()=>l(()=>import("./log-details.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e}),ue=async(e,t,a,n)=>{const{label:s,value:o}=n,l=new Map([["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(e,t)=>{const a=new Map([["delete",f]]),{name:n}=e,s=a.get(o);if("delete"===o)if(s){const t=await s({data:JSON.stringify({project_name:n})},W.value);return{...e,batchStatus:t.status?1:2,message:t.status?t.data.msg:t.data.data}}};await e({title:"批量".concat(s),content:"".concat(l.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},w()],onConfirm:async()=>(await t(i),q.value=!0,!1)})},pe={create:"创建文件",modify:"编辑文件",unlink:"删除文件",mkdir:"新建文件夹",rmdir:"删除文件夹",rename:"文件重命名",link:"创建软链",chmod:"修改文件权限",chown:"修改所有者"},me={localhost:"服务器磁盘",alioss:"阿里云OSS",ftp:"FTP",sftp:"SFTP",msonedrive:"微软OneDrive",qiniu:"七牛云",txcos:"腾讯COS",upyun:"又拍云",tianyiyun:"天翼云",jdcloud:"京东云",aws_s3:"亚马逊存储","Google Cloud":"谷歌云","Google Drive":"谷歌网盘",bos:"百度云",obs:"华为云",webdav:"WebDav",minio:"MinIO",dogecloud:"多吉云COS"},de=(e,t)=>o({isAsync:!0,title:"批量设置证书",area:68,component:()=>l(()=>import("./index255.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e,onCancel:()=>{t&&t()}}),ve=(e="all",t)=>{o({isAsync:!0,title:"all"===e?"网站统计总览":"【".concat(t,"】- 站点统计总览"),area:90,component:()=>l(()=>import("./index256.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{viewType:e,siteName:t}})};export{ee as a,ve as b,K as c,U as d,Y as e,G as f,ie as g,Q as h,se as i,ne as j,H as k,ae as l,ue as m,le as n,te as o,Z as p,me as q,re as r,oe as s,pe as t,$ as u,ce as v};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
