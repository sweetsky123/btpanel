import{c as e,r as a,v as l,I as t,x as o,O as s,C as r,e as i,z as u,y as d,b1 as p,F as m,G as n,J as c,D as f,A as y,am as b,an as _,ad as g,V as v,ab as V}from"./base-lib.js?v=1763689792";import{X as D,Q as h,k as j}from"./utils-lib.js?v=1763689792";import{b5 as k,b6 as w,b7 as x}from"./firewall.js?v=1763689792";import{a as C,g as I}from"./useMethod8.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./useStore6.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";const U={class:"mt-20px leading-8 text-small list-disc ml-24px"},E={key:0},H=e({__name:"add-area-rule",props:{compData:{default:()=>{}}},setup(e,{expose:H}){const P=e,q=a(),A=a(!1),O=a([]),F=a({country:["美国"],brief:"",types:"drop",ports:"",choose:"all",is_update:!1}),J=[{title:"所有端口",key:"all"},{title:"指定端口",key:"point"}],R={country:[{required:!0,message:"请选择国家或地区",trigger:"change"}],ports:[{validator:(e,a,l)=>{a.length>0&&(D(a)||l(new Error("端口格式错误，可用范围：1-65535")),l()),l(new Error("请输入源端口"))},trigger:["input"]}]};return l(()=>{if((async()=>{await h({loading:A,request:x(),data:[Array,O]})})(),P.compData.isEdit){const e=P.compData;Object.assign(F.value,{country:e.country,brief:e.brief,types:e.types,ports:e.ports,choose:e.ports?"point":"all"})}}),H({onConfirm:async e=>{await q.value.validate();let a={...F.value};const l=P.compData.isEdit;l&&(a.id=P.compData.id,a.addtime=P.compData.addtime,a.country=F.value.country,a.brief=O.value.find(e=>e.CH===F.value.country).brief),"all"===F.value.choose&&(a.ports=""),a={data:JSON.stringify(a)},await h({loading:"正在设置规则，请稍后...",request:l?k(a):w(a),message:!0}),e(),P.compData.refreshFn(),C(),I()}}),(a,l)=>{const D=b,h=_,k=g,w=j,x=v,C=V,I=t("bt-loading");return o(),s(C,{ref_key:"editAreaRulesRef",ref:q,model:u(F),rules:R,class:"p-[2rem] addfrom"},{default:r(()=>[i(k,{label:"策略"},{default:r(()=>[i(h,{modelValue:u(F).types,"onUpdate:modelValue":l[0]||(l[0]=e=>u(F).types=e),class:"!w-[24rem]"},{default:r(()=>[i(D,{label:"屏蔽",value:"drop"})]),_:1},8,["modelValue"])]),_:1}),i(k,{label:"端口"},{default:r(()=>[i(h,{modelValue:u(F).choose,"onUpdate:modelValue":l[1]||(l[1]=e=>u(F).choose=e),class:"!w-[24rem]"},{default:r(()=>[(o(),d(m,null,p(J,e=>i(D,{key:e.key,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),"point"===u(F).choose?(o(),s(k,{key:0,label:"指定端口",prop:"ports"},{default:r(()=>[i(w,{modelValue:u(F).ports,"onUpdate:modelValue":l[2]||(l[2]=e=>u(F).ports=e),type:"number",min:"1",max:"65535",width:"24rem",placeholder:"请输入指定端口"},null,8,["modelValue"])]),_:1})):n("",!0),i(k,{label:"地区",prop:"country"},{default:r(()=>[c((o(),s(h,{modelValue:u(F).country,"onUpdate:modelValue":l[3]||(l[3]=e=>u(F).country=e),class:"!w-[24rem]",multiple:!e.compData.id,filterable:!e.compData.id,"collapse-tags":!e.compData.id},{default:r(()=>[(o(!0),d(m,null,p(u(O),e=>(o(),s(D,{key:e.brief,label:e.CH,value:e.CH},null,8,["label","value"]))),128))]),_:1},8,["modelValue","multiple","filterable","collapse-tags"])),[[I,u(A)]])]),_:1}),e.compData.id?n("",!0):(o(),s(k,{key:1,label:" "},{default:r(()=>[i(x,{modelValue:u(F).is_update,"onUpdate:modelValue":l[4]||(l[4]=e=>u(F).is_update=e)},{default:r(()=>[...l[5]||(l[5]=[f("更新IP池",-1)])]),_:1},8,["modelValue"])]),_:1})),y("ul",U,[l[6]||(l[6]=y("li",null,"地区规则中IP数量较多，添加时可能耗时较长",-1)),e.compData.id?n("",!0):(o(),d("li",E,"勾选【更新IP池】会从云端获取指定地区近1个月最新的IP池")),l[7]||(l[7]=y("li",null,"添加【除中国之外】或多个地区时，可能会导致系统防火墙占用高，添加完成后会恢复",-1)),l[8]||(l[8]=y("li",null,"此操作将重载防火墙，未持久化的 iptables 规则会清空，请先备份保存！",-1))])]),_:1},8,["model"])}}});export{H as default};
