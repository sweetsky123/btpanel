import{u as e,_ as a,b3 as t,an as s,ao as l,cM as o,e$ as i,H as r,n,gS as d,Q as c,gT as p,ap as u}from"./utils-lib.js?v=1763689792";import{_ as m}from"./index109.js?v=1763689792";import{s as _,j as v,r as y,c as k,I as f,J as g,x as b,y as h,N as x,F as w,b1 as C,A as j,B as E,L as B,O as H,e as O,C as T,D as N,G as D,ay as M,b6 as R,at as S,as as I,ar as L,g as P,v as A,n as V,z,K as F}from"./base-lib.js?v=1763689792";import{u as q}from"./useStore10.js?v=1763689792";import{u as W}from"./index147.js?v=1763689792";import"./validator.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import{a as $,u as G}from"./column.js?v=1763689792";import{g as J,a as K,b as Q,c as U,d as X,r as Y,e as Z,s as ee,f as ae}from"./useController11.js?v=1763689792";const te=v("NODE-ADD-STORE",()=>{const a=e();_(a);const t=y(),s=y({address:"",api_key:"",category_id:"0",remarks:""});return{isEdit:y(!1),addNodeRef:t,nodeForm:s,isVerify:y(!1)}}),se=()=>_(te()),le={class:"probe-grid"},oe={key:0,class:"probe-grid__empty"},ie={key:1,class:"probe-grid__wrapper"},re={class:"probe-card__header"},ne=["title"],de={class:"probe-card__info"},ce={class:"probe-card__info-row"},pe=["title"],ue={class:"probe-card__info-row"},me={class:"text-secondary"},_e={key:1,class:"flex flex-col justify-around h-full"},ve={class:"probe-card__metric-label"},ye={class:"text-secondary"},ke={class:"probe-card__actions"},fe=a(k({__name:"probe-grid",props:{nodes:{},operateOptions:{},categoryMap:{},loading:{type:Boolean},loadingTitle:{}},setup(e){const a=e,t=e=>{var a,t;return["在线","","离线","异常","重启中"][null!=(t=null==(a=null==e?void 0:e.data)?void 0:a.status)?t:0]||"未知"},s=e=>e.remarks||e.address||"未命名节点",l=e=>{if(null==e)return"默认分类";const t=String(e);return a.categoryMap[t]||"默认分类"},o=e=>{const a=Number(e);return Number.isNaN(a)?0:Math.min(Math.max(a,0),100)},i=e=>{var a,t;return 2===(null!=(t=null==(a=null==e?void 0:e.data)?void 0:a.status)?t:e.status)},r=e=>{var a,t,s,l,i;const r=o(null==(a=null==e?void 0:e.data)?void 0:a.cpu),n=o(null==(t=null==e?void 0:e.data)?void 0:t.memory);return(()=>{const a=(null==e?void 0:e.data)||{};"number"==typeof a.disk||"string"==typeof a.disk?o(a.disk):a.disk&&void 0!==a.disk.percent?o(a.disk.percent):void 0!==a.disk_usage?o(a.disk_usage):void 0!==a.disk_used_percent&&o(a.disk_used_percent)})(),(null==(s=null==e?void 0:e.data)?void 0:s.disk_txt)||(null==(l=null==e?void 0:e.data)?void 0:l.disk)&&e.data.disk.text,[{label:"CPU",value:"".concat(r,"%"),percent:r,color:"var(--el-color-primary)"},{label:"内存",value:(null==(i=null==e?void 0:e.data)?void 0:i.memNewTotal)?"".concat(e.data.memNewTotal," (").concat(n,"%)"):"".concat(n,"%"),percent:n,color:"var(--el-color-warning)"}]},n=(e,a)=>"function"==typeof e.isHide?e.isHide(a):Boolean(e.isHide),d=e=>{const t=[];a.operateOptions.filter(a=>!a.isMore&&a.title&&!n(a,e)).forEach(e=>{t.push({key:"action_".concat(e.title),title:e.title||"",type:"action",data:e})});const s=a.operateOptions.find(a=>a.isMore&&!n(a,e));if(null==s?void 0:s.menu){s.menu.filter(a=>"function"==typeof a.isHide?!a.isHide(e):!a.isHide).forEach(e=>{t.push({key:e.key,title:e.title,type:"more",data:s})})}return t};return(a,o)=>{const n=M,c=R,p=S,u=I,m=L,_=f("bt-loading");return g((b(),h("div",le,[e.nodes.length||e.loading?(b(),h("div",ie,[(b(!0),h(w,null,C(e.nodes,e=>{return b(),h("div",{key:e.id||e.address,class:"probe-card"},[j("div",re,[j("div",{class:"probe-card__title",title:s(e)},E(s(e)),9,ne),j("span",{class:B(["probe-card__status",(a=e,{0:"is-online",2:"is-offline",3:"is-warning",4:"is-warning"}[null!=(v=null==(_=null==a?void 0:a.data)?void 0:_.status)?v:0]||"")])},E(t(e)),3)]),j("div",de,[j("div",ce,[o[1]||(o[1]=j("span",null,"地址",-1)),j("span",{class:"text-secondary",title:e.address||"--"},E(e.address||"--"),9,pe)]),j("div",ue,[o[2]||(o[2]=j("span",null,"分类",-1)),j("span",me,E(l(e.category_id)),1)])]),j("div",{class:B(["probe-card__metrics",{"is-empty":i(e),"min-h-[10rem]":!0}])},[i(e)?(b(),H(n,{key:0,description:"节点离线，暂无指标","image-size":60})):(b(),h("div",_e,[(b(!0),h(w,null,C(r(e),e=>{return b(),h("div",{key:e.label,class:"probe-card__metric"},[j("div",ve,[j("span",null,E(e.label),1),j("span",ye,E(e.value),1)]),O(c,{percentage:e.percent,"show-text":!1,"stroke-width":6,color:(a=e.percent,a>=90?"var(--el-color-danger)":a>=70?"var(--el-color-warning)":"var(--el-color-primary)")},null,8,["percentage","color"])]);var a}),128))]))],2),j("div",ke,[d(e).length?(b(),H(m,{key:0,class:"probe-card__more",onCommand:a=>((e,a)=>{const t=d(a).find(a=>a.key===e);if(t)if("action"===t.type){const e=t.data;"function"==typeof e.onClick&&e.onClick(a)}else if("more"===t.type){const s=t.data;"function"==typeof s.onClick&&s.onClick(e,a)}})(a,e)},{dropdown:T(()=>[O(u,null,{default:T(()=>[(b(!0),h(w,null,C(d(e),e=>(b(),H(p,{key:e.key,command:e.key},{default:T(()=>[N(E(e.title),1)]),_:2},1032,["command"]))),128))]),_:2},1024)]),default:T(()=>[o[3]||(o[3]=j("span",{class:"text-secondary hover:!text-primary cursor-pointer flex items-center"},[N(" 操作 "),j("span",{class:"svgtofont-el-arrow-down ml-[2px]"})],-1))]),_:2},1032,["onCommand"])):D("",!0)])]);var a,_,v}),128))])):(b(),h("div",oe,[x(a.$slots,"empty",{},()=>[o[0]||(o[0]=j("span",{class:"text-placeholder"},"暂无数据",-1))],!0)]))])),[[_,e.loading],[_,e.loadingTitle,"title"]])}}}),[["__scopeId","data-v-27115d9c"]]),ge={class:"module-ui"},be=a(k({__name:"index",setup(a){const{mainHeight:_}=e(),{rowData:v,isRefreshNodeList:y,searchWidth:k,nodeStatus:f,nodeCategory:x,forcedFlushes:w,setNodeInfo:C}=q(),{isEdit:E}=se(),M=e=>"local"===e.api_key&&"local"===e.app_key,R=e=>a=>!(""!==a.api_key||""!==a.app_key||!a.ssh_conf||!Object.keys(a.ssh_conf).length)||e(a),S=()=>w.value=1,I=e=>(v.value=e,E.value=!!e,n({title:"".concat(e?"编辑节点【".concat(e.address,"】"):"添加节点"),area:50,btn:"".concat(e?"保存":"确认"),compData:e||{},component:()=>r(()=>import("./index366.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})),L=[{onClick:U,title:"访问",isHide:R(e=>"local"===e.api_key&&"local"===e.app_key||""!==e.lpver),type:"success"},{onClick:e=>(C.value=e,n({title:"".concat(e?"管理节点【".concat(e.address,"】"):"节点管理"),area:90,component:()=>r(()=>import("./index367.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})),title:"管理",isHide:M,type:"primary"},{onClick:X,title:"删除",isHide:M,type:"danger"},{isMore:!0,menu:[{key:"edit",title:"编辑",isHide:M},{key:"panel",title:"重启面板",isHide:R(M)},{key:"server",title:"重启服务",isHide:R(M)}],isHide:M,onClick:(e,a)=>{if("edit"===e)I(a);else Y(a,e)}}],te=W({key:"category_id",name:"节点分类",field:"name",options:()=>[{label:"全部分类",value:"all"}],event:{get:Z,add:d,delete:e=>c({request:p(e),success:()=>{f.value=[],y.value=!0}})},ignore:["0"],showEdit:!1}),{BtOperation:le}=t({options:[{type:"button",label:"添加节点",active:!0,onClick:()=>I()}]}),oe=u([{label:"设置分类",value:"setClass",event:async(e,a,t,s,l,o)=>{ee(t,l,ve,o)}},{label:"重启面板",value:"panel",event:ae},{label:"重启服务器",value:"server",event:ae},{label:"删除节点",value:"delete",event:ae}]),ie=P(()=>{const e={};return x.value.forEach(a=>{e[String(a.value)]=a.label}),e}),{BtTable:re,BtPage:ne,BtSearch:de,BtRefresh:ce,BtColumn:pe,BtBatch:ue,BtTableCategory:me,BtErrorMask:_e,classList:ve,param:ye,BtRadioButton:ke,config:be}=s({request:async e=>{"all"===e.category_id&&(e.category_id=""),1===w.value&&(e.refresh=1);const a=await J(e);return ye.value.show_mode=a.show_mode||"list",a},columns:[$({type:"page",key:"id"}),{label:"节点名称",width:"auto",prop:"remarks",isCustom:!0},{label:"地址",prop:"address",minWidth:120},K(),Q(),{label:"分类",isCustom:!0,prop:"category_id",render:e=>{var a;return(null==(a=x.value.find(a=>Number(a.value)===Number(e.category_id)))?void 0:a.label)||"默认分类"}},G(L)],extension:[te,oe,l(y),o(),i({options:[{label:"列表模式",value:"list"},{label:"探针模式",value:"block"}],value:"none",key:"show_mode"})],empty:()=>O("span",null,[N("您的列表为空，您可以"),O("span",{class:"bt-link",onClick:()=>I()},[N("创建一个节点")])])});return A(()=>{V(()=>{r(()=>import("./index367.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),r(()=>import("./index368.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})}),(e,a)=>{const t=m;return b(),h("div",ge,[O(z(_e)),O(t,null,{"header-left":T(()=>[O(z(le))]),"header-right":T(()=>[O(z(ke),{class:"mr-[10px]"}),O(z(me),{class:"!w-[140px] mr-[10px]"}),O(z(de),{class:B(["mr-[10px]","!w-[".concat(z(k),"px]")]),placeholder:"请输入节点名称"},null,8,["class"]),O(z(ce),{class:"mr-[10px]",onclick:S}),O(z(pe))]),content:T(()=>["block"===z(ye).show_mode?(b(),H(fe,{key:0,nodes:z(be).data,loading:z(be).loading,"loading-title":z(be).loadingTitle,"operate-options":L,"category-map":z(ie)},{empty:T(()=>[j("span",null,[a[0]||(a[0]=N(" 您的列表为空，您可以 ",-1)),j("span",{class:"bt-link",onClick:I}," 创建一个节点 ")])]),_:1},8,["nodes","loading","loading-title","category-map"])):(b(),H(z(re),{key:1,"min-height":z(_)},null,8,["min-height"]))]),"footer-left":T(()=>[g(O(z(ue),null,null,512),[[F,"block"!==z(ye).show_mode]])]),"footer-right":T(()=>["block"!==z(ye).show_mode?(b(),H(z(ne),{key:0})):D("",!0)]),_:1})])}}}),[["__scopeId","data-v-0741276f"]]),he=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{he as i,se as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
