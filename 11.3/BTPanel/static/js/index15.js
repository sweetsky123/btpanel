import{_ as e}from"./index109.js?v=1763689792";import{_ as a}from"./index118.js?v=1763689792";import{Q as t,W as s,V as r,u as l,n as i,H as n,p as o,M as c,aC as p,P as d,l as u,ah as _,_ as m}from"./utils-lib.js?v=1763689792";import{j as g,r as y,o as f,e as b,s as w,W as h,c as v,v as x,a8 as C,I as j,J as O,z as k,x as S,y as q,C as P,F as T,b1 as V,A,D,H as E,O as I,aD as L}from"./base-lib.js?v=1763689792";import{t as R,u as M,v as U,w as z,x as F,y as J,z as N,q as H}from"./useController3.js?v=1763689792";import{a as W,u as X,c as Y}from"./column.js?v=1763689792";const B=g("CRONTAB-STORE",()=>{const e=y({}),a=y(!1),l=y([]),i=f({p:1,rows:10}),n=y(0);return{logCompData:e,total:n,tableParam:i,tableLoading:a,tableColumns:[{label:"执行时间",width:148,render:e=>r(e.start_time)},{label:"耗时",render:e=>{let a=e.end_time-e.start_time;return"".concat(a<1?"小于1":a,"秒")}},{label:"执行结果",render:e=>b("span",{style:"color: ".concat(e.status?"var(--el-color-primary)":"#ef0808",";")},[e.status?"成功":"失败"])},{label:"返回内容",width:400,render:e=>{let a=e.status?e.result_succ:e.result_err;return b("pre",{class:"max-h-[14rem] overflow-y-hidden overflow-x-hidden w-full",onMouseenter:e=>{let a=e.target;a.style.overflowX="auto",a.style.overflowY="auto"},onMouseleave:e=>{let a=e.target;a.style.overflowX="hidden",a.style.overflowY="hidden"}},[a])}}],tableData:l,getLogList:async()=>{await t({loading:a,request:e.value.request({...e.value.data,...i}),data:{data:[Array,l],page:s(n)}})}}});l();const Q=B(),{logCompData:$}=w(Q),G=f({p:1,rows:20,search:"",type_id:""}),K=y(),Z=y(!1),ee=y(0),ae=y([]),te=y(!1),se=y([]),re=async()=>{const{name:e,script_id:a,form:t}=de,s={script_id:a,args:t.args};await o({title:"执行脚本",icon:"warning-filled",content:"立即执行【".concat(e,"】脚本任务，执行过程可能等待时间较长，请耐心等待。是否继续？")});const r=c.load("正在执行脚本,请稍后...");try{const{data:e}=await U({data:JSON.stringify(s)});return r.close(),e.status&&we(),i({title:"执行结果",area:[60,40],component:{render:a=>b("pre",{class:"h-full w-full bg-darkPrimary !overflow-auto whitespace-pre-line text-white break-all p-12px"},[e.msg])}}),e.status}catch(l){return r.close(),!1}},le=async()=>{await t({loading:te,request:M(G),data:{data:[Array,ae],page:s(ee)}})},ie=e=>{G.type_id=e.props.name,le()},ne=(e,a)=>{if(we(),ge.type_id=G.type_id,e){const{script_id:e,name:t,return_type:s,is_args:r,ps:l,script:i,args_title:n,args_ps:o,type_id:c}=a;Object.assign(ge,{name:t,return_type:s,is_args:String(r),ps:l,script:i,type_id:c,script_id:e}),"1"==r&&Object.assign(me,{args_title:n,args_ps:o})}i({title:(e?"编辑":"创建")+"脚本",area:57,component:()=>n(()=>import("./index134.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onConfirm:()=>be(!!e),showFooter:!0})},oe=h([W({key:"script_id"}),{label:"名称",prop:"name"},{label:"类型",prop:"script_type"},{label:"返回类型",prop:"return_type"},{label:"备注",prop:"ps",showOverflowTooltip:!0},{label:"创建时间",render:e=>r(e.create_time)},{label:"上次执行时间",render:e=>Array.isArray(e.last_exec_time)?"--":r(e.last_exec_time)},X([{onClick:e=>(async e=>{const{is_args:a,args_title:t,name:s,args_ps:r,script_id:l}=e;Object.assign(de,{script_id:l,name:s,form:{args:"",placeholder:"端口检测"===s?"127.0.0.1:433":r},title:t}),a?i({title:"执行脚本参数",component:()=>n(()=>import("./index132.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,area:42,onConfirm:async()=>(await pe.value.validate(),re())}):re()})(e),title:"执行"},{onClick:e=>ne(!0,e),title:"编辑"},{onClick:e=>{$.value={request:z,data:{script_id:e.script_id}},i({title:"执行日志",area:86,compData:{request:z,data:{script_id:e.script_id}},component:()=>n(()=>import("./index133.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},title:"日志"},{onClick:async e=>{await o({title:"删除脚本",icon:"warning-filled",content:"删除后脚本信息不可恢复,是否继续操作？"}),await t({loading:"正在删除脚本,请稍后...",request:F(e),message:!0,success:le})},title:"删除"}])]),ce=[{label:"删除脚本",value:"delete",event:async(e,a)=>{const t=async e=>await F({script_id:e.script_id});await e({title:"批量删除",content:"即将删除所选中的数据，是否继续操作?",column:[{prop:"name",label:"脚本名称"},Y()],onConfirm:async()=>(await a(t),le(),!1)})}}],pe=y(),de=f({title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""}),ue={args:[{required:!0,message:"请输入脚本参数",trigger:"blur"},{validator:(e,a,t)=>{if("端口检测"===de.name){/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/.test(a)?t():t(new Error("请输入正确的IP:端口格式"))}else t()}}]},_e=y(),me=f({args_title:"",args_ps:""}),ge=f({name:"",return_type:"string",is_args:"0",ps:"",script:"",type_id:"",script_id:""}),ye=[{content:"当前仅支持Python和Shell脚本"},{content:"请根据返回类型在脚本执行结束时输出符合预期的值"},{content:"如果选择需要脚本参数，使用当前脚本时需传递一个参数，在脚本中的第一个参数中接收"},{content:"Python 脚本需指定编码（如 #coding: utf-8）；Shell 脚本可以用 #!/bin/bash 或 #!/bin/sh 开头，未指定类型时默认按 Shell 脚本执行。"}],fe=f({name:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],script:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),be=async e=>{await _e.value.validate();let a={...ge};"1"==ge.is_args&&(a={...ge,...me}),e||delete a.type_id,a={data:JSON.stringify(a)};const s=e?J:N;return(await t({loading:"正在".concat(e?"编辑":"创建","脚本，请稍后..."),request:s(a),message:!0,success:e=>{e.status&&we(),le()}})).status},we=()=>{Object.assign(ge,{name:"",return_type:"string",is_args:"0",ps:"",script:"",type_id:"",script_id:""}),Object.assign(me,{args_title:"",args_ps:""}),Object.assign(de,{title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""})},he=()=>{ae.value=[],se.value=[]},ve={class:"flex items-center"},xe={class:"flex items-center"},Ce=m(v({__name:"index",setup:t=>(l(),x(async()=>{await(async()=>{const e=await R();se.value=e,se.value.length&&(G.type_id=String(se.value[0].type_id))})(),le()}),C(he),(t,s)=>{const r=L,l=p,i=E,n=d,o=u,c=_,m=a,g=e,y=j("bt-loading");return O((S(),q("div",null,[b(l,{modelValue:k(G).type_id,"onUpdate:modelValue":s[0]||(s[0]=e=>k(G).type_id=e),type:"card",onTabClick:k(ie)},{default:P(()=>[(S(!0),q(T,null,V(k(se),(e,a)=>(S(),I(r,{class:"h-0",key:a,label:e.name,name:String(e.type_id)},null,8,["label","name"]))),128))]),_:1},8,["modelValue","onTabClick"]),b(g,null,{"header-left":P(()=>[A("div",ve,[b(i,{onClick:s[1]||(s[1]=e=>k(ne)()),type:"primary"},{default:P(()=>[...s[6]||(s[6]=[D("创建脚本",-1)])]),_:1}),A("div",{class:"flex items-center ml-4px",onClick:s[2]||(s[2]=e=>k(H)())},[...s[7]||(s[7]=[A("i",{class:"svgtofont-desired text-medium"},null,-1),A("span",{class:"bt-link"},"需求反馈",-1)])])])]),"header-right":P(()=>[A("div",xe,[b(n,{modelValue:k(G).search,"onUpdate:modelValue":s[3]||(s[3]=e=>k(G).search=e),class:"ml-12px !w-[32rem]",placeholder:"请输入搜索关键字",onSearch:k(le)},null,8,["modelValue","onSearch"])])]),content:P(()=>[O(b(o,{ref_key:"scriptTableRef",ref:K,column:k(oe),data:k(ae)},null,8,["column","data"]),[[y,k(te)],[y,"正在加载中，请稍后...","title"]])]),"footer-left":P(()=>[b(c,{"table-ref":k(K),options:k(ce)},null,8,["table-ref","options"])]),"footer-right":P(()=>[b(m,{total:k(ee),page:k(G).p,"onUpdate:page":s[4]||(s[4]=e=>k(G).p=e),row:k(G).rows,"onUpdate:row":s[5]||(s[5]=e=>k(G).rows=e),onChange:k(le)},null,8,["total","page","row","onChange"])]),_:1})])),[[y,k(Z)]])})}),[["__scopeId","data-v-7622be20"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{B as C,de as a,pe as b,ge as c,me as d,_e as e,fe as f,ye as h,je as i,ue as r};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
