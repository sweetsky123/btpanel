import{_ as e}from"./index109.js?v=1763689792";import{_ as a}from"./index118.js?v=1763689792";import{aQ as t,u as s,n as l,H as n,Q as o,cj as r,x as i,ck as c,M as u,p as m,cl as d,bZ as p,cm as _,aS as v,b_ as g,cn as b,co as f,e as h,P as k,aB as y,l as w,ah as x,_ as E}from"./utils-lib.js?v=1763689792";import{_ as j}from"./index260.js?v=1763689792";import{o as C,r as D,W as S,c as N,w as T,v as q,n as I,a8 as L,I as R,x as M,y as O,e as A,C as P,A as V,z as J,D as H,J as U}from"./base-lib.js?v=1763689792";import{u as B,a as Q,b as W,e as z,r as F,C as G,t as K,o as Z,N as X}from"./useMethods.js?v=1763689792";import{u as Y}from"./use-socket-request.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";const{refs:{customLimit:$,cpuAndMemData:ee,maxCPU:ae,maxMem:te,maxGpus:se}}=t(),{mainHeight:le,enterpriseRec:ne}=s(),oe=C({loading:!1,total:0,p:1,limit:Number(localStorage.getItem("dockercontainerlimit"))||20,usedList:[],search:""}),re=D([]),ie=S([]),ce=D([]),ue=D("all"),me=[{label:"启动",value:"start",event:B},{label:"重启",value:"restart",event:B},{label:"停止",value:"stop",event:B},{label:"强制停止",value:"kill",event:B},{label:"暂停",value:"pause",event:B},{label:"恢复",value:"unpause",event:B},{label:"删除",value:"delete",event:B}],de=[{active:!0,content:"创建容器",event:()=>Q()},{content:"日志管理",event:()=>Ce()},{content:"清理容器",event:()=>Se()},...ne.value?[{content:"安全检测",event:async()=>{l({title:"安全检测",area:70,component:()=>n(()=>import("./index257.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})}}]:[]],pe=()=>{$.value.container=!0,localStorage.setItem("dockercontainerlimit",String(oe.limit)),je(!1)},_e=async e=>{o({loading:"正在获取容器目录，请稍候...",request:_({data:JSON.stringify({id:e.id})}),success:e=>{v("Path",e.data.path),window.location.href=window.location.origin+"/files"},error:e=>{u.error((null==e?void 0:e.msg)||"获取容器目录失败")}})},ve=async()=>{if(oe.p=1,""===oe.search)return oe.total=re.value.length,void je(!1);const e=oe.search.toLowerCase(),a=["name","id","image"],t=re.value.filter(t=>a.some(a=>{var s;return null==(s=t[a])?void 0:s.toLowerCase().includes(e)}));oe.total=t.length,ie.value=W({limit:oe.limit,list:t,p:oe.p})||[]},ge=D(z({reNameEvent:e=>F(e),realMonitorEvent:e=>G(e),terminalEvent:K,dirEvent:_e,logDataEvent:e=>Ce(e),deleteDataEvent:async e=>{try{await m({title:"删除容器【".concat(e.name,"】"),content:"删除容器【".concat(e.name,"】,是否继续操作？")}),o({loading:"正在删除容器，请稍候...",request:g({data:JSON.stringify({id:e.id})}),message:!0,success:je})}catch(a){}},conDetailEvent:Z,setStatusEvent:async(e,a)=>{o({loading:"正在设置容器状态，请稍候...",request:p({data:JSON.stringify({id:e.id,status:a})}),message:!0,success:je})},openContainerBackups:e=>De(e),openProxyDetails:e=>Z(e,"proxy"),changeTaskTopEvent:async(e,a)=>{o({loading:"正在设置容器置顶，请稍候...",request:b({type:"top"==a?"add":"del",container_name:e.name}),message:!0,success:()=>{e.is_top="top"==a?1:0,xe()}})},moreEvent:(e,a)=>{switch(e){case"terminal":K(a);break;case"reName":F(a);break;case"realMonitor":G(a);break;case"proxyDetails":Z(a,"proxy");break;case"dir":_e(a);break;case"log":Ce(a)}},setStatusTitle:async e=>{var a;if("all"===e)return ue.value=e,await je();ie.value=(null==(a=ce.value[e])?void 0:a.map(e=>{const a=re.value.find(a=>a.id===e.id);return{...e,backup_count:(null==a?void 0:a.backup_count)||0,remark:(null==a?void 0:a.remark)||""}}))||[]},statusFilterKey:ue}));let be=null;const fe=async e=>{try{const a=e;a.data.container_stats_data&&ye(a.data),a.end&&(null==be||be.socketRequest({params:{model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:"get_all_stats"},onMessage:fe}))}catch(a){}},he=async()=>{null==be||be.socketDestroy(),be=Y("/ws_model");null==be||be.socketRequest({params:{model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:"get_all_stats"},onMessage:fe})},ke=e=>e.id,ye=e=>{if(!e.container_stats_data)return;const a=e.container_stats_data;ie.value.forEach(e=>{if("running"===e.status){const t=a.find(a=>a.id==e.id);t&&(ee.value[e.id]={cpu_usage:t.cpu_usage||0,mem_percent:t.mem_percent||0})}})},we=()=>{null==be||be.socketDestroy(),be=null,oe.loading=!1,oe.total=0,oe.p=1,oe.search="",oe.usedList=[],oe.limit=Number(localStorage.getItem("dockercontainerlimit"))||20,re.value=[],ie.value=[],ce.value=[]},xe=()=>{re.value=re.value.sort((e,a)=>1==e.is_top&&1!=a.is_top?-1:1!=e.is_top&&1==a.is_top?1:e.created_time>a.created_time?-1:1),ie.value=W({limit:oe.limit,list:re.value,p:oe.p})||[]};let Ee=!0;const je=async e=>{!1!==e?(Ee&&(oe.loading=!0),await o({request:r(),data:{container_list:Array,grouped_by_status:Object,mem_total:Number,online_cpus:Number,gpu:Number},success:e=>{Ee=!1;const a=e.container_list;e.container_list.forEach(e=>{ee.value[e.id]={cpu_usage:0,mem_percent:0}}),re.value=a,oe.total=a.length,ie.value=W({...oe,list:a})||[],oe.loading=!1,ce.value=e,ae.value=e.online_cpus,te.value=Number(i(Number(e.mem_total),!1,0,"MB")),se.value=e.gpu||0}}),await o({request:c(),data:Array,success:e=>{re.value.forEach((a,t)=>{const s=e.find(e=>e.id===a.id);s&&(a.backup_count=s.backup_count,a.remark=s.remark)}),he()}})):ie.value=W({...oe,list:re.value})||[]},Ce=(e={})=>{if(!re.value.length)return u.error("容器列表为空");l({component:()=>n(()=>import("./index258.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"容器日志",area:92,compData:{row:e,list:re.value}})},De=e=>l({component:()=>n(()=>import("./index259.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"备份容器 - ["+e.name+"]",area:79,compData:{row:e}}),Se=async()=>{await m({content:"将删除所有已停止、未使用的容器,是否继续？",title:"清理容器",width:"42rem",type:"check",check:{content:'删除<span class="text-danger">所有</span>容器，包含正在运行的容器',onConfirm:async e=>{oe.loading=!0,o({request:d({type:e?1:0}),message:!0,success:je,error:()=>{oe.loading=!1}})}}})},Ne={class:"relative container-table-tab"},Te={class:"flex items-center"},qe=E(N({__name:"index",setup(l,{expose:n}){const{refs:{refreshWs:o,isRefreshTableList:r,customLimit:i},resetRefresh:c}=t(),{mainHeight:u}=s(),m=D(null);return T(()=>o.value,e=>{e&&(o.value=!1,he())}),T(()=>r.value,e=>{e&&(c(),je())}),q(async()=>{ge.value=f(JSON.parse(localStorage.getItem("dockerContainerTableColumn")||"[]")||[],ge.value),je(),I(()=>{i.value.container||setTimeout(()=>{le.value>900?oe.limit=20:oe.limit=10},0)})}),n({init:je,destroy:we}),L(()=>we()),(t,s)=>{const l=j,n=h,o=k,r=y,i=w,c=x,d=a,p=e,_=R("bt-loading");return M(),O("div",Ne,[A(p,null,{"header-left":P(()=>[V("div",Te,[A(l,{options:J(de)},null,8,["options"]),A(n,{class:"ml-[1.6rem]",onClick:J(X)},{default:P(()=>[...s[3]||(s[3]=[H("需求反馈",-1)])]),_:1},8,["onClick"]),A(n,{class:"ml-[1.6rem]",href:"https://www.bt.cn/bbs/thread-140412-1-1.html"},{default:P(()=>[...s[4]||(s[4]=[H(">>使用帮助",-1)])]),_:1})])]),"header-right":P(()=>[A(o,{class:"!w-[26rem] mr-1rem",modelValue:J(oe).search,"onUpdate:modelValue":s[0]||(s[0]=e=>J(oe).search=e),onSearch:J(ve),placeholder:"请输入容器名、ID、容器镜像"},null,8,["modelValue","onSearch"]),A(r,{name:"dockerContainerTableColumn",column:J(ge),tableRef:J(m)},null,8,["column","tableRef"])]),content:P(()=>[U(A(i,{ref_key:"containerTable",ref:m,key:"containerTable",column:J(ge),data:J(ie),"row-key":J(ke),description:"容器列表为空","max-height":J(u)-230},null,8,["column","data","row-key","max-height"]),[[_,J(oe).loading],[_,"正在加载容器列表，请稍后...","title"]])]),"footer-left":P(()=>[A(c,{"table-ref":J(m),options:J(me)},null,8,["table-ref","options"])]),"footer-right":P(()=>[A(d,{page:J(oe).p,"onUpdate:page":s[1]||(s[1]=e=>J(oe).p=e),row:J(oe).limit,"onUpdate:row":s[2]||(s[2]=e=>J(oe).limit=e),useStorage:!1,total:J(oe).total,onChange:J(pe)},null,8,["page","row","total","onChange"])]),_:1})])}}}),[["__scopeId","data-v-b42b5680"]]);export{qe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
