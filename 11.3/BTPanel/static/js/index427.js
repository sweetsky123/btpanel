import{_ as e}from"./index109.js?v=1763689792";import{aA as a,x as t,V as s,p as o,Q as n,b3 as i,an as r,ao as l,ap as c}from"./utils-lib.js?v=1763689792";import{s as m,c as p,x as d,y as u,e as f,C as b,z as _}from"./base-lib.js?v=1763689792";import{B as h,C as k,D as y,d as C}from"./useMethod5.js?v=1763689792";import{a as g,u as j,c as B}from"./column.js?v=1763689792";import{u as w}from"./useController5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";import"./site.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";const{localRow:v,isRefreshBackupList:x}=m(w()),R=async(e,a,t,s)=>{const{label:o,value:n}=s,i=new Map([["delete","批量删除已选的备份文件，是否继续操作？"]]),r=async(e,a)=>{const{id:t}=e;if("delete"===n)return await k({bak_id:t})};await e({title:"批量".concat(o,"备份文件"),content:"".concat(i.get(n),"，是否继续操作！"),column:[{label:"备份文件",prop:"filename"},B()],onConfirm:async()=>(await a(r),x.value=!0,!1)})},q={class:"p-[2rem]"},z=p({__name:"index",setup(p){const{isRefreshBackupList:B}=m(w()),{BtOperation:z}=i({options:[{type:"button",label:"备份",active:!0,onClick:()=>{n({loading:"正在备份，请稍后...",request:C({s_id:v.value.id,bak_type:3}),success:e=>{e.status&&(x.value=!0)},message:!0})}}]}),L=c([{label:"删除",value:"delete",event:R}]),{BtTable:M,BtPage:W,BtRecommendSearch:D,BtRefresh:S,BtColumn:T,BtBatch:A,BtTableCategory:E,BtErrorMask:H,tableRef:I,classList:N,refresh:O}=r({request:e=>(async e=>{try{const{data:{data:t,page:s}}=await h({s_id:v.value.id,p:e.p,limit:e.limit});return{data:t,total:a(s)}}catch(t){return{data:[],total:0}}})(e),columns:[g(),{label:"文件名",prop:"filename",isCustom:!0,minWidth:180},{label:"文件大小",prop:"size",render:e=>t(Number(e.size),!0)},{label:"备份时间",prop:"addtime",minWidth:120,render:e=>s(e.bak_time)},{label:"信息",prop:"bak_type",minWidth:80,render:e=>1==e.bak_type?"仅文件":2==e.bak_type?"仅DB":"完整的备份"},j([{title:"恢复",onClick:async e=>{await o({title:"恢复备份文件",content:"将恢复站点文件和数据库，继续吗？",onConfirm:async()=>{n({loading:"正在恢复备份文件，请稍后...",request:y({bak_id:e.id}),success:e=>{},message:!0})}})}},{title:"下载",onClick:e=>{const a="".concat(window.location.origin);window.open("".concat(a,"/download?filename=").concat(encodeURIComponent(e.bak_file)).concat(e.filename?"&amp;name=".concat(e.filename):""),"_blank","noopener,noreferrer")}},{title:"删除",onClick:e=>{o({title:"删除备份文件",content:"网站备份即将被删除 【".concat(e.filename,"】，是否继续操作?"),onConfirm:async()=>{n({loading:"正在删除备份文件，请稍后...",request:k({bak_id:e.id}),success:e=>{e.status&&(x.value=!0)},message:!0})}})}}])],extension:[L,l(B)]});return(a,t)=>{const s=e;return d(),u("div",q,[f(s,null,{"header-left":b(()=>[f(_(z))]),"header-right":b(()=>[...t[0]||(t[0]=[])]),content:b(()=>[f(_(M),{"min-height":500})]),"footer-left":b(()=>[f(_(A))]),"footer-right":b(()=>[f(_(W))]),_:1})])}}});export{z as default};
