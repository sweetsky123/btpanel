import{_ as e,u as s,n as a,H as t,eJ as n,eK as o,eL as i,Q as l,eM as c,eN as r,az as u,M as g,eO as m,eP as p}from"./utils-lib.js?v=1763689792";import{j as d,r as v,c as _,s as f,v as y,x as I,y as w,A as h,D as k,B as b,z as O,O as T,C as P,G as S,aT as L,bK as D,aE as U}from"./base-lib.js?v=1763689792";const C=d("HOME-LOGIN-PROMPT-STORE",()=>{const e=v({ip_info:{ip:"",info:""},last_login:{ip_info:{ip:"",info:""},login_time_str:""}});return{loginInfo:e,initData:()=>{const s=JSON.parse(sessionStorage.getItem("loginInfo"));e.value=s||e.value}}}),E={class:"login-message"},N={class:"login-message-row"},j={class:"login-message-content"},x={class:"login-message-row"},R={class:"login-message-content"},B={class:"login-message"},M={class:"login-message-row"},H={class:"login-message-content"},V={class:"login-message-row"},A={class:"login-message-content"},z={class:"login-message-row"},G={class:"login-message-content"},J=e(_({__name:"index",setup(e){const s=C(),{loginInfo:a}=f(s);return y(()=>s.initData()),(e,s)=>{const t=L;return I(),w("div",null,[h("div",null,[s[2]||(s[2]=k(" 当前登录信息： ",-1)),h("div",E,[h("div",N,[s[0]||(s[0]=h("span",{class:"login-message-title"},"IP",-1)),h("span",j,b(O(a).ip_info.ip),1)]),h("div",x,[s[1]||(s[1]=h("span",{class:"login-message-title"},"归属地",-1)),h("span",R,b(O(a).ip_info.info),1)])])]),h("div",null,[s[7]||(s[7]=k(" 上次登录信息： ",-1)),h("div",B,[h("div",M,[s[4]||(s[4]=h("span",{class:"login-message-title"},"IP",-1)),h("span",H,[k(b(O(a).last_login.ip_info.ip)+" ",1),O(a).last_login.ip_info.ip!==O(a).ip_info.ip?(I(),T(t,{key:0,content:"登录异常",effect:"dark",placement:"top"},{default:P(()=>[...s[3]||(s[3]=[h("i",{class:"svgtofont-el-warning text-warning cursor-pointer ml-[8px]"},null,-1)])]),_:1})):S("",!0)])]),h("div",V,[s[5]||(s[5]=h("span",{class:"login-message-title"},"归属地",-1)),h("span",A,b(O(a).last_login.ip_info.info),1)]),h("div",z,[s[6]||(s[6]=h("span",{class:"login-message-title"},"时间",-1)),h("span",G,b(O(a).last_login.login_time_str),1)])])])])}}}),[["__scopeId","data-v-f71f178d"]]),K=d("HOME-STORE",()=>{const{getGlobalInfo:e}=s(),d=v(0),_=v(!1),f=v({name:"",simpleName:""}),y=v(0),I=v({runningDays:0,isBeta:!1,isUpgrade:!1,cloudBeta:!1,betaInfo:null,officialInfo:null,grayscale:1,isSetup:!0,isRestart:!1,upgrade:0,currentInfo:null,accountVersionInfo:null}),w=v({one:0,max:0,five:0,fifteen:0}),h=v({occupy:"",framework:"",coresOccupy:[0,0,0],cpuNumber:0,logicCores:0,cores:0,process:[0,0]}),k=v({}),b=v({memRealUsed:0,memRealUsedList:[],memTotalList:[],memTotal:0,memFree:0,memShared:0,memAvailable:0,memBuffers:0,memCached:0}),O=v({cpuBaseInfo:{active_processes:0,cpu_name:"Common KVM processor * 2",load_avg:{},logical_cpu:0,num_phys_cores:0,physical_cpu:0,total_processes:0},cpuProcess:[],memProcess:[]}),T=v([]),P=v([]),S=v([]),L=v([]),C=v([]),E=v([]),N=v([]),j=v(!1),x=e=>{const s=window.vite_public_version,a=s.split(".").pop(),t=parseInt(a).toString()===a&&2===a.length,{is_beta:n,version:i,beta:l,downUrl:c,updateMsg:r,uptime:u,grayscale_test:g}=e;Object.assign(I.value,{isBeta:t,isUpgrade:!o(s,t?l.version:i),cloudBeta:n,betaInfo:l,officialInfo:{downUrl:c,updateMsg:r,version:i,uptime:u},grayscale:g})},R=async()=>{try{const{data:e}=await i({check:!0});return e&&B(e),e}catch(e){}},B=e=>{const{local:s,cloud:a,upgrade:t}=e,n=2===t?null==a?void 0:a.OfficialVersionLatest:1===t?null==a?void 0:a.OfficialVersion:s,o=null==a?void 0:a.AccountVersion;Object.assign(I.value,{upgrade:t,currentInfo:n,accountVersionInfo:o,envUpgradeInfo:{has_env_py313:s.has_env_py313,need_env_check:s.need_env_check,env_update_running:s.env_update_running,plugins_hasUpdate:s.plugins_check.some(e=>"must"===e.level),plugins_check:s.plugins_check},hideBadge:((null==a?void 0:a.ignore)||[]).includes(s.version)})};let M=null;const H=v(""),V=async()=>{var e;try{M&&clearTimeout(M);const{data:s}=await r();(null==(e=s.data)?void 0:e.env_update_running)||s.data.log?(H.value=u(s.data.log)?s.data.log:s.msg||"暂无日志",s.data.env_update_running?M=setTimeout(()=>{V()},2e3):g.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",showClose:!s.status,duration:s.status?5e3:0})):g.error(s.msg)}catch(s){M&&clearTimeout(M),M=setTimeout(()=>{V()},2e3)}},A=e=>{const{disk:s,mem:a,network:t,iostat:n,cpu:o,installed:i,cpu_times:l,down:c,up:r,downPackets:u,upPackets:g,downTotal:m,upTotal:p,system:d,simple_system:v,time:O,docker_run:T}=e,P={ALL:{down:c,up:r,downPackets:u,upPackets:g,downTotal:m,upTotal:p},...t};z(s);const S=Date.now();_.value=i,b.value=a,L.value=P,C.value=n,j.value=!!T,h.value={occupy:o[0],cores:o[1],coresOccupy:o[2],framework:o[3],logicCores:o[4],cpuNumber:o[5],process:[l["活动进程数"],l["总进程数"]]},k.value=l,w.value=e.load,y.value=S,f.value.name=v,f.value.simpleName=d,I.value.runningDays=O},z=e=>{var s;const a=[],t=[];e.forEach(e=>{const{path:s,size:n}=e,o=u(n),i=o?0:parseInt(n[3].substring(0,n[3].lastIndexOf("%"))),l={total:n[0].split(" "),used:n[1].split(" ")};a.push({show:!1,data:e,info:{type:"disk",title:o?"未挂载":s,range:i,desc:{total:l.total[0],used:l.used[0],total_unit:l.total[1],used_unit:l.used[1]}}}),t.push({diskName:s,diskQuota:Number.parseFloat(n[0].split("G")[0])})}),E.value=(null==(s=e[0])?void 0:s.size)||[],T.value=a,P.value=t,localStorage.setItem("checkWarnInfo",JSON.stringify(a[0]))};return{panelInfo:I,memory:b,systemInfo:f,refreshTime:y,load:w,cpu:h,cpuTimes:k,disk:T,diskQuota:P,isDockerPanel:j,recommendSoft:S,network:L,diskIo:C,diskUsage:E,overviewShowList:N,isRefreshData:d,recommendInstall:_,specificResource:O,recommendInstallDialog:async()=>a({component:()=>t(()=>import("./index345.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:'<div class="flex items-center justify-between text-small"><span>初始化推荐配置</span><span class="close-ad">不再显示推荐</span></div>',area:105,closeBtn:2}),getUpdateInfo:async(e={})=>{try{const{data:s}=await n(e),{status:a,msg:t}=s;return!(!a||!t)&&(x(t),t)}catch(s){}},getUpdateInfoNew:R,getHomeConfig:async()=>{const s=await e();"object"==typeof s&&s&&(I.value.isSetup=s.isSetup),s.migration&&a({area:45,component:()=>t(()=>import("./index340.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},getSystemInfo:async()=>{try{const e=await m();d.value=(new Date).getTime(),A(e.data)}catch(e){}},monitorLoginInfo:async()=>{var e;const s=sessionStorage.getItem("loginInfo");if(null!=s){let a=JSON.parse(s);null!=a&&""!=a&&(null==(e=null==a?void 0:a.last_login)?void 0:e.login_time_str)&&a.login_origin&&D({title:"登录成功",message:U(J),type:"success",position:"bottom-right",dangerouslyUseHTMLString:!0,customClass:"login-success",onClose:()=>sessionStorage.removeItem("loginInfo")})}},getHomeProcessInfo:async()=>{try{const{data:{info:e,CPU_high_occupancy_software_list:s,memory_high_occupancy_software_list:a}}=await p();Object.assign(O.value,{cpuBaseInfo:e,cpuProcess:s,memProcess:a,refresh:Date.now()})}catch(e){}},downLogContent:H,clearRestart:()=>{M&&clearInterval(M),H.value="",R()},downloadEnv:async()=>{try{return l({loading:"正在下载，请稍后...",message:!0,request:c()})}catch(e){return{status:!1,msg:"请求失败"}}},getDownloadEnvLog:V,$reset:()=>{T.value=[],P.value=[],S.value=[],L.value=[],C.value=[],N.value=[],Object.assign(O.value,{cpuProcess:[],memProcess:[]})}}},{persist:!0,storage:localStorage,omit:["systemInfo"]});export{K as H};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
