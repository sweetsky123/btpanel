import{_ as a}from"./index109.js?v=1763689792";import{u as e,p as t,M as s,Q as l,l as i,x as n}from"./utils-lib.js?v=1763689792";import{c as r,r as o,W as p,aB as d,o as u,v as c,I as m,x as y,y as v,e as f,z as x,C as g,J as b,G as h,A as w,aZ as j,aE as _}from"./base-lib.js?v=1763689792";import{batchDelMysqlData as q,deleteDatabase as S,checkDelData as D,checkModulesDelData as J,getMysqlCloudServer as A,getModulesCloudServer as M}from"./database.js?v=1763689792";import{x as N}from"./useMethod4.js?v=1763689792";import{g as O}from"./useStore2.js?v=1763689792";import{h as T,i as k}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const C={class:"p-[28px]"},E={key:0,class:"text-danger"},H={key:1,class:"text-danger mt-[4px]"},R=r({__name:"index",props:{compData:{default:()=>({ids:[],isMult:!1,rows:[],config:{enable:!1,exclude:[]}})}},setup(r,{expose:R}){var z;const B=r,{refs:{tabActive:F},refreshTableList:G}=O(),{panel:I}=e(),{enable:L,exclude:Q}=null==(z=B.compData)?void 0:z.config,{ids:W,isMult:Z}=B.compData,K=o(!1),P=p([]),U=o(I.value.isDbRecycle),V=p([]),X=p(!1),Y=d("popupSetFooter"),$=u({title:"警告",titleType:"warning",description:"删除数据库后，数据库内的所有数据将被清空，且不可恢复。"}),aa=async(a,e,t)=>{const{id:i,name:n}=V.value[e],r="mysql"===F.value?null:F.value,o=await l({request:S({id:i,name:n},r)});a.push({id:i,name:n,status:o.status}),e===V.value.length-1&&(G(),t?N(a,{title:"删除数据库"}):s.request(o)),e<V.value.length-1&&aa(a,e+1,t)},ea=[{label:"数据库名称",prop:"name"},{label:"数据库大小",prop:"total",render:a=>_("span",n(a.total,!0,2))},{label:"数据库位置",render:a=>{var e;let t="本地数据库";return null==(e=P.value)||e.forEach(e=>{e.id===a.sid&&(t="mysql"===F.value?e.db_host:e.ps,"127.0.0.1"===e.db_host&&(t="本地数据库"))}),_("span",t)}},{width:160,label:"创建时间",prop:"addtime"},{width:100,label:"删除结果",render:a=>{let e=0===a.sid;return e&&U.value?_("span","移至回收站"):_("span",{class:"text-danger"},"彻底删除")}}];return c(()=>{(async()=>{let a={data:JSON.stringify({type:F.value})};await l({request:"mysql"===F.value?A():M(a,F.value),data:[Array,P]})})(),(async()=>{Y(!1);const{data:a}=await l({loading:X,request:"mysql"===F.value?D({ids:JSON.stringify(W)}):J({data:JSON.stringify({ids:JSON.stringify(W)})},F.value),data:{data:[Array,V]}});K.value=null==a?void 0:a.some(a=>a.sid),K.value&&($.titleType="error",$.description="当前列表存在彻底删除后无法恢复的数据库，请仔细查看列表，以防误删，是否继续操作？"),Y(!0)})()}),R({onConfirm:async a=>{await t({type:"input",title:"二次验证信息-删除数据库",content:'移至回收站的数据库如需彻底删除请前往数据库回收站，<span class="text-danger">远程数据库将直接彻底删除</span>，是否继续操作？',icon:"warning-filled",isHtml:!0,input:{content:"删除数据库"}});let e=[];const l=s.load("正在删除...");if(Z&&"mysql"===F.value){const a=T(B.compData.rows,Q,L),e=await q(a),{data:t}=k(e.data);N(t,{title:"删除"}),G()}else await aa(e,0,Z);l.close(),a()}}),(e,t)=>{const s=j,l=i,n=a,r=m("bt-loading");return y(),v("div",C,[f(s,{title:"警告",type:x($).titleType,"show-icon":"",closable:!1,description:x($).description},null,8,["type","description"]),f(n,null,{content:g(()=>[b(f(l,{ref:"deleteRef",data:x(V),column:x(ea),"max-height":300},null,8,["data","column"]),[[r,x(X)],[r,"正在检查删除数据，请稍候...","title"]])]),_:1}),x(K)?(y(),v("p",E,"注意：远程数据库暂不支持数据库回收站，选中的数据库将彻底删除")):h("",!0),t[0]||(t[0]=w("p",{class:"text-danger mt-4px"},"请仔细阅读以上要删除信息，防止数据库被误删",-1)),x(U)||x(K)?h("",!0):(y(),v("p",H,"当前数据库回收站尚未开启,请谨慎操作!"))])}}});export{R as default};
