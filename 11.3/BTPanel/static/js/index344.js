import{u as e,n as a,H as l,M as t,kI as r,aK as s,aS as n,kJ as o,bf as i,aC as c,e as u,_ as v}from"./utils-lib.js?v=1763689792";import{j as m,aH as p,t as g,r as d,o as f,e as _,D as h,c as w,s as y,F as b,bB as x,a8 as S,x as I,y as k,z as T,R as D,C as O,A,aT as j}from"./base-lib.js?v=1763689792";import{j as E,cY as M,cZ as P,c_ as C,c$ as R,d0 as V,d1 as J,d2 as N,d3 as z,d4 as L,p as H}from"./validator.js?v=1763689792";const q=m("HOME-SECURITY-RISKS-STORE",()=>{p();const{payment:c}=e(),{authType:u}=g(c.value),v=d(""),m=d(""),w=d("正在扫描中，请耐心等待..."),y=d(!1),b=d(!1),x=d(""),S=d(!1),I=d(!1),k=d(!1),T=d(!1),D=d(),O=d(!0),A=d(!1),j=d("primary"),q=d(100),F=d("!text-primary"),B=d("safe"),K=d(),Y=d("当前服务器未进行安全扫描，可能存在风险"),G=d(""),$=d(),Q=d([]),U=d([]),X=d([]),Z=d(!0),W=d([]),ee=d([]),ae=d(!0),le=d(!1),te=d(!0),re=d({autoIntercept:!1,ossConfig:{status:!1,isHasMounts:!1},exclude_dirs:[],monitor_dirs:[]}),se=f({progress:1,repairProgress:!1,repairText:"修复中.."}),ne=f({processPercentage:0,processColor:"var(--el-color-primary)"}),oe={risk:{type:"danger",label:"风险项",list:[]},security:{type:"primary",label:"无风险项",list:[]},ignore:{type:"warning",label:"已忽略项",list:[]}},ie=f({cannot_automatically:0,failed:0,success:0}),ce=d(0),ue=d([{label:"风险项",prop:"m_name",width:150,render:e=>_("span",null,[e.m_name])},{label:"修复内容",prop:"msg",width:150},{label:"相关信息",prop:"type",align:"center",render:e=>Array.isArray(e.type)&&e.type.length>0?_("span",{class:"h-[3.2rem] inline-block whitespace-pre-wrap"},[e.type.join("，")]):"无"},{label:"操作结果",align:"right",render:e=>e.status?_("span",{class:"text-primary"},[h("修复成功")]):_("span",{class:"text-[red]"},[h("修复失败")])}]),ve=f({1:{text:"低危",bg:"rgba(var(--el-color-warning-rgb), 0.1)",color:"var(--el-color-warning-light-3)"},2:{text:"中危",bg:"rgba(var(--el-color-warning-rgb), 0.1)",color:"var(--el-color-warning)"},3:{text:"高危",bg:"rgba(var(--el-color-danger-rgb), 0.1)",color:"var(--el-color-danger)"}}),me=d("overview"),pe=f({risk:0,malware:0,web:0,baseline:0}),ge=async()=>{const{data:e}=await C(),a=e.data;re.value.autoIntercept=a.auto_intercept,re.value.ossConfig.status=a.scan_oss,re.value.ossConfig.isHasMounts=a.has_oss_mounts,re.value.exclude_dirs=de(a.exclude_dirs),re.value.monitor_dirs=de(a.monitor_dirs)},de=e=>e&&Array.isArray(e)?e.map(e=>({name:e})):[],fe=()=>{q.value>=80&&q.value<=99?(F.value="!text-[var(--el-color-warning-light-5)]",B.value="risk",ne.processColor="var(--el-color-warning-light-9)"):q.value>=60&&q.value<=79?(F.value="!text-warningDark",ne.processColor="var(--el-color-warning)",B.value="warn"):q.value<60&&(F.value="!text-dangerDark",ne.processColor="var(--el-color-danger)",B.value="danger")},_e=e=>{X.value=e.is_autofix,te.value=!1,localStorage.setItem("isAutoFix",JSON.stringify(X.value));for(const a in oe){const l=e[a];if(Array.isArray(l)){for(let e=0;e<l.length;e++){const t=oe[a].list.find(a=>a.m_name==l[e].m_name);l[e].show=(null==t?void 0:t.show)||!1,l[e].selection=(null==t?void 0:t.selection)||!1}Object.keys(oe).includes(a)&&"risk"==a&&(U.value=[...U.value,...l]),oe[a].list=l}}x.value=e.check_time,j.value="primary",S.value=!0,A.value=!0,we(!0),D.value=" !animate-none",localStorage.setItem("scanData",JSON.stringify(U.value)),localStorage.setItem("ignoreData",JSON.stringify(oe.ignore.list)),n("lastScanTime",x.value)},he=async(e=!1)=>{y.value=!0,w.value="正在扫描中，请稍等...";try{const a={};e&&(a.force=1);const{data:l}=await L(a);U.value=[],l.interrupt||(U.value=[],_e(l),q.value=l.score,ce.value=U.value.length,Y.value="已完成安全扫描，",ee.value=l.ignore)}catch(a){}y.value=!1},we=e=>{let a=!1;W.value=[],U.value.forEach(e=>{X.value.includes(e.m_name)?(e.selection=!0,W.value.push(e),a=!0):e.selection=!1}),a&&e?(Z.value=!1,b.value=W.value.every(e=>1==e.selection)):a&&!e&&(b.value||(W.value=[],U.value.forEach(e=>{X.value.includes(e.m_name)&&(e.selection=!1)})))},ye=async e=>{$.value=[],I.value=!0,ie.cannot_automatically=e.cannot_automatically.length,ie.failed=e.failed.length,ie.success=e.success.length,Q.value=[];for(const a in e)for(const l of e[a])Q.value.push({m_name:l.m_name,type:l.result.type,msg:l.result.msg,status:l.result.status,name:a});$.value=Q.value,y.value=!1,U.value=U.value.filter(a=>!e.success.some(e=>e.m_name===a.m_name)),ce.value=U.value.length,localStorage.setItem("scanData",JSON.stringify(U.value))},be=()=>{H({sourceId:68})};return{showAnimation:T,scanScore:q,scanTextClass:F,scanOuterClass:B,animateFlag:D,scanPreText:Y,riskNum:ce,scanButtonType:j,repairAutoRiskButton:S,cookieRepair:O,scanItemText:G,processData:ne,lastScanTime:x,scanSelectShow:A,allSelect:b,allSelectionDis:Z,isFirst:te,isIgnoreAll:le,ignoreData:ee,emptyDetail:k,loading:y,loadingText:w,isShow:ae,activeMent:v,activeMentIgnore:m,is_autofix:X,levelData:ve,allData:U,repairData:se,resultConfirm:I,resultItemLength:ie,resultTable:$,resultColumn:ue,handleIgnore:async(e,a)=>{try{y.value=!0,w.value="正在忽略风险项,请耐心等候...";const{data:l}=await o({m_name:e.m_name});t.request(l),l.status&&(a?ee.value=ee.value.filter(a=>a.m_name!==e.m_name):U.value=U.value.filter(a=>a.m_name!==e.m_name),he(!0))}catch(l){}finally{y.value=!1}},scanningProcess:async()=>{if(ae.value=!1,k.value=!1,q.value=100,B.value="safe",F.value="!text-primary","info"==j.value){clearInterval(K.value),await V();const e=await J();_e(e.data),q.value="?",F.value="!text-dangerDark",B.value="danger",y.value=!1,ce.value=e.data.risk.length,Y.value="扫描中断，"}else{ne.processPercentage=0,T.value=!0,Y.value="正在进行安全扫描...",ce.value=0,G.value="正在检测...",D.value="",j.value="info",O.value=!0,S.value=!1,he(!0);try{clearInterval(K.value),K.value=setInterval(async function(){const e=await N();ne.processPercentage=e.data.percentage,ce.value=e.data.count,G.value=e.data.status,q.value=e.data.score,e.data.count&&"100"!=e.data.percentage&&(F.value="!text-dangerDark",B.value="danger",Y.value="正在进行安全扫描，"),"100"==e.data.percentage&&clearInterval(K.value),fe()},1e3)}catch(e){}}},handleRepairAutoRisk:()=>{if("ltd"!==u.value)return be();try{let e=U.value.filter(e=>1==e.selection).map(e=>e.m_name);if(0==e.length)return y.value=!1,void t.error("暂无可自动修复的风险项！");y.value=!0,w.value="正在修复中,可能耗时较长,请耐心等候...",se.progress=0;const a=r({data:JSON.stringify({m_name:e})});se.repairProgress=!0;let l=setInterval(async()=>{const{data:e}=await z();if(se.progress=e.percentage,se.repairText=e.status,100===e.percentage){se.repairText="修复完成",se.repairProgress=!1,se.progress=100,clearInterval(l);let e=await a;ye(e.data),he(!0)}},800)}catch(e){s(e)}finally{y.value=!1}},handleDownloadReport:()=>{window.open("/project/security/report/html","_blank","noopener,noreferrer")},changeSelectValue:e=>{e.selection=!e.selection,b.value=W.value.every(e=>1==e.selection)},handelAllSelection:we,handleRepair:async(e,a)=>{if("ltd"!==u.value)return void be();let l=U.value.filter(e=>1==e.selection).map(e=>e.m_name);try{if(!e&&0==l.length)return void t.error("请选择需要修复的风险项！");W.value.length,y.value=!0,w.value="正在修复中,可能耗时较长,请耐心等候...";const{data:s}=await r({data:JSON.stringify({m_name:e?[a.m_name]:l})});e&&s.success.length>0?(t.success("修复成功"),ce.value--,U.value=U.value.filter(e=>e.m_name!==a.m_name),ye(s)):ye(s)}catch(n){s(n)}finally{y.value=!1}},vulnerabilityInvolvesSoftware:e=>{let a=Object.keys(e.soft_name),l="";return a.forEach((t,r)=>{r===a.length-1?l+="".concat(a,":").concat(e.soft_name[t]):l+="".concat(a,":").concat(e.soft_name[t],"\n")}),l},onlineServiceDialog:E,onToggle:(e,a)=>{e.show||a.forEach(e=>e.show=!1),e.show=!e.show},onOpen:()=>{const e=localStorage.getItem("scanData"),a=localStorage.getItem("isAutoFix"),l=localStorage.getItem("ignoreData");a&&(X.value=JSON.parse(a)),l&&JSON.parse(l).length&&(ee.value=JSON.parse(l)),e&&JSON.parse(e).length?(U.value=JSON.parse(e).map(e=>({...e,selection:!1})),A.value=!0,S.value=!0,ae.value=!1):(k.value=!0,S.value=!1),O.value=!1,x.value=i("lastScanTime")||""},$reset:()=>{Q.value=[],U.value=[],W.value=[],ee.value=[],X.value=[],me.value="overview",pe.risk=0,pe.malware=0,pe.web=0,pe.baseline=0,clearInterval(K.value)},repairTypeActive:me,tootipTotal:pe,getScanTotal:async()=>{const{data:e}=await M(),{vulnerability:a,malware:l,security:t,baseline:r}=e.data;if(pe.malware=l,pe.risk=t,pe.web=a,pe.baseline=r,te.value&&pe.risk){Y.value="已检测到<span class='text-danger'>".concat(pe.risk,"</span>个风险,请及时修复");const{data:e}=await P();U.value=e.risk,x.value=e.check_time,A.value=!0,S.value=!0,ae.value=!1,k.value=!1,T.value=!0,q.value=e.score,fe()}},openPayView:be,getMalwareList:ge,convertDataStructure:de,malwareData:re,malwareAdvanced:async()=>a({isAsync:!0,title:"高级设置",area:[80,54],component:()=>l(()=>import("./index495.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),setMalwareConfig:async e=>{const a=await R(e);t.request(a),a.status&&await ge()}}}),F={class:"h-full"},B={class:"box-item flex items-center"},K=v(w({__name:"index",setup(e,{expose:a}){const t=q(),{repairTypeActive:r}=y(t),{tootipTotal:s,getScanTotal:n}=t,o=d([{label:()=>_(b,null,[_("img",{class:"overviewLogo".concat("overview"===r.value?"-active":""),alt:"",src:"/static/icons/logo-white.svg"},null)]),name:"overview",render:()=>l(()=>import("./index496.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(x,{value:s.risk,color:"#ff0000",hidden:0===s.risk},{default:()=>[_("img",{alt:"",src:"/static/images/home/risk".concat("risk"===r.value?"-active":"",".svg")},null)]})]),name:"risk",render:()=>l(()=>import("./risk.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(x,{value:s.malware,color:"#ff0000",hidden:0===s.malware},{default:()=>[_("img",{alt:"",src:"/static/images/home/ware".concat("malware"===r.value?"-active":"",".svg")},null)]})]),name:"malware",render:()=>l(()=>import("./malware.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(x,{value:s.web,color:"#ff0000",hidden:0===s.web},{default:()=>[_("img",{alt:"",src:"/static/images/home/web".concat("web"===r.value?"-active":"",".svg")},null)]})]),name:"web",render:()=>l(()=>import("./web.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(x,{value:s.baseline,color:"#ff0000",hidden:0===s.baseline},{default:()=>[_("img",{alt:"",src:"/static/images/home/safeDetect".concat("safeDetect"===r.value?"-active":"",".svg")},null)]})]),name:"safeDetect",render:()=>l(()=>import("./safeDetect.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)},{label:()=>_("img",{alt:"",src:"/static/images/home/alarm".concat("alarm"===r.value?"-active":"",".svg")},null),name:"alarm",render:()=>l(()=>import("./alarm2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}]),i=async e=>{};return n(),S(t.$reset),a({onOpen:t.onOpen}),(e,a)=>{const l=c,t=u,s=j;return I(),k("div",F,[_(l,{class:"h-full scanning-style",type:"left-bg-card",modelValue:T(r),"onUpdate:modelValue":a[0]||(a[0]=e=>D(r)?r.value=e:null),onTabClick:i,options:T(o)},null,8,["modelValue","options"]),_(s,{effect:"dark",content:"点击加入“宝塔云安全中心交流群”",placement:"bottom"},{default:O(()=>[A("div",B,[a[2]||(a[2]=A("span",{class:"w-[1.4rem] h-[1.4rem] mr-1"},[A("svg",{t:"1741419396670",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4968",width:"16",height:"16"},[A("path",{d:"M506.88 139.776c-96.768 0-175.104 78.848-175.104 175.104 0 53.76 24.576 103.936 67.072 137.728l13.824 10.752-16.384 6.656C281.6 515.584 207.872 624.64 207.872 747.52v61.952c0 11.264 9.216 20.48 20.48 20.48h556.544c11.264 0 20.48-9.216 20.48-20.48V747.52c0-122.88-73.728-231.936-188.416-277.504l-16.384-6.656 13.824-10.752c43.008-33.792 67.072-83.968 67.072-137.728 1.024-96.256-77.824-175.104-174.592-175.104z m257.536 608.256v40.96H249.344v-40.96c0-141.824 115.712-257.536 257.536-257.536 142.336 0 257.536 115.712 257.536 257.536zM506.88 449.024c-73.728 0-134.144-59.904-134.144-134.144 0-73.728 59.904-134.144 134.144-134.144 73.728 0 134.144 59.904 134.144 134.144S581.12 449.024 506.88 449.024z",fill:"var(--el-color-text-tertiary)","p-id":"4969"}),A("path",{d:"M292.352 205.312c-1.536 0-3.072 0-4.608 0.512-65.024 15.872-110.592 73.216-110.592 140.288 0 35.84 13.312 70.144 37.376 96.768l8.704 9.728-11.776 6.144c-78.848 40.96-127.488 121.344-127.488 210.432V716.8c0 11.264 9.216 20.48 20.48 20.48s20.48-9.216 20.48-20.48v-47.616c0-89.6 60.928-167.936 147.968-189.44h1.024c7.168-1.024 13.312-5.632 15.872-11.776v-1.024c0-1.024 0.512-1.536 0.512-2.56l0.512-1.024c0-0.512 0.512-1.024 0.512-1.536V454.656c0-0.512-0.512-1.024-0.512-1.536s-0.512-1.024-1.024-1.536l-0.512-0.512c-1.024-2.048-1.536-3.584-2.56-4.608-0.512 0-0.512-0.512-1.024-0.512-2.048-2.048-4.096-3.584-6.656-4.608-37.376-16.384-61.44-53.76-61.44-94.208 0-47.616 32.256-89.088 78.848-100.352 11.264-2.56 17.92-13.824 15.36-25.088-1.536-10.24-10.24-16.384-19.456-16.384z",fill:"var(--el-color-text-tertiary)","p-id":"4970"}),A("path",{d:"M320.512 256c8.704-8.192 13.312-19.456 13.312-31.232-5.632 9.728-9.728 20.48-13.312 31.232z",fill:"var(--el-color-text-tertiary)","p-id":"4971"}),A("path",{d:"M802.304 458.752l-11.776-6.144 8.704-9.728c24.064-26.624 37.376-60.928 37.376-96.768 0-65.024-44.032-122.368-107.008-139.264-10.752-3.072-22.528 3.584-25.6 14.848-3.072 10.752 3.584 22.528 14.848 25.088 45.056 12.288 76.288 52.736 76.288 99.328 0 40.448-24.064 77.312-60.928 94.208-2.56 1.024-4.608 2.56-6.656 4.608l-1.024 1.024c-1.024 1.024-1.536 2.56-2.56 4.608l-0.512 1.024c0 0.512-0.512 1.024-0.512 1.536s-0.512 1.024-0.512 1.024v2.048c-0.512 2.56-0.512 3.584 0 5.12 0 0.512 0 1.024 0.512 1.536v0.512c0.512 1.024 0.512 2.048 0.512 3.072v1.536c2.56 6.144 8.704 10.752 15.872 11.776h1.024c87.04 22.016 147.968 99.84 147.968 189.44V716.8c0 11.264 9.216 20.48 20.48 20.48s20.48-9.216 20.48-20.48v-47.616c0.512-89.088-48.64-169.472-126.976-210.432z",fill:"var(--el-color-text-tertiary)","p-id":"4972"}),A("path",{d:"M692.224 251.904c-2.56-7.168-5.12-14.336-8.704-20.992 1.024 7.68 4.096 14.848 8.704 20.992z m114.688 198.144z",fill:"var(--el-color-text-tertiary)","p-id":"4973"})])],-1)),_(t,{href:"https://qm.qq.com/cgi-bin/qm/qr?k=hN4oLX6_LMvjYhtXQZEnTx_c6sGPQ_t3&jump_from=webapi&authKey=zeeFfBmcTI0YGllM0/owNJJrfGm/dd2J0fTjKxVMIeIikJlOeMHz/TsxqjHgO/Hb"},{default:O(()=>[...a[1]||(a[1]=[h("云安全交流群",-1)])]),_:1})])]),_:1})])}}}),[["__scopeId","data-v-cf763b9f"]]),Y=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{q as H,Y as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
