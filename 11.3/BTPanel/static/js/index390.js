import{_ as a}from"./index109.js?v=1763689792";import{c as e,r as t,v as l,I as s,x as r,y as n,e as i,C as o,D as d,J as p,z as u,A as m,R as c,F as b,b1 as v,O as f,B as _,H as w,bP as y,bO as h}from"./base-lib.js?v=1763689792";import{Q as x,am as k,V as g,az as j,x as C,l as V,j as H,b as O,p as I,_ as q}from"./utils-lib.js?v=1763689792";import{_ as z}from"./index123.js?v=1763689792";import{u as A}from"./column.js?v=1763689792";import{getPM2Monit as D,getPM2Logs as J,setPM2Status as S}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const U={class:"p-2rem"},B={class:"p-2rem"},F={class:"p-2rem w-full relative"},N=["title"],P=q(e({__name:"index",setup(e){const q=O(),P=t([]),Q=t(!1),R=t(!1),E=t(""),G=t(!1),K=t({}),L=t({}),M=t(""),T=t(!1),W=async(a=!1)=>{const e=await x({loading:Q,request:D(),data:{data:[Array,a=>a.map(a=>{var e;return a.id=null!=(e=a.id)?e:a.name+"(集群)",a})]}});P.value=e.data,a&&q.success("刷新成功")},X=async(a,e)=>{try{G.value=!0;let t={mode:a.mode,log_type:e};k(a.id)?t.id=a.id:t.name=a.name;const{data:l}=await J(t);E.value=l.data}catch(t){}finally{G.value=!1}},Y=async(a,e=!1)=>{let t="online"===a.status?"stop":"start",l=e?"重启":"stop"===t?"停止":"启动";await I({title:"修改集群状态",content:"即将".concat(l,"集群，是否继续？")});let s={mode:a.mode,status:e?"restart":t,name:a.name};k(a.id)?s.id=a.id:s.name=a.name;(await x({loading:"正在".concat(l,"集群，请稍后..."),request:S(s)})).status&&W()},Z=(a,e)=>{E.value="",R.value=!0,K.value=a,M.value=e,X(a,e)},$=[{label:"ID",prop:"id",width:100},{label:"服务名称",prop:"name",width:110,render:a=>a.data?a.name:i("span",{class:"text-primary cursor-pointer",onClick:()=>(a=>{K.value=a,L.value=a.pm2_env,T.value=!0})(a)},[a.name])},{label:"pid",prop:"pid",render:a=>{var e;return null!=(e=a.pid)?e:"--"}},{label:"运行用户",prop:"user",width:75},{label:"重启次数",prop:"restart",width:75,render:a=>a.restart||"--"},{label:"创建时间",prop:"addtime",width:150,render:a=>g(a.uptime)},{label:"cpu使用率",prop:"cpu",render:a=>j(a.cpu)?a.cpu+"%":"--"},{label:"内存占用",prop:"memory",render:a=>void 0!==a.memory?C(a.memory):"--"},{label:"日志",prop:"log",width:120,render:a=>i("div",null,[i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"all")},[d("全部/")]),i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"err")},[d("错误/")]),i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"out")},[d("运行")])])},{label:"自动重载",width:75,prop:"auto_restart",render:a=>a.data?"--":a.auto_restart?"是":"否"},{label:"状态",prop:"status",render:a=>{let e="online"===a.status;return i("span",{class:"text-".concat(e?"primary":"danger")},[e?"运行中":"已停止"])}},A([{onClick:a=>Y(a),isHide:a=>!("online"===a.status),title:"停止",width:26},{onClick:a=>Y(a),isHide:a=>"online"===a.status,title:"启动",width:26},{onClick:a=>Y(a,!0),title:"重启",width:26}])];return l(()=>{W()}),(e,t)=>{const l=w,x=V,k=z,g=H,j=y,C=h,O=a,I=s("bt-loading");return r(),n("div",U,[i(O,null,{"header-left":o(()=>[i(l,{onClick:t[0]||(t[0]=a=>W(!0)),type:"default"},{default:o(()=>[...t[4]||(t[4]=[d("刷新数据",-1)])]),_:1})]),content:o(()=>[p(i(x,{column:u($),data:u(P),"row-key":"id","max-height":500,"tree-props":{children:"data"}},null,8,["column","data"]),[[I,u(Q)]])]),"footer-left":o(()=>[...t[5]||(t[5]=[m("ul",{class:"mt-8px leading-8 text-small list-disc ml-20px"},[m("li",null,"如果pm2项目无法加载监控信息，可修改node命令行版本号再试")],-1)])]),popup:o(()=>[i(g,{title:"日志展示",modelValue:u(R),"onUpdate:modelValue":t[2]||(t[2]=a=>c(R)?R.value=a:null),area:[60]},{default:o(()=>[m("div",B,[i(l,{loading:u(G),type:"primary",onClick:t[1]||(t[1]=a=>X(u(K),u(M)))},{default:o(()=>[...t[6]||(t[6]=[d("刷新日志",-1)])]),_:1},8,["loading"]),p(i(k,{title:"全屏查看日志",class:"h-[40rem] mt-12px",content:u(E)},null,8,["content"]),[[I,u(G)]])])]),_:1},8,["modelValue"]),i(g,{title:"详情展示【".concat(u(K).name,"】"),modelValue:u(T),"onUpdate:modelValue":t[3]||(t[3]=a=>c(T)?T.value=a:null),area:70},{default:o(()=>[m("div",F,[i(C,{column:1,border:"",class:"max-h-[46rem] w-full overflow-auto table-descriptions"},{default:o(()=>[(r(!0),n(b,null,v(Object.entries(u(L)),(a,e)=>(r(),f(j,{key:e},{label:o(()=>[d(_(a[0]),1)]),default:o(()=>[m("span",{title:String(JSON.stringify(a[1])),class:"w-340px truncate inline-block"},_(a[1]),9,N)]),_:2},1024))),128))]),_:1})])]),_:1},8,["title","modelValue"])]),_:1})])}}}),[["__scopeId","data-v-d1f17202"]]);export{P as default};
