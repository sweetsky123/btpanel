import{u as e,ay as s,p as a,aK as t,d as n,l,j as i,b as r,f as c,e as o,_ as d}from"./utils-lib.js?v=1763689792";import{c as m,r as p,o as u,v as b,I as g,J as f,z as v,x as y,y as x,A as h,e as k,O as _,B as w,C as S,D as T,L as j,K as C,F as L,b1 as O,G as M,R as E,H as F,b6 as H,b2 as z,M as I,bz as A,bA as D}from"./base-lib.js?v=1763689792";import{a as B}from"./column.js?v=1763689792";import{p as P}from"./validator.js?v=1763689792";import{getRiskCount as V}from"./site.js?v=1763689792";import{i as G}from"./useController5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./useMethod5.js?v=1763689792";const J={id:"safeDetectList",class:"p-[2rem]"},K={class:"progress-header"},R={class:"progress-header-cot"},N={class:"flex items-center"},U={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},q={key:1},Q={class:"progress-header-cot h-[8rem]"},W=["innerHTML"],X={class:"scanning-progress-cont"},Y={class:"progress-header-cot"},Z={class:"progress-cont-list"},$={key:0},ee={class:"inline-grid grid-cols-4 w-full mt-20px"},se=["onClick"],ae={class:"progress_type"},te={class:"flex-1"},ne={key:0},le={key:1},ie={key:2,class:"text-danger mr-[4px]"},re={key:3,class:"text-primary"},ce={class:"progress_fold text-small flex items-center"},oe={class:"mr-4px"},de={class:"progress_item_body"},me={class:"flex items-center justify-between w-full"},pe={class:"flex items-center ml-12px"},ue=["innerHTML"],be={class:"flex flex-col py-[1rem] px-[1.6rem] text-small progress_item_info"},ge={class:"flex items-center"},fe=["innerHTML"],ve={class:"flex"},ye=["innerHTML"],xe={class:"p-[2rem]"},he=d(m({__name:"index",setup(d){const m=r(),{payment:he}=e(),ke=p(),_e=p(!1),we=p([{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链扫描"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),Se=p(""),Te=u({title:"定期扫描网站，提升网站安全性",msg:"当前安全风险未知，请立即扫描",isFirst:!0,error:0,scanStatus:!1,isEnd:!1,siteList:[],time:0,scanTypeStatus:{vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},btnObj:{text:"立即扫描",type:"primary"},progress:0,progressColor:"var(--el-color-primary)",progressConfig:{},statusTotal:{},active:{vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}}),je=u({0:{text:"警告",bg:"rgba(252, 109, 38, 0.1)",color:"#fc6d26"},1:{text:"低危",bg:"rgba(232, 213, 68, 0.1)",color:"#D4BB00"},2:{text:"中危",bg:"rgba(240, 173, 78, 0.14)",color:"#f0ad4e"},3:{text:"高危",bg:"rgba(239, 8, 8, 0.1)",color:"#EF0808"}});let Ce=null;const Le=p(),Oe=p(!1),Me=p(!1),Ee=p([]),Fe=p([B({key:"name",type:"page"}),{label:"网站名",prop:"name"}]),He=()=>{Ce=s({route:"/ws_project",onMessage:Ae})},ze=e=>{Me.value=!0,Te.siteList=e},Ie=()=>{if(0==Te.siteList.length)return m.error("请选择扫描站点"),!1;Oe.value=!1,De()},Ae=(e,s)=>{const a=JSON.parse(s.data);if(a.hasOwnProperty("site_list"))return Ee.value=a.site_list,void(Te.siteList=a.site_list);if(a.hasOwnProperty("end")){if(Te.progress=a.bar,Te.msg=a.info,a.dangerous&&(Te.progressConfig[a.type]||(Te.progressConfig[a.type]=[]),Te.progressConfig[a.type].push(a),Te.statusTotal[a.type]?Te.statusTotal[a.type]++:Te.statusTotal[a.type]=1,Te.error++),a.end)return Te.isEnd=!0,Te.scanStatus=!1,null==Ce||Ce.close(),G(),void Pe("end");a.type!=Se.value&&(Se.value&&!Te.statusTotal[Se.value]&&(Te.scanTypeStatus[Se.value]=!1),Se.value=a.type)}},De=async()=>{if(Te.time=0,Te.error=0,setInterval(()=>{Te.time++},1e3),"ltd"!==he.value.authType)return P({sourceId:20});Te.siteList=Ee.value,Te.isFirst?(Be(),Te.scanStatus=!0,Te.isFirst=!1,Pe("scan")):Te.scanStatus?(await a({title:"取消扫描",content:"确定取消扫描吗?"}),null==Ce||Ce.close(),Te.isFirst=!0,Pe("scan"),Ge()):(Ge(),Be(),Te.scanStatus=!0,Pe("scan"))},Be=async()=>{await He(),await(null==Ce?void 0:Ce.send({mod_name:"webscanning",def_name:"ScanAllSite",site_list:Te.siteList.map(e=>e.name),ws_callback:"123"}))},Pe=e=>{switch(e){case"scan":Te.title="正在扫描",Te.isEnd=!1,Te.btnObj.text="取消扫描",Te.btnObj.type="warning";break;case"end":Je(),Te.btnObj.text="重新扫描",Te.btnObj.type="primary"}},Ve=e=>{"free"==he.value.authType&&P({sourceId:65})},Ge=()=>{Se.value="",Te.scanStatus=!1,Te.isEnd=!1,Te.error=0,Te.time=0,Te.progress=0,Te.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},Te.statusTotal={},Te.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1},Te.scanTypeStatus={vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},Te.btnObj.text="立即扫描",Te.btnObj.type="primary",Te.title="定期扫描网站，提升网站安全性",Te.msg="当前安全风险未知，请立即扫描"},Je=async()=>{try{const{data:e}=await V();e.risk_count.high+e.risk_count.middle>0?(Te.error=e.risk_count.high+e.risk_count.middle,Te.title="".concat(e.web_count,"个网站检测出，高危").concat(e.risk_count.high>0?'<span class="text-danger">'.concat(e.risk_count.high,"</span>"):0,"个/中危").concat(e.risk_count.middle,"个！"),Te.msg="上次扫描时间：".concat(e.scan_time)):(Te.title="已完成对".concat(e.web_count,"个网站的全面检测，暂未发现风险。"),Te.msg="最后扫描时间：".concat(e.scan_time)),e.risk_count.high>0&&(Te.isEnd=!0)}catch(e){t(e)}};return Je(),b(()=>{He(),null==Ce||Ce.send({mod_name:"webscanning",def_name:"GetAllSite",ws_callback:""})}),(e,s)=>{const a=n,t=F,r=H,d=z,m=c,p=o,u=A,b=D,B=l,P=i,V=g("bt-loading");return f((y(),x("div",J,[h("div",K,[h("div",R,[h("div",N,[v(Te).scanStatus?(y(),x("div",U,[s[1]||(s[1]=h("div",{class:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full"},null,-1)),k(a,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(y(),x("div",q,[v(Te).warn||v(Te).error?(y(),_(a,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(y(),_(a,{key:1,icon:"scanning-"+(v(Te).isEnd?"success":"danger"),size:72,color:v(Te).isEnd?"var(--el-color-primary)":"#F39C12"},null,8,["icon","color"]))]))])]),h("div",Q,[h("div",{class:"scanning-progress-title",innerHTML:v(Te).title},null,8,W),h("div",X,w(v(Te).msg.length>35?v(Te).msg.substring(0,35)+"...":v(Te).msg),1)]),h("div",Y,[k(t,{class:j({"warning-hover":v(Te).scanStatus}),plain:!!v(Te).scanStatus,type:v(Te).btnObj.type,onClick:De},{default:S(()=>[T(w(v(Te).btnObj.text),1)]),_:1},8,["class","plain","type"])])]),f(k(r,{class:"!w-full",color:v(Te).progressColor,"show-text":!1,"stroke-width":2,percentage:v(Te).progress},null,8,["color","percentage"]),[[C,v(Te).scanStatus]]),f(k(d,{class:"!mt-0 !mb-20px !bg-base"},null,512),[[C,!v(Te).scanStatus]]),h("div",Z,[v(Te).scanStatus||v(Te).isEnd?M("",!0):(y(),x("div",$,[s[2]||(s[2]=h("div",{class:"font-bold text-medium text-secondary my-[4rem]"},"支持网站以下安全扫描项:",-1)),h("div",ee,[(y(!0),x(L,null,O(v(we),(e,s)=>(y(),x("div",{key:s,class:"flex flex-col inline-block items-center mb-20px"},[k(m,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),T(" "+w(e.title),1)]))),128))])])),v(Te).scanStatus||v(Te).isEnd?(y(!0),x(L,{key:1},O(v(we),(e,a)=>(y(),x("div",{key:a,class:j([e.name+"_item "+(v(Te).active[e.name]?"active":""),"progress_item"])},[h("div",{class:"progress_item_header",onClick:s=>(e=>{Te.active[e]||(Te.active[e]=!1),Te.active[e]=!Te.active[e]})(e.name)},[h("div",ae,[k(m,{class:"mr-12px w-[2rem]",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),h("span",null,w(e.title),1)]),h("div",te,[v(Te).scanStatus&&v(Se)==e.name?(y(),x("span",ne," 正在扫描... ")):v(Te).scanStatus&&v(Se)!=e.name&&!v(Te).statusTotal[e.name]&&v(Te).scanTypeStatus[e.name]?(y(),x("span",le," 等待扫描 ")):v(Te).statusTotal[e.name]?(y(),x("span",ie," 发现"+w(v(Te).statusTotal[e.name])+"项危险 ",1)):(y(),x("span",re,"无风险项"))]),h("div",ce,[h("span",oe,w(v(Te).active[e.name]?"收起":"展开"),1),h("i",{class:j(v(Te).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,se),f(h("div",de,[k(b,{accordion:""},{default:S(()=>[(y(!0),x(L,null,O(v(Te).progressConfig[e.name],(e,a)=>(y(),_(u,{key:a,disabled:"free"==v(he).authType},{title:S(()=>[h("div",me,[h("div",pe,[h("span",{class:"text-small h-[2.2rem] flex items-center px-[8px] rounded-small mr-[1rem]",style:I({color:v(je)[e.dangerous||0].color,backgroundColor:v(je)[e.dangerous||0].bg})},w(v(je)[e.dangerous||0].text),5),h("span",{innerHTML:e.info,class:"w-[46rem] truncate"},null,8,ue)]),k(p,{class:"mb-2px mr-4px",onClick:Ve},{default:S(()=>[...s[3]||(s[3]=[T(" 详情 ",-1)])]),_:1})])]),default:S(()=>[h("div",be,[h("div",ge,[s[4]||(s[4]=h("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),h("span",{class:"leading-[1.6rem]",innerHTML:e.detail},null,8,fe)]),k(d,{class:"!my-8px"}),h("div",ve,[s[5]||(s[5]=h("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),h("span",{innerHTML:e.repair},null,8,ye)])])]),_:2},1032,["disabled"]))),128))]),_:2},1024)],512),[[C,v(Te).active[e.name]]])],2))),128)):M("",!0)]),k(P,{title:"选择扫描网站",modelValue:v(Oe),"onUpdate:modelValue":s[0]||(s[0]=e=>E(Oe)?Oe.value=e:null),ref_key:"scanSiteListDialog",ref:Le,area:45,onConfirm:Ie,showFooter:""},{default:S(()=>[h("div",xe,[k(B,{ref_key:"scanSiteTableRef",ref:ke,data:v(Ee),column:v(Fe),"max-height":296,onSelectionChange:ze,description:"网站列表为空"},null,8,["data","column"])])]),_:1},8,["modelValue"])])),[[V,v(_e)]])}}}),[["__scopeId","data-v-bea56db3"]]);export{he as default};
