!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function u(n,r,o,u){var a=r&&r.prototype instanceof c?r:c,s=Object.create(a.prototype);return l(s,"_invoke",function(n,r,o){var u,a,l,c=0,s=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return u=t,a=0,l=e,p.n=n,i}};function d(n,r){for(a=n,l=r,t=0;!f&&c&&!o&&t<s.length;t++){var o,u=s[t],d=p.p,v=u[2];n>3?(o=v===r)&&(l=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=e):u[0]<=d&&((o=n<2&&d<u[1])?(a=0,p.v=r,p.n=u[1]):d<v&&(o=n<3||u[0]>r||r>v)&&(u[4]=n,u[5]=r,p.n=v,a=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,v){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,v),a=s,l=v;(t=a<2?e:l)||!f;){u||(a?a<3?(a>1&&(p.n=-1),d(a,l)):p.n=l:p.v=l);try{if(c=2,u){if(a||(o="next"),t=u[o]){if(!(t=t.call(u,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,a<2&&(a=0)}else 1===a&&(t=u.return)&&t.call(u),a<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=e}else if((t=(f=p.n<0)?l:n.call(r,p))!==i)break}catch(t){u=e,a=1,l=t}finally{c=1}}return{value:t,done:f}}}(n,o,u),!0),s}var i={};function c(){}function s(){}function f(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(l(t={},r,function(){return this}),t),d=f.prototype=c.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=f,l(d,"constructor",f),l(f,"constructor",s),s.displayName="GeneratorFunction",l(f,o,"GeneratorFunction"),l(d),l(d,o,"Generator"),l(d,r,function(){return this}),l(d,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m:v}})()}function l(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,n,r){function u(t,n){l(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(u("next",0),u("throw",1),u("return",2))},l(e,t,n,r)}function i(e,t,n,r,o,u,a){try{var l=e[u](a),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var u=e.apply(t,n);function a(e){i(u,r,o,a,l,"next",e)}function l(e){i(u,r,o,a,l,"throw",e)}a(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./index-legacy130.js?v=1763689792","./column-legacy.js?v=1763689792","./useController-legacy6.js?v=1763689792","./useStore-legacy4.js?v=1763689792","./site-legacy.js?v=1763689792","./masker.vue_vue_type_script_setup_true_lang-legacy.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./validator-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792","./index-legacy137.js?v=1763689792","./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang-legacy.js?v=1763689792"],function(e,n){"use strict";var r,u,l,i,s,f,p,d,v,m,y,h,b,g,w,_,x,j,O,k,S,P,E,V,A,C,T,D,F,G,I,R,U,q,z,B,N,J,M,H,$,K,L,Q,W,X,Y,Z,ee,te,ne,re,oe,ue,ae;return{setters:[function(e){r=e.aK,u=e.p,l=e.Q,i=e.aA,s=e.aC,f=e.k,p=e.l,d=e.ah,v=e.$,m=e.j,y=e.b,h=e._},function(e){b=e.c,g=e.r,w=e.o,_=e.e,x=e.g,j=e.D,O=e.F,k=e.v,S=e.I,P=e.J,E=e.z,V=e.x,A=e.y,C=e.O,T=e.G,D=e.R,F=e.C,G=e.A,I=e.b1,R=e.W,U=e.ap,q=e.H,z=e.am,B=e.an,N=e.ad,J=e.ab,M=e.w},function(e){H=e._},function(e){$=e._},function(e){K=e.a,L=e.u,Q=e.c},function(e){W=e.o,X=e.v},function(e){Y=e.u},function(e){Z=e.getTamperRuleByPath,ee=e.addBlackExts,te=e.releaseFileExt,ne=e.syncBlackExts,re=e.removeBlackExts,oe=e.getActionLogsForExts,ue=e.getSiteInfo},function(e){ae=e._},null,null,null,null,null,null],execute:function(){var n={class:"flex gap-col-1rem"},le={class:"p-2rem"},ie=b({__name:"protect-ext",props:{compData:{default:{}}},setup:function(e,h){var b,ie=h.expose,ce=y(),se=Y().siteInfo,fe=g("file"),pe=g(),de=g(!1),ve=g(""),me=g(!1),ye=g({}),he=g([]),be=g([]),ge=g(!1),we=g(!1),_e=g(),xe=g(!1),je=w({sites:[],list:[]}),Oe=w({sites:[{required:!0,message:"请选择同步配置",trigger:"blur"}]}),ke=g([{label:"受保护的文件类型",name:"file",lazy:!0,render:function(){return _("span",null,null)}},{label:"受保护的文件目录",name:"directory",lazy:!0,render:function(){return _("span",null,null)}}]),Se=x(function(){return"file"===fe.value?[{content:"所谓文件类型是指文件名结尾的字符串，不一定是扩展名"},{content:_(O,null,[j("例如"),_("code",null,[j(".php")]),j(","),_("code",null,[j(".html")]),j(","),_("code",null,[j(".js?v=1763689792")]),j(","),_("code",null,[j("index.php")]),j("等")])},{content:_(O,null,[j("例1："),_("code",null,[j(".php")]),j("匹配："),_("code",null,[j("./1.php")]),_("code",null,[j("./test/2.php")]),j("不匹配："),_("code",null,[j("./1.php/1.txt")])])},{content:_(O,null,[j("例2："),_("code",null,[j("index.php")]),j("匹配："),_("code",null,[j("./index.php")]),_("code",null,[j("./test/index.php")]),_("code",null,[j("./abc_index.php")]),j("不匹配："),_("code",null,[j("./index.php.tar.gz")])])}]:[{content:"支持以下4种方式"},{content:_(O,null,[j("1、完整文件路径，如："),_("code",null,[j("/www/wwwroot/test/123.php")])])},{content:_(O,null,[j("2、相对于网站的相对路径，如：全路径是"),_("code",null,[j("/www/wwwroot/test/app/123.php")]),j("相对路径"),_("code",null,[j("./app/123.php")])])},{content:_(O,null,[j("3、指定目录下的所有文件，如："),_("code",null,[j("/www/wwwroot/test/app/*")]),j("相对路径"),_("code",null,[j("./app/*")])])},{content:_(O,null,[j("4、指定目录下的指定文件类型，如："),_("code",null,[j("/www/wwwroot/test/app/*.php")]),j("相对路径"),_("code",null,[j("./app/*.php")])])},{content:_("span",{class:"text-danger"},[j("注意，已经在【受保护的文件类型】中被包含的文件无需专门设置规则")])}]}),Pe=[{content:_(O,null,[j("【一键应用】将当前网站已配置的"),_("span",{class:"text-danger"},[j("排除目录")]),j("，"),_("span",{class:"text-danger"},[j("防护文件")]),j("，同步配置到其他网站")])}],Ee=function(){var e=c(a().m(function e(t,n,r,o){var u,l,i;return a().w(function(e){for(;;)switch(e.n){case 0:return u=o.label,l=o.value,i=function(){var e=c(a().m(function e(t,n){var r,o,u,i,c,s,f,p,d;return a().w(function(e){for(;;)switch(e.n){case 0:r=new Map([["open",te],["close",te],["delete",re]]),o=t.exts,u=ye.value,i=u.pid,c=u.path,s=r.get(l),d=l,e.n="open"===d||"close"===d?1:"delete"===d?2:3;break;case 1:if(!s){e.n=2;break}return f={path_id:i,exts:o,release:"open"!==l?1:0},e.a(2,s(f));case 2:if(!s){e.n=3;break}return p={path_id:i,exts:o,path:c},e.a(2,s(p));case 3:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),e.n=1,t({title:"批量".concat(u),content:"批量".concat(u,"，是否继续操作？"),column:[{label:"".concat("file"===fe.value?"文件类型":"文件全路径 或 相对路径"),prop:"exts"},Q()],onConfirm:function(){var e=c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n(i);case 1:return Ve(),e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),Ve=function(){var e=c(a().m(function e(){var t,n,o,u,l,i,c,s=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=s.length>0&&void 0!==s[0]&&s[0],e.p=1,t&&(de.value=!0),e.n=2,Z({path:se.value.path});case 2:n=e.v,o=n.data,u=[],o.hasOwnProperty("status")&&(ye.value=o,l=o.black_exts||[],i=o.white_exts||[],null==l||l.forEach(function(e){u.push({exts:e,limit_status:1})}),null==i||i.forEach(function(e){u.push({exts:e,limit_status:0})})),he.value=u.filter(function(e){return"file"===fe.value?-1===e.exts.indexOf("/"):-1!==e.exts.indexOf("/")}),e.n=4;break;case 3:e.p=3,c=e.v,r(c);case 4:return e.p=4,t&&(de.value=!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(){return e.apply(this,arguments)}}(),Ae=function(){var e=c(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(""!==ve.value){e.n=1;break}return e.a(2,ce.error("文件类型不能为空"));case 1:return e.p=1,e.n=2,ee({path_id:ye.value.pid,path:ye.value.path,exts:ve.value});case 2:t=e.v,ce.request(t),t.status&&(ve.value="",Ve()),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=c(a().m(function e(t,n){return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t.limit_status=n?1:0,e.n=1,u({title:"".concat(n?"开启":"关闭","【").concat(t.exts,"】"),content:"".concat(n?"开启该受保护文件类型后，该类型后缀文件将被保护，是否继续？":"关闭该受保护文件类型后，该类型后缀文件将不被保护，是否继续？"),icon:"warning"});case 1:return e.n=2,l({loading:"正在设置保护文件状态，请稍后...",request:te({path_id:ye.value.pid,exts:t.exts,release:n?0:1}),message:!0});case 2:e.v.status&&Ve(),e.n=4;break;case 3:e.p=3,"cancel"===e.v&&(t.limit_status=n?0:1);case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,n){return e.apply(this,arguments)}}(),Te=function(){var e=c(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,l({loading:we,request:ue(),data:Array});case 1:t=e.v,je.list=t;case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),De=function(){var e=c(a().m(function e(){var t,n,o,u,l;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,_e.value.validate();case 1:return e.p=1,n={},be.value.forEach(function(e){n[e.exts]=e.limit_status}),o={site_ids:JSON.stringify(je.sites),exts:JSON.stringify(n)},e.n=2,ne(o);case 2:u=e.v,ge.value=!1,W({title:"批量同步到其他站点",resultData:null===(t=u.data)||void 0===t?void 0:t.map(function(e){return{name:e.name,status:"同步成功"===e.msg,msg:e.msg}}),resultTitle:"批量同步到其他站点操作",showMult:!1}),e.n=4;break;case 3:e.p=3,l=e.v,r(l);case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),Fe=function(){var e=c(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({title:"删除受保护的文件类型【"+t.exts+"】",content:"删除受保护的文件类型后，文件名以该后缀结尾的文件将失去保护，是否继续操作？",icon:"warning"});case 1:return e.n=2,l({loading:"正在删除受保护的文件类型，请稍后...",request:re({path_id:ye.value.pid,path:ye.value.path,exts:t.exts}),message:!0});case 2:e.v.status&&Ve();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=c(a().m(function e(t){var n,u,l,c,s;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,u={path_id:ye.value.pid,exts:t.exts,row:10,p:1,pid:ye.value.pid},e.n=1,oe(u);case 1:l=e.v,c=l.data,null!==(n=c.data)&&void 0!==n&&n.length?X({title:"受保护的文件类型【".concat(t.exts,"】日志"),row:t,data:c,params:o(o({},u),{},{total:i(c.page)})}):ce.error("暂无日志"),e.n=3;break;case 2:e.p=2,s=e.v,r(s);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),Ie=function(e){ve.value="",fe.value=e,Re.value[1].label="file"===e?"文件类型":"文件全路径 或 相对路径",Ve()},Re=R([K(),{prop:"exts",label:"文件路径"},{prop:"limit_status",label:"状态",render:function(e,t){var n=1===e.limit_status;return _(U,{size:"small",modelValue:n,"onUpdate:modelValue":function(e){return n=e},onChange:function(t){return Ce(e,t)}},null)}},L([{title:"日志",onClick:Ge},{title:"删除",onClick:Fe}])]),Ue=[{label:"开启受保护文件类型",value:"open",event:Ee},{label:"关闭受保护文件类型",value:"close",event:Ee},{label:"同步到其他站点",value:"sync",event:(b=c(a().m(function e(t,n,r,o,u){return a().w(function(e){for(;;)switch(e.n){case 0:be.value=r.value,je.sites=[],ge.value=!0,Te(),M(function(){return ge.value},function(e){e||u()});case 1:return e.a(2)}},e)})),function(e,t,n,r,o){return b.apply(this,arguments)})},{label:"删除受保护文件类型",value:"delete",event:Ee}];return k(function(){Ve(!0)}),ie({init:function(){Ve(!0)}}),function(r,u){var a,l=s,i=f,c=q,y=$,h=p,b=d,g=H,w=v,x=z,k=B,R=N,U=J,M=m,K=S("bt-loading");return P((V(),A("div",null,[null!==(a=E(ye))&&void 0!==a&&a.path?T("",!0):(V(),C(ae,{key:0,compData:o(o({},e.compData),{},{init:Ve})},null,8,["compData"])),_(l,{ref:"tamperRef",type:"",modelValue:E(fe),"onUpdate:modelValue":u[0]||(u[0]=function(e){return D(fe)?fe.value=e:null}),options:E(ke),onChange:Ie},null,8,["modelValue","options"]),_(g,null,{"header-left":F(function(){return[G("div",n,[_(i,{modelValue:E(ve),"onUpdate:modelValue":u[1]||(u[1]=function(e){return D(ve)?ve.value=e:null}),width:"30rem",placeholder:"文件类型"},null,8,["modelValue"]),_(c,{type:"primary",onClick:Ae},{default:F(function(){return t(u[4]||(u[4]=[j("添加",-1)]))}),_:1})])]}),"header-right":F(function(){return[_(y,{onRefresh:Ve})]}),content:F(function(){return[P(_(h,{ref_key:"protectTableRef",ref:pe,column:E(Re),"max-height":360,data:E(he)},null,8,["column","data"]),[[K,E(me)]])]}),"footer-left":F(function(){return[_(b,{"table-ref":E(pe),options:E(Ue)},null,8,["table-ref","options"])]}),"footer-right":F(function(){return t(u[5]||(u[5]=[]))}),_:1}),_(w,{class:"ml-2rem mt-2rem tamper-help-info","list-style":"disc",options:E(Se)},null,8,["options"]),_(M,{title:"批量同步到其他站点",modelValue:E(ge),"onUpdate:modelValue":u[3]||(u[3]=function(e){return D(ge)?ge.value=e:null}),area:50,"show-footer":"",onConfirm:De},{default:F(function(){return[G("div",le,[P((V(),C(U,{ref_key:"applyFormRef",ref:_e,model:E(je),rules:E(Oe),disabled:E(xe)},{default:F(function(){return[_(R,{label:"同步站点",prop:"sites"},{default:F(function(){return[_(k,{modelValue:E(je).sites,"onUpdate:modelValue":u[2]||(u[2]=function(e){return E(je).sites=e}),multiple:"","collapse-tags":"",class:"w-30rem",placeholder:"请选择站点"},{default:F(function(){return[(V(!0),A(O,null,I(E(je).list,function(e){return V(),A(O,null,[e.id!==E(se).id?(V(),C(x,{key:e.id,label:e.rname,value:e.id},null,8,["label","value"])):T("",!0)],64)}),256))]}),_:1},8,["modelValue"])]}),_:1})]}),_:1},8,["model","rules","disabled"])),[[K,E(we)]]),_(w,{"list-style":"disc",class:"mt-2rem ml-2rem",options:Pe})])]}),_:1},8,["modelValue"])])),[[K,E(de)],[K,"正在获取站点防篡改信息，请稍侯","title"]])}}});e("default",h(ie,[["__scopeId","data-v-c00984a8"]]))}}})}();
