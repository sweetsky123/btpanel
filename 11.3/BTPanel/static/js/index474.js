import{_ as a}from"./index109.js?v=1763689792";import{u as e,Q as l,M as t,k as s,l as n,ah as o,e as i,$ as r,j as u,p as d,aK as m}from"./utils-lib.js?v=1763689792";import{B as c}from"./index119.js?v=1763689792";import{c as p,r as f,e as v,v as w,I as b,x as g,y as x,A as h,z as y,R as _,C as j,F as V,b1 as k,D as C,J as U,an as q,H as A,aE as E,O as S,am as D}from"./base-lib.js?v=1763689792";import{a as R,u as T}from"./column.js?v=1763689792";import{o as F}from"./useController6.js?v=1763689792";import{S as H,u as I}from"./useStore4.js?v=1763689792";import{getDirBinding as N,addDirBinding as O,getFileBody as z,deleteDirBindMultiple as B,delDirBinding as J,getDirRewrite as K}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./ace.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";const M={class:"flex items-center"},Q={class:"flex items-center mr-[16px]"},$={class:"flex items-center mr-[16px]"},G={class:"p-[20px]"},L={class:"flex items-center justify-between"},P={class:"flex items-center"},W=p({__name:"index",props:{compData:{default:()=>({})}},setup(p,{expose:W}){const{saveFileEvent:X}=H(),{plugin:Y}=e(),{siteInfo:Z}=I(),aa=f(),ea=f(""),la=f([]),ta=f("");f([]);const sa=f(!1),na=f(""),oa=f(""),ia=f([]),ra=f(""),ua=f(!1),da=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],ma=f([]),ca=f(!1),pa=async()=>{await l({loading:ca,request:N({id:Z.value.id}),data:{dirs:[Array,la],binding:[Array,ma]}}),ta.value=la.value[0]||""},fa=async()=>{if(!ta.value||!ea.value)return void t.error("域名和子目录都不可为空！");(await l({loading:"正在添加子目录中,清稍后...",request:O({id:Z.value.id,domain:ea.value,dirName:ta.value}),message:!0})).status&&(ea.value="",pa())},va=async()=>{await X({data:na.value,encoding:"utf-8",path:ra.value})},wa=async a=>{let e=t.load("正在获取伪静态内容，请稍候..."),l={id:a.id};a.add&&(l.add=1);try{const t=await K(l);e.close(),t.data.status?(na.value=t.data.data,ia.value=t.data.rlist,oa.value=t.data.rlist[0],ra.value=t.data.filename,sa.value=!0):(await d({title:"创建伪静态",icon:"warning-filled",content:"你真的要为这个子目录创建独立的伪静态规则吗？"}),wa({...a,add:1}))}catch(s){m(s)}finally{e.close()}},ba=async a=>{l({loading:ua,request:z({path:"/www/server/panel/rewrite/".concat(Y.value.webserver,"/").concat(a,".conf")}),data:{data:[String,na]}})},ga=f([R(),{prop:"domain",label:"域名",render:a=>v("span",{class:"cursor-pointer bt-link",onClick:()=>{window.open("http://".concat(a.domain,":").concat(a.port),"_blank","noopener,noreferrer")}},[a.domain])},{prop:"port",label:"端口"},{width:220,label:"子目录",render:a=>v("span",null,[a.path])},T([{onClick:wa,title:"伪静态",width:60},{onClick:async a=>{await d({title:"删除【".concat(a.domain,"】"),content:"删除选中的子目录绑定后，将无法访问该子目录绑定的域名，是否继续操作？",icon:"warning-filled"});(await l({loading:"正在删除，请稍后...",request:J({id:a.id}),message:!0})).status&&pa()},title:"删除"}])]),xa=[{label:"删除",value:"delete",event:async(a,e,l,t,s)=>{await d({title:"批量删除",width:"35rem",icon:"warning-filled",content:"批量删除，该操作可能会存在风险，是否继续？"});let n=[l.value.map(a=>a.id)];const{data:o}=await B({bind_ids:n,id:Z.value.id});let i=[];await o.success.forEach(a=>{i.push({name:a,msg:"删除成功",status:!0})}),await Object.keys(o.error).forEach(a=>{i.push({name:a,msg:o.data.error[a],status:!1})}),await F({resultData:i,resultTitle:"删除",resultColumn:[{label:"域名",prop:"name"},{label:"结果",render:a=>E("span",{class:a.status?"text-primary":"text-danger"},a.status?a.msg||"操作成功":a.msg||"操作失败")}]}),pa(),s()}}];return w(pa),W({init:pa}),(e,l)=>{const t=s,d=D,m=q,p=A,f=n,w=o,E=i,R=c,T=r,F=u,H=a,I=b("bt-loading");return g(),x("div",null,[h("div",M,[h("div",Q,[l[5]||(l[5]=h("span",{class:"mr-[16px] w-[4rem]"},"域名",-1)),v(t,{modelValue:y(ea),"onUpdate:modelValue":l[0]||(l[0]=a=>_(ea)?ea.value=a:null),placeholder:"请输入域名"},null,8,["modelValue"])]),h("div",$,[l[6]||(l[6]=h("span",{class:"mr-[16px]"},"子目录",-1)),v(m,{class:"!w-[15rem]",filterable:"",modelValue:y(ta),"onUpdate:modelValue":l[1]||(l[1]=a=>_(ta)?ta.value=a:null)},{default:j(()=>[(g(!0),x(V,null,k(y(la),(a,e)=>(g(),S(d,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),v(p,{type:"primary",onClick:fa},{default:j(()=>[...l[7]||(l[7]=[C("添加",-1)])]),_:1})]),v(H,null,{"header-left":j(()=>[...l[8]||(l[8]=[])]),"header-right":j(()=>[...l[9]||(l[9]=[])]),content:j(()=>[U(v(f,{ref_key:"subTableRef",ref:aa,"max-height":"500",column:y(ga),data:y(ma)},null,8,["column","data"]),[[I,y(ca)]])]),"footer-left":j(()=>[v(w,{"table-ref":y(aa),options:y(xa)},null,8,["table-ref","options"])]),"footer-right":j(()=>[...l[10]||(l[10]=[])]),popup:j(()=>[v(F,{title:"伪静态规则",modelValue:y(sa),"onUpdate:modelValue":l[4]||(l[4]=a=>_(sa)?sa.value=a:null),area:50},{default:j(()=>[h("div",G,[h("div",L,[v(m,{class:"!w-[15rem]",modelValue:y(oa),"onUpdate:modelValue":l[2]||(l[2]=a=>_(oa)?oa.value=a:null),onChange:ba},{default:j(()=>[(g(!0),x(V,null,k(y(ia),(a,e)=>(g(),S(d,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),h("span",P,[l[12]||(l[12]=C(" 规则转换工具： ",-1)),v(E,{class:"flex items-center",href:"https://www.bt.cn/Tools",target:"_blank"},{default:j(()=>[...l[11]||(l[11]=[C("Apache转Nginx ",-1),h("i",{class:"svgtofont-el-link"},null,-1)])]),_:1})])]),U(v(R,{id:"statictRef",class:"!h-[40rem] !w-full my-[12px]",modelValue:y(na),"onUpdate:modelValue":l[3]||(l[3]=a=>_(na)?na.value=a:null),onSave:va},null,8,["modelValue"]),[[I,y(ua)]]),h("div",null,[v(p,{type:"primary",onClick:va},{default:j(()=>[...l[13]||(l[13]=[C("保存",-1)])]),_:1})]),v(T,{options:da,class:"ml-[20px] mt-[20px]"})])]),_:1},8,["modelValue"])]),_:1})])}}});export{W as default};
