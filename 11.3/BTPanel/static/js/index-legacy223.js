!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},l=n.iterator||"@@iterator",u=n.toStringTag||"@@toStringTag";function i(n,a,l,u){var i=a&&a.prototype instanceof o?a:o,s=Object.create(i.prototype);return r(s,"_invoke",function(n,a,r){var l,u,i,o=0,s=r||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return l=t,u=0,i=e,d.n=n,c}};function p(n,a){for(u=n,i=a,t=0;!f&&o&&!r&&t<s.length;t++){var r,l=s[t],p=d.p,m=l[2];n>3?(r=m===a)&&(i=l[(u=l[4])?5:(u=3,3)],l[4]=l[5]=e):l[0]<=p&&((r=n<2&&p<l[1])?(u=0,d.v=a,d.n=l[1]):p<m&&(r=n<3||l[0]>a||a>m)&&(l[4]=n,l[5]=a,d.n=m,u=0))}if(r||n>1)return c;throw f=!0,a}return function(r,s,m){if(o>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),u=s,i=m;(t=u<2?e:i)||!f;){l||(u?u<3?(u>1&&(d.n=-1),p(u,i)):d.n=i:d.v=i);try{if(o=2,l){if(u||(r="next"),t=l[r]){if(!(t=t.call(l,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,u<2&&(u=0)}else 1===u&&(t=l.return)&&t.call(l),u<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),u=1);l=e}else if((t=(f=d.n<0)?i:n.call(a,d))!==c)break}catch(t){l=e,u=1,i=t}finally{o=1}}return{value:t,done:f}}}(n,l,u),!0),s}var c={};function o(){}function s(){}function f(){}t=Object.getPrototypeOf;var d=[][l]?t(t([][l]())):(r(t={},l,function(){return this}),t),p=f.prototype=o.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,u,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=f,r(p,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,u,"GeneratorFunction"),r(p),r(p,u,"Generator"),r(p,l,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:i,m:m}})()}function r(e,t,n,a){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}r=function(e,t,n,a){function u(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?l?l(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(u("next",0),u("throw",1),u("return",2))},r(e,t,n,a)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(t,n,a){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function c(e,t,n,a,r,l,u){try{var i=e[l](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var l=e.apply(t,n);function u(e){c(l,a,r,u,i,"next",e)}function i(e){c(l,a,r,u,i,"throw",e)}u(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./useStore-legacy2.js?v=1763689792","./index-legacy124.js?v=1763689792","./index-legacy109.js?v=1763689792","./column-legacy.js?v=1763689792","./database-legacy.js?v=1763689792","./index-legacy123.js?v=1763689792","./index-legacy107.js?v=1763689792","./index-legacy118.js?v=1763689792","./validator-legacy.js?v=1763689792","./useMethod-legacy4.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792"],function(e,n){"use strict";var r,l,i,c,s,f,d,p,m,v,b,g,y,h,_,x,k,w,D,j,B,O,P,C,q,V,S,T,z,F,M,A,E,U,I,G,H,R,W,N,Y,J,L,K,$,Q,Z,X,ee,te,ne,ae,re,le,ue,ie,ce,oe,se,fe,de,pe,me,ve,be,ge,ye,he,_e,xe,ke,we,De,je,Be,Oe,Pe,Ce,qe,Ve,Se,Te,ze,Fe,Me,Ae,Ee,Ue;return{setters:[function(e){r=e.u,l=e.an,i=e.V,c=e.Q,s=e.n,f=e.H,d=e.p,p=e.M,m=e.ap,v=e.x,b=e.b6,g=e.aK,y=e.bb,h=e.W,_=e.l,x=e.ah,k=e.j,w=e.k,D=e.R,j=e.az,B=e._,O=e.aC},function(e){P=e.c,C=e.g,q=e.o,V=e.r,S=e.v,T=e.x,z=e.y,F=e.z,M=e.O,A=e.G,E=e.A,U=e.B,I=e.J,G=e.L,H=e.e,R=e.C,W=e.D,N=e.aE,Y=e.a8,J=e.b6,L=e.aZ,K=e.H,$=e.ba,Q=e.am,Z=e.an,X=e.bu,ee=e.aB,te=e.I,ne=e.F,ae=e.R,re=e.K,le=e.at,ue=e.as,ie=e.ar,ce=e.ad,oe=e.ab,se=e.aD},function(e){fe=e.g},function(e){de=e._},function(e){pe=e._},function(e){me=e.u,ve=e.c,be=e.a,ge=e.h,ye=e.g},function(e){he=e.getBinlogBackupFiles,_e=e.delBinlogBackupTask,xe=e.getBinlogBackupLogs,ke=e.deleteBinlogBackupFile,we=e.clearBinlogBackup,De=e.restoreBinlogData,je=e.getBinlogBackupTask,Be=e.getIncrementBackupInfo,Oe=e.getRestoreProgress,Pe=e.backDatabase,Ce=e.backModuleDatabase,qe=e.delBackup,Ve=e.checkDatabasePass,Se=e.restoreModuleBack,Te=e.restoreBack},function(e){ze=e._},function(e){Fe=e._},function(e){Me=e._},function(e){Ae=e.f},function(e){Ee=e.t,Ue=e.w},null,null],execute:function(){var Ie={key:0},Ge={class:"data-show"},He={class:"bg-lighter rounded-lg border border-light p-6 mb-4"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-6 pb-6 border-b border-light"},We={class:"text-center md:text-left"},Ne={class:"text-medium"},Ye={class:"grid grid-cols-2 col-span-2 gap-6","element-loading-text":"获取中..."},Je={class:"text-center md:text-left"},Le={class:"text-medium"},Ke={class:"text-center md:text-left"},$e={class:"text-medium"},Qe={class:"pt-6 pb-3"},Ze={class:"flex items-center justify-between"},Xe={class:"flex items-center space-x-8"},et={class:"pb-3"},tt={class:"flex items-center space-x-4"},nt={class:"text-small text-secondary"},at={class:"text-small text-secondary"},rt={class:"flex items-center justify-between"},lt={class:"flex items-center space-x-8"},ut={class:"text-small font-medium"},it={class:"text-small font-medium"},ct={class:"flex items-center gap-4"},ot={class:"flex items-center"},st=P({__name:"index",props:{compData:{default:function(){return[]}},isRowBackup:{type:Boolean,default:!1}},setup:function(e,b){var g=b.expose,y=r().payment;C(function(){return y.value.authType}),fe();var h,_=e,x=q({name:"",tableCount:0,size:""}),k=V(!1),w=q({database_name:"test_db",full_backup_schedule:{type:"daily",time:"02:30:00",weekday:0,interval_days:0,interval_hours:0},incremental_backup_interval:30,enabled:!0,create_time:"",last_full_backup:"",last_incremental_backup:"",next_full_backup:"",next_incremental_backup:"",space_free:!0}),D=q({time:"",type:"all"}),j=q({disabledDate:function(e){var t=new Date;t.setHours(23,59,59,999);var n=t.getTime();return e.getTime()>n},defaultTime:[new Date,new Date]}),B={title:"企业增量备份",ps:"企业增量备份只定时备份发生变化新增、修改、删除文件和数据，不会每次都备份所有数据",source:54,desc:[],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/database/database_enterprise_backup.png"}]},O={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},ee=C(function(){if(!w.database_name)return"--";switch(w.full_backup_schedule.type){case"daily":return"每天 ".concat(w.full_backup_schedule.time," 备份");case"weekly":return"每周 ".concat(O[w.full_backup_schedule.weekday]," ").concat(w.full_backup_schedule.time," 备份");case"interval":return"每隔 ".concat(w.full_backup_schedule.interval_days," 天后 ").concat(w.full_backup_schedule.time," 备份");case"hours":return"每隔 ".concat(w.full_backup_schedule.interval_hours," 小时 ").concat(w.full_backup_schedule.time||""," 备份")}}),te=C(function(){return w.database_name?w.incremental_backup_interval>60?"每 ".concat(Math.floor(w.incremental_backup_interval/60),"小时").concat(w.incremental_backup_interval%60,"分钟备份"):"每 ".concat(w.incremental_backup_interval," 分钟备份"):"--"}),ne=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:s({title:"配置备份计划",area:85,component:function(){return f(function(){return n.import("./add-increment-legacy.js?v=1763689792")},void 0,n.meta.url)},showFooter:!0,compData:u(u({},_.compData),{},{backupPlan:w,refreshEvent:function(){ye()}})});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(!w.enabled){e.n=3;break}return e.n=1,d({title:"停止备份计划",content:"确定停止数据库【".concat(w.database_name,"】增量备份计划吗？停止后将无法进行增量备份")});case 1:return e.n=2,c({loading:"停止备份计划中...",message:!0,request:_e({id:_.compData.id})});case 2:ye(),e.n=4;break;case 3:ne();case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),re=function(){s({title:"备份日志",area:56,btns:!1,component:P({setup:function(){var e=V("");return c({loading:"获取日志中...",request:xe({id:_.compData.id}),success:function(t){if(!t.data.status)return p.error(t.data.msg);e.value=t.data.data.join("\n")}}),function(){return N("div",{class:"overflow-y-auto"},N(ze,{class:"!h-[40rem]",content:e.value,isHtml:!0}))}}})})},le=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,d({title:"删除备份",content:"确定删除该备份吗？删除后将无法恢复!"});case 1:return e.n=2,c({loading:"删除备份中...",message:!0,request:ke({backup_id:t})});case 2:ge();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,d({title:"清空备份",content:"当前将清空【".concat(_.compData.name,"】下通过备份计划备份的全量与增量备份（不会清除手动备份），请确保当前数据已正常，再清空备份"),type:"calc"});case 1:return e.n=2,c({loading:"清空备份中...",message:!0,request:we({id:_.compData.id})});case 2:ge();case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:window.open("/download?filename="+t,"_blank");case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=o(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,d({title:"还原备份【".concat(t.backup_time,"】"),content:"此操作将覆盖当前数据库的所有数据，请确保已经备份现有数据！",type:"calc"});case 1:return e.n=2,c({loading:"还原备份中...",request:De({id:_.compData.id,restore_time:t.backup_time})});case 2:if((n=e.v).data.status){e.n=3;break}return e.a(2,p.error(n.data.msg));case 3:s({title:"还原进度",area:56,btns:!1,component:P({setup:function(e,t){t.emit;var r=q({status:"preparing",progress:0,message:"准备还原数据...",restore_time:"",start_time:"",update_time:"",error:null,backup_files:[]}),l=V(null),u=V(!0),i={preparing:{text:"准备还原数据",color:"#20a53a",progress:0},analyzing:{text:"分析备份文件",color:"#20a53a",progress:10},restoring:{text:"正在还原数据",color:"#20a53a",progress:20},finalizing:{text:"完成还原操作",color:"#20a53a",progress:90},completed:{text:"还原完成",color:"#20a53a",progress:100},failed:{text:"还原失败",color:"#f56c6c",progress:0},not_found:{text:"任务不存在",color:"#e6a23c",progress:0}},s=function(){var e=o(a().m(function e(){var t,o,f,d,m,v,b,g;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(u.value){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,c({request:Oe({task_id:n.data.data.task_id})});case 2:null!=(o=e.v)&&null!==(t=o.data)&&void 0!==t&&t.status?(d=o.data.data,r.status=d.status||"preparing",r.message=d.message||(null===(f=i[r.status])||void 0===f?void 0:f.text)||"处理中...",r.restore_time=d.restore_time||"",r.start_time=d.start_time||"",r.update_time=d.update_time||"",r.backup_files=d.backup_files||[],r.error=d.error||null,void 0!==d.progress?r.progress=Math.min(Math.max(d.progress,0),100):r.progress=(null===(m=i[r.status])||void 0===m?void 0:m.progress)||0,!(v=["completed","failed","not_found"].includes(r.status))&&u.value?l.value=setTimeout(s,1500):v&&("completed"===r.status?(p.success("数据库还原成功"),ge()):"failed"===r.status&&p.error(r.error||"还原失败，请查看错误信息"),u.value=!1)):(r.status="failed",r.message=(null==o||null===(b=o.data)||void 0===b?void 0:b.msg)||"获取进度失败",r.error=(null==o||null===(g=o.data)||void 0===g?void 0:g.error_msg)||"未知错误",u.value=!1),e.n=4;break;case 3:e.p=3,e.v,r.status="failed",r.message="获取进度失败，请检查网络连接",r.error="网络连接异常",u.value=!1;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}();return s(),Y(function(){l.value&&(clearTimeout(l.value),l.value=null),u.value=!1}),function(){var e,t;return H("div",{class:"p-[2rem]"},[H("div",{class:"flex items-center mb-[2rem]"},[H("i",{class:["!text-[3rem] mr-[1rem]","completed"===r.status?"svgtofont-el-success-filled text-primary":"failed"===r.status?"svgtofont-el-circle-close-filled text-danger":"svgtofont-el-loading animate-spin text-primary"]},null),H("div",{class:"flex-1"},[H("div",{class:"text-medium font-medium mb-[4px]"},["completed"===r.status?"还原成功":"failed"===r.status?"还原失败":"正在还原数据库"]),H("div",{class:"text-small text-secondary"},[W("数据库："),_.compData.name])])]),!["completed","failed"].includes(r.status)&&H("div",{class:"mb-[2rem]"},[H("div",{class:"flex justify-between items-center mb-[8px]"},[H("span",{class:"text-base"},[r.message]),H("span",{class:"text-small text-secondary"},[r.progress,W("%")])]),H(J,{percentage:r.progress,"stroke-width":8,"show-text":!1,color:(null===(e=i[r.status])||void 0===e?void 0:e.color)||"#20a53a"},null)]),H("div",{class:"bg-light rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-base font-medium mb-[1rem] text-default"},[W("还原信息")]),H("div",{class:"space-y-[8px] text-small text-secondary"},[r.restore_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[W("还原时间点：")]),H("span",null,[r.restore_time])]),r.start_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[W("开始时间：")]),H("span",null,[r.start_time])]),r.update_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[W("更新时间：")]),H("span",null,[r.update_time])]),H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[W("当前状态：")]),H("span",{class:"flex items-center"},[H("span",{class:["w-[8px] h-[8px] rounded-full mr-[6px]","completed"===r.status?"bg-primary":"failed"===r.status?"bg-[#ef0808]":"hidden"]},null),(null===(t=i[r.status])||void 0===t?void 0:t.text)||r.message])])])]),r.backup_files&&r.backup_files.length>0&&H("div",{class:"bg-light rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-base font-medium mb-[1rem] text-default"},[W("相关备份文件 ("),r.backup_files.length,W("个)")]),H("div",{class:"space-y-[4px] max-h-[8rem] overflow-y-auto"},[r.backup_files.map(function(e,t){return H("div",{key:t,class:"text-[1.1rem] text-secondary bg-white px-[8px] py-[4px] rounded"},[e])})])]),"failed"===r.status&&r.error&&H("div",{class:"bg-light border rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-base font-medium mb-[1rem] text-danger flex items-center"},[H("i",{class:"svgtofont-el-warning-filled mr-[6px]"},null),W("错误详情")]),H("div",{class:"text-small text-secondary whitespace-pre-wrap"},[r.error])])])}}})});case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),oe=m([{label:"删除备份",value:"delete",event:function(){}}]),se=l({request:(h=o(a().m(function e(t){var n,r,l;return a().w(function(e){for(;;)switch(e.n){case 0:return n=u({id:_.compData.id,page:t.p,limit:t.limit,backup_type:D.type},D.time?{date:i(D.time,"yyyy-MM-dd")}:{}),e.n=1,c({loading:"获取备份记录中...",request:he(n)});case 1:return r=e.v,l=r.data,e.a(2,{data:l.data.list,total:l.data.total})}},e)})),function(e){return h.apply(this,arguments)}),columns:[{label:"备份时间",prop:"backup_time",showOverflowTooltip:!0,minWidth:100},{label:"备份类型",prop:"backup_type",minWidth:100,render:function(e){return"incremental"===e.backup_type?"增量备份":"全量备份"}},{label:"备份大小",prop:"formatted_size",minWidth:100},me([{onClick:function(e){return ce(e)},title:"还原"},{onClick:function(e){return ie(e.file_path)},title:"下载"},{onClick:function(e){return le(e.backup_id)},title:"删除"}])],extension:[oe]}),ve=se.BtTable,be=se.BtPage,ge=se.refresh,ye=(se.BtBatch,function(){var e=o(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,c({loading:"获取备份计划信息中...",request:je({id:_.compData.id})});case 1:t=e.v,(n=t.data).status?(w.database_name=n.data.database_name,w.full_backup_schedule=n.data.full_backup_schedule,w.incremental_backup_interval=n.data.incremental_backup_interval,w.enabled=n.data.enabled,w.create_time=n.data.create_time,w.last_full_backup=n.data.last_full_backup,w.last_incremental_backup=n.data.last_incremental_backup,w.next_full_backup=n.data.next_full_backup,w.next_incremental_backup=n.data.next_incremental_backup,w.space_free=n.data.space_free):w.database_name="";case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}()),Pe=function(){var e=o(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.n){case 0:return x.name=_.compData.name,ye(),e.n=1,c({loading:k,request:Be({id:_.compData.id})});case 1:t=e.v,(n=t.data).status&&(x.tableCount=n.data.table_count||0,x.size=v(n.data.db_size)||"--");case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return S(Pe),g({init:Pe}),function(e,n){var a,r=L,l=K,u=$,i=Q,c=Z,o=pe,s=de,f=X;return T(),z("div",null,["ltd"===F(y).authType?(T(),z("div",Ie,[F(w).space_free?A("",!0):(T(),M(r,{key:0,title:"当前磁盘空间不足1GB，已自动停止增量备份，如需继续请释放磁盘空间",type:"warning","show-icon":"",class:"!mb-4"})),E("div",Ge,[E("div",He,[E("div",Re,[E("div",We,[n[2]||(n[2]=E("div",{class:"text-small text-secondary mb-1"},"数据库名称",-1)),E("div",Ne,U(F(x).name||"--"),1)]),I((T(),z("div",Ye,[E("div",Je,[n[3]||(n[3]=E("div",{class:"text-small text-secondary mb-1"},"表数量",-1)),E("div",Le,U(F(x).tableCount||0),1)]),E("div",Ke,[n[4]||(n[4]=E("div",{class:"text-small text-secondary mb-1"},"数据库大小",-1)),E("div",$e,U(F(x).size||"--"),1)])])),[[f,F(k)]])]),E("div",Qe,[E("div",Ze,[E("div",Xe,[n[5]||(n[5]=E("h3",{class:"text-base font-medium text-secondary"},"备份计划",-1)),E("span",{class:G(["px-3 py-1 rounded-full text-small font-medium cursor-pointer",F(w).enabled?"bg-[var(--el-color-primary-light-9)] text-primary":"bg-[var(--el-color-danger-light-9)] text-red-700"]),onClick:ae},U((a=F(w).enabled,a?"运行中":"已停止")),3)])])]),E("div",et,[E("div",tt,[E("span",nt,"全量: "+U(F(ee)),1),n[7]||(n[7]=E("span",{class:"text-gray-300"},"|",-1)),E("span",at,"增量: "+U(F(te)),1),H(l,{type:"primary",class:"ml-[1rem]",size:"small",text:"",onClick:re},{default:R(function(){return t(n[6]||(n[6]=[W(" 查看日志 ",-1)]))}),_:1})])]),E("div",null,[E("div",rt,[E("div",lt,[n[8]||(n[8]=E("div",{class:"text-small text-secondary"},"最近执行时间",-1)),E("div",ut,U(F(w).last_incremental_backup||"--"),1),n[9]||(n[9]=E("div",{class:"text-small text-secondary"},"下次执行时间",-1)),E("div",it,U(F(w).next_incremental_backup||"--"),1)]),n[10]||(n[10]=E("div",null,null,-1))])])])]),H(o,null,{"header-left":R(function(){return[E("div",ct,[H(l,{type:"primary",onClick:ne},{default:R(function(){return t(n[11]||(n[11]=[W("编辑计划 ",-1)]))}),_:1}),H(l,{type:"default",onClick:ue},{default:R(function(){return t(n[12]||(n[12]=[W("清空备份 ",-1)]))}),_:1})])]}),"header-right":R(function(){return[E("div",ot,[H(u,{type:"date",modelValue:F(D).time,"onUpdate:modelValue":n[0]||(n[0]=function(e){return F(D).time=e}),"show-after":100,class:"!w-[24rem] !h-[30px]","disabled-date":F(j).disabledDate,placeholder:"请选择日期",format:"YYYY-MM-DD","value-format":"x",onChange:F(ge)},null,8,["modelValue","disabled-date","onChange"]),H(c,{modelValue:F(D).type,"onUpdate:modelValue":n[1]||(n[1]=function(e){return F(D).type=e}),class:"rounded-none !w-[12rem] ml-[1rem]",onChange:F(ge)},{default:R(function(){return[H(i,{label:"全部类型",value:"all"}),H(i,{label:"增量备份",value:"incremental"}),H(i,{label:"全量备份",value:"full"})]}),_:1},8,["modelValue","onChange"])])]}),content:R(function(){return[H(F(ve),{"max-height":221})]}),"footer-left":R(function(){return t(n[13]||(n[13]=[]))}),"footer-right":R(function(){return[H(F(be))]}),popup:R(function(){return t(n[14]||(n[14]=[]))}),_:1}),n[15]||(n[15]=E("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},[E("li",null,"还原数据等操作将会被增量备份记录，导致备份大小增大"),E("li",null,"建议确认数据正常后，手动备份并【清空备份】，重置为干净状态")],-1))])):(T(),M(s,{key:1,data:B,class:"p-20px"}))])}}}),ft={class:"p-20px"},dt={class:"p-20px"},pt={class:"mt-4px leading-8 text-small list-disc ml-[20px]"},mt=P({__name:"route-back",props:{compData:{default:function(){return{id:0,name:""}}}},setup:function(e){var l,i=e,m=fe(),v=m.refs.tabActive,B=m.refreshTableList,O=r().panel,P=ee("popupClose"),C=V(),A=V(),U=V(),G=V([]),N=V(!1),Y=V(!1),J=i.compData,L=J.id,$=(J.name,q({search:L,type:1,table:"backup",total:0,p:1,limit:10})),Q=V(!1),Z=q({backupPath:""}),X=V(),se=V(!1),de=q({pwd:""}),he=[{label:"删除",value:"delete",event:(l=o(a().m(function e(t,n,r,l){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},ve()],onConfirm:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n(Be);case 1:return We(),B(),e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)})),function(e,t,n,a){return l.apply(this,arguments)})}],_e=function(){Ae({type:"dir",path:Z.backupPath,change:function(e){Z.backupPath=e}})},xe=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,d({title:"提示",content:"修改默认备份目录，会导致网站和站点默认备份会备份到该目录下，是否继续操作？"});case 1:O.value.backupPath=Z.backupPath;case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ke=function(e){var t=e.filename;return(D(t)||j(t))&&-1!==t.indexOf("|")},we=function(){s({title:"表备份",area:60,component:function(){return f(function(){return n.import("./table-back-legacy.js?v=1763689792")},void 0,n.meta.url)},compData:u(u({},i.compData),{},{refreshFn:We}),showFooter:!0})},De=function(){var e=o(a().m(function e(){var t,r;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,f(function(){return n.import("./utils-lib-legacy.js?v=1763689792").then(function(e){return e.lW})},void 0,n.meta.url);case 1:t=e.v,r=t.router,P(),r.push({name:"crontab"});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),je=function(){var e=o(a().m(function e(t){var n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return n=null,"mysql"===v.value&&(n=Ee({type:"backup",config:{path:"/tmp/import_sql.log",id:i.compData.id,name:i.compData.name}})),r={id:i.compData.id},t&&(r.password=de.pwd),e.n=1,c({loading:"mysql"===v.value?void 0:"正在备份数据库，请稍后...",request:"mysql"===v.value?Pe(r):Ce({data:JSON.stringify(r)},v.value),message:!0,success:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n;case 1:null==(r=e.v)||r.unmount(),t.status&&(We(),B());case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=o(a().m(function e(t){var n,r,l,u=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],e.p=1,!n){e.n=2;break}return e.n=2,d({title:"删除备份",content:'<p>删除备份后，<span class="text-danger">备份数据将无法恢复</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});case 2:return e.n=3,qe({id:t.id});case 3:return r=e.v,n&&(p.request(r),We()),e.a(2,r);case 4:e.p=4,l=e.v,g(l,"delBackEvent");case 5:return e.p=5,Y.value&&Y.value.close(),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if("mysql"!==v.value||t.localexist){e.n=3;break}if(!ke(t)){e.n=1;break}return p.error("不支持从此处下载云存储备份，如需下载请在备份时勾选同时保留本地备份"),e.a(2);case 1:p.error("备份文件不存在");case 2:e.n=4;break;case 3:window.open("/download?filename="+t.local,"_blank");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=o(a().m(function e(t){var n,r,l,u=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return n=u.length>1&&void 0!==u[1]&&u[1],A.value=t,e.n=1,d({title:"恢复数据库",content:"恢复备份文件将会覆盖当前数据库[".concat(i.compData.name,"]，是否继续？"),type:"calc",icon:"warning-filled"});case 1:if(r={file:t.localexist?t.local:t.filename,name:i.compData.name},n&&(r.disk_check=!0),"mysql"!==v.value){e.n=4;break}return e.n=2,Ve({file:t.localexist?t.local:t.filename});case 2:if(l=e.v,!l.data){e.n=3;break}return C.value=!0,se.value=!0,e.a(2);case 3:Ie(r,t),e.n=5;break;case 4:r.file=t.local,c({loading:"正在恢复数据库,请稍后...",request:Se({data:JSON.stringify(r)},v.value),message:!0});case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=o(a().m(function e(t,n){var r,l;return a().w(function(e){for(;;)switch(e.n){case 0:return r=Ee({type:"import",config:{path:"/tmp/import_sql.log",id:n.id,name:i.compData.name}}),e.n=1,c({request:Te(t),message:!0,success:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(-1===(null===(r=t.msg)||void 0===r?void 0:r.indexOf("警告"))){e.n=2;break}return e.n=1,Ge(t.msg,"恢复");case 1:return ze(n,!0),e.a(2);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()});case 1:return e.n=2,r;case 2:null==(l=e.v)||l.unmount();case 3:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Ge=function(e,t){return d({title:"提示",isHtml:!0,width:"50rem",confirmText:"继续".concat(t),content:'<div class="flex"><i class="svgtofont-el-warning-filled text-[4rem] text-warning mr-4"></i><div><div>'.concat(e,"</div><div>\n\t\t\t<p>如继续").concat(t,"可能会有以下影响：</p>\n\t\t\t<p>1.").concat(t,"数据不完整</p>\n\t\t\t<p>2.系统运行缓慢</p>\n\t\t\t<p>3.面板无法正常工作</p>\n\t\t\t<p>4.mysql无法正常运行</p></div></div></div>")})},He=function(e){switch(e){case"databaseBack":je(!1);break;case"backPath":break;case"databasePwdBack":se.value=!0;break;case"tableBack":we()}},Re=function(){var e=o(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,X.value.validate();case 1:C.value?(t={file:A.value.localexist?A.value.local:A.value.filename,name:i.compData.name,password:de.pwd},Ie(t,A.value),se.value=!1,C.value=!1):(je(!0),se.value=!1);case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),We=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:c({request:y(u({},$)),loading:N,data:{data:[Array,G],page:h($)}});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ne=[be(),{label:"文件名称",prop:"name",width:220,showOverflowTooltip:!0},{label:"存储对象",render:function(e){var t=!1,n="";return ke(e)&&(t=!0,n=e.filename.match(/\|(.+)\|/,"$1")),H("span",null,[t?Ue[n[1]]:"本地"])}},ge({prop:"size",width:100}),{width:160,prop:"addtime",label:"备份时间"},ye({table:"backup"}),me([{isHide:function(e){return ke(e)},onClick:function(e){return ze(e)},title:"恢复"},{onClick:function(e){return Oe(e)},title:"下载"},{onClick:function(e){return Be(e,!0)},title:"删除"}])];return S(We),function(e,n){var a=le,r=ue,l=ie,u=K,i=_,c=x,o=Me,s=Fe,f=ce,d=oe,p=k,m=w,g=pe,y=te("bt-loading");return T(),z("div",null,[H(g,null,{"header-left":R(function(){return["mysql"==F(v)?(T(),M(l,{key:0,"split-button":"",type:"primary",onCommand:He,onClick:n[0]||(n[0]=function(e){return He("databaseBack")})},{dropdown:R(function(){return[H(r,null,{default:R(function(){return[H(a,{command:"databaseBack"},{default:R(function(){return t(n[12]||(n[12]=[W(" 备份数据库 ",-1)]))}),_:1}),H(a,{command:"databasePwdBack"},{default:R(function(){return t(n[13]||(n[13]=[W(" 加密备份数据库 ",-1)]))}),_:1}),H(a,{command:"tableBack"},{default:R(function(){return t(n[14]||(n[14]=[W("表备份",-1)]))}),_:1})]}),_:1})]}),default:R(function(){return[n[15]||(n[15]=W(" 备份数据库 ",-1))]}),_:1})):(T(),z(ne,{key:1},[H(u,{type:"primary",onClick:n[1]||(n[1]=function(e){return je(!1)})},{default:R(function(){return t(n[16]||(n[16]=[W(" 备份数据库 ",-1)]))}),_:1}),H(u,{type:"default",onClick:n[2]||(n[2]=function(e){return we()})},{default:R(function(){return t(n[17]||(n[17]=[W(" 表备份 ",-1)]))}),_:1})],64))]}),"header-right":R(function(){return t(n[18]||(n[18]=[]))}),content:R(function(){return[I(H(i,{ref_key:"routeBackupRef",ref:U,data:F(G),description:"暂无数据","max-height":460,column:F(Ne)},null,8,["data","column"]),[[y,F(N)],[y,"正在加载中，请稍后...","title"]])]}),"footer-left":R(function(){return[H(c,{options:he,"table-ref":F(U)},null,8,["table-ref"])]}),"footer-right":R(function(){return[H(o,{total:F($).total,page:F($).p,"onUpdate:page":n[3]||(n[3]=function(e){return F($).p=e}),row:F($).limit,"onUpdate:row":n[4]||(n[4]=function(e){return F($).limit=e}),onChange:We},null,8,["total","page","row"])]}),popup:R(function(){return[H(p,{title:"更换默认备份目录",modelValue:F(Q),"onUpdate:modelValue":n[6]||(n[6]=function(e){return ae(Q)?Q.value=e:null}),area:42,onConfirm:xe,showFooter:""},{default:R(function(){return[E("div",ft,[H(d,{ref:"ruleFormData",class:"mr-[16px] w-[80%]",model:F(Z),rule:{backupPath:[{required:!0,message:"请输入默认备份目录",trigger:"blur"}]}},{default:R(function(){return[H(f,{label:"默认备份目录",prop:"backupPath"},{default:R(function(){return[H(s,{icon:"icon-file_mode",modelValue:F(Z).backupPath,"onUpdate:modelValue":n[5]||(n[5]=function(e){return F(Z).backupPath=e}),onIconClick:_e,width:"26rem"},null,8,["modelValue"])]}),_:1})]}),_:1},8,["model"])])]}),_:1},8,["modelValue"]),H(p,{title:F(C)?"数据库加密密码":"加密备份数据库",modelValue:F(se),"onUpdate:modelValue":n[10]||(n[10]=function(e){return ae(se)?se.value=e:null}),area:42,onConfirm:Re,showFooter:"",onCancel:n[11]||(n[11]=function(){return F(de).pwd=""})},{default:R(function(){return[E("div",dt,[H(d,{ref_key:"pwdBackFormRef",ref:X,class:"mr-[16px] w-[80%]",model:F(de),rules:{pwd:[{required:!0,message:"请输入压缩密码",trigger:"blur"}]}},{default:R(function(){return[H(f,{label:"压缩密码",prop:"pwd"},{default:R(function(){return[F(C)?(T(),M(m,{key:1,modelValue:F(de).pwd,"onUpdate:modelValue":n[9]||(n[9]=function(e){return F(de).pwd=e}),width:"26rem"},null,8,["modelValue"])):(T(),M(s,{key:0,modelValue:F(de).pwd,"onUpdate:modelValue":n[7]||(n[7]=function(e){return F(de).pwd=e}),icon:"el-refresh",width:"26rem",onIconClick:n[8]||(n[8]=function(){return F(de).pwd=F(b)(16)}),"is-active":!0},null,8,["modelValue"]))]}),_:1})]}),_:1},8,["model"]),I(E("ul",pt,t(n[19]||(n[19]=[E("li",{class:"text-warning"},"设置密码后请注意保存密码，以防忘记密码导致无法恢复备份数据",-1)])),512),[[re,F(C)]])])]}),_:1},8,["title","modelValue"])]}),_:1}),E("ul",{class:"mt-8px leading-8 text-small list-disc ml-20px"},[E("li",null,[n[20]||(n[20]=W(" 定时备份请前往【 ",-1)),E("span",{title:"点击前往【计划任务】",class:"bt-link",onClick:De}," 计划任务 "),n[21]||(n[21]=W(" 】增加【备份数据库】 ",-1))])])])}}}),vt=B(mt,[["__scopeId","data-v-68fe8236"]]),bt={class:"p-[20px] h-full"};e("default",P({__name:"index",props:{compData:{default:function(){return{row:{}}}}},emits:["close"],setup:function(e,n){n.emit;var a=fe().refs.tabActive,r=V("routeBackup");return S(function(){}),function(n,l){var u=se,i=O;return T(),z("div",bt,[H(i,{type:"card",modelValue:F(r),"onUpdate:modelValue":l[0]||(l[0]=function(e){return ae(r)?r.value=e:null}),class:"bt-tabs bt-tabs-card"},{default:R(function(){return[H(u,{name:"routeBackup",label:"常规备份",lazy:!0},{default:R(function(){return[H(vt,{compData:e.compData.row},null,8,["compData"])]}),_:1}),"mysql"==F(a)?(T(),M(u,{key:0,name:"increment",class:"mt-4",lazy:!0},{label:R(function(){return t(l[1]||(l[1]=[E("span",{class:"flex items-center"},[E("i",{class:"mr-[4px] svgtofont-icon-ltd text-large text-[#9B7E48]"}),E("span",null,"增量备份")],-1)]))}),default:R(function(){return[H(st,{compData:e.compData.row,isRowBackup:!0},null,8,["compData"])]}),_:1})):A("",!0)]}),_:1},8,["modelValue"])])}}}))}}})}();
