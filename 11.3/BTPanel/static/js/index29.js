import{o as e,r as a,av as t,c as s,aB as l,v as n,a8 as o,x as r,y as i,e as c,C as m,A as p,z as u,Q as d,F as f,b1 as _,S as g,as as h,ar as b,ab as y,B as v,at as x}from"./base-lib.js?v=1763689792";import{_ as w}from"./index109.js?v=1763689792";import{Q as k,cp as H,n as R,H as S,p as j,cq as C,M as D,ay as O,u as q,an as T,k as P}from"./utils-lib.js?v=1763689792";import{a as V}from"./useMethods.js?v=1763689792";import{u as A}from"./column.js?v=1763689792";import{_ as B}from"./index110.js?v=1763689792";const E=e({name:"",description:"暂无数据",isRefresh:!0}),M=e({loading:!1,list:[],total:0,tableHeight:"410px"}),N=a(!0);a([]);const F=a(""),z=(e,a,t,s)=>{const l=e.data;a.value+="".concat(l),l.includes("bt_successful")&&(D.success("拉取成功"),t()),l.includes("bt_failed")&&(D.error("拉取失败"),t())},I=async(e,a)=>{let t={model_index:"btdocker",mod_name:"image",def_name:"pull_from_some_registry",ws_callback:111,name:"docker官方库",image:"".concat(e.name,":").concat(e.tag),registry_mirrors:"noSpeed"==F.value?"":F.value};await R({title:"拉取镜像",area:65,component:()=>S(()=>import("./pull-image-log-dialog.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{url:"/ws_model",params:t,onWSReceive:z,onRefresh:()=>a()}})},J=async e=>{V({image:e.name})},L=e=>({data:M.list.slice((e.p-1)*e.limit,e.p*e.limit),total:M.total}),Q=e=>{E.description="暂无数据",E.name=E.name.replace(/\s+/g,"")};let W=null;const K=a("开始拉取镜像...\n"),U=e=>{W&&(W.socket.close(),W=null),e&&e()},G=async(e,a)=>{await((e,a)=>{W=O({route:e.compData.url,onMessage:(t,s)=>{e.compData.onWSReceive(s,K,U,a)}})})(e,a),(e=>{let a={...e.compData.params};null==W||W.send(a)})(e)},X=e=>{U(e||!1),K.value="开始拉取镜像...\n"},Y={class:"container-dialog p-[2.4rem]"},Z={class:"flex items-center relative"},$={class:"py-[1rem]"},ee=s({__name:"index",setup(e){const{mainHeight:s}=q(),O=l("popupSetFooter",!1),V=a("1ms加速站搜索"),F=e=>{E.isRefresh=!0,e&&!isNaN(e)&&(G.value.p=e),U()},z=[{value:"1ms",text:"1ms加速站搜索"},{value:"dockerHub",text:"Docker Hub搜索"}],I=e=>{V.value=e.text,(e=>{if(""===E.name)return D.error("请输入需要搜索的镜像名");const a=0===e?"https://1ms.run/search?query=":"https://hub.docker.com/search?type=image&q=";window.open(a+E.name,"_blank","noopener,noreferrer")})("Docker Hub搜索"==e.text?1:0)},{BtTable:W,BtPage:K,refresh:U,param:G}=T({request:e=>(async e=>{if(0===M.list.length||E.isRefresh){E.isRefresh=!1;const a=await k({request:H({data:JSON.stringify({name:E.name})}),data:Array,loading:t(M,"loading")});return 0===a.length&&(E.description="没有搜索到".concat(E.name,"相关的镜像")),M.list=a,M.total=a.length,L(e)}return L(e)})(e),columns:[{label:"镜像名",prop:"name",width:200},{label:"Start数",prop:"star_count",width:70},{label:"来源",width:60,render:e=>e.is_official?"官方":"非官方"},{label:"描述/说明",prop:"description",showOverflowTooltip:!0},A([{onClick:J,width:80,title:"创建容器"},{onClick:e=>{const a="https://1ms.run/r/"+(e.is_official?"library/":"");window.open("".concat(a+e.name),"_blank","noopener noreferrer")},title:"简介"},{title:"拉取",render:e=>c("span",{class:"cursor-pointer text-primary",onClick:()=>(async(e,a)=>{await R({title:"".concat(e.is_pull?"更新":"拉取","镜像"),area:50,component:()=>S(()=>import("./pull-image-details-dialog.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{name:e.name,refresh:a}})})(e,F)},[e.is_pull?["更新",c(B,null,null)]:"拉取"])},{onClick:e=>(async(e,a)=>{const t={id:e.id,name:e.name,force:"0"};try{await j({type:"calc",title:"删除镜像【".concat(e.name,"】"),content:"您真的要删除镜像【".concat(e.name,"】吗？")}),k({request:C({data:JSON.stringify(t)}),message:!0,success:a})}catch(s){}})(e,F),isHide:e=>!e.is_pull,title:"删除"}])]});return n(()=>{((e,a,t)=>{setTimeout(()=>{if(a)M.tableHeight="410px";else{N.value=!1;const a=e.value-270;M.tableHeight="".concat(a,"px"),a>800&&(t.value.limit=20)}},0)})(s,O,G)}),o(()=>{E.name="",E.description="暂无数据",M.list=[],M.total=0,M.loading=!1,M.tableHeight="410px",E.isRefresh=!0}),(e,a)=>{const t=P,s=x,l=h,n=b,o=w,k=y;return r(),i("div",Y,[c(k,{ref:"searchFormRef",model:u(E),"label-position":"right",onSubmit:a[5]||(a[5]=g(()=>{},["prevent"]))},{default:m(()=>[p("div",Z,[c(t,{modelValue:u(E).name,"onUpdate:modelValue":a[0]||(a[0]=e=>u(E).name=e),class:"!w-[51rem]",onChangePassive:a[1]||(a[1]=e=>u(Q)("name")),placeholder:"请输入需要搜索的镜像名",clearable:"",onClear:a[2]||(a[2]=e=>F(1)),onKeyup:a[3]||(a[3]=d(e=>F(1),["enter"]))},null,8,["modelValue"]),c(n,{onCommand:I,"split-button":"",class:"ml-8px",type:"primary"},{dropdown:m(()=>[c(l,null,{default:m(()=>[(r(),i(f,null,_(z,e=>c(s,{key:e.value,command:e},{default:m(()=>[p("span",null,v(e.text),1)]),_:2},1032,["command"])),64))]),_:1})]),default:m(()=>[p("span",{onClick:a[4]||(a[4]=g(e=>F(1),["stop"]))},"搜索")]),_:1})]),p("div",$,[c(o,null,{content:m(()=>[c(u(W),{"max-height":u(M).tableHeight},null,8,["max-height"])]),"footer-right":m(()=>[c(u(K))]),_:1})])]),_:1},8,["model"])])}}}),ae=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ae as a,G as i,K as l,I as p,W as s,X as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
