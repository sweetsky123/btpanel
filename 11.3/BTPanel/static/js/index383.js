import{u as e,aH as a,bR as l,b6 as s,n as t,H as o,aK as d,k as u,ax as r,e as p,b as n,_ as m}from"./utils-lib.js?v=1763689792";import{c as i,o as c,aB as v,r as f,g as b,v as w,x as _,y as g,e as y,C as h,z as V,R as x,J as k,A as S,D as j,G as P,O as q,F as U,b1 as C,aA as D,ad as T,am as F,an as I,ab as H,c6 as M}from"./base-lib.js?v=1763689792";import{_ as L}from"./index107.js?v=1763689792";import{k as N,f as O}from"./validator.js?v=1763689792";import{addPhpSite as R,GetPHPVersion as A}from"./site.js?v=1763689792";import{u as E}from"./useStore4.js?v=1763689792";import{l as z,v as J,h as Q}from"./useController5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./useController6.js?v=1763689792";import"./useMethod5.js?v=1763689792";const W={class:""},B={class:"items-center flex"},G={class:"flex items-center mb-[8px]"},K={class:"flex items-center"},X={class:"flex items-center mb-[4px]"},Y=m(i({__name:"index",props:{compData:{default:{}}},setup(m,{expose:i}){const Y=m,{panel:Z}=e(),{isRefreshList:$}=E(),ee=n(),ae=c({database:!1,ftp:!1}),le=v("popupClose"),se=f(!1),te=f(),oe=f(!1),de=f({menuType:"addDefault",path:"/www/wwwroot",ftp:!1,type:"PHP",type_id:0,ps:"",port:"",version:"",need_index:0,need_404:0,sql:!1,codeing:"utf8mb4",webname:"",add_dns_record:!1,ftp_username:"",ftp_password:"",datauser:"",datapassword:""}),ue=f({ftp:!0,ftpStatus:!0,ftpData:{username:"",password:""},sql:!0,databaseStatus:!0,sqlData:{username:"",password:""},siteStatus:!1,site:{name:!1},dns:[],title:""});let re="/www/wwwroot/";const pe=f([]),ne=b(()=>z.value.filter(e=>"all"!==e.value&&Number(e.value)>=0)),me=()=>{var e;(null==(e=Q.value)?void 0:e.setClassManage)&&Q.value.setClassManage()},ie=async e=>{const{data:l}=await a({sName:e});N({name:l.name,type:"i",pluginInfo:l})},ce=()=>{O({type:"dir",path:de.value.path,change:e=>{var a;const s=l(e,"string","");de.value.path=s,re=null==(a=s+"/")?void 0:a.replace(/\/\//g,"/")}})},ve=e=>{var a,l,t,o,d;"string"==typeof e&&(de.value.ps=e.split("\n")[0],de.value.path=(null==re?void 0:re.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim()),de.value.ftp_username=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_"),de.value.ftp_password=s(16),de.value.datauser=null==(d=null==(o=e.split("\n")[0])?void 0:o.replace(/\W/g,"_"))?void 0:d.substr(0,16),de.value.datapassword=s(16))},fe=async()=>{var e,a;const l=await Y.compData.getStatus();ae.database=l.mysql,ae.ftp=l.ftp,de.value.type_id=null==(e=ne.value[0])?void 0:e.value,await(async()=>{var e;try{const a=await A();pe.value=a.data;let l="00";null==(e=pe.value)||e.forEach(e=>{Number(e.version)>Number(l)&&(l=e.version)}),de.value.version=l}catch(a){}})();const s=Z.value.sitePath;s&&(de.value.path=s,re=null==(a=s+"/")?void 0:a.replace(/\/\//g,"/"))};return w(fe),i({init:fe,onConfirm:async e=>{let a=Object.assign({},de.value);a.ftp?(ue.value.ftpData.username=a.ftp_username,ue.value.ftpData.password=a.ftp_password):(delete a.ftp_username,delete a.ftp_password,ue.value.ftp=!1),a.sql?(ue.value.sqlData.username=a.datauser,ue.value.sqlData.password=a.datapassword):(delete a.datauser,delete a.datapassword,ue.value.sql=!1),-1!==a.webname.split("\n")[0].indexOf(":")?a.port=a.webname.split("\n")[0].split(":")[1]:a.port=80;let l=a.webname.split("\n");const s=null==l?void 0:l.map(e=>e.split(":")[0]);l.shift(),a.webname=JSON.stringify({domain:a.webname.split("\n")[0],domainlist:l,count:l.length}),delete a.menuType,await te.value.validate();try{se.value=!0;const e=await R(a);de.value.add_dns_record&&e.status&&(ue.value.dns=s.filter(e=>e.length).map(e=>({domain:e,status:!1,msg:""})),ue.value.title=e.status?"添加网站成功":e.msg),e.status&&le(),a.ftp||a.sql||ue.value.dns.length?(ue.value.ftpStatus=e.data.ftpStatus,ue.value.databaseStatus=e.data.databaseStatus,ue.value.siteStatus=e.data.siteStatus,ue.value.site.name=!1,t({isAsync:!0,title:"网站添加结果",area:46,component:()=>o(()=>import("./add-result.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:ue.value})):ee.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.status?"添加网站成功":e.msg,type:e.status?"success":"error",duration:e.status?3e3:0,showClose:!e.status}),$.value=!0}catch(u){d(u)}finally{se.value=!1}}}),(e,a)=>{const l=u,s=D,t=T,o=L,d=F,n=I,m=r,i=p,c=H,v=M;return _(),g("div",W,[y(c,{model:V(de),rules:V(J),disabled:V(se),ref_key:"addSiteFormRef",ref:te},{default:h(()=>[y(t,{label:"域名",prop:"webname"},{default:h(()=>[y(s,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:V(oe),"onUpdate:visible":a[2]||(a[2]=e=>x(oe)?oe.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:h(()=>[k(y(l,{onInput:ve,modelValue:V(de).webname,"onUpdate:modelValue":a[0]||(a[0]=e=>V(de).webname=e),type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:a[1]||(a[1]=e=>oe.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[v,void 0,"popover"]])]),default:h(()=>[a[16]||(a[16]=S("div",{class:"!p-[12px] bg-primary text-white"},[j(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),S("br"),j(" IP地址格式：192.168.1.199 "),S("br"),j(" 泛解析添加方法 *.domain.com "),S("br"),j(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),y(t,{label:"备注"},{default:h(()=>[y(l,{modelValue:V(de).ps,"onUpdate:modelValue":a[3]||(a[3]=e=>V(de).ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1}),y(t,{label:"根目录",prop:"path"},{default:h(()=>[y(o,{modelValue:V(de).path,"onUpdate:modelValue":a[4]||(a[4]=e=>V(de).path=e),placeholder:"请输入根目录",icon:"el-folder-opened",width:"52rem",onIconClick:ce},null,8,["modelValue"])]),_:1}),y(t,{label:"FTP"},{default:h(()=>[S("div",B,[y(n,{class:"!w-[15rem]",modelValue:V(de).ftp,"onUpdate:modelValue":a[5]||(a[5]=e=>V(de).ftp=e),disabled:!V(ae).ftp},{default:h(()=>[y(d,{label:"不创建",value:!1}),y(d,{label:"创建",value:!0})]),_:1},8,["modelValue","disabled"]),V(ae).ftp?P("",!0):(_(),g("span",{key:0,onClick:a[6]||(a[6]=e=>ie("pureftpd")),class:"ml-[4px] text-danger cursor-pointer !text-small"},"未安装FTP，点击安装"))])]),_:1}),V(de).ftp?(_(),q(t,{key:0,label:"FTP账号"},{default:h(()=>[S("div",G,[y(t,{prop:"ftp_username"},{default:h(()=>[y(l,{placeholder:"创建FTP账号",modelValue:V(de).ftp_username,"onUpdate:modelValue":a[7]||(a[7]=e=>V(de).ftp_username=e),width:"24rem"},null,8,["modelValue"])]),_:1}),y(t,{label:"密码",class:"!mt-0"},{default:h(()=>[y(l,{placeholder:"FTP密码",modelValue:V(de).ftp_password,"onUpdate:modelValue":a[8]||(a[8]=e=>V(de).ftp_password=e),width:"24rem"},null,8,["modelValue"])]),_:1})]),a[17]||(a[17]=S("span",{class:"text-tertiary text-small"},"创建站点的同时，为站点创建一个对应FTP帐户，并且FTP目录指向站点所在目录。",-1))]),_:1})):P("",!0),y(t,{label:"数据库"},{default:h(()=>[S("div",K,[y(n,{class:"!w-[15rem]",modelValue:V(de).sql,"onUpdate:modelValue":a[9]||(a[9]=e=>V(de).sql=e),disabled:!V(ae).database},{default:h(()=>[y(d,{label:"不创建",value:!1}),y(d,{label:"MySQL",value:"MySQL"})]),_:1},8,["modelValue","disabled"]),V(ae).database?P("",!0):(_(),g("span",{key:0,onClick:a[10]||(a[10]=e=>ie("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-small"},"未安装数据库，点击安装")),V(de).sql?(_(),q(n,{key:1,class:"ml-[8px] !w-[15rem]",modelValue:V(de).codeing,"onUpdate:modelValue":a[11]||(a[11]=e=>V(de).codeing=e)},{default:h(()=>[y(d,{label:"utf8mb4",value:"utf8mb4"}),y(d,{label:"utf8",value:"utf8"}),y(d,{label:"gbk",value:"gbk"}),y(d,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])):P("",!0)])]),_:1}),V(de).sql?(_(),q(t,{key:1,label:"数据库账号"},{default:h(()=>[S("div",X,[y(t,{prop:"datauser"},{default:h(()=>[y(l,{placeholder:"创建数据库账号",class:"w-[24rem]",modelValue:V(de).datauser,"onUpdate:modelValue":a[12]||(a[12]=e=>V(de).datauser=e)},null,8,["modelValue"])]),_:1}),y(t,{label:"密码",class:"!mt-0"},{default:h(()=>[y(l,{placeholder:"数据库密码",class:"w-[24rem]",modelValue:V(de).datapassword,"onUpdate:modelValue":a[13]||(a[13]=e=>V(de).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[18]||(a[18]=S("span",{class:"text-tertiary text-small"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))]),_:1})):P("",!0),y(t,{label:"PHP版本"},{default:h(()=>[y(n,{class:"!w-[15rem]",modelValue:V(de).version,"onUpdate:modelValue":a[14]||(a[14]=e=>V(de).version=e)},{default:h(()=>[(_(!0),g(U,null,C(V(pe),e=>(_(),q(d,{key:e.value,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y(t,{label:"网站分类"},{default:h(()=>[y(m,{modelValue:V(de).type_id,"onUpdate:modelValue":a[15]||(a[15]=e=>V(de).type_id=e),options:V(ne),class:"!w-[15rem]"},null,8,["modelValue","options"]),y(i,{class:"ml-[8px]",onClick:me},{default:h(()=>[...a[19]||(a[19]=[j("分类设置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])])}}}),[["__scopeId","data-v-972dc027"]]);export{Y as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
