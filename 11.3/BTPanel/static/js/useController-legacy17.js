!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,u,i){var o=n&&n.prototype instanceof s?n:s,l=Object.create(o.prototype);return a(l,"_invoke",function(r,n,a){var u,i,o,s=0,l=a||[],p=!1,f={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,r){return u=t,i=0,o=e,f.n=r,c}};function v(r,n){for(i=r,o=n,t=0;!p&&s&&!a&&t<l.length;t++){var a,u=l[t],v=f.p,m=u[2];r>3?(a=m===n)&&(o=u[(i=u[4])?5:(i=3,3)],u[4]=u[5]=e):u[0]<=v&&((a=r<2&&v<u[1])?(i=0,f.v=n,f.n=u[1]):v<m&&(a=r<3||u[0]>n||n>m)&&(u[4]=r,u[5]=n,f.n=m,i=0))}if(a||r>1)return c;throw p=!0,n}return function(a,l,m){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&v(l,m),i=l,o=m;(t=i<2?e:o)||!p;){u||(i?i<3?(i>1&&(f.n=-1),v(i,o)):f.n=o:f.v=o);try{if(s=2,u){if(i||(a="next"),t=u[a]){if(!(t=t.call(u,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=u.return)&&t.call(u),i<2&&(o=TypeError("The iterator does not provide a '"+a+"' method"),i=1);u=e}else if((t=(p=f.n<0)?o:r.call(n,f))!==c)break}catch(t){u=e,i=1,o=t}finally{s=1}}return{value:t,done:p}}}(r,u,i),!0),l}var c={};function s(){}function l(){}function p(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(a(t={},u,function(){return this}),t),v=p.prototype=s.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,a(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,a(v,"constructor",p),a(p,"constructor",l),l.displayName="GeneratorFunction",a(p,i,"GeneratorFunction"),a(v),a(v,i,"Generator"),a(v,u,function(){return this}),a(v,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:m}})()}function a(e,t,r,n){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}a=function(e,t,r,n){function i(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?u?u(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},a(e,t,r,n)}function u(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,r||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function i(e,t,r,n,a,u,i){try{var o=e[u](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var u=e.apply(t,r);function o(e){i(u,n,a,o,c,"next",e)}function c(e){i(u,n,a,o,c,"throw",e)}o(void 0)})}}System.register(["./site-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./useController-legacy6.js?v=1763689792","./useStore-legacy4.js?v=1763689792","./validator-legacy.js?v=1763689792","./config-legacy.js?v=1763689792"],function(e,t){"use strict";var a,i,c,s,l,p,f,v,m,d,y,b,_,g,h,w,j,k,O,P,S,N,q,x,D;return{setters:[function(e){a=e.closeLimitNet,i=e.setLimitNet,c=e.setModulesLimitNet,s=e.batchPhpLimit,l=e.getLimitNet,p=e.getModulesLimitNet,f=e.getPluginInfo,v=e.getFlowQuotaConfigData,m=e.getFlowNumData},function(e){d=e.Q,y=e.M,b=e.x,_=e.p},function(e){g=e.r,h=e.g,w=e.o},function(e){j=e.o},function(e){k=e.u},function(e){O=e.h,P=e.i,S=e.p,N=e.k},function(e){q=e.u,x=e.Z,D=e.t}],execute:function(){var t=k(),L=t.siteInfo,E=t.siteType,T=t.isBindExtranet,G=t.isRefreshList,M=t.selectedList,F=t.batchConfig,B=e("p",g([{label:"论坛/博客",value:0,items:{perserver:300,perip:25,limit_rate:512}},{label:"图片站",value:1,items:{perserver:200,perip:10,limit_rate:1024}},{label:"下载站",value:2,items:{perserver:50,perip:3,limit_rate:2048}},{label:"商城",value:3,items:{perserver:500,perip:10,limit_rate:2048}},{label:"门户",value:4,items:{perserver:400,perip:15,limit_rate:1024}},{label:"企业",value:5,items:{perserver:60,perip:10,limit_rate:512}},{label:"视频",value:6,items:{perserver:150,perip:4,limit_rate:1024}},{label:"自定义",value:7,items:{perserver:"",perip:"",limit_rate:""}}])),C=(e("h",function(){var e=o(n().m(function e(t,r){var i;return n().w(function(e){for(;;)switch(e.n){case 0:if(J.value){e.n=3;break}if(!t){e.n=1;break}C(r),e.n=3;break;case 1:return i=u({},"php"!==E.value&&"phpasync"!==E.value?"site_id":"id",L.value.id),e.n=2,d({loading:"正在关闭流量限制，请稍后...",request:a(i,E.value),message:!0});case 2:if(!e.v.status){e.n=3;break}return e.n=3,I();case 3:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}()),e("o",function(){var e=o(n().m(function e(t){var a,o,l,p,f,v,m,b,_,g,h,w,k,S,N;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,J.value){e.n=2;break}return a=["php","proxy","phpasync"].includes(E.value),o=t.perserver,l=t.perip,p=t.limit_rate,f=u({perserver:o,perip:l,limit_rate:p},a?"id":"site_id",L.value.id),e.n=1,d({loading:"正在设置流量，请稍后...",request:a?i(f):c(f,E.value),message:!0});case 1:return e.v.status&&I(),e.a(2);case 2:return v=y.load("正在设置，请稍后..."),m=[],M.value.forEach(function(e){var t;"PHPMOD"===(null==e||null===(t=e.project_config)||void 0===t?void 0:t.type)&&m.push({name:e.name,msg:"异步项目不支持",status:!1})}),b=M.value.filter(function(e){var t;return"PHPMOD"!==(null==e||null===(t=e.project_config)||void 0===t?void 0:t.type)}),_=F.value,g=_.enable,h=_.exclude,w=O(b,h,g,{params:r(r({},Z),{},{close_limit_net:Z.value?0:1,project_type:"PHP"})}),e.n=3,d({request:s(w)});case 3:return k=e.v,S=P(k.data),N=S.data,j({resultData:m.concat(N)}),M.value=[],v.close(),G.value=!0,e.a(2,!0);case 4:return e.p=4,e.v,e.a(2,!1)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}())),I=function(){var e=o(n().m(function e(){var t,r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=["php","proxy","phpasync"].includes(E.value),r=u({},"php"!==E.value&&"phpasync"!==E.value?"site_id":"id",L.value.id),e.n=1,d({loading:z,request:t?l(r):p(r,E.value)});case 1:if((a=e.v).data.hasOwnProperty("limit_rate")){e.n=2;break}return Q.value=!0,y.error("获取流量限制失败"),Q.value=!0,Y.value=a.data.msg,e.a(2,{status:!1,msg:"获取流量限制失败"});case 2:return Q.value=!1,Z.limit_rate=a.data.limit_rate,Z.perserver=a.data.perserver,Z.perip=a.data.perip,Object.values(a.data).every(function(e){return 0===e})?(Z.value=!1,Z.type=0,H(0)):(Z.type=a.data.value-1,Z.value=!0),-1===Z.type&&(Z.type=7),e.a(2,Z);case 3:return e.p=3,e.v,e.a(2,{status:!1,msg:"获取流量限制失败"})}},e,null,[[0,3]])}));return function(){return e.apply(this,arguments)}}(),H=(e("i",o(n().m(function e(){var t,r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"node"===(r=null===(t=L.value.project_type)||void 0===t?void 0:t.toLowerCase())&&(r="nodejs"),"nodejs"!==r){e.n=3;break}if(T.value=null===(a=L.value.project_config)||void 0===a?void 0:a.bind_extranet,T.value){e.n=1;break}return Q.value=!0,e.a(2,Z);case 1:Q.value=!1;case 2:e.n=4;break;case 3:T.value=!0;case 4:if(J.value){e.n=6;break}return e.n=5,I();case 5:e.n=7;break;case 6:return e.n=7,H(0);case 7:return e.a(2,Z);case 8:e.p=8,e.v;case 9:return e.a(2)}},e,null,[[0,8]])}))),function(e){var t=B.value[e].items,r=t.perserver,n=t.perip,a=t.limit_rate;Z.perserver=r,Z.perip=n,Z.limit_rate=a}),J=e("a",h(function(){return M.value.length>0})),Q=e("m",g(!1)),R=e("d",g(!1)),Y=e("b",g("")),Z=w({value:!0,perserver:300,perip:25,limit_rate:512,type:0}),z=e("v",g(!1)),A=(e("q",function(){var e=o(n().m(function e(t){var r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=U(t),e.n=1,d({loading:"正在添加告警任务，请稍候...",request:q(r),message:!0,success:function(e){}});case 1:return(a=e.v).status&&(W.value=!0),e.a(2,a.status);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),e("s",function(){var e=o(n().m(function e(t){var r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r={template_id:131,task_data:{task_data:A(t),sender:t.sender,number_rule:{day_num:0,total:Number(t.total)},time_rule:{send_interval:0,time_range:[0,86399]}}}).task_data=JSON.stringify(r.task_data),e.n=1,d({loading:"正在添加告警任务，请稍候...",request:q(r),message:!0,success:function(e){}});case 1:return(a=e.v).status&&(W.value=!0),e.a(2,a.status);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),function(e){var t={tid:131,type:"monitor_traffic_total",title:"[监控报表]网站流量限额提醒",status:!0,count:0,interval:600,project:""};return t.site=L.value.name,t.cycle=Number(e.cycle),t.traffic=Number(e.traffic),t.traffic_unit=e.traffic_unit,t}),K=function(e){var t={};return t.tid="total"===e.type?130:132,t.type="total"===e.type?"monitor_traffic_attack":"monitor_http_flood",t.title="total"===e.type?"[监控报表]网站流量异常告警":"[监控报表]网站请求异常告警",t.status=!0,t.count=0,t.interval=600,t.project="",t.site=L.value.name,t.cycle=Number(e.cycle),t.cycle_unit=e.cycle_unit,"total"===e.type?(t.traffic=Number(e.traffic),t.traffic_unit=e.traffic_unit):(t.request=Number(e.request),t.request_unit=e.request_unit),t},U=function(e){var t={template_id:"total"===e.type?130:132,task_data:{task_data:K(e),sender:e.sender,number_rule:{day_num:0,total:Number(e.total)},time_rule:{send_interval:0,time_range:[0,86399]}}};return t.task_data=JSON.stringify(t.task_data),t},V=(e("u",o(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f({sName:"monitor"});case 1:t=e.v,r=t.data,V.value.total_status=r.setup&&r.endtime>=0,V.value.total_status||(R.value=!0),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}))),e("e",g({nginx_status:!1,total_status:!1,buy_status:!1})));g({length:"--",request:"--"});var W=e("t",g(!1)),X=(e("f",function(){var e=o(n().m(function e(t){var r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if("buy"!==t){e.n=1;break}S({sourceId:142}),e.n=5;break;case 1:return e.p=1,e.n=2,f({sName:"monitor"});case 2:return r=e.v,a=r.data,e.n=3,N({name:a.name,type:"i",pluginInfo:a});case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}()),e("g",o(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,v({site_name:L.value.name});case 1:return t=e.v,r=t.data,e.a(2,{data:r.data,total:r.data.length,other:{}});case 2:return e.p=2,e.v,e.a(2,{data:[],total:0,other:{}})}},e,null,[[0,2]])}))),e("n",[{label:"MB",value:"mb"},{label:"GB",value:"gb"}]),e("r",[{label:"次",value:"c"},{label:"千次",value:"kc"},{label:"百万次",value:"mc"}]),e("j",g({traffic:"--",request:"--"}))),$=function(e){return e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"};e("c",o(n().m(function e(){var t,r,a,u,i,o,c,s,l;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,V.value.total_status){e.n=1;break}return X.value.traffic="--",X.value.request="--",e.a(2);case 1:return a=new Date,u=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),c="".concat(u,"-").concat(i,"-").concat(o),e.n=2,m({SiteName:L.value.name,part_type:"hour",start_date:c,end_date:c});case 2:s=e.v,l=s.data,X.value.traffic=null!==(t=b(Number(l.total.sent_bytes)))&&void 0!==t?t:0,X.value.request=null!==(r=$(Number(l.total.request)))&&void 0!==r?r:0,e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}))),e("l",function(){var e=o(n().m(function e(t){return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,_({title:"删除".concat(t.task_data.title),icon:"warning-filled",content:"是否删除".concat(t.title,"？")});case 1:return e.n=2,d({loading:"正在删除告警任务，请稍候...",request:x({task_id:t.id}),message:!0});case 2:W.value=!0,e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t){return e.apply(this,arguments)}}()),e("k",function(){var e=o(n().m(function e(t){return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,_({title:"".concat(t.status?"禁用":"启用","【").concat(t.title,"】任务"),content:"您真的要".concat(t.status?"禁用":"启用","【").concat(t.title,"】这个任务吗？")});case 1:return e.n=2,d({loading:"正在修改告警任务状态，请稍候...",request:D({task_id:t.id,status:Number(!t.status)}),message:!0});case 2:W.value=!0;case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}}})}();
