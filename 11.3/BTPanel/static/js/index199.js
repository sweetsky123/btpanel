import{ik as e,b as l,_ as a,u as t,il as s,V as i,im as u,d as r,k as n,P as c,l as o,N as p}from"./utils-lib.js?v=1763689792";import{c as d,r as v,I as m,x as f,y as h,A as b,J as y,e as x,z as g,R as w,Q as k,C as _,D as C,L as D,U as R,H as I,W as V,g as F,a3 as P,B as S,F as j,b1 as q,G as A}from"./base-lib.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const H={class:"create-file-view flex"},T={class:"flex-1 flex items-center"},B=a(d({__name:"create-file",props:{type:{default:"Dir"},path:{},filelist:{}},emits:["createStatus"],setup(a,{emit:t}){const{error:s}=l(),i=t,u=a;let r=v("");const n=v(),c=async()=>{const l=n.value;if(!r.value)return void s("".concat("Dir"===u.type?"文件夹":"文件","名称不能为空"));const a=await e({type:u.type,path:u.path+"/"+r.value});a.status?o():(s(a.msg),l.$el.querySelector("input").focus())},o=()=>{u.filelist.value.shift(),i("createStatus")},p=e=>{r.value=e,/(\\|\/|\<|\>|\"|\&|\;)/g.test(e)&&(s('名称不能含有 /\\<>"&;符号'),r.value=e.replace(/(\\|\/|\<|\>|\"|\&|\;)/g,""))};return(e,l)=>{const t=R,s=I,i=m("focus");return f(),h("div",H,[b("div",{class:D(["flex","".concat("Dir"===a.type?"bt-open-dir folder-open-icon":"bt-open-dir file-text-icon")])},[l[4]||(l[4]=b("i",{class:"icon"},null,-1)),b("div",T,[y(x(t,{class:"!w-[22rem] mr-[1.6rem]",clearable:"",modelValue:g(r),"onUpdate:modelValue":l[0]||(l[0]=e=>w(r)?r.value=e:r=e),ref_key:"createfile",ref:n,onInput:p,onKeyup:l[1]||(l[1]=k(e=>e.target.blur(),["enter","native"]))},null,8,["modelValue"]),[[i]]),x(s,{type:"primary",class:"!mr-[.8rem]",onClick:c},{default:_(()=>[...l[2]||(l[2]=[C(" 创建 ",-1)])]),_:1}),x(s,{type:"default",onClick:o},{default:_(()=>[...l[3]||(l[3]=[C("取消",-1)])]),_:1})])],2)])}}}),[["__scopeId","data-v-c17175a3"]]),E={class:"text-black text-base pl-[1.6rem] pt-[1.6rem]"},U={class:"p-[1.6rem] flex justify-between"},z={class:"file-selector-head"},K=["onClick"],L={class:"truncate max-w-[8rem]"},M={class:"ml-[0.4rem] flex items-align"},N={class:"ml-[1.6rem] mb-[1.6rem]"},O={class:"flex h-[48rem] file-selector-main"},$={class:"w-[16rem] h-full pt-[1.2rem] text-xl inline-block overflow-auto disk-list"},G={class:"flex items-center flex-col"},J=["onClick"],Q=["title"],W={class:"h-full w-full inline-block flex w-[59rem]"},X={class:"flex justify-between bg-light p-[1.2rem] pr-[1.6rem] rounded-base"},Y={class:"ml-[9.6rem]"},Z={key:0,class:"flex align-middle items-center"},ee={class:"bg- rounded-large px-4 h-12 leading-[2.8rem] w-[30rem] inline-block border-light border-1 border-opacity-20 truncate"},le={class:"flex"},ae=a(d({__name:"index",props:{compData:{default:()=>({type:"all",path:"/www/wwwroot",change:()=>{},confirmText:"确认",customRequest:!1,disabledCreate:!1,customRequestApi:()=>Promise.resolve({status:!0,data:{}})})}},emits:["close"],setup(e,{expose:a,emit:d}){const D=d,R=e,{type:H,path:T,change:ae,disabledCreate:te}=R.compData,{error:se,request:ie}=l(),{panel:ue}=t(),re=v(),ne=v(),ce=v(0),oe=v(0),pe=v(""),de=v(),ve=v(H),me=v(!1),fe=v(!0),he=v(!1),be=v(T||ue.value.sitePath),ye=v(T||ue.value.sitePath),xe=V([]),ge=V([]),we=v([]),ke=v(""),_e=v(),Ce=v(),De=F(()=>"file"===ve.value?"文件":"dir"===ve.value?"文件夹":"文件/文件夹");P(ne,e=>{const l=e[0],{width:a}=l.contentRect;ce.value=a}),P(re,e=>{const l=e[0],{width:a}=l.contentRect;oe.value=a,oe.value>ce.value&&(ge.value=xe.value.slice(-4))});const Re=v([{label:"名称",prop:"name",showOverflowTooltip:!1,render:e=>e.create&&qe?x(B,{type:e.type,path:be.value,filelist:Ce,onCreateStatus:()=>{He()}},null):x("span",{class:"bt-open-dir"},[x("i",{class:"svgtofont".concat("dir"===e.type?"-icon-file_mode":"-file-text")},null),x("span",{onClick:l=>{"dir"===e.type&&ze(e,l)}},[e.name])])},{label:"修改时间",width:160,prop:"mtime"},{label:"权限/所有者",width:125,prop:"accept"}]),Ie=({row:e,column:l,rowIndex:a,columnIndex:t})=>{if(0===a&&e.create&&qe)return[1,3]},Ve=()=>{1!==xe.value.length&&(be.value=xe.value[xe.value.length-2].path,Te())},Fe=()=>{fe.value=!1,ye.value=be.value},Pe=()=>{fe.value=!0,setTimeout(()=>{ye.value=be.value},1500)},Se=e=>{be.value=ye.value,Te(),e.preventDefault(),e.target.blur()},je=e=>{e||(e=""),ke.value=e,Te(!0)};let qe=v(!1);const Ae=e=>{var l;if(qe.value)return!1;qe.value=!0,null==(l=Ce.value)||l.unshift({title:"",name:"",mtime:"",accept:"",type:e,path:"",create:!0})},He=()=>{qe.value=!1,Te()},Te=async e=>{var l,a;me.value=!0;try{const t=R.compData.customRequest?await(null==(a=(l=R.compData).customRequestApi)?void 0:a.call(l,{path:be.value,disk:!0,search:e?ke.value:""})):await s({path:be.value,disk:!0,search:e?ke.value:""});if(_e.value&&(_e.value.path=be.value,_e.value.title=be.value.split("/")[be.value.split("/").length-1]),!t.status)return _e.value=void 0,ie(t),!1;const{DIR:i,FILES:u,DISK:r,PATH:n}=t.data;Be(n),we.value=r,Ce.value=[...Ee(i,"dir"),...Ee(u)],Ke()}catch(t){}finally{me.value=!1}},Be=e=>{let l="";const a=e.replace(/\/*$/,"");if(be.value=a,ye.value=a,xe.value=[],""===a)return xe.value.push({title:"根目录",path:"/"}),void(ge.value=xe.value);a.split("/").forEach((e,a)=>{l+="".concat(1===a?"":"/").concat(e),xe.value.push({title:""===e&&0===a?"根目录":e,path:l})}),ge.value=xe.value},Ee=(e,l)=>{const a=[];return e.forEach(e=>{const t=e.split(";");let s=t[0];s.length>30&&(s="".concat(s.slice(0,30),"...")),/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(s)&&(s="".concat(s.slice(0,16),"...")),a.push({title:t[0],name:s,mtime:i(1e3*Number(t[2]),"yyyy/MM/dd HH:mm:ss"),accept:"".concat(t[3]," / ").concat(t[4]),type:l||"file",path:"".concat(be.value,"/").concat(t[0])})}),a},Ue=e=>{if(e&&!e.create){if("all"===ve.value)_e.value=e;else{if("dir"!==e.type&&"dir"===ve.value)return void se("请选择文件夹，否则将无法选择");if("file"!==e.type&&"file"===ve.value)return;if(ve.value!==e.type)return _e.value=void 0,void u(de.value).setCurrentRow();null!==e&&(_e.value=e)}he.value=!0}},ze=(e,l)=>{"dir"!==e.type||e.create||("file"===ve.value&&(he.value=!1),be.value=e.path,Te(),l.stopPropagation&&l.stopPropagation())},Ke=()=>{"file"===de.value.type&&(_e.value=void 0,he.value=!1),qe.value=!1};return a({onOpen:()=>(async()=>{await Te(),"file"!==ve.value&&(_e.value=xe.value[xe.value.length-1],he.value=!0)})()}),(l,a)=>{var t;const s=r,i=n,u=c,d=I,v=o,R=p,V=m("bt-loading");return f(),h("section",null,[b("div",E,"选择"+S(g(De)),1),b("div",U,[b("div",z,[b("i",{title:"返回上一层",class:"bt-open-icon inline-block !rounded-tl-large !rounded-bl-large",onClick:Ve},[x(s,{icon:"el-back",class:"leading-[2rem]"})]),b("div",{ref_key:"pathInputRef",ref:ne,class:"file-selector-input overflow-hidden"},[g(fe)?(f(),h("ul",{key:0,ref_key:"pathRef",ref:re,class:"absolute top-[1px] left-[1px] h-[28px] z-1 flex rounded-none bg-light"},[(f(!0),h(j,null,q(g(ge),(e,l)=>(f(),h("li",{key:l,class:"flex items-center px-[1rem]",onClick:l=>{return a=e.path,void(be.value!==a&&(be.value=a,ye.value=a,Te()));var a}},[b("span",L,S(e.title),1),b("i",M,[x(s,{icon:"el-arrow-right"})])],8,K))),128))],512)):A("",!0),x(i,{modelValue:g(ye),"onUpdate:modelValue":a[0]||(a[0]=e=>w(ye)?ye.value=e:null),class:"!w-[400px]",onFocus:Fe,onBlur:Pe,onKeyup:k(Se,["enter"])},null,8,["modelValue"])],512),b("i",{title:"刷新",class:"bt-open-icon inline-block !rounded-tr-large !rounded-br-large",onClick:a[1]||(a[1]=e=>Te())},[x(s,{icon:"el-refresh-right",class:"leading-[2rem]"})])]),x(u,{modelValue:g(ke),"onUpdate:modelValue":a[2]||(a[2]=e=>w(ke)?ke.value=e:null),placeholder:"搜索文件/目录",class:"!w-[220px]",onSearch:je},null,8,["modelValue"])]),b("div",N,[x(d,{type:"default",disabled:g(te),onClick:a[3]||(a[3]=e=>Ae("File"))},{default:_(()=>[...a[7]||(a[7]=[C("新建文件",-1)])]),_:1},8,["disabled"]),x(d,{type:"default",disabled:g(te),onClick:a[4]||(a[4]=e=>Ae("Dir"))},{default:_(()=>[...a[8]||(a[8]=[C("新建文件夹",-1)])]),_:1},8,["disabled"])]),b("div",O,[b("div",$,[b("ul",G,[(f(!0),h(j,null,q(g(we),(e,l)=>(f(),h("li",{key:l,class:"flex p-[0.8rem] pl-[1.6rem] items-center w-full",onClick:l=>{return a=e.path,be.value=a,void Te();var a}},[a[9]||(a[9]=b("i",{class:"file-disk-icon mr-[0.8rem] text-base"},null,-1)),b("span",{class:"w-full truncate",title:"/"===e.path?"".concat("根目录"):e.path},S("/"===e.path?"根目录":e.path)+" ("+S(e.size[2])+") ",9,Q)],8,J))),128))])]),b("div",W,[y(x(v,{ref_key:"tableRef",ref:de,"empty-text":"(空)","max-height":"480","highlight-current-row":"",class:"file-selector-table",column:g(Re),data:g(Ce),"span-method":Ie,border:!1,onCurrentChange:Ue,onRowDblclick:ze},null,8,["column","data"]),[[V,g(me)],[V,"正在加载文件列表，请稍后...","title"]])])]),b("div",X,[b("div",Y,[g(he)?(f(),h("div",Z,[b("span",null,"当前选中"+S(g(De))+"：",1),b("span",ee,S(null==(t=g(_e))?void 0:t.title),1)])):A("",!0)]),b("span",le,[x(R,{type:"default",class:"BtButton--cancel",onClick:a[5]||(a[5]=e=>D("close"))},{default:_(()=>[...a[10]||(a[10]=[C(" 取消 ",-1)])]),_:1}),x(R,{type:"primary",disabled:!g(he),onClick:a[6]||(a[6]=e=>(ae&&ae(_e.value.path,_e.value.type),pe.value=_e.value.path,void D("close")))},{default:_(()=>[C(S(e.compData.confirmText||"确认"),1)]),_:1},8,["disabled"])])])])}}}),[["__scopeId","data-v-d5229c07"]]);export{ae as default};
