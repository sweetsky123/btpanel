!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function u(n,r,o,a){var u=r&&r.prototype instanceof c?r:c,l=Object.create(u.prototype);return i(l,"_invoke",function(n,r,o){var i,a,u,c=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return i=t,a=0,u=e,p.n=n,s}};function m(n,r){for(a=n,u=r,t=0;!f&&c&&!o&&t<l.length;t++){var o,i=l[t],m=p.p,y=i[2];n>3?(o=y===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=n<2&&m<i[1])?(a=0,p.v=r,p.n=i[1]):m<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,p.n=y,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,y){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&m(l,y),a=l,u=y;(t=a<2?e:u)||!f;){i||(a?a<3?(a>1&&(p.n=-1),m(a,u)):p.n=u:p.v=u);try{if(c=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=p.n<0)?u:n.call(r,p))!==s)break}catch(t){i=e,a=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,o,a),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),m=f.prototype=c.prototype=Object.create(p);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=f,i(m,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,a,"GeneratorFunction"),i(m),i(m,a,"Generator"),i(m,r,function(){return this}),i(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m:y}})()}function i(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,t,n,r){function a(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},i(e,t,n,r)}function a(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){a(i,r,o,u,s,"next",e)}function s(e){a(i,r,o,u,s,"throw",e)}u(void 0)})}}System.register(["./base-lib-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./database-legacy.js?v=1763689792","./validator-legacy.js?v=1763689792","./useMethod-legacy4.js?v=1763689792","./useStore-legacy2.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./column-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792"],function(e,t){"use strict";var r,i,a,s,c,l,f,p,m,y,b,v,d,g,h,j,w,O,P,_,S,k,x,q,D,T,G,E,V;return{setters:[function(e){r=e.c,i=e.r,a=e.o,s=e.v,c=e.x,l=e.y,f=e.e,p=e.C,m=e.z,y=e.F,b=e.b1,v=e.O,d=e.G,g=e.am,h=e.an,j=e.ad,w=e.ab},function(e){O=e.p,P=e.k,_=e.Q,S=e.M},function(e){k=e.getPermission,x=e.batchSetMysqlAuth,q=e.setPermission,D=e.setPgSqlAuth},function(e){T=e.i,G=e.h},function(e){E=e.x},function(e){V=e.g},null,null,null,null],execute:function(){var t={class:"p-20px"};e("default",r({__name:"index",props:{compData:{default:function(){return{type:"single",rowData:{},config:{}}}}},setup:function(e,r){var A=r.expose,F=V(),I=F.refs.tabActive,B=F.refreshTableList,M=e,N=M.compData,C=N.rowData,U=N.type,z=M.compData.config,H=z.enable,J=z.exclude,L=z.clearBatch,Q=i(),R=a({permission:"",ip:""}),K={ip:[{required:!0,trigger:["blur","change"],message:"请输入IP地址"}]},W=function(){var e=u(o().m(function e(){var t,n;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,_({request:k({name:C.username}),data:{msg:String,status:Boolean}});case 1:if(t=e.v,n=t.msg,t.status){e.n=2;break}return e.a(2,S.error(n));case 2:R.permission=n,"%"!==n&&"127.0.0.1"!==n&&(R.permission="ip",R.ip=n.replace(/,/g,"\n"));case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),X=function(){var e=R.permission,t=R.ip,r={name:C.username,dataAccess:e,access:"ip"===e?t:e,address:"ip"===e?t:""};return"multlples"==U?(delete r.name,G(C,J,H,{params:n({},r)})):r},Y=function(){var e=u(o().m(function e(){var t,n,r,i,a;return o().w(function(e){for(;;)switch(e.n){case 0:if(t=X(),"multlples"!==U){e.n=2;break}return e.n=1,x(t);case 1:return n=e.v,r=T(n.data),(i=r.data).length&&E(i,{title:"修改权限"}),L&&L(),e.a(2,n);case 2:return e.n=3,_({loading:"正在修改权限，请稍后...",request:q(t),message:"single"===U,data:{error:[Object,function(e){return Object.keys(e)}],success:Array,status:Boolean,msg:String}});case 3:if((a=e.v).status){e.n=4;break}return e.a(2,S.error(a.msg));case 4:return e.a(2,a);case 5:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=u(o().m(function e(){var t,n,r,i;return o().w(function(e){for(;;)switch(e.n){case 0:return t=R.permission,n=R.ip,r={data_name:C.name,username:C.username,listen_ip:"ip"===t?n:t},e.n=1,_({loading:"正在修改权限，请稍后...",request:D({data:JSON.stringify(r)}),success:function(e){var t=e.data;S.request({msg:t.msg||t.data,status:t.status})}});case 1:return i=e.v,e.a(2,i)}},e)}));return function(){return e.apply(this,arguments)}}(),$={pgsql:{option:[{label:"所有人",value:"0.0.0.0/0"},{label:"本地服务器",value:"127.0.0.1/32"}],placeholder:"填写格式如：192.168.69.11/24",getPermission:function(){var e="0.0.0.0/0"!==C.listen_ip&&"127.0.0.1/32"!==C.listen_ip;R.ip=e?C.listen_ip:"",R.permission=e?"ip":C.listen_ip},setPermission:Z},mysql:{option:[{label:"所有人",value:"%"},{label:"本地服务器",value:"127.0.0.1"}],placeholder:"如果要允许IP段访问，可以使用%作为通配符，如127.17.%.%，如需要填写多个IP，请换行填写，每行一个IP",getPermission:W,setPermission:Y}},ee=function(){var e=u(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Q.value.validate();case 1:if(n=R.permission,R.ip,!["%","0.0.0.0/0"].includes(n)){e.n=2;break}return e.n=2,O({title:"提示",content:"设置权限为所有人后，将会导致数据库安全性降低，他人可以随意访问数据库，是否继续操作？",icon:"warning-filled"});case 2:return e.n=3,$[I.value].setPermission();case 3:e.v.status&&(t(),B());case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=u(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if("multlples"!=U){e.n=1;break}return R.permission=$[I.value].option.filter(function(e){return e.label.includes("本地")})[0].value,e.a(2);case 1:$[I.value].getPermission();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return s(function(){te()}),A({onConfirm:ee}),function(e,n){var r=g,o=h,i=j,a=P,u=w;return c(),l("div",t,[f(u,{ref_key:"permissionFormRef",ref:Q,model:m(R),rules:K,"label-width":"5rem"},{default:p(function(){return[f(i,{label:"访问权限",prop:"permission"},{default:p(function(){return[f(o,{class:"!w-[22rem]",modelValue:m(R).permission,"onUpdate:modelValue":n[0]||(n[0]=function(e){return m(R).permission=e})},{default:p(function(){return[(c(!0),l(y,null,b($[m(I)].option,function(e){return c(),v(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])}),128)),f(r,{label:"指定ip",value:"ip"})]}),_:1},8,["modelValue"])]}),_:1}),"ip"===m(R).permission?(c(),v(i,{key:0,prop:"ip",label:"IP地址"},{default:p(function(){return[f(a,{type:"mysql"===m(I)?"textarea":"text",rows:4,width:"22rem",modelValue:m(R).ip,"onUpdate:modelValue":n[1]||(n[1]=function(e){return m(R).ip=e}),placeholder:$[m(I)].placeholder},null,8,["type","modelValue","placeholder"])]}),_:1})):d("",!0)]}),_:1},8,["model"])])}}}))}}})}();
