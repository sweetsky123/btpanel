import{o as t,u as a,ex as s,aA as e,O as o,b2 as c,p as r,Q as l,b as n,n as p,H as d}from"./utils-lib.js?v=1763689792";import{s as i,j as u,g as m,r as g}from"./base-lib.js?v=1763689792";import{p as f,c as h,h as y,i as _,o as T}from"./validator.js?v=1763689792";import{c as b}from"./column.js?v=1763689792";const w=a=>t.post("ftp/SetStatus",{data:a,check:"msg"}),k=a=>t.post("/datalist/batch/batch_set_ftp_status",{data:a,check:"msg",customType:"model"}),F=a=>t.post("ftp/DeleteUser",{data:a,check:"msg"}),v=a=>t.post("ftp/AddUser",{data:a,check:"msg"}),P=a=>t.post("ftp/GetFtpUserAccess",{data:a,check:"msg"}),j=a=>t.post("ftp/ModifyFtpUserAccess",{data:a,check:"msg"}),A=a=>t.post("/logs/ftp/set_ftp_log",{customType:"model",data:a,check:"msg"}),q=a=>t.post("ftp/get_cron_config",{data:a,check:"object"}),D=a=>t.post("ftp/set_cron_config",{data:a,check:"msg"}),x=a=>t.post("project/quota/modify_path_quota",{data:a,customType:"model",check:"object"}),E=()=>t.post("logs/ftp/get_analysis_config",{customType:"model",check:"object"}),S=a=>t.post("logs/ftp/set_analysis_config",{data:a,customType:"model",check:"msg"}),I=a=>t.post("logs/ftp/log_analysis",{data:a,customType:"model"}),R=a=>t.post("logs/ftp/set_cron_task",{data:a,customType:"model",check:"msg"}),N=a=>t.post("logs/ftp/set_white_list",{data:a,customType:"model",check:"msg"}),O=()=>t.post("logs/ftp/get_white_list",{customType:"model",check:"object"}),U=a=>t.post("safe/firewall/create_ip_rules",{data:a,customType:"model",check:"msg"}),B=()=>t.post("logs/ftp/ftp_users",{customType:"model",check:"array"}),L=a=>t.post("/datalist/batch/batch_set_ftp_password",{data:a,check:"array",customType:"model"}),M=a=>t.post("ftp/add_ftp_types",{check:"object",data:a}),G=a=>t.post("ftp/update_ftp_types",{check:"object",data:a}),C=a=>t.post("ftp/delete_ftp_types",{check:"object",data:a}),H=a=>t.post("/datalist/batch/batch_set_ftp_type",{check:"object",data:a,customType:"model"}),J=a=>t.post("/datalist/batch/batch_delete_ftp",{check:"object",data:a,customType:"model"}),z=u("FTP-STORE",()=>{const{plugin:t,getGlobalInfo:s}=a(),e=m(()=>t.value.ftp.port),o=g();return{ftpPort:e,pluginInfo:g({}),rowData:o,isRefreshFtpList:g(!1)}}),K=()=>i(z()),Q=n(),{payment:V,getGlobalInfo:W}=a(),X=g(!1),Y=async(a,s,e)=>{try{return(await l({loading:"正在".concat(s?"修改":"添加","FTP账号，请稍后..."),request:s?(o=a,t.post("ftp/SetUser",{data:o,check:"msg"})):v(a),data:{status:Boolean},message:!0,success:t=>{$.value=!0,e&&e(t)}})).status}catch(c){return!1}var o},Z=async a=>{try{const e=await l({loading:"正在修改FTP端口，请稍后...",request:(s={port:a.port},t.post("ftp/setPort",{data:s,check:"msg"})),data:{status:Boolean},message:!0});return e.status&&W(),e.status}catch(e){return!1}var s},{isRefreshFtpList:$,pluginInfo:tt,rowData:at}=K(),st=async()=>{try{const{data:t}=await c({name:"pure-ftpd"});return tt.value=t,t}catch(t){return{}}};let et={};const ot=async t=>{const a=JSON.stringify(t),o=Date.now();try{const{data:{data:c,page:r,search_history:l,error:n}}=await s({...t,table:"ftps"});return et[a]={data:{data:c,total:e(r),other:{search_history:l,error:n}},timestamp:o},et[a].data}catch(c){return"canceled"===c.message&&et[a]&&o-et[a].timestamp<100?et[a].data:{data:[],total:0,other:{search_history:[]}}}},ct=async t=>{try{await r({icon:"warning-filled",title:"删除FTP用户【".concat(t.name,"】"),content:"删除FTP用户后，该FTP用户将失去访问权限，是否继续操作？"}),await l({loading:"正在删除FTP用户，请稍后...",request:F({id:t.id,username:t.name}),message:!0,success:t=>{$.value=!0}})}catch(a){}},rt=async({id:t,status:a,name:s},e)=>{try{const o=Boolean(Number(a));await r({title:"".concat(o?"停用":"启用","FTP用户【").concat(s,"】"),content:"".concat(o?"停用":"启用","选中的FTP用户后，该FTP用户将").concat(o?"失去":"恢复","访问权限，是否继续操作？")}),await l({loading:"正在设置FTP状态，请稍后...",request:w({id:t,username:s,status:Number(!Number(a))}),message:!0,success:t=>{$.value=!0,e&&e(t)}})}catch(o){}},lt=t=>{const a=Math.floor(Date.now()/1e3);let s=new Date(Number(t.end_time)).getTime()<a;const e=Number(t.end_time)-a;let o=Math.floor(e/86400)<7;return"0"===t.end_time&&(s=!1,o=!1),{isEnd:s,isOrange:o}},nt=async()=>{try{let a=[];return await l({request:t.post("ftp/view_ftp_types",{check:"object"}),data:{msg:Array},success:({msg:t})=>{a=[{label:"全部分类",value:"all"},...t.map(t=>({label:t.ps,value:String(t.id)}))]}}),a||[]}catch(a){return[]}},pt=async(t,a,s,e)=>{await h({name:"Ftp分类",options:s.value,selectList:t.value,request:async(s,o)=>{const{enable:c,exclude:r}=e,n=y(t.value,r,c,{params:{id:s.id}});await l({loading:"正在批量设置FTP分类，请稍后...",request:H(n),message:!0}),a(),$.value=!0,o()}})},dt=async(t,a,s,e,o,c)=>{const{label:r,value:l}=e,{enable:n,exclude:p}=c,d=new Map([["start","批量启用已选的FTP用户，启用后恢复访问权限"],["stop","批量停用已选的FTP用户，停用后暂停访问权限"],["delete","批量删除已选的FTP用户，删除后彻底失去访问和操作权限"]]);await t({title:"批量".concat(r,"用户"),content:"".concat(d.get(l),"，是否继续操作！"),column:[{label:"用户名",prop:"name"},b()],onConfirm:async()=>{const t=await(async()=>{const t=new Map([["start",k],["stop",k],["delete",J]]).get(l);switch(l){case"start":case"stop":const a="start"===l?1:0,e=y(s.value,p,n,{params:{status:a}});if(t)return await t(e);break;case"delete":const o=y(s.value,p,n);if(t)return await t(o)}})();$.value=!0;const{data:a,msg:e}=_(t.data);o&&o(),T(a,{title:"".concat(r,"用户")})}})},it=async a=>{try{const{data:{data:s,page:o}}=await(a=>t.post("/logs/ftp/get_login_log",{customType:"model",data:a,check:"object"}))(a);return Array.isArray(s)?{data:s,total:e(o)}:{data:[],total:0}}catch(s){return{data:[],total:0}}},ut=async a=>{try{const{data:{data:s,page:o}}=await(a=>t.post("/logs/ftp/get_action_log",{customType:"model",data:a}))(a);return Array.isArray(s)?{data:s,total:e(o)}:{data:[],total:0}}catch(s){return{data:[],total:0}}},mt=t=>{p({title:"查看FTP日志【"+t.name+"】",area:[70,58],compData:t,component:()=>d(()=>import("./index337.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},gt=async t=>{let a;try{if(at.value=t,"free"!==V.value.authType){a=Q.load("正在获取日志服务状态，请稍后...");const{status:s,msg:e}=await A({exec_name:"getlog"});if(a.close(),s&&"stop"!==e)mt(t);else{await r({title:"开启FTP日志服务",content:"开启FTP日志服务后，将记录FTP用户的访问日志，是否继续操作？"});const a=await l({loading:"正在开启FTP日志服务，请稍后...",request:A({exec_name:"start"}),data:{status:Boolean},message:!0});(null==a?void 0:a.status)&&mt(t)}}else f({sourceId:57})}catch(s){}finally{a&&a.close()}},ft=()=>{et={},o(["/ftp?action=view_ftp_types","/panel/public/get_soft_status","/datalist/data/get_data_list"])},ht=u("FTP-ADD-USER-STORE",()=>{const t=a(),{panel:s}=i(t),e=m(()=>s.value.sitePath),o=g(),c=g({name:"",password:"",path:e.value||""});return{isEdit:g(!1),addFtpRef:o,ftpForm:c,defaultPath:e}}),yt=()=>i(ht());export{w as A,N as B,I as C,O as D,R as E,z as F,S as G,E as H,B as I,j as J,P as K,L,yt as a,lt as b,nt as c,M as d,G as e,C as f,ot as g,rt as h,ct as i,st as j,dt as k,X as l,ft as m,ut as n,gt as o,it as p,Y as q,D as r,pt as s,q as t,K as u,x as v,Z as w,A as x,U as y,F as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
