import{aA as e,Q as a,b6 as t,u as s,n as r,H as n,M as o,aS as i,aH as l,aK as c,cf as u,ar as m,cg as g,ch as p,a_ as _,p as d,B as v}from"./utils-lib.js?v=1763689792";import{getDataInfoNew as h,modifyProjectRunState as y,setSiteStatus as b,getScanList as f,batchPhpBasedir as w,batchPhpDomain as P,batchPhpStatus as j,batchPhpBack as E}from"./site.js?v=1763689792";import{j as D,s as L,r as S,o as O}from"./base-lib.js?v=1763689792";import{c as T}from"./column.js?v=1763689792";import{S as x}from"./useStore4.js?v=1763689792";import{o as A,u as I,a as R}from"./useController6.js?v=1763689792";import{l as k,k as C,h as H,i as q,o as M}from"./validator.js?v=1763689792";import{u as V,g as F}from"./useMethod5.js?v=1763689792";const N=D("SITE-PHP-STORE",()=>{const t=S({});return{scanData:S({info:[],time:"",is_pay:!0,loophole_num:0,site_num:0,web_scaning_times:0}),pluginInfo:t,getPhpList:async a=>{try{const t=fe("phpTableColumn"),{data:{data:s,page:r,search_history:n,error:o}}=await h(a);return{data:s.map(e=>({...e,isWaf:!(null==t?void 0:t.length)||t[0].isCustom})),total:e(r),other:{search_history:n,error:o}}}catch(t){return{data:[],total:0,other:{search_history:{page:1,page_size:10,total:0},error:{code:"get value error！",message:"获取数据失败"}}}}},changeStatusEvent:async({row:e,action:t},{isAsync:s,status:r})=>{try{const n=await a({loading:"正在"+(r?"停止":"启动")+"，请稍后...",request:s?y({sitename:e.name,project_action:t}):b({id:e.id,name:e.name},t),message:!0});return{status:n.status,msg:n.msg}}catch(n){return{status:!1,msg:"操作失败"}}}}}),z=()=>L(N()),B=Object.freeze(Object.defineProperty({__proto__:null,SITE_PHP_STORE:N,useSitePhpStore:z},Symbol.toStringTag,{value:"Module"})),J=D("WP-LOCAL-STORE",()=>{const e=S(!1),s=S(!1),r=S(!1),n=S({}),o=S(""),i=O({value:!1,message:""}),l=O({method:1,subDomain:t(8,"letter"),subPath:"",newDomain:"",newPath:"",cache_status:!1}),c=O({status:!0,text:""}),{loading:u,setLoading:m}=V(!1),{loading:g,setLoading:p}=V(!1);return{localRow:n,loginUrl:o,isLoginMask:i,loginInit:async e=>{i.value=!1,await a({loading:"正在加载，请稍后...",request:F({s_id:e}),success:e=>{e.status?o.value=e.data.msg.login_url:(i.value=!0,i.message=e.msg)}})},isRefreshLocalList:e,isRefreshBackupList:s,isRefreshMigrateSiteList:r,cloneLocalForm:l,verifyingData:c,verifyingLoading:u,setVerifyingLoading:m,reinstallLoading:g,setReinstallLoading:p,resetVerifyingData:()=>{c.status=!0,c.text=""},resetCloneLocalForm:()=>{l.method=1,l.subDomain=t(8,"letter"),l.subPath="",l.newDomain="",l.newPath=""}}}),{isRefreshList:W,selectedList:K,batchConfig:Q,isSiteMult:Z}=L(x()),{setSiteInfo:$}=x(),{plugin:U,payment:G}=s(),{isRefreshLocalList:X}=L(J()),Y=S([]),ee=S([]),ae=S(),te=async(e,a,t,s,r,n)=>{const{label:o,value:i}=s,{enable:l,exclude:c}=n,u=new Map([["start","批量启用选中的站点后，站点将恢复正常访问"],["stop","批量停用选中的站点后，站点将无法正常访问，用户访问会显示当前网站停用后的提示页"],["backSite","批量备份选中的站点，可能耗费时间较长"]]);await e({title:"批量".concat(o),content:"".concat(u.get(i),"，是否继续操作？"),column:[{label:"网站名",prop:"rname"},T()],onConfirm:async()=>{const e=await(async()=>{const e=new Map([["backSite",E]]).get(i);switch(i){case"start":case"stop":const a=t.value.map(e=>{var a;return{id:e.id,name:e.name,phpsync:Number("PHPMOD"===(null==(a=e.project_config)?void 0:a.type))}}),s=H(!1,c,l,{params:{option:"start"===i?"1":"0",project_type:"PHP",site_list:JSON.stringify(a)}});return await j(s);case"backSite":if(e){const a=H(t.value,c,l,{params:{project_type:"PHP"}});return await e(a)}}})();W.value=!0,X.value=!0,r&&r();let{data:a}=q(e.data);M(a,{title:"".concat(o)})}})},se=[{label:"启动站点",value:"start",event:te},{label:"停用站点",value:"stop",event:te},{label:"备份站点",value:"backSite",event:te},{label:"设置到期时间",value:"setTimeSite",event:async(e,a,t,s,o,i)=>{r({title:"批量设置到期时间",area:48,compData:{rowData:t.value,config:i},component:()=>n(()=>import("./index241.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o&&o()})}},{label:"设置PHP版本",value:"setPhpSite",event:async(e,a,t,s,o,i)=>{Q.value=i,r({title:"批量设置PHP版本",area:42,compData:t.value,component:()=>n(()=>import("./index242.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>o&&o(),showFooter:!0})}},{label:"防跨站",value:"antiCrossingStation",event:async(e,t,s,r,n,o)=>{d({title:"批量设置防跨站",content:"批量开启后，可防止黑客通过其他网站目录进行入侵攻击，是否继续操作？",type:"check",check:{content:"防跨站攻击(open_basedir)",value:!0,onConfirm:async e=>{let t=[];s.value.forEach(e=>{var a;"PHPMOD"===(null==(a=null==e?void 0:e.project_config)?void 0:a.type)&&t.push({name:e.name,msg:"异步项目不支持",status:!1})});const r=s.value.filter(e=>{var a;return"PHPMOD"!==(null==(a=null==e?void 0:e.project_config)?void 0:a.type)}),{enable:i,exclude:l}=o,c=H(r,l,i,{params:{project_type:"PHP",stat:e?"open":"close"}});await a({request:w(c),success:e=>{const{data:a}=q(e.data);n&&n(),A({title:"批量设置防跨站",resultData:t.concat(a),resultTitle:"设置防跨站"})}})}}})}},{label:"防盗链",value:"hotLinkProtect",event:async(e,a,t,s,o,i)=>{r({title:"批量设置防盗链",area:50,compData:{selectedList:t.value,config:i},component:()=>n(()=>import("./index243.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o&&o()})}},{label:"流量限制",value:"limitFlowSite",event:async(e,a,t,s,o,i)=>{K.value=t.value,Q.value=i,r({title:"批量设置流量限制",area:44,compData:{selectedList:t.value,config:i},component:()=>n(()=>import("./index244.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>{o&&o(),K.value=[]}})}},I(),{label:"部署伪静态",value:"setPseudoStatic",event:async(e,a,t,s,o,i)=>{Q.value=i,r({title:"批量部署伪静态",area:72,compData:t.value,component:()=>n(()=>import("./index245.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o&&o()})}},R({callback:()=>{},classList:Y}),{label:"复制网站域名",value:"copySiteDomain",event:async(e,t,s,r,n,o)=>{await d({title:"批量复制网站域名",content:"批量复制网站所有域名，是否继续操作？"});const{enable:i,exclude:l}=o,c=H(s.value,l,i,{params:{project_type:"PHP"}});a({loading:"正在复制网站域名，请稍后...",request:P(c),success:e=>{n&&n(),v({value:e.data.data.join("\n")})}})}},{label:"删除站点",value:"delete",event:async(e,a,t,s,r,n)=>{Q.value=n,ye(t.value,r)}}],re=()=>{r({title:"添加站点-支持批量建站",area:80,component:()=>n(()=>import("./index246.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},ne=e=>{r({isAsync:!0,title:"网站备份数据【"+e.name+"】",area:90,component:()=>n(()=>import("./index247.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},oe=(e,a="")=>{var t;const s="PHPMOD"===(null==(t=null==e?void 0:e.project_config)?void 0:t.type);if($(e,a),s&&"nginx"!==U.value.webserver)return o.error("当前为动态项目仅支持nginx服务器使用");r({title:"站点修改[".concat(e.rname,"] -- 添加时间[").concat(e.addtime,"]").concat(s?' -- <code class="tag">异步项目</code>':""),area:[86,71],component:()=>n(s?()=>import("./phpasync-setting.js?v=1763689792"):()=>import("./index248.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},ie=async(e,a)=>{if("monitor-setting"===a&&(a="monitor"),"monitor"===a){if(!(await ge(e,!1)))return;i("total_website",e.name)}const t="nginx"===U.value.web.type?"btwaf":"btwaf_httpd",s=(e=>{switch(e){case"monitor":return 47;case"bt_waf":return 48;case"iconWaf":return 49}})(a);"monitor"!==a&&(a=t),await k({source:s,name:a,callback:t=>{if(t&&"monitor"!==a){const a=setInterval(()=>{var s;const r=t.document.getElementsByClassName("layui-layer-page")[0];if(t.site_waf_config&&r){clearInterval(a),r&&(r.style.display="none"),t.site_waf_config(e.name);const n=t.document.getElementsByClassName("layui-layer-page")[1];n&&(null==(s=n.querySelector(".layui-layer-close"))||s.addEventListener("click",()=>{var e;null==(e=r.querySelector(".layui-layer-close"))||e.click()}))}},50)}}})},le=()=>{r({isAsync:!0,title:"网站安全扫描",area:[75,65],component:()=>n(()=>import("./index250.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},ce=()=>{r({isAsync:!0,title:"漏洞扫描",area:[80,71],component:()=>n(()=>import("./index251.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{isSiteModule:!0}})},ue=S(!1),me={title:"网站监控报表 --功能介绍",imgSrc:"/soft_ico/ico-total.png",ps:"快速浏览不同时间段的流量数据，发现高峰和趋势，助您迅速优化网站！",source:142,desc:["分析近期攻击","快速分析流量状况","多时段切换","排查趋势变化"],tabImgs:["https://www.bt.cn/Public/new/plugin/total/siteTraffic/traffic.png"]},ge=async(e,a=!0)=>{try{const{data:t}=await l({sName:"monitor"});return t.endtime<0?(ue.value=!0,!1):t.setup?(a&&(e=>{r({isAsync:!0,title:"流量数据",area:50,component:()=>n(()=>import("./index249.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1})})(e),!0):(await C({name:null==t?void 0:t.name,type:"i",pluginInfo:t}),!1)}catch(t){c(t)}},pe=async e=>{var a,t;const s="PHPMOD"===(null==(a=null==e?void 0:e.project_config)?void 0:a.type),r=Number(e.status),n=r?"stop":"start";if(s&&1===(null==(t=null==e?void 0:e.project_config)?void 0:t.dependence)&&"nginx"!==U.value.webserver)return o.error("当前仅支持nginx服务器使用");const i=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<i/1e3)return o.error("项目已过期，请设置站点到期时间后再操作");await d({title:"提示",content:r?"停用站点【".concat(e.name,"】后，用户访问会显示当前网站停用后的提示页，是否继续操作？"):"启动站点【".concat(e.name,"】后，用户可以正常访问网站内容，是否继续操作？"),icon:"warning-filled"});const{changeStatusEvent:l}=N(),c=await l({row:e,action:n},{isAsync:s,status:r});return c.status&&(W.value=!0),c},_e=S([{name:"漏洞扫描",callback:ce},{name:"网站安全扫描",callback:()=>{de(ee.value[0],"siteSecurity")}},{name:"网站拨测告警",callback:()=>{de(ee.value[0],"siteAlarm")}},{name:"日志安全分析",callback:()=>{de({...ee.value[0],tabName:"safe"},"siteLogs")}},{name:"网站防篡改",callback:()=>{de(ee.value[0],"antiTamper")}},{name:"网站容量限制",callback:()=>{var e,a;if(ee.value.length&&"PHPMOD"===(null==(a=null==(e=ee.value[0])?void 0:e.project_config)?void 0:a.type))return o.error("异步项目不支持容量限制");de({...ee.value[0],tabName:"flowQuota"},"directory")}}]),de=(e,a)=>{if(!ee.value.length)return o.msg({message:"暂无网站，请添加网站后使用",type:"warning"});oe(e,a)},ve=(e="setDefaultPage")=>r({isAsync:!0,title:"高级设置",area:[96,62],component:()=>n(()=>import("./index252.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1}),he=async()=>{try{const{data:e}=await f();if(e.hasOwnProperty("status")&&!e.status)return;const{scanData:a}=z();a.value={loophole_num:(null==e?void 0:e.loophole_num)||0,web_scaning_times:(null==e?void 0:e.web_scaning_times)||0,time:(null==e?void 0:e.time)||0,site_num:(null==e?void 0:e.site_num)||0}}catch(e){c(e)}},ye=(e,a)=>{r({title:"删除站点确认",component:()=>n(()=>import("./index253.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:"auto",compData:e,onCancel:()=>{a&&a()}})},be=O({project_jar:[u({message:"请输入项目jar路径"})],project_name:[u({message:"请输入项目名称"})],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],port:[u({message:"请输入端口号",trigger:"blur"}),m()],project_jdk:[u({message:"请输入项目JDK"})],project_cmd:[u({message:"请输入项目执行命令"})],php_version:[u({message:"请选择PHP版本",trigger:"change"})],project_path:[u({message:"请输入项目路径"})],domain:[u({message:"请输入项目域名"})],tomcat_version:[u({message:"请选择tomcat版本",trigger:"change"})],project_script:[u({message:"请选择项目启动脚本"})],project_cwd:[u({message:"请输入项目启动目录"})],userCmd:[u({message:"请输入命令",trigger:["blur","input"]})],config_body:[{required:!0,message:"请输入配置内容",trigger:["blur","input"]}],cluster:[{required:!0,message:"请输入负载实例数量",trigger:["blur","change"]}],max_memory_limit:[{required:!0,message:"请输入内存上限",trigger:["blur","change"]}],project_exe:[u({message:"请选择项目可执行文件"})],rfile:[u({message:"请选择项目运行文件"})],run_user:[{required:!0,message:"请选择运行用户",trigger:"change"}],pjname:[u({message:"请输入项目名称"})],path:[u({message:"请选择路径"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],dotnet_version:[{required:!0,message:"请选择Net版本",trigger:["blur","change"]}],webname:[u({message:"请输入域名",trigger:"blur"}),g()],processes:[u({message:"请输入进程数"})],threads:[u({message:"请输入线程数"})],ftp_username:[{validator:(e,a,t)=>{0===a.length?t(new Error("FTP用户名不能为空！")):/^[a-zA-Z0-9_]+$/g.test(a)?a.length<=3?t(new Error("FTP用户名长度错误，需要大于3个字符！")):t():t(new Error("FTP用户名只能包含字母、数字和下划线！"))},trigger:["blur","change"]}],datauser:[{trigger:["blur","change"],validator:(e,a,t)=>{0===a.length?t(new Error("名称不能为空！")):/^[a-zA-Z0-9_]+$/g.test(a)?a.length<=3?t(new Error("名称长度错误，不能少于3个字符！")):a.length>16?t(new Error("名称长度错误，不能大于16个字符！")):t():t(new Error("名称只能包含字母、数字和下划线！"))}}],site_path:[{required:!0,message:"请输入项目目录",trigger:["blur","change"]},{valitor:(e,a,t)=>{a?t():t(new Error("请输入项目目录"))},trigger:["blur","input","change"]}],domains:[{required:!0,message:"请输入域名",trigger:"blur"},{trigger:["blur","input","change"],validator:(e,a,t)=>{const s=a.split("\n").filter(e=>e.length),r=s.findIndex(e=>e.split(":")[0].length<3);s.map((e,a)=>{let s=e.includes(":");(s&&!p(e)||!s&&!_(e))&&t(new Error("当前域名格式错误，第".concat(a+1,"行，内容:").concat(e)))}),-1!==r?t(new Error("第 ".concat(r+1," 个域名长度不符合要求（必须大于3个字符）"))):t()}}]}),fe=e=>{try{const a=localStorage.getItem(e);if(!a)return[];const t=JSON.parse(a);return Array.isArray(t)?t:[]}catch(a){return localStorage.removeItem(e),[]}};export{N as S,re as a,ce as b,le as c,fe as d,ie as e,oe as f,ne as g,ae as h,he as i,ue as j,me as k,Y as l,pe as m,ye as n,ge as o,ve as p,se as q,_e as r,te as s,ee as t,J as u,be as v,B as w};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
