import{n as e,H as a,Q as t,az as s,b as l,u as n,b3 as o,an as i,q as r,x as u,ap as c}from"./utils-lib.js?v=1763689792";import{_ as m}from"./index109.js?v=1763689792";import{r as p,c as d,s as v,e as _,D as f,w as b,v as y,n as g,x as j,O as x,C as h,z as C,A as k,y as w,b1 as O,F as S,R as T,an as B,am as E}from"./base-lib.js?v=1763689792";import{c as I,a as L,d as P,g as R,u as D}from"./column.js?v=1763689792";import{c as V,h as A,e as U,l as q,g as J,i as M,s as N,j as z,u as F,a as G,k as H}from"./useController6.js?v=1763689792";import{u as K,S as Q}from"./useStore4.js?v=1763689792";import{u as W}from"./index147.js?v=1763689792";import{i as X,o as Y,h as Z}from"./validator.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import{getVersionList as $,setGoEnvironment as ee,modifyProject as ae,createProject as te,batchStatus as se,batchDelSite as le}from"./site.js?v=1763689792";const ne=l(),{siteInfo:oe,isRefreshList:ie,activeType:re}=K(),{setSiteInfo:ue}=Q(),ce=p(""),me=p([]),pe=()=>{oe.value=null,e({title:"添加Go项目",area:62,component:()=>a(()=>import("./index392.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},de=(t,s="")=>{ue(t,s),e({title:"Go项目管理["+t.name+"] -- 添加时间["+t.addtime+"]",area:[84,72],component:()=>a(()=>import("./index393.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},ve=async()=>{try{let e;e=await $("go"),ce.value=e.data.used,me.value=e.data.sdk.all.filter(e=>e.installed).map(e=>({label:e.version,value:e.version}))}catch(e){}},_e=async()=>{(await t({loading:"正在设置，请稍后...",request:ee({name:ce.value}),message:!0})).status&&ve()},fe=async(e,a,l)=>{let n=Object.assign({},e.value);""!==n.domains?(n.bind_extranet=1,n.domains=s(n.domains)?n.domains.split("\n"):n.domains):(n.bind_extranet=0,delete n.domains);let o=e.value.env;1===l&&(o=(e=>{let a=e.split("\n").filter(e=>""!==e),t=[];return a.forEach(e=>{let a=e.split("=");t.push({k:a[0],v:a[1]})}),t})(o)),n.env_file=2===l?e.value.envPath:"",n.env_list=JSON.stringify(1===l?o:[]),await a();const i={data:JSON.stringify(n)},r=oe.value?ae:te,u=await t({request:r(i,"go")});let c=u.data;return ne.msg({dangerouslyUseHTMLString:!0,message:c.status?c.data:c.error_msg,type:c.status?"success":"error",duration:c.status?2e3:0,showClose:!c.status,customClass:"!max-w-[66rem]"}),u.status&&(ie.value=!0),u.status},be=async(e,a,t,s,l,n)=>{const{label:o,value:i}=s,{enable:r,exclude:u}=n,c=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]);await e({title:"批量".concat(o),content:"".concat(c.get(i),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},I()],onConfirm:async()=>{const e=await(async()=>{const e=new Map([["start",se],["stop",se],["restart",se],["delete",le]]).get(i);switch(i){case"start":case"stop":case"restart":if(e){const a=t.value.map(e=>({project_name:e.name})),s=Z(!1,u,r,{params:{site_list:JSON.stringify(a),status:i,project_type:re.value.toUpperCase()}});return await e(s,re.value)}break;case"delete":if(e){const a=Z(t.value,u,r,{params:{project_type:re.value.toUpperCase()}});return await e(a)}}})();ie.value=!0,l&&l();let{data:a}=X(e.data);a=a.map(e=>({...e,name:e.name||e.project_name})),Y(a,{title:"".concat(o,"网站")})}})},ye={class:"flex items-center mx-12px"},ge=d({__name:"index",setup(e){n();const{getSiteList:t,setSiteInfo:s}=Q(),{activeType:l,isRefreshList:p,siteInfo:d}=v(Q()),{BtOperation:I}=o({options:[{type:"button",label:"添加项目",active:!0,onClick:pe},{type:"button",label:"SDK版本管理",onClick:()=>{q("go",ve)}}]}),K=W({key:"type_id",name:"Go分类",options:()=>[{label:"全部分类",value:"all"}],event:M,ignore:["0"],field:"type_name"}),X=c([{label:"启用项目",value:"start",event:be},{label:"停用项目",value:"stop",event:be},{label:"重启项目",value:"restart",event:be},F(),G({classList:H}),{label:"删除项目",value:"delete",event:be}]),{BtTable:Y,BtPage:Z,BtRefresh:$,BtSearch:ee,BtColumn:ae,BtBatch:te,BtTableCategory:se,refresh:le,config:ne}=i({request:e=>{const{type_id:a,...s}=e;return t({data:JSON.stringify({...s,type_id:r(a)||"all"===a?"":a})})},columns:[L({type:"page",key:"id"}),V({onClick:e=>{de(e)}}),A({onClick:(e,a)=>{if("setting"===a)return void de(e,"state");const t=e.run?"stop":"start";N(e,"restart"===a?a:t)}}),{label:"PID",isCustom:!1,render:e=>{var a;return r(e.load_info)||0===(null==(a=Object.keys(e.load_info))?void 0:a.length)?"--":Object.entries(e.load_info).map(([e,a])=>"".concat(e)).join(", ")}},{label:"监听端口",isCustom:!1,render:e=>{var a,t;return r(e.listen)||0===(null==(a=e.listen)?void 0:a.length)?"--":(null==(t=e.listen)?void 0:t.join(","))||"--"}},{label:"CPU",isCustom:!1,render:e=>{var a;return r(e.load_info)||0===(null==(a=Object.keys(e.load_info))?void 0:a.length)?"--":Object.entries(e.load_info).map(([e,a])=>"".concat(a.cpu_percent.toFixed(2),"%")).join(", ")}},{label:"内存",isCustom:!1,render:e=>{var a;return r(e.load_info)||0===(null==(a=Object.keys(e.load_info))?void 0:a.length)?"--":Object.entries(e.load_info).map(([e,a])=>"".concat(u(a.memory_used))).join(", ")}},P(),R({table:"sites",width:200}),U({onClick:e=>{de(e,"ssl")}}),D([{title:"设置",onClick:e=>{de(e)}},{title:"删除",onClick:e=>{z(e)}}])],extension:[K,X],empty:()=>_("span",null,[f("您的列表为空，您可以"),_("span",{class:"bt-link",onClick:pe},[f("添加一个项目")])])});return b(p,async e=>{var a;if(e){if(await le(),null==(a=d.value)?void 0:a.name){const e=ne.data.find(e=>e.name===d.value.name);e&&s(e)}p.value=!1}}),y(()=>{ve(),g(()=>{a(()=>import("./index392.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),a(()=>import("./index393.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})}),(e,a)=>{const t=E,s=B,l=m;return j(),x(l,null,{"header-left":h(()=>[_(C(I)),k("div",ye,[a[4]||(a[4]=k("span",{class:"mr-4px"},"命令行版本",-1)),_(s,{class:"!w-[10rem]",placeholder:"未设置",modelValue:C(ce),"onUpdate:modelValue":a[1]||(a[1]=e=>T(ce)?ce.value=e:null),options:C(me),onChange:C(_e)},{footer:h(()=>[k("div",{class:"flex items-center justify-center py-[.8rem] cursor-pointer",onClick:a[0]||(a[0]=e=>C(q)("go",C(ve)))},[...a[3]||(a[3]=[k("span",{class:"bt-link"},"前往管理",-1)])])]),default:h(()=>[(j(!0),w(S,null,O(C(me),(e,a)=>(j(),x(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","options","onChange"])]),k("div",{class:"flex items-center ml-1rem",onClick:a[2]||(a[2]=(...e)=>C(J)&&C(J)(...e))},[...a[5]||(a[5]=[k("i",{class:"svgtofont-desired text-medium"},null,-1),k("span",{class:"bt-link"},"需求反馈",-1)])])]),"header-right":h(()=>[_(C(se),{class:"!w-[200px] mr-[10px]"}),_(C(ee),{class:"mr-[10px]",placeholder:"请输入项目名称或备注"}),_(C($),{class:"mr-[10px]"}),_(C(ae))]),content:h(()=>[_(C(Y))]),"footer-left":h(()=>[_(C(te))]),"footer-right":h(()=>[_(C(Z))]),_:1})}}}),je=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{fe as a,je as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
