import{Q as e,js as t,M as a,aK as r,jt as n,p as l,ju as o,jv as s,n as i,H as c,ay as u,aA as p,jw as d,jx as m,jy as v,b3 as h,an as g,V as b,ao as f,ap as y,_ as w,aj as _}from"./utils-lib.js?v=1763689792";import{j as k,r as x,W as E,s as j,c as C,aE as O,e as N,x as T,O as D,C as V,z as P,U as B,ap as H,ag as S,af as q,D as I,H as R,aB as z,aA as W,be as A,i as M,v as U,y as L}from"./base-lib.js?v=1763689792";import{_ as J}from"./index109.js?v=1763689792";import{a as K,b as F,u as G,o as Q}from"./column.js?v=1763689792";import{l as Y,D as $,f as X,m as Z}from"./useController4.js?v=1763689792";import{f as ee}from"./validator.js?v=1763689792";import{h as te}from"./form-item.js?v=1763689792";import{_ as ae}from"./index110.js?v=1763689792";const re=k("DOCKER-SITE-ENV-PHP-STORE",()=>{const u=x(!1),p=x(),d=x([]),m=x([]),v=x([]),h=E([]),g=E({}),b=x(!1),f=x(!1),y=()=>{f.value=!0};return{versionOptions:d,extendOptions:m,templateOptions:v,extendsupOptions:h,resetData:()=>{d.value=[],m.value=[],v.value=[],b.value=!1,u.value=!1,p.value={},h.value=[],g.value={}},getExtend:async(n="all")=>{try{const l={version:n},o=await e({loading:"正在获取版本，请稍后...",request:t(l),message:!1});o.status?g.value=o.data:(a.error(o.msg),r(o))}catch(l){r(l)}},getTemplate:async t=>{try{const l=await e({loading:"正在获取版本，请稍后...",request:n(t||{p:1,row:100}),message:!1});if(!l.status)return a.error(l.msg),r(l),!1;v.value=l.data.data.map(e=>({label:e.name,name:e.name,value:e.id,ext:e.exts,version:e.version,disabled:!1}))}catch(l){r(l)}},popoverFocus:b,isEdit:u,rowData:p,allData:g,refreshTemplateTable:f,setRefreshTemplateTable:y,delPhpTemplate:async(t,a,n)=>{try{await l({title:"删除【".concat(t.name,"】模板"),content:"删除【".concat(t.name,"】模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await e({loading:"正在删除，请稍后...",request:o({id:t.id}),message:!0,success:e=>{y(),n&&n(e)}})}catch(s){r(s)}},useBatchEventHandle:async(t,r,n,o,u)=>{await l({title:"删除模板",content:"删除选中的".concat(n.value.length,"个模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const p={ids:n.value.map(e=>e.id).join(",")};await e({loading:"正在删除，请稍后...",request:s(p),success:async e=>{Array.isArray(e.data.data)?await i({title:"批量删除结果",area:42,component:()=>c(()=>import("./index125.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{resultData:e.data.data.map(e=>{const t=n.value.find(t=>t.id===Number(e.id));return{name:null==t?void 0:t.name,status:e.status,msg:e.msg}}),resultTitle:"删除扩展模板"}}):a.request(e),y(),u()}})}}});let ne=null,le="";const oe=x(""),se=e=>{let t=[];ne=u({route:"/sock_shell",onMessage:(r,n)=>{t.push(n.data),t.length>50?oe.value=null==t?void 0:t.slice(t.length-50).join(" "):oe.value=null==t?void 0:t.join(" "),(n.data.includes("bt_successful")||n.data.includes("bt_failed"))&&(null==ne||ne.close(),t=[]),n.data.includes("bt_successful")&&(e(),a.success("创建成功")),n.data.includes("bt_failed")&&a.error("创建失败")}}),null==ne||ne.send(le)},ie=()=>{null==ne||ne.close(),ne=null,le="",oe.value=""},ce=(e,t)=>{le=e,i({title:"创建日志",area:60,component:()=>c(()=>import("./index452.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{t&&t()}})},ue=re(),{getVersion:pe,setTypeRefreshTable:de}=Y(),{versionOptions:me,extendOptions:ve,allData:he,extendsupOptions:ge,isEdit:be,rowData:fe,templateOptions:ye}=j(ue),{resetData:we,getExtend:_e,getTemplate:ke,setRefreshTemplateTable:xe}=ue;x();const Ee=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./php-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{we(),e(!1)}})})),je=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise((e,t)=>{i({title:"创建",area:60,btn:["确认","取消"],component:()=>c(()=>import("./php-template-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})})),Ce=async t=>{try{const{data:a}=await e({request:n(t||{p:1,row:100})});return a.status?{data:a.data,total:p(a.page)}:{data:[],total:0}}catch(a){}},Oe=async e=>{try{await _e(),await ke();const t=await pe("php");t.status&&(me.value=t.data.php.map(e=>({label:e,value:e})),ve.value=t.data.repo_urls.map(e=>({label:e.name,value:e.repo})),me.value.length>0&&(be.value||(e.value.version=me.value[0].value),Te(me.value[0].value)),ve.value.length>0&&!be.value&&(e.value.repo_url=ve.value[0].value)),be.value&&Te(fe.value.version)}catch(t){}},Ne=async e=>{try{await _e();const t=await pe("php");t.status&&(me.value=t.data.php.map(e=>({label:e,value:e})),me.value.length>0&&(be.value||(e.value.version=me.value[0].value),Te(me.value[0].value))),be.value&&Te(fe.value.version)}catch(t){}},Te=e=>{var t;try{e&&(ge.value=(null==(t=he.value[e])?void 0:t.map(e=>({label:e,value:e})))||[],ye.value=ye.value.map(t=>({...t,label:"".concat(t.name).concat(t.version!==e?"(当前PHP版本不支持)":""),disabled:t.version!==e})))}catch(a){}},De=(e,t,r,n,l)=>{var o,s,i;try{if(e.includes(",")){if(""===r)return n.value.exts=[],a.error("请先选择PHP版本");t.value=(null==(o=he.value[r])?void 0:o.filter(t=>t.includes(e)).map(e=>({label:e,value:e})))||[];const i=[],c=[];e.split(",").filter(e=>""!==e&&" "!==e).forEach(e=>{he.value[r].includes(e)?c.push(e):i.push(e)}),n.value.exts=c,null==(s=l.value)||s.blur(),i.length>0?a.success("已选中".concat(c.length,"个扩展，当前PHP版本不支持这").concat(i.length,"个扩展：【").concat(i.join(","),"】")):c.length>0&&a.success("已选中".concat(c.length,"个扩展"))}else t.value=(null==(i=he.value[r])?void 0:i.filter(t=>t.includes(e)).map(e=>({label:e,value:e})))||[]}catch(c){}},Ve=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,repo_url:fe.value.repo_url,template:"",exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",repo_url:"",template:"",exts:""}}catch(e){}},Pe=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",exts:""}}catch(e){}},Be=async(t,r)=>{try{const n={runtime_name:t.name,runtime_version:t.version,repo_url:t.repo_url,exts:t.exts.join(","),runtime_type:"php",...t.id?{id:t.id}:{}};await e({request:d(n),success:e=>{e.status?(r(),ce("tail -f /www/dk_project/runtime/build/php/".concat(t.name,"/build.log"),()=>{de("php")})):a.error(e.msg)}})}catch(n){}},He=async(t,a)=>{try{const r={name:t.name,version:t.version,exts:t.exts.join(","),...t.id?{id:t.id}:{}};await e({request:m(r),message:!0,success:e=>{e.status&&(a(),xe())}})}catch(r){}},Se=k("DOCKER-SITE-LOG-STORE",()=>{const e=x("run"),t=x({compose:"",log_file:""}),r=x("");return{rowData:t,tabActive:e,logContent:r,getEnvLog:async()=>{try{const n={log_type:e.value,..."run"===e.value?{compose_file:t.value.compose}:{log_file:t.value.log_file}},l=a.load("正在获取日志，请稍后..."),{data:o}=await v(n);l.close(),o.status?r.value=o.data:(a.error(o.msg),r.value="暂无日志内容")}catch(n){}},resteData:()=>{r.value="",t.value.compose_file="",t.value.log_file="",e.value="run"}}}),qe=()=>j(Se()),Ie=Se(),{resteData:Re}=Ie,{rowData:ze}=j(Ie),We=(e,t)=>(ze.value.compose=e.compose,ze.value.log_file=e.log_file,new Promise((a,r)=>{i({title:"【".concat(e.name,"】日志"),area:65,component:()=>c(()=>import("./index453.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:t||"run",onCancel:()=>{Re(),a(!1)}})})),Ae=w(C({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:r}=$(),{refreshEnvTable:n}=j(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,refreshTemplate:u}=a,{BtOperation:p}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Ee()}},{type:"button",label:"扩展模板",onClick:()=>{new Promise((e,t)=>{i({title:"扩展模板",area:90,component:()=>c(()=>import("./extend-template.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})})}},{type:"button",label:"清理构建缓存",onClick:()=>{s("php")}}]}),{BtOperation:d}=h({options:[{type:"button",label:"更新环境模板",onClick:()=>{u("php")}}]}),m=y([{label:"删除",value:"delete",event:o}]),{BtTable:v,BtPage:w,BtBatch:_,refresh:k}=g({request:e=>r({p:e.p||1,row:e.limit||20,runtime_type:"php"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:100},F({function:e=>{let t="异常",a="#ff0000";switch(e.status){case"normal":t="正常",a="var(--el-color-primary)";break;case"initializing":t="构建中",a="#555"}return O("span",{style:{color:a},onClick:()=>{"normal"!==e.status&&We(e,"build")},class:"normal"!==e.status?"cursor-pointer":""},N("span",{class:"flex items-center"},[t,N("i",{class:"svgtofont-el-loading !text-small animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))}}),{label:"创建时间",minWidth:100,prop:"addtime",render:e=>N("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},G([{width:80,isHide:e=>"normal"!==e.status,onClick:e=>{X({type:"runEnv",formData:{type:"php",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{We(e)},title:"日志"},{onClick:e=>{Ee(e)},title:"编辑"},{onClick:e=>{l(e,"php")},title:"删除"}])],extension:[m,f(n)]});return t({init:k}),(e,t)=>{const a=J;return T(),D(a,null,{"header-left":V(()=>[N(P(p))]),"header-right":V(()=>[N(P(d))]),content:V(()=>[N(P(v),{"min-height":300,class:"fix-table"})]),"footer-left":V(()=>[N(P(_))]),"footer-right":V(()=>[N(P(w))]),_:1})}}}),[["__scopeId","data-v-d801478a"]]),Me=k("DOCKER-SITE-ENV-JAVA-STORE",()=>{const a=x(!1),l=x(),o=x([]),s=x([]),i=x([]),c=E([]),u=E({}),p=x(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const n={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(n),message:!1});l.status?(u.value=l.data,s.value=l.data.repo_urls.map(e=>({label:e.name,value:e.repo}))):r(l)}catch(n){r(n)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:n(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):r(a)}catch(a){r(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),Ue=Me(),{getVersion:Le,setTypeRefreshTable:Je}=Y(),{versionOptions:Ke,isEdit:Fe,rowData:Ge}=j(Ue),{resetData:Qe}=Ue,Ye=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},$e=e=>(Fe.value=!!(null==e?void 0:e.name),Ge.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./java-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Qe(),e(!1)}})})),Xe=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},Ze=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>N(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Xe(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>N(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Xe(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,cellStyle:"{ textAlign: 'center' }",render:e=>N("div",{class:"h-[3rem]"},[N(H,{modelValue:e.output,"onUpdate:modelValue":t=>e.output=t,onChange:t=>Xe(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>N("div",{class:"h-[3rem]"},[N(S,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Xe(t,e,"protocol")},{default:()=>[N(q,{value:"tcp"},{default:()=>[I("TCP")]}),N(q,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>N(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{if(1==e.length)return a.error("至少保留一条端口映射");e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>N("div",{class:"w-[90%]"},[N(t,null,null),N("div",{class:"text-tertiary text-small"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:["blur","change"],validator:(e,t,a)=>{et(t,a)}}]})},et=(e,t)=>{if(0==e.length)return!0;const r={};for(let n=0;n<e.length;n++){const l=e[n];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(n+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(n+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(n+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"协议不能为空")),!1}r["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),r},tt=async e=>{try{const t=await Le("java");t.status&&(Ke.value=t.data.java.map(e=>({label:e,value:e})),Ke.value.length>0&&!Fe.value&&(e.value.version=Ke.value[0].value))}catch(t){}},at=()=>{var e;try{if(Fe.value){const t=[];return null==(e=Object.entries(JSON.parse(Ge.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...r]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:r,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:Ge.value.name,version:Ge.value.version,path:Ge.value.path,command:Ge.value.command,port:t,id:Ge.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},rt=async(t,r)=>{try{const n=et(t.port);if(!n)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===n?"":JSON.stringify(n),runtime_type:"java",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(r(),ce("tail -f /www/dk_project/runtime/run/java/".concat(t.name,"/create.log"),()=>{Je("java")})):a.error(e.msg)}})}catch(n){}};const nt=w(C({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:r}=$(),{refreshJavaEnvTable:n}=j(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{$e()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("java")}}]}),u=y([{label:"删除",value:"delete",event:o}]);z("popupClose",()=>{});const{BtTable:p,BtPage:d,BtBatch:m,BtRefresh:v,refresh:w}=g({request:e=>r({p:e.p||1,row:e.limit||20,runtime_type:"java"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="var(--el-color-primary)";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return N(W,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>N("div",{class:"flex items-center"},[N("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"java")},["running"===e.status?"停止":"启动"]),N(ae,null,null),N("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"java")},[I("重启")])]),reference:()=>O("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"java")}},N("span",{class:"flex items-center"},[t,N("i",{class:"svgtofont-el-loading !text-small animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let r=0;for(let n=0;n<t.length;n++){if(r>=10){a.push("......");break}const e=t[n];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),r++)}return N("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return N(A,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!M(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>N("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>N("span",{class:"btlink truncate inline-block max-w-[20rem] cursor-pointer leading-[3.7rem]",title:e.path,onClick:()=>Q(e,"path")},[e.path])},G([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{X({type:"runEnv",formData:{type:"java",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{We(e)},title:"日志"},{onClick:e=>{$e(e)},title:"编辑"},{onClick:e=>{l(e,"java")},title:"删除"}])],extension:[u,f(n)]});return t({init:w}),(e,t)=>{const a=J;return T(),D(a,null,{"header-left":V(()=>[N(P(c))]),"header-right":V(()=>[N(P(v))]),content:V(()=>[N(P(p),{class:"fix-table"})]),"footer-left":V(()=>[N(P(m))]),"footer-right":V(()=>[N(P(d))]),_:1})}}}),[["__scopeId","data-v-be25f867"]]),lt=k("DOCKER-SITE-ENV-PYTHON-STORE",()=>{const a=x(!1),l=x(),o=x([]),s=x([]),i=x([]),c=E([]),u=E({}),p=x(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const n={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(n),message:!1});l.status?u.value=l.data:r(l)}catch(n){r(n)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:n(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):r(a)}catch(a){r(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),ot=lt(),{getVersion:st,setTypeRefreshTable:it}=Y(),{versionOptions:ct,extendOptions:ut,isEdit:pt,rowData:dt}=j(ot),{resetData:mt}=ot,vt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},ht=()=>{var e;try{if(pt.value){const t=[];return null==(e=Object.entries(JSON.parse(dt.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...r]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:r,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:dt.value.name,version:dt.value.version,path:dt.value.path,repo_url:dt.value.repo_url,command:dt.value.command,port:t,id:dt.value.id}}return{name:"",version:"",repo_url:"mirrors.aliyun.com",path:"",template:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},gt=async e=>{try{const t=await st("python");t.status&&(ct.value=t.data.python.map(e=>({label:e,value:e})),ut.value=t.data.repo_urls.map(e=>({label:e.name,value:e.repo})),ct.value.length>0&&!pt.value&&(e.value.version=ct.value[0].value),ut.value.length>0&&!pt.value&&(e.value.repo_url=ut.value[0].value))}catch(t){}},bt=e=>(pt.value=!!(null==e?void 0:e.name),dt.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./python-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{mt(),e(!1)}})})),ft=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},yt=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>N(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>N(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>N("div",{class:"h-[3rem]"},[N(H,{modelValue:e.output,"onUpdate:modelValue":t=>e.output=t,onChange:t=>ft(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>N("div",{class:"h-[3rem]"},[N(S,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>ft(t,e,"protocol")},{default:()=>[N(q,{value:"tcp"},{default:()=>[I("TCP")]}),N(q,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>N(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>N("div",{class:"w-[90%]"},[N(t,null,null),N("div",{class:"text-tertiary text-small"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{wt(t,a)}}]})},wt=(e,t)=>{if(0==e.length)return!0;const r={};for(let n=0;n<e.length;n++){const l=e[n];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(n+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(n+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(n+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"协议不能为空")),!1}r["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),r},_t=async(t,r)=>{try{const n=wt(t.port);if(!n)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===n?"":JSON.stringify(n),repo_url:t.repo_url,runtime_type:"python",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(ce("tail -f /www/dk_project/runtime/run/python/".concat(t.name,"/create.log"),()=>{it("python")}),r()):a.error(e.msg)}})}catch(n){}};const kt=w(C({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:r}=$(),{refreshPythonEnvTable:n}=j(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{bt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("python")}}]});z("popupClose",()=>{});const u=y([{label:"删除",value:"delete",event:o}]),{BtTable:p,BtPage:d,BtBatch:m,BtRefresh:v,refresh:w}=g({request:e=>r({p:e.p||1,row:e.limit||20,runtime_type:"python"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:50},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="var(--el-color-primary)";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return N(W,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>N("div",{class:"flex items-center"},[N("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"python")},["running"===e.status?"停止":"启动"]),N(ae,null,null),N("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"python")},[I("重启")])]),reference:()=>O("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"python")}},N("span",{class:"flex items-center"},[t,N("i",{class:"svgtofont-el-loading !text-small animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let r=0;for(let n=0;n<t.length;n++){if(r>=10){a.push("......");break}const e=t[n];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),r++)}return N("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return N(A,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!M(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>N("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>N("span",{class:"btlink truncate inline-block max-w-[18rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>Q(e,"path")},[e.path])},G([{width:60,isHide:e=>"running"!==e.status,onClick:e=>{X({type:"runEnv",formData:{type:"python",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{We(e)},title:"日志"},{onClick:e=>{i("stop",e,"python")},isHide:e=>"running"!==e.status,title:"停止"},{onClick:e=>{i("restart",e,"python")},isHide:e=>"running"!==e.status,title:"重启"},{onClick:e=>{bt(e)},title:"编辑"},{onClick:e=>{l(e,"python")},title:"删除"}])],extension:[u,f(n)]});return t({init:w}),(e,t)=>{const a=J;return T(),D(a,null,{"header-left":V(()=>[N(P(c))]),"header-right":V(()=>[N(P(v))]),content:V(()=>[N(P(p),{class:"fix-table"})]),"footer-left":V(()=>[N(P(m))]),"footer-right":V(()=>[N(P(d))]),_:1})}}}),[["__scopeId","data-v-0c2cf93c"]]),xt=k("DOCKER-SITE-ENV-GO-STORE",()=>{const a=x(!1),l=x(),o=x([]),s=x([]),i=x([]),c=E([]),u=E({}),p=x(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const n={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(n),message:!1});l.status?(u.value=l.data,s.value=l.data.repo_urls.map(e=>({label:e.name,value:e.repo}))):r(l)}catch(n){r(n)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:n(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):r(a)}catch(a){r(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),Et=xt(),{getVersion:jt,setTypeRefreshTable:Ct}=Y(),{versionOptions:Ot,isEdit:Nt,rowData:Tt}=j(Et),{resetData:Dt}=Et,Vt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},Pt=e=>(Nt.value=!!(null==e?void 0:e.name),Tt.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./go-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Dt(),e(!1)}})})),Bt=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},Ht=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>N(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Bt(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>N(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Bt(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>N("div",{class:"h-[3rem]"},[N(H,{modelValue:e.output,"onUpdate:modelValue":t=>e.output=t,onChange:t=>Bt(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>N("div",{class:"h-[3rem]"},[N(S,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Bt(t,e,"protocol")},{default:()=>[N(q,{value:"tcp"},{default:()=>[I("TCP")]}),N(q,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>N(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>N("div",{class:"w-[90%]"},[N(t,null,null),N("div",{class:"text-tertiary text-small"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{St(t,a)}}]})},St=(e,t)=>{if(0==e.length)return!0;const r={};for(let n=0;n<e.length;n++){const l=e[n];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(n+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(n+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(n+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"协议不能为空")),!1}r["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),r},qt=async e=>{try{const t=await jt("go");t.status&&(Ot.value=t.data.go.map(e=>({label:e,value:e})),Ot.value.length>0&&!Nt.value&&(e.value.version=Ot.value[0].value))}catch(t){}},It=()=>{var e;try{if(Nt.value){const t=[];return null==(e=Object.entries(JSON.parse(Tt.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...r]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:r,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:Tt.value.name,version:Tt.value.version,path:Tt.value.path,command:Tt.value.command,port:t,id:Tt.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},Rt=async(t,r)=>{try{const n=St(t.port);if(!n)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===n?"":JSON.stringify(n),runtime_type:"go",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(r(),ce("tail -f /www/dk_project/runtime/run/go/".concat(t.name,"/create.log"),()=>{Ct("go")})):a.error(e.msg)}})}catch(n){}};const zt=w(C({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:r}=$(),{refreshGoEnvTable:n}=j(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Pt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("go")}}]}),u=y([{label:"删除",value:"delete",event:o}]);z("popupClose",()=>{});const{BtTable:p,BtPage:d,BtBatch:m,BtRefresh:v,refresh:w}=g({request:e=>r({p:e.p||1,row:e.limit||20,runtime_type:"go"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="var(--el-color-primary)";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return N(W,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>N("div",{class:"flex items-center"},[N("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"go")},["running"===e.status?"停止":"启动"]),N(ae,null,null),N("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"go")},[I("重启")])]),reference:()=>O("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"go")}},N("span",{class:"flex items-center"},[t,N("i",{class:"svgtofont-el-loading !text-medium animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"ports",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let r=0;for(let n=0;n<t.length;n++){if(r>=10){a.push("......");break}const e=t[n];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),r++)}return N("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return N(A,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!M(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>N("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>N("span",{class:"btlink truncate inline-block max-w-[20rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>Q(e,"path")},[e.path])},G([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{X({type:"runEnv",formData:{type:"go",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{We(e)},title:"日志"},{onClick:e=>{Pt(e)},title:"编辑"},{onClick:e=>{l(e,"go")},title:"删除"}])],extension:[u,f(n)]});return t({init:w}),(e,t)=>{const a=J;return T(),D(a,null,{"header-left":V(()=>[N(P(c))]),"header-right":V(()=>[N(P(v))]),content:V(()=>[N(P(p),{class:"fix-table"})]),"footer-left":V(()=>[N(P(m))]),"footer-right":V(()=>[N(P(d))]),_:1})}}}),[["__scopeId","data-v-9a0dda85"]]),Wt=k("DOCKER-SITE-ENV-NODE-STORE",()=>{const a=x(!1),l=x(),o=x([]),s=x([]),i=x([]),c=E([]),u=E({}),p=x(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const n={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(n),message:!1});l.status?u.value=l.data:r(l)}catch(n){r(n)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:n(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):r(a)}catch(a){r(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),At=Wt(),{getVersion:Mt,setTypeRefreshTable:Ut}=Y(),{versionOptions:Lt,extendOptions:Jt,isEdit:Kt,rowData:Ft}=j(At),{resetData:Gt}=At,Qt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:t=>{e.value.path=t}})},Yt=()=>{var e,t;try{if(Kt.value){const a=[];null==(e=Object.entries(JSON.parse(Ft.value.ports||"{}")))||e.forEach((e,t)=>{if(e[1]){const[t,...r]=e[0].split("/");a.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:t,protocol:r,output:"0.0.0.0"===e[1][0].HostIp})}});const r=null==(t=Ft.value.repo_url)?void 0:t.match(/^(\w+)\s+install\s+--registry=(.+)$/);return{name:Ft.value.name,version:Ft.value.version,path:Ft.value.path,package:(null==r?void 0:r[1])||"pnpm",repo_url:(null==r?void 0:r[2])||"https://npm.aliyun.com/",command:Ft.value.command,port:a,id:Ft.value.id}}return{name:"",version:"",repo_url:"https://npm.aliyun.com/",path:"",package:"pnpm",template:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(a){}},$t=async e=>{try{const t=await Mt("nodejs");t.status&&(Lt.value=t.data.nodejs.map(e=>({label:e,value:e})),Jt.value=t.data.repo_urls.map(e=>({label:e.name,value:e.repo})),Lt.value.length>0&&!Kt.value&&(e.value.version=Lt.value[0].value),Jt.value.length>0&&!Kt.value&&(e.value.repo_url=Jt.value[0].value))}catch(t){}},Xt=e=>(Kt.value=!!(null==e?void 0:e.name),Ft.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./node-form.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Gt(),e(!1)}})})),Zt=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},ea=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>N(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Zt(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>N(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Zt(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>N("div",{class:"h-[3rem]"},[N(H,{modelValue:e.output,"onUpdate:modelValue":t=>e.output=t,onChange:t=>Zt(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>N("div",{class:"h-[3rem]"},[N(S,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Zt(t,e,"protocol")},{default:()=>[N(q,{value:"tcp"},{default:()=>[I("TCP")]}),N(q,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>N(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>N("div",{class:"w-[90%]"},[N(t,null,null),N("div",{class:"text-tertiary text-small"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{ta(t,a)}}]})},ta=(e,t)=>{if(0==e.length)return!0;const r={};for(let n=0;n<e.length;n++){const l=e[n];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(n+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(n+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(n+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(n+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(n+1,"行")+"协议不能为空")),!1}r["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),r},aa=async(t,r)=>{try{const n=ta(t.port);if(!n)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===n?"":JSON.stringify(n),repo_url:"".concat(t.package," install --registry=").concat(t.repo_url),runtime_type:"nodejs",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(ce("tail -f /www/dk_project/runtime/run/nodejs/".concat(t.name,"/create.log"),()=>{Ut("nodejs")}),r()):a.error(e.msg)}})}catch(n){}};const ra=w(C({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:r}=$(),{refreshNodeEnvTable:n}=j(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Xt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("nodejs")}}]});z("popupClose",()=>{});const u=y([{label:"删除",value:"delete",event:o}]),{BtTable:p,BtPage:d,BtBatch:m,BtRefresh:v,refresh:w}=g({request:e=>r({p:e.p||1,row:e.limit||20,runtime_type:"nodejs"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:70},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="var(--el-color-primary)";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return N(W,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>N("div",{class:"flex items-center"},[N("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"nodejs")},["running"===e.status?"停止":"启动"]),N(ae,null,null),N("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"nodejs")},[I("重启")])]),reference:()=>O("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"nodejs")}},N("span",{class:"flex items-center"},[t,N("i",{class:"svgtofont-el-loading !text-small animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let r=0;for(let n=0;n<t.length;n++){if(r>=10){a.push("......");break}const e=t[n];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),r++)}return N("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return N(A,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!M(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>N("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>N("span",{class:"btlink truncate inline-block max-w-[18rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>Q(e,"path")},[e.path])},G([{width:60,isHide:e=>"running"!==e.status,onClick:e=>{X({type:"runEnv",formData:{type:"nodejs",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{We(e)},title:"日志"},{onClick:e=>{i("stop",e,"nodejs")},isHide:e=>"running"!==e.status,title:"停止"},{onClick:e=>{i("restart",e,"nodejs")},isHide:e=>"running"!==e.status,title:"重启"},{onClick:e=>{Xt(e)},title:"编辑"},{onClick:e=>{l(e,"nodejs")},title:"删除"}])],extension:[u,f(n)]});return t({init:w}),(e,t)=>{const a=J;return T(),D(a,null,{"header-left":V(()=>[N(P(c))]),"header-right":V(()=>[N(P(v))]),content:V(()=>[N(P(p),{class:"fix-table"})]),"footer-left":V(()=>[N(P(m))]),"footer-right":V(()=>[N(P(d))]),_:1})}}}),[["__scopeId","data-v-8ff8338e"]]),na={class:"p-[20px]"},la=C({__name:"index",setup(e){const{tabActive:t}=Z(),{BtTabs:a}=_({type:"card",value:t,options:[{label:"PHP",name:"php",render:()=>N(Ae,null,null)},{label:"JAVA",name:"java",lazy:!0,render:()=>N(nt,null,null)},{label:"Python",name:"python",lazy:!0,render:()=>N(kt,null,null)},{label:"GO",name:"go",lazy:!0,render:()=>N(zt,null,null)},{label:"Node",name:"nodejs",lazy:!0,render:()=>N(ra,null,null)}]}),r=e=>{};return U(()=>{}),(e,t)=>(T(),L("div",na,[N(P(a),{onChange:r})]))}}),oa=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{Vt as A,Ht as B,Rt as C,re as D,qt as E,Wt as F,Yt as G,Qt as H,ea as I,aa as J,$t as K,se as L,ie as M,oe as N,oa as O,Ce as a,He as b,Be as c,Ne as d,De as e,Ve as f,Oe as g,Se as h,Me as i,at as j,Ye as k,Ze as l,rt as m,tt as n,je as o,lt as p,ht as q,vt as r,Te as s,Pe as t,qe as u,yt as v,_t as w,gt as x,xt as y,It as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
