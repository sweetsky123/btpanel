import{fJ as s,V as a,aK as r,f as t,e,ay as o,_ as l}from"./utils-lib.js?v=1763689792";import{c,r as i,o as n,g as d,v as u,I as p,J as g,z as v,x as m,y,A as f,L as _,O as w,F as k,e as h,D as b,B as x,G as S,C as E,b1 as C,b6 as T,H as j}from"./base-lib.js?v=1763689792";import{aa as A}from"./firewall.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const D={id:"safeDetectList"},H={class:"progress-header"},I={class:"progress-header-cot"},J={key:0,class:"relative"},M={class:"absolute top-[1.6rem] left-[2.6rem] flex flex-col"},O={class:"progress-header-cot"},L={class:"scanning-progress-title"},z={class:"color-org"},B={class:"color-red"},F={class:"scanning-progress-cont"},G={class:"progress-header-cot"},K={class:"progress-cont-list"},N=["onClick"],P={class:"progress_type"},V={class:"progress_status"},q={key:0,class:"text-danger"},Q={key:1,class:"text-warning"},R={key:1},U={key:2,class:"text-secondary"},W={key:0},X={class:"progress_fold"},Y={class:"progress_item_body"},Z={class:"info_cont"},$={class:"info_cont_desc"},ss=l(c({__name:"index",setup(l){const c=i(!1),ss=[{color:"var(--el-color-text-tertiary)",text:"未安装"},{color:"var(--el-color-text-secondary)",text:"良好"},{color:"var(--el-color-warning",text:"警告"},{color:"red",text:"危险"}],as={system_account:"系统账户",sshd_service:"SSHD远程服务",file_mode:"重要文件权限及属性",software:"重点软件检测",other:"其他项目检测",backdoor:"后门检测",proc:"恶意进程",history:"历史命令",log:"日志排查",rootkit:"rootkit检测"},rs=i({}),ts=n({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"var(--el-color-primary)",progressConfig:{system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},statusTotal:{},allArr:[],result:{},progressStatus:{},active:{system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}}),es=s=>s+" 分";let os=null;const ls=d(()=>ts.scanStatus&&!ts.isEnd?"正在扫描":rs.value.status?"上次检测时间 "+("刚刚"===s(rs.value.msg.time)?"一分钟内":s(rs.value.msg.time)):"当前未进行安全检测"),cs=i(""),is=i(""),ns=d(()=>ts.scanStatus&&!ts.isEnd?"正在扫描-".concat(cs.value):ts.isEnd?"检测时间："+a(ts.time/1e3,"yyyy-MM-dd"):rs.value.status?"若长时间未检测，服务器可能存在安全风险，建议立即检测":"当前安全风险未知，请立即检测"),ds=(s,a)=>{if(a.data){const s=JSON.parse(a.data.replace(/'/g,'"'));s.hasOwnProperty("callback")?(null==os||os.close(),ts.scanStatus=!1,ts.isEnd=!0,ts.time=(new Date).getTime()):(cs.value=s.name,is.value=s.topic,ts.progress=parseInt(s.progress),ts.progressConfig[s.topic].push(s),ts.statusTotal[s.topic]=us(ts.progressConfig[s.topic]),ts.allArr.push(s),3===s.status?ts.error++:2===s.status&&ts.warn++,1!==s.status&&(ts.progressColor="var(--el-color-warning)"))}},us=s=>{const a={};return s.forEach(s=>{a[s.status]?a[s.status]++:a[s.status]=1}),a},ps=()=>{if(ts.scanStatus&&!ts.isEnd||ts.isEnd,ts.scanStatus&&!ts.isEnd)return null==os||os.close(),void gs();ts.isEnd&&gs(),ts.scanStatus=!0,os=o({route:"/ws_project",onMessage:ds}),null==os||os.send({mod_name:"safe_detect",def_name:"get_safe_scan",ws_callback:""})},gs=()=>{ts.scanStatus=!1,ts.isEnd=!1,ts.error=0,ts.warn=0,ts.time=0,ts.progress=0,ts.progressColor="var(--el-color-primary)",ts.progressConfig={system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},ts.statusTotal={},ts.allArr=[],ts.result={},ts.progressStatus={},ts.active={system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}};return u(()=>{(async()=>{try{const s=await A();rs.value=s.data}catch(s){r(s)}})()}),(s,a)=>{var r,o,l;const i=t,n=T,d=j,u=e,A=p("bt-loading");return g((m(),y("div",D,[f("div",H,[f("div",I,[f("div",{class:_("progresscirclebar "+(v(rs).status?"security ":"")+"text-["+(100===(null==(r=v(rs).msg)?void 0:r.security_count)?" var(--el-color-primary) ":" var(--el-color-warning)")+"]")},[v(rs).status?(m(),y(k,{key:1},[v(ts).scanStatus&&!v(ts).isEnd?(m(),y("div",J,[h(n,{class:"animate-spin",type:"circle",percentage:70,"show-text":!1,"stroke-width":4,"define-back-color":"var(--el-color-white)",color:v(ts).warn||v(ts).error?"var(--el-color-warning)":"var(--el-color-primary)",width:100},null,8,["color"]),f("div",M,[h(i,{class:"w-[full] px-[.4rem]",src:"/firewall/icon-safe-detect".concat(v(ts).warn||v(ts).error?"-org":"",".svg")},null,8,["src"]),a[0]||(a[0]=f("span",{class:"text-small font-bold py-[.4rem] leading-none"}," 安全检测 ",-1))])])):(m(),w(n,{key:1,type:"circle",percentage:null==(o=v(rs).msg)?void 0:o.security_count,format:es,color:100===(null==(l=v(rs).msg)?void 0:l.security_count)?"var(--el-color-primary)":"var(--el-color-warning)",width:100},null,8,["percentage","color"]))],64)):(m(),w(i,{key:0,class:"w-[10rem]",src:"/firewall/icon-safe-detect.svg"}))],2)]),f("div",O,[f("div",L,[v(ts).isEnd?(m(),y(k,{key:1},[a[5]||(a[5]=b(" 检测已完成 ",-1)),v(ts).error>0||v(ts).warn>0?(m(),y(k,{key:0},[a[4]||(a[4]=b(" ，一共发现 ",-1)),v(ts).warn>0?(m(),y(k,{key:0},[f("span",z,x(v(ts).warn),1),a[1]||(a[1]=b(" 项风险项 ",-1))],64)):S("",!0),v(ts).error>0?(m(),y(k,{key:1},[a[2]||(a[2]=b(" （包含 ",-1)),f("span",B,x(v(ts).error),1),a[3]||(a[3]=b(" 项危险项，请立即处理） ",-1))],64)):S("",!0)],64)):S("",!0)],64)):(m(),y(k,{key:0},[b(x(v(ls)),1)],64))]),v(ts).scanStatus?(m(),w(n,{key:0,percentage:v(ts).progress,color:v(ts).warn||v(ts).error?"var(--el-color-warning)":"var(--el-color-primary)","stroke-width":10},null,8,["percentage","color"])):S("",!0),f("div",F,x(v(ns)),1)]),f("div",G,[h(d,{type:v(ts).scanStatus&&!v(ts).isEnd?"warning":"primary",onClick:ps,plain:!(!v(ts).scanStatus||v(ts).isEnd)},{default:E(()=>[b(x(v(ts).scanStatus&&!v(ts).isEnd?"取消扫描":v(ts).isEnd?"重新检测":"立即检测"),1)]),_:1},8,["type","plain"]),h(u,{class:"!absolute -bottom-[2.5rem] right-[1.4rem]",href:"https://www.bt.cn/bbs/thread-126643-1-1.html"},{default:E(()=>[...a[6]||(a[6]=[b(" 需求反馈>> ",-1)])]),_:1})])]),f("div",K,[(m(),y(k,null,C(as,(s,a)=>f("div",{key:a,class:_([a+"_item "+(v(ts).active[a]?"active":""),"progress_item"])},[f("div",{class:"progress_item_header",onClick:s=>(s=>{ts.active[s]=!ts.active[s]})(a)},[f("div",P,[h(i,{class:"title-icon",src:"/firewall/icon-"+a+".svg"},null,8,["src"]),f("span",null,x(s),1)]),f("div",V,[v(ts).statusTotal[a]?(m(),y(k,{key:0},[v(ts).statusTotal[a][3]||v(ts).statusTotal[a][2]?(m(),y(k,{key:0},[v(ts).statusTotal[a][3]?(m(),y("span",q," 发现"+x(v(ts).statusTotal[a][3])+"项危险 ",1)):S("",!0),v(ts).statusTotal[a][2]?(m(),y("span",Q,x((v(ts).statusTotal[a][3]?"":"发现")+v(ts).statusTotal[a][2])+"项警告 ",1)):S("",!0)],64)):v(ts).scanStatus&&v(is)==a?(m(),y("span",R," 正在扫描... ")):(m(),y("span",U,"无风险项"))],64)):(m(),y(k,{key:1},[v(ts).scanStatus&&!v(ts).statusTotal[a]?(m(),y("span",W," 等待扫描 ")):S("",!0)],64))]),f("div",X,[h(i,{src:"/firewall/arrow-down.svg"})])],8,N),f("div",Y,[v(ts).progressConfig[a]&&v(ts).progressConfig[a].length?(m(!0),y(k,{key:0},C(v(ts).progressConfig[a],(s,a)=>(m(),y("div",{key:a,class:_([s.info?"active":"","progress_item_info"])},[f("div",Z,[f("div",null,x(s.name.replace("分析网站","")),1),f("div",{class:_("text-["+ss[s.status<0?0:s.status].color+"]")},x(ss[s.status<0?0:s.status].text),3)]),f("div",$,x(s.info||""),1)],2))),128)):S("",!0)])],2)),64))])])),[[A,v(c)]])}}}),[["__scopeId","data-v-4feacef1"]]);export{ss as default};
