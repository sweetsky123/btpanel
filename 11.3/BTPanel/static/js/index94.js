import{c as e,bU as t,e as s,m as a,aY as n,i,s as r,j as l,r as o,D as c,F as d,w as u,x as p,y as m,C as x,A as f,B as _,z as h,G as v}from"./base-lib.js?v=1763689792";import{_ as b}from"./index423.js?v=1763689792";import{_ as w}from"./version-compare.vue_vue_type_script_setup_true_lang.js?v=1763689792";import{x as g,hW as k,hX as j,b as y,hF as C,R as q,u as D,hy as H}from"./utils-lib.js?v=1763689792";import{u as W}from"./column.js?v=1763689792";import{aJ as F}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const O=e({name:"BtCard",props:{...t},setup:(e,{attrs:t,slots:r})=>()=>{return s(n,a(t,e),"function"==typeof(l=r)||"[object Object]"===Object.prototype.toString.call(l)&&!i(l)?r:{default:()=>[r]});var l}}),{request:S}=y(),T=l("VHOST-STORAGE-STORE",()=>{const e=o({device:"",mountpoint:"",fstype:"",total:0,used:0,free:0,used_percent:0,inodes_total:0,inodes_used:0,inodes_free:0,inodes_used_percent:0,is_group_quota:!1,is_user_quota:!1,is_default:!1,account_allocate:0,account_percent:0}),t=o(0),a=o(!1),n=o([{label:"挂载点",prop:"mountpoint",minWidth:120},{label:"装置",prop:"device",minWidth:120},{label:"磁盘配额",prop:"is_group_quota",minWidth:140,render:e=>e.is_user_quota?s("span",null,[c("是")]):s("div",null,[s("span",{class:"text-warning"},[c("否")]),c(" |")," ",s("span",{class:"text-primary cursor-pointer",onClick:()=>l(e)},[c("设置磁盘配额")])])},{label:"总大小",prop:"total",minWidth:60,render:e=>g(e.total)},{label:"已使用",prop:"used",minWidth:180,render:e=>{const t=Math.round(e.used_percent);return s(d,null,[s("div",{class:"mr-[10px]"},[t,c("% / "),g(e.used)]),s(b,{class:"w-[100px]",percentage:Number(t.toFixed(2)),"text-inside":!0,"stroke-width":14,status:i(t)},null)])}},W([{width:100,disabled:!0,isHide:e=>e.is_default&&!a.value,render:()=>s("span",null,[c("默认磁盘")])},{title:"重启服务",width:100,onClick:()=>F(),isHide:e=>e.is_default&&!a.value},{title:"设置默认磁盘",width:100,onClick:e=>u(e),isHide:e=>e.is_default&&!a.value}])]),i=e=>{const t=Math.round(e);return t>80?"exception":t>60?"warning":"success"},r=()=>{t.value=(new Date).getTime()},l=async e=>{const t=await k(e.mountpoint);await S(t),r()},u=async e=>{const t=await j({mountpoint:e.mountpoint});await S(t),r(),a.value=!0};return{defaultDiskInfo:e,columns:n,diskColor:i,refreshInfo:t,refreshList:r,getDiskList:async()=>{const{data:t}=await C();if(q(t)){const s=t.find(e=>e.is_default);if(s){const t={...s};t.account_percent=Math.round(t.account_allocate/t.total*100),e.value=t}return{data:t,total:t.length}}return{data:[],total:0}}}}),I={class:"p-[10px]"},B={class:"flex items-center mb-[16px]"},L={class:"flex-1"},M={class:"flex items-center mb-[16px]"},N={class:"flex-1"},R={class:"flex items-center mb-[16px]"},A={class:"flex w-[50rem]"},E={class:"mr-[2rem] max-w-[20rem] w-[16rem]"},G={class:"flex-1"},z={class:"flex items-center mb-[16px]"},J={class:"flex w-[50rem]"},P={class:"mr-[2rem] max-w-[20rem] w-[16rem]"},U={class:"flex-1"},V={key:0,class:"text-center text-danger"},X=e({__name:"index",setup(e){const{mainHeight:t}=D(),{columns:a,getDiskList:n,defaultDiskInfo:i,diskColor:l,refreshInfo:o}=(()=>{const e=T(),t=r(e);return{...e,...t}})(),{BtTable:c,refresh:d}=H({request:n,columns:a.value});return u(()=>o.value,d),(e,a)=>{const n=b,r=O;return p(),m("div",null,[s(w),s(r,{class:"!border-none mb-[20px]"},{header:x(()=>[...a[0]||(a[0]=[f("div",{class:"card-header"},[f("span",null,"预设存储盘")],-1)])]),default:x(()=>[a[5]||(a[5]=f("div",{class:"p-[16px] text-base"},"创建用户时，用户信息将存储在此空间中",-1)),f("div",I,[f("div",B,[a[1]||(a[1]=f("div",{class:"w-[150px] font-black text-base text-right h-[24px]"},"默认磁盘配额：",-1)),f("div",L,_(h(i).mountpoint),1)]),f("div",M,[a[2]||(a[2]=f("div",{class:"w-[150px] font-black text-base text-right h-[24px]"},"装配：",-1)),f("div",N,_(h(i).device),1)]),f("div",R,[a[3]||(a[3]=f("div",{class:"w-[150px] font-black text-base text-right h-[24px]"},"已使用：",-1)),f("div",A,[f("div",E,_(h(g)(h(i).used))+"/ "+_(h(g)(h(i).total)),1),f("div",G,[s(n,{percentage:Number(h(i).used_percent.toFixed(2)),"text-inside":"","stroke-width":18,status:h(l)(h(i).used_percent)},null,8,["percentage","status"])])])]),f("div",z,[a[4]||(a[4]=f("div",{class:"w-[150px] font-black text-base text-right h-[24px]"},"已分配：",-1)),f("div",J,[f("div",P,_(h(g)(h(i).account_allocate))+"/ "+_(h(g)(h(i).total)),1),f("div",U,[s(n,{percentage:Number((h(i).account_allocate/h(i).total*100).toFixed(2)),"text-inside":"","stroke-width":18,status:h(l)(h(i).account_percent)},null,8,["percentage","status"]),h(i).account_percent>100?(p(),m("div",V,"PS:您的空间分配已达上限")):v("",!0)])])])])]),_:1}),s(r,{class:"!border-none"},{header:x(()=>[...a[6]||(a[6]=[f("div",{class:"card-header"},[f("span",null,"可用存储盘")],-1)])]),default:x(()=>[s(h(c),{class:"mt-[16px]","min-height":h(t)},null,8,["min-height"])]),_:1})])}}});export{X as default};
