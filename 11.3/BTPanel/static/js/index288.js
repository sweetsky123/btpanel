import{_ as e}from"./index109.js?v=1763689792";import{_ as a}from"./index118.js?v=1763689792";import{c as t,r as l,o as n,v as o,a8 as s,I as d,x as r,y as c,e as i,C as m,z as u,D as p,O as y,A as _,G as v,J as w,B as f,F as k,b1 as h,H as b,aZ as x,ax as A,am as C,an as D,az as g}from"./base-lib.js?v=1763689792";import{_ as V}from"./index110.js?v=1763689792";import{p as I,b as R,as as j,R as M,P as U,k as X,_ as T}from"./utils-lib.js?v=1763689792";import{_ as z}from"./index130.js?v=1763689792";import{u as N,B as $}from"./column.js?v=1763689792";import{F as E}from"./ssl.js?v=1763689792";import{g as W}from"./useStore5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const F={class:"px-1.6rem py-1rem"},O={key:0,class:"p-1rem"},q={class:"w-full hint-table"},L={key:1,class:"pl-[.8rem] text-secondary leading-[2.4rem]"},P={class:"w-full hint-table"},S={key:1},B={key:1},H={key:1},G={key:1},J={key:1},Z={key:0,class:"flex"},K=["onClick"],Q=["onClick"],Y=T(t({__name:"index",props:{compData:{type:Object,default:()=>{}}},setup(t){const T=R(),{refs:{isRefreshDomainList:Y}}=W(),ee=t,ae=l(!0),te=l(!1),le=l(!1),ne=l([]),oe=l([]),se=l("name"),de=l("prev, pager, next, sizes, total, jumper"),re=[{title:"A",key:"A"},{title:"TXT",key:"TXT"},{title:"CNAME",key:"CNAME"},{title:"MX",key:"MX"},{title:"CAA",key:"CAA"},{title:"AAAA",key:"AAAA"}],ce=n({dns_id:"",domain_name:"",record_type:"A",fun_name:"get_dns_record",search:"",p:1,limit:10,total:0}),ie=n({dns_id:"",domain_name:"",record_type:"",fun_name:"delete_dns_record",RecordId:""}),me=n({dns_id:"",domain_name:"",fun_name:"set_dns_record_status",status:1,RecordId:""}),ue=l(!1),pe=l([]);N([{onClick:e=>{he(e)},title:"删除"}]);const ye=e=>{const a=Math.floor(e/3600),t=Math.floor(e%3600/60),l=e%60;return"".concat(a>0?a+"小时":"").concat(t>0?t+"分钟":"").concat(l>0?l+"秒":"")},_e=async(e=1,a=10)=>{ce.p=e||1,ce.limit=a||10;try{if(te.value)return T.error("请先保存当前修改的数据，再进行其他操作！");ue.value=!0;const e=ce.search&&ce.search.trim();e&&(ce.p=1,ce.limit=100);const{data:a}=await E(ce),{list:t}=a;pe.value=t,ne.value=j(t),ae.value=!M(t),e?(ce.total=(null==t?void 0:t.length)||0,de.value="prev, pager, next, total"):(ce.total=Number(a.info.record_total)||0,de.value="prev, pager, next, sizes, total, jumper")}catch(t){}finally{ue.value=!1}},ve=e=>{se.value=e,pe.value=j(pe.value)},we=(e,a)=>{var t,l;let n=j(ne.value);const o=null==(l=null==(t=null==n?void 0:n.find(e=>e.RecordId===pe.value[0].RecordId))?void 0:t[a])?void 0:l.split(".");pe.value[0][a]="2"==e?o?o[0]:"abc":e},fe=(e,a)=>{te.value=!1,le.value=!1,se.value="name",oe.value=[],pe.value=j(ne.value)},ke=()=>ae.value?T.error("此域名配置的dns账号不正确"):te.value?T.error("请先保存当前修改的数据，再进行其他操作！"):(te.value=!0,le.value=!0,oe.value=[0],void pe.value.unshift({RecordId:0,name:"",type:"A",line:"default",value:"",ttl:600,status:"启用",remark:"",mx:0})),he=async e=>{if(te.value)return T.error("请先保存当前修改的数据，再进行其他操作！");ie.record_type=e.type,ie.domain_name=e.name,ie.RecordId=e.RecordId,await I({title:"删除【".concat(e.name,"】"),content:"删除该子域名，是否继续操作？",icon:"warning"});try{const e=T.load("正在删除子域名，请稍候..."),a=await E(ie);e&&e.close(),T.request(a),a.status&&(await _e(ce.p,ce.limit),Y.value=!0)}catch(a){}};return o(()=>{var e;(null==(e=ee.compData.row)?void 0:e.dns_id)&&(ce.dns_id=ee.compData.row.dns_id,ce.domain_name=ee.compData.row.domain,ie.dns_id=ee.compData.row.dns_id,me.dns_id=ee.compData.row.dns_id,_e())}),s(()=>{sessionStorage.removeItem("undefined_row")}),(l,n)=>{const o=b,s=x,I=U,R=z,j=A,M=X,N=C,W=D,ne=V,ie=g,be=a,xe=e,Ae=d("bt-loading");return r(),c("div",F,[i(xe,null,{"header-left":m(()=>[i(o,{type:"primary",onClick:ke,disabled:u(ae)},{default:m(()=>[...n[16]||(n[16]=[p("添加",-1)])]),_:1},8,["disabled"]),"WestDns"===t.compData.row.dns.dns_name?(r(),y(s,{key:0,type:"warning",class:"h-[100%] !ml-[1rem]",closable:!1,"show-icon":""},{title:m(()=>[...n[17]||(n[17]=[_("span",{class:"text-base"},[_("span",null," 提示：WestDns 西部数码不支持修改解析记录的主机记录和记录类型")],-1)])]),_:1})):v("",!0)]),"header-right":m(()=>[i(I,{modelValue:u(ce).search,"onUpdate:modelValue":n[0]||(n[0]=e=>u(ce).search=e),placeholder:"请输入主机记录",onSearch:_e,class:"!mr-[.8rem] !w-[23rem]"},null,8,["modelValue"]),i(R,{onRefresh:_e,class:"!mr-[.8rem]"})]),content:m(()=>[w((r(),y(ie,{class:"w-full sub-domain-table",data:u(pe),"row-key":"RecordId","expand-row-keys":u(oe),"max-height":550},{empty:m(()=>[p(f(u(ae)?"此域名配置的dns账号不正确":"列表为空"),1)]),default:m(()=>[i(j,{type:"expand",width:"1","min-width":"1"},{default:m(()=>[u(te)?(r(),c("div",O,["name"===u(se)?(r(),c(k,{key:0},[n[23]||(n[23]=_("div",{class:"text-secondary pl-[.8rem]"},[p("要解析www.bt.cn，请填写www。主机记录就是域名前缀，"),_("span",{class:"text-warning font-bold"},"点击下列选项可自行填充"),p("：")],-1)),_("table",q,[_("tbody",null,[_("tr",{onClick:n[1]||(n[1]=e=>we("www","name"))},[...n[18]||(n[18]=[_("th",null,"www",-1),_("td",{class:"text-secondary"},"解析后的域名为www.bt.cn",-1)])]),_("tr",{onClick:n[2]||(n[2]=e=>we("@","name"))},[...n[19]||(n[19]=[_("th",null,"@",-1),_("td",{class:"text-secondary"},"直接解析主域名bt.cn",-1)])]),_("tr",{onClick:n[3]||(n[3]=e=>we("*","name"))},[...n[20]||(n[20]=[_("th",null,"*",-1),_("td",{class:"text-secondary"},"泛解析，匹配其他所有域名*.bt.cn",-1)])]),_("tr",{onClick:n[4]||(n[4]=e=>we("mail","name"))},[...n[21]||(n[21]=[_("th",null,"mail",-1),_("td",{class:"text-secondary"},"将域名解析为mail.bt.cn，通常用于解析邮箱服务器",-1)])]),_("tr",{onClick:n[5]||(n[5]=e=>we("2","name"))},[...n[22]||(n[22]=[_("th",null,"二级域名",-1),_("td",{class:"text-secondary"},"如：abc.bt.cn，填写abc",-1)])])])])],64)):"type"===u(se)?(r(),c("div",L,[n[30]||(n[30]=_("div",null,"将域名指向云服务器，请选择「A」",-1)),n[31]||(n[31]=_("div",null,"将域名指向另一个域名，请选择「CNAME」",-1)),n[32]||(n[32]=_("div",null,"建立邮箱请选择「MX」，根据邮箱服务商提供的MX记录",-1)),_("table",P,[_("tbody",null,[_("tr",{onClick:n[6]||(n[6]=e=>we("A","type"))},[...n[24]||(n[24]=[_("th",null,"A",-1),_("td",{class:"text-secondary"},"将域名指向IPv4地址",-1)])]),_("tr",{onClick:n[7]||(n[7]=e=>we("CNAME","type"))},[...n[25]||(n[25]=[_("th",null,"CNAME",-1),_("td",{class:"text-secondary"},"将域名指向另外一个域名",-1)])]),_("tr",{onClick:n[8]||(n[8]=e=>we("MX","type"))},[...n[26]||(n[26]=[_("th",null,"MX",-1),_("td",{class:"text-secondary"},"如果需要设置邮箱，让邮箱能收到邮件，就需要添加MX记录。",-1)])]),_("tr",{onClick:n[9]||(n[9]=e=>we("TXT","type"))},[...n[27]||(n[27]=[_("th",null,"TXT",-1),_("td",{class:"text-secondary"},"设置文本记录",-1)])]),_("tr",{onClick:n[10]||(n[10]=e=>we("CAA","type"))},[...n[28]||(n[28]=[_("th",null,"CAA",-1),_("td",{class:"text-secondary"},"CA证书颁发机构授权校验",-1)])]),_("tr",{onClick:n[11]||(n[11]=e=>we("AAAA","type"))},[...n[29]||(n[29]=[_("th",null,"AAAA",-1),_("td",{class:"text-secondary"},"用来指定主机名（或域名）对应的IPv6地址（例如：ff06:0:0:0:0:0:0:c3）记录。",-1)])])])])])):v("",!0)])):v("",!0)]),_:1}),i(j,{label:"主机记录",prop:"name"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),y(M,{key:0,class:"record-name-input",disabled:"WestDns"===t.compData.row.dns.dns_name&&!u(le),modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,type:"text",size:"small",placeholder:"根据下方提示填写",title:"".concat(e.name,".").concat(ee.compData.row.domain),onFocus:n[12]||(n[12]=e=>ve("name"))},{append:m(()=>[p(f(".".concat(t.compData.row.domain)),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","title"])):(r(),c("span",S,f(e.name),1))]),_:1}),i(j,{label:"记录类型",prop:"type",width:"100"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),y(W,{key:0,onFocus:n[13]||(n[13]=e=>ve("type")),size:"small",disabled:"WestDns"===t.compData.row.dns.dns_name&&!u(le),modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,class:"!w-[8rem]",placeholder:"请选择",onChange:a=>((e,a)=>{a.type=e})(a,e)},{default:m(()=>[(r(),c(k,null,h(re,e=>i(N,{key:e.key,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["disabled","modelValue","onUpdate:modelValue","onChange"])):(r(),c("span",B,f(e.type),1))]),_:1}),i(j,{label:"解析请求来源",prop:"line",width:"100"},{default:m(({row:e})=>[_("span",null,f("default"===e.line?"默认":e.line),1)]),_:1}),i(j,{label:"记录值",prop:"value"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),y(M,{key:0,modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"text",placeholder:"必填",size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(r(),c("span",H,f(e.value),1))]),_:1}),i(j,{label:"TTL",prop:"ttl",width:"100"},{default:m(({row:e})=>[_("span",null,f(ye(e.ttl)),1)]),_:1}),i(j,{label:"状态",prop:"status",width:"80"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),c("span",G,"-")):(r(),y(u($),{key:0,data:["暂停","启用"],modelValue:"启用"===e.status,onClick:a=>(async e=>{let a;try{me.RecordId=e.RecordId,me.status="启用"===e.status?1:0,me.domain_name=e.name.indexOf(ee.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(ee.compData.row.domain),a=T.load("正在修改状态，请稍候...");const t=await E(me);T.request(t),t.status&&(fe(),await _e(ce.p,ce.limit))}catch(t){}finally{a&&a.close()}})(e)},null,8,["modelValue","onClick"]))]),_:1}),i(j,{label:"备注",prop:"remark",width:"120"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),y(M,{key:0,disabled:"WestDns"===t.compData.row.dns.dns_name,modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a,type:"text",size:"small",placeholder:"请输入备注"},null,8,["disabled","modelValue","onUpdate:modelValue"])):(r(),c("span",J,f(e.remark),1))]),_:1}),i(j,{label:"操作",width:"140",align:"right"},{default:m(({row:e,$index:a})=>[u(te)&&0==a?(r(),c("div",Z,[i(o,{type:"primary",onClick:a=>(async e=>{if(!e.name)return void T.error("主机记录不能为空");if(!e.value)return void T.error("记录值不能为空");const a=T.load("正在修改子域名，请稍候...");let t={fun_name:"update_dns_record",dns_id:ee.compData.row.dns_id,domain_name:e.name.indexOf(ee.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(ee.compData.row.domain),domain_dns_value:e.value,record_type:e.type,RecordId:e.RecordId,mx:e.mx,RecordLine:e.line,remark:e.remark};0===t.RecordId&&(delete t.RecordId,t.fun_name="create_dns_record");try{const e=await E(t);a&&a.close(),T.request(e),e.status&&(te.value=!1,le.value=!1,se.value="name",oe.value=[],await _e(ce.p,ce.limit),Y.value=!0)}catch(l){}})(e)},{default:m(()=>[...n[33]||(n[33]=[p("保存",-1)])]),_:1},8,["onClick"]),i(o,{type:"default",onClick:e=>fe()},{default:m(()=>[...n[34]||(n[34]=[p("取消",-1)])]),_:1},8,["onClick"])])):(r(),c(k,{key:1},[_("span",{class:"bt-link cursor-pointer",onClick:t=>((e,a)=>{if(te.value)return T.error("请先保存当前修改的数据，再进行其他操作！");if(te.value=!0,oe.value=[e.RecordId],0!==a){let t=e.name.replace(".".concat(ee.compData.row.domain),"");const l=pe.value[0];e.name.replace(".".concat(ee.compData.row.domain),"")===e.name&&(t="@"),pe.value[0]={...e,name:t},pe.value[a]=l}else pe.value[0]={...e,name:e.name.replace(".".concat(ee.compData.row.domain),"")}})(e,a)},"修改",8,K),i(ne),_("span",{class:"bt-link cursor-pointer",onClick:a=>he(e)},"删除",8,Q)],64))]),_:1})]),_:1},8,["data","expand-row-keys"])),[[Ae,u(ue)],[Ae,"正在加载子域名列表，请稍后...","title"]])]),"footer-right":m(()=>[i(be,{layout:u(de),page:u(ce).p,"onUpdate:page":n[14]||(n[14]=e=>u(ce).p=e),row:u(ce).limit,"onUpdate:row":n[15]||(n[15]=e=>u(ce).limit=e),total:u(ce).total,"use-storage":!1,onChange:_e},null,8,["layout","page","row","total"])]),_:1})])}}}),[["__scopeId","data-v-af71dc79"]]);export{Y as default};
