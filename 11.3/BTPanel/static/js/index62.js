import{_ as a}from"./index109.js?v=1763689792";import{_ as t}from"./index118.js?v=1763689792";import{H as e,x as n,fW as s,M as i,p as o,fX as l,fb as r,R as u,f8 as m,u as c,n as d,fY as _,ak as p,aA as v,fZ as f,B as w,f_ as g,f$ as b,l as h}from"./utils-lib.js?v=1763689792";import{j as y,aH as E,o as M,e as C,D as O,ap as P,r as q,s as A,a9 as L,aE as k,c as j,n as D,a8 as x,I,x as T,O as R,C as V,z,J as B,H as S}from"./base-lib.js?v=1763689792";import{a as W,b as G,g as H}from"./useMethod9.js?v=1763689792";import{i as U,u as F}from"./column.js?v=1763689792";const X=y("MAIL_MAILBOX",()=>{const a=E(),t=M({p:1,size:10}),l=W("添加邮箱",{isEdit:!1,row:void 0,onRefresh:async()=>{const{getList:a}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);a()}}),r=M({id:0,site_name:"",status:!1,ssl_status:!1}),{table:u,columns:m}=G([{prop:"username",label:"用户名",showOverflowTooltip:!0},U(),{prop:"info",label:"登录信息",width:180,render:a=>C("a",{class:"bt-link",href:"javascript:;",onClick:async()=>{const{onCopy:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}},[O("复制")])},{prop:"quota",label:"邮箱配额",render:a=>n(a.quota)},{prop:"is_admin",label:"类型",render:a=>1===a.is_admin?"管理员":"普通用户"},{prop:"active",label:"状态",render:a=>C(P,{modelValue:a.active,"onUpdate:modelValue":t=>a.active=t,size:"small",activeValue:1,inactiveValue:0,onChange:async t=>{const{data:e}=await s({username:a.username,full_name:a.full_name,quota:n(a.quota),active:t,is_admin:a.is_admin});a.active=t,i.request(e)}},null)},F([{title:"WebMail",onClick:async t=>{if(r.status){const{onLogin:a}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);a(t)}else try{await o({title:"WebMail未激活",content:()=>C("div",null,[O('WebMail尚未激活，请前往"'),C("a",{class:"bt-link",href:"javascript:;",onClick:()=>{a.push("/mail/setting")}},[O("邮局 > 设置")]),O('" 激活并安装它')])}),a.push({name:"mail-setting"})}catch(n){}}},{title:"编辑",onClick:async a=>{const{onShowEdit:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}},{title:"删除",onClick:async a=>{const{onDel:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}}],{width:200,fixed:"right",label:"操作"})]);return{search:t,formModal:l,info:r,table:u,columns:m,reset:()=>{t.p=1,t.size=10,r.id=0,r.status=!1,r.ssl_status=!1,r.site_name="",l.data.row=void 0,l.data.isEdit=!1,u.data=[]}}}),Z=y("MAIL_MAILBOX_ADD",()=>{const a=q(null),t=M({full_name:"",domain:null,quota:5,quota_unit:"GB",is_admin:0,username:"",password:"",active:1}),e=q({}),o=q([]),m=()=>({full_name:t.full_name,quota:t.quota+" "+t.quota_unit,is_admin:t.is_admin,username:t.username+"@"+t.domain,password:t.password,active:t.active}),c=()=>{t.full_name="",t.domain=null,t.quota=5,t.quota_unit="GB",t.is_admin=0,t.username="",t.password="",t.active=1};return{form:t,domainOptions:o,unitOptions:[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],typeOptions:[{label:"普通用户",value:0},{label:"管理员",value:1}],rules:{full_name:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t||""===t.trim())return e(new Error("用户名不能为空!"));e()}}],username:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t||""===t.trim())return e(new Error("邮箱地址不能为空!"));e()}}],quota:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t)return e(new Error("邮箱配额大小不能为空!"));e()}}],password:[{trigger:["blur","input"],validator:(a,t,n)=>{if(e.value.isEdit){if(t){if(t.trim().length<8)return n(new Error("当前邮箱用户密码长度小于8位，请重新输入"));if(!/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(t))return n(new Error("当前邮箱用户密码必须至少包含大小写字母和数字，请重新输入"))}}else{if(!t||t.trim().length<8)return n(new Error("当前邮箱用户密码长度小于8位，请重新输入"));if(!/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(t))return n(new Error("当前邮箱用户密码必须至少包含大小写字母和数字，请重新输入"))}n()}}]},getParams:m,onConfirm:async()=>{var t;await(null==(t=a.value)?void 0:t.validate());try{let a;a=e.value.isEdit?await s(m()):await l(m());const{data:t}=a;if(i.request(t),!t.status)return!1;e.value.onRefresh&&e.value.onRefresh(),c()}catch(n){}},getDomainOptions:async()=>{const{data:a}=await r();u(a.data)&&(o.value=a.data.map(a=>({label:a,value:a})),null===t.domain&&(t.domain=a.data[0]))},initForm:a=>{const{row:s,isEdit:i}=a;if(e.value=a,c(),i&&s){t.full_name=s.full_name,t.is_admin=s.is_admin,t.username=s.username.split("@")[0],t.active=s.active;const[a,e]=s.username.split("@");t.username=a,t.domain=e;const i=n(s.quota),[o,l]=i.split(" ");t.quota=H(o),t.quota_unit=l}},formRef:a}}),{refs:{tabActive:$}}=m(),{formModal:J,info:Y,table:K,search:N}=A(X()),{onConfirm:Q}=Z(),{payment:aa}=c(),ta=()=>{J.value.data.isEdit=!1,J.value.data.row=void 0,J.value.title="添加邮箱",d({title:J.value.title,area:48,showFooter:!0,component:()=>e(()=>import("./index362.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:J.value.data,onConfirm:Q})},ea=()=>{const a=E();return{onLoginMail:async()=>{if(!Y.value.site_name)return i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,type:"error",message:k("div",{class:"flex items-center leading-3rem mt-[4px]"},["请先在【系统设置】-【WebMail】中配置",k("span",{class:"bt-link",onClick:()=>{a.push("/mail/setting"),$.value="mail-setting"}}," WebMail")]),showClose:!0});window.open("".concat(Y.value.ssl_status?"https":"http","://").concat(Y.value.site_name),"_blank","noopener,noreferrer")}}},na=async()=>{const{data:a}=await f();p(a)&&(Y.value.id=a.id,Y.value.status=a.status,Y.value.site_name=a.site_name,Y.value.ssl_status=a.ssl_status)},sa=async()=>{try{K.value.loading=!0;const{data:a}=await _(L(N.value));p(a.data)&&(K.value.data=u(a.data.data)?a.data.data:[],K.value.total=v(a.data.page))}finally{K.value.loading=!1}},ia=async()=>{try{K.value.loading=!0,await na(),await sa()}finally{K.value.loading=!1}},oa=Object.freeze(Object.defineProperty({__proto__:null,getInfo:na,getList:sa,init:ia,onCopy:a=>{w({value:"WebMail: ".concat(Y.value.site_name?"".concat(Y.value.ssl_status?"https":"http","://").concat(Y.value.site_name):"未配置WebMail","\n用户名: ").concat(a.username,"\n密码: ").concat(a.password,"\nPOP 服务 [ 地址：").concat(a.mx," 端口：110/995 ]\nIMAP 服务 [ 地址：").concat(a.mx," 端口：143/993 ]\nSMTP 服务 [ 地址：").concat(a.mx," 端口：25/465/587 ]\n")})},onDel:async a=>{try{await o({title:"删除邮箱",content:"是否删除【".concat(a.username,"】邮箱?")});const{data:t}=await b({username:a.username});i.request(t),sa()}catch(t){}},onLogin:async a=>{if("ltd"!==aa.value.authType)return i.warn("请先购买企业版");const{data:t}=await g({rc_user:a.username,rc_pass:a.password});p(t)&&window.open("".concat(Y.value.ssl_status?"https":"http","://").concat(t.data),"_blank","noopener,noreferrer")},onShowAdd:ta,onShowEdit:a=>{J.value.data.isEdit=!0,J.value.data.row=a,J.value.title="编辑邮箱 【".concat(a.username,"】"),d({title:J.value.title,area:48,showFooter:!0,component:()=>e(()=>import("./index362.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:J.value.data,onConfirm:Q})},useMailMethods:ea},Symbol.toStringTag,{value:"Module"})),la=j({__name:"index",setup(e){const{onLoginMail:n}=ea(),{search:s,table:i,columns:o}=A(X()),{reset:l}=X();return D(()=>{ia()}),x(()=>{l()}),(e,l)=>{const r=S,u=h,m=t,c=a,d=I("bt-loading");return T(),R(c,null,{"header-left":V(()=>[C(r,{type:"primary",onClick:z(ta)},{default:V(()=>[...l[2]||(l[2]=[O("添加邮箱",-1)])]),_:1},8,["onClick"]),C(r,{onClick:z(n)},{default:V(()=>[...l[3]||(l[3]=[O("WebMail",-1)])]),_:1},8,["onClick"])]),content:V(()=>[B(C(u,{data:z(i).data,column:z(o)},null,8,["data","column"]),[[d,z(i).loading]])]),"footer-right":V(()=>[C(m,{page:z(s).p,"onUpdate:page":l[0]||(l[0]=a=>z(s).p=a),row:z(s).size,"onUpdate:row":l[1]||(l[1]=a=>z(s).size=a),total:z(i).total,onChange:z(sa)},null,8,["page","row","total","onChange"])]),_:1})}}}),ra=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{Z as M,ra as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
