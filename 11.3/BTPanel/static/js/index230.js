import{c as a,r as e,W as s,g as l,v as r,x as t,y as d,e as o,C as u,z as i,F as m,b1 as n,O as p,D as c,S as _,U as v,ad as b,am as f,an as g,ab as j}from"./base-lib.js?v=1763689792";import{y as h,Q as y,M as x,aK as w,e as V,_ as k}from"./utils-lib.js?v=1763689792";import{addModulesDatabase as C}from"./database.js?v=1763689792";import{g as D}from"./useStore2.js?v=1763689792";import{a as M,m as S}from"./useMethod4.js?v=1763689792";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";const q={class:"p-[24px]"},A=k(a({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(a,{expose:k}){const A=a,{refs:{tabActive:F},refreshTableList:I}=D(),z=e(),H=s(!1),K=e({name:"",db_user:"",password:h(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MongoDb",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),L=e([]),O={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}]},Q=l(()=>{var a;return(null==(a=L.value.find(a=>a.id===K.value.sid))?void 0:a.db_host)||""}),R=a=>{K.value.db_user=a,K.value.ps=a},T=async()=>{try{H.value=!0;const{db_status:a,msg:e,err_msg:s}=await S(K.value.sid);return a?(H.value=!1,!0):(x.error(s||e),!1)}catch(a){w(a)}};return r(async()=>{var a,e;L.value=await(null==(a=A.compData)?void 0:a.refresh())||[],K.value.sid=null==(e=L.value[0])?void 0:e.id}),k({onConfirm:async a=>{await z.value.validate();if(!(await T()))return!1;await y({loading:"正在添加数据库, 请稍后...",request:C(K.value,F.value),message:!0,success:e=>{e.status&&(a(),I())}})}}),(a,e)=>{const s=v,l=b,r=f,h=g,y=V,x=j;return t(),d("div",q,[o(x,{disabled:i(H),model:i(K),ref_key:"addFormRef",ref:z,rules:O,onSubmit:e[2]||(e[2]=_(()=>{},["prevent"]))},{default:u(()=>[o(l,{label:"数据库名",prop:"name"},{default:u(()=>[o(s,{class:"w-[38rem]",ref:"data_name",placeholder:"新的数据库名称",modelValue:i(K).name,"onUpdate:modelValue":e[0]||(e[0]=a=>i(K).name=a),onInput:R},null,8,["modelValue"])]),_:1}),o(l,{label:"添加至",prop:"sid",class:"!mb-0"},{default:u(()=>[o(h,{class:"!w-[24rem]",modelValue:i(K).sid,"onUpdate:modelValue":e[1]||(e[1]=a=>i(K).sid=a)},{default:u(()=>[(t(!0),d(m,null,n(i(L),(a,e)=>(t(),p(r,{key:e,label:a.ps+(a.db_host?"（"+a.db_host+"）":""),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(y,{class:"ml-[8px]",onClick:i(M)},{default:u(()=>[...e[3]||(e[3]=[c("管理远程数据库",-1)])]),_:1},8,["onClick"])]),_:1}),o(l,{label:" ",class:"!mb-0"},{default:u(()=>[o(U,{server:{sid:i(K).sid,ip:i(Q)}},null,8,["server"])]),_:1})]),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-d25589f5"]]);export{A as default};
