import{M as a,aK as e,Q as s,p as t,L as r,$ as l,_ as o,aC as n}from"./utils-lib.js?v=1763689792";import{j as i,r as u,c,s as d,g as m,e as _,D as p,v,x as w,y as b,z as N,A as g,C as f,H as h,aE as y,J as E,K as D,a8 as x,R as q}from"./base-lib.js?v=1763689792";import{b as S,o as I,d as O,j,F as C}from"./form-item.js?v=1763689792";import{getDatabaseTimeOut as R,setDatabaseTimeOut as F,getDatabasePasswordConfig as k,setDatabasePasswordConfig as T,getDatabaseLoginLimit as L,setDatabaseLoginLimit as B}from"./database.js?v=1763689792";import{g as M}from"./useStore2.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const G=i("DATABASE-MYSQL-ADVANCED-REINFORCE-STORE",()=>{const r=u({default_password_lifetime:"90",expire_logs_days:"180",interactive_timeout:"300",wait_timeout:"300"}),l=u({validate_password_length:"",validate_password_mixed_case_count:"",validate_password_number_count:"",validate_password_policy:"STRONG",validate_password_special_char_count:"",status:!1,oldStatus:!1}),o=u({connection_control_failed_connections_threshold:"5",connection_control_max_connection_delay:"1800000",connection_control_min_connection_delay:"2147483647",status:!1,oldStatus:!1});return{resetData:()=>{r.value.default_password_lifetime="",r.value.expire_logs_days="",r.value.interactive_timeout="",r.value.wait_timeout="",l.value.validate_password_length="",l.value.validate_password_mixed_case_count="",l.value.validate_password_number_count="",l.value.validate_password_policy="STRONG",l.value.validate_password_special_char_count="",l.value.status=!1,l.value.oldStatus=!1,o.value.connection_control_failed_connections_threshold="5",o.value.connection_control_max_connection_delay="1800000",o.value.connection_control_min_connection_delay="2147483647",o.value.status=!1,o.value.oldStatus=!1},getBaseData:async()=>{var s,t,l,o;try{const e=await R();if(!e.status)return void a.error(e.msg);if("{}"===JSON.stringify(e.data))return void a.error("数据库状态异常");r.value.default_password_lifetime=null==(s=e.data)?void 0:s.default_password_lifetime,r.value.expire_logs_days=null==(t=e.data)?void 0:t.expire_logs_days,r.value.interactive_timeout=null==(l=e.data)?void 0:l.interactive_timeout,r.value.wait_timeout=null==(o=e.data)?void 0:o.wait_timeout}catch(n){e(n)}},baseFormData:r,setBaseData:async a=>{try{s({loading:"正在设置，请稍后...",message:!0,request:F(a)})}catch(t){e(t)}},passwordFormData:l,getPasswordData:async()=>{try{const a=await s({loading:"正在获取数据，请稍后...",request:k()});a.status?(l.value.validate_password_length=a.data.validate_password_length||"10",l.value.validate_password_mixed_case_count=a.data.validate_password_mixed_case_count||"",l.value.validate_password_number_count=a.data.validate_password_number_count||"",l.value.validate_password_policy=a.data.validate_password_policy||"STRONG",l.value.validate_password_special_char_count=a.data.validate_password_special_char_count||"",l.value.status="ON"===a.data.status||"on"===a.data.status,l.value.oldStatus="ON"===a.data.status||"on"===a.data.status):e(a)}catch(a){e(a)}},setPasswordData:async a=>{try{if(!a.status){try{await t({title:"关闭密码复杂度验证",content:"关闭后将不会进行密码复杂度验证，是否继续操作！"}),s({loading:"正在关闭，请稍后...",message:!0,request:T({...a,status:a.status?"on":"off"}),success:a=>{a.status||(l.value.status=!0)}})}catch(r){l.value.status=!0}return}s({loading:"正在保存，请稍后...",message:!0,request:T({...a,status:a.status?"on":"off"})})}catch(r){e(r)}},limitFormData:o,getLimitData:async()=>{try{const a=await s({loading:"正在获取数据，请稍后...",request:L()});a.status?(o.value.connection_control_failed_connections_threshold=a.data.connection_control_failed_connections_threshold||"",o.value.connection_control_max_connection_delay=a.data.connection_control_max_connection_delay||"1800000",o.value.connection_control_min_connection_delay=a.data.connection_control_min_connection_delay||"2147483647",o.value.status="ON"===a.data.status||"on"===a.data.status,o.value.oldStatus="ON"===a.data.status||"on"===a.data.status):e(a)}catch(a){e(a)}},setLimitData:async a=>{try{if(!a.status){try{await t({title:"关闭登录限制",content:"关闭后将不会进行登录次数限制，是否继续操作！"}),s({loading:"正在关闭，请稍后...",message:!0,request:B({...a,status:a.status?"on":"off"}),success:a=>{a.status||(o.value.status=!0)}})}catch(r){o.value.status=!0}return}s({loading:"正在保存，请稍后...",message:!0,request:B({...a,status:a.status?"on":"off"})})}catch(r){e(r)}}}}),A={class:"p-[2rem]"},P={class:"flex justify-end pr-[28rem]"},U=o(c({__name:"reinforce-base",setup(a,{expose:e}){const s=G(),{baseFormData:t}=d(s),{getBaseData:o,setBaseData:n}=s,i=[{content:"设置180天日志可能会占用大量磁盘空间，请注意是否留有充足空间"},{content:"设置密码到期后需及时更新密码，否则mysq|将连接异常"},{content:"以上均为等保默认推荐值"}],{BtForm:u,submit:c}=r({data:()=>t.value,options:a=>m(()=>[S("日志保存时间","expire_logs_days",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("天"),_("span",{class:"ml-[1.5rem]"},[p("建议180天")])])},attrs:{class:"!w-[20rem]",placeholder:"日志保存时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的日志保存时间")):Number.isInteger(Number(e))?Number(e)<1?s(new Error("请输入正确的日志保存时间")):s():s(new Error("请输入正确的日志保存时间"))},trigger:"blur"}]}),S("等待超时时间","wait_timeout",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("秒"),_("span",{class:"ml-[1.5rem]"},[p("建议300秒")])])},attrs:{class:"!w-[20rem]",placeholder:"等待超时时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的等待超时时间")):Number.isInteger(Number(e))?Number(e)<1?s(new Error("请输入正确的等待超时时间")):s():s(new Error("请输入正确的等待超时时间"))},trigger:"blur"}]}),S("命令行超时设置","interactive_timeout",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("秒"),_("span",{class:"ml-[1.5rem]"},[p("建议300秒")])])},attrs:{class:"!w-[20rem]",placeholder:"命令行超时时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的命令行超时时间")):Number.isInteger(Number(e))?Number(e)<1?s(new Error("请输入正确的命令行超时时间")):s():s(new Error("请输入正确的命令行超时时间"))},trigger:"blur"}]}),S("密码到期时间","default_password_lifetime",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("天"),_("span",{class:"ml-[1.5rem]"},[p("建议90天,")]),_("span",{class:"text-dangerDark"},[p("请先重置mysql root密码后 再设置密码到期时间")])])},attrs:{class:"!w-[45.2rem]",placeholder:"密码到期时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的密码到期时间")):Number.isInteger(Number(e))?Number(e)<1?s(new Error("密码到期时间最低设置1天")):s():s(new Error("请输入正确的密码到期时间"))},trigger:"blur"}]})]),submit:async(a,e,s)=>{await e(),n(a.value)}});return v(o),e({init:o}),(a,e)=>{const s=h,t=l;return w(),b("div",A,[_(N(u)),g("div",P,[_(s,{type:"primary",onClick:N(c)},{default:f(()=>[...e[0]||(e[0]=[p("保存",-1)])]),_:1},8,["onClick"])]),_(t,{class:"mt-[20rem]",options:i})])}}}),[["__scopeId","data-v-0af02144"]]),V={class:"p-[2rem]"},H={class:"flex justify-end pr-[18rem]"},W=o(c({__name:"reinforce-password",setup(a,{expose:e}){const s=G(),{passwordFormData:t}=d(s),{getPasswordData:o,setPasswordData:n}=s,i=[{content:'<span class="text-dangerDark">设置密码复杂度后 如不按照规则设置密码，可能无法正常创建数据库，修改用户密码/同步用户密码</span>',isHtml:!0},{content:"以上均为等保默认推荐值"},{content:()=>_("div",null,[p("密码验证强度类型："),_("div",null,[_("p",null,[p("LOW：只检查密码长度")]),_("p",null,[p("MEDIUM：检查长度、数字、大写字母、小写字母、特殊字符")]),_("p",null,[p("STRONG：检查长度、数字、大写字母、小写字母、特殊字符、字典文件")])])])}],{BtForm:u,submit:c,ref:x}=r({data:()=>t.value,options:a=>m(()=>[I("开启密码复杂度验证","status",{attrs:{onChange:async a=>{!a&&t.value.oldStatus&&n({status:!1})}}}),...a.value.status?[S("最短密码长度","validate_password_length",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议10位")])])},attrs:{class:"!w-[17.6rem]",placeholder:"最短密码长度"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的最短密码长度")):Number.isInteger(Number(e))?Number(e)<6?s(new Error("最短密码长度不能小于6")):s():s(new Error("请输入正确的最短密码长度"))},trigger:"blur"}]}),S("密码最少数字个数","validate_password_number_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"最少数字"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的密码最少数字个数")):Number.isInteger(Number(e))?s():s(new Error("请输入正确的密码最少数字个数"))},trigger:"blur"}]}),S("密码最少特殊字符个数","validate_password_special_char_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"最少特殊字符"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的密码最少特殊字符个数")):Number.isInteger(Number(e))?s():s(new Error("请输入正确的密码最少特殊字符个数"))},trigger:"blur"}]}),S("密码最少大小写英文字符个数","validate_password_mixed_case_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"大小写英文字符"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))?s(new Error("请输入正确的最少大小写英文字符个数")):Number.isInteger(Number(e))?s():s(new Error("请输入正确的最少大小写英文字符个数"))},trigger:"blur"}]}),O([j("密码验证强度","validate_password_policy",[{label:"LOW",value:"LOW"},{label:"MEDIUM",value:"MEDIUM"},{label:"STRONG",value:"STRONG"}],{attrs:{class:"!w-[11.1rem]",placeholder:"验证强度"},rules:[{required:!0,validator:(a,e,s)=>{""===e?s(new Error("请选择验证强度")):s()},trigger:"blur"}]}),C(()=>y("span",{class:"text-small text-secondary ml-[1.5rem] leading-[3.2rem]"},"建议设置为STRONG"),{key:"jump",rules:{}})])]:[]]),submit:async(a,e,s)=>{await e(),n(a.value)}});return v(()=>{o()}),e({init:o}),(a,e)=>{const s=h,r=l;return w(),b("div",V,[_(N(u),{class:"h-[30rem]"}),E(g("div",H,[_(s,{type:"primary",onClick:N(c)},{default:f(()=>[...e[0]||(e[0]=[p("保存",-1)])]),_:1},8,["onClick"])],512),[[D,N(t).status]]),E(_(r,{class:"mt-[4rem]",options:i},null,512),[[D,N(t).status]])])}}}),[["__scopeId","data-v-949fc655"]]),J={class:"p-[2rem]"},K={class:"flex justify-end pr-[18rem]"},Q=o(c({__name:"reinforce-limit",setup(a,{expose:e}){const s=G(),{limitFormData:t}=d(s),{getLimitData:o,setLimitData:n}=s,i=[{content:"以上均为等保默认推荐值"}],{BtForm:u,submit:c,ref:y}=r({data:()=>t.value,options:a=>m(()=>[I("开启限制登录","status",{attrs:{onChange:async a=>{!a&&t.value.oldStatus&&n({status:!1})}}}),...a.value.status?[S("验证错误锁定次数","connection_control_failed_connections_threshold",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("次"),_("span",{class:"ml-[.5rem]"},[p("密码错误超过设置次数后进行锁定")])])},attrs:{class:"!w-[35rem]",placeholder:"验证错误锁定次数"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?s(new Error("请输入正确的验证错误锁定次数")):s()},trigger:"blur"}]}),S("最小锁定时间","connection_control_min_connection_delay",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("毫秒"),_("span",{class:"ml-[.5rem]"},[p("推荐1800000毫秒（5分钟）")])])},attrs:{class:"!w-[33.4rem]",placeholder:"最小锁定时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?s(new Error("请输入正确的密码最小锁定时间(毫秒)")):s()},trigger:"blur"}]}),S("最长锁定时间","connection_control_max_connection_delay",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",null,[p("毫秒")]),_("span",{class:"ml-[.5rem]"},[p("默认2147483647毫秒")])])},attrs:{class:"!w-[30rem]",placeholder:"最长锁定时间"},rules:[{required:!0,validator:(a,e,s)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?s(new Error("请输入正确的密码最长锁定时间")):s()},trigger:"blur"}]})]:[]]),submit:async(a,e,s)=>{await e(),n(a.value)}});return v(()=>{o()}),e({init:o}),(a,e)=>{const s=h,r=l;return w(),b("div",J,[_(N(u),{class:"h-[20rem]"}),E(g("div",K,[_(s,{type:"primary",onClick:N(c)},{default:f(()=>[...e[0]||(e[0]=[p("保存",-1)])]),_:1},8,["onClick"])],512),[[D,N(t).status]]),E(_(r,{class:"mt-[24rem]",options:i},null,512),[[D,N(t).status]])])}}}),[["__scopeId","data-v-5aa3fbf4"]]),z=c({__name:"index",props:{compData:{default:"base"}},setup(a,{expose:e}){const s=G(),{resetData:t}=s;M();const r=a,l=u(),o=u(r.compData||"base"),i=[{label:"基础设置",name:"base",render:()=>_(U,null,null)},{label:"密码复杂度",name:"password",render:()=>_(W,null,null)},{label:"限制登录",name:"limit",render:()=>_(Q,null,null)}];return x(()=>{t()}),e({init:()=>{var a;const e=(null==(a=l.value)?void 0:a.getRef())||null;e&&e[o.value].init()}}),(a,e)=>{const s=n;return w(),b("div",null,[_(s,{ref_key:"reinforceTab",ref:l,class:"w-full h-full",modelValue:N(o),"onUpdate:modelValue":e[0]||(e[0]=a=>q(o)?o.value=a:null),options:i},null,8,["modelValue"])])}}});export{z as default};
