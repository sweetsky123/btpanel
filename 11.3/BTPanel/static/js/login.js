var e=Object.defineProperty,t=(t,o,n)=>(((t,o,n)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n})(t,"symbol"!=typeof o?o+"":o,n),n);function o(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}class n{constructor(){t(this,"autoLoginParams",{password:"",username:""})}static getLogoSrc(){var e;return(null==(e=window.vite_public_panel_theme)?void 0:e.login.logo)||"/static/icons/logo-green.svg"}checkAutoLogin(){return new Promise((e,t)=>{const o=new URL(window.location.href);if(""!==o.search){new URLSearchParams(o.search).forEach((e,t)=>{this.autoLoginParams[t]=e}),this.autoLoginParams.username&&this.autoLoginParams.password&&e(this.autoLoginParams)}})}bindEvent(e,t,o){e&&e.addEventListener?e.addEventListener(t,o,!1):e&&e.attachEvent?e.attachEvent("on".concat(t),o||null):e["on".concat(t)]=o||null}delegateEvent(e,t,o,n){"string"==typeof o&&e?e.addEventListener(t,function(e){const t=e.target.closest(o);this.contains(t)&&n&&n.call(t,e)},!1):"string"!=typeof o&&this.bindEvent(e,t,o)}convertType(e,t){if(typeof e===t)return e;if("string"===t)return String(e);if("number"===t)return Number(e);throw new Error("Unsupported target type: ".concat(t))}renderSelect(e){const{el:t,options:o,active:n,change:i,size:s}=e,r=document.createElement("div"),a=document.createElement("div");if(t.classList.add("form-select-module"),t.innerHTML="",s&&t.classList.add(s),a.classList.add("select-list"),o.length>0){let e=n;void 0===n&&(e=o[0].key);for(let t=0;t<o.length;t++){const n=document.createElement("div");n.classList.add("select-item"),"boolean"==typeof o[t].disabled&&o[t].disabled&&n.classList.add("disabled"),n.innerText=o[t].label,n.dataset.key=o[t].key,n.dataset.disabled="".concat(Number(o[t].disabled)),o[t].key===e&&(n.classList.add("active"),r.innerText=o[t].label),a.appendChild(n)}}r.classList.add("select-display"),t.appendChild(r),t.appendChild(a);const l=e=>{e.target.classList.contains("disabled")&&e.target.classList.contains("select-item")?this.message({message:"当前选项不可选",type:"error",time:2e3}):(t.classList.remove("active"),window.removeEventListener("click",l))};return this.delegateEvent(r,"click",e=>{e.stopPropagation(),t.classList.toggle("active"),t.classList.contains("active")?window.addEventListener("click",l):window.removeEventListener("click",l)}),this.delegateEvent(a,"click",".select-item",e=>{const n=e.target,{key:s,disabled:l}=n.dataset,c=n.innerText;if(Number(l))return;const d=o.findIndex(e=>e.key===this.convertType(s,typeof e.key));a.querySelectorAll(".select-item").forEach((e,t)=>{d===t?e.classList.add("active"):e.classList.remove("active")}),r.innerText=c,t.classList.remove("active"),s&&(t.dataset.key=s),i&&s&&i(s,d)}),window.removeEventListener("click",l),t.dataset.key}validateForm(e){const{rules:t}=e,o={},n={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){n[i]=document.querySelector('[name="'.concat(i,'"]'));const e=t[i];e.trigger&&e.trigger.forEach(s=>{let r=!1;o[i]=t=>{const o=n[t];return e.validator(o.value.trim(),function(e){var t,n,i,s,a;try{if(e)throw new Error(e);r=!1,null==(n=null==(t=o.parentElement)?void 0:t.querySelector(".error-tips"))||n.remove(),null==(i=o.parentElement)||i.classList.remove("error")}catch(l){const e=l.message.replace("Error: ",""),t=null==(s=o.parentElement)?void 0:s.querySelector(".error-tips");e&&(r=!0,null==(a=o.parentElement)||a.classList.add("error"),t?t.innerText=e:o.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(e,"</div>")))}}),!r||new Error("".concat(t,":").concat(n[t].value))},this.bindEvent(n[i],s,function(){if("isShow"in t[i]&&!t[i].isShow())return!0;const e=this.getAttribute("name");e&&o[e]&&o[e](e)})})}return e=>{let i=0;for(const r in o)if(Object.prototype.hasOwnProperty.call(o,r)){const e=o[r];try{if("isShow"in t[r]&&!t[r].isShow())continue;const o=e(r);if("object"==typeof o)throw o}catch(s){return i++,n[r].focus(),!1}}if(!i){const t={};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const o=n[e],{value:i}=o;t[e]=i.trim()}e(t)}}}handleTransformRequest(e){let t="";for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const n=e[o];t+="".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(n),"&")}return t=t.slice(0,-1),t}async request({url:e,data:t,method:o}={method:"post",data:{},url:""}){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open(o,e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.timeout=25e4,s.onreadystatechange=()=>{if(4===s.readyState)if(s.status>=200&&s.status<300)try{n({...s,data:JSON.parse(s.responseText)})}catch(e){n({...s,data:s.responseText,error:e})}else i(new Error(s.statusText))},s.ontimeout=()=>i(new Error("Request timed out")),s.onerror=()=>i(new Error("Network error")),s.send(this.handleTransformRequest(t))})}async rsaEncrypt(e){const{JSEncrypt:t}=window,o=window.vite_public_encryption;if(o.length<10)return e;const n=new t;return n.setPublicKey(o),n.encrypt(e)}async encryptionData(e){const{md5:t}=window;return e.username=await this.rsaEncrypt(t(t(e.username+window.vite_public_login_token))),e.password=await this.rsaEncrypt(t("".concat(t(e.password),"_bt.cn"))),e}removeEmpty(e){return Object.entries(e).reduce((e,[t,o])=>(null!=o&&""!==o&&(e[t]=o),e),{})}loading(e){const t=document.createElement("div");t.id="full-loading",t.className="el-loading-mask login-loading",t.style.cssText="background-color: rgba(0, 0, 0, 0.3); z-index: 3006;";const o=document.createElement("div");o.className="el-loading-spinner";const n=document.createElement("i");n.className="svgtofont-loading",n.innerHTML='\n\t\t\t<svg aria-hidden="true" style="color: var(--el-color-primary);"><use href="#icon-tools-logo"></use></svg>\n\t\t';const i=document.createElement("p");return i.className="el-loading-text",i.textContent=e,o.appendChild(n),o.appendChild(i),t.appendChild(o),window.document.body.appendChild(t),{close(){const e=document.getElementById("full-loading");e&&e.remove()}}}message({message:e,type:t,time:o=3e3,close:n=!1}){var i;null==(i=document.getElementById("el-message"))||i.remove();const s="success"===t?"circle-check-filled":"circle-close-filled",r='<div id="el-message" class="el-message el-message--'.concat(t,'" style="z-index: 4001;">\n\t\t\t\t').concat(n?'<div class="el-dialog-close"></div>':"",'\n\t\t\t\t<div class="el-message__icon loading-icon svgtofont-el-').concat(s,'"></div>\n\t\t\t\t<div class="el-message__content">').concat(e||"","</div>\n\t\t\t</div>");window.document.body.insertAdjacentHTML("beforeend",r),o&&window.setTimeout(()=>{const e=document.getElementById("el-message");e&&e.remove()},o),n&&this.bindEvent(document.querySelector(".el-dialog-close"),"click",()=>{var e;null==(e=document.getElementById("el-message"))||e.remove()})}tooltip({el:e,text:t}){var o;null==(o=document.getElementById("el-tooltip"))||o.remove();const n='<div  id="el-tooltip" x-placement="top" class="el-tooltip__popper is-dark el-tooltip-white overview-popover w-[40rem] custom-login-popover" style="transform-origin: center bottom; z-index: 3009; display: none;">\n\t\t\t\t<div class="leading-8 p-[8px]">'.concat(t,'</div>\n\t\t\t\t<div class="popper__arrow" style="left: 154px;"></div>\n\t\t</div>');window.document.body.insertAdjacentHTML("beforeend",n);const i=document.getElementById("el-tooltip");let s=0;this.bindEvent(e,"mouseenter",e=>{const t=e;clearTimeout(s),i.style.display="block",i.style.left="".concat(t.clientX-t.offsetX-150,"px"),i.style.top="".concat(t.clientY-t.offsetY-i.clientHeight-10,"px")}),this.bindEvent(e,"mouseleave",()=>{clearTimeout(s),s=window.setTimeout(()=>{i.style.display="none"},100)}),this.bindEvent(i,"mouseenter",()=>{clearTimeout(s),i.style.display="block"}),this.bindEvent(i,"mouseleave",()=>{clearTimeout(s),s=window.setTimeout(()=>{i.style.display="none"},100)}),i.style.left="calc(50% - ".concat(i.offsetWidth/2,"px)"),i.style.top="calc(50% - ".concat(i.offsetHeight/2,"px)")}}class i extends n{constructor(e){super(),t(this,"el"),t(this,"formData"),t(this,"formVerify"),t(this,"node"),t(this,"codeCheck"),t(this,"hostCheck"),t(this,"googleCheck"),t(this,"loginErrorTimer"),t(this,"timer"),t(this,"submitError"),this.initData(e),this.nodeMount(),this.render(),this.event()}initData(e){const t=localStorage.getItem("safeMode");this.el="string"==typeof e?document.querySelector(e):e,this.formData={},this.node={},this.formData.safe_mode=Number(t||1),this.codeCheck=window.vite_public_login_check,this.formVerify={form:null,vcode:null}}nodeMount(){this.node={loginForm:this.el.querySelector(".login-form"),inputUsername:this.el.querySelector('[name="username"]'),inputPassword:this.el.querySelector('[name="password"]'),codeView:this.el.querySelector(".login-code-view"),inputCode:this.el.querySelector('[name="code"]'),cutCode:this.el.querySelector(".cut-login-code"),formSafeMode:this.el.querySelector(".login-safe-mode"),formSubmit:this.el.querySelector(".login-submit"),formGoogleVerifySubmit:this.el.querySelector(".login-google-verify-submit"),closePopupBtn:this.el.querySelector(".close-popup-btn"),formGoogleVerifyView:this.el.querySelector(".google-verify-view"),formGoogleVerifyInput:this.el.querySelector('[name="vcode"]'),formCdnAccelerate:this.el.querySelector(".login-cdn-accelerate"),formTipsQuestion:this.el.querySelector(".svgtofont-el-question-filled")}}render(){const{formSafeMode:e}=this.node;this.renderSelect({el:e,options:[{key:1,label:"安全登录模式(推荐)"},{key:0,label:"普通登录模式(不推荐)"}],active:this.formData.safeMode,change:e=>{this.formData.safe_mode=Number(e)}}),this.renderHostsList(),this.codeVerify(this.codeCheck),this.cutCheckCode()}event(){const{cutCode:e,formSubmit:t,inputPassword:o,inputUsername:n,formGoogleVerifyInput:i,formGoogleVerifySubmit:s,formTipsQuestion:r,inputCode:a}=this.node;this.formVerify.form=this.validateForm({el:this.node.loginForm,rules:{username:{validator:(e,t)=>{""===e?t(new Error("账号不能为空")):e.length<3?t(new Error("账号长度必须大于等于3位")):t()},trigger:["input","blur"]},password:{validator:(e,t)=>{""===e?t(new Error("密码不能为空")):t()},trigger:["input","blur"]},code:{isShow:()=>this.codeCheck,validator:(e,t)=>{""===e?t(new Error("验证码不能为空")):4!==e.length?t(new Error("验证码长度错误，必须为4位")):t()},trigger:["input","blur"]}}}),this.formVerify.vcode=this.validateForm({el:this.node.formGoogleVerifyView,rules:{vcode:{validator:(e,t)=>{""===e?t(new Error("动态口令不能为空")):e.length<6?t(new Error("动态口令长度必须为6位")):t()},trigger:["input","blur"]}}}),this.bindEvent(e,"click",this.cutCheckCode.bind(this)),this.bindEvent(this.node.closePopupBtn,"click",()=>{this.googleVerify(!1)}),this.bindEvent(t,"click",this.submitLoginInfo.bind(this,"form")),this.bindEvent(n,"keyup",e=>{13===e.keyCode&&(t.focus(),t.click())}),this.bindEvent(o,"keyup",e=>{13===e.keyCode&&(t.focus(),t.click())}),this.bindEvent(a,"keyup",e=>{13===e.keyCode&&(t.focus(),t.click())}),this.bindEvent(s,"click",this.submitLoginInfo.bind(this,"vcode")),this.bindEvent(i,"keyup",e=>{13===e.keyCode&&s.click()}),this.tooltip({el:r,text:'\n\t\t\t\t<div class="mb-[.8rem]">\n\t\t\t\t\t<div class="font-bold">安全登录模式（推荐）</div>\n\t\t\t\t\t<div>在安全模式下，将加强登录会话的安全性，防止“重放攻击”风险，强烈建议使用安全模式登录面板。</div>\n\t\t\t\t\t<div class="text-danger"> 注意：在安全模式下，极少数网络环境可能出现无限退出的情况。 </div>\n\t\t\t\t</div>\n\t\t\t\t<div class="font-bold">普通登录模式（不推荐）</div>\n\t\t\t\t<div>兼容性好，但存在“重放攻击”的风险，建议在开启面板SSL的情况下再使用普通模式。</div>'}),this.checkAutoLogin(),this.node.inputUsername.value=this.autoLoginParams.username,this.node.inputPassword.value=this.autoLoginParams.password,this.autoLoginParams.username&&this.autoLoginParams.password&&this.node.formSubmit.click()}async renderHostsList(){const{formCdnAccelerate:e}=this.node,t=window.vite_public_hosts_list||[];if(this.hostCheck=t.length>0,e.classList[this.hostCheck?"remove":"add"]("!hidden"),document.querySelector(".cdn-node").classList[this.hostCheck?"remove":"add"]("!hidden"),this.hostCheck&&(document.querySelector(".noreferrer_tips").innerText="联系客服"),!this.hostCheck)return!1;const o=[],n=[];for(let i=0;i<t.length;i++){const e=t[i];o.push({key:e.url,label:e.name}),n.push(this.getHostDelay(e.url))}this.monitorHostSpeed(o,n)}async monitorHostSpeed(e,t){const o=await Promise.all(t);e=e.map((e,t)=>({key:e.key,label:"".concat(e.label).concat(o[t]?"(".concat(o[t],"ms)"):""),state:o[t],disabled:!o[t]})).sort((e,t)=>!1===e.state?1:e.state-t.state),this.createHostSelect(e)}createHostSelect(e){const{formCdnAccelerate:t}=this.node;e&&(this.formData.cdn_url=e[0].key),this.renderSelect({el:t,size:"small",options:[{key:"",label:"不使用加速"},...e],active:e[0].key,change:e=>{this.formData.cdn_url=e}})}async getHostDelay(e){try{const t=(new Date).getTime(),{data:o}=await this.request({method:"get",url:"https://".concat(e,"/test.txt"),data:{time:t}});if("boolean"==typeof o){const e=(new Date).getTime();return Promise.resolve(e-t)}return Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}getUrlInfo(){const{formSubmit:e,inputUsername:t,inputPassword:o}=this.node,n=window.location.href.split("?")[1],i=new URLSearchParams("?".concat(n)),s=i.get("username"),r=i.get("password");s&&r&&(t.value=s,o.value=r,e.click())}cutCheckCode(){this.node.cutCode.querySelector("img").src="/code?t=".concat((new Date).getTime())}googleVerify(e){const{formGoogleVerifyView:t,formGoogleVerifyInput:o}=this.node;this.googleCheck=e,this.formData.vcode="",o.value="",e?(t.classList.remove("!hidden"),o.focus()):t.classList.add("!hidden")}codeVerify(e){const{inputCode:t,codeView:o}=this.node;this.codeCheck=e,this.formData.code="",o.classList[e?"remove":"add"]("!hidden"),t.value=""}setFormSubmitError(e){var t,o,n;const{formSubmit:i}=this.node;return null==(o=null==(t=i.parentElement)?void 0:t.querySelector(".error-tips"))||o.remove(),null==(n=i.parentElement)||n.classList.add("error"),i.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(e,"</div>")),{close:()=>{var e,t,o;null==(e=i.parentElement)||e.classList.remove("error"),null==(o=null==(t=i.parentElement)?void 0:t.querySelector(".error-tips"))||o.remove()}}}async submitLoginInfo(e){const{inputPassword:t}=this.node;this.formVerify[e](async o=>{const n=this.loading("正在登录面板，请稍候..."),i={...this.formData,...o};this.formData={...i},"string"==typeof e&&"vcode"===e&&(i.vcode=o.vcode);let s=await this.encryptionData(i);this.hostCheck&&(s.cdn_url=this.formData.cdn_url),this.googleCheck&&(s.vcode=this.formData.vcode),this.codeCheck&&(s.code=this.formData.code),s=this.removeEmpty(s);try{sessionStorage.setItem("sendXhr","1");const{data:o}=await this.request({method:"post",url:"/login",data:s});if(n.close(),this.submitError&&this.submitError.close(),this.loginErrorTimer=!1,"number"==typeof o&&1===o)this.googleVerify(!0);else if("object"==typeof o){const{status:n,msg:i}=o;n?(this.message({type:"success",message:i}),sessionStorage.setItem("loginInfo",JSON.stringify(o)),setTimeout(()=>{window.location.href="/"},500)):(this.message({type:"error",message:i}),"vcode"===e?this.googleVerify(!0):(t.value="",this.googleVerify(!1),this.codeVerify(!0),this.cutCheckCode(),-1!==i.indexOf("验证码错误")&&this.cutCheckCode(),this.countdownInfo(i)))}else this.message({message:o,type:"error",time:0,close:!0})}catch(r){this.message({type:"error",message:r,close:!0}),n.close()}})}countdownInfo(e){let t=0;if(!(e.indexOf("多次登录失败")>-1))return;const o=e.match(/\d+/g);o?(this.loginErrorTimer=!0,t=o[0],this.timer&&clearInterval(this.timer),this.timer=window.setInterval(()=>{t--,this.submitError=this.setFormSubmitError(e.replace(/\d+/g,t.toString())),(t<=0||!this.loginErrorTimer)&&(clearInterval(this.timer),this.submitError.close(),t=0)},1e3)):setTimeout(()=>{this.submitError.close()},3e3)}}class s extends n{constructor(e){super(),t(this,"el"),t(this,"node"),t(this,"pollingQuery",!0),t(this,"timer",null),this.el="string"==typeof e?document.querySelector(e):e,this.node={cutTips:null,loginAccount:null,loginScan:null},this.render()}render(){this.getSacnLoginInfo()}async qrCodeRender(e){const t=document.getElementById("canvas");t&&(t.innerHTML=""),new window.QRCode(t,e,{color:{dark:"#000000",light:"#ffffff"},width:"140px",height:"140px",errorCorrectionLevel:"Q"})}async getSacnLoginInfo(){var e,t,o,n;try{const{data:i}=await this.request({method:"post",url:"/public?name=app&fun=login_qrcode"});if("object"==typeof i){const{status:s,msg:r}=i;if(s){const o=r.replace(/(panel_url=)[^&]*/i,(e,t)=>"".concat(t+window.location.protocol,"//").concat(window.location.host));this.qrCodeRender(s?o:"https://www.bt.cn/download/app.html"),this.pollingQuerySacnInfo(),null==(e=document.querySelector(".login-scan-success"))||e.classList.remove("!hidden"),null==(t=document.querySelector(".login-scan-error"))||t.classList.add("!hidden")}else null==(o=document.querySelector(".login-scan-success"))||o.classList.add("!hidden"),null==(n=document.querySelector(".login-scan-error"))||n.classList.remove("!hidden")}}catch(i){}}async pollingQuerySacnInfo(){try{if(!this.pollingQuery)return!1;const{data:e}=await this.request({method:"post",url:"/public?name=app&fun=is_scan_ok"}),{status:t,msg:o}=e;"object"==typeof e&&t?this.loginAdmin(o):this.timer=setTimeout(()=>{const e=localStorage.getItem("loginType");if(this.timer&&"account"===e)return clearTimeout(this.timer);this.pollingQuerySacnInfo()},2500)}catch(e){}}async loginAdmin(e){try{const{data:t}=await this.request({method:"post",url:"/public?name=app&fun=set_login",data:{secret_key:e}}),{status:o}=t;"object"==typeof t&&o&&(this.message({type:"success",message:"登录成功,正在跳转中"}),window.location.href="/")}catch(t){}}}class r{constructor(){t(this,"defaultColors",{primary:"#20a53a",success:"#67c23a",warning:"#f2711c",danger:"#db2828",error:"#db2828",info:"#909399"}),t(this,"lightRatios",{3:.3,5:.5,7:.7,8:.8,9:.9}),t(this,"darkRatios",{2:.2}),t(this,"darkModeLightRatios",{3:.15,5:.25,7:.35,8:.45,9:.55}),t(this,"darkModeDarkRatios",{2:.3})}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}rgbToHex(e,t,o){return"#".concat(((1<<24)+(e<<16)+(t<<8)+o).toString(16).slice(1))}mixColors(e,t,o){return{r:Math.round(e.r*(1-o)+t.r*o),g:Math.round(e.g*(1-o)+t.g*o),b:Math.round(e.b*(1-o)+t.b*o)}}generateLightColor(e,t){const o=this.hexToRgb(e);if(!o)throw new Error("Invalid color format: ".concat(e));const n=this.mixColors(o,{r:255,g:255,b:255},this.lightRatios[t]);return this.rgbToHex(n.r,n.g,n.b)}generateDarkColor(e,t){const o=this.hexToRgb(e);if(!o)throw new Error("Invalid color format: ".concat(e));const n=this.mixColors(o,{r:0,g:0,b:0},this.darkRatios[t]);return this.rgbToHex(n.r,n.g,n.b)}generateDarkModeLightColor(e,t){const o=this.hexToRgb(e);if(!o)throw new Error("Invalid color format: ".concat(e));const n=this.mixColors(o,{r:0,g:0,b:0},this.darkModeLightRatios[t]);return this.rgbToHex(n.r,n.g,n.b)}generateDarkModeDarkColor(e,t){const o=this.hexToRgb(e);if(!o)throw new Error("Invalid color format: ".concat(e));const n=this.mixColors(o,{r:255,g:255,b:255},this.darkModeDarkRatios[t]);return this.rgbToHex(n.r,n.g,n.b)}generateColorVariables(e={},t={}){const o={...this.defaultColors,...e},n={darkMode:!1,...t},i={};return Object.keys(o).forEach(e=>{const t=o[e];t&&(i["--el-color-".concat(e)]=t,n.darkMode?([3,5,7,8,9].forEach(o=>{i["--el-color-".concat(e,"-light-").concat(o)]=this.generateDarkModeLightColor(t,o)}),i["--el-color-".concat(e,"-dark-2")]=this.generateDarkModeDarkColor(t,2)):([3,5,7,8,9].forEach(o=>{i["--el-color-".concat(e,"-light-").concat(o)]=this.generateLightColor(t,o)}),i["--el-color-".concat(e,"-dark-2")]=this.generateDarkColor(t,2)))}),i}applyColorVariables(e){}generateAndApplyColors(e,t={}){return this.generateColorVariables(e,t)}}class a{constructor(){t(this,"styleElement",null),t(this,"styleId","dynamic-theme-variables"),t(this,"currentVariables",{}),this.init()}init(){this.createStyleElement()}createStyleElement(){const e=document.getElementById(this.styleId);if(e)return this.styleElement=e,e;const t=document.createElement("style");t.id=this.styleId,t.type="text/css";return t.textContent="\n\t\t\t/* View Transitions API 支持 */\n\t\t\t::view-transition-old(root),\n\t\t\t::view-transition-new(root) {\n\t\t\t\tanimation-duration: 0.5s;\n\t\t\t\tz-index: 99999;\n\t\t\t}\n\n\t\t\t/* 当支持View Transitions时的圆形扩散动画 */\n\t\t\thtml.theme-switching::view-transition-old(root) {\n\t\t\t\tclip-path: circle(var(--circle-size, 100%) at var(--circle-x, 50%) var(--circle-y, 50%));\n\t\t\t}\n\n\t\t\thtml.theme-switching::view-transition-new(root) {\n\t\t\t\tclip-path: circle(var(--circle-size, 0px) at var(--circle-x, 50%) var(--circle-y, 50%));\n\t\t\t}\n\n\t\t\t/* 降级动画 - 当不支持View Transitions时 */\n\t\t\t.theme-transition-fallback {\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: 100vw;\n\t\t\t\theight: 100vh;\n\t\t\t\tbackground: var(--fallback-bg-color, #ffffff);\n\t\t\t\tborder-radius: 50%;\n\t\t\t\ttransform: scale(0);\n\t\t\t\ttransform-origin: var(--circle-x, 50%) var(--circle-y, 50%);\n\t\t\t\tz-index: 99999;\n\t\t\t\tpointer-events: none;\n\t\t\t\ttransition: transform 0.5s ease-in-out;\n\t\t\t}\n\n\t\t\t.theme-transition-fallback.active {\n\t\t\t\ttransform: scale(3);\n\t\t\t}\n\n\t\t\t/* 主题切换按钮状态 */\n\t\t\t.theme-toggle-button {\n\t\t\t\ttransition: transform 0.2s ease;\n\t\t\t}\n\n\t\t\t.theme-toggle-button:hover {\n\t\t\t\ttransform: scale(1.1);\n\t\t\t}\n\n\t\t\t.theme-toggle-button.transitioning {\n\t\t\t\tpointer-events: none;\n\t\t\t}\n\t\t",document.head.appendChild(t),this.styleElement=t,t}registerVariables(e,t){const o={};Object.keys(e).forEach(n=>{const i=t?"--".concat(t,"-").concat(n.replace(/^--/,"")):n;o[i]=e[n]}),Object.assign(this.currentVariables,o),this.updateStyles()}registerColorVariables(e,t){this.registerVariables(e,t)}registerThemeVariables(e){const t={};if(e.theme&&e.theme.color&&(t["--theme-primary-color"]=e.theme.color),e.interface&&e.interface.rounded){switch(e.interface.rounded){case"none":t["--el-border-radius-small"]="0px",t["--el-border-radius-base"]="0px",t["--el-border-radius-medium"]="0px",t["--el-border-radius-large"]="0px",t["--el-border-radius-extra-large"]="0px";break;case"small":t["--el-border-radius-small"]="2px",t["--el-border-radius-base"]="4px",t["--el-border-radius-medium"]="6px",t["--el-border-radius-large"]="8px",t["--el-border-radius-extra-large"]="16px";break;case"medium":t["--el-border-radius-small"]="4px",t["--el-border-radius-base"]="6px",t["--el-border-radius-medium"]="8px",t["--el-border-radius-large"]="12px",t["--el-border-radius-extra-large"]="20px";break;case"large":t["--el-border-radius-small"]="8px",t["--el-border-radius-base"]="12px",t["--el-border-radius-medium"]="16px",t["--el-border-radius-large"]="20px",t["--el-border-radius-extra-large"]="24px";break;default:t["--el-border-radius-small"]="4px",t["--el-border-radius-base"]="6px",t["--el-border-radius-medium"]="8px",t["--el-border-radius-large"]="12px",t["--el-border-radius-extra-large"]="16px"}}e.login&&(e.login.bg_image&&(t["--login-bg-image"]="url('".concat(e.login.bg_image,"')")),void 0!==e.login.bg_image_opacity&&(t["--login-bg-opacity"]=String(e.login.bg_image_opacity/100)),void 0!==e.login.content_opacity&&(t["--login-content-opacity"]=String(e.login.content_opacity/100)),e.login.logo&&(t["--login-logo-url"]="url('".concat(e.login.logo,"')"))),e.logo&&(e.logo.image&&(t["--logo-image-url"]="url('".concat(e.logo.image,"')")),e.logo.favicon&&(t["--logo-favicon-url"]="url('".concat(e.logo.favicon,"')"))),this.registerVariables(t,"")}removeVariablesByNamespace(e){const t="--".concat(e,"-");Object.keys(this.currentVariables).forEach(e=>{e.startsWith(t)&&delete this.currentVariables[e]}),this.updateStyles()}clearAllVariables(){this.currentVariables={},this.updateStyles()}updateStyles(){this.styleElement||this.createStyleElement();const e=this.generateCSSRules();this.styleElement&&(this.styleElement.textContent=e)}getSystemTheme(){try{return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch(e){return"light"}}isDark(){try{const{preset:e}=window.vite_public_panel_theme.theme;return"auto"===e?"dark"===this.getSystemTheme():"dark"===e}catch(e){return!1}}generateCSSRules(){const e=Object.keys(this.currentVariables).map(e=>"  ".concat(e,": ").concat(this.currentVariables[e],";")).join("\n");return"".concat(this.isDark()?"html.dark {":":root {","\n").concat(e,"\n}")}getCurrentVariables(){return{...this.currentVariables}}getVariable(e){return this.currentVariables[e]}hasVariable(e){return e in this.currentVariables}destroy(){this.styleElement&&this.styleElement.parentNode&&this.styleElement.parentNode.removeChild(this.styleElement),this.styleElement=null,this.currentVariables={}}}class l{constructor(){t(this,"currentTheme"),t(this,"themeToggleBtn"),t(this,"themeIcon"),t(this,"colorGenerator"),t(this,"styleManager"),t(this,"panelTheme"),this.themeToggleBtn=null,this.themeIcon=null,this.colorGenerator=new r,this.styleManager=new a,this.panelTheme=window.vite_public_panel_theme||null,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}init(){this.bindElements(),this.applyTheme(this.currentTheme),this.applyPanelThemeColors(),this.updateThemeIcon(this.currentTheme),this.updateThemeTips(this.currentTheme),this.bindEvents()}bindElements(){this.themeToggleBtn=document.querySelector("#theme-toggle-btn"),this.themeIcon=document.querySelector("#theme-toggle-btn .theme-icon")}bindEvents(){this.themeToggleBtn&&(this.themeToggleBtn.classList.add("theme-toggle-button"),this.themeToggleBtn.addEventListener("click",e=>{this.toggleTheme(e)}))}async toggleTheme(e){if(document.documentElement.classList.contains("theme-switching"))return;const t="light"===this.currentTheme?"dark":"light";e?await this.animateThemeToggle(e,t):this.setTheme(t)}async animateThemeToggle(e,t){e.preventDefault(),e.stopPropagation();const o=e.clientX,n=e.clientY,i=Math.hypot(Math.max(o,window.innerWidth-o),Math.max(n,window.innerHeight-n));document.documentElement.style.setProperty("--circle-x","".concat(o,"px")),document.documentElement.style.setProperty("--circle-y","".concat(n,"px")),document.documentElement.style.setProperty("--circle-size","".concat(2*i,"px")),document.documentElement.classList.add("theme-switching"),this.themeToggleBtn&&this.themeToggleBtn.classList.add("transitioning");const s=()=>{this.setTheme(t)};if("function"==typeof document.startViewTransition)try{document.startViewTransition(s).finished.then(()=>{document.documentElement.classList.remove("theme-switching"),this.themeToggleBtn&&this.themeToggleBtn.classList.remove("transitioning")}).catch(e=>{document.documentElement.classList.remove("theme-switching"),this.themeToggleBtn&&this.themeToggleBtn.classList.remove("transitioning")})}catch(r){setTimeout(()=>{s(),document.documentElement.classList.remove("theme-switching")},100)}else this.createFallbackAnimation(o,n,"dark"===t?"#1a1a1a":"#ffffff"),setTimeout(s,250),setTimeout(()=>{document.documentElement.classList.remove("theme-switching"),this.removeFallbackAnimation(),this.themeToggleBtn&&this.themeToggleBtn.classList.remove("transitioning")},500)}createFallbackAnimation(e,t,o){const n=document.createElement("div");n.className="theme-transition-fallback",n.style.setProperty("--circle-x","".concat(e,"px")),n.style.setProperty("--circle-y","".concat(t,"px")),n.style.setProperty("--fallback-bg-color",o),n.id="theme-fallback-animation",document.body.appendChild(n),setTimeout(()=>{n.classList.add("active")},10)}removeFallbackAnimation(){const e=document.getElementById("theme-fallback-animation");e&&e.remove()}setTheme(e){this.currentTheme=e,this.applyTheme(e),this.updateThemeIcon(e),this.updateThemeTips(e)}applyThemeImmediate(e){const t=document.documentElement;"dark"===e?t.setAttribute("data-theme","dark"):t.removeAttribute("data-theme")}applyTheme(e){this.applyThemeImmediate(e),this.applyPanelThemeColors()}applyPanelThemeColors(){var e;if(!this.panelTheme)return;const t="dark"===this.currentTheme,o=(null==(e=this.panelTheme.theme)?void 0:e.color)||"#20a53a",n=this.colorGenerator.generateAndApplyColors({primary:o,success:"#67c23a",warning:"#f2711c",danger:"#db2828",error:"#db2828",info:"#909399"},{darkMode:t});this.styleManager.registerColorVariables(n,""),this.applyInterfaceStyles(),this.applyLoginStyles()}applyInterfaceStyles(){this.panelTheme&&this.styleManager.registerThemeVariables(this.panelTheme)}applyLoginStyles(){}updateThemeIcon(e){this.themeIcon&&(this.themeIcon.innerHTML="dark"===e?'\n\t\t\t\t<circle cx="12" cy="12" r="5"/>\n\t\t\t\t<path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>\n\t\t\t':'\n\t\t\t\t<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>\n\t\t\t')}updateThemeTips(e){this.themeToggleBtn&&("dark"===e?this.themeToggleBtn.setAttribute("title","切换到亮色主题"):this.themeToggleBtn.setAttribute("title","切换到暗色主题"))}getStyleManager(){return this.styleManager}registerCustomVariables(e,t){this.styleManager.registerVariables(e,t)}getAllVariables(){return this.styleManager.getCurrentVariables()}}new class extends n{constructor(e){super(),t(this,"loginType"),t(this,"el"),t(this,"node"),t(this,"autoLoginParams"),t(this,"themeManager");const o=document.querySelector("#login-main");this.loginType=localStorage.getItem("loginType")||"account",this.el=document.querySelector(e.el),this.node={cutTips:null,loginAccount:null,loginScan:null},this.autoLoginParams={password:"",username:""},this.themeManager=new l,this.render(),o&&(o.style.display="block")}initPageStyle(){var e,t,o;const n=window.vite_public_panel_theme,i=null==(e=null==n?void 0:n.login)?void 0:e.is_show_bg,s=null==(t=null==n?void 0:n.login)?void 0:t.is_show_logo,{bg_image:r}=(null==n?void 0:n.login)||{},a=this.el.querySelector("#login-images");a&&i&&r&&(a.style.backgroundImage="url('".concat(r,"')"),a.style.opacity="var(--login-bg-opacity, 1)",a.style.display="block");const l=this.el.querySelector("#login-svg");if(l)if(s){l.classList.remove("!hidden");const e=l.querySelector("#login-logo");e&&(e.src=(null==(o=null==n?void 0:n.login)?void 0:o.logo)||"/static/icons/logo-green.svg")}else l.classList.add("!hidden");const c=this.el.querySelector("#cut-login-type");c&&(c.style.top=s?"110px":"20px",c.className="cut-login-type ".concat(this.loginType))}domMount(){this.node.cutTips=this.el.querySelector(".tips-text"),this.node.cutLoginType=this.el.querySelector("#cut-login-type"),this.node.loginAccount=this.el.querySelector("#login-account"),this.node.loginScan=this.el.querySelector("#login-scan")}eventMount(){const{cutLoginType:e,cutTips:t}=this.node;this.bindEvent(e,"click",()=>{e.classList.add("account"===this.loginType?"scan":"account"),e.classList.remove("account"===this.loginType?"account":"scan"),"account"===this.loginType?(this.setLoginScan(),t.innerText="切换账号登录",localStorage.setItem("loginType","scan"),this.updateLoginTypeIcon("scan")):(this.setLoginAccount(),t.innerText="切换扫码登录",localStorage.setItem("loginType","account"),this.updateLoginTypeIcon("account"))})}setLoginScan(){const{loginScan:e,loginAccount:t}=this.node;this.loginType="scan",e.classList.remove("!hidden"),t.classList.add("!hidden"),new s(this.node.loginScan)}setLoginAccount(){const{loginScan:e,loginAccount:t}=this.node;this.loginType="account",e.classList.add("!hidden"),t.classList.remove("!hidden"),new i(this.node.loginAccount)}updateLoginTypeIcon(e){const{cutLoginType:t}=this.node;if(t){const o=t.querySelector(".login-type-icon");if(o){const t="account"===e?'<rect x="3" y="3" width="5" height="5"/><rect x="3" y="16" width="5" height="5"/><rect x="16" y="3" width="5" height="5"/><path d="m5 5 0 0"/><path d="m5 18 0 0"/><path d="m18 5 0 0"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/>':'<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>';o.innerHTML=t}}}render(){this.initPageStyle(),this.loginType=localStorage.getItem("loginType")||"account";const e=this.el.querySelector("#login-title-text");e&&(e.textContent=window.vite_public_title,e.title=window.vite_public_title),this.domMount(),this.eventMount(),"account"===this.loginType?this.setLoginAccount():this.setLoginScan()}}({el:"#app"});export{o as __vite_legacy_guard};
