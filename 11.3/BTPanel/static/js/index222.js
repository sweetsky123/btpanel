import{_ as e}from"./index123.js?v=1763689792";import{M as a,F as s}from"./utils-lib.js?v=1763689792";import{getBackupSize as l,getImportSize as t}from"./database.js?v=1763689792";import{c as r,r as i,v as n,aG as m,x as c,y as o,A as u,B as p,z as d,e as v,G as f}from"./base-lib.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const x={class:"relative w-full text-medium flex items-center mb-2rem"},g={class:"flex flex-col ml-1rem leading-2rem"},y={class:"text-small mt-[8px]"},D={class:"grid grid-cols-3 leading-3rem py-1rem text-base"},b={class:"flex items-center mr-1rem"},h={class:"truncate flex-1"},_={class:"flex items-center mr-1rem"},j={class:"truncate flex-1"},w={class:"flex items-center"},F={class:"truncate flex-1"},k={key:0,class:"pl-2rem mt-2re leading-8 text-small list-disc"},C=r({__name:"index",props:{compData:{default:()=>({type:"",refreshFn:()=>{},successFlag:!1,config:{id:"",name:"",path:""}})}},emits:["close","onCancel"],setup(r,{expose:C,emit:T}){const G=r,O=T,{id:z,name:A,path:B}=G.compData.config,H=i(""),M=i(""),N=i("获取中...\t"),q=i(!0),E=i(null),I=i("import"===G.compData.type?"导入":"recover"===G.compData.type?"恢复":"压缩"),J=i(),K=async()=>{try{const{data:e}="backup"===G.compData.type?await l({id:Number(z)}):await t({name:A});if(J.value&&(q.value=!0),!e.status)return P(),q.value=!1,void(N.value=e.msg);N.value!==e.msg&&(N.value=e.msg),(null==e?void 0:e.total)&&(H.value=e.total,M.value=e.speed);let a=(-1!==e.msg.indexOf("成功!")||-1!==e.msg.indexOf("successful"))&&e.status;if(a)return void L();(null==e?void 0:e.speed)&&q.value&&!a&&(E.value=setTimeout(function(){K()},1e3))}catch(e){P()}},L=()=>{q.value=!1,"repair"===G.compData.type&&(a.success("修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！"),setTimeout(()=>{s(),window.location.reload()},2e3)),O("close"),P(),G.compData.refreshFn&&G.compData.refreshFn()},P=()=>{E.value=null,clearTimeout(E.value),q.value=!1};return n(K),m(P),C({onCancel:P}),(a,s)=>{const l=e;return c(),o("div",{class:"p-2rem flex-wrap",ref_key:"progressDialog",ref:J},[u("div",x,[s[0]||(s[0]=u("i",{class:"svgtofont-el-loading text-3rem animate-spin"},null,-1)),u("div",g,[u("span",null,"正在"+p(d(I))+"数据库文件，请稍后...",1),u("span",y,"当前"+p(d(I))+"任务为后台"+p(d(I))+"，可关闭此页面进行其他操作",1)])]),s[2]||(s[2]=u("hr",{class:"!border-[#dedede]"},null,-1)),u("div",D,[u("div",b,[u("span",null,p(d(I))+"数据库：",1),u("div",h,p(r.compData.config.name),1)]),u("div",_,[u("div",null,p(d(I))+"大小：",1),u("div",j,p(d(H)||"--"),1)]),u("div",w,[u("div",null,p(d(I))+"速度：",1),u("div",F,p(d(M)||"--"),1)])]),v(l,{class:"h-[30rem]",content:d(N)},null,8,["content"]),"import"===r.compData.type?(c(),o("ul",k,[...s[1]||(s[1]=[u("li",null,"导入完成后，可到导入->导入日志查看导入结果",-1)])])):f("",!0)],512)}}});export{C as default};
