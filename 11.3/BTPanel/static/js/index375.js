import{lf as a,M as s,x as e,lg as t,$ as l,_ as n}from"./utils-lib.js?v=1763689792";import{_ as i}from"./index123.js?v=1763689792";import{c as o,r,v as u,a8 as c,x as m,y as p,e as d,C as v,F as f,b1 as _,z as x,O as g,cc as j,cd as y,A as w,B as b,D as h,G as k,H as z}from"./base-lib.js?v=1763689792";import{a as C}from"./index68.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./useController6.js?v=1763689792";import"./site.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";const D={class:"p-[2rem] master-step-container"},H={key:0,class:"manual-import-card"},T={class:"file-name"},q={class:"file-size"},I={class:"manual-import-actions"},S=n(o({__name:"index",props:{compData:{default:()=>({slave_ip:""})}},setup(n){const{isRefreshList:o}=C(),S=n,A=r(""),B=r([]),F=r(0);let G=null;const L=r(""),M=r(0),N=r({}),O=r(!0),R={wait:()=>d("span",{class:"svgtofont-el-more-filled text-disabled mr-2px !text-large"},null),done:()=>d("span",{class:"svgtofont-el-circle-check text-primary mr-2px !text-large"},null),running:()=>d("span",{class:"svgtofont-el-loading animate-spin text-supplement mr-2px !text-large"},null)},$={wait:"",done:"完成",running:"进行中"},E=async()=>{if(!O.value)return;const{data:t}=await a({slave_ip:S.compData.slave_ip});t.status||s.error(t.msg);const{data:l}=t,{data:n}=l;A.value=n.logs,B.value=n.steps||[],F.value=B.value.findIndex(a=>"running"===a.status||"wait"===a.status),-1===F.value&&(F.value=B.value.length-1),M.value=n.step,L.value=l.sync_type,"manual"===L.value&&2===M.value&&(O.value=!1,N.value={name:n.master_data_sql,size:e(Number(n.sql_file_size))||"--"});const i=n.step,r=B.value[B.value.length-1];5===i&&r&&"done"===r.status?G&&(clearTimeout(G),G=null,o.value=!0):B.value.some(a=>"done"!==a.status)&&(G=setTimeout(E,2e3))},J=async()=>{const a=s.load("开始同步...");try{const{data:a}=await t({slave_ip:S.compData.slave_ip});a.status?(O.value=!0,o.value=!0,E()):s.error(a.msg||"同步失败")}catch(e){s.error("同步失败")}finally{a.close()}},K=()=>{window.open("/download?filename="+N.value.name)};return u(()=>{O.value=!0,E()}),c(()=>{A.value="",G&&(clearTimeout(G),G=null)}),(a,s)=>{const e=z,t=i,n=l;return m(),p("div",D,[d(x(y),{direction:"vertical",space:"4rem",active:x(F)},{default:v(()=>[(m(!0),p(f,null,_(x(B),(a,s)=>{var e;return m(),g(x(j),{key:s,title:a.msg,icon:R[a.status]?R[a.status]():R.wait(),description:null!=(e=$[a.status])?e:"",status:"done"===a.status?"success":"running"===a.status?"process":"wait"},null,8,["title","icon","description","status"])}),128))]),_:1},8,["active"]),2===x(M)&&"manual"===x(L)?(m(),p("div",H,[w("div",T,"文件名："+b(x(N).name),1),w("div",q,"大小："+b(x(N).size),1),s[2]||(s[2]=w("div",{class:"import-tip"},"提示：请下载上面主库备份文件，在从库数据库页面-选择任意一个需要同步的数据库，进行导入数据",-1)),w("div",I,[d(e,{onClick:K},{default:v(()=>[...s[0]||(s[0]=[h("点击下载",-1)])]),_:1}),d(e,{type:"primary",onClick:J},{default:v(()=>[...s[1]||(s[1]=[h("数据已导入，开始从库配置",-1)])]),_:1})])])):k("",!0),s[3]||(s[3]=w("h3",{class:"text-base mb-[1rem] mt-[1rem] color-[#666]"},"实时日志",-1)),d(t,{content:x(A),isHtml:!0,autoScroll:!0,style:{height:"14rem"}},null,8,["content"]),d(n,{options:[{content:"同步任务为后台进行，此页面可以关闭，在从库列表中可以重新打开"}],class:"mt-[1rem]"})])}}}),[["__scopeId","data-v-877f13be"]]);export{S as default};
