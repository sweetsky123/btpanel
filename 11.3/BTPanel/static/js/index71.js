import{_ as t}from"./index109.js?v=1763689792";import{_ as e}from"./index260.js?v=1763689792";import{p as a,Q as s,hr as l,M as n,gZ as i,h0 as r,n as o,H as c,hs as d,u,an as p,ht as m,ao as _,ap as v}from"./utils-lib.js?v=1763689792";import{s as y,j as h,r as b,c as f,e as g,aT as w,x as k,y as T,C as j,A as x,z as A,L as R}from"./base-lib.js?v=1763689792";import{c as L,a as q,b as B,u as C}from"./column.js?v=1763689792";const M=h("NODE-ALARM-STORE",()=>{const t=b(),e=b(!1);return{alarmRowData:t,nodeAlarmRefresh:b(!1),isAlarmEdit:e}}),O=()=>y(M()),{alarmRowData:S,isAlarmEdit:E,nodeAlarmRefresh:N}=O(),z=async(t,e,a,s)=>{const n=async(t,e)=>{const{id:a,status:s}=t,n=new Map([["delete",l],["start",d],["stop",d]]).get(r);switch(r){case"start":if(n)return await n({task_id:a,status:1});break;case"stop":if(n)return await n({task_id:a,status:0});break;case"delete":if(n)return await n({task_id:a})}},{label:i,value:r}=s;await t({title:"批量".concat(i,"告警"),content:"即将批量".concat(i,"告警，是否继续操作?"),column:[{label:"告警名称",prop:"title"},L()],onConfirm:async()=>(await e(n),N.value=!0,!1)})},D=()=>{var t,e,a,s,l,n,i,r,o,c,d,u;try{let p="clb";return E.value&&(p=["222","223"].includes(null==(e=null==(t=S.value)?void 0:t.task_data)?void 0:e.tid)?"master":"clb"),{alarmType:p,lcbType:0,sendTimes:(null==(s=null==(a=S.value)?void 0:a.number_rule)?void 0:s.day_num)||3,failTimes:(null==(n=null==(l=S.value)?void 0:l.task_data)?void 0:n.err_num)||3,successCode:(null==(r=null==(i=S.value)?void 0:i.task_data)?void 0:r.codes)||"200,301,302,403,404",name:E.value?null==(c=null==(o=S.value)?void 0:o.task_data)?void 0:c.project:"",type:(null==(d=S.value)?void 0:d.sender)||[],masterType:(null==(u=S.value)?void 0:u.template_id)||"222"}}catch(p){return{}}},H=async t=>{try{await a({icon:"warning-filled",title:"删除告警任务",content:"删除后将不再告警此条任务，是否继续？"}),await s({loading:"正在删除告警任务，请稍候...",request:l({task_id:t.id}),message:!0,success:()=>{N.value=!0}})}catch(e){}},J=async t=>{S.value=t||{},E.value=!!t;const e=n.load("正在加载数据，请稍后..."),{data:{data:a}}=await i({page:1,page_size:100}),{data:{data:s}}=await r({page:1,page_size:100});e.close(),t||(S.value={clbList:[],tcpList:[]}),S.value.clbList=a.map(t=>({label:t.ps,value:t.load_id})),S.value.tcpList=s.map(t=>({label:t.ps,value:t.load_id})),o({isAsync:!0,title:"".concat(t?"修改":"添加","告警"),area:48,btn:!0,component:()=>c(()=>import("./index382.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},I=async t=>{try{await a({title:"".concat(t.status?"禁用":"启用","【").concat(t.title,"】任务"),content:"您真的要".concat(t.status?"禁用":"启用","【").concat(t.title,"】这个任务吗？")}),await s({loading:"正在修改告警任务状态，请稍候...",request:d({task_id:t.id,status:Number(!t.status)}),message:!0,success:()=>{N.value=!0}})}catch(e){}},P=[{label:"启动",value:"start",event:z},{label:"停止",value:"stop",event:z},{label:"删除",value:"delete",event:z}],Q=t=>{const{alarmType:e,lcbType:a,sendTimes:s,failTimes:l,successCode:n,name:i,type:r,masterType:o}=t,c={sender:r,number_rule:{day_num:Number(s),total:2},time_rule:{send_interval:0,time_range:[0,86399]}},d={status:!0,count:0,interval:600};switch(!0){case"clb"===e&&0===a:return{template_id:"220",task_data:JSON.stringify({...c,task_data:{...d,tid:"220",type:"nodes_nginx_http_load_push",title:"节点管理-负载均衡",project:i,codes:n}})};case"clb"===e&&1===a:return{template_id:"221",task_data:JSON.stringify({...c,task_data:{...d,tid:"221",type:"nodes_nginx_tcp_load_push",title:"节点管理-tcp负载均衡",project:i,err_num:l}})};case"master"===e:return{template_id:o,task_data:JSON.stringify({...c,task_data:{...d,tid:"mysql"===o?"222":"223",type:"mysql"===o?"nodes_mysql_slave_err_push":"nodes_redis_slave_err_push",title:"mysql"===o?"节点管理-Mysql主从告警":"节点管理-Redis主从告警",project:""}})};default:return null}},V={class:"node-clb-http module-ui"},W={class:"flex items-center"},Z={class:"flex items-center"},F=f({__name:"index",setup(a){const{nodeAlarmRefresh:s}=O(),{mainHeight:l,push:n,getSenderAlarmListInfo:i}=u(),r=[{content:"添加告警",dropdownClass:"bg-white",splitButton:!0,active:!0,event:()=>J()}],o=v(P),c=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]);let d=!0;const{BtTable:y,BtRefresh:h,BtSearch:b,BtColumn:f,BtBatch:L,BtErrorMask:M,refresh:S}=p({request:async t=>{var e;d&&(await i(),d=!1);const{data:a}=await m({keyword:t.search,template_ids:'["220", "221", "222", "223"]'});return{data:null==(e=a.data)?void 0:e.map(t=>{const{sender:e}=t;return{...t,alarmAccounts:e.map(t=>{const e=n.value.config.find(e=>e.id===t);return e?"sms"===e.sender_type?{id:t,type:e.sender_type,title:"短信"}:{id:t,type:e.sender_type,title:c.get(e.sender_type)||"",account:e.data.title}:null})}}),total:0,other:{}}},columns:[q({type:"page",key:"id"}),{label:"名称",prop:"title"},B({minWidth:100,event:I,data:["停用","正常"]}),{label:"告警方式",width:260,render:t=>{const e=(t.alarmAccounts||[]).filter(t=>null!==t),a=e.map(t=>"sms"===(null==t?void 0:t.type)?"短信通知":"".concat((null==t?void 0:t.account)||"","(").concat((null==t?void 0:t.title)||"",")")).join(","),s=e.map(t=>"sms"===(null==t?void 0:t.type)?"短信通知":"".concat(null==t?void 0:t.account,"(").concat(t.title,")")).join(",");return g(w,{content:a,placement:"top","open-delay":500},{default:()=>[g("span",null,[s])]})}},{label:"告警条件",prop:"view_msg",render:t=>g("span",{innerHTML:t.view_msg},null)},C([{onClick:J,title:"修改"},{onClick:H,title:"删除"}])],extension:[o,_(s)]});return(a,s)=>{const n=e,i=t;return k(),T("div",V,[g(i,null,{"header-left":j(()=>[x("div",W,[g(n,{options:r})])]),"header-right":j(()=>[x("div",Z,[g(A(b),{class:R(["mr-[10px]","!w-[210px]"]),placeholder:"请输入节点地址或备注"}),g(A(f))])]),content:j(()=>[g(A(y),{"min-height":A(l)},null,8,["min-height"])]),"footer-left":j(()=>[g(A(L))]),"footer-right":j(()=>[...s[0]||(s[0]=[])]),_:1})])}}}),G=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{D as a,Q as g,G as i,O as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
