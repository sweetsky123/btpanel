import{n as a,H as t,aH as e,q as s,Q as r,aK as o,R as i,ak as n,az as l,M as m}from"./utils-lib.js?v=1763689792";import{checkModuleServerConnection as u,checkServerConnection as p,syncDataToServer as c,syncModuleDataToServer as _,setDbTypes as d,getMysqlCloudServer as y,getModulesCloudServer as v,getSoftStatus as E,batchBackMysqlData as g,backDatabase as b,backModuleDatabase as D}from"./database.js?v=1763689792";import{r as f,g as w,aE as q}from"./base-lib.js?v=1763689792";import{i as O,c as h}from"./column.js?v=1763689792";import{g as j}from"./useStore2.js?v=1763689792";import{l as P,k as T,h as x,i as A,c as L}from"./validator.js?v=1763689792";const{refs:{tabActive:I,envStatus:R,isRefreshTable:S,softData:V}}=j(),k=f([]),N=async a=>{try{s(a)&&(a=0);return await r({request:"mysql"!==I.value?u({data:JSON.stringify({sid:a})},I.value):p({sid:a}),data:{status:Boolean,msg:String,db_status:Boolean,err_msg:String}})}catch(t){return o(t,"useCheckServerConnection"),{status:!1,err_msg:"error",msg:"检查出错啦！"}}},M=async a=>{try{const{data:t}=await E({name:a});return R.value=t,V.value.s_status=t.s_status,t||{setup:!1,version:"",status:!1}}catch(t){return o(t,"useCheckSoftStatus"),{setup:!1,version:"",status:!1}}},F=w(()=>({mysql:["支持MySQL5.5、MariaDB10.1及以上版本","注意3：通过宝塔安装的数据库root默认不支持远程权限"],redis:["支持redis-4.0+版本","注意3：通过宝塔安装的redis默认不支持远程权限"],sqlserver:["","注意3：通过宝塔安装的sqlserver默认不支持远程权限"],mongodb:["支持Mongodb-4.0及以上版本","注意3：通过宝塔安装的Mongodb默认不支持远程权限"],pgsql:["支持Postgresql-9.6+版本","注意3：通过宝塔安装的Postgresql默认不支持远程权限"]}[I.value]||[])),J=a=>[{label:"数据库名",prop:"name",width:160,sortable:!0},{label:"用户名",prop:"username",minWidth:100,sortable:!0},O({event:a})],C=(a,t)=>{let e="本地数据库";return{label:"数据库位置",minWidth:90,render:s=>(null==a||a.forEach(a=>{a.id===s.sid&&(e="mysql"===t?a.db_host:a.ps,"127.0.0.1"===a.db_host&&(e="本地数据库"))}),q("span",e))}},B=()=>{a({title:"远程数据库",area:86,component:()=>t(()=>import("./index219.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},H=e=>{a({title:"数据库工具箱-【".concat(e.name,"】"),area:86,compData:e,component:()=>t(()=>import("./index220.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},G=e=>{a({title:"设置数据库【".concat(e.name,"】密码"),area:53,showFooter:!0,compData:e,component:()=>t(()=>import("./index221.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Q=e=>a({area:60,compData:e,component:()=>t(()=>import("./index222.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),W=async(e,s)=>{if("import"===s)return await a({title:"导入本地备份",area:84,compData:e,component:()=>t(()=>import("./import-back.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)});a({title:"数据库【".concat(e.name,"】备份"),area:92,compData:{row:e,type:s},component:()=>t(()=>import("./index223.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},z=(e="",s)=>{a({title:"修改root密码",area:40,compData:{rootPwd:e,refresh:s},showFooter:!0,component:()=>t(()=>import("./index224.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},K=(e,s)=>{let r=[];r=i(e)?e.map(a=>a.id):[e.id],a({title:"删除数据库",area:76,showFooter:!0,compData:{ids:r,isMult:i(e),rows:e,config:n(s)?s:{}},confirmBtnType:"danger",component:()=>t(()=>import("./index225.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},U=(e,s)=>{a({title:"上传文件到",area:80,compData:{refreshEvent:e,path:l(s)?s:""},component:()=>t(()=>import("./index226.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},X=(e,s)=>{a({title:"批量".concat(s.title,"结果"),area:42,component:()=>t(()=>import("./index125.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{resultData:e,resultTitle:s.title||"操作"}})},Y=(e,s="single",r)=>{l(s)||(s="single"),a({title:"设置数据库权限",area:42,component:()=>t(()=>import("./index227.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{config:n(r)?r:{},type:s,rowData:e},showFooter:!0})},Z=async a=>{try{let t=[],e=0,s={ids:JSON.stringify(t)};"mysql"===I.value&&a?(t=a,e=1):"mysql"!==I.value&&a&&(t=[a.id],e=1),s=1===e?x(t,[],!1):{ids:JSON.stringify(t)};return"mysql"===I.value?await c(s,e):await _({data:JSON.stringify({type:e,ids:JSON.stringify(t)})},I.value)}catch(t){o(t,"syncDatabaseEvent")}},$=async a=>{const t=m.load("正在备份，请稍后...");try{return"mysql"===I.value?await b(a):await D({data:JSON.stringify(a)},I.value)}catch(e){o(e,"backDatabaseEvent")}finally{t.close()}},aa=async(a,t,e,s,r,o)=>{const{refreshTableList:i}=j(),{label:n,value:l}=s,{enable:m,exclude:u}=o,p=async a=>{const t=new Map([["sync",Z],["back","mysql"===I.value?g:$]]).get(l);return"mysql"===I.value&&"sync"===l?t&&await t(e.value):t&&await t(a)};await a({title:"批量".concat(n),content:"批量".concat(n,"已选数据库，是否继续操作！"),column:[{prop:"name",label:"数据库名"},h()],onConfirm:async()=>{const a=x(e.value,u,m),s="mysql"===I.value?await p(a):await t(p);if(i(),r&&r(),"mysql"===I.value){const{data:a}=A(s.data);return"sync"!==l&&X(a,{title:n}),!0}return!1}})},ta=(e,s,r)=>{const o={mysql:()=>t(()=>import("./index228.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),redis:()=>t(()=>import("./index142.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),sqlserver:()=>t(()=>import("./index229.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),mongodb:()=>t(()=>import("./index230.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),pgsql:()=>t(()=>import("./index231.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)};a({title:"添加"+I.value+"数据库",area:"redis"===I.value?44:56,compData:{refresh:()=>e(),sid:s,keyId:r},showFooter:!0,component:o[I.value]})},ea=a=>[{label:"同步数据库",value:"sync",event:aa},{label:"备份数据库",value:"back",event:aa},{label:"删除数据库",value:"delete",event:(a,t,e,s,r,o)=>K(e.value,o)}],sa={alioss:"阿里云OSS",ftp:"FTP",sftp:"SFTP",msonedrive:"微软OneDrive",qiniu:"七牛云",txcos:"腾讯COS",upyun:"又拍云",jdcloud:"京东云",aws_s3:"亚马逊存储","Google Cloud":"谷歌云","Google Drive":"谷歌网盘",bos:"百度云",obs:"华为云"},ra=async a=>{if(!a)return;const{data:t}=await e({sName:a});"pgsql_manager"===a&&t.setup?P({name:a}):T({name:t.name,type:"i",pluginInfo:t})},oa=()=>{a({title:"PHPMyAdmin",area:[74,56],component:()=>t(()=>import("./index205.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},ia=async(a,t,e,s)=>{await L({name:"数据库分类",options:e.value.filter(a=>Number(a.value)<0),selectList:a.value,request:async(e,o)=>{const{exclude:i,enable:n}=s,l=x(a.value,i,n,{params:{id:e.id}});await r({loading:"正在批量设置数据库分类，请稍后...",request:d(l),message:!0}),t(),S.value=!0,o()}})},na=async()=>await r({loading:"正在获取数据中，请稍后...",request:"mysql"===I.value?y():v({data:JSON.stringify({type:I.value})},I.value),data:Array});export{B as a,oa as b,Y as c,ea as d,z as e,J as f,C as g,H as h,G as i,K as j,k,W as l,N as m,Z as n,ta as o,ra as p,F as q,na as r,ia as s,Q as t,M as u,U as v,sa as w,X as x,$ as y};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
