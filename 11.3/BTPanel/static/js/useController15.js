import{B as e,Q as t,cf as a,a_ as s,am as l,n,H as r,M as i,ak as o,p as c,ci as u,e as d,f as p,_ as m,hy as v,hx as f,ao as h,$ as y,R as g,f0 as w,f1 as _,ag as b,j as x,bH as S,r as k,l as C,u as A,b as T,an as E,az as L}from"./utils-lib.js?v=1763689792";import{editAgainVerify as N,checkSslMethod as D,applyCertOrderPay as I,applyBusSsl as P,removeCloudCert as O,getDockerDeploySiteDomain as V,getDeploySiteDomain as R,uploadCertToCloud as j,getCertList as H,updateSslTask as q,setSslInfo as B,setProxyHttps as M,setDockerHttps as U,setSiteHttps as F,closeSiteHttps as z,downloadCert as J,ignoreHttpsMode as G,getDockerLetsEncryptSite as K,getLetsEncryptSite as X,applyCertApi as Z,applyProxyCertArrange as Y,getLetsEncryptList as Q,downloadCertToLocal as W,setDockerCertToSite as $,setCertToSite as ee,delLetsEncrypt as te,getOrderDetail as ae,authDomainApi as se,renewalCert as le,validateDomain as ne,getComposerLine as re,getDnsData as ie,setDomainDNS as oe,letCertInitApi as ce,letRenewCert as ue,reissueCertOrder as de,closeCertArrange as pe,batchSetSsl as me,setBatchCertToSite as ve,getDnsApiList as fe,setDnsApiInfo as he}from"./site.js?v=1763689792";import{_ as ye}from"./index109.js?v=1763689792";import{r as ge,e as we,D as _e,aT as be,s as xe,g as Se,o as ke,H as Ce,aA as Ae,c as Te,x as Ee,O as Le,C as Ne,N as De,A as Ie,m as Pe,z as Oe,q as Ve,y as Re,F as je,b1 as He,L as qe,B as Be,n as Me,aE as Ue,I as Fe,R as ze,J as Je,ax as Ge,az as Ke,aB as Xe,v as Ze,G as Ye,aZ as Qe,ap as We,U as $e,am as et,an as tt,a9 as at,t as st}from"./base-lib.js?v=1763689792";import{_ as lt}from"./index110.js?v=1763689792";import{a as nt,u as rt}from"./column.js?v=1763689792";import{u as it,S as ot}from"./useStore12.js?v=1763689792";import{u as ct}from"./useStore4.js?v=1763689792";import{n as ut,o as dt}from"./useController6.js?v=1763689792";import{u as pt,p as mt}from"./useController5.js?v=1763689792";import{h as vt}from"./useController4.js?v=1763689792";import{s as ft,t as ht,n as yt}from"./ssl.js?v=1763689792";import{j as gt,b as wt,h as _t,i as bt,o as xt}from"./validator.js?v=1763689792";const{certVerifyInfo:St}=it(),{verifyBusCertEvent:kt}=ot(),Ct=async e=>{try{const a={oid:St.value.oid,dcvMethod:e.value.dcvMethod,pid:St.value.pid,cert_ssl_type:St.value.certType},s=await t({loading:"正在更改验证方式，请稍后...",request:N(a),message:!0});return(null==s?void 0:s.status)&&At(a.oid,a.cert_ssl_type,a.pid),s.status}catch(a){return!1}},At=async(e,t,a)=>{const{data:s}=await kt(e,t,a);s&&wi({...s,cert_ssl_type:t,certType:t,pid:a})},Tt=e=>{if("CNAME_CSR_HASH"===Ls.value)return e.url;const t="HTTPS_CSR_HASH"===Ls.value?"https://":"http://";return"".concat(t).concat(e.url,"/.well-known/pki-validation/").concat(e.content)},Et=ge([{label:"URL",prop:"url",showOverflowTooltip:!0,render:e=>we("span",null,[Tt(e)])},{label:"验证结果",prop:"status",width:100,render:e=>we("span",{class:"".concat(e.status?"text-primary":"text-danger")},[e.status?"成功":"失败"])},{label:"自动设置验证值",prop:"verify_status",width:120,isHide:()=>"CNAME_CSR_HASH"!==Ls.value,render:e=>e.verify_status?we("span",{class:"text-primary"},[_e("成功")]):we(be,{placement:"top",content:e.msg,enterable:!1},{default:()=>[we("span",{class:"text-danger"},[_e("失败")])]})},{label:"操作",align:"right",width:160,render:(t,a)=>{const s=[];return"CNAME_CSR_HASH"===Ls.value||s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>e({value:Tt(t)})},[_e("复制")]),we(lt,null,null),we("a",{class:"bt-link",href:Tt(t),target:"_blank"},[_e("打开")]),we(lt,null,null)),s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>Ss(t,a)},[_e("重新验证")])),we("div",{class:"flex items-center justify-end"},[s])}}]),{siteInfo:Lt,siteType:Nt,isRefreshList:Dt}=ct(),{isRefreshLocalList:It}=xe(pt()),{orderInfo:Pt,sslApplicationInfo:Ot,certVerifyInfo:Vt,otherPopup:Rt,isRefreshSSL:jt,sslDnsApiInfo:Ht}=it(),{buyArtificialServiceEvent:qt,getCertAdminInfoEvent:Bt,submitCertInfoEvent:Mt,setBusSslDeployEvent:Ut,getSslListEvent:Ft,verifyBusCertEvent:zt,getCertSslListEvent:Jt,getDomainListEvent:Gt,jumpSslTabEvent:Kt}=ot(),Xt=ge(!1),Zt=ge([]),Yt=ge(!1),Qt=ge([{key:"domain",value:"",interface:""}]),Wt=["企业级证书","极速申请","防劫持/防篡改","提高SEO权重","赔付保证","不成功可退款","官方推荐(宝塔官网bt.cn也在使用)"],$t=[{content:()=>we("span",{class:"text-danger"},[_e("如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败")])},{content:"证书支持购买多年，只能一年签发一次（有效期一年），需在到期前30天内续签(续签暂不需要验证域名)。"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败。"},{content:"商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。"}],ea=e=>{let t="text-green";return e.endDate?(e.endDay<=30&&(t="text-orange"),we("span",{class:e.endDay<=10?"text-danger":t},[e.endDay>0?"剩余".concat(e.endDay," 天"):"已过期"])):we("span",null,[_e("--")])},ta=async({oid:e})=>{try{const t=await qt({pdata:JSON.stringify({oid:e})});Pt.value=t.data,n({isAsync:!0,title:"购买人工服务",area:60,component:()=>r(()=>import("./pay-ssl-service.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:t.data})}catch(t){}},aa=async e=>{const t=await Bt();Ot.value={...Ot.value,...t.data},Pt.value=e,gi({orderInfo:e})},sa=e=>{try{let t=[];return Object.keys(e).forEach(a=>{e[a].forEach(e=>{t.push({field:a,error:e})})}),{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},la=({oid:e})=>{window.open("/ssl?action=download_cert&oid=".concat(e))},na=async({oid:e,title:t,domainName:a})=>{try{const s=Lt.value.name,l=Nt.value;await c({title:"部署证书",isHtml:!0,content:"是否部署该证书,是否继续？<br>\n\t\t    证书类型：".concat(t,"<br>\n\t\t    证书支持域名：").concat(a.join("、"),"<br>\n\t\t    部署站点名:").concat(s)});const n={proxy:{oid:e,site_name:s},docker:{oid:e,site_name:s},default:{oid:e,siteName:s}},r=await Ut(n[l]||n.default);return ia(),hi(),jt.value=!0,Dt.value=!0,It.value=!0,Kt("currentCertInfo"),r}catch(s){}},ra=async(e,t,a)=>{var s;const{data:l,status:n}=await zt(e,t,a);n&&wi({...l,cert_ssl_type:t,certType:t,pid:a}),null==(s=Rt.value)||s.unmount()},ia=async()=>{try{const e=await Ft({siteName:Lt.value.name});return jt.value=!1,e}catch(e){return{data:[],total:0,other:{}}}},oa=ge(!1),ca=ge(0),ua=ge({}),da={defalutList:[],domianNumList:[],classList:[],brandList:[],typeList:[]},pa=ge({addPrice:0,productName:"",price:0,totalPrice:0,originalPrice:0,deploymentPrice:0,pid:0,years:1,yearsPrice:0,number:1,extraNumber:0,extraPrice:0,install:1}),ma=ge({num:1,certClassAcitve:"OV",certClass:[{name:"OV证书",title:"推荐企业使用",value:"OV",tips:[],data:[]},{name:"DV证书",title:"推荐个人，测试使用",value:"DV",subscript:"热销",tips:[]},{name:"EV证书",title:"推荐大型政企使用，高安全性",value:"EV",tips:[]}],certBrandAcitve:"",certBrand:[{name:"宝塔证书",title:"宝塔证书",value:"宝塔证书",tips:[]},{name:"Positive",title:"Positive",value:"Positive",tips:[]},{name:"锐安信",title:"锐安信",value:"锐安信",tips:[]},{name:"CFCA",title:"CFCA",value:"CFCA",tips:[]},{name:"Digicert",title:"Digicert",value:"Digicert",tips:[]},{name:"GeoTrust",title:"GeoTrust",value:"GeoTrust",tips:[]},{name:"Sectigo",title:"Sectigo",value:"Sectigo",tips:[]},{name:"亚洲诚信",title:"亚洲诚信",value:"亚洲诚信",tips:[]}],certTypeAcitve:"single",certType:[{name:"single",title:"单域名",value:"single",tips:[]},{name:"multiple",title:"多域名",value:"multiple",tips:[]},{name:"wildcard",title:"泛域名",value:"wildcard",tips:[]},{name:"ip",title:"IP证书",value:"ip",tips:[]}],certLifeAcitve:1,certLife:[{name:"1年",title:"1年",value:1,tips:[]},{name:"2年",title:"2年",value:2,tips:[]},{name:"3年",title:"3年",value:3,tips:[]},{name:"4年",title:"4年",value:4,tips:[]},{name:"5年",title:"5年",value:5,tips:[]}],certDeployAcitve:1,certDeploy:[{name:"不需要",title:"不需要",value:0,tips:[]},{name:"部署服务",title:"部署服务",value:1,tips:[]},{name:"部署服务（国密）",title:"部署服务（国密）",value:2,tips:[]}]}),va={single:["仅支持绑定一个二级域名或者子域名，例如 bt.com、cloud.bt.com、dnspod.cloud.bt.com的其中之一 。","如需要绑定同级的所有子域名，例如*.bt.com，请购买泛域名证书。"],wildcard:["带通配符的域名，例如：*.bt.com、*.cloud.bt.com均为泛域名，包含同一级的全部子域名。","注意泛域名不支持跨级，例如*.bt.com 不包含 *.cloud.bt.com的支持"]},fa={0:[],1:["宝塔提供9:00 - 24:00的人工部署证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"],2:["宝塔提供9:00 - 24:00的人工部署国密算法证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"]},ha=Se(()=>{const e=ma.value.certClass.filter(e=>e.value===ma.value.certClassAcitve);return e&&e.length>0?e[0].tips:[]}),ya=Se(()=>{const e=ma.value.certBrand.filter(e=>e.value===ma.value.certBrandAcitve);return e&&e.length>0?e[0].tips:[]}),ga=Se(()=>{const e=ma.value.certType.filter(e=>e.value===ma.value.certTypeAcitve);return e&&e.length>0?e[0].tips:[]}),wa=Se(()=>{const e=ma.value.certLife.filter(e=>e.value===parseInt(ma.value.certLifeAcitve));return e&&e.length>0?e[0].tips:[]}),_a=Se(()=>{const e=ma.value.certDeploy.filter(e=>e.value===parseInt(ma.value.certDeployAcitve));return e&&e.length>0?e[0].tips:[]}),ba=async()=>{try{oa.value=!0;const{data:e,status:t}=await Jt();if(oa.value=!1,!t)return i.request({msg:"获取证书列表失败",status:!1}),{status:!1,msg:"获取证书列表失败"};ua.value=e.info.recommend,Ca(),Ta(e.info),La(e.data),Na()}catch(e){return{status:!1,msg:"获取证书列表失败"}}},xa=(e=ma.value.num)=>{let t=e;if(o(e)&&"number"!=typeof e?(e=Number(e.data),t=Number(ma.value.num)||1):t=Number(ma.value.num+e)||1,t&&(t<1||t>99))return ma.value.num=t<1?1:99,i.error("域名数量范围为1-99");ma.value.num=t,"wildcard"!==ma.value.certTypeAcitve&&(ma.value.certTypeAcitve=ma.value.num>1?"multiple":"single"),Na()},Sa=(e,t,a)=>{a||(a=ma.value[t].filter(t=>t.value===e)),a.disable||("".concat(t,"Acitve")in ma.value&&(ma.value["".concat(t,"Acitve")]=e),"certClass"==t&&(ma.value.certBrandAcitve=ka()),Na())},ka=()=>{var e;return ua.value[null==(e=ma.value.certClassAcitve)?void 0:e.toLowerCase()]},Ca=()=>{ma.value.certClassAcitve="DV",ma.value.certBrandAcitve=ka(),ma.value.certTypeAcitve="single",ma.value.certLifeAcitve=1,ma.value.certDeployAcitve=1},Aa=(e,t,a)=>e.map((e,s)=>{const l=a?a(e,t):t[e.value];return{...e,tips:l}}),Ta=({type:e,brand:t,times:a})=>{ma.value.certClass=Aa(ma.value.certClass,e,(e,t)=>t["".concat(e.value).toLowerCase()]),va.multiple=va.single,ma.value.certType=Aa(ma.value.certType,va),ma.value.certDeploy=Aa(ma.value.certDeploy,fa),ma.value.certBrand=Aa(ma.value.certBrand,t,(e,t)=>t["Positive"!==e.value?"".concat(e.value).toLowerCase():"Positive"]),ma.value.certLife=Aa(ma.value.certLife,a,(e,t)=>t[e.value+"_year"])},Ea=(e={})=>{let{num:t,classify:a,brand:s,type:l,life:n,deploy:r}=e;const i=ma.value;return t||(t=i.num),a||(a=i.certClassAcitve),s||(s=i.certBrandAcitve),l||(l=i.certTypeAcitve),n||(n=i.certLifeAcitve),r||(r=i.certDeployAcitve),{num:t,classify:a,brand:s,type:l,life:n,deploy:r}},La=e=>{const t=[];e.forEach(e=>{var a;const s=null==(a=e.type.match(/(OV|DV|EV)/))?void 0:a[0],l=-1!==e.code.indexOf("wildcard"),n=-1!==e.code.indexOf("ip"),r=e.add_price>0;let i=l?"wildcard":r?"multiple":"single";"Digicert"===e.brand&&(i=l?"wildcard":"single"),t.push({...e,type:s,certType:i,isMulti:r,isIp:n})}),da.defalutList=t},Na=()=>{Da(da.defalutList),Va(),Ra()},Da=e=>{let{num:t}=Ea();const a=e.filter(e=>!(t>1)||e.isMulti);a.length>0&&(da.domianNumList=a,Ia(a))},Ia=e=>{const{classify:t}=Ea(),a=e.filter(e=>e.type===t);a.length>0&&(da.classList=a,Pa(a))},Pa=e=>{const{brand:t}=Ea(),a=e.filter(e=>e.brand===t);a.length>0&&(da.brandList=a,Oa(a))},Oa=e=>{const{type:t}=Ea();1===e.length&&(ma.value.certTypeAcitve=e[0].certType);const a=e.filter(e=>{const a="multiple"===ma.value.certTypeAcitve&&"wildcard"!==e.certType&&e.isMulti,s="wildcard"===ma.value.certTypeAcitve&&"wildcard"===e.certType&&e.isMulti,l="ip"===ma.value.certTypeAcitve&&e.isIp;return e.certType===t||a||s||l});a.length>0&&(da.typeList=a)},Va=()=>{const{domianNumList:e,classList:t,brandList:a,typeList:s}=da;ma.value.certClass.forEach(t=>{let a=e.some(e=>e.type===t.value);"EV"==t.value&&"wildcard"===ma.value.certTypeAcitve&&(a=!1),t.disable=!a}),ma.value.certBrand.forEach(e=>{var a,s,l;const n=!t.some(t=>t.brand===e.value);if(e.hidden=n,e.subscript=e.value===ka()?"推荐":"",e.value===ma.value.certBrandAcitve&&e.hidden){ma.value.certBrandAcitve=ka(),e.value===ma.value.certBrandAcitve&&e.hidden&&(ma.value.certBrandAcitve=null==(s=null==(a=null==da?void 0:da.classList)?void 0:a[0])?void 0:s.brand);const t=null==(l=null==da?void 0:da.classList)?void 0:l.filter(e=>e.brand===ma.value.certBrandAcitve);t.length>0&&(da.brandList=t,Oa(t))}}),ma.value.certType.forEach(e=>{let t=!a.some(t=>!(!t.isIp||"ip"!==e.value)||t.certType===e.value);"single"===e.value&&ma.value.num>1&&(t=!0),"multiple"===e.value&&1===ma.value.num&&(t=!0),"multiple"===e.value&&ma.value.num>1&&(t=!1),"ip"===e.value&&ma.value.num>1&&(t=!0),e.hidden=t}),"CFCA"!==ma.value.certBrandAcitve&&2===ma.value.certDeployAcitve&&(ma.value.certDeployAcitve=1)},Ra=()=>{const e=da.typeList[0]||null;if(ca.value=(null==e?void 0:e.num)||0,e){const{num:t,life:a,deploy:s}=Ea(),{price:l,other_price:n,add_price:r,pid:i,num:o,install_price:c,install_price_v2:u}=e,d=t-o<0?0:t-o,p=[0,c,u][s],m=r*d,v=(m+l)*a+p,f=n+m+p;pa.value={addPrice:r||0,productName:e.title,price:l,totalPrice:v,originalPrice:f,deploymentPrice:p,pid:i,years:a,yearsPrice:l*a,number:o,extraNumber:d,extraPrice:m,install:Number(s)}}},ja=ge({oid:0,wxcode:"",alicode:"",qq:"",orderInfo:{}}),Ha=async e=>{const{pid:a,install:s,years:l,extraNumber:n}=pa.value,r={pdata:JSON.stringify({pid:a,install:s,years:l,num:n})},{data:o,msg:c}=await t({loading:"正在创建商业证书订单，请稍后...",request:I(r)}),{status:u}=o;if(!u)return i.error(c);const{oid:d,wxcode:p,alicode:m,qq:v,order_info:f}=o.msg;ja.value={oid:d,wxcode:p,alicode:m,qq:v,orderInfo:f},Ui({...ja.value,productInfo:pa.value})},qa=[{content:"通配符证书只支持DNS验证"}],Ba=[{content:"多域名只支持DNS验证"}],Ma=ge(!1),Ua=ge(!1),Fa=ge(""),za=ge(""),Ja=ge([]),Ga=ge([]),Ka=ge(!1),Xa=ge(),Za=ge({domain:""}),Ya=ge("CNAME_CSR_HASH"),Qa=ge(!0),Wa=ge("dns"),$a=ge(!1),es=ge(!1),ts=ge(!1),as=ge([]),ss=[{content:"https或者http验证，必须保证网站能通过http/https访问"},{content:"域名前缀是www,提醒用户解析上级根域名，如申请www.bt.cn，请确保解析bt.cn"},{content:()=>we("a",{class:"text-primary",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])}],ls=[{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败"},{content:"SSL证书可选名称赠送规则："},{content:"1、申请根域名(如：bt.cn),赠送下一级为www的域名(如：www.bt.cn)"},{content:"2、申请当前host为www的域名（如：www.bt.cn）,赠送上一级域名，(如: bt.cn)"},{content:"3、申请其它二级域名，(如：app.bt.cn)，赠送下一级为www的域名 (如：www.app.bt.cn)"}],ns=ge([{value:"CNAME_CSR_HASH",label:"DNS验证(CNAME解析)",tips:"如网站还未备案完成，可选【DNS验证】",isCheck:"",checkTips:[]},{value:"HTTP_CSR_HASH",label:"文件验证(HTTP)",tips:"如网站未开启301、302、强制HTTPS、反向代理功能，请选择HTTP",isCheck:"",checkTips:[]},{value:"HTTPS_CSR_HASH",label:"文件验证(HTTPS)",tips:"如网站开启【强制HTTPS】，请选【HTTPS验证】",isCheck:"",checkTips:[]}]),rs=(e,t,a)=>{switch(t&&(Ya.value="HTTP_CSR_HASH"),a.value){case"CNAME_CSR_HASH":return!t;case"HTTP_CSR_HASH":case"HTTPS_CSR_HASH":return!e}},is=[{content:"OV/EV证书申请流程条件："},{content:"1、填写网站验证信息(文件验证或DNS验证)"},{content:"2、完成邮箱认证，根据CA发送的邮件完善邮件内容(中文填写即可)"},{content:"3、企查查或者爱企查、百度地图、114best能查询到相关企业信息，且公司名和公司地址完全匹配"},{content:"4、企查查或其他平台留下的电话能保证周一到周五(7:00 - 15:00)能接听到CA的认证电话，电话号码归属地来自美国，请留意接听。"}],os=Se(()=>{const e=[];return es.value&&e.push(...qa),$a.value&&e.push(...Ba),e.push(...ss),"dv"!==Pt.value.type&&e.push(...is),e}),cs=Se(()=>{const e=es.value?"*":"www";return $a.value?"请输入".concat(es.value?"通配符":"","证书域名，例如：").concat(e,".bt.cn"):"请输入需要申请证书的域名（单域名".concat(es.value?"通配符":"","证书），例如：").concat(e,".bt.cn")}),us=ge({domains:"",interface:"",dcvMethod:"",auth_to:"",Administrator:{address:"",city:"",country:"",email:"",firstName:"",lastName:"",job:"",name:"",mobile:"",organation:"",postCode:"",state:""}}),ds=Se(()=>us.value.Administrator.lastName+us.value.Administrator.firstName),ps=()=>{ms(),us.value.Administrator={...Ot.value,name:""},us.value.Administrator.name=ds.value;const{pid:e,oid:t,title:a,limit:s,install:l,code:n}=Pt.value,r=n.indexOf("ev")>-1?"ev":n.indexOf("ov")>-1?"ov":"dv";$a.value=n.indexOf("multi")>-1,es.value=n.indexOf("wildcard")>-1,ts.value=n.indexOf("ip")>-1,Pt.value={pid:e,oid:t,title:a,limit:s,install:l,isMulti:$a.value,isWildcard:es.value,isIp:ts.value,type:r}},ms=async()=>{var e,t;try{const{data:a}=await ht();as.value=a.map(e=>({label:e.ps?"".concat(e.dns_name," - ").concat(e.ps):e.dns_name,value:e.id,domains:e.domains,ps:e.ps}));const{limit:s}=Pt.value;if(!$a.value)return us.value.interface=null==(t=null==(e=as.value)?void 0:e[0])?void 0:t.value;Qt.value=Array.from({length:s},(e,t)=>{var a,s;return{key:"domain_".concat(t+1),value:"",interface:(null==(s=null==(a=as.value)?void 0:a[0])?void 0:s.value)||""}})}catch(a){}},vs=async()=>{var e,t;try{const a=await Gt();Ja.value=a.data.map(e=>({label:e.name,value:e.name,...e})),Ma.value=!0,za.value=(null==(t=null==(e=Ja.value)?void 0:e[0])?void 0:t.name)||"",Ga.value=Ja.value}catch(a){}},fs=e=>{Ja.value=[],Ga.value.forEach(t=>{t.name.indexOf(e)>-1&&Ja.value.push(t)}),Ja.value.length||(Ja.value=Ga.value)},hs=async()=>{us.value.domains=za.value,Ma.value=!1,es.value||ys()},ys=async()=>{Ka.value=!0;const{data:e}=await D(za.value);Ka.value=!1,ns.value.forEach(t=>{l(e[t.value])?(t.isCheck=!!e[t.value],t.checkTips=!!e[t.value]):(t.isCheck=!1,t.checkTips=e[t.value])})},gs=ke({domain:[a({message:"域名不能为空"}),{validator:(e,t,a)=>{s(t)?!es.value&&t.indexOf("*")>-1?a(new Error("当前为单域名证书，不支持通配符申请")):a():a(new Error("域名格式错误，请重新输入"))},trigger:["change"]}]}),ws=()=>{Ua.value=!0},_s=async()=>{var e;await(null==(e=Xa.value)?void 0:e.validate()),us.value.domains=Za.value.domain,Ua.value=!1,es.value||ys()},bs=e=>{const t=Wa.value;if("dns"!==t){const a=Ht.value.find(e=>e.value===t);if(a){const t=!a.data;(!e||e&&t)&&xi({title:"设置".concat(a.info.title,"接口"),row:a.info})}}},xs=async(e,t)=>{var a;let s=null;if(!e.value.domains&&!$a.value)return i.error("域名不能为空");if(Pt.value.isIp&&!u(e.value.domains))return i.error("IP证书申请域名格式错误，请输入正确的ipv4地址");if(!e.value.Administrator.state&&!e.value.Administrator.city)return i.error("所在地区不能为空");if(!e.value.Administrator.address&&"dv"!==Pt.value.type)return i.error("公司详细地址不能为空");if(!e.value.Administrator.organation)return i.error("公司名称不能为空");if(!e.value.Administrator.name)return i.error("姓名不能为空");if(!e.value.Administrator.email)return i.error("邮箱不能为空");if(!e.value.Administrator.mobile)return i.error("手机不能为空");try{s=i.load("正在提交证书信息，请稍后...");const{job:l,postCode:n,country:r,firstName:c,lastName:u,name:d,state:p,city:m,address:v,organation:f,email:h,mobile:y}=e.value.Administrator,g=await P(JSON.stringify({pid:Pt.value.pid,cert_ssl_type:t,oid:Pt.value.oid,domains:$a.value?Qt.value.map(({value:e})=>null==e?void 0:e.trim()):[us.value.domains.trim()],dcvMethod:Ya.value,auth_to:Wa.value,Administrator:{job:l,postCode:n,country:r,lastName:d,state:p,city:m,address:v,organation:f,email:h,mobile:y}}));if(o(g.data.msg)&&g.data.msg.hasOwnProperty("code")){let e=g.data.errors;Zt.value=[],Object.keys(e).forEach(t=>{e[t].forEach((e,a)=>{Zt.value.push({field:t,error:e})})}),Xt.value=!0}else{let e=g.msg||g.data.msg,t=g.data.status;i.request(g.data||{msg:t?e||"提交成功":e||"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:t})}if(g.data.status){jt.value=!0;const{data:e,status:s}=await zt(Pt.value.oid,t,Pt.value.pid);e&&(e.auto_verify_info={interface:$a.value?Qt.value:us.value.interface,set_verify_value:!0},wi({...e,cert_ssl_type:t,certType:t,pid:Pt.value.pid})),null==(a=Rt.value)||a.unmount()}}catch(l){}finally{s&&s.close()}},Ss=async(e,a)=>{const s="CNAME_CSR_HASH"===Ls.value,{DCVdnsValue:l,DCVdnsHost:n,DCVfileContent:r,DCVfileName:i,DCVdnsType:o}=Vt.value.data;try{const c=s?[{record_type:o,sub_domain:n,dns_value:l,dns_id:"",domain:e.url}]:[{file_name:"/.well-known/pki-validation/".concat(i),file_value:r,domain:e.url}],{data:u}=await t({loading:"正在验证商用证书，请稍后...",request:ft({verify_type:s?"dns":"file",verify_data:JSON.stringify(c),set_verify_value:!1})}),{local_verify:d,status:p}=u.data[0].rep;Ns.value[a].status=d,Ns.value[a].verify_status=p}catch(c){}},ks=async()=>{var e,t;const{data:a}=await zt(Vt.value.oid,Vt.value.cert_ssl_type,Vt.value.pid);a&&(Vt.value=a),await Ts(),"PENDING"===(null==(e=Vt.value)?void 0:e.certStatus)&&i.success("验证中，请耐心等待！"),"COMPLETE"===(null==(t=Vt.value)?void 0:t.certStatus)&&i.success("验证成功！"),Rt.value.unmount(),jt.value=!0},Cs=e=>{let t=Vt.value.res&&Vt.value.res.verification&&-1==Vt.value.res.verification.indexOf("dns");Es({oid:Vt.value.oid,type:Ls.value,certType:Vt.value.certType,pid:Vt.value.pid,isIp:t})},As=ge([{content:"本次验证结果是由【本服务器验证】，实际验证将由【CA服务器】进行验证，请耐心等候"},{content:"请确保以上列表所有项都验证成功后点击【验证域名】重新提交验证"},{content:"如长时间验证不通过，请通过【修改验证方式】更改为【DNS验证】"},{content:()=>we("span",null,[_e("如何添加域名解析，《"),we("a",{href:"https://cloud.tencent.com/document/product/302/3446",class:"text-primary",target:"__blink"},[_e("点击查看教程")]),_e("》，和咨询服务器运营商")])}]),Ts=async()=>{var e;if(null==(e=Vt.value)?void 0:e.data){const{data:{dcvList:e,DCVdnsHost:a,DCVdnsType:s,DCVdnsValue:l,DCVfileName:n,DCVfileContent:r},paths:i,auto_verify_info:o}=Vt.value;Ds.value=null==e?void 0:e.map(e=>e.domainName).join(","),Ls.value=e[0].dcvMethod;const c={dnsHost:a,dnsType:s,dnsValue:l,fileName:n,fileContent:r,filePath:"/.well-known/pki-validation/"};return(async()=>{var e;Yt.value=!0;const{auto_verify_info:a}=St.value,{dcvList:s,DCVdnsValue:l,DCVdnsHost:n,DCVfileContent:r,DCVfileName:i,DCVdnsType:o}=St.value.data,c="CNAME_CSR_HASH"===Ls.value;let u=[];try{const d=e=>{if(!a)return"";if("string"==typeof a.interface)return a.interface;const t=((null==a?void 0:a.interface)||[]).find(t=>(null==t?void 0:t.value)===e);return(null==t?void 0:t.interface)||""};u=c?null==s?void 0:s.map(e=>({record_type:o,sub_domain:n,dns_value:l,dns_id:d(e.domainName),domain:e.domainName})):null==s?void 0:s.map(e=>({file_name:"/.well-known/pki-validation/".concat(i),file_value:r,domain:e.domainName}));const{data:p}=await t({request:ft({verify_type:c?"dns":"file",verify_data:JSON.stringify(u),set_verify_value:Boolean(a)})});Ns.value=null==(e=p.data)?void 0:e.map(e=>({url:e.domain,status:e.rep.local_verify,verify_status:e.rep.status,msg:e.rep.msg,content:i}))}catch(d){}finally{Yt.value=!1}})(),"CNAME_CSR_HASH"!==Ls.value&&As.value.splice(3,1,{content:()=>we("span",null,[_e("SSL添加文件验证方式 ->> "),we("a",{href:"https://www.bt.cn/bbs/thread-56802-1-1.html",target:"_blank",class:"text-primary"},[_e("查看教程")])])}),c}return i.error("获取数据失败"),{}},Es=e=>n({title:"验证域名-"+(e.type.indexOf("CNAME_")>-1?"DNS验证":"文件验证"),area:52,showFooter:!0,btn:["更改","取消"],component:()=>r(()=>import("./modify-verify-way.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e}),Ls=ge(""),Ns=ge([]),Ds=ge(),Is=e=>{const t=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),a=t("人工服务",()=>gt()),s=t("详情",()=>(e=>{n({title:"多年期证书详情",area:52,compData:e,component:()=>r(()=>import("./mulit-cert-detail.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})})(e)),l=t("下载",()=>la(e)),i=t("部署",()=>na(e)),o=t("验证",()=>ra(e.oid,e.cert_ssl_type,e.pid)),c=t("续签",()=>Mi(e.oid)),u=t("完善资料",()=>aa(e)),d=e.orderStatus,p=[];switch(e.years&&e.years>1&&[5,15].includes(Number(d))&&p.push(s),Number(d)){case 0:e.install&&p.push(a),p.push(u);break;case 3:case 11:e.install&&p.push(a),p.push(o);break;case 5:p.push(i),p.push(l);break;case 7:p.push(c)}const m=[];return p.map((e,t)=>{m.push(e),t<p.length-1&&m.push(we(lt,null,null))}),m},Ps={id:"wechat-customer",class:"wechat-customer"},Os={class:"w-full h-[46px] flex flex-row items-center justify-center"},Vs={class:"qrcode-wechat w-[128px] h-[128px] m-[8px_0_4px_0]"},Rs={id:"wechatCustomerQrcode"},js=m(Te({__name:"customer-popover",props:{trigger:{default:"click"},showArrow:{type:Boolean,default:!0},placement:{default:"left"}},setup(e,{expose:t}){const a=e,s=ge(null),l=Se(()=>a.trigger),n=Se(()=>a.showArrow),r=Se(()=>a.placement);return t({BtCustomerPopover:()=>s}),(e,t)=>{const a=d,i=p,o=Ae;return Ee(),Le(o,Pe({ref_key:"BtCustomerPopover",ref:s},e.$attrs,{trigger:Oe(l),placement:Oe(r),effect:"light","popper-class":"BtCustomerPopover","show-arrow":Oe(n),"popper-style":{padding:"0",border:"0",background:"0"}}),{reference:Ne(()=>[De(e.$slots,"default",{},void 0,!0)]),default:Ne(()=>[Ie("div",Ps,[Ie("div",Os,[we(a,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-[16px] flex flex-row flex-nowrap items-center"},{default:Ne(()=>[...t[0]||(t[0]=[Ie("div",{class:"flex items-center border-b border-solid border-[var(--el-color-primary-light-9)] pb-4px"},[_e(" 点击咨询客服 "),Ie("i",{class:"svgtofont-el-d-arrow-right ml-4px w-[15px]"})],-1)])]),_:1})]),Ie("div",Vs,[Ie("div",Rs,[we(i,{src:"/customer/customer-qrcode.png"})])]),t[1]||(t[1]=Ie("div",{class:"wechat-title"},[Ie("img",{class:"icon",style:{width:"17px",height:"17px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),Ie("div",{class:"scan-title",style:{"font-size":"16px"}},"扫一扫")],-1)),t[2]||(t[2]=Ie("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[Ie("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]),_:3},16,["trigger","placement","show-arrow"])}}}),[["__scopeId","data-v-9064b685"]]),Hs={class:"h-full"},qs={class:"recommendList"},Bs={class:"text-small ml-[8px] text-stroke-primary"},Ms={class:"flex flex-col w-full pt-[16px]"},Us={class:"flex items-center"},Fs={class:"flex items-center"},zs=m(Te({__name:"index",setup(e,{expose:t}){const{sslAlertState:a,isRefreshSSL:s}=it(),{BtTable:l,BtRefresh:n,refresh:r}=v({request:ia,columns:[{label:"域名",prop:"domainName",width:120,render:(e,t)=>we("span",{class:"w-full whitespace-pre-line"},[e.domainName?e.domainName.join("、"):"--"])},{label:"证书类型",prop:"title",showOverflowTooltip:!0},{label:"到期时间",width:100,render:ea,showOverflowTooltip:!0},{label:"状态",prop:"expire",width:160,showOverflowTooltip:!1,render:(e,t)=>{const a=[],s=(e,t)=>we("span",{style:"color: ".concat(e,";")},[t]),l=we(Ae,{placement:"bottom-end",width:"400","popper-class":"white-theme",trigger:"click"},{default:()=>we("div",{class:"bus-ssl-popover"},[we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("自行排查")]),we("p",null,[_e("以图文的形式，一步步教您验证并部署商业SSL")]),we("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])]),we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("购买人工")]),we("p",null,[_e("不会部署?人工客服帮你全程部署，不成功可退款")]),we(Ce,{size:"small",type:"primary",onClick:()=>ta(e)},{default:()=>[_e("购买人工")]})])]),reference:()=>we("span",{class:"bt-link"},[_e("排查方法?")])});if(e.cert_ssl_type)return(e=>{const t=we(Ae,{placement:"bottom-end",width:"400","popper-class":"white-theme",trigger:"click"},{default:()=>we("div",{class:"bus-ssl-popover"},[we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("自行排查")]),we("p",null,[_e("以图文的形式，一步步教您验证并部署商业SSL")]),we("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])]),we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("购买人工")]),we("p",null,[_e("不会部署?人工客服帮你全程部署，不成功可退款")]),we(Ce,{size:"small",type:"primary",onClick:()=>ta(e)},{default:()=>[_e("购买人工")]})])]),reference:()=>we("span",{class:"bt-link"},[_e("排查方法?")])}),a=e.orderStatus,s=[];switch(Number(a)){case-1:s.push(we("span",{class:"text-danger"},[_e("已取消")]));break;case 0:s.push(we("span",{class:"text-warning"},[_e("待完善资料")])),e.install||s.push(t);break;case 1:s.push(we("span",{class:"text-warning"},[_e("待审核")]));break;case 2:s.push(we("span",{class:"text-warning"},[_e("正在提交CA")]));break;case 3:s.push(we("span",{class:"text-warning"},[_e("待域名验证")]));break;case 4:s.push(we("span",{class:"text-warning"},[_e("签发中")]));break;case 5:s.push(we("span",{class:"text-success"},[_e("已签发")]));break;case 6:s.push(we("span",{class:"text-warning"},[_e("取消确认")]));break;case 7:s.push(we("span",{class:"text-warning"},[_e("待续费")]));break;case 8:s.push(we("span",{class:"text-warning"},[_e("待吊销确认")]));break;case 9:s.push(we("span",{class:"text-warning"},[_e("待重颁发")]));break;case 10:s.push(we("span",{class:"text-warning"},[_e("重颁发中")]));break;case 11:s.push(we("span",{class:"text-warning"},[_e("吊销中")]));break;case 12:s.push(we("span",{class:"text-danger"},[_e("已吊销")]));break;default:s.push(we("span",{class:"text-warning"},[_e("待完善资料")]))}const l=[];return s.map((e,t)=>{l.push(e),t<s.length-1&&l.push(we(lt,null,null))}),l})(e);let n=e.domainName&&e.domainName.length>0;if(""!=e.certId||n)if(""==e.certId&&0!==e.domainName.length)a.push(we("span",{class:"bt-warn"},[_e("待提交")]));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":a.push(s("primary","订单完成"));break;case"PENDING":a.push((r="orange",i="验证中",we(Ae,{trigger:"hover",placement:"left","popper-class":"popover-default",width:"300",enterable:!1,"open-delay":100,"close-delay":0},{default:()=>we("div",{class:"flex items-center p-[2px] whitespace-nowrap"},[_e("1、如填写错误，联系人工可重置订单"),we("br",null,null),_e("2、如验证方式选择错误，联系人工修改验证方式")]),reference:()=>we("div",{style:"color: ".concat(r,";")},[i])})));break;case"CANCELLED":a.push(s("medium","已取消"));break;case"REISSUED":a.push(s("primary","已重签"));break;case"FAILED":a.push(s("danger","申请失败"));break;case"EXPIRED":a.push(s("medium","已过期"));break;default:a.push(s("orange","待验证"))}else switch(e.status){case 0:a.push(s("orange","未支付"));break;case-1:a.push(s("medium","已取消"))}else a.push(we("span",{class:"bt-warn",onClick:()=>aa(e)},[_e("待完善资料")])),a.push(l);var r,i;const o=[];return a.map((e,t)=>{o.push(e),t<a.length-1&&o.push(we(lt,null,null))}),o}},{label:"操作",prop:"ps",width:170,align:"right",render:(e,t)=>{if(e.cert_ssl_type)return Is(e);const a=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),s=a("人工服务",()=>gt()),l=a("下载",()=>la(e)),n=a("部署",()=>na(e)),r=a("验证",()=>ra(e.oid,e.cert_ssl_type,e.pid)),o=a("续签",()=>Mi(e.oid)),c=[],u=e.domainName&&e.domainName.length>0;if(""!=e.certId||u)if(""==e.certId&&0!==e.domainName.length)c.push(a("提交",()=>(async e=>{try{const{data:t}=await Mt({oid:e.oid});if(-1===t.code&&t.errors)sa(t.errors),Xt.value=!0;else{let a=t.msg||t.data.msg,s=t.status;i.request({msg:s?a||"提交成功":"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:s}),s&&ra(e.oid,e.cert_ssl_type,e.pid)}ia()}catch(t){}})(e)));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":1===e.ssl_state?c.push(we("span",null,[_e("已部署")])):c.push(n),e.endDay<30&&c.push(o),c.push(l);break;case"PENDING":default:e.install&&c.push(s),c.push(r);break;case"CANCELLED":c.push(we("span",null,[_e("无操作")]));break;case"FAILED":c.push(we("span",{class:"bt-danger cursor-default"},[_e("申请失败")]));break;case"EXPIRED":c.push(n),c.push(l);case"REISSUED":}else c.push(we("span",null,[_e("无操作")]));else e.install&&c.push(s),c.push(a("完善资料",()=>aa(e)));const d=[];return c.map((e,t)=>{d.push(e),t<c.length-1&&d.push(we(lt,null,null))}),d}}],extension:[f(),h(s)]}),o=Ve(()=>{const e=document.querySelector("#pane-busSslList");e&&e.click()},1e3);return t({init:r}),(e,t)=>{const s=Ce,r=p,i=ye,c=y;return Ee(),Re("div",Hs,[Ie("div",qs,[(Ee(!0),Re(je,null,He(Oe(Wt),(e,a)=>(Ee(),Re("div",{key:a,class:qe("".concat(6===a?"w-[22rem]":"w-[14rem]"," recomItem"))},[t[0]||(t[0]=Ie("i",{class:"svgtofont-el-check font-bold text-[#ff8d00] text-medium"},null,-1)),Ie("span",Bs,Be(e),1)],2))),128))]),Ie("div",Ms,[we(i,null,{"header-left":Ne(()=>[Ie("div",Us,[we(s,{type:"primary",onClick:Oe(mi),class:"mr-4"},{default:Ne(()=>[...t[1]||(t[1]=[_e(" 申请证书 ",-1)])]),_:1},8,["onClick"]),we(js,{placement:"right"},{default:Ne(()=>[Ie("div",Fs,[we(r,{src:"/static/icons/we-com.svg",class:"mx-[4px] w-2rem h-2rem",all:!0}),t[2]||(t[2]=Ie("span",{class:"bt-link"},"售前客服",-1))])]),_:1})])]),"header-right":Ne(()=>[we(Oe(n))]),content:Ne(()=>[we(Oe(l),{"max-height":Oe(a)?320:380,onWheel:Oe(o)},null,8,["max-height","onWheel"])]),_:1})]),we(c,{options:Oe($t),listStyle:"disc"},null,8,["options"])])}}}),[["__scopeId","data-v-4fa3e526"]]),{siteType:Js,siteInfo:Gs}=ct(),{isRefreshSSL:Ks}=it(),Xs=[{label:"所有",value:0},{label:"未过期",value:1},{label:"即将过期",value:2},{label:"已过期",value:3}],Zs=ge(!1),Ys=ge(),Qs=ge({}),Ws=ge(!1),$s=ke({typeValue:"全部",btnText:"部署证书",search:"",data:{all:[],site:[]},siteList:[]}),el=async(e=Js.value)=>{if(0===$s.siteList.length)return void i.error("请选择站点");const{hash:t,subject:a}=Qs.value;await _i({hash:t,subject:a,list:$s.siteList,type:e}),Ws.value=!1},tl=async e=>{await c({title:"删除证书",content:"删除后该证书将不会显示在证书夹，是否继续操作？",icon:"warning-filled"}),await t({loading:"正在删除证书...",request:O({local:e.cloud_id>0?0:1,ssl_hash:e.hash}),message:!0}),nl.value=!0};ge([nt(),{label:"站点名称",prop:"name",render:e=>e.current?e.name+"(当前站点)":e.name}]);const al=async e=>{let a={},s=!0;void 0!==e&&(a={cert_list:JSON.stringify(e.dns)},s=!1,Qs.value=e);const l=await t({request:"docker"===Js.value?V(a):R(a),data:{all:Array,site:Array}});$s.data={all:l.all.map(e=>({name:e})),site:l.site.map(e=>({name:e}))},s||(Ws.value=!0,Me(()=>{var e;$s.data.all.forEach((e,t)=>{e.name===Gs.value.name&&(e.current=!0,$s.data.all.unshift($s.data.all.splice(t,1)[0]))}),null==(e=Ys.value)||e.toggleRowSelection($s.data.all.find(e=>e.name===Gs.value.name),!0)}))},sl=e=>{$s.siteList=e,e.length<=0?$s.btnText="部署证书":$s.btnText="部署证书[已选择".concat(e.length,"项]")},ll=e=>{$s.typeValue=e},nl=ge(!1),rl=async()=>{nl.value=!0,Ks.value=!0,i.success("获取成功")},il=async(e,a=nl.value)=>{try{const s={search_limit:e.search_limit,search_name:e.search,force_refresh:Number(a)};nl.value=!1;const{data:l}=await t({loading:Zs,request:H(s)});return g(l)||i.request(l),a&&i.success("获取成功"),{data:l,total:0,other:{}}}catch(s){return{data:[],total:0,other:{}}}},ol={class:"relative h-[45rem]"},cl={class:"p-[20px]"},ul={class:"flex flex-col p-[12px] bg-light"},dl={class:"mb-[4px]"},pl={class:"mb-[4px]"},ml={class:"mb-[4px]"},vl={class:"flex justify-between mb-[1rem]"},fl={class:"absolute bottom-0 w-full bg-light flex items-center justify-end p-[12px]"},hl=Te({__name:"index",setup(e,{expose:a}){it();const s=_({key:"search_limit",options:Xs,other:{class:"!w-[10rem] mr-1rem",filterable:!0}}),{BtTable:l,BtSearch:n,BtTableSelect:r,refresh:i}=w({request:il,columns:[{label:"域名",prop:"subject",render:e=>{var t;return Ue("div",{class:"whitespace-pre-wrap"},(null==(t=e.dns)?void 0:t.join("\n"))||e.subject)}},{label:"到期时间",prop:"not_after"},{label:"品牌",prop:"info.issuer",showOverflowTooltip:!0},{label:"位置",render:e=>e.cloud_id>0?"云端":"本地"},rt([{onClick:async e=>{await(async e=>{try{await c({title:"上传云端证书",content:"将会上传证书信息至云端进行替换，是否继续操作？",icon:"warning-filled",type:"calc"}),await t({loading:"正在上传证书至云端...",request:j({ssl_hash:e.hash}),message:!0}),Ks.value=!0}catch(a){}})(e),i()},width:60,title:"上传云端",isHide:e=>e.cloud_id>0},{onClick:al,title:"部署"},{onClick:tl,title:"删除"}])],extension:[s,h(nl)]});return a({init:i}),(e,t)=>{const a=Ce,s=b,i=Ge,o=Ke,c=x,u=ye,d=Fe("bt-loading");return Ee(),Re("div",null,[we(u,null,{"header-left":Ne(()=>[we(a,{type:"default",onClick:Oe(rl)},{default:Ne(()=>[...t[4]||(t[4]=[_e(" 从云端同步 ",-1)])]),_:1},8,["onClick"])]),"header-right":Ne(()=>[Ie("div",null,[we(Oe(r))]),we(Oe(n),{class:"w-[30rem]",placeholder:"请输入域名搜索"})]),content:Ne(()=>[we(Oe(l),{"max-height":500})]),popup:Ne(()=>[we(c,{title:"部署当前证书",modelValue:Oe(Ws),"onUpdate:modelValue":t[3]||(t[3]=e=>ze(Ws)?Ws.value=e:null),area:52},{default:Ne(()=>{var e;return[Ie("div",ol,[Ie("div",cl,[Ie("div",ul,[Ie("span",dl,"认证域名："+Be(Oe(Qs).subject),1),Ie("span",pl,"证书类型："+Be(null==(e=Oe(Qs).info)?void 0:e.issuer),1),Ie("span",ml,"到期时间："+Be(Oe(Qs).not_after),1)]),t[5]||(t[5]=Ie("span",{class:"!mt-[24px] !mb-[4px] inline-block"},"如下是需要批量部署证书的站点：",-1)),Ie("div",vl,[we(s,{type:"button",modelValue:Oe($s).typeValue,"onUpdate:modelValue":t[0]||(t[0]=e=>Oe($s).typeValue=e),size:"default",options:[{label:"全部",value:"全部"},{label:"匹配站点",value:"匹配站点"}],onChange:Oe(ll)},null,8,["modelValue","onChange"])]),Je((Ee(),Le(o,{ref_key:"deploySiteTableRef",ref:Ys,onSelectionChange:Oe(sl),data:Oe($s).data["全部"===Oe($s).typeValue?"all":"site"],"max-height":180},{default:Ne(()=>[we(i,{type:"selection",width:"55"}),we(i,{label:"站点名称",prop:"name"},{default:Ne(e=>[_e(Be(String(e.row.name)+(e.row.current?"(当前站点)":"")),1)]),_:1})]),_:1},8,["onSelectionChange","data"])),[[d,"正在加载中，请稍后...","title"],[d,Oe(Zs)]])]),Ie("div",fl,[we(a,{type:"info",onClick:t[1]||(t[1]=e=>Ws.value=!1)},{default:Ne(()=>[...t[6]||(t[6]=[_e("取消",-1)])]),_:1}),we(a,{type:"primary",onClick:t[2]||(t[2]=e=>Oe(el)())},{default:Ne(()=>[_e(Be(Oe($s).btnText),1)]),_:1})])])]}),_:1},8,["modelValue"])]),_:1})])}}}),{sslInfo:yl,sslTabActive:gl}=it(),{siteInfo:wl,siteType:_l,isRefreshList:bl}=ct(),{isRefreshLocalList:xl}=xe(pt()),Sl=[{content:()=>we("span",null,[_e("粘贴您的*.key以及*.pem内容，然后保存即可"),we("a",{href:"http://www.bt.cn/bbs/thread-704-1-1.html",class:"text-primary",target:"_blank"},[_e("[帮助]")]),_e("。")])},{content:"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书"},{content:"PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],kl=e=>{switch(e){case 3:gl.value="busSslList";break;case 2:gl.value="trustAsiaList";break;case 1:gl.value="letsEncryptList";break;case 0:gl.value="currentCertInfo";break;default:gl.value="certFolderList"}},Cl=ge(!1),Al=ge(!1),Tl=async e=>{e?ut({onCancel:()=>{yl.value.pushAlarm=!e}}):(Al.value="all"===yl.value.push.task_data.project,Cl.value=!0)},El=()=>{yl.value.pushAlarm=!0},Ll=async()=>{let e;Cl.value=!1;try{e=i.load("正在关闭证书到期提醒，请稍后...");const t=(()=>{const{id:e,task_data:t,sender:a}=yl.value.push;return{template_id:1,task_id:e,status:0,task_data:JSON.stringify({task_data:{status:!1,type:"site_ssl",project:Al.value?"all":wl.value.name,cycle:parseInt(t.cycle),title:"网站SSL到期提醒",interval:600,tid:1},sender:a,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(),a=await q(t);i.request(a),a.status&&hi()}catch(t){}finally{e&&e.close()}},Nl=async()=>{let e=!1;const{key:a,csr:s,type:l}=yl.value,{name:n}=wl.value;if(!Il.value&&!Pl.value)return i.error("请填写完整的证书内容");Il.value===a&&Pl.value===s||(e=!0,await c({title:"证书保存提示",content:"当前证书内容发生改变，证书信息将同步更新，继续操作？"}));const r={proxy:{site_name:n,key:Il.value,csr:Pl.value},docker:{site_name:n,key:Il.value,csr:Pl.value},default:{type:e?0:l,siteName:n,key:Il.value,csr:Pl.value}};await t({loading:"正在保存证书信息，请稍后...",request:B(r[_l.value]||r.default,_l.value),message:!0,success:e=>{e.status&&(bl.value=!0,xl.value=!0,hi())}})},Dl=async e=>{try{e||await c({title:"关闭强制HTTPS",content:"关闭强制HTTPS后需要清空浏览器缓存才能生效,是否继续操作?",icon:"warning-filled"});const{name:a}=wl.value,s=_l.value,l={proxy:{site_name:a,force_https:e?"1":"0"},docker:{site_name:a,force_https:e?"1":"0"},default:{siteName:a}},n=l[s]||l.default,r={proxy:M,docker:U,default:e?F:z},i=r[s]||r.default;await t({loading:"正在".concat(e?"开启":"关闭","强制HTTPS，请稍后..."),request:i(n),message:!0}),await hi()}catch(a){yl.value.https=!e}},Il=Se({get:()=>yl.value.key,set:e=>{yl.value.key=e}}),Pl=Se({get:()=>yl.value.csr,set:e=>{yl.value.csr=e}}),Ol=async()=>{const e={siteName:wl.value.name,pem:Pl.value,key:Il.value},{status:a,msg:s}=await t({loading:"正在下载证书，请稍后...",request:J(e),data:{status:Boolean,msg:String}});a&&window.open("/download?filename="+encodeURIComponent(s))};let Vl=!0;const Rl=()=>{try{Vl?Vl=!1:vi()}catch(e){}},jl=()=>{var e;try{let t={};const{push:a}=yl.value;if(a&&(a.status,1)){const{sender:e,module:s,status:l,id:n}=yl.value.push,{cycle:r}=a.task_data;t={cycle:r||30,push:Array.isArray(e)?e:e?e.split(","):[],dueAlarm:a.status,id:n||(new Date).getTime(),domainName:wl.value.name}}return"all"===(null==(e=null==a?void 0:a.task_data)?void 0:e.project)&&a.status&&(t.allSsl=!0),{data:t,status:!0}}catch(t){return{status:!1,msg:"获取证书到期提醒配置失败"}}},Hl=async(e,a)=>{try{await a();const s=(e=>{const{id:t,allSsl:a,push:s,cycle:l,dueAlarm:n}=e;return{template_id:1,task_id:yl.value.push.id,status:n?1:0,task_data:JSON.stringify({task_data:{status:n,type:"site_ssl",project:a?"all":wl.value.name,cycle:parseInt(l),title:"网站SSL到期提醒",interval:600,tid:1},sender:s,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(e.value),l=await t({loading:"正在设置到期提醒，请稍后...",request:q(s),message:!0});return hi(),l.status}catch(s){return!1}},ql=async(e,t)=>{if(!t)try{const t=await navigator.clipboard.readText(),a="key"===e?[/-----BEGIN PRIVATE KEY-----[\s\S]*?-----END PRIVATE KEY-----/,/-----BEGIN RSA PRIVATE KEY-----[\s\S]*?-----END RSA PRIVATE KEY-----/,/-----BEGIN EC PRIVATE KEY-----[\s\S]*?-----END EC PRIVATE KEY-----/]:[/-----BEGIN CERTIFICATE-----[\s\S]*?-----END CERTIFICATE-----/,/-----BEGIN CERTIFICATE REQUEST-----[\s\S]*?-----END CERTIFICATE REQUEST-----/];for(const s of a){const a=t.match(s);if(a&&a[0])switch(i.success("已从粘贴板检测到".concat("key"===e?"密钥":"证书")),e){case"key":Il.value=a[0];break;case"cert":Pl.value=a[0]}}}catch(a){}},Bl=async e=>{try{e(),"docker"===_l.value?vt("httpsOfficersSite"):mt("httpsOfficersSite")}catch(t){}},Ml=async()=>{try{await t({request:G({siteName:wl.value.name})}),await hi()}catch(e){}},Ul={class:"flex flex-col w-full overflow-y-hidden"},Fl={class:"flex items-center justify-between w-full"},zl={class:"flex"},Jl={class:"mr-[32px] text-small"},Gl={key:1,class:"ssl-status-info"},Kl={class:"left flex-1"},Xl=["title"],Zl={class:"!mb-0"},Yl={class:"right flex-1"},Ql=["title"],Wl={key:0},$l={key:1,class:"text-danger"},en={class:"!mb-0"},tn={class:"flex items-center"},an={class:"flex flex-1 justify-start"},sn={class:"flex-1 mr-[20px]"},ln={class:"flex-1"},nn={class:"my-[16px]"},rn={class:"p-2rem"},on={class:"flex"},cn={class:"ml-4"},un={class:"mt-8px flex items-center"},dn=m(Te({__name:"index",setup(e,{expose:t}){const{sslInfo:a}=it(),s=["宝塔证书","Let's Encrypt","宝塔SSL","商业证书"],l=Se(()=>-1!==a.value.type?s[a.value.type]:s[0]),n=Xe("popupClose",()=>{});return Ze(Rl),t({init:Rl}),(e,t)=>{var s,r,i,o,c,u,p;const m=Qe,v=d,f=We,h=$e,g=Ce,w=y,_=et,b=tt,S=x;return Ee(),Re("div",Ul,[(null==(s=Oe(a))?void 0:s.isCertInfo)&&!(null==(r=Oe(a))?void 0:r.httpsMode)&&(null==(i=Oe(a))?void 0:i.isStart)?(Ee(),Le(m,{key:0,type:"error",class:"!mb-[16px]",onClose:Oe(Ml)},{title:Ne(()=>[Ie("div",Fl,[Ie("div",zl,[Ie("div",Jl,[t[13]||(t[13]=_e("网站安全：未开启HTTPS防窜站，站点访问可能存在风险。",-1)),Ie("span",{class:"ml-[1rem] bt-link",onClick:t[0]||(t[0]=e=>Oe(Bl)(Oe(n)))},">>前往开启")])])])]),_:1},8,["onClose"])):Ye("",!0),(null==(o=Oe(a))?void 0:o.isCertInfo)?(Ee(),Re("div",Gl,[Ie("div",Kl,[Ie("div",null,[t[14]||(t[14]=Ie("span",null,"证书分类：",-1)),Ie("span",null,[we(v,{onClick:t[1]||(t[1]=e=>Oe(kl)(Oe(a).type))},{default:Ne(()=>[_e(Be(Oe(l)),1)]),_:1})])]),Ie("div",null,[t[15]||(t[15]=Ie("span",null,"认证域名：",-1)),Ie("span",{class:"truncate max-w-24rem",title:Oe(a).dns.join("、")},Be(Oe(a).dns.join("、")),9,Xl)]),Ie("div",Zl,[t[16]||(t[16]=Ie("span",null,"强制HTTPS：",-1)),Ie("span",null,[we(f,{size:"small",class:"!mb-0",modelValue:Oe(a).https,"onUpdate:modelValue":t[2]||(t[2]=e=>Oe(a).https=e),onChange:Oe(Dl)},null,8,["modelValue","onChange"])])])]),Ie("div",Yl,[Ie("div",null,[t[17]||(t[17]=Ie("span",null,"证书品牌：",-1)),Ie("span",{class:"truncate max-w-24rem",title:Oe(a).issuer},Be(Oe(a).issuer),9,Ql)]),Ie("div",null,[t[18]||(t[18]=Ie("span",null,"到期时间：",-1)),Ie("span",null,[Number(Oe(a).endtime)>0?(Ee(),Re("span",Wl,Be(Oe(a).notAfter),1)):(Ee(),Re("span",$l,"证书已过期"))])]),Ie("div",en,[t[20]||(t[20]=Ie("span",null,"到期提醒：",-1)),Ie("span",tn,[we(f,{size:"small",class:"!mb-0",modelValue:Oe(a).pushAlarm,"onUpdate:modelValue":t[3]||(t[3]=e=>Oe(a).pushAlarm=e),onChange:Oe(Tl)},null,8,["modelValue","onChange"]),we(v,{class:"ml-[8px]",onClick:t[4]||(t[4]=e=>Oe(ut)())},{default:Ne(()=>[...t[19]||(t[19]=[_e(" 到期设置提醒 ",-1)])]),_:1})])])])])):Ye("",!0),Ie("div",an,[Ie("div",sn,[t[21]||(t[21]=Ie("div",{class:"mb-[4px]"},"密钥(KEY)",-1)),we(h,{type:"textarea",rows:12,modelValue:Oe(Il),"onUpdate:modelValue":t[5]||(t[5]=e=>ze(Il)?Il.value=e:null),onFocus:t[6]||(t[6]=e=>Oe(ql)("key",Oe(Il)))},null,8,["modelValue"])]),Ie("div",ln,[t[22]||(t[22]=Ie("div",{class:"mb-[4px]"},"证书(PEM格式)",-1)),we(h,{type:"textarea",rows:12,modelValue:Oe(Pl),"onUpdate:modelValue":t[7]||(t[7]=e=>ze(Pl)?Pl.value=e:null),onFocus:t[8]||(t[8]=e=>Oe(ql)("cert",Oe(Pl)))},null,8,["modelValue"])])]),Ie("div",nn,[we(g,{type:"primary",class:"mr-[4px]",onClick:Oe(Nl)},{default:Ne(()=>{var e;return[_e(Be((null==(e=Oe(a))?void 0:e.isStart)?"保存":"保存并启用证书"),1)]}),_:1},8,["onClick"]),(null==(c=Oe(a))?void 0:c.isSupportRenewal)||1===(null==(u=Oe(a))?void 0:u.type)?(Ee(),Le(g,{key:0,type:"primary",class:"mr-[4px]",onClick:t[9]||(t[9]=e=>Oe(ji)())},{default:Ne(()=>[...t[23]||(t[23]=[_e(" 续签证书 ",-1)])]),_:1})):Ye("",!0),Oe(a).csr?(Ee(),Le(g,{key:1,type:"default",class:"mr-[4px]",onClick:t[10]||(t[10]=e=>Oe(Ol)())},{default:Ne(()=>[...t[24]||(t[24]=[_e(" 下载证书 ",-1)])]),_:1})):Ye("",!0),(null==(p=Oe(a))?void 0:p.isStart)?(Ee(),Le(g,{key:2,type:"default",onClick:Oe(Fi)},{default:Ne(()=>[...t[25]||(t[25]=[_e(" 关闭SSL ",-1)])]),_:1},8,["onClick"])):Ye("",!0)]),we(w,{options:Oe(Sl),"list-style":"disc",class:"ml-[20px]"},null,8,["options"]),we(S,{title:"关闭证书到期提醒",showFooter:"",modelValue:Oe(Cl),"onUpdate:modelValue":t[12]||(t[12]=e=>ze(Cl)?Cl.value=e:null),onConfirm:Oe(Ll),onCancel:Oe(El),area:["auto"]},{default:Ne(()=>[Ie("div",rn,[Ie("div",on,[t[28]||(t[28]=Ie("i",{class:"svgtofont-el-warning-filled !text-[4rem] text-warning"},null,-1)),Ie("div",cn,[t[27]||(t[27]=Ie("div",{class:"py-[.3rem] leading-[2.4rem] text-base"},"关闭证书到期提醒后将不在提醒和证书到期，是否继续操作？",-1)),Ie("div",un,[t[26]||(t[26]=Ie("div",null,"应用配置",-1)),we(b,{modelValue:Oe(Al),"onUpdate:modelValue":t[11]||(t[11]=e=>ze(Al)?Al.value=e:null),class:"!w-[20rem] ml-2rem"},{default:Ne(()=>[we(_,{label:"应用到当前站点",value:!1}),we(_,{label:"应用到所有未设置过的站点",value:!0})]),_:1},8,["modelValue"])])])]),we(w,{options:[{content:"任务优先级：单个站点的任务优先于所有站点的任务。"}],"list-style":"disc",class:"ml-4rem mt-2rem"})])]),_:1},8,["modelValue","onConfirm","onCancel"])])}}}),[["__scopeId","data-v-9a7cd20a"]]),{siteInfo:pn,siteType:mn}=ct(),{isRefreshLetSSL:vn,sslDnsApiInfo:fn,otherPopup:hn}=it(),{jumpSslTabEvent:yn}=ot(),gn=ge(!1),wn=ke({}),_n=ge([]),bn=ge([]),xn=ge(!1),Sn=ge(""),kn=ge(!1),Cn=e=>{var t;const a=(null==(t=e.domains)?void 0:t.length)>0,s=a?(l=e.endDay)<=0||l<=7?"text-danger":l<=15?"text-orange":"text-primary":"text-default";var l;const n=a?e.endDay>0?"剩余".concat(e.endDay,"天"):"已过期":"--";return we("span",{class:s},[n])},An=e=>{let t="";if("pending"===e.status){if(e.expires<(new Date).getTime()/1e3)return t=we("span",null,[_e("--")]),t;t=we("span",{class:"text-[#e6a23c]"},[_e("待验证")])}else t=we("span",{class:"text-primary"},[_e("订单完成")]);return t},Tn=[{content:()=>we("span",{class:"text-danger"},[_e("注意：请勿将SSL证书用于非法网站")])},{content:()=>we("span",null,[_e("Let's Encrypt 证书申请和续签限制"),we("a",{class:"bt-link",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/",target:"_blank"},[_e("点击查看")])])},{content:()=>we(je,null,[_e("Let's Encrypt因更换根证书，部分老旧设备访问时可能提示不可信，考虑购买")," ",we("span",{class:"bt-link",onClick:()=>yn("busSslList")},[_e("[商业证书]")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],En=ge([{label:"解析域名",prop:"domain"},{label:"记录值",showOverflowTooltip:!0,prop:"auth_value",render(t,a){const s="dns"===wn.auth_type?t.auth_value:t.file_path;return we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[s]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:s})},null)])}},{label:"类型",prop:"type",render:(t,a)=>"dns"===wn.auth_type?we("span",null,[t.type]):we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[t.content]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:t.content})},null)])},{label:"必需",prop:"must",width:100}]),Ln=ge(!1),Nn=async()=>{try{const e=await t({loading:Ln,request:Q({siteName:pn.value.name}),data:Array});return{data:e,total:e.length,other:{}}}catch(e){return{data:[],total:0,other:{}}}},Dn=async({index:e},a=!1,s=pn.value.name)=>{try{const l={index:e,siteName:s},n=await t({loading:"正在部署证书，请稍候...",request:"docker"===mn.value?$(l):ee(l),message:!1,data:{status:Boolean,msg:String}});return bi(n,a),n.status&&yn("currentCertInfo"),{status:n.status,msg:n.msg}}catch(l){return{status:!1,msg:"部署失败"}}},In=async e=>{const t=await Ti(),{data:a}=await se({index:wn.index,domain:e.domain});t._props.onCancel(),"valid"===a.status?i.success("验证成功"):!0===a.status?(gn.value=!1,Dn(a,!0)):Ai(a,e.data,wn)},Pn=async()=>{const e=await Ti(),a=await t({request:ne({index:wn.index}),message:!1});e._props.onCancel(),!0===a.status?(gn.value=!1,Dn(a,!0)):Ai({msg:a.data},_n.value,wn)},On=()=>{kn.value=!1,zi({})},Vn=ge([{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:""},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}]),Rn=ge([]),jn=ge("dns"),Hn=ge(!1),qn=async(e={id:pn.value.id})=>{try{const a=await t({request:"docker"==mn.value?K(e):X(e),data:{domains:Array}});return Jn.domain=a.domains.map(e=>e.name),Rn.value=a.domains,kn.value&&(Jn.checkAll=!0,Fn(!0)),{data:a.domains,status:!0,msg:"获取站点数据成功"}}catch(a){return{status:!1,msg:"获取站点数据失败"}}},Bn=async e=>{try{e=at(e.value);const t=mn.value,a=pn.value.name;if(0===e.checkList.length)return i.error("请选择一个域名"),!1;const s=Rn.value.filter(t=>e.checkList.includes(t.name));if("1"===e.resource&&Wn(s)&&!Jn.auth_to)return i.error("选中的域名存在未设置DNS接口配置"),!1;if("1"===e.resource&&e.autoWildcard&&e.checkList.some(e=>-1!==e.indexOf("*")))return i.error("开启自动组合泛域名时不能选择泛域名"),!1;let l={domains:JSON.stringify(e.checkList),auth_type:"1"==e.resource?"dns":"http",auth_to:"1"===e.resource&&e.auth_to?"dns":JSON.stringify(e.checkList),auto_wildcard:e.autoWildcard?"1":"0",id:pn.value.id};const n=await Ti(),r={proxy:{...l,site_name:a},docker:{...l,site_name:a},default:l},o=await Z(r[t]||r.default,t);n._props.onCancel();const c=await hn.value;return o.status&&(null==c||c.unmount()),Ni(o.data,e),vn.value=!0,o.status}catch(t){return i.error("程序发生错误！"),!1}},Mn=e=>{n({isAsync:!0,title:"配置DNS接口",area:50,component:()=>r(()=>import("./set-domain-dns.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:e,refresh:qn},showFooter:!0})},Un=e=>{var t;const a=jn.value;if("dns"!==a&&"http"!==a){const s=null==(t=fn.value)?void 0:t.find(e=>e.value===a);if(s){const t=!s.data;(!e||e&&t)&&xi({title:"设置".concat(s.info.title,"接口"),row:s.info})}}},Fn=e=>{const t=Rn.value.filter(e=>1===e.apply_ssl);Jn.checkList=e?t.map(e=>e.name):[],Hn.value=!1},zn=e=>{const t=e.length;Jn.checkAll=t===Jn.domain.length,Hn.value=t>0&&t<Jn.domain.length},Jn=ke({resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]}),Gn=ge([{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"},{content:()=>we("span",null,[_e("在DNS验证中，我们提供了多种自动化DNS-API，并提供了手动模式-"),we("span",{class:"bt-link",onClick:()=>{S(),k.push({name:"domain"})}},[_e("点击添加DNS接口")])])},{content:"使用DNS接口申请证书可自动续期，手动模式下证书到期后需重新申请"}]),Kn=[{content:()=>we("span",{class:"text-danger"},[_e("注意：请勿将SSL证书用于非法网站")])},{content:"使用【DnsPod/阿里云DNS】等接口前您需要先在弹出的窗口中设置对应接口的API"}],Xn=ge([{content:()=>we("span",null,[" ",_e("Let's Encrypt 证书申请和续签限制")," ",we("a",{class:"bt-link",target:"_blank",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/"},[_e("点击查看")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"}]),Zn=Se(()=>{const e="0"===Jn.resource?Xn.value:Gn.value,t=Kn.concat([]);return t.splice(1,0,...e),t}),Yn=e=>/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e),Qn=()=>{Object.assign(Jn,{resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]})},Wn=e=>e.some(e=>0===e.dns_status),$n=ge("正在申请证书..."),er=ge(),tr=async()=>{er.value=setInterval(async()=>{try{await t({request:re({filename:"/www/server/panel/logs/letsencrypt.log",num:10}),data:{msg:[String,$n]}})}catch(e){clearInterval(er.value)}},2e3)},ar=ge(),sr=ge([{title:"文件验证 - HTTP",name:"http",data:!1,config:!1}]),lr=async e=>{const{dns:t,id:a}=e;let s={domains:JSON.stringify(t),auth_type:"http",auth_to:a||"dns",auto_wildcard:"0"};if("http"===jn.value){const e=JSON.stringify(t);if(-1!==(null==e?void 0:e.indexOf("*.")))return i.error("包含通配符的域名不能使用文件验证(HTTP)!")}else{if("dns"!==jn.value){const{data:e,info:{data:t}}=fn.value.find(e=>e.value===jn.value);if(!e)return void i.error("指定dns接口没有设置密钥信息");s.auth_to="".concat(jn.value,"|").concat(t[0].value,"|").concat(t[1].value)}s.auth_type="dns"}s.id=pn.value.id,s.siteName=pn.value.name;(await hn.value).unmount();const l=await Ti(),{data:n}="proxy"==pn.value.project_type||"nginx"==pn.value.project_type||"docker"==pn.value.project_type?await Y({...s,site_name:pn.value.name},"docker"==pn.value.project_type?"docker":"proxy"):await Z(s,mn.value);null==l||l.unmount(),Ni(n,s)},nr=async()=>{jn.value="http";const{data:e}=await Si();sr.value=[{title:"文件验证 - HTTP",name:"http",data:!1,config:!1}],e&&Array.isArray(e)&&(sr.value=sr.value.concat(e))},rr=ge([]),ir=async()=>{try{await t({request:ie(),data:{data:[Array,rr]}})}catch(e){return{data:[],total:0,other:{}}}},or=async e=>{try{if(!e.dns_id)return void i.error("请选择验证类型");const a={dns_id:e.dns_id,ids:JSON.stringify(e.ids)},s=await t({loading:"正在配置DNS接口，请稍候...",request:oe(a),message:!0});return s.status&&(e.dns_id="",e.ids=[],qn()),s.status}catch(a){return!1}},cr=Te({__name:"index",setup(e,{expose:a}){const{isRefreshLetSSL:s,sslAlertState:l}=it(),{BtTable:r,BtRefresh:o,refresh:u}=v({request:Nn,columns:[{label:"域名",prop:"domains",render:(e,t)=>we("span",{class:"w-full whitespace-pre-line"},[e.domains?e.domains.join("\n"):"--"])},{label:"到期时间",prop:"expires",width:110,render:Cn},{label:"订单状态",prop:"status",width:80,render:An},{label:"验证方式",prop:"auth_type",width:80,render:(e,t)=>we("span",null,["dns"===e.auth_type?"DNS验证":"文件验证"])},{label:"操作",prop:"ps",width:190,showOverflowTooltip:!1,align:"right",render:(e,a)=>{let s=[];return"invalid"!==e.status&&("pending"!==e.status?s=[we("span",{class:"cursor-pointer bt-link",onClick:()=>Dn(e,!1)},[_e("部署")]),we(lt,null,null),we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{const a=await t({loading:"正在获取证书信息，请稍后...",request:W({index:e}),message:!1,data:{status:Boolean,msg:String}});return a.status?window.open(a.msg):i.request(a),{status:a.status,msg:a.msg}}catch(a){return{status:!1,msg:"下载失败"}}})(e)},[_e("下载")]),we(lt,null,null),we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{const a=await Ti(),s=await t({request:le({index:e}),message:!1,data:{status:Boolean,msg:String}});a._props.onCancel(),i.msg({dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",duration:s.status?2e3:0,showClose:!s.status}),s.status&&Nn()})(e)},[_e("续签")]),we(lt,null,null)]:e.expires>=(new Date).getTime()/1e3&&(s=[we("span",{class:"cursor-pointer bt-link",onClick:()=>(async e=>{var a,s,l;const{data:r}=await t({loading:"正在验证证书申请状态，请稍后...",request:ae({index:e.index}),message:!1});if(r.hasOwnProperty("status")&&r.hasOwnProperty("msg"))i.request(r);else{bn.value=r.auths,r.hasOwnProperty("error")?(xn.value=r.error,Sn.value=r.error_msg):(xn.value=!1,Sn.value=""),Object.assign(wn,e),_n.value=[],null==(a=r.auths)||a.forEach(e=>{_n.value.push(e.data)});const t="dns"===e.auth_type;En.value[1].label=t?"记录值":"文件路径",En.value[1].prop=t?"auth_value":"file_path",En.value[2].label=t?"类型":"文件内容",En.value[2].prop=t?"type":"content",Vn.value[1].content="可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(null==(l=null==(s=_n.value[0])?void 0:s.domain)?void 0:l.replace("*.","")),n({title:"手动".concat("dns"===wn.auth_type?"解析TXT记录":"创建验证文件"),area:70,component:()=>we("div",{class:"p-[1.5rem]"},[_e("请按以下列表做TXT解析:"),we("span",{class:"ml-[.4rem] text-danger"},{errorMsg:Sn}),we(ye,null,{content:()=>we("div",{class:"max-h-[38rem] overflow-auto"},[bn.value.map((e,t)=>e.data.length>0&&we("div",{key:t},[we("span",null,[_e("验证域名："),e.domain]),we(C,{class:"my-[1rem]",column:En.value,data:e.data},null),xn.value&&we("div",{class:"flex justify-end"},[we(Ce,{type:"default",onClick:()=>In(e)},{default:()=>[_e("验证")]})])]))]),"footer-right":()=>!xn.value&&we(Ce,{type:"default",onClick:Pn},{default:()=>[_e("验证")]})}),we(y,{options:Vn.value,listStyle:"disc",class:"ml-[20px]"},null)])}),vn.value=!0}})(e)},[_e("验证")]),we(lt,null,null)])),s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{await c({title:"删除证书订单",content:"确定删除证书订单吗？"});const a=await t({loading:"正在删除证书，请稍候...",request:te({index:e}),message:!0});return vn.value=!0,{status:a.status,msg:a.msg}}catch(a){return{status:!1,msg:"删除失败"}}})(e)},[_e("删除")])),s}}],extension:[f(),h(s)]});return a({init:u}),(e,t)=>{const a=Ce,s=ye,n=y;return Ee(),Re("div",null,[we(s,null,{"header-left":Ne(()=>[we(a,{type:"primary",onClick:Oe(On)},{default:Ne(()=>[...t[0]||(t[0]=[_e("申请证书",-1)])]),_:1},8,["onClick"])]),"header-right":Ne(()=>[we(Oe(o))]),content:Ne(()=>[we(Oe(r),{"default-sort":{prop:"date",order:"descending"},maxHeight:Oe(l)?280:320},null,8,["maxHeight"])]),_:1}),we(n,{options:Oe(Tn),"list-style":"disc",class:"pl-1rem"},null,8,["options"])])}}}),{siteInfo:ur,siteType:dr,isRefreshList:pr}=ct(),{isRefreshLocalList:mr}=xe(pt()),{payment:vr}=A(),{bindUser:fr}=st(vr.value),{isRefreshSSL:hr,sslTabActive:yr,otherPopup:gr,isRefreshBtSSL:wr}=it(),{jumpSslTabEvent:_r}=ot(),br=T(),xr=["企业级证书","极速申请","防劫持/防篡改","提高SEO权重","赔付保证","不成功可退款","官方推荐"],Sr=[{content:()=>we("span",{class:"text-danger"},[_e("如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败")])},{content:()=>we("span",{class:"text-danger"},[_e("原测试证书已经停止服务，如需查看证书列表请前往官网后台。点击"),we("a",{class:"bt-link",href:"https://www.bt.cn/admin/safe"},[" ",_e("官网后台")," "]),_e("跳转")])},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败。"},{content:"商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。"}],kr=async e=>{const{p:t,limit:a}=e;try{const{data:e}=await yt({url:"/api/v1/ssl/get_order_list",p:t,limit:a}),{data:s}=e;return s?{data:s.data,total:s.count}:{data:[],total:0,other:{}}}catch(s){return{data:[],total:0,other:{}}}},Cr=e=>{var t;const a=null==(t=null==e?void 0:e.cert_info)?void 0:t.not_after;if(!a)return we("span",null,[_e("--")]);let s=0;if("string"==typeof a){const e=new Date(a).getTime();s=Number.isNaN(e)?0:e}if(!s)return we("span",null,[_e("--")]);const l=Math.ceil((s-Date.now())/864e5);if(l>30)return we("span",null,[new Date(s).toLocaleDateString()]);const n=l<=7?"text-danger":"text-warning",r=l>0?"剩余".concat(l," 天"):"已过期";return we("span",{class:n},[r])},Ar=()=>{if(!fr.value)return wt(),!1;yr.value="btSslList",n({isAsync:!0,title:"购买宝塔证书",area:[79],component:()=>r(()=>import("./index408.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Tr=(e,t,a,s=300)=>{const l=we("div","string"==typeof e?{class:"flex items-center p-[2px] whitespace-pre-line"}:{class:"flex items-center p-[2px] whitespace-nowrap"},[e]);return we(Ae,{trigger:"hover",placement:"left","popper-class":"popover-default",width:s,enterable:!1,"open-delay":100,"close-delay":0},{default:()=>l,reference:()=>we("span",{class:a},[t])})},Er=e=>{var t;const a=[];if(0===e.status)return[we("span",{class:"text-warning"},[_e("待完善资料")])];const s=null==(t=e.cert_info)?void 0:t.status;switch(Number(s)){case 0:a.push(Tr("如填写错误，联系人工可重置订单","验证中","text-orange",240));break;case 1:a.push(we("span",{class:"text-primary"},[_e("已签发")]));break;case-1:a.push(Tr("该订单存在异常，请联系人工重置订单","异常","text-danger",240));break;default:a.push(we("span",null,[_e("--")]))}return a},Lr=async e=>{try{gr.value=await n({title:"完善宝塔证书资料",area:68,component:()=>r(()=>import("./index417.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})}catch(t){}},Nr=async e=>{gr.value=await n({title:"验证域名-"+(3===e.product_id?"文件验证":"DNS验证"),area:64,compData:e,component:()=>r(()=>import("./index418.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Dr=async e=>{const a=e.cert_info.certificate+"\n"+e.cert_info.ca_certificate,s=e.cert_info.private_key;try{const l=ur.value.name,n={default:{type:dr.value,siteName:l,key:s,csr:a}};await c({title:"部署证书",isHtml:!0,content:"是否部署该证书,是否继续？<br>\n              证书类型：".concat(e.product_name,"<br>\n              证书支持域名：").concat(e.cert_info.domain,"<br>\n              部署站点名:").concat(l)}),await t({loading:"正在部署证书，请稍后...",request:B(n[dr.value]||n.default,dr.value),message:!0,success:e=>{hi(),pr.value=!0,hr.value=!0,wr.value=!0,mr.value=!0,_r("currentCertInfo")}})}catch(l){}},Ir=e=>{n({title:"证书详情",area:64,component:()=>r(()=>import("./index419.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},Pr=async e=>{var t;const a=br.load("正在下载证书，请稍后...");try{const{data:a}=await yt({url:"/api/v1/ssl/cert/download_cert",order_id:e.id});if(!(null==(t=a.data)?void 0:t.base64))return void br.error("获取证书文件失败");const s=Or(a.data.base64,"application/zip"),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.download=a.data.file_name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),br.success("证书下载成功")}catch(s){br.error("下载证书失败，请稍后重试")}finally{a&&a.close()}},Or=(e,t="application/octet-stream")=>{const a=e.replace(/^data:[^;]*;base64,/,""),s=atob(a),l=new Array(s.length);for(let r=0;r<s.length;r++)l[r]=s.charCodeAt(r);const n=new Uint8Array(l);return new Blob([n],{type:t})},Vr={class:"h-full"},Rr={class:"flex flex-col w-full"},jr={class:"recommendList"},Hr={class:"text-small ml-[8px] text-stroke-primary"},qr={class:"flex flex-col w-full pt-[16px]"},Br={class:"flex items-center"},Mr={class:"flex items-center"},Ur=m(Te({__name:"index",setup(e,{expose:t}){const{sslAlertState:a,isRefreshBtSSL:s}=it(),{BtTable:l,BtRefresh:n,refresh:r,BtPage:i}=E({request:kr,columns:[{label:"域名",prop:"domain",width:120,render:e=>we("span",{class:"w-full whitespace-pre-line"},[e.cert_info?e.cert_info.domain:"--"])},{label:"证书类型",prop:"product_name",showOverflowTooltip:!0},{label:"到期时间",width:100,render:Cr,showOverflowTooltip:!0},{label:"状态",prop:"expire",width:160,showOverflowTooltip:!1,render:e=>Er(e)},{label:"操作",prop:"ps",width:170,align:"right",render:e=>(e=>{var t;const a=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),s=[];if(0===e.status){const t=a("完善资料",()=>Lr(e));s.push(t)}else{const l=null==(t=e.cert_info)?void 0:t.status;if(0===l){const t=a("验证",()=>Nr(e));s.push(t)}else if(1===l){const t=a("部署",()=>Dr(e)),l=a("下载",()=>Pr(e)),n=a("查看",()=>Ir(e));s.push(t),s.push(l),s.push(n)}}const l=[];return s.map((e,t)=>{l.push(e),t<s.length-1&&l.push(we(lt,null,null))}),l})(e)}],extension:[f(),h(s)]}),o=Ve(()=>{const e=document.querySelector("#pane-busSslList");e&&e.click()},1e3);return t({init:r}),(e,t)=>{const a=Ce,s=p,r=ye,c=y;return Ee(),Re("div",Vr,[Ie("div",Rr,[Ie("div",jr,[(Ee(!0),Re(je,null,He(Oe(xr),(e,a)=>(Ee(),Re("div",{key:a,class:qe("".concat(6===a?"w-[22rem]":"w-[14rem]"," recomItem"))},[t[0]||(t[0]=Ie("i",{class:"svgtofont-el-check font-bold text-[#ff8d00] text-medium"},null,-1)),Ie("span",Hr,Be(e),1)],2))),128))]),Ie("div",qr,[we(r,null,{"header-left":Ne(()=>[Ie("div",Br,[we(a,{type:"primary",onClick:Oe(Ar),class:"mr-4"},{default:Ne(()=>[...t[1]||(t[1]=[_e(" 申请证书 ",-1)])]),_:1},8,["onClick"]),we(js,{placement:"right"},{default:Ne(()=>[Ie("div",Mr,[we(s,{src:"/static/icons/we-com.svg",class:"mx-[4px] w-2rem h-2rem",all:!0}),t[2]||(t[2]=Ie("span",{class:"bt-link"},"售前客服",-1))])]),_:1})])]),"header-right":Ne(()=>[we(Oe(n))]),content:Ne(()=>[we(Oe(l),{"max-height":300,onWheel:Oe(o)},null,8,["onWheel"])]),"footer-right":Ne(()=>[we(Oe(i),{size:"small"})]),_:1})])]),we(c,{class:"mt-2",options:Oe(Sr),listStyle:"disc"},null,8,["options"])])}}}),[["__scopeId","data-v-9438a8f6"]]),{payment:Fr}=A(),{bindUser:zr}=st(Fr.value),{sslInfo:Jr,certVerifyInfo:Gr,sslTabActive:Kr,letApplyInfo:Xr,isRefreshSSL:Zr,pollingPopup:Yr,sslDnsApiInfo:Qr,productInfo:Wr,orderInfo:$r,otherPopup:ei}=it(),{siteInfo:ti,siteType:ai,isBindExtranet:si,isRefreshList:li,batchConfig:ni,activeType:ri,isSiteMult:ii}=ct(),{isRefreshLocalList:oi}=xe(pt()),{getSSLInfoEvent:ci,jumpSslTabEvent:ui}=ot(),di=Se(()=>{var e,t;return'当前证书 -<span class="'.concat((null==(e=Jr.value)?void 0:e.isStart)?"text-primary":"text-danger",'">[').concat((null==(t=Jr.value)?void 0:t.isStart)?"已部署SSL":"未部署SSL","]</span>")}),pi=[{label:()=>we("span",{innerHTML:di.value},null),name:"currentCertInfo",lazy:!0,render:()=>we(dn,null,null)},{label:"商用SSL证书",name:"busSslList",lazy:!0,render:()=>we(zs,null,null)},{label:"宝塔证书",name:"btSslList",lazy:!0,render:()=>we(Ur,null,null)},{label:"Let's Encrypt",name:"letsEncryptList",lazy:!0,render:()=>we(cr,null,null)},{label:"证书夹",name:"certFolderList",lazy:!0,render:()=>we(hl,null,null)}],mi=()=>{if(!zr.value)return wt(),!1;Kr.value="busSslList",n({isAsync:!0,title:"购买商业证书",area:[82],component:()=>r(()=>import("./apply-bus-ssl.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},vi=()=>{var e,t;let a=null==(e=ti.value.project_type)?void 0:e.toLowerCase();ai.value=a,si.value=!!(null==(t=ti.value.project_config)?void 0:t.bind_extranet);["php","html","phpasync","proxy","docker"].includes(a)&&(si.value=!0),si.value&&fi()},fi=async()=>{const e=i.load("正在获取站点证书部署信息，请稍候...");await hi(),e.close()},hi=async()=>{try{const{data:e}=await ci({siteName:ti.value.name});return yi(e),{data:e,status:!0,msg:"获取证书信息成功"}}catch(e){}},yi=e=>{const{type:t,httpTohttps:a,https_mode:s,index:l,auth_type:n,key:r,csr:i,cert_data:{dns:o=[],subject:c="",issuer:u="",endtime:d="",notAfter:p=""}={},push:m,status:v,oid:f}=e;Jr.value={...Jr.value,isCertInfo:!!c,https:a,httpsMode:s,type:t,key:r||"",csr:i||"",index:l||"",authType:n||"",oid:f,dns:o||[],subject:c,issuer:u,endtime:d,notAfter:p,push:m,pushAlarm:!!("object"==typeof m?m.status:m),isSupportRenewal:(()=>{let e=!1;return d<=30&&(e=!0),2===t&&d<0&&(e=!0),0!==t&&-1!==t||(e=!1),e})(),isStart:v}},gi=async e=>{$r.value=e.orderInfo,ei.value=await n({title:"完善商业证书资料",area:64,component:()=>r(()=>import("./bus-cert-verify-info.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},wi=async e=>{Gr.value=e,ei.value=await n({title:"验证域名-"+(e.isCNAME?"DNS验证":"文件验证"),area:64,component:()=>r(()=>import("./bus-cert-verify-way.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},_i=async e=>{var a;const{hash:s,subject:l,list:n,type:r}=e;if(await c({title:"部署证书",content:"批量部署证书后，原有证书将被覆盖，是否继续？",icon:"warning-filled"}),ii.value){const{enable:e,exclude:a}=ni.value,r=_t(n,a,e,{params:{certName:l,project_type:ri.value.toUpperCase(),ssl_hash:s}});await t({loading:"正在部署证书，请稍候...",request:me(r),success:async e=>{let{data:t}=bt(e.data);t=t.map(e=>({...e,name:e.siteName})),xt(t,{title:"部署证书"})}}),ii.value=!1,li.value=!0,oi.value=!0}else{const e=n.map(e=>({ssl_hash:s,siteName:e.name,certName:l})),i={proxy:{BatchInfo:JSON.stringify(e),site_name:ti.value.name},docker:{BatchInfo:JSON.stringify(e),site_name:ti.value.name},default:{BatchInfo:JSON.stringify(e)}},o=i[r]||i.default,c=await t({loading:"正在部署证书，请稍候...",request:ve(o,r),data:{faildList:Array,successList:Array}});(null==(a=ti.value)?void 0:a.name)&&hi(),li.value=!0,oi.value=!0,await dt({title:"批量部署结果",resultTitle:"部署证书操作",resultData:[...c.faildList.map(e=>({name:e.siteName,status:!1,msg:e.msg||e.error_msg})),...c.successList.map(e=>({name:e.siteName,status:!0}))]})}},bi=(e,t)=>{if(e.status)i.request(e),hi(),li.value=!0,Zr.value=!0,oi.value=!0;else{const a=t?"当前证书已成功申请！自动部署失败，请尝试手动部署证书！\n":"";i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:a+e.msg,type:e.status?"success":"error",showClose:!e.status})}},xi=e=>n({isAsync:!0,title:e.title,area:50,component:()=>r(()=>import("./dns-verify-info.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:e.row}),Si=async()=>{try{const e=await t({request:fe(),data:Array});return g(e)&&ki(e),{data:e,status:!0}}catch(e){return{status:!1,msg:"获取DNS接口信息失败"}}},ki=e=>{Qr.value=e.filter(e=>"CloudxnsDns"!==e.name).map(e=>({label:e.title,value:e.name,config:!!e.data,data:!!e.data&&""!=e.data[0].value,info:e}))},Ci=async e=>{try{const a={};e.forEach(e=>{a[e.key]=e.value});const s={pdata:JSON.stringify(a)},l=await t({loading:"正在配置DNS接口，请稍候...",request:he(s),message:!0});if(await Si(),l.status)return l.status}catch(a){return{status:!1,msg:"验证失败"}}},Ai=(e,t,a)=>{var s,l,n,r,o,c,u,d;if(e.msg&&L(e.msg))return void i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});let p="",m=e.msg[0];if(void 0===(null==(s=e.msg[1])?void 0:s.challenges))p+="\n\t\t\t<p><span>响应状态：</span>".concat(e.msg[1].status,"</p>\n\t\t\t<p><span>错误类型：</span>").concat(e.msg[1].type,"</p>\n\t\t\t<p><span>错误来源：</span><a href='https://letsencrypt.org/' style='color:#20a53a'>Let's Encrypt官网</a></p>\n\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t错误代码：\n\t\t\t\t<pre class=\"!text-white !bg-[#333] !inline-block !ml-[4px]\">\n\t\t\t\t\t").concat(e.msg[1].detail,"\n\t\t\t\t</pre>\n\t\t\t</div>");else if(!(null==(l=e.msg[1])?void 0:l.challenges[1])&&(null==(n=e.msg[1])?void 0:n.challenges[0])&&(e.msg[1].challenges[1]=e.msg[1].challenges[0]),"invalid"===e.msg[1].status){let s="";for(const a of t){const t=a.outerText||a.auth_value;if(null==t?void 0:t.includes(e.msg[1].identifier.value)){const e=t.split("\t");if((null==e?void 0:e.length)>1){s=e[1];break}}}const l=null==(r=e.msg[1])?void 0:r.identifier.value,n=null==(o=e.msg[1])?void 0:o.challenges[1],i=null==n?void 0:n.error.detail;if(p+="\n\t\t\t\t<p><span>验证域名：</span>".concat(l,"</p>\n\t\t\t"),"dns"===(null==a?void 0:a.type)||"dns"===(null==a?void 0:a.auth_type)){const e="_acme-challenge.".concat(l);p+="\n\t\t\t\t\t<p><span>验证解析：</span>".concat(e,"</p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(s||n.token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#222] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(i,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}else{const t="http://".concat(l,"/.well-known/acme-challenge/").concat(null==(c=e.msg[1])?void 0:c.challenges[0].token);p+='\n\t\t\t\t\t<p><span>验证URL：</span><a class="text-primary" href=\''.concat(t,"' target='_blank'>点击查看</a></p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(null==(u=e.msg[1])?void 0:u.challenges[0].token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#222] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(null==(d=e.msg[1])?void 0:d.challenges[0].error.detail,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}p+="<p><span>验证结果：</span> <a class='text-danger'>验证失败</a></p>"}i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,icon:"x",message:'\n\t\t\t<div class="flex items-center justify-center mt-[.8rem] mb-2rem">\n\t\t\t\t<i class="svgtofont-el-circle-close-filled mr-[.8rem] text-danger !text-[3rem]"></i>\n\t\t\t\t<a style="color: red; font-size:16px">\n\t\t\t\t\t'.concat(m,'\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class="p-[2rem] border border-1 border-color-dark !rounded-base !mb-[12px] !leading-[26px] bg-light">\n\t\t\t\t').concat(p,"\n\t\t\t</div>\n\t\t"),showClose:!0,duration:0})},Ti=()=>n({area:[50,25],showFooter:!1,component:()=>r(()=>import("./lets-encrypt-progress.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),Ei=ge([{label:"解析域名",prop:"name"},{label:"记录值",prop:"txt",render:(t,a)=>we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[t.txt]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:t.txt})},null)])},{label:"类型",prop:"type"},{label:"必需",prop:"force",width:100}]),Li=ge(),Ni=(e,t)=>{if(!1===e.status&&e.hasOwnProperty("msg")&&L(e.msg))i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});else if(!0!==e.status&&"pending"!==e.status&&void 0===(null==e?void 0:e.save_path))Ai(e,Xr.value.dnsTable,Xr.value.info);else{if("pending"===e.status&&"dns"===e.auth_type){Pi(e,t);let a=[];e.auths.forEach(e=>{let t=[];const s=e.domain.replace("*.","");t.push({name:"_acme-challenge.".concat(s),type:"TXT",txt:e.auth_value,force:"是"}),t.push({name:s,type:"CAA",txt:'0 issue "letsencrypt.org"',force:"否"}),a.push({domain:e.domain,data:t})});const s=[{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:"可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(e.auths[0].domain.replace("*.",""))},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}],l=!!e.hasOwnProperty("error")&&e.error;return Object.assign(wn,e),void(Li.value=n({title:"手动解析TXT记录",area:70,component:()=>we("div",{class:"p-[1.5rem]"},[_e("请按以下列表做TXT解析:"),we(ye,null,{content:()=>we("div",{class:"max-h-[38rem] overflow-auto"},[a.map((t,a)=>we("div",{key:a},[t.data.length>0&&we(je,null,[we("span",null,[_e("验证域名："),t.domain]),we(C,{class:"my-[1rem]",column:Ei.value,data:t.data},null),l.value&&we("div",{class:"flex justify-end"},[we(Ce,{type:"default",onClick:()=>Di({index:e.index,domain:t.domain})},{default:()=>[_e("验证")]})])])]))]),"footer-right":()=>!l.value&&we(Ce,{type:"default",onClick:Pn},{default:()=>[_e("验证")]})}),we(y,{options:s,listStyle:"disc",class:"ml-20x"},null)])}))}Oi(e)}},Di=async e=>{const t=await Ti(),{data:a}=await se(e);if(null==t||t.unmount(),"valid"===a.status)i.success("验证成功");else if(!0===a.status){const e=await Li.value;e&&e.unmount(),Ii(a,!0)}else Ai(a,Xr.value.dnsTable,Xr.value.info)},Ii=async({index:e},a=!1,s=ti.value.name)=>{const l=await t({loading:"正在部署证书，请稍候...",request:ee({index:e,siteName:s}),message:!1,data:{status:Boolean,msg:String}});bi(l,a)},Pi=(e,t)=>{Xr.value.dnsTable=e.auths,Xr.value.info.index=e.index,Xr.value.info.type=t.auth_type},Oi=async(e,a)=>{if(!e.private_key||!e.cert||!e.root)return void i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:"部署失败，请关闭SSL后重新尝试部署！",type:"error",showClose:!0,duration:0});const{private_key:s,cert:l,root:n}=e,r=ti.value.project_type,o={proxy:{site_name:ti.value.name,key:s,csr:l+n},default:{type:1,siteName:ti.value.name,key:s,csr:l+n}};await t({loading:"正在保存证书信息，请稍后...",request:B(o[r]||o.default,r),message:!0,success:e=>{if(!0===e.status)hi(),ui("currentCertInfo");else{let t=e.msg;t="当前证书申请并验证成功，自动部署失败，请尝试手动部署证书！\n"+t,i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:t,type:"error",showClose:!0,duration:0})}}})},Vi=e=>{n({title:"支付成功",area:[60,60],component:()=>r(()=>import("./pay-bus-success.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},Ri=async({type:e,oid:a,index:s,authType:l}=Jr.value,{name:n}=ti.value)=>{if(3===e)Bi(a,e);else if(32===(null==s?void 0:s.length)&&-1===s.indexOf("/")&&"dns"!==l)qi(s);else{const{data:e}=await t({request:ce({siteName:n,pem_file:s})});Hi(e)}},ji=async({type:e,oid:t,index:a,authType:s}=Jr.value,{name:l}=ti.value)=>{3===e?Bi(t,e):32===(null==a?void 0:a.length)&&-1===a.indexOf("/")&&"dns"!==s?qi(a):zi(null,!0)},Hi=async e=>{ar.value=e,ei.value=n({title:"续签Let's Encrypt证书",area:50,component:()=>r(()=>import("./lets-encrypt-renew.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},qi=async e=>{const a=await Ti(),{data:s}=await t({request:ue({index:e})});a._props.onCancel(),Ni(s,{auth_type:s.auth_type})},Bi=(e,t)=>{if(3===t)Mi(e)},Mi=async e=>{await c({title:"商业证书续签",content:"当前证书订单需要重新生成新订单，需要手动续签，和重新部署证书，是否继续操作？"});const a={pdata:JSON.stringify({oid:e})},s=await t({loading:"正在续签商业证书，可能等待时间较长，请稍后...",request:de(a),data:Object});if(o(s)&&s.hasOwnProperty("order_info")){let e=s.order_info;Ui({oid:s.oid,wxcode:s.wxcode,alicode:s.alicode,orderInfo:e,productInfo:{...e,productName:e.title,totalPrice:s.data.price,isRenew:!0}})}else i.request(s);hi()},Ui=async e=>{Wr.value=e.productInfo,$r.value=e.orderInfo,Yr.value=n({title:"支付商业证书订单",area:[60],component:()=>r(()=>import("./pay-bus-ssl.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},Fi=async()=>{const e=ai.value,a=ti.value.name,s={proxy:{site_name:a},default:{updateOf:1,siteName:a}},l=s[e]||s.default;await t({loading:"正在关闭证书，请稍后...",request:pe(l,e),message:!0,success:()=>{li.value=!0,oi.value=!0}}),hi()},zi=async(e,t)=>{ei.value=await n({isAsync:!0,title:t?"续签Let's Encrypt证书":"申请Let's Encrypt证书",area:64,component:()=>r(()=>import("./applay-lest-ssl.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{...e,isRenew:t}})},Ji=()=>{n({component:()=>r(()=>import("./index196.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:52,compData:{title:"SSL证书需求反馈收集",type:28,isNoRate:!0,softName:"1",isCard:!1,id:993}})};export{Ls as $,Zt as A,Xt as B,js as C,ps as D,Si as E,cs as F,as as G,vs as H,ws as I,ns as J,bs as K,Fa as L,fs as M,za as N,Ja as O,ls as P,Ma as Q,hs as R,Xa as S,Za as T,gs as U,Ua as V,_s as W,Ka as X,rs as Y,es as Z,Ts as _,Nr as a,Ds as a0,Et as a1,Ns as a2,As as a3,Cs as a4,ks as a5,xi as a6,ba as a7,oa as a8,ma as a9,Bn as aA,kn as aB,qn as aC,Qn as aD,Hn as aE,Fn as aF,zn as aG,Rn as aH,Yn as aI,Mn as aJ,or as aK,ir as aL,rr as aM,Ct as aN,hi as aO,xa as aa,ca as ab,pa as ac,Sa as ad,ha as ae,ya as af,ga as ag,wa as ah,_a as ai,Ha as aj,xs as ak,Yt as al,Ci as am,tr as an,er as ao,$n as ap,Vi as aq,gi as ar,nr as as,jn as at,Un as au,sr as av,lr as aw,ar as ax,Jn as ay,Zn as az,Lr as b,Ui as c,Pr as d,Hl as e,Ai as f,Er as g,mi as h,jl as i,Ri as j,Ji as k,Ti as l,vi as m,us as n,Ir as o,Qa as p,os as q,Cr as r,_i as s,pi as t,bi as u,$a as v,ts as w,Qt as x,Ya as y,Wa as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
