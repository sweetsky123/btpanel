import{aQ as e,Q as a,jq as r,L as t,k as o,jr as s,H as l,bH as n,aj as p}from"./utils-lib.js?v=1763689792";import{j as i,W as u,r as m,s as v,n as c,c as d,aB as g,g as w,e as h,D as y,J as b,c6 as O,aA as f,aE as j,v as E,a8 as _,x,O as k,z as C,y as P}from"./base-lib.js?v=1763689792";import{h as S,d as q,j as D,b as N,F as T,a as A}from"./form-item.js?v=1763689792";import{f as F}from"./validator.js?v=1763689792";import{D as I,s as R}from"./useController4.js?v=1763689792";import{g as J}from"./useStore3.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController5.js?v=1763689792";import"./site.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./useMethod5.js?v=1763689792";const L=i("DOCKERSITE-CREATE-SITE-BY-ENV-STORE",()=>{const e=u([]),a=u([]),r=m(!1);return{envOptions:e,portOptions:a,popoverFocus:r,getEnvOptions:async(e,a)=>{const{getEnvList:r}=I(),t=await r({runtime_type:e,p:1,row:100});Array.isArray(null==t?void 0:t.data)&&(a.value=t.data.map(e=>{const a=e.ports?JSON.parse(e.ports):{},r=Object.values(a).map(e=>({label:e[0].HostPort,value:e[0].HostPort}));return{label:e.name,value:"".concat(e.name,":").concat(e.version),path:e.path,portList:r}}))},getPortOptions:async(a,r)=>{const t=e.value.find(e=>e.value===a);return t?(r.value=JSON.parse(JSON.stringify(t.portList)),JSON.parse(JSON.stringify(t.portList))):(r.value=[],[])},$reset:()=>{e.value=[],a.value=[],r.value=!1}}}),{getEnvOptions:B,getPortOptions:V}=L(),{envOptions:H,portOptions:$}=v(L()),z=()=>({domain:"",type:"php",port:"9000",env:"",remark:"",path:""}),U=async(e,a)=>{a.value.port="php"===e?"9000":"",await B(e,H),c(()=>{var r,t;H.value.length>0?(a.value.env=H.value[0].value,a.value.path="php"===e?"/www/dk_project/wwwroot/".concat((null==(t=null==(r=a.value.domain)?void 0:r.split("\n")[0])?void 0:t.split(":")[0])||""):H.value[0].path||""):(a.value.env="",a.value.path=""),V(a.value.env,$),c(()=>{$.value.length>0&&(a.value.port=$.value[0].value)})})},Y=d({__name:"index",props:{compData:{default:!1}},setup(s,{expose:l}){const n=s,{getEnvOptions:p,getPortOptions:i,$reset:u}=L(),{envOptions:m,portOptions:d,popoverFocus:P}=v(L()),I=g("popupClose",()=>{}),{BtForm:J,submit:B,param:Y}=t({data:z,options:e=>w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:P.value,"onUpdate:visible":e=>P.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-primary text-white"},[y("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),y("IP地址格式：192.168.1.199"),h("br",null,null),y("泛解析添加方法 *.domain.com"),h("br",null,null),y("如另加端口格式为 www.domain.com:88")]),reference:()=>b(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{P.value=!0},onInput:()=>{var a;"php"===e.value.type&&(e.value.path="/www/dk_project/wwwroot/".concat((null==(a=e.value.domain.split("\n")[0])?void 0:a.split(":")[0])||""))},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),q([D("类型","type",[{label:"PHP",value:"php"},{label:"Java",value:"java"},{label:"Go",value:"go"},{label:"Python",value:"python"},{label:"Node",value:"nodejs"}],{attrs:{class:"!w-[17rem]",onChange:async a=>{U(a,e)}},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),..."php"===e.value.type?[N("PHP-FPM端口","port",{attrs:{class:"!w-[17rem]",placeholder:"请输入端口"},labelAttrs:{class:"ml-[2rem]"},rules:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:(e,a,r)=>{/^\d+$/.test(a)?Number(a)<1||Number(a)>65535?r(new Error("请输入正确的端口号")):r():r(new Error("端口号必须为数字"))},trigger:"blur"}]})]:[D("端口","port",d.value,{attrs:{class:"!w-[22rem]",placeholder:"环境端口"},rules:[{required:!0,message:"请选择端口",filterable:!0}]})]]),q([D("环境","env",m.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择环境",onChange:a=>{(async(e,a)=>{V(e,$),c(()=>{var r,t,o;$.value.length>0&&(a.value.port=$.value[0].value),a.value.path="php"===a.value.type?"/www/dk_project/wwwroot/".concat((null==(t=null==(r=a.value.domain)?void 0:r.split("\n")[0])?void 0:t.split(":")[0])||""):(null==(o=H.value.find(a=>a.value===e))?void 0:o.path)||""})})(a,e)}},rules:[{required:!0,message:"请选择环境",trigger:"change",filterable:!0}]}),T(()=>j("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:()=>{R(()=>{p(e.value.type,m)})}},"创建环境"),{key:"jump",rules:{}})]),A("运行目录","path",{attrs:{class:"!w-[320px]",placeholder:"请选择运行目录"},rules:[{required:!0,message:"请选择运行目录",trigger:"change"}],icon:"icon-file_mode",iconClick:()=>{var a;F({type:"dir",path:(a=e).value.path||"/www/dk_project/wwwroot",change:(e,r)=>{a.value.path=e}})}}),N("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]),submit:async(t,o,s)=>(await o(),await(async(t,o)=>{const{refreshSiteTable:s}=e(),l={domains:t.domain,type:t.type,name:t.env,..."php"===t.type?{port:Number(t.port)}:{},site_path:t.path,remark:t.remark,port:Number(t.port)};await a({loading:"正在创建，请稍后...",request:r(l),message:!0,success:e=>{s(),o&&o(e)}})})(t.value,e=>{e.status&&(u(),I())}))});return E(()=>{n.compData?c(async()=>{Y.value.type=n.compData.type,await U(n.compData.type,Y),c(()=>{Y.value.env=n.compData.env})}):p("php",m)}),_(()=>{}),l({onConfirm:B}),(e,a)=>(x(),k(C(J)))}}),K=i("DOCKERSITE-CREATE-SITE-BY-PROXY-STORE",()=>{const e=u([]),a=u([]),r=m(!1);return{conOptions:e,portOptions:a,popoverFocus:r,getConOptions:async e=>{const{data:a}=await s({type:"container"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map(e=>{const a=e.ports.map(e=>({label:e,value:e}));return{label:e.name,value:e.id,portList:a}}))},getPortOptions:async(a,r)=>{const t=e.value.find(e=>e.value===a);r.value=t?JSON.parse(JSON.stringify(t.portList)):[]},$reset:()=>{e.value=[],r.value=!1}}}),M=()=>({domain:"",name:"",container_id:"",port:"",remark:""}),Q=d({__name:"index",setup(s,{expose:l}){const n=K(),{popoverFocus:p,conOptions:i,portOptions:u}=v(n),{getConOptions:m,$reset:d}=n,j=g("popupClose",()=>{}),{BtForm:_,submit:P}=t({data:M,options:e=>w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p.value,"onUpdate:visible":e=>p.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-primary text-white"},[y("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),y("IP地址格式：192.168.1.199"),h("br",null,null),y("泛解析添加方法 *.domain.com"),h("br",null,null),y("如另加端口格式为 www.domain.com:88")]),reference:()=>b(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{p.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),D("容器","container_id",i.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择容器",onChange:a=>((e,a)=>{var r;const t=K(),{conOptions:o,portOptions:s}=v(t),{getPortOptions:l}=t;a.value.port="",a.value.name=(null==(r=o.value.find(a=>a.value===e))?void 0:r.label)||"",l(e,s),c(()=>{s.value.length>0&&(a.value.port=s.value[0].value)})})(a,e)},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),D("端口","port",u.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),N("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]),submit:async(t,o,s)=>(await o(),(async(t,o)=>{const{refreshSiteTable:s}=e(),l={domains:t.domain,type:"proxy",name:t.name,container_id:t.container_id,port:Number(t.port),remark:t.remark};await a({loading:"正在创建，请稍后...",request:r(l),message:!0,success:e=>{s(),o&&o(e)}})})(t.value,e=>{e.status&&(d(),j())}))});return E(()=>{m(i)}),l({onConfirm:P}),(e,a)=>(x(),k(C(_)))}}),W=i("DOCKERSITE-CREATE-SITE-BY-APP-STORE",()=>{const e=u([]),a=u([]),r=m(!1);return{appOptions:e,portOptions:a,popoverFocus:r,getAppOptions:async e=>{const{data:a}=await s({type:"app"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map(e=>{const a=e.port.map(e=>({label:e,value:e}));return{label:"".concat(e.service_name,"(").concat(e.apptitle,")"),value:e.service_name,portList:a}}))},getPortOptions:async(a,r)=>{const t=e.value.find(e=>e.value===a);r.value=t?JSON.parse(JSON.stringify(t.portList)):[]},$reset:()=>{e.value=[],a.value=[],r.value=!1}}}),G=()=>({domain:"",app:"",remark:""}),X=d({__name:"index",setup(s,{expose:p}){const{refs:{deployMenuData:i}}=J(),u=W(),{popoverFocus:m,appOptions:d,portOptions:_}=v(u),{getAppOptions:P,$reset:A}=u,F=g("popupClose",()=>{}),{BtForm:I,submit:R}=t({data:G,options:e=>w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:m.value,"onUpdate:visible":e=>m.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-primary text-white"},[y("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),y("IP地址格式：192.168.1.199"),h("br",null,null),y("泛解析添加方法 *.domain.com"),h("br",null,null),y("如另加端口格式为 www.domain.com:88")]),reference:()=>b(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{m.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),q([D("应用","app",d.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择应用",onChange:a=>((e,a)=>{var r;const t=W(),{appOptions:o,portOptions:s}=v(t),{getPortOptions:l}=t;a.value.port="",a.value.app=(null==(r=o.value.find(a=>a.value===e))?void 0:r.value)||"",l(e,s),c(()=>{s.value.length>0&&(a.value.port=s.value[0].value)})})(a,e)},rules:[{required:!0,message:"请选择应用",trigger:"change"}]}),T(()=>j("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:async()=>{const{router:e}=await l(()=>import("./utils-lib.js?v=1763689792").then(e=>e.lW),__vite__mapDeps([]),import.meta.url);n(),i.value.app_type="all",e.push({name:"docker-appstore"})}},"安装新应用"),{key:"jump",rules:{}})]),D("端口","port",_.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),N("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]),submit:async(t,o,s)=>{await o(),(async(t,o)=>{const{refreshSiteTable:s}=e(),l={domains:t.domain,type:"app",name:t.app,port:Number(t.port),remark:t.remark};await a({loading:"正在创建，请稍后...",request:r(l),message:!0,success:e=>{s(),o&&o(e)}})})(t.value,e=>{e.status&&(A(),F())})}});return E(()=>{P(d)}),p({onConfirm:R}),(e,a)=>(x(),k(C(I)))}}),Z={class:"p-[20px]"},ee=d({__name:"index",props:{compData:{default:{}}},setup(e,{expose:a}){const r=e,t=m(r.compData.type||"runEnv"),{BtTabs:o,tabsRefs:s}=p({type:"card",value:t,options:[{label:"运行环境",name:"runEnv",render:()=>h(Y,{compData:"runEnv"===r.compData.type&&r.compData.formData},null)},{label:"反代容器",name:"proxyContainer",lazy:!0,render:()=>h(Q,null,null)},{label:"从应用创建",name:"addPack",lazy:!0,render:()=>h(X,null,null)}]});return a({onConfirm:async e=>{s()[t.value].onConfirm(e)}}),(e,a)=>(x(),P("div",Z,[h(C(o))]))}});export{ee as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
