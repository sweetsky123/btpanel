import{n as e,H as a,Q as l,lq as t,lr as s,ls as o,ax as r,e as n,b as c}from"./utils-lib.js?v=1763689792";import{c as i,r as m,o as d,v as u,x as p,y as v,z as y,O as E,C as f,A as k,G as x,B as _,L as V,e as w,F as b,b1 as I,R as h,D as T,U as g,ak as C,aj as D,H as R}from"./base-lib.js?v=1763689792";import{_ as A}from"./index137.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";const j={class:"flex items-center"},P={class:"ml-[1rem]"},N={class:"flex items-center mt-6"},S={class:"w-[20rem] flex ml-[1rem]"},U={class:"flex items-center mt-6"},F={class:"w-[20rem] flex ml-[1rem]"},K={class:"my-6 flex items-center leading-[3rem]"},Y={class:"flex ml-[1rem]"},B=["onClick"],G={key:1,class:"flex mt-[1.2rem]"},z={class:"flex-1 mr-[2rem]"},L={class:"flex-1"},q={class:"list-disc text-[#777] px-[2rem] pt-[1.2rem]"},H={class:"flex items-center"},M=i({__name:"index",props:{compData:{default:()=>({})}},emits:["close"],setup(i,{emit:M}){const Q=c(),O=i,{addNoPortLogin:J}=O.compData,W=m(!1),X=m(!1),Z=m(!1),$=m([]),ee=d({domain:"",port:"",key:"",cert:""}),ae=M,le=m("auto"),te=[{title:"不部署证书",value:"no"},{title:"自定义证书",value:"auto"},{title:"选择已有证书",value:"select"}],se=e=>{ee.key=e.key,ee.cert=e.cert},oe=async()=>{l({loading:"正在关闭反向代理，请稍候...",request:t({container_id:O.compData.row.id}),message:!0,success:e=>{e.status&&(le.value="no",ee.key="",ee.cert="",ee.port="",ee.domain="",X.value=!1)}})},re=async(e,a)=>{if(!a)try{const a=await navigator.clipboard.readText(),l="key"===e?[/-----BEGIN PRIVATE KEY-----[\s\S]*?-----END PRIVATE KEY-----/,/-----BEGIN RSA PRIVATE KEY-----[\s\S]*?-----END RSA PRIVATE KEY-----/,/-----BEGIN EC PRIVATE KEY-----[\s\S]*?-----END EC PRIVATE KEY-----/]:[/-----BEGIN CERTIFICATE-----[\s\S]*?-----END CERTIFICATE-----/,/-----BEGIN CERTIFICATE REQUEST-----[\s\S]*?-----END CERTIFICATE REQUEST-----/];for(const t of l){const l=a.match(t);if(l&&l[0])switch(Q.success("已从粘贴板检测到".concat("key"===e?"密钥":"证书")),e){case"key":ee.key=l[0];break;case"cert":ee.cert=l[0]}}}catch(l){}},ne=async e=>{const a=Q.load("正在获取配置中，请稍候...");try{const{data:a}=await s({container_id:e}),l=a.proxy_port;l.length>0&&($.value=l.map(e=>({label:e,value:e})),ee.port=l[0]),Z.value=l.length>0;const{cert:t,key:o,name:r}=a;ee.domain=r,le.value=a.ssl?"auto":"no",X.value=!!a.status,ee.key=o||"",ee.cert=t||""}catch(l){a.close()}finally{a.close()}},ce=async()=>{if(ee.domain)if("no"===le.value||ee.key&&ee.cert){if(W.value){const{id:e,name:a}=O.compData.row;await l({request:o({container_id:e,container_name:a,container_port:ee.port,domain:ee.domain,privateKey:ee.key,certPem:ee.cert}),message:!0}),ne(O.compData.row.id)}else J(ee);ae("close")}else Q.error("请填写证书内容");else Q.error("域名不能为空")};return u(()=>{O.compData.row&&(W.value=!0,ne(O.compData.row.id))}),(l,t)=>{const s=A,o=g,c=r,i=C,m=D,d=R,u=n;return p(),v("div",{class:V(y(W)?"":"p-[2.4rem]")},[!y(Z)&&y(W)?(p(),E(s,{key:0,width:"36rem"},{content:f(()=>[...t[8]||(t[8]=[k("i",{class:"svgtofont-el-warning-filled text-warning mr-4px text-2rem"},null,-1),k("span",null,"当前容器暂无端口映射，无法做容器反向代理",-1)])]),_:1})):x("",!0),k("div",j,[t[9]||(t[9]=k("span",null,"反向代理状态：",-1)),k("span",P,_(y(X)?"已开启":"未开启"),1),k("span",{class:V(y(X)?"svgtofont-icon-start text-primary":"svgtofont-icon-stop text-[#ff0000]")},null,2)]),k("div",N,[t[10]||(t[10]=k("span",null,"绑定域名",-1)),k("div",S,[w(o,{modelValue:y(ee).domain,"onUpdate:modelValue":t[0]||(t[0]=e=>y(ee).domain=e),disabled:y(X),placeholder:"请输入绑定域名"},null,8,["modelValue","disabled"])])]),k("div",U,[t[11]||(t[11]=k("span",null,"需要代理的本地端口",-1)),k("div",F,[y(W)&&y($).length>0?(p(),E(c,{key:0,modelValue:y(ee).port,"onUpdate:modelValue":t[1]||(t[1]=e=>y(ee).port=e),placeholder:"请选择端口号",disabled:y(X),options:y($),class:"w-[20rem]"},null,8,["modelValue","disabled","options"])):(p(),E(o,{key:1,modelValue:y(ee).port,"onUpdate:modelValue":t[2]||(t[2]=e=>y(ee).port=e),type:"number",placeholder:"端口号"},null,8,["modelValue"]))])]),k("div",K,[t[12]||(t[12]=k("span",null,"SSL证书",-1)),k("div",Y,[w(m,{modelValue:y(le),"onUpdate:modelValue":t[3]||(t[3]=e=>h(le)?le.value=e:null),size:"small"},{default:f(()=>[(p(),v(b,null,I(te,(l,t)=>w(i,{key:t,value:l.value},{default:f(()=>[k("span",{onClick:t=>{return s=l.value,le.value=s,void("select"===s&&e({component:()=>a(()=>import("./selected-cert-dialog.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"免端口登录",area:70,showFooter:!1,compData:{selectdCert:se}}));var s}},_(l.title),9,B)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])])]),"no"!==y(le)?(p(),v("div",G,[k("div",z,[t[13]||(t[13]=k("div",{class:"text-small mb-[.8rem]"},_("密钥(KEY)"),-1)),w(o,{class:"text-small",type:"textarea",modelValue:y(ee).key,"onUpdate:modelValue":t[4]||(t[4]=e=>y(ee).key=e),rows:13,size:"small",placeholder:"粘贴您的*.key文件内容",onFocus:t[5]||(t[5]=e=>re("key",y(ee).key))},null,8,["modelValue"])]),k("div",L,[t[14]||(t[14]=k("div",{class:"text-small mb-[.8rem]"},_("证书(PEM格式)"),-1)),w(o,{type:"textarea",modelValue:y(ee).cert,"onUpdate:modelValue":t[6]||(t[6]=e=>y(ee).cert=e),rows:13,size:"small",placeholder:"粘贴您的*.pem文件内容",onFocus:t[7]||(t[7]=e=>re("cert",y(ee).cert))},null,8,["modelValue"])])])):x("",!0),w(d,{onClick:ce,type:"primary",class:"!mt-1rem"},{default:f(()=>[...t[15]||(t[15]=[T("保存",-1)])]),_:1}),y(X)?(p(),E(d,{key:2,onClick:oe,class:"!mt-1rem"},{default:f(()=>[...t[16]||(t[16]=[T("关闭反向代理",-1)])]),_:1})):x("",!0),k("ul",q,[t[19]||(t[19]=k("li",null,"配置此域名的证书到面板，浏览器即可信任访问",-1)),k("li",null,[k("div",H,[t[18]||(t[18]=T(" 粘贴您的*.key以及*.pem内容，然后保存即可 ",-1)),w(u,{href:"https://www.bt.cn/bbs/thread-105443-1-1.html"},{default:f(()=>[...t[17]||(t[17]=[T("帮助",-1)])]),_:1})])]),t[20]||(t[20]=k("li",null,"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书",-1)),t[21]||(t[21]=k("li",null,"PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt",-1)),t[22]||(t[22]=k("li",null,[T("如需更多设置，请前往"),k("a",{class:"bt-link",href:"/docker/dockersite"},"Docker--网站")],-1))])],2)}}});export{M as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
