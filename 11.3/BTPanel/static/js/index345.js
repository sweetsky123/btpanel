import{j as e,s as a,r as l,o as s,c as t,v as n,b7 as o,I as i,x as c,y as r,A as d,D as m,z as p,J as u,F as f,b1 as h,O as v,C as w,e as y,B as k,L as g,G as x,V as b,at as C,as as j,ar as M,am as V,an as _,U as S,ak as L,aT as P,aj as A,H as U}from"./base-lib.js?v=1763689792";import{u as H,M as I,kC as q,kD as D,kE as N,p as O,Q as E,kF as Q,kG as T,i8 as F,bQ as G,f as R,_ as J}from"./utils-lib.js?v=1763689792";import{H as z}from"./store2.js?v=1763689792";import{m as B}from"./validator.js?v=1763689792";import{u as K}from"./controller.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore.js?v=1763689792";import"./config.js?v=1763689792";const W=e("REC-INSTALL-STORE",()=>{const e=z(),{memory:t,panelInfo:n}=a(e),{isRefreshMenu:o,getGlobalInfo:i}=H(),c=l(),r=s({lnmp:{type:"lnmp",title:"LNMP（推荐）",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},lamp:{type:"lamp",title:"LAMP",install:1,soft:{Apache:{icon:"apache",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},java:{type:"java",title:"JAVA",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},jdk:{icon:"java",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},docker:{type:"docker",title:"Docker",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},Docker:{icon:"docker",value:"",selected:!0,disabled:!0,options:[{label:"Dokcer服务",value:""}]}}}}),d=l(!1),m=l([]),p=l([]),u=["home","soft","exit","config"],f=l([]),h=l([]),v={5.1:{max:256,rec:512},5.5:{max:600,rec:1024},5.6:{max:800,rec:1024},5.7:{max:1500,rec:2048},"8.0":{max:5e3,rec:10240},8.4:{max:8e3,rec:10240},"mariadb_10.4":{max:256,rec:2048},"mariadb_10.5":{max:256,rec:2048}},w={"4.0":["5.2","5.3","5.4","5.5","5.6","7.0","7.1","7.2","7.3","7.4"],4.4:["5.4","5.4","5.5","5.6","7.0","7.1","7.2","7.3"],4.9:["5.6","7.0","7.1","7.2","7.3","7.4","8.0"],"5.0":["7.2","7.3","7.4","8.0"],5.1:["7.2","7.3","7.4","8.0"],5.2:["7.2","7.3","7.4","8.0","8.1","8.2"]},y=["4.0"],k=["5.1"],g=["5.2","5.3","5.5","7.0"],x={2.2:{php:{min:"5.2",max:"5.4"},model:"php5_module"},2.4:{php:{min:"5.3",max:"8.1"},model:"php-fpm"}},b=(e,a)=>{const{icon:l,value:s}=e,n=v[s];switch(l){case"apache":I.warn("当前PHP将会以".concat(x[s].model,"模式运行!"));break;case"mysql":t.value.memTotal<n.max&&I.warn("您的内存小于".concat(n.rec/1024,"GB，不建议安装MySQL-").concat(s));break;case"php":(e=>{const a=r[e].soft.PHP.value;r[e].soft.phpMyAdmin.options=[],Object.keys(w).forEach(l=>{const s=w[l];s&&s.indexOf(a)>-1&&(r[e].soft.phpMyAdmin.options.push({label:"phpMyAdmin ".concat(l),value:l}),r[e].soft.phpMyAdmin.value=l)})})(a)}},C=async()=>{try{d.value=!0;const e=await G(),a=["ftp","wp","ssl","mail"],l=e.data.map(({id:e,show:a,title:l,children:s})=>{let t=(e.replace(/memu([A|_]?)/,"")||"home").toLowerCase();return"dologin"===t&&(t="exit"),"btwaf"===t&&(t="waf"),s=!!s&&s.map(a=>{let l=a.id;return"proxy"===l&&(l="nginx"),{...a,parentId:e,name:l}}),{name:t,show:a,title:l,id:e,children:s}});m.value=l.filter(e=>!a.includes(e.name)),p.value=l.filter(e=>a.includes(e.name)),o.value=!0}catch(e){}finally{d.value=!1}};return{recommend:r,initSoft:async()=>{const e=await T(),{data:a}=e;a.forEach(e=>{const{name:a}=e;if("Tomcat"===a)return;const l=[];let s="";switch(e.versions.forEach(({version:e})=>{const n=t.value.memTotal>=10240?"8.0":"5.7",o="PHP"===a&&"8.2"===e,i="MySQL"===a&&e===n,c="phpMyAdmin"===a&&"5.2"===e,r="jdk"===a&&e.includes("1.8"),d=v[e];let m="";switch(a.toLowerCase()){case"nginx":m=["1.25","1.26","1.28"].includes(e)?"[支持http3]":"";break;case"mysql":if(t.value.memTotal<d.max&&(m="[推荐".concat(d.rec/1024,"G内存机器安装]")),k.includes(e))return;break;case"php":if(g.includes(e))return;break;case"apache":m="[PHP运行模式：".concat(x[e].model,"]");break;case"phpmyadmin":if(!w[e])return;if(y.includes(e))return;if(-1!==w[e].indexOf("8.2"))return;break;case"jdk":e=e.replace("jdk","")}(!s&&o||i||c||r)&&(s=e),l.push({label:"".concat(a," ").concat(e),value:e,ps:m,disabled:!1})}),a.toLowerCase()){case"php":f.value.push(...l);break;case"phpmyadmin":h.value.push(...l)}!s&&l.length>0&&(s=l[0].value),Object.keys(r).forEach(e=>{const t=r[e].soft[a];t&&(t.value=s,t.options=l,"phpMyAdmin"===a&&"java"!==e&&b(r[e].soft.PHP,e))})})},installSoft:async e=>{let a=0;const l=I.load("正在添加软件至消息盒子，请稍后..."),s=r[e].install;for(const n in r[e].soft){const l=r[e].soft[n];if(l.selected){let e=n.toLowerCase();if("php"===e)e="php-"+l.value;else if("pure-ftpd"===e)e="pureftpd";else{if("jdk"===e){try{q({name:e,version:"java"===l.icon?"jdk"+l.value:l.value,type:1})}catch(t){}continue}if("docker"===e){await D({type:s?0:1});continue}}try{let t="";t=3===l.value.split(".").length?l.value.split(".")[2]:"0",await N({sName:e,version:"java"===l.icon?"jdk"+l.value:l.value,min_version:t,type:s,id:a++})}catch(t){}}}l.close(),await B(),i(),n.value.isSetup=!0,I.success("已将下载任务添加到队列!"),c.value("close")},changeSoftwareVersion:b,cancelShowRec:async()=>{await O({icon:"warning-filled",title:"取消显示推荐安装",content:"不再显示推荐安装信息，继续操作？"}),await E({loading:"正在取消显示推荐安装，请稍后...",request:Q({path:"/www/server/nginx"}),success:e=>{e.status?I.success("设置成功"):I.error("设置失败"),c.value("close")}})},goSoft:()=>{window.location.href="/soft"},goSetting:()=>{window.location.href="/config"},handleMenuChange:async e=>{try{let a={hide_list:JSON.stringify([e.id])};e.parentId&&(a.site_menu=1);const l=await F(a);l.status?I.success("设置成功，后期可以在左侧菜单栏中修改。"):I.request(l),await C(),K()}catch(a){}},updateMenuItems:C,load:d,menuList:m,moreMenuList:p,getList:e=>e.filter(e=>!u.includes(e.name)),filterList:u,emits:c}}),X={class:"h-full p-[2rem]"},Y={class:"commend-title"},Z={class:"commend-msg"},$={class:"select-con"},ee={class:"el-dropdown-link flex items-center text-small"},ae=["onClick"],le={class:"flex items-center justify-between w-full"},se=["onClick"],te={key:1,class:"flex items-center justify-between text-small"},ne=["onClick"],oe={class:"select-box"},ie={class:"flex items-center justify-between w-full"},ce=["onClick"],re={class:"commend-title"},de={class:"commend-msg"},me={class:"flex recommend-soft-list overflow-y-auto flex-wrap gap-[1.5rem]"},pe={class:"rounded-base recommend-cont"},ue={class:"mb-[1rem] pl-[.5rem] recommend-title text-center inline-block w-full font-bold text-large"},fe={class:"soft-list"},he={class:"pl-8 text-warning"},ve={class:"flex items-baseline my-8"},we={class:"flex justify-center"},ye=J(t({__name:"index",emits:["close"],setup(e,{emit:l}){const s=W(),{recommend:t,emits:H}=a(s),I=l;return H.value=I,n(()=>{s.initSoft(),s.updateMenuItems(),o(document.querySelector(".close-ad"),"click",()=>{s.cancelShowRec()})}),(e,a)=>{const l=b,n=C,o=j,H=M,I=R,q=V,D=_,N=S,O=L,E=P,Q=A,T=U,F=i("bt-loading");return c(),r("div",X,[d("div",Y,[a[4]||(a[4]=d("div",{class:"text-medium inline-block"},"左侧菜单设置",-1)),d("div",Z,[a[2]||(a[2]=m("-- 可以隐藏和关闭一些不需要的页面和功能，在面板",-1)),d("span",{class:"text-primary cursor-pointer hover:text-primaryDark",onClick:a[0]||(a[0]=(...e)=>p(s).goSetting&&p(s).goSetting(...e))}," 设置 "),a[3]||(a[3]=m("或左侧菜单栏下方可随时调整",-1))])]),u((c(),r("div",$,[(c(!0),r(f,null,h(p(s).getList(p(s).menuList),e=>(c(),r("div",{class:"select-box",key:e.id},[e.children&&e.children.length?(c(),v(H,{key:0,"hide-on-click":!1},{dropdown:w(()=>[y(o,null,{default:w(()=>[(c(!0),r(f,null,h(e.children,e=>(c(),v(n,{key:e.id},{default:w(()=>[d("div",le,[d("span",{class:"cursor-pointer",onClick:a=>p(s).handleMenuChange(e)},k(e.title),9,se),y(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[1rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024))),128))]),_:2},1024)]),default:w(()=>[d("span",ee,[d("span",{class:"cursor-pointer whitespace-nowrap",onClick:a=>p(s).handleMenuChange(e)},k(e.title),9,ae),a[5]||(a[5]=d("i",{class:"svgtofont-arrow-down ml-[.5rem]"},null,-1)),y(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[.5rem] w-[1.6rem] h-[1.6rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024)):(c(),r("div",te,[d("span",{class:"cursor-pointer whitespace-nowrap",onClick:a=>p(s).handleMenuChange(e)},k(e.title),9,ne),y(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[.5rem] w-[1.6rem] h-[1.6rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]))]))),128)),d("div",oe,[y(H,{"hide-on-click":!1},{dropdown:w(()=>[y(o,null,{default:w(()=>[(c(!0),r(f,null,h(p(s).moreMenuList,e=>(c(),v(n,{key:e.id},{default:w(()=>[d("div",ie,[d("span",{class:"cursor-pointer",onClick:a=>p(s).handleMenuChange(e)},k(e.title),9,ce),y(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[1rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024))),128))]),_:1})]),default:w(()=>[a[6]||(a[6]=d("span",{class:"el-dropdown-link flex items-center text-small"},[d("span",{class:"cursor-pointer whitespace-nowrap more-menu-trigger"},"更多"),d("i",{class:"svgtofont-arrow-down ml-[.5rem]"})],-1))]),_:1})])])),[[F,p(s).load]]),d("div",re,[a[10]||(a[10]=d("div",{class:"text-medium inline-block"},"一键安装套件",-1)),d("div",de,[a[7]||(a[7]=m(" -- 我们为您提供以下套件一键安装，请按需选择或在",-1)),d("span",{class:"text-primary cursor-pointer hover:text-primaryDark",onClick:a[1]||(a[1]=(...e)=>p(s).goSoft&&p(s).goSoft(...e))}," 软件商店 "),a[8]||(a[8]=m("页面中手动安装，推荐安装",-1)),a[9]||(a[9]=d("span",null,'"LNMP"',-1))])]),d("div",me,[(c(!0),r(f,null,h(p(t),e=>(c(),r("div",{key:e.type,class:"recommend-soft-item flex-1"},[d("div",pe,[d("span",ue,k(e.title),1),d("ul",fe,[(c(!0),r(f,null,h(e.soft,(a,t)=>(c(),r("li",{key:t,class:"flex items-center"},[y(I,{type:"icons",src:"soft/ico-".concat(a.icon,".svg"),class:g(["ml-1 mr-4","docker"!==a.icon?"!w-[3.2rem] !h-[3.2rem]":"!mr-[.6rem] !w-[5.5rem] !h-[3.2rem]"])},null,8,["src","class"]),"docker"!==a.icon?(c(),v(D,{key:0,modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,class:"flex-1 mr-[2rem]",size:"small",onChange:l=>p(s).changeSoftwareVersion(a,e.type)},{default:w(()=>[(c(!0),r(f,null,h(a.options,e=>(c(),v(q,{key:e.value,class:"flex justify-between",label:e.label,disabled:e.disabled,value:e.value},{default:w(()=>[d("span",null,k(e.label),1),d("span",he,k(e.ps),1)]),_:2},1032,["label","disabled","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):x("",!0),"docker"===a.icon?(c(),v(N,{key:1,class:"no-drap mr-[2rem]",value:"Docker服务",readOnly:""})):x("",!0),y(l,{modelValue:a.selected,"onUpdate:modelValue":e=>a.selected=e,disabled:a.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]))),128))]),d("div",ve,[a[15]||(a[15]=d("span",{class:"mr-4 whitespace-nowrap"},"安装方式：",-1)),y(Q,{modelValue:e.install,"onUpdate:modelValue":a=>e.install=a,class:"whitespace-nowrap"},{default:w(()=>[y(E,{class:"item",effect:"dark",placement:"top-start"},{content:w(()=>[...a[11]||(a[11]=[d("div",{class:"w-110"},"即rpm/deb，安装时间极快（5-10分钟），版本与稳定性略低于编译安装，适合快速部署测试",-1)])]),default:w(()=>[y(O,{class:"!mr-[1.2rem]",value:1},{default:w(()=>[...a[12]||(a[12]=[m("极速安装",-1)])]),_:1})]),_:1}),y(E,{class:"item",effect:"dark",placement:"top-start"},{content:w(()=>[...a[13]||(a[13]=[d("div",{class:"w-110"},"安装时间长（30分钟到2小时），性能最大化，适合生产环境",-1)])]),default:w(()=>[y(O,{class:"!mr-0",value:0},{default:w(()=>[...a[14]||(a[14]=[m("编译安装",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),d("div",we,[y(T,{type:"primary",onClick:a=>p(s).installSoft(e.type)},{default:w(()=>[...a[16]||(a[16]=[m("一键安装",-1)])]),_:1},8,["onClick"])])])]))),128))])])}}}),[["__scopeId","data-v-9f49c2ee"]]);export{ye as default};
