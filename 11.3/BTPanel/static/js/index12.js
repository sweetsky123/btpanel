import{_ as a}from"./index124.js?v=1763689792";import{j as e,r as t,o as s,e as l,c as r,s as n,v as i,a8 as o,x as d,y as u,J as m,K as c,z as p,A as v,R as _,F as h,S as y,M as b,B as g,b1 as x,D as w,O as k,ap as f,G as S,C as D,aA as M,ay as T}from"./base-lib.js?v=1763689792";import{V as C,Q as j,p as O,u as P,ax as V,l as q,_ as L}from"./utils-lib.js?v=1763689792";import{e as A,f as H,s as I,g as R}from"./control.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index107.js?v=1763689792";const U=e("CONTROL-STORE",()=>{const a=t("monitor"),e=s({title:"日报-功能介绍",ps:"能够对服务器运行情况进行监测，分析服务器异常的信息进行行为记录，协助管理员进行服务器分析。",source:211,desc:["服务器运行情况监测","异常信息记录","服务器分析"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/control/daily.png"}]}),r=t(!1),n=t([]),i=t(""),o=t(),d=t(""),u=t(),m=t(),c=t([]),p=t([]),v=t([]),_=async a=>{var e;const{data:t}=await j({request:A({date:a})});o.value=t.evaluate,"正常"===t.evaluate?d.value="var(--el-color-primary)":"良好"===t.evaluate?d.value="#2034a5":d.value="#ffa700";const s=t.date.toString();if(u.value=s.substr(0,4)+"-"+s.substr(4,2)+"-"+s.substr(6,2)+" 00:00:00 - 23:59:59",m.value=t.summary,n.value=[{name:"资源",value:"过载次数(五分钟内平均使用率超过80%)"},{name:"CPU",is_status:!0,data:t.data.cpu},{name:"内存",is_status:!0,data:t.data.ram},{name:"磁盘",is_status:!0,data:t.data.disk},{name:"常用服务",value:"异常次数(服务出现停止运行的次数)"},{name:"Nginx",is_status:!0,data:t.data.server.nginx},{name:"Mysql",is_status:!0,data:t.data.server.mysql},{name:"Apache",is_status:!0,data:t.data.server.apache},{name:"PHP",is_status:!0,data:t.data.server.php},{name:"Ftpd",is_status:!0,data:t.data.server.ftpd},{name:"Redis",is_status:!0,data:t.data.server.redis},{name:"Tomcat",is_status:!0,data:t.data.server.tomcat},{name:"Memcached",is_status:!0,data:t.data.server.memcached},{name:"备份类型",value:"备份失败",excess:"未开启备份",is_excess:!0},{name:"数据库",is_status:!0,data:t.data.backup.database.backup,data_excess:t.data.backup.database.no_backup,have_data_excess:!0},{name:"网站",is_status:!0,data:t.data.backup.site.backup,data_excess:t.data.backup.site.no_backup,have_data_excess:!0},{name:"异常类型",value:"次数"},{name:"面板异常登录",is_status:!0,data:t.data.exception.panel},{name:"SSH异常登录",is_status:!0,data:t.data.exception.ssh},{name:"安全",value:"次数"},{name:"安全风险",is_status:!0,data:t.data.safe.home_risks},{name:"网站漏洞扫描",is_status:!0,data:t.data.safe.vulnerabilities},{name:"恶意文件检测",is_status:!0,data:t.data.safe.malware}],null==(e=t.data.disk)?void 0:e.app_data){const a=h(t.data.disk.app_data);n.value.push({name:"空间存储状态",is_status:!0,data:a})}},h=a=>{let e=[];const t={sites:"站点",databases:"数据库",plugins:"面板插件",logs:"日志",backup:"备份"};return Object.keys(t).forEach(s=>{e.push({name:"".concat(t[s]),value:a[s]})}),e},y=async()=>{await j({request:H(),data:Array,success:a=>{const e={"正常":"success","良好":"warning","异常":"error"};c.value=null==a?void 0:a.map(a=>({label:a.time_key.toString().substr(0,4)+"-"+a.time_key.toString().substr(4,2)+"-"+a.time_key.toString().substr(6,2),value:a.time_key,isStatus:e[a.evaluate]||"error"})).reverse(),i.value=c.value.length?c.value[0].value:"",i.value&&_(i.value)}})},b=async()=>{await j({request:R(),data:[Boolean,r]})};return{tabActive:a,$reset:()=>{p.value=[],v.value=[],c.value=[],n.value=[]},selectData:c,dataList:v,tableList:n,selectValue:i,topStatus:o,topStatusColor:d,watchTime:u,summary:m,tableColumn:p,productData:e,dailyValue:r,getDailyStatus:b,changeDailyStatus:async a=>{await O({title:"日报",content:"您确定要".concat(a?"开启":"关闭","日报功能吗？")}),await j({request:I({status:a?"start":"stop"}),message:!0,success:async()=>{await b(),r.value&&y()}})},getPanelDailyInfoLists:y,getPanelDailyDatas:_,filterType:a=>{var e,t;return["数据库","网站","空间存储状态","安全风险","网站漏洞扫描","恶意文件检测"].includes(a.name)?"空间存储状态"===a.name||"数据库"===a.name||"网站"===a.name?a.data.length>0:(null==(t=null==(e=a.data.detail)?void 0:e.items)?void 0:t.length)>0:a.data.detail.length>0},goDetail:(a,e)=>{const t={1:"低危",2:"中危",3:"高危",4:"严重"};"数据库"==e||"网站"==e?a[0].target?p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"},{label:"时间",render:(a,e)=>C(a.time,"yyyy-MM-dd hh:mm:ss")}]:p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"}]:"面板异常登录"==e||"SSH异常登录"==e?p.value=[{label:"时间",showOverflowTooltip:!0,render:a=>C(a.time,"yyyy-MM-dd hh:mm:ss")},{label:"用户",prop:"username"},{label:"详情",prop:"desc"}]:"空间存储状态"==e?p.value=[{label:"名称",width:130,prop:"name"},{label:"占用空间",prop:"value"}]:"磁盘"==e?p.value=[{label:"路径",showOverflowTooltip:!0,prop:"name"},{label:"占用",render:a=>a.percent+"%"}]:"CPU"==e||"内存"==e?p.value=[{label:"过载时间",width:100,render:a=>l("span",null,[C(a.time,"yyyy-MM-dd hh:mm:ss")])},{label:"PID",prop:"pid",width:60},{label:"进程",prop:"name",showOverflowTooltip:!0},{label:"占用",width:60,render:a=>a.percent+"%"}]:["Nginx","Mysql","Apache","PHP","Ftpd","Redis","Tomcat","Memcached"].includes(e)?p.value=[{label:"停止时间",render:a=>C(a.time,"yyyy-MM-dd hh:mm:ss")}]:"安全风险"==e?p.value=[{label:"名称",prop:"title"},{label:"时间",render:a=>C(a.check_time,"yyyy-MM-dd hh:mm:ss"),width:"140"},{label:"风险级别",render:a=>t[a.level],width:"80"}]:"网站漏洞扫描"==e?p.value=[{label:"名称",prop:"risk_desc"},{label:"站点名称",prop:"site_name",showOverflowTooltip:!0,width:"100"},{label:"风险级别",render:a=>t[a.risk_level],width:"80"}]:"恶意文件检测"===e&&(p.value=[{label:"威胁类型",prop:"threat_type"},{label:"文件路径",prop:"filepath",showOverflowTooltip:!0},{label:"风险级别",render:a=>t[a.risk_level]},{label:"是否隔离",prop:"quarantined",render:a=>a.quarantined?"是":"否"}]),v.value="数据库"==e||"网站"==e||"空间存储状态"==e?a:"安全风险"===e||"网站漏洞扫描"==e||"恶意文件检测"===e?a.detail.items:a.detail,p.value.unshift({width:40,type:"index"})}}}),F={class:"content_box module-ui"},N={class:"relative"},z={class:"monitor mb-1rem"},B={class:"box-select"},E={class:"box-body"},$={class:"body_top"},G={class:"watch_time"},J={class:"msg_box"},K={class:"w-[95rem] mt-[2rem]"},Q={class:"item_name"},W={key:0,class:"!py-[0.8rem] pl-[0.8rem] inline-block border border-light border-t-0 w-full"},X=["onMouseover"],Y={key:2,class:"item_excess"},Z={key:3,class:"item_excess"},aa=["onMouseover"],ea=L(r({__name:"index",setup(e){const{payment:t}=P(),s=U(),{selectData:r,dataList:C,tableList:j,selectValue:O,topStatus:L,topStatusColor:A,watchTime:H,summary:I,tableColumn:R,productData:ea,dailyValue:ta}=n(s);return i(async()=>{await s.getDailyStatus(),ta.value&&s.getPanelDailyInfoLists()}),o(s.$reset),(e,n)=>{const i=f,o=V,P=q,U=M,sa=T,la=a;return d(),u("div",F,[m(v("div",N,[v("div",z,[n[3]||(n[3]=v("span",{class:"mr-8px align-middle"},"开启日报",-1)),l(i,{modelValue:p(ta),"onUpdate:modelValue":n[0]||(n[0]=a=>_(ta)?ta.value=a:null),onChange:p(s).changeDailyStatus},null,8,["modelValue","onChange"])]),p(r).length?(d(),u(h,{key:0},[v("div",B,[n[4]||(n[4]=v("span",null,"选择日期：",-1)),l(o,{modelValue:p(O),"onUpdate:modelValue":n[1]||(n[1]=a=>_(O)?O.value=a:null),onClick:n[2]||(n[2]=y(()=>{},["stop"])),options:p(r),class:"!w-[12.02rem]",onChange:p(s).getPanelDailyDatas},null,8,["modelValue","options","onChange"])]),v("div",E,[v("div",$,[v("span",{class:"top_status",style:b({color:p(A)})},g(p(L)),5),v("span",G,"监测时间："+g(p(H)),1),n[5]||(n[5]=v("span",{class:"text-left mb-[1.6rem]"},"健康信息提醒：",-1)),v("div",J,[(d(!0),u(h,null,x(p(I),(a,e)=>(d(),u("span",{key:e},"●"+g(a),1))),128))])]),v("div",K,[(d(!0),u(h,null,x(p(j),(a,e)=>(d(),u("div",{class:"bottom_item",key:e},[v("div",Q,[a.is_status?(d(),u("span",{key:0,class:"mr-[.5rem]",style:b({background:"空间存储状态"==a.name?"var(--el-color-primary)":"数据库"==a.name||"网站"==a.name?0==a.data.length&&0==a.data_excess.length?"var(--el-color-primary)":"red":0==a.data.ex?"var(--el-color-primary)":"red"})},null,4)):S("",!0),w(g(a.name),1)]),a.is_status?(d(),u("div",{key:0,class:"item_value",style:b({width:a.have_data_excess?"24rem":"auto"})},["空间存储状态"!==a.name?(d(),u(h,{key:0},[w(g("数据库"==a.name||"网站"==a.name?0==a.data.length?"未监测到异常":a.data.length+"次":0==a.data.ex?"未监测到异常":a.data.ex+"次"),1)],64)):S("",!0),p(s).filterType(a)?(d(),k(U,{key:1,width:"420",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:D(()=>[v("span",{class:"bt-link",onMouseover:e=>p(s).goDetail(a.data,a.name)},"  查看详情",40,X)]),default:D(()=>{var e,t;return[l(P,{ref_for:!0,ref:"menuTable1","max-height":300,data:p(C),column:p(R)},null,8,["data","column"]),(null==(e=a.data.detail)?void 0:e.check_time)?(d(),u("span",W,"检查时间："+g(null==(t=a.data.detail)?void 0:t.check_time),1)):S("",!0)]}),_:2},1024)):S("",!0)],4)):(d(),u("div",{key:1,class:"item_value",style:b({width:a.is_excess?"24rem":"auto"})},g(a.value),5)),a.is_excess?(d(),u("div",Y,g(a.excess),1)):S("",!0),a.is_status&&a.data_excess?(d(),u("div",Z,[w(g(a.have_data_excess&&a.data_excess.length?a.data_excess.length+"次":"未监测到异常")+" ",1),a.have_data_excess&&a.data_excess.length?(d(),k(U,{key:0,width:"350",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:D(()=>[v("span",{class:"bt-link",onMouseover:e=>p(s).goDetail(a.data_excess,a.name)},"  查看详情",40,aa)]),default:D(()=>[l(P,{ref_for:!0,ref:"menuTable2","max-height":300,data:p(C),column:p(R)},null,8,["data","column"])]),_:2},1024)):S("",!0)])):S("",!0)]))),128)),n[6]||(n[6]=v("span",{class:"bottom_tips"},[w("更多安全风险详情请到【首页-安全风险】中进行查看 "),v("br"),w("在系统监控开启的情况下，日报会记录服务器每天运行的异常信息，协助管理员分析服务器前一天是否运行正常。")],-1))])])],64)):(d(),k(sa,{key:1,"image-size":200,description:"面板日报暂无数据"}))],512),[[c,"ltd"===p(t).authType]]),m(l(la,{data:p(ea),class:"px-[20%] my-[8rem]"},null,8,["data"]),[[c,"ltd"!==p(t).authType]])])}}}),[["__scopeId","data-v-f3150210"]]);export{ea as default};
