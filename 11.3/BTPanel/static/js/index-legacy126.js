!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",l=a.toStringTag||"@@toStringTag";function i(n,a,u,l){var i=a&&a.prototype instanceof c?a:c,s=Object.create(i.prototype);return r(s,"_invoke",function(n,r,a){var u,l,i,c=0,s=a||[],f=!1,v={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return u=t,l=0,i=e,v.n=n,o}};function p(n,r){for(l=n,i=r,t=0;!f&&c&&!a&&t<s.length;t++){var a,u=s[t],p=v.p,m=u[2];n>3?(a=m===r)&&(i=u[(l=u[4])?5:(l=3,3)],u[4]=u[5]=e):u[0]<=p&&((a=n<2&&p<u[1])?(l=0,v.v=r,v.n=u[1]):p<m&&(a=n<3||u[0]>r||r>m)&&(u[4]=n,u[5]=r,v.n=m,l=0))}if(a||n>1)return o;throw f=!0,r}return function(a,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,m),l=s,i=m;(t=l<2?e:i)||!f;){u||(l?l<3?(l>1&&(v.n=-1),p(l,i)):v.n=i:v.v=i);try{if(c=2,u){if(l||(a="next"),t=u[a]){if(!(t=t.call(u,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,l<2&&(l=0)}else 1===l&&(t=u.return)&&t.call(u),l<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),l=1);u=e}else if((t=(f=v.n<0)?i:n.call(r,v))!==o)break}catch(t){u=e,l=1,i=t}finally{c=1}}return{value:t,done:f}}}(n,u,l),!0),s}var o={};function c(){}function s(){}function f(){}t=Object.getPrototypeOf;var v=[][u]?t(t([][u]())):(r(t={},u,function(){return this}),t),p=f.prototype=c.prototype=Object.create(v);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,l,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=f,r(p,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,l,"GeneratorFunction"),r(p),r(p,l,"Generator"),r(p,u,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:i,m:m}})()}function r(e,t,n,a){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}r=function(e,t,n,a){function l(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?u?u(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(l("next",0),l("throw",1),l("return",2))},r(e,t,n,a)}function a(e,t,n,r,a,u,l){try{var i=e[u](l),o=i.value}catch(e){return void n(e)}i.done?t(o):Promise.resolve(o).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,u){var l=e.apply(t,n);function i(e){a(l,r,u,i,o,"next",e)}function o(e){a(l,r,u,i,o,"throw",e)}i(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./index-legacy123.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy14.js?v=1763689792","./useController-legacy3.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./index-legacy118.js?v=1763689792","./index-legacy130.js?v=1763689792","./index-legacy131.js?v=1763689792","./column-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./validator-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792"],function(t,r){"use strict";var a,l,i,o,c,s,f,v,p,m,d,y,h,g,b,w,x,_,j,k,C,S,T,O,I,F,A,V,D,G,H,N,z,P,U,B,E,L,M,q,J,R,$,K,Q,W;return{setters:[function(e){a=e.k,l=e.b,i=e._,o=e.p,c=e.$,s=e.j},function(e){f=e._},function(e){v=e.c,p=e.r,m=e.o,d=e.w,y=e.a8,h=e.x,g=e.y,b=e.A,w=e.e,x=e.C,_=e.z,j=e.O,k=e.B,C=e.G,S=e.J,T=e.D,O=e.K,I=e.b6,F=e.H,A=e.ap,V=e.aA,D=e.s,G=e.n,H=e.g,N=e.v,z=e.F,P=e.b1,U=e.R,B=e.b2,E=e.b9,L=e.ba},function(e){M=e.C,q=e.w,J=e.s,R=e.i,$=e.o},function(e){K=e.A,Q=e.B,W=e.C},null,null,null,null,null,null,null,null,null],execute:function(){var r={class:"mr-[10px]"},X={class:"flex items-center"},Y={class:"flex items-center"},Z={class:"text-primary"},ee={class:"flex flex-col text-secondary p-12px"},te={class:"flex items-center"},ne={class:"flex items-center mt-[8px] w-full"},re=v({__name:"index",props:{refreshFn:{type:Function,default:function(){return{}}},sessionConfig:{default:function(){}}},emits:["save"],setup:function(t,i){var o=i.expose,c=i.emit,s=t,f=l(),v=c,D=p(!1),G=p(),H=p(!0),N=p(0),z=p(100),P=p(5),U=p(5),B=m({status:!1,time:5,timer:0}),E=!1,L=function(){var e=u(n().m(function e(t){return n().w(function(e){for(;;)switch(e.n){case 0:B.status=t,B.time=U.value,(!B.time||B.time<1)&&(B.time=5,U.value=5),t?(B.timer=setInterval(function(){E||s.refreshFn()},1e3*U.value),N.value=setInterval(function(){E||(P.value--,0===P.value&&(P.value=U.value),z.value=P.value/U.value*100)},1e3)):(clearInterval(B.timer),clearInterval(N.value),P.value=U.value,z.value=100,H.value||f.success("关闭成功")),v("save",B);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=u(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:if(!(B.time<1||!Number.isInteger(parseFloat(B.time.toString()))||B.time>99)){e.n=1;break}return f.error("时间间隔须在范围1~99秒内的整数"),e.a(2);case 1:P.value=B.time,U.value=B.time,f.success("保存成功"),clearInterval(B.timer),clearInterval(N.value),L(!0),v("save",B);case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),q=function(){var e=u(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,s.refreshFn();case 1:f.success("刷新成功");case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),J=function(){D.value=!1,B.time=U.value};d(function(){return s.sessionConfig},function(e){G.value=e,null!=e&&e.time&&H.value&&(U.value=e.time,P.value=e.time,L(e.status),H.value=!1)},{deep:!0});var R=function(){clearInterval(B.timer),clearInterval(N.value)};return y(function(){E=!0,R()}),o({clearIntervalFn:R}),function(t,n){var u=I,l=F,i=A,o=a,c=V;return h(),g("div",r,[b("div",X,[w(l,{class:"h-[3.2rem] refresh-btn",onClick:q},{default:x(function(){return[b("div",Y,[_(B).status?(h(),j(u,{key:0,class:"mr-8px",width:22,"show-text":!0,"stroke-width":1,type:"circle",color:"var(--el-color-primary)","text-color":"var(--el-color-primary)",percentage:_(z)},{default:x(function(){return[b("span",Z,k(Number(_(P))),1)]}),_:1},8,["percentage"])):C("",!0),n[3]||(n[3]=b("span",null,"刷新日志",-1))])]}),_:1}),w(c,{placement:"bottom-start",width:"280",trigger:"click","popper-class":"el-tooltip-white",onHide:J},{reference:x(function(){return[w(l,{class:"down-button !ml-0",onClick:n[2]||(n[2]=function(e){return D.value=!_(D)})},{default:x(function(){return e(n[7]||(n[7]=[b("i",{class:"svgtofont-el-arrow-down"},null,-1)]))}),_:1})]}),default:x(function(){return[b("div",ee,[b("div",te,[n[4]||(n[4]=b("span",{class:"mr-4px"},"定时刷新",-1)),w(i,{modelValue:_(B).status,"onUpdate:modelValue":n[0]||(n[0]=function(e){return _(B).status=e}),onChange:L},null,8,["modelValue"])]),S(b("div",ne,[n[6]||(n[6]=b("span",{class:"mr-4px flex-nowrap"},"时间间隔",-1)),w(o,{modelValue:_(B).time,"onUpdate:modelValue":n[1]||(n[1]=function(e){return _(B).time=e}),"text-type":"秒",min:1,type:"number",class:"!w-[10rem]"},null,8,["modelValue"]),w(l,{class:"!ml-4px",type:"primary",onClick:M},{default:x(function(){return e(n[5]||(n[5]=[T("保存",-1)]))}),_:1})],512),[[O,_(B).status]])])]}),_:1})])])}}}),ae=i(re,[["__scopeId","data-v-66473ffd"]]),ue=l(),le=M(),ie=D(le).rowData,oe=p("正在获取中...."),ce=p({log_path:"",size:""}),se=p(!1),fe=p(""),ve=p([]),pe=p(0),me=p(""),de=p(),ye=p(),he=m({status:!1,time:3}),ge=p([new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,999))]),be=p(),we=[{label:"全部",value:0},{label:"近7天",value:1},{label:"近30天",value:2},{label:"自定义时间",value:3}],xe=function(e){pe.value=e,3!==e?(me.value="",ke(!1)):de.value.focus()},_e=function(e){pe.value=3,me.value=e,ke(!1)},je=function(e){var t=Number(e);return t=t<3?3:t},ke=function(){var e=u(n().m(function e(t){var r,a,u,l,i;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t&&(ye.value=je(he.time)),r=0,a=0,0!==pe.value?(u=1===pe.value?7:30,l=(new Date).getTime(),r=(new Date(l-24*u*60*60*1e3).getTime()/1e3).toFixed(0),a=(l/1e3).toFixed(0),3===pe.value&&(r=(new Date(me.value[0]).getTime()/1e3).toFixed(0),a=(new Date(me.value[1]).getTime()/1e3).toFixed(0))):(r="",a=""),e.n=1,K({id:ie.value.id,start_timestamp:r,end_timestamp:a});case 1:i=e.v,oe.value=i.data.msg||"暂无日志",Ce(),t&&Se(),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),Ce=function(){G(function(){var e=document.querySelector(".pre-box");e&&(e.scrollTop=e.scrollHeight)})},Se=function(){var e=u(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Q({id:ie.value.id});case 1:t=e.v,r=t.data,ce.value.log_path=r.log_path,ce.value.size=r.size,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),Te=function(e){he.status=e.status,he.time=e.time,be.value[ie.value.id]=he,be.value[ie.value.id].id=ie.value.id,sessionStorage.setItem("CRONTAB-LOGS",JSON.stringify(be.value))},Oe=function(){var e=sessionStorage.getItem("CRONTAB-LOGS");be.value=e?JSON.parse(e):{},be.value&&be.value[ie.value.id]?(he.status=be.value[ie.value.id].status,he.time=Number(be.value[ie.value.id].time)||3,be.value[ie.value.id].id=ie.value.id):Te({status:!1,time:5,id:ie.value.id}),Se(),ke()},Ie=function(){var e=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,o({title:"提示",content:"确定清空日志吗？"});case 1:return e.n=2,W({id:ie.value.id});case 2:t=e.v,ue.request(t),ke(!0),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}));return function(){return e.apply(this,arguments)}}(),Fe=function(){var e=u(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:try{se.value=!0,fe.value="",ve.value=[],q.request("/crontab/set_execute_script",{customType:"model",onMessage:function(e){!0!==e&&"successful"!==e&&(ve.value.push(e),fe.value=ve.value.join("\n"))}})}catch(t){}case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ae=function(e){var t=new Date;return t.setHours(23,59,59,999),e.getTime()>t.getTime()},Ve=function(){var e=u(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,J(!1,!0);case 1:Oe();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),De={class:"p-[20px]"},Ge={class:"pb-2rem flex gap-2rem leading-2rem"},He={class:"max-w-[54rem] truncate"},Ne=["title"],ze={class:"flex justify-between items-end"},Pe={class:"flex items-center"},Ue={class:"flex refresh-btn"},Be={class:"flex items-center relative"},Ee={class:"pre-box bg-[#333] mt-[12px] text-white h-[48rem] overflow-auto p-[20px]"},Le=["innerHTML"],Me={class:"flex-wrap"},qe=v({__name:"index",emits:["close"],setup:function(t,n){var r=n.emit,a=H(function(){return[].concat(e(R.value?[{content:w("span",{class:"bt-link",onClick:function(){return $(u)}},[T("一键跳转至本地备份目录")])}]:[]),[{content:function(){return w("span",null,[T("若您发现任务无法定时执行，可尝试点击"),w("span",{class:"bt-link",onClick:function(){return Fe()}},[T("【重装Crontab】")]),T("进行重新安装")])}}])}),u=function(){r("close")};return N(Oe),function(t,n){var r=ae,u=F,l=B,i=E,o=L,v=c,p=f,m=s;return h(),g("div",De,[b("div",Ge,[b("div",He,"日志路径："+k(_(ce).log_path),1),b("div",{class:"w-[20rem] truncate",title:"大小：".concat(_(ce).size)},"大小： "+k(_(ce).size),9,Ne)]),b("div",ze,[b("div",Pe,[b("div",Ue,[w(r,{refreshFn:function(){return _(ke)(!0)},"session-config":_(he),onSave:_(Te)},null,8,["refreshFn","session-config","onSave"])]),w(u,{onClick:_(Ie)},{default:x(function(){return e(n[2]||(n[2]=[T(" 清空日志 ",-1)]))}),_:1},8,["onClick"]),w(l,{direction:"vertical",class:"!h-[2rem] !mx-1rem"}),w(u,{onClick:_(Ve)},{default:x(function(){return e(n[3]||(n[3]=[T("执行任务",-1)]))}),_:1},8,["onClick"])]),b("div",Be,[w(i,{size:"default",class:"control-btn"},{default:x(function(){return[(h(!0),g(z,null,P(_(we),function(e,t){return h(),j(u,{key:t,type:_(pe)===t?"primary":"",onClick:function(t){return _(xe)(e.value)}},{default:x(function(){return[T(k(e.label),1)]}),_:2},1032,["type","onClick"])}),128))]}),_:1}),w(o,{modelValue:_(me),"onUpdate:modelValue":n[0]||(n[0]=function(e){return U(me)?me.value=e:null}),type:"daterange",ref_key:"player",ref:de,align:"right",size:"default",class:"!absolute right-0 top-0 opacity-0 !w-0 !h-0","range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期","disabled-date":_(Ae),"default-time":_(ge),onChange:_(_e)},null,8,["modelValue","disabled-date","default-time","onChange"])])]),b("div",Ee,[b("pre",{class:"whitespace-pre-wrap",innerHTML:_(oe)},null,8,Le)]),w(v,{options:_(a),"list-style":"disc",class:"mt-[1rem] mx-[1rem]"},null,8,["options"]),w(m,{title:"正在检查Crontab，请耐心等候",modelValue:_(se),"onUpdate:modelValue":n[1]||(n[1]=function(e){return U(se)?se.value=e:null}),area:[60]},{default:x(function(){return[b("div",Me,[w(p,{class:"h-[40rem] !rounded-none",content:_(fe)},null,8,["content"])])]}),_:1},8,["modelValue"])])}}});t("default",i(qe,[["__scopeId","data-v-7174226c"]]))}}})}();
