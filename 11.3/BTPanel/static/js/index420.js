import{e,Q as s,i1 as a,ax as l,$ as t}from"./utils-lib.js?v=1763689792";import{c as o,s as i,r,e as u,D as n,v as m,n as d,a8 as p,I as c,x as v,y as _,C as f,z as b,J as x,O as j,F as g,b1 as k,A as y,B as h,U as w,ad as V,b2 as C,am as q,ab as D}from"./base-lib.js?v=1763689792";import{V as S,W as U,O as L,X as M}from"./ssl.js?v=1763689792";import{u as F,o as O}from"./index89.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index109.js?v=1763689792";import"./index260.js?v=1763689792";import"./we-com.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController15.js?v=1763689792";import"./site.js?v=1763689792";import"./useStore12.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./useController5.js?v=1763689792";import"./useMethod5.js?v=1763689792";import"./useController4.js?v=1763689792";import"./useMethod12.js?v=1763689792";import"./useStore11.js?v=1763689792";import"./useMethod7.js?v=1763689792";const R={class:"p-[16px]"},T={class:"flex items-center"},z=o({__name:"index",props:{compData:{}},emits:["close"],setup(o,{expose:z,emit:A}){const B=o,E=A,{isEdit:H,row:I}=B.compData,{deployFormData:J,siteList:Q,certificateDeployTaskList:W,isRefreshDeployTaskList:X}=i(F()),$=r(),G=r(!1),K=r(!1),N=[{content:"提示：请先在宝塔官网->SSL模块->自动同步中创建同步任务，请不要泄露同步任务的密钥"},{content:u(e,{class:"inline-block",onClick:O},{default:()=>[u("div",{class:"flex items-center"},[u("span",{class:"text-small"},[">>"]),u("span",null,[n("使用说明")])])]})}],P={task_name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符之间",trigger:"blur"}],cloud_id:[{required:!0,message:"请选择证书部署任务",trigger:["blur","change"]}],private_key:[{required:!0,message:"请输入密钥",trigger:"blur"}],sites:[{required:!0,message:"请选择至少一个网站",trigger:"change"},{type:"array",min:1,message:"请选择至少一个网站",trigger:"change"}]},Y=()=>{window.open("https://www.bt.cn/admin/safe","_blank","noopener,noreferrer")};return m(()=>{(async()=>{G.value=!0,s({request:L(),success:e=>{const{data:s}=e;Q.value=s.map(e=>({label:e.name,value:e.name})),G.value=!1}})})(),(async()=>{K.value=!0,s({request:M(),success:e=>{W.value=e.data.map(e=>({label:e.synchron_name,host:e.host,value:e.id})),K.value=!1}})})(),d(()=>{var e;H?(J.value.task_id=I.id,J.value.task_name=I.task_name,J.value.cloud_id=I.cloud_id,J.value.private_key=I.private_key,J.value.sites=null==(e=I.sites)?void 0:e.split(",")):J.value.task_name=a(8)})}),p(()=>{J.value={}}),z({onConfirm:async()=>{if($.value)try{await $.value.validate();const e={...J.value,sites:J.value.sites.join(",")};s({loading:H?"正在修改同步任务":"正在创建同步任务",message:!0,request:H?S(e):U(e),success:e=>{e.status&&(X.value=!0,E("close"))}})}catch(e){}}}),(s,a)=>{const o=w,i=V,r=C,n=q,m=l,d=e,p=D,S=t,U=c("bt-loading");return v(),_("div",R,[u(p,{ref_key:"formRef",ref:$,model:b(J),rules:P,"label-width":"120px"},{default:f(()=>[u(i,{label:"名称",prop:"task_name"},{default:f(()=>[u(o,{class:"!w-[230px]",placeholder:"请输入名称",disabled:b(H),modelValue:b(J).task_name,"onUpdate:modelValue":a[0]||(a[0]=e=>b(J).task_name=e)},null,8,["disabled","modelValue"])]),_:1}),u(i,{label:"选择证书部署任务",prop:"cloud_id"},{default:f(()=>[x((v(),j(m,{class:"!w-[230px]",placeholder:"请选择证书部署任务",modelValue:b(J).cloud_id,"onUpdate:modelValue":a[1]||(a[1]=e=>b(J).cloud_id=e)},{default:f(()=>[(v(!0),_(g,null,k(b(W),e=>(v(),j(n,{key:e.value,label:e.label,value:e.value},{default:f(()=>[y("div",T,[y("span",null,h(e.label),1),u(r,{direction:"vertical"}),y("span",null,h(e.host),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[U,b(K)]]),u(d,{class:"ml-[12px]",onClick:Y},{default:f(()=>[...a[4]||(a[4]=[y("div",{class:"flex items-center"},[y("span",{class:"text-small"},">>"),y("span",null,"去创建")],-1)])]),_:1})]),_:1}),u(i,{label:"密钥",prop:"private_key"},{default:f(()=>[u(o,{class:"!w-[230px]",placeholder:"请输入密钥",modelValue:b(J).private_key,"onUpdate:modelValue":a[2]||(a[2]=e=>b(J).private_key=e)},null,8,["modelValue"]),u(d,{class:"ml-[12px]",onClick:Y},{default:f(()=>[...a[5]||(a[5]=[y("div",{class:"flex items-center"},[y("span",{class:"text-small"},">>"),y("span",null,"去获取")],-1)])]),_:1})]),_:1}),u(i,{label:"选择网站",prop:"sites"},{default:f(()=>[x(u(m,{class:"!w-[230px]",multiple:!0,placeholder:"请选择网站",options:b(Q),modelValue:b(J).sites,"onUpdate:modelValue":a[3]||(a[3]=e=>b(J).sites=e)},null,8,["options","modelValue"]),[[U,b(G)]])]),_:1})]),_:1},8,["model"]),u(S,{options:N,listStyle:"disc",class:"ml-[20px]"})])}}});export{z as default};
