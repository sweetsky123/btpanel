import{u as a,Q as e,n as s,H as l,aE as t,M as n,aF as o,e as i,aG as r,P as m,aB as u,l as d,ah as c,aH as p,aI as f,aJ as y,W as v}from"./utils-lib.js?v=1763689792";import{_}from"./index109.js?v=1763689792";import{_ as g}from"./index118.js?v=1763689792";import{_ as b}from"./index130.js?v=1763689792";import{B as h}from"./index131.js?v=1763689792";import{c as x,aH as k,g as C,o as w,r as j,w as q,a0 as A,v as L,I as M,x as S,y as V,z as R,O as I,C as D,e as E,G as H,A as T,R as U,F as B,B as P,D as F,S as N,L as O,J as z,ap as G,aZ as J,H as Q,at as W,as as Y,ar as Z,aT as K}from"./base-lib.js?v=1763689792";import{_ as X}from"./index137.js?v=1763689792";import{a as $,f as aa,g as ea,u as sa}from"./column.js?v=1763689792";import{addDbTypes as la,modifyDbTypes as ta,delDbTypes as na,getMysqlRootPwd as oa,getMysqlCloudServer as ia,setAutoConfig as ra,getDbTypes as ma,getMysqlList as ua,getAutoConfig as da}from"./database.js?v=1763689792";import{o as ca,a as pa,b as fa,c as ya,s as va,d as _a,e as ga,f as ba,g as ha,h as xa,i as ka,j as Ca,k as wa,l as ja}from"./useMethod4.js?v=1763689792";import{g as qa}from"./useStore2.js?v=1763689792";import{e as Aa,g as La,p as Ma}from"./validator.js?v=1763689792";import{B as Sa}from"./index138.js?v=1763689792";import{_ as Va}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1763689792";import{_ as Ra}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./index107.js?v=1763689792";const Ia={class:"inline-flex items-center mr-2rem"},Da={key:0,class:"text-small"},Ea={class:"flex items-center"},Ha=x({__name:"index",setup(y){const{refs:{isRefreshTable:x,isLoading:Ha,softData:Ta,isHaveServer:Ua,isRefreshClassList:Ba},resetRefresh:Pa,refreshTableList:Fa}=qa(),Na=k(),{payment:Oa,mainWidth:za}=a(),Ga=C(()=>Oa.value.authType),Ja=w({status:!1,code:""}),Qa=j(!1),Wa=j(""),Ya=w({total:0,page:1,row:10}),Za=j([]),Ka=j([]),Xa=j(null),$a=j("all"),ae=j(""),ee=j([]),se=j([]),le=j([]),te=C(()=>za.value>1530?280:za.value>1440?200:za.value>1200?150:120),ne=C(()=>!Ta.value.setup&&!Ua.value);q(Ba,a=>{a&&(Ba.value=!1,de())});const oe=[{label:"设置权限",value:"permission",event:async(a,e,s,l,t,n)=>ya(s.value,"multlples",{...n,clearBatch:t})},{label:"设置分类",value:"class",event:async(a,e,s,l,t,n)=>{va(s,t,ie,n)}},..._a()],ie=j([]),re=j([]),me=a=>{ae.value=a,Ya.page=1,Fa()},ue=()=>{Ya.page=1,Fa()},de=async()=>(await e({request:ma({db_type:"mysql"}),data:{msg:Array},success:({msg:a})=>{ie.value=[...a.map(a=>({label:a.ps,value:String(a.id)}))],se.value=[{label:"全部分类",value:"all"},...a.map(a=>({label:a.ps,value:String(a.id)}))],re.value=se.value.map(a=>a.value).filter(a=>Number(a)>=0||"all"===a)}}),Promise.resolve(se.value||[])),ce=async()=>{const a=await e({loading:"正在获取密码，请稍后...",request:oa({table:"config",id:1,key:"mysql_root"}),data:String});ga(a)},pe=a=>{s({title:"高级设置",area:[96,62],compData:a,component:()=>l(()=>import("./index135.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},fe=async()=>(await e({request:ia(),data:[Array,ee]}),ee.value.length||(Ua.value=!1),ee.value),ye=async(a={p:Ya.page,limit:Ya.row,table:"databases",search:ae.value,sid:"all"===$a.value?"":$a.value})=>{""===a.sid&&delete a.sid,Number(a.sid)<0&&(a.type_id=a.sid,delete a.sid),await e({loading:Ha,request:ua(a),data:{data:[Array,Za],page:v(Ya),search_history:[Array,le],error:String},success:a=>{wa.value=a.data,a.error&&(Ja.status=!0,Ja.code=a.error)}})},ve=async a=>{Qa.value=a;try{await e({loading:"正在设置自动备份数据库...",request:ra({name:"mysql",status:a?1:0}),message:!0,success:e=>{e.status||(Qa.value=!a)}})}catch(s){}finally{undefined.close()}},_e=()=>Na.push({path:"/crontab/task"}),ge=()=>{localStorage.setItem("MYSQL-RECYCLE","true"),window.location.href="/files"},be=[{name:"企业增量备份",ename:"increment",callback:()=>pe("increment")},{name:"远程数据库",ename:"server",callback:()=>pa()},{name:"关联服务",ename:"service",callback:()=>pe("service")},{name:"容量限制",ename:"capacity",callback:()=>{if(!Za.value.length)return n.error("暂无数据库，请先添加数据库");if(!Za.value.some(a=>0===a.sid))return n.error("当前页暂无本地数据库进行容量配额！");(a=>{"ltd"===Ga.value?0===a.sid?s({title:"数据库配额",area:50,component:()=>l(()=>import("./index136.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:a,showFooter:!0}):n.error("仅本地数据库支持设置容量配额"):Ma({sourceId:52})})(Za.value.filter(a=>0===a.sid)[0])}},{name:"敏感词检测",ename:"sensitive",callback:()=>pe("sensitive")},{name:"Mysql用户管理",ename:"user",callback:()=>pe("user")}],he=()=>[$({type:"page",key:"id"}),...ba(ka),aa({event:(a,e)=>ja(a,e)}),ha(ee.value,"mysql"),ea({table:"databases"}),sa([{isHide:a=>!!a.sid,onClick:a=>(async(a,e)=>{let s=n.success("正在跳转phpMyAdmin，请稍后...");try{const{data:s}=await p({sName:"phpmyadmin"});if("panel"===e){if(null==s?void 0:s.ext.auth)return n.error("当前phpMyAdmin已开启密码访问，请使用【通过公共访问】进行访问");if("false"===(null==s?void 0:s.setup))return n.error("当前phpMyAdmin未安装，请先安装phpMyAdmin");await f(a.username,a.password)}}catch(l){}finally{s.close()}})(a,"panel"),title:"管理"},{onClick:ya,title:"权限"},{onClick:a=>xa(a),title:"工具"},{onClick:a=>ka(a),title:"改密"},{onClick:a=>Ca(a),title:"删除"}])];return q(()=>x.value,async a=>{a&&await ye(),Pa()}),A("serverList",ee),L(async()=>{Ka.value=he(),!ne.value&&La({promises:[de],delay:1e3}),(async()=>{try{const{data:a}=await da({name:"mysql"});Qa.value=!!a.status,Wa.value=a.cycle}catch(a){}})(),ye(),await fe(),Ka.value=he(),t(Ka.value,"database_mysql_column")}),(a,e)=>{const s=X,l=o,t=G,n=J,p=Q,f=W,y=Y,v=Z,x=K,k=i,C=h,w=r,j=m,q=b,A=u,L=d,$=c,aa=g,ea=_,sa=M("bt-loading");return S(),V("div",null,[R(ne)?(S(),I(s,{key:0,options:R(Ta)},{content:D(()=>[E(Va,{type:"Mysql"})]),_:1},8,["options"])):H("",!0),R(Ja).status?(S(),I(l,{key:1,options:R(Ja)},null,8,["options"])):H("",!0),E(n,{type:"info",closable:!1,class:"!mb-[12px]","show-icon":""},{title:D(()=>[T("div",Ia,[e[8]||(e[8]=T("div",{class:"mr-4 min-w-max text-secondary text-small"},"自动备份数据库",-1)),E(t,{size:"small",class:"mr-8px",modelValue:R(Qa),"onUpdate:modelValue":e[0]||(e[0]=a=>U(Qa)?Qa.value=a:null),width:36,onChange:ve},null,8,["modelValue"]),R(Qa)?(S(),V(B,{key:1},[T("span",null,P(R(Wa)),1),T("span",{class:"bt-link",onClick:_e},"[前往计划任务]")],64)):(S(),V("div",Da," 添加数据库后，可开启自动备份，保证数据安全。 "))])]),_:1}),E(ea,null,{"header-left":D(()=>[T("div",Ea,[E(p,{type:"primary",onClick:e[1]||(e[1]=a=>R(ca)(fe))},{default:D(()=>[...e[9]||(e[9]=[F(" 添加数据库 ",-1)])]),_:1}),R(Ta).setup?(S(),I(p,{key:0,onClick:ce},{default:D(()=>[...e[10]||(e[10]=[F("root密码",-1)])]),_:1})):H("",!0),E(p,{onClick:R(pa)},{default:D(()=>[...e[11]||(e[11]=[F("远程数据库",-1)])]),_:1},8,["onClick"]),E(p,{onClick:R(fa)},{default:D(()=>[...e[12]||(e[12]=[F("phpMyAdmin",-1)])]),_:1},8,["onClick"]),E(v,{class:"ml-10px","split-button":"",type:"default",onClick:e[2]||(e[2]=N(a=>pe("route"),["stop"])),onCommand:pe},{dropdown:D(()=>[E(y,null,{default:D(()=>[E(f,{command:"route"},{default:D(()=>[...e[13]||(e[13]=[F("数据库备份",-1)])]),_:1}),E(f,{command:"user"},{default:D(()=>[...e[14]||(e[14]=[F(" 用户管理 ",-1)])]),_:1}),E(f,{command:"service"},{default:D(()=>[...e[15]||(e[15]=[F("关联服务",-1)])]),_:1}),E(f,{command:"process"},{default:D(()=>[...e[16]||(e[16]=[F(" 守护进程 ",-1)])]),_:1}),E(f,{command:"reinforce"},{default:D(()=>[...e[17]||(e[17]=[F(" 等保加固 ",-1)])]),_:1})]),_:1})]),default:D(()=>[e[18]||(e[18]=F(" 高级设置 ",-1))]),_:1}),E(Ra,{"comp-data":R(ee),class:"mx-[1rem]"},null,8,["comp-data"]),E(x,{content:"点击跳转数据库回收站",placement:"top"},{default:D(()=>[E(p,{type:"default",onClick:ge},{default:D(()=>[...e[19]||(e[19]=[T("i",{class:"svgtofont-el-delete mr-2px"},null,-1),T("span",{class:"<2xl:hidden"},"回收站",-1)])]),_:1})]),_:1}),R(Ta).setup&&R(za)>1200?(S(),I(Sa,{key:1,class:"ml-[1rem]","plugin-name":"mysql","is-request":!1,pluginInfo:R(Ta)},null,8,["pluginInfo"])):H("",!0),E(k,{onClick:e[3]||(e[3]=a=>R(Aa)({name:"数据库",type:12,id:17})),icon:"desired",class:"ml-[12px] <2xl:hidden",iconClass:"text-medium"},{default:D(()=>[...e[20]||(e[20]=[F(" 需求反馈 ",-1)])]),_:1})])]),"header-right":D(()=>[E(C,{class:"mr-[10px] !w-[14rem]",modelValue:R($a),"onUpdate:modelValue":e[4]||(e[4]=a=>U($a)?$a.value=a:null),onChange:ue,name:"Mysql",options:R(se),config:{getClassList:de,addClass:({ps:a})=>la({ps:a,db_type:"mysql"}),editClass:({ps:a,id:e})=>ta({ps:a,id:e,db_type:"mysql"}),deleteClass:({id:a})=>na({id:a,db_type:"mysql"})},ignore:R(re)},null,8,["modelValue","options","config","ignore"]),E(j,{class:O("!w-[".concat(R(te),"px]")),disabledPopover:!1,modelValue:R(ae),"onUpdate:modelValue":e[5]||(e[5]=a=>U(ae)?ae.value=a:null),clearable:"",placeholder:"请输入数据库名称/备注",onSearch:me},{default:D(()=>[E(w,{list:{historyList:R(le),recommendList:be},name:"databases",keys:"databases",onUpdate:R(Fa),onSearch:me},null,8,["list","onUpdate"])]),_:1},8,["class","modelValue"]),E(q,{class:"ml-[10px]",onRefresh:R(Fa)},null,8,["onRefresh"]),E(A,{name:"database_mysql",class:"ml-[10px]","table-ref":R(Xa),column:R(Ka)},null,8,["table-ref","column"])]),content:D(()=>[z(E(L,{ref_key:"mysqlDbTableRef",ref:Xa,column:R(Ka),data:R(Za),total:R(Ya).total},null,8,["column","data","total"]),[[sa,R(Ha)]])]),"footer-left":D(()=>[E($,{options:oe,"table-ref":R(Xa)},null,8,["table-ref"])]),"footer-right":D(()=>[E(aa,{total:R(Ya).total,page:R(Ya).page,"onUpdate:page":e[6]||(e[6]=a=>R(Ya).page=a),row:R(Ya).row,"onUpdate:row":e[7]||(e[7]=a=>R(Ya).row=a),onChange:R(Fa)},null,8,["total","page","row","onChange"])]),_:1})])}}});export{Ha as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
