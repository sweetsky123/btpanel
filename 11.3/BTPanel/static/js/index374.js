import{_ as e}from"./index109.js?v=1763689792";import{s as a,j as t,r as l,c as s,g as o,a8 as r,x as n,y as u,e as d,C as p,A as i,z as c,R as m,O as b,G as _,D as y,J as v,K as f,ba as h,H as g}from"./base-lib.js?v=1763689792";import{_ as w}from"./index130.js?v=1763689792";import{l4 as x,l5 as D,M as C,V as M,l6 as T,u as j,x as N,hy as V,l7 as O,l8 as R,ag as k,_ as I}from"./utils-lib.js?v=1763689792";import{u as J}from"./useController12.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const Y=t("CLB-LOG-STORE",()=>{const e=l("today"),a=l(""),t=l("");return{currentTab:e,logCustomDate:a,dateTabs:l([{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"自定义时间",value:"custom"}]),currentDate:t}}),q=()=>a(Y()),{activeTabs:A}=J(),{logCustomDate:H,currentDate:U}=q(),B=async e=>{const a="http"===A.value?await x({load_id:e.load_id,date:U.value}):await D({load_id:e.load_id,date:U.value});a.status?window.open("/download?filename="+a.data.filename):C.error("导出失败")},E=e=>{let a="";return"today"===e&&(a=M(new Date,"yyyy-MM-dd")),"yesterday"===e&&(a=M(T(-1),"yyyy-MM-dd")),"custom"===e&&(a=null==H?void 0:H.value),U.value=a,a};function G(e){const a=e.match(/^(\d{2})\/(\w{3})\/(\d{4}):(\d{2}):(\d{2}):(\d{2})/);if(!a)return e;const[,t,l,s,o,r,n]=a,u={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[l];return"".concat(s,"-").concat(u,"-").concat(t," ").concat(o,":").concat(r,":").concat(n)}const L={class:"p-[2rem] node-clb-http-log"},P={class:"flex items-center"},S=I(s({__name:"index",props:{compData:{default:()=>({row:{load_id:0}})}},setup(a){const{mainHeight:t}=j(),{activeTabs:s}=J(),{currentTab:x,logCustomDate:D,dateTabs:M,currentDate:T}=q(),I=a,Y=o(()=>I.compData.row);let A=l(-1);const H=e=>{x.value=e,A.value=-1,"custom"!==e&&(D.value="",S())},U=e=>{A.value=-1,e&&(D.value=e,S())},S=()=>{Q()},z=e=>{"first"===e?(A.value=-1,Q()):"next"===e&&Q()},F=l("tcpudp"===s.value?[{label:"时间",prop:"time_local",width:180,render:e=>G(e.time_local)},{label:"客户端IP",prop:"remote_addr"},{label:"协议",prop:"protocol"},{label:"响应状态",prop:"status"},{label:"发送大小",prop:"bytes_sent",render:e=>N(Number(e.bytes_sent))},{label:"接收大小",prop:"bytes_received",render:e=>N(Number(e.bytes_received))},{label:"会话耗时（秒）",prop:"session_time",render:e=>"".concat(e.session_time)},{label:"节点地址",prop:"upstream_addr",width:120},{label:"TO大小",prop:"upstream_bytes_sent",render:e=>N(Number(e.upstream_bytes_sent))},{label:"RE大小",prop:"upstream_bytes_received",render:e=>N(Number(e.upstream_bytes_received))},{label:"连接耗时（秒）",prop:"upstream_connect_time",render:e=>"".concat(e.upstream_connect_time)}]:[{label:"时间",prop:"time",render:e=>G(e.time)},{label:"客户端IP",prop:"remote_addr"},{label:"请求类型",prop:"request_method",width:80},{label:"负载节点",prop:"upstream_addr"},{label:"回源耗时(秒)",prop:"upstream_response_time"},{label:"主体大小",prop:"body_bytes_sent",render:e=>N(Number(e.body_bytes_sent))},{label:"传输大小",prop:"bytes_sent",render:e=>N(Number(e.bytes_sent))},{label:"响应状态",prop:"status"},{label:"URI",prop:"request_uri"}]),{BtTable:K,refresh:Q}=V({request:async e=>{const a={load_id:Y.value.load_id,date:E(x.value),position:A.value,limit:10},{data:t}="tcpudp"===s.value?await O(a):await R(a);return t.msg&&!1===t.status&&C.error(t.msg),A.value=t.data.last_position,{data:t.data.logs||[],total:0,other:{}}},columns:F.value});return r(()=>{D.value="",T.value="",x.value="today"}),(a,l)=>{const s=k,o=h,r=w,C=g,T=e;return n(),u("div",L,[d(T,null,{"header-left":p(()=>[i("div",P,[i("div",null,[d(s,{type:"button",modelValue:c(x),"onUpdate:modelValue":l[0]||(l[0]=e=>m(x)?x.value=e:null),options:c(M),onChange:H,class:"mr-[1rem] !flex-nowrap"},null,8,["modelValue","options"])]),"custom"===c(x)?(n(),b(o,{key:0,modelValue:c(D),"onUpdate:modelValue":l[1]||(l[1]=e=>m(D)?D.value=e:null),type:"date",placeholder:"请选择日期","value-format":"YYYY-MM-DD",onChange:U,class:"ml-2"},null,8,["modelValue"])):_("",!0)])]),"header-right":p(()=>[d(r,{class:"ml-[10px]",onRefresh:l[2]||(l[2]=e=>z("first"))}),d(C,{type:"success",onClick:l[3]||(l[3]=e=>c(B)(c(Y)))},{default:p(()=>[...l[6]||(l[6]=[i("i",{class:"el-icon-download"},null,-1),y(" 导出日志 ",-1)])]),_:1})]),content:p(()=>[d(c(K),{"min-height":c(t)},null,8,["min-height"])]),"footer-right":p(()=>[d(C,{type:"info",text:"",bg:"",onClick:l[4]||(l[4]=e=>z("first"))},{default:p(()=>[...l[7]||(l[7]=[y("首页",-1)])]),_:1}),v(d(C,{type:"info",text:"",bg:"",onClick:l[5]||(l[5]=e=>z("next"))},{default:p(()=>[...l[8]||(l[8]=[y("下一页",-1)])]),_:1},512),[[f,c(A)>0]])]),_:1})])}}}),[["__scopeId","data-v-a754b624"]]);export{S as default};
