!function(){function e(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,r,a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function o(t,a,u,i){var o=a&&a.prototype instanceof s?a:s,c=Object.create(o.prototype);return n(c,"_invoke",function(t,n,a){var u,i,o,s=0,c=a||[],f=!1,p={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return u=t,i=0,o=e,p.n=n,l}};function v(t,n){for(i=t,o=n,r=0;!f&&s&&!a&&r<c.length;r++){var a,u=c[r],v=p.p,d=u[2];t>3?(a=d===n)&&(o=u[(i=u[4])?5:(i=3,3)],u[4]=u[5]=e):u[0]<=v&&((a=t<2&&v<u[1])?(i=0,p.v=n,p.n=u[1]):v<d&&(a=t<3||u[0]>n||n>d)&&(u[4]=t,u[5]=n,p.n=d,i=0))}if(a||t>1)return l;throw f=!0,n}return function(a,c,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===c&&v(c,d),i=c,o=d;(r=i<2?e:o)||!f;){u||(i?i<3?(i>1&&(p.n=-1),v(i,o)):p.n=o:p.v=o);try{if(s=2,u){if(i||(a="next"),r=u[a]){if(!(r=r.call(u,o)))throw TypeError("iterator result is not an object");if(!r.done)return r;o=r.value,i<2&&(i=0)}else 1===i&&(r=u.return)&&r.call(u),i<2&&(o=TypeError("The iterator does not provide a '"+a+"' method"),i=1);u=e}else if((r=(f=p.n<0)?o:t.call(n,p))!==l)break}catch(r){u=e,i=1,o=r}finally{s=1}}return{value:r,done:f}}}(t,u,i),!0),c}var l={};function s(){}function c(){}function f(){}r=Object.getPrototypeOf;var p=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),v=f.prototype=s.prototype=Object.create(p);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return c.prototype=f,n(v,"constructor",f),n(f,"constructor",c),c.displayName="GeneratorFunction",n(f,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,u,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t=function(){return{w:o,m:d}})()}function n(e,t,r,a){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}n=function(e,t,r,a){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?u?u(e,t,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,a)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,u,i,o=[],l=!0,s=!1;try{if(u=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=u.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){s=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return o}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,a,u,i){try{var o=e[u](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var u=e.apply(t,n);function o(e){i(u,r,a,o,l,"next",e)}function l(e){i(u,r,a,o,l,"throw",e)}o(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./config-legacy.js?v=1763689792","./useMethod-legacy2.js?v=1763689792","./validator-legacy.js?v=1763689792"],function(n,a){"use strict";var u,i,l,s,c,f,p,v,d,m,b,y,_,g,h,w,k,j,O,z,T;return{setters:[function(e){u=e.x,i=e.M,l=e.n,s=e.H,c=e.bU,f=e.p},function(e){p=e.g,v=e.r,d=e.o,m=e.aE,b=e.e,y=e.V},function(e){_=e.aa,g=e.ab,h=e.ac,w=e.a2,k=e.ad,j=e.ae},function(e){O=e.d,z=e.i},function(e){T=e.l}],execute:function(){n("f",p(function(){return"add"===O.value.operateType}));var x=n("i",p(function(){return"restore"===O.value.operateType})),L=(n("k",p(function(){return"detail"===O.value.operateType})),n("G",v(["1"]))),S=v({}),N=n("H",v(!1)),C=n("I",v(!1));v(null),v("计算中...");var P=n("b",v([]));n("d",v(!1));d({web:"",ftp:"",database:""});var F=n("J",v(!1)),K=n("g",d({size:0,current:0}));p(function(){return K.size<K.current}),v(0);n("c",function(e){var t=new Date(new Date),n=t.getFullYear(),r=t.getMonth()+1,a=t.getDate(),u=t.getHours(),i=t.getMinutes();return"备份-".concat(n,"-").concat(r<10?"0"+r:r,"-").concat(a<10?"0"+a:a,"-").concat(u<10?"0"+u:u).concat(i<10?"0"+i:i)});var A=n("e",function(){var e=o(t().m(function e(n,a,u,o){var l,s,c,f,p;return t().w(function(e){for(;;)switch(e.n){case 0:if(l={site:"site",database:"database",wptools:"wp_tools",plugin:"plugin",runtime:"soft",Ftp:"ftp",Crontab:"crontab",Vmail:"vmail",Terminal:"ssh",Firewall:"firewall",node:"node"},S.value=n,B.status=1,B.progress=0,B.msg="准备"+(x.value?"还原":"备份")+"数据",""===n.exec_time&&"restore"===O.value.operateType&&(H.value=E()),"restore"!==O.value.operateType){e.n=2;break}return s={timestamp:O.value.timestamp,auto_exit:N.value?1:0,force_restore:C.value?1:0},e.n=1,_(s);case 1:return e.v,e.a(2);case 2:return c=[],Object.entries(a).map(function(e){var t=r(e,2),n=t[0],a=t[1];("database"===n&&o.length>0||"site"===n&&u.length>0||a)&&c.push(l[n])}),f={backup_name:n.name,auto_exit:N.value?1:0,storage_type:n.path,timestamp:n.exec_time/1e3,site_id:JSON.stringify(u.map(function(e){return e.id})),database_id:JSON.stringify(o.map(function(e){return e.id})),data_list:JSON.stringify(c)},e.n=3,g(f);case 3:p=e.v,z.value=!0,i.request(p),""===n.exec_time&&p.status&&(H.value=E());case 4:return e.a(2)}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}()),E=(n("K",function(){var e=o(t().m(function e(n){return t().w(function(e){for(;;)switch(e.n){case 0:if(!F.value){e.n=1;break}return e.a(2);case 1:return F.value=!0,e.n=2,G(void 0,!0);case 2:x.value&&(i.success("刷新成功"),n.disabled=K.size>K.current,F.value=!1);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),n("o",function(e){return l({title:!1,component:function(){return s(function(){return a.import("./back-progress-legacy.js?v=1763689792")},void 0,a.meta.url)},compData:{type:e},area:52})})),I=n("N",function(){var e=o(t().m(function e(n){var r,a;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,h({type:x.value||"restore"===n?"restore":"backup"});case 1:if(r=e.v,"string"!=typeof(a=r.data).data){e.n=2;break}return Object.assign(B,{status:1,progress:0,msg:"获取进度日志中...",time:0}),M.value=a.data+"，或请稍等片刻后检查进度是否更新，若未更新请重新进行操作",H.value&&setTimeout(I,1500),e.a(2);case 2:B.status=a.data.task_status,B.time=a.data.left_time||0,M.value=a.data.exec_log||"暂无日志",2===a.data.task_status||3===a.data.task_status?(B.progress=100,B.msg="备份"+(2===a.data.task_status?"成功":"结束"),a.data.backup_file_info&&Object.assign(J.value,{name:a.data.backup_file_info.backup_name,files_size:u(Number(a.data.backup_file_info.backup_file_size)),end_time:a.data.backup_file_info.done_time,time_count:a.data.backup_file_info.restore_total_time||a.data.backup_file_info.total_time,backup_file_sha256:a.data.backup_file_info.backup_file_sha256}),3===a.data.task_status&&(B.msg="备份失败",B.progress=0,U.value=a.data.err_info||[]),z.value=!0):(B.progress=a.data.progress,B.msg=a.data.task_msg,H.value&&setTimeout(I,1500));case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),G=n("h",function(){var e=o(t().m(function e(n,r){var a,u,o,l;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,F.value=!0,"restore"!==O.value.operateType){e.n=2;break}return e.n=1,w({timestamp:O.value.timestamp,type:"backup"});case 1:return a=e.v,u=a.data,D(u.data.data_status),K.size=u.data.disk_use,K.current=u.data.disk_free,F.value=!1,e.a(2);case 2:if(c(n)||void 0===n){e.n=3;break}D(n),e.n=5;break;case 3:return e.n=4,k();case 4:o=e.v,l=o.data,"add"===O.value.operateType&&V(l.data),D(l.data);case 5:F.value=!1,r&&i.success("刷新成功"),e.n=7;break;case 6:e.p=6,e.v;case 7:return e.a(2)}},e,null,[[0,6]])}));return function(t,n){return e.apply(this,arguments)}}()),V=function(e){var t,n,r;(P.value=(null===(t=e.oss_list)||void 0===t?void 0:t.map(function(e){return{label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:function(e){return b("div",{class:"flex items-center justify-between"},[b("span",null,[e.label]),b("span",{onClick:function(){T({name:e.value})},class:"float-right text-small text-danger cursor-pointer ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])}}}))||[],P.value&&"local"===(null===(n=P.value[0])||void 0===n?void 0:n.value))||(null===(r=P.value)||void 0===r||r.unshift({label:"本地存储",value:"local"}))},D=function(e){var t={command_size:"命令列表",ssh_size:"终端数据"},n={firewall_conutry:"地区规则",firewall_ip:"IP规则",firewall_forward:"端口转发规则",firewall_malicious_ip:"恶意IP",firewall_new:"端口规则"};q.value=e.site_list,$.value=e.database_list,Q.value=e.btnode_list,X.value.ftpList=e.ftp_list,X.value.crontabList=e.crontab_list,X.value.vmailList=e.vmail_list,X.value.termList=Object.keys(e.ssh_list).filter(function(e){return"status"!==e&&"err_msg"!==e}).map(function(n){return{name:t[n],size:e.ssh_list[n]}}),X.value.firewallList=Object.keys(e.firewall_list).length>0?Object.keys(n).filter(function(e){return"firewall_conutry"!==e}).map(function(t){return{name:n[t],total:e.firewall_list[t]||"--"}}):[],Y.value=e.plugin_list||[],W.value=e.soft_data||[],R.value=e.wp_tools_list||[],Object.keys(Z.value).forEach(function(e){return Z.value[e.toLowerCase()]=!1}),"restore"!==O.value.operateType&&(K.size=e.disk_use,K.current=e.disk_free)},M=n("M",v("")),H=n("p",v()),B=n("L",d({status:1,progress:0,time:0,msg:"准备开始操作"})),J=n("P",v({name:"",backup_file:"",files_size:"",end_time:"",time_count:"",backup_file_sha256:""})),U=n("R",v([])),q=(n("Q",[{type:"index"},{label:"失败项",prop:"name"},{label:"失败原因",prop:"msg",width:140,render:function(e){return b("span",{class:"text-dangerDark"},[e.msg])}},{label:"类型",prop:"type"}]),n("$",function(){q.value=[],X.value.ftpList=[],X.value.crontabList=[],X.value.termList=[],X.value.firewallList=[],Y.value=[],W.value=[],Object.keys(Z.value).forEach(function(e){return Z.value[e.toLowerCase()]=!0}),L.value=["1"]}),n("S",o(t().m(function e(){return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f({title:"确认继续"+(x.value?"还原":"备份"),content:"即将尝试继续"+(x.value?"还原":"备份")+"数据，是否继续操作？"});case 1:return e.n=2,H.value;case 2:e.v.unmount(),H.value=null,A(S.value),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}))),n("w",v([]))),$=(n("l",p(function(){return u(q.value.reduce(function(e,t){return e+Number(t.size)},0))})),n("j",v([]))),Q=(n("m",p(function(){return u($.value.reduce(function(e,t){return e+Number(t.size)},0))})),n("v",v([]))),R=n("q",v([])),Y=(n("r",p(function(){return u(R.value.reduce(function(e,t){return e+Number(t.size)},0))})),n("a",v([]))),W=(n("B",p(function(){return u(Y.value.reduce(function(e,t){return e+Number(t.size)},0))})),n("D",v([]))),X=(n("E",p(function(){return u(W.value.reduce(function(e,t){return e+Number(t.size)},0))})),n("z",v({ftpList:[],crontabList:[],vmailList:[],termList:[],firewallList:[]}))),Z=(n("A",function(e){return u(X.value[e].reduce(function(e,t){return e+Number(t.size||t.vmail_size||0)},0))}),n("t",v({site:!0,database:!0,ftp:!0,crontab:!0,vmail:!0,terminal:!0,firewall:!0,wptools:!0,plugin:!0,runtime:!0,node:!0,other:!0})));n("y",p(function(){return{Ftp:{title:"FTP",icon:"ftp",dataKey:"ftpList",loadingKey:"ftp",tooltip:"仅备份FTP账号和密码，不备份FTP目录"},Crontab:{title:"计划任务",icon:"crontab",dataKey:"crontabList",loadingKey:"crontab"},Vmail:{title:"邮局服务器",icon:"mail",dataKey:"vmailList",loadingKey:"vmail",count:!0},Terminal:{title:"终端",icon:"xterm",dataKey:"termList",loadingKey:"terminal"},Firewall:{title:"系统防火墙",icon:"firewall",dataKey:"firewallList",loadingKey:"firewall"}}})),n("s",p(function(){return[].concat(e(x.value?[]:[{type:"CheckBox",width:36,renderHeader:function(){return m("div")},render:function(e,t,n){var r=n.handleScopeChange;return b(y,{modelValue:e.keys_scopes_status,"onUpdate:modelValue":function(t){return e.keys_scopes_status=t},onChange:function(n){return r(n,e,t,"id")}},null)}}]),[{label:"网站名称",prop:"name"},{label:"网站大小",render:function(e){return u(Number(e.size))}},{label:"网站类型",prop:"type"}])})),n("n",p(function(){return[].concat(e(x.value?[]:[{type:"CheckBox",width:36,renderHeader:function(){return m("div")},render:function(e,t,n){var r=n.handleScopeChange;return b(y,{modelValue:e.keys_scopes_status,"onUpdate:modelValue":function(t){return e.keys_scopes_status=t},onChange:function(n){return r(n,e,t,"id")}},null)}}]),[{label:"数据库名称",prop:"name"},{label:"数据库大小",render:function(e){return u(Number(e.size))}},{label:"数据库类型",prop:"type"}])})),n("u",[{label:"网站名称",prop:"name",width:120},{label:"网站大小",render:function(e){return u(Number(e.size))}},{label:"网站类型",render:function(e){return"local"===e.type?"本地":"远程"}}]),n("C",[{label:"插件名称",prop:"name"},{label:"大小",render:function(e){return u(Number(e.size))}}]),n("F",[{label:"运行环境",prop:"name"},{label:"版本",prop:"version"},{label:"大小",render:function(e){return u(Number(e.size))}}]),n("x",[{label:"名称",prop:"name"},{label:"服务器IP",prop:"server_ip"}]),n("O",o(t().m(function e(){var n,r;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,f({title:"确认取消"+(x.value?"还原":"备份"),content:"即将取消"+(x.value?"还原":"备份")+"数据，是否继续操作？"});case 1:return n=i.load("正在取消任务，请稍后..."),e.n=2,j({timestamp:O.value.timestamp});case 2:return r=e.v,e.n=3,H.value;case 3:e.v.unmount(),H.value=null,n.close(),i.request(r),z.value=!0;case 4:return e.a(2)}},e)})))}}})}();
