import{_ as t}from"./index109.js?v=1763689792";import{_ as a}from"./index118.js?v=1763689792";import{H as e,d as o,fJ as n,x as s,bK as l,e as r,fK as i,fL as c,M as _,fM as m,fN as u,ak as d,R as p,aA as h,n as f,fO as v,r as g,p as w,fP as y,Q as E,fQ as b,fR as x,fS as D,fT as P,fU as C,l as O}from"./utils-lib.js?v=1763689792";import{j as L,o as A,e as I,aA as R,m as k,bM as S,D as T,r as V,s as j,c as M,z as q,x as z,O as N,C as B,G,H as F,aZ as H,I as U,y as J,J as K}from"./base-lib.js?v=1763689792";import{a as Q,b as Z,g as $}from"./useMethod9.js?v=1763689792";import{u as W}from"./column.js?v=1763689792";import{o as X}from"./validator.js?v=1763689792";import{m as Y}from"./useMethod11.js?v=1763689792";import{_ as tt}from"./header-nav-tools.vue_vue_type_script_setup_true_lang.js?v=1763689792";const at=L("MAIL_DOMAIN",()=>{const t=A({p:1,size:10}),a=Q("添加域名",{isEdit:!1,onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),i=Q("DNS 记录",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),c=Q("添加SSL",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),_=Q("捕捉电子邮件",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),{table:m,columns:u}=Z([{prop:"domain",label:"域名",showOverflowTooltip:!0},{prop:"domain",width:160,label:"封锁名单检查",render:t=>{const{blacklisted:a}=t.domain_black_count,s=a?"el-circle-close-filled":"el-circle-check-filled",l=a?"#E85445":"var(--el-color-primary)";return I(S,{class:"flex items-center cursor-pointer",size:5},{default:()=>[I("span",{class:"flex items-center",title:"查看",onClick:()=>(async t=>{if(!t||0===Object.keys(t).length)return;const{onShowCheck:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.domain_black_count)},[I(o,{class:"mr-[2px]",icon:s,size:18,color:l},null),t.domain_black_count&&t.domain_black_count.time&&I("span",null,[n(t.domain_black_count.time)])]),I(R,{trigger:"hover",content:"立即检查","popper-class":"!min-w-0 !w-[80px] text-center"},{reference:()=>I(o,k({"aria-hidden":!1,class:"mr-[2px]",icon:"el-search",size:18,color:"var(--el-color-primary)"},{onClick:()=>(async t=>{const{onCheck:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.a_record)}),null)}),I(R,{trigger:"hover",content:"日志","popper-class":"!min-w-0 !w-[55px] text-center"},{reference:()=>I(o,k({"aria-hidden":!1,icon:"icon-ftp-log",size:18},{onClick:()=>(async t=>{const{onShowCheckLog:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.domain_check_log)}),null)})]})}},{prop:"quota",label:"域名配额",render:t=>s(t.quota)},{prop:"mailboxes",label:"最大邮箱数量"},{prop:"domain",label:"邮件捕获",render:t=>I(l,{size:"small",modelValue:t.catch_all,"onUpdate:modelValue":a=>t.catch_all=a,onChange:async a=>{if(a){const{onOpenCatch:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}else{const{onCloseCatch:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}}},null)},{prop:"dns_id",label:"DNS",render:t=>I("div",{class:"flex items-center"},[(null==t?void 0:t.dns_name)?I("span",null,[t.dns_name]):I("span",{class:""},[T("--")])])},{prop:"ip_tag",label:"多IP设置",width:240,render:t=>{const a=t.ip_tag.find(t=>!0===t.status);return I("div",null,[a?I("div",{class:"flex items-center"},[I(R,{placement:"top",trigger:"hover",content:a.tag,"popper-class":"!min-w-0 !w-[200px] text-center"},{reference:()=>I("span",{class:"text-secondary"},[a.tag]),default:()=>I("div",null,[I("span",null,[T("IP: "),a.ip])])}),t.ip_rotate&&I("span",{onClick:()=>{(async t=>{const{onShowIpRotate:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t)},class:"\n\t\t\t\t\t\t\t\t\t\t\tml-3 px-2 py-0.5 \n\t\t\t\t\t\t\t\t\t\t\trounded-full text-small\n\t\t\t\t\t\t\t\t\t\t\ttransition-all duration-300 ease-in-out\n\t\t\t\t\t\t\t\t\t\t\tcursor-pointer\n\t\t\t\t\t\t\t\t\t\t\tflex items-center gap-1\n\t\t\t\t\t\t\t\t\t\t\thover:opacity-80\n\t\t\t\t\t\t\t\t\t\t\t".concat(t.ip_rotate.status?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500")},[I(o,{icon:t.ip_rotate.status?"el-refresh":"el-close",class:t.ip_rotate.status?"animate-spin ![animation-iteration-count:2] !text-primary":""},null),t.ip_rotate.status?"定时轮换":"未开启轮换"])]):I("span",{class:""},[T("--")])])}},{prop:"domain",label:"SSL",render:t=>I(r,{type:t.ssl_status?"primary":"warning",onClick:async()=>{const{onShowSSL:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{default:()=>[t.ssl_status?"到期时间: ".concat(t.ssl_info.notAfter):"未设置"]})},W([{title:"一键解析",isHide:t=>t.mx_status&&t.a_status&&t.spf_status&&t.dkim_status&&t.dmarc_status||!t.dns_id,onClick:async t=>{const{onParseAll:a,getList:o}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t.domain,t.mx_record,(t,a)=>{t.status&&(o(),X(a,{title:"一键解析"}))})}},{title:"DNS记录",onClick:async t=>{const{onShowDNS:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{title:"编辑",onClick:async t=>{const{onShowEdit:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{title:"删除",onClick:async t=>{const{onDel:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}}],{width:250,fixed:"right",label:"操作"})]);return{search:t,table:m,columns:u,formModal:a,dnsModal:i,sslModal:c,catchModal:_}}),et=L("MAIL_DOMAIN_ADD",()=>{const t=V(null),a=V({}),e=A({domain:"",a_record:"",quota:5,quota_unit:"GB",mailboxes:50,email:"",dns_id:null,auto_create_record:1,catch_type:"none",ip_tag:[]}),o=()=>{let t={domain:e.domain,a_record:e.a_record,quota:e.quota+" "+e.quota_unit,mailboxes:e.mailboxes,email:e.email,dns_id:e.dns_id,catch_type:e.catch_type,ip_tag:e.ip_tag};return e.dns_id&&(t.auto_create_record=e.auto_create_record),t},n=()=>{Object.assign(e,{domain:"",a_record:"",quota:5,quota_unit:"GB",mailboxes:50,email:"",dns_id:null,auto_create_record:1,ip_tag:"",catch_type:"none"})};return{form:e,formRef:t,unitOptions:[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],rules:{domain:[{trigger:["blur","input"],validator:(t,a,e)=>{if(!a||""===a.trim())return e(new Error("收件箱域名不能为空!"));e()}}],mailboxes:[{trigger:["blur","input"],validator:(t,a,e)=>{/^[1-9]\d*$/.test(a)?e():e(new Error("请输入大于0的正整数")),e()}}]},onConfirm:async()=>{var e;let s;await(null==(e=t.value)?void 0:e.validate());const{isEdit:l}=a.value;s=l?await i(o()):await c(o());const{data:r}=s;if(_.request(r),!r.status)return!1;a.value.onRefresh&&a.value.onRefresh(),n()},initForm:t=>{a.value=t,n();const{isEdit:o,row:l}=t;if(o&&l){e.domain=l.domain,e.a_record=l.a_record;const t=s(l.quota);e.quota=$(t.split(" ")[0]),e.quota_unit=t.split(" ")[1],e.mailboxes=l.mailboxes,e.email=l.email,e.ip_tag=l.ip_tag.map(t=>t.tag)||[],e.catch_type=l.catch_type,l.dns_id&&(e.dns_id=l.dns_id,e.auto_create_record=1)}},propsData:a}}),ot=L("MAIL_DOMAIN_CATCH",()=>{const t=A({email:"",catch_type:"none"}),a=V(null),e=V({});return{form:t,init:t=>{e.value=t},rules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]},formRef:a,onConfirm:async()=>{var o;await(null==(o=a.value)?void 0:o.validate());const{row:n,onRefresh:s}=e.value,{data:l}=await m({domain:n.domain,email:t.email,catch_type:t.catch_type});if(_.request(l),!l.status)return!1;s&&s()}}}),nt=at(),{search:st,table:lt,formModal:rt,dnsModal:it,sslModal:ct,catchModal:_t}=j(nt),{onConfirm:mt}=et(),{onConfirm:ut}=ot(),dt=async()=>{try{lt.value.loading=!0;const{data:t}=await u(st.value);d(t)&&(lt.value.data=p(t.data)?t.data:[],lt.value.total=h(t.page))}finally{lt.value.loading=!1}},pt=()=>{rt.value.data.isEdit=!1,rt.value.title="添加域名",f({title:rt.value.title,area:54,showFooter:!0,component:()=>e(()=>import("./index355.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:rt.value.data,onConfirm:mt})},ht=async()=>{try{lt.value.loading=!0,await v({domain:"all"}),st.value.p=1,dt()}finally{lt.value.loading=!1}},ft=async(t,a,e)=>{let o=_.load("解析中...");try{let o=[];const{data:n}=await x({domain:t,a_record:a});n.data.forEach(t=>{o.push({name:t.name,status:t.status,msg:t.msg})}),null==e||e(n,o)}catch(n){}finally{o.close()}},vt=V([]),gt=async()=>{const{data:{data:t}}=await D();vt.value=t.map(t=>({label:t.tag,value:t.tag,ip:t.ip}))},wt=()=>{Y.value="ip",g.push("/mail/setting")},yt=Object.freeze(Object.defineProperty({__proto__:null,addIpTag:wt,getIpTagOptions:gt,getList:dt,ipTagOptions:vt,onCheck:async t=>{E({request:b({a_record:t}),loading:"检查中...",message:!0,success:()=>{dt()}})},onCloseCatch:async t=>{await w({title:"捕获电子邮件",content:"确认关闭捕获功能?",onCancel:()=>{t.catch_all=!t.catch_all}});const{data:a}=await m({domain:t.domain,email:""});_.request(a),dt()},onDel:async t=>{await w({title:"删除域名",content:"是否删除【".concat(t.domain,"】域名"),onConfirm:async()=>{const{data:a}=await y({domain:t.domain});_.request(a),dt()}})},onOpenCatch:t=>{_t.value.data.row=t,f({title:_t.value.title,area:46,component:()=>e(()=>import("./index356.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:_t.value.data,showFooter:!0,onConfirm:ut,onCancel:()=>{t.catch_all=!t.catch_all}})},onParseAll:ft,onRefresh:ht,onShowAdd:pt,onShowCheck:t=>{f({title:"黑名单检查",area:65,compData:{row:t},component:()=>e(()=>import("./index359.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},onShowCheckLog:t=>{f({title:"黑名单检查日志",area:65,component:()=>e(()=>import("./index360.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{log:t}})},onShowDNS:async t=>{it.value.data.row=t,it.value.title="DNS记录 【".concat(t.domain,"】"),f({title:it.value.title,area:75,component:()=>e(()=>import("./index358.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:it.value.data})},onShowEdit:t=>{rt.value.data.row=t,rt.value.data.isEdit=!0,rt.value.title="编辑域名 【".concat(t.domain,"】"),f({title:rt.value.title,area:54,showFooter:!0,component:()=>e(()=>import("./index355.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:rt.value.data,onConfirm:mt})},onShowIpRotate:t=>{f({title:"设置IP轮换 【".concat(t.domain,"】"),area:47,component:()=>e(()=>import("./index361.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:t},btn:!0})},onShowSSL:t=>{ct.value.data.row=t,f({title:ct.value.title,area:65,component:()=>e(()=>import("./index357.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:ct.value.data})}},Symbol.toStringTag,{value:"Module"})),Et=M({__name:"index",setup(t){const a=V(),e=V(0),o=async t=>{E({loading:"正在处理...",message:!0,request:P({operation:t}),success:()=>n()})},n=async()=>{const{data:t}=await C();d(t)&&(a.value=t.status,e.value=t.count)};return n(),(t,n)=>{const s=F,l=H;return 0===q(a)&&q(e)?(z(),N(l,{key:0,type:"warning",class:"!mb-[16px]",closable:!1},{default:B(()=>[n[4]||(n[4]=T(" 宝塔面板发现您的域名已进入邮件垃圾邮件列表 ",-1)),I(s,{type:"primary",class:"ml-16px",onClick:n[0]||(n[0]=t=>o(1))},{default:B(()=>[...n[2]||(n[2]=[T(" 我已处理 ",-1)])]),_:1}),I(s,{link:"",type:"primary",onClick:n[1]||(n[1]=t=>o(-1))},{default:B(()=>[...n[3]||(n[3]=[T(" 忽略 ",-1)])]),_:1})]),_:1})):G("",!0)}}}),bt=M({__name:"index",setup(e){const{search:o,table:n,columns:s}=j(at());return dt(),(e,l)=>{const r=F,i=O,c=a,_=t,m=U("bt-loading");return z(),J("div",null,[I(Et),I(_,null,{"header-left":B(()=>[I(r,{type:"primary",onClick:q(pt)},{default:B(()=>[...l[2]||(l[2]=[T("添加域名",-1)])]),_:1},8,["onClick"]),I(tt,{class:"ml-16px"})]),"header-right":B(()=>[I(r,{onClick:q(ht)},{default:B(()=>[...l[3]||(l[3]=[T("刷新域名记录",-1)])]),_:1},8,["onClick"])]),content:B(()=>[K(I(i,{data:q(n).data,column:q(s)},null,8,["data","column"]),[[m,q(n).loading]])]),"footer-right":B(()=>[I(c,{page:q(o).p,"onUpdate:page":l[0]||(l[0]=t=>q(o).p=t),row:q(o).size,"onUpdate:row":l[1]||(l[1]=t=>q(o).size=t),total:q(n).total,onChange:q(dt)},null,8,["page","row","total","onChange"])]),_:1})])}}}),xt=Object.freeze(Object.defineProperty({__proto__:null,default:bt},Symbol.toStringTag,{value:"Module"}));export{et as M,wt as a,ot as b,dt as c,xt as d,gt as g,vt as i,ft as o};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
