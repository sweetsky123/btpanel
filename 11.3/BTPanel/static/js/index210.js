import{Q as e,b8 as a,M as l,bj as s,x as t,b2 as n,k as r,aC as i,_ as o}from"./utils-lib.js?v=1763689792";import{_ as u}from"./index123.js?v=1763689792";import{r as c,c as d,s as m,v as p,I as v,x as f,y as g,e as _,C as b,A as x,J as y,z as w,R as k,D as h,F as C,b1 as V,O as j,B as U,G as q,aD as S,H as W,am as H,an as D,ax as z,az as N,ad as R,ab as A}from"./base-lib.js?v=1763689792";import{B as E}from"./index119.js?v=1763689792";import{S as I,_ as T}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1763689792";import{S as B,_ as F}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1763689792";import{b3 as M,b0 as O,a_ as P,m as G,b4 as J,b5 as L,a$ as Q}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./ace.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const $=B(),K=I(),X=c({}),Y={active:"活动连接(Active connections)",accepts:"总连接次数(accepts)",handled:"总握手次数(handled)",requests:"总请求数(requests)",Reading:"请求数(Reading)",Writing:"响应数(Writing)",Waiting:"驻留进程(Waiting)",worker:"工作进程(Worker)",workercpu:"Nginx占用CPU(Workercpu)",workermen:"Nginx占用内存(Workermen)"},Z=c([]),ee=c("service"),ae=c(""),le=c(!1),se=c(!1),te=c([]),ne=c(""),re=c(""),ie=c(""),oe=c([]),ue=async()=>{let a={};Z.value.forEach(e=>{a[e.name]=e.value}),await e({loading:"正在保存中，请稍后...",request:M(a),message:!0})},ce=async()=>{await e({loading:"正在保存中，请稍后...",request:a({path:"/www/server/nginx/conf/nginx.conf",data:ae.value,encoding:"utf-8"}),message:!0})},de=async()=>{await e({loading:le,request:O({path:"/www/wwwlogs/nginx_error.log"}),data:{msg:[String,ne]}})},me=async()=>{if(re.value!==ie.value)try{await P({sName:"nginx",version:re.value,min_version:""}),G()}catch(e){}else l.error("当前版本与选择版本一致")},pe=({props:{name:a}})=>{switch(a){case"service":ve();break;case"performance":(async()=>{await e({loading:se,request:J(),data:[Array,Z]})})();break;case"config":(async()=>{await e({loading:le,request:Q({path:"/www/server/nginx/conf/nginx.conf"}),data:{data:[String,ae]}})})();break;case"load":(async()=>{await e({loading:le,request:L(),success:e=>{if(s("status",e)&&!e.status)l.msg({message:e.msg||"获取数据失败",type:"error",dangerouslyUseHTMLString:!0,customClass:"bt-message-error-html ",showClose:!0});else{te.value=[];const a=["bytes","bytes_read","bytes_written"];Object.keys(e.data).forEach(l=>{te.value.push({name:l,ps:Y[l],value:a.includes(l)?t(Number(e.data[l])):e.data[l]})});const l=te.value.findIndex(e=>"active"===e.name);if(l>-1){const[e]=te.value.splice(l,1);te.value.unshift(e)}}}})})();break;case"logs":de()}},ve=e=>{ee.value="service",e&&(X.value=e),K.init(X.value),$.init({name:"nginx"}),re.value=X.value.version.split(".")[0]+"."+X.value.version.split(".")[1],ie.value=X.value.version.split(".")[0]+"."+X.value.version.split(".")[1],oe.value=X.value.versions},fe={class:"my-[12px]"},ge={class:"flex text-secondary items-center"},_e={class:"flex flex-col text-secondary performance"},be={key:0,class:"flex items-center"},xe={key:1,class:"flex items-center"},ye=o(d({__name:"index",props:{compData:{default:{}}},setup(e){const a=e,{compData:l}=m(I());return p(()=>{ve(a.compData),l.value.refreshEvent=async()=>{const{data:e}=await n({name:"web"});l.value.status=e.s_status}}),(e,a)=>{const l=S,s=E,t=W,n=H,o=D,c=z,d=N,m=r,p=R,I=A,B=u,M=i,O=v("bt-loading");return f(),g("div",null,[_(M,{modelValue:w(ee),"onUpdate:modelValue":a[2]||(a[2]=e=>k(ee)?ee.value=e:null),type:"left-bg-card",class:"h-full",onTabClick:w(pe)},{default:b(()=>[_(l,{label:"服务",name:"service"},{default:b(()=>[_(T),_(F)]),_:1}),_(l,{label:"配置文件",name:"config"},{default:b(()=>[a[4]||(a[4]=x("span",{class:"my-[4px] text-secondary"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),x("div",fe,[y(_(s,{class:"!h-[38rem] !w-[52rem]",modelValue:w(ae),"onUpdate:modelValue":a[0]||(a[0]=e=>k(ae)?ae.value=e:null),id:"configContent",filePath:"/www/server/nginx/conf/nginx.conf"},null,8,["modelValue"]),[[O,w(le)]])]),_(t,{type:"primary",onClick:w(ce)},{default:b(()=>[...a[3]||(a[3]=[h("保存",-1)])]),_:1},8,["onClick"]),a[5]||(a[5]=x("ul",{class:"leading-8 mt-20px text-small list-disc ml-[20px]"},[x("li",null,"此处为nginx主配置文件,若您不了解配置规则,请勿随意修改")],-1))]),_:1}),_(l,{label:"版本切换",name:"version"},{default:b(()=>[x("div",ge,[a[7]||(a[7]=x("span",null,"选择版本",-1)),_(o,{class:"mx-[12px] !w-[18rem]",modelValue:w(re),"onUpdate:modelValue":a[1]||(a[1]=e=>k(re)?re.value=e:null)},{default:b(()=>[(f(!0),g(C,null,V(w(oe),(e,a)=>(f(),j(n,{key:a,label:"nginx "+e.m_version,value:e.m_version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),_(t,{type:"primary",onClick:w(me)},{default:b(()=>[...a[6]||(a[6]=[h("切换",-1)])]),_:1},8,["onClick"])])]),_:1}),_(l,{label:"负载状态",name:"load"},{default:b(()=>[y((f(),j(d,{maxHeight:"500",data:w(te),border:"",style:{width:"100%"}},{default:b(()=>[_(c,{prop:"ps",label:"字段"}),_(c,{prop:"value",label:"当前值"})]),_:1},8,["data"])),[[O,w(le)]])]),_:1}),y((f(),j(l,{label:"性能调整",name:"performance"},{default:b(()=>[x("div",_e,[_(I,{"label-position":"right","label-width":"186px"},{default:b(()=>[(f(!0),g(C,null,V(w(Z),(e,a)=>(f(),j(p,{label:e.name,key:a},{default:b(()=>["gzip"!=e.name?(f(),g("div",be,[_(m,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"worker_processes"!==e.name?"number":""},null,8,["modelValue","onUpdate:modelValue","type"]),x("span",null,U(e.ps),1)])):q("",!0),"gzip"==e.name?(f(),g("div",xe,[_(o,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"!w-[8rem] mx-8px"},{default:b(()=>[_(n,{label:"开启",value:"on"}),_(n,{label:"关闭",value:"off"})]),_:1},8,["modelValue","onUpdate:modelValue"]),x("span",null,U(e.ps),1)])):q("",!0)]),_:2},1032,["label"]))),128)),_(p,{label:" "},{default:b(()=>[_(t,{onClick:w(ue),type:"primary"},{default:b(()=>[...a[8]||(a[8]=[h("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1})),[[O,w(se)]]),_(l,{label:"错误日志",name:"logs"},{default:b(()=>[_(B,{content:w(ne),autoScroll:!0,isHtml:!0,"full-screen":{title:"全屏查看日志",onRefresh:w(de)},style:"height:540px"},null,8,["content","full-screen"])]),_:1})]),_:1},8,["modelValue","onTabClick"])])}}}),[["__scopeId","data-v-1a4c55d7"]]);export{ye as default};
