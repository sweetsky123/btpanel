import{aQ as e,b$ as a,aA as t,aK as s,Q as n,c0 as i,c1 as l,c2 as r,c3 as o,M as c,p as u,c4 as d,c5 as m,c6 as p,c7 as v,c8 as g,c9 as y,ca as w,cb as f,cc as h,u as _,n as b,H as k,b2 as E,aS as D,cd as C,ce as S,E as T}from"./utils-lib.js?v=1763689792";import{j as x,r as j,s as q,e as I,J as L,I as O}from"./base-lib.js?v=1763689792";import{l as P,c as R}from"./validator.js?v=1763689792";import{B as A}from"./column.js?v=1763689792";import{o as V}from"./useController5.js?v=1763689792";const W=x("DOCKER-SITE-STORE",()=>{const v=j({}),{refreshSiteTable:g}=e(),y=j(""),w=j({}),f=j("all"),h=j([]);return{getDockerSiteList:async e=>{try{const{data:s}=await a(e);return{data:s.data,total:t(s.page)}}catch(n){s(n)}},pluginInfo:v,setDockerSiteStatus:async(e,a)=>{try{const t=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<t/1e3)return void c.error("项目已过期，请设置站点到期时间后再操作");await u({title:"提示",content:e.status?"启动站点【".concat(e.site_name,"】后，用户可以正常访问网站内容，是否继续操作？"):"停用站点【".concat(e.site_name,"】后，用户访问会显示当前网站停用后的提示页，是否继续操作？"),icon:"warning-filled"}),await n({loading:"正在".concat(e.status?"开启":"关闭","，请稍后..."),request:d(e),message:!0,success:e=>{g(),a&&a(e)}})}catch(t){s(t)}},setDockerSiteRemark:async(e,a)=>{try{await n({loading:"正在保存备注，请稍后...",request:m(e),message:!0,success:e=>{g(),a&&a(e)}})}catch(t){s(t)}},getEnvList:async e=>{try{const{data:a}=await o(e);return{data:a.data,total:t(a.page)}}catch(a){s(a)}},delDockerSite:async(e,a)=>{try{await u({title:"删除【".concat(e.name,"】项目"),content:"风险操作，此操作不可逆，删除【".concat(e.name,"】项目后您将无法管理该项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async t=>{const s={id:e.id,site_name:e.name,remove_path:t?1:0};await n({loading:"正在删除，请稍后...",request:p(s),message:!0,success:e=>{g(),a&&a(e)}})}}})}catch(t){s(t)}},setSiteInfo:async(e,a)=>(e&&(w.value={...e}),y.value=("string"==typeof a?a:"")||"",w.value),siteInfo:w,settingTabActive:y,getClassList:async()=>{try{return await n({request:i(),success:({data:e})=>{h.value=[{label:"全部分类",value:"all"},...e.data.map(e=>({label:e.name,value:String(e.id)}))]}}),{data:h.value,status:!0}}catch(e){return{data:[],status:!1}}},setClass:async(e,a)=>{try{switch(a){case"add":return await n({loading:"正在新增分类，请稍后...",request:r({name:e.name}),message:!0});case"edit":return await n({loading:"正在编辑分类，请稍后...",request:r({name:e.name,id:e.id}),message:!0});case"del":return await n({loading:"正在删除分类，请稍后...",request:l({id:e.id}),message:!0})}}catch(t){}},classList:h,resetData:()=>{y.value="",w.value={},h.value=[]},statusFilterKey:f}}),N=()=>q(W()),B=x("DOCKER-SITE-ENV-STORE",()=>{const e=j("php"),a=j(!1),t=j(!1),i=j(!1),l=j(!1),r=j(!1),o=e=>{switch(e){case"php":a.value=!0;break;case"java":t.value=!0;break;case"python":i.value=!0;break;case"go":l.value=!0;break;case"nodejs":r.value=!0}};return{tabActive:e,refreshEnvTable:a,refreshJavaEnvTable:t,refreshPythonEnvTable:i,refreshGoEnvTable:l,refreshNodeEnvTable:r,setTypeRefreshTable:o,delDockerEnv:async(e,a,t)=>{try{await u({title:"删除【".concat(e.name,"】环境"),content:"风险操作删除【".concat(e.name,"】环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await n({loading:"正在删除，请稍后...",request:v({id:e.id}),message:!0,success:e=>{o(a),t&&t(e)}})}catch(i){s(i)}},useBatchEventHandle:async(a,t,s,i,l)=>{await u({title:"删除环境",content:"风险操作删除选中的".concat(s.value.length,"个环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const r={ids:s.value.map(e=>e.id).join(",")};await n({loading:"正在删除，请稍后...",request:g(r),message:!0,success:()=>{l(),o(e.value)}})},cleanCache:async(e,a)=>{try{await u({title:"清理构建缓存",content:"即将清理构建缓存，是否继续操作？",icon:"warning-filled"}),await n({loading:"正在清理，请稍后...",request:y(),message:!0,success:t=>{o(e),a&&a(t)}})}catch(t){s(t)}},refreshTemplate:async(e,a)=>{try{await n({loading:"正在刷新，请稍后...",request:f(),message:!0,success:t=>{o(e),a&&a(t)}})}catch(t){s(t)}},getVersion:async(e="all")=>{try{const a={runtime_type:e};return await n({loading:"正在获取版本，请稍后...",request:h(a),message:!1})}catch(a){s(a)}},setStatus:async(e,a,t,i)=>{try{await n({loading:"正在设置，请稍后...",request:w({runtime_status:e,compose_file:a.compose}),message:!0,success:e=>{o(t),i&&i(e)}})}catch(l){s(l)}},resetData:()=>{e.value="php",a.value=!1,t.value=!1,i.value=!1,l.value=!1,r.value=!1}}}),F=()=>q(B()),{plugin:H}=_(),{refreshSiteTable:J}=e(),{pluginInfo:K}=q(W()),{setSiteInfo:M,getClassList:z,setClass:Q}=W(),{resetData:$}=B(),G={get:async()=>{const{data:e}=await z();return e},add:e=>Q({...e},"add"),update:e=>{const{id:a,name:t}=e;return Q({id:a,name:t},"edit")},delete:e=>{const{id:a}=e;return Q({id:a},"del")}},U=e=>({label:"设置分类",value:"setClass",event:async(a,t,s,i,l)=>{await R({name:"分类",options:e.classList.value.filter(e=>"all"!==e.value&&"-2"!==e.value),selectList:s.value,request:async(e,a)=>{const t=s.value.map(e=>e.id);await n({loading:"正在批量设置分类，请稍后...",request:C({id:JSON.stringify(t),classify:e.id}),message:!0}),l(),J(),a()}})}}),X=e=>({label:"到期时间",isCustom:!0,render:e=>{const a=(new Date).setHours(0,0,0,0),t=Date.now(),s="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,n=s&&s<a;return I("span",{class:"cursor-pointer "+(n?"bt-danger":s&&s-t<6048e5?"bt-warn":"bt-link"),onClick:()=>Y(e)},[n?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),Y=(e,a=!1)=>{b({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>k(()=>import("./index236.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:a},showFooter:!0})},Z=e=>({label:(null==e?void 0:e.label)||"网站名",prop:"name",minWidth:150,showOverflowTooltip:{show:!0,enterable:!1},render:a=>{var t;let s=null==(t=H.value)?void 0:t.web;const n="java"===(null==e?void 0:e.type)&&!(a.is_file_ok||void 0===a.is_file_ok);return I("div",{class:"flex items-center inline-block truncate"},[(null==a?void 0:a.waf)&&((null==a?void 0:a.isWaf)||void 0===(null==a?void 0:a.isWaf))?I("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(a,"iconWaf")}},[I("i",{class:"svgtofont-left-waf !text-extraLarge ".concat(a.waf.status&&"proxy"===(null==s?void 0:s.type)&&(null==s?void 0:s.status)&&(null==s?void 0:s.setup)?"text-primary":"text-tertiary")},null)]):"",I("span",{class:"!whitespace-pre-line inline-block w-[calc(100%-1.6rem)]",title:null==a?void 0:a.cn_name},[I("span",{onClick:()=>{n||e.onClick(a)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[a.name])])])}}),ee=e=>({label:"状态",prop:"status",minWidth:70,isCustom:!0,sortable:!1,width:80,render:a=>{let t=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(t="1"===a[e.prop]),void 0===a[e.prop||"status"]?L(I("div",{class:"loading h-[2rem]"},null),[[O("bt-loading"),!0]]):I(A,{modelValue:t?1:0,data:["已停止","运行中"],onClick:()=>e.onClick(a)},null)}}),ae=e=>({label:"SSL证书",isCustom:!0,render:a=>{var t,s,n;return I("span",{class:"cursor-pointer ".concat(-1===a.ssl?"text-warning":(null==(t=a.ssl)?void 0:t.endtime)<0?"text-danger":"text-primary"),onClick:()=>{e.onClick(a)}},[-1===a.ssl?"未部署":(null==(s=a.ssl)?void 0:s.endtime)<0?"已过期":"剩余".concat(null==(n=a.ssl)?void 0:n.endtime,"天")])}}),te=async(e,a,t,s,i)=>{await u({title:"删除项目",content:"风险操作，此操作不可逆，删除选中的".concat(t.value.length,"个项目后您将无法管理这些项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async e=>{const a={site_list:JSON.stringify(t.value.map(e=>({site_name:e.name,id:e.id}))),remove_path:e?1:0};await n({loading:"正在删除，请稍后...",request:S(a),message:!0,success:()=>{i(),J()}})}}})},se=async()=>{try{const{data:e}=await E({name:"nginx"});return K.value=e,e}catch(e){return{}}},ne=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:T.value?"ace/theme/clouds_midnight":"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),ie=e=>new Promise((a,t)=>{b({title:"创建网站",area:70,btn:["确认","取消"],component:()=>k(()=>import("./index237.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e||{}})}),le=e=>new Promise((a,t)=>{b({title:"运行环境",area:120,component:()=>k(()=>import("./index238.js?v=1763689792").then(e=>e.O),__vite__mapDeps([]),import.meta.url),onCancel:()=>{$(),e&&e()}})}),re=(e,a)=>{b({title:(null==e?void 0:e.title)||"批量操作结果",area:42,component:()=>k(()=>import("./index125.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},oe=(e="setDefaultPage")=>b({isAsync:!0,title:"常用设置",area:[96,62],component:()=>k(()=>import("./index239.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1}),ce=(e,a="")=>{M(e,a),b({title:"Docker项目管理【"+e.name+"】 -- 添加时间【"+e.addtime+"】",area:[84,70],component:()=>k(()=>import("./index240.js?v=1763689792").then(e=>e.$),__vite__mapDeps([]),import.meta.url)})},ue=async(e,a)=>{if("monitor-setting"===a&&(a="monitor"),"monitor"===a){if(!(await V(e,!1)))return;D("total_website",e.name)}const t="nginx"===H.value.web.type?"btwaf":"btwaf_httpd",s=(e=>{switch(e){case"monitor":return 47;case"bt_waf":return 48;case"iconWaf":return 49}})(a);"monitor"!==a&&(a=t),await P({source:s,name:a,callback:t=>{if(t&&"monitor"!==a){const a=setInterval(()=>{var s;const n=t.document.getElementsByClassName("layui-layer-page")[0];if(t.site_waf_config&&n){clearInterval(a),n&&(n.style.display="none"),t.site_waf_config(e.name);const i=t.document.getElementsByClassName("layui-layer-page")[1];i&&(null==(s=i.querySelector(".layui-layer-close"))||s.addEventListener("click",()=>{var e;null==(e=n.querySelector(".layui-layer-close"))||e.click()}))}},50)}}})};export{W as D,ee as a,X as b,ae as c,G as d,ue as e,ie as f,se as g,oe as h,U as i,te as j,re as k,B as l,F as m,N as n,ce as o,ne as p,le as s,Z as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
