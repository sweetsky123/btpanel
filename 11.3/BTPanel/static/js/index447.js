import{B as a,n as e,H as t,M as l,p as s,Q as o,P as u,l as r,j as n,$ as c}from"./utils-lib.js?v=1763689792";import{_ as i}from"./index109.js?v=1763689792";import{c as d,r as m,o as p,aE as h,v,I as _,x as f,y as x,e as g,C as w,D as y,z as b,R as V,F as D,b1 as j,O as C,J as E,A as P,B as k,H as A,am as I,an as L,ax as S,az as M,ce as U}from"./base-lib.js?v=1763689792";import{u as R}from"./column.js?v=1763689792";import{exportUserData as q,delMysqlUser as F,getUserData as O,getMysqlCloudServer as B}from"./database.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const H={class:"break-words flex items-center justify-center w-full text-secondary"},T=["title"],z={class:"p-20px"},G={class:"p-20px"},J=d({__name:"index",setup(d,{expose:J}){const Q=m(0),$=m(!1),K=m(""),N=m([]),W=m(!0),X=m([]),Y=p({associatedPopup:!1,associatedData:[],associatedDataColumn:[{label:"数据库",prop:"database"},{label:"表",prop:"table"},{label:"权限",render:a=>a.access.map(a=>"".concat(a.title,"：").concat(a.access)).join("\n")}]}),Z=m({resultMsg:"",resultData:"",resultStatus:!1}),aa=p({authPopup:!1,authData:[],authDataColumn:[{label:"权限",render:a=>a.map(a=>h("div","".concat(a.title,"：").concat(a.access)))}]}),ea=[{content:"说明：此处用户数据为连接mysql直接获取，未与面板数据库连接，建议仅对此处新建的用户进行操作，以防出现意外"},{content:"访问权限：localhost/127.0.0.1:仅限本机访问 %：允许任何人访问 IP地址：仅限此IP地址访问（不含本机）"},{content:"全局权限：全局权限是指对所有数据库拥有的权限 ALL PRIVILEGES即root最高权限，USAGE为普通用户，拥有指定数据库指定权限（关联数据库权限）"}],ta=a=>{e({title:"添加用户",area:60,component:()=>t(()=>import("./add-user2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{refreshFn:()=>oa(),serverList:X},showFooter:!0})},la=async()=>{try{let a={sid:Q.value};K.value&&(a.search=K.value);const e=await o({loading:W,request:O(a),data:{data:[Array,N],status:Boolean}});return e.status?(N.value.forEach(a=>{a.list.forEach(e=>{e.user=a.user})}),e):(N.value=[],l.error(e.msg||"获取用户数据失败"))}catch(a){}},sa=m([{label:"访问权限",render:a=>h("span","".concat(a.host).concat("%"==a.host?" - 所有人":"localhost"==a.host||"127.0.0.1"==a.host?" - 本地":""))},{prop:"password",label:"密码",width:50},{prop:"password_last_changed",label:"密码修改时间",width:160},R([{onClick:a=>{e({title:"数据库权限",area:80,component:()=>t(()=>import("./user-auth.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:a,sid:Q.value,refreshEvent:la}})},title:"权限"},{onClick:({user:a,host:s})=>{if("root"===a&&"localhost"===s)return l.error("该用户不允许改密");e({title:"修改密码",area:42,compData:{username:a,host:s,sid:Q.value},component:()=>t(()=>import("./user-pwd.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},title:"改密"},{onClick:async({host:a,user:e})=>{try{const t=await q({username:e,host:a,sid:Q.value});Z.value.resultMsg=t.data,Z.value.resultStatus=!0,$.value=!0}catch(t){}},title:"导出"},{onClick:async({host:a,user:e})=>{try{await s({title:"删除用户",content:"删除用户后，该用户将无法访问数据库，是否继续操作？",icon:"warning-filled"}),await o({loading:"正在删除用户，请稍后...",request:F({username:e,host:a,sid:Q.value}),message:!0,success:la})}catch(t){}},title:"删除"}])]),oa=async()=>{la(),(async()=>{var a,e;await o({loading:"正在获取服务器数据，请稍后...",request:B(),data:[Array,X]}),X.value=null==(a=X.value)?void 0:a.filter(a=>""!==a.id),Q.value=null==(e=X.value[0])?void 0:e.id})()};return v(oa),J({init:oa}),(e,t)=>{const l=A,s=I,o=L,d=u,m=r,p=S,h=M,v=U,R=n,q=i,F=c,O=_("bt-loading");return f(),x("div",null,[g(q,null,{"header-left":w(()=>[g(l,{type:"primary",onClick:ta},{default:w(()=>[...t[6]||(t[6]=[y("添加用户",-1)])]),_:1})]),"header-right":w(()=>[g(o,{modelValue:b(Q),"onUpdate:modelValue":t[0]||(t[0]=a=>V(Q)?Q.value=a:null),class:"mr-[1.5rem] !w-[16rem]",placeholder:"请选择",onChange:la},{default:w(()=>[(f(!0),x(D,null,j(b(X),a=>(f(),C(s,{key:a.value,label:a.ps,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g(d,{modelValue:b(K),"onUpdate:modelValue":t[1]||(t[1]=a=>V(K)?K.value=a:null),placeholder:"请输入用户名",class:"!w-[20rem]",onSearch:la},null,8,["modelValue"])]),content:w(()=>[g(h,{data:b(N),"max-height":"400"},{default:w(()=>[g(p,{type:"expand"},{default:w(a=>[E(g(m,{column:b(sa),data:a.row.list},null,8,["column","data"]),[[O,b(W)]])]),_:1}),g(p,{label:"用户",prop:"user"})]),_:1},8,["data"])]),popup:w(()=>[g(R,{title:"导出结果",modelValue:b($),"onUpdate:modelValue":t[3]||(t[3]=a=>V($)?$.value=a:null),area:38},{default:w(()=>[g(v,{icon:b(Z).resultStatus?"success":"error",title:b(Z).resultStatus?"导出成功":"导出失败"},{extra:w(()=>[P("div",H,[P("span",{class:"max-w-[28rem] truncate",title:b(Z).resultMsg},k(b(Z).resultMsg),9,T),g(l,{type:"text",onClick:t[2]||(t[2]=e=>{return t=b(Z).resultMsg,a({value:t});var t})},{default:w(()=>[...t[7]||(t[7]=[y("复制",-1)])]),_:1})])]),_:1},8,["icon","title"])]),_:1},8,["modelValue"]),g(R,{title:"关联数据库",modelValue:b(Y).associatedPopup,"onUpdate:modelValue":t[4]||(t[4]=a=>b(Y).associatedPopup=a),area:80},{default:w(()=>[P("div",z,[g(m,{"max-height":"300",data:b(Y).associatedData,column:b(Y).associatedDataColumn,"default-sort":{prop:"user",order:"descending"}},null,8,["data","column"]),g(m,{"max-height":"300",data:b(Y).associatedData,column:b(Y).associatedDataColumn},null,8,["data","column"])])]),_:1},8,["modelValue"]),g(R,{title:"全局权限",modelValue:b(aa).authPopup,"onUpdate:modelValue":t[5]||(t[5]=a=>b(aa).authPopup=a),area:40},{default:w(()=>[P("div",G,[g(m,{"max-height":"300",data:b(aa).authData,column:b(aa).authDataColumn},null,8,["data","column"])])]),_:1},8,["modelValue"])]),_:1}),g(F,{options:ea,"list-style":"disc",class:"ml-20px mt-12px"})])}}});export{J as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
