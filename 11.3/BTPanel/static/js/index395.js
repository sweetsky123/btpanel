import{_ as e}from"./index109.js?v=1763689792";import{r as a,W as t,g as n,e as s,ak as r,D as l,c as o,a8 as i,x as c,y as u,C as p,z as d,H as m,aT as v,F as h}from"./base-lib.js?v=1763689792";import{L as _,n as y,Q as f,an as b,M as g,p as w,hy as C,ao as x}from"./utils-lib.js?v=1763689792";import{o as j}from"./column.js?v=1763689792";import{createPythonEnvironment as k,addPythonEnvironment as q,getPythonEnvironment as P,deletePythonEnvironment as W}from"./site.js?v=1763689792";import{f as B}from"./validator.js?v=1763689792";import{b as O,h as F,e as H,l as S,f as T}from"./form-item.js?v=1763689792";import{l as V}from"./useController6.js?v=1763689792";import{_ as z}from"./index110.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";a("");const A=a(!1),D=t([]),E=a(null),L=async()=>{try{const e=await f({request:P({sort_not_use:0})});if(!e.status)return g.error(e.msg),D.value=[],{data:[],total:0};if(e.data.now_env){E.value=e.data.now_env;for(let a=0;a<e.data.env_list.length;a++)if(e.data.env_list[a].bin_path===e.data.now_env.bin_path)return e.data.env_list[a].isCurrent=!0,D.value=e.data.env_list,{data:e.data.env_list,total:e.data.env_list.length}}return D.value=e.data.env_list,{data:e.data.env_list,total:e.data.env_list.length}}catch(e){return{data:[],total:0}}},M=async e=>{const{BtTable:t,getCurrentSelect:o,handleCurrentChange:i}=((e="apply")=>{const t=a(null),n=a(null);return{...b({request:async()=>{const a=D.value.filter(a=>"apply"===e?(a.isCurrent&&(n.value=a),a.can_set_default):a.can_create);return{data:a,total:a.length}},columns:[{label:" ",prop:"select",width:50,render:e=>s(r,{value:e.bin_path,modelValue:t.value,"onUpdate:modelValue":e=>t.value=e},null)},{label:"名称",prop:"name",render:a=>s("div",{class:"truncate",title:"".concat(a.name).concat(a.isCurrent&&"apply"===e?"【当前使用】":"")},[a.name,a.isCurrent&&"apply"===e?s("span",{class:"font-bold text-default"},[l("【当前使用】")]):""])},{label:"类型",prop:"type",width:100,render:e=>{if(e.bin_path.includes("/www/server/panel/pyenv"))return"宝塔面板环境";switch(e.type){case"venv":return"虚拟环境";case"system":return e.from_panel?"面板安装":"系统级环境";case"conda":return"Conda环境";default:return"未知"}}},{label:"Python版本",prop:"version",width:100}]}),getCurrentSelect:()=>D.value.find(e=>e.bin_path===t.value),handleCurrentChange:e=>{t.value=e.bin_path},currentApply:n}})("create"),{BtForm:c,submit:u}=_({data:()=>({venv_name:"",python_bin:"",ps:""}),options:e=>n(()=>[O("名称","venv_name",{attrs:{class:"!w-[24rem]",placeholder:"虚拟环境名称"},rules:[{required:!0,message:"虚拟环境名称不可为空",trigger:["blur","change"]}]}),F("环境来源",()=>s("div",{class:"w-[90%]"},[s(t,{"highlight-current-row":!0,maxHeight:400,onCurrentChange:i},null)]),"python_bin",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(a,t,n)=>{const s=o();s?(e.value.python_bin=s.bin_path,n()):n(new Error("请选择需要创建虚拟环境的环境来源"))}}]}),O("备注","ps",{attrs:{class:"!w-[24rem]",placeholder:"备注"},rules:[{required:!1,message:"备注不可为空",trigger:["blur","change"]}]})]),submit:async(e,a)=>(await a(),await Q(e.value))});y({title:"创建虚拟环境",area:65,btn:"创建",component:()=>s("div",{class:"p-[1.6rem]"},[s(c,null,null)]),onConfirm:async()=>{try{return!!(await u())}catch(e){return!1}}})},Q=async e=>!!(await f({request:k({venv_name:e.venv_name,python_bin:e.python_bin,ps:e.ps}),message:!0,loading:"正在创建，请稍后..."})).status&&(A.value=!0,!0),U=()=>{const e={venv:"添加虚拟环境需要指定到虚拟环境目录",conda:"添加Conda环境需要指定到Conda可执行文件",system:"添加系统级环境需要指定到Python解释器文件"},{BtForm:a,submit:t}=_({data:()=>({add_type:"venv",path:""}),options:a=>n(()=>[H("环境类型","add_type",[{label:"虚拟环境",value:"venv"},{label:"Conda环境",value:"conda"},{label:"系统级环境",value:"system"}]),S("环境位置","path",{attrs:{class:"!w-[42rem]",placeholder:e[a.value.add_type]},rules:[{required:!0,message:"环境位置不可为空",trigger:["blur","change"]}]},()=>{let e="dir";switch(a.value.add_type){case"system":case"conda":e="file";break;case"venv":e="dir"}((e,a="dir")=>{B({type:a,path:e.value.path,change:a=>{e.value.path=a}})})(a,e)}),T(" ",[{content:e[a.value.add_type]}])]),submit:async(e,a)=>(await a(),await f({loading:"正在添加，请稍后...",request:q(e.value),message:!0,success:()=>{A.value=!0}}))});y({area:65,title:"添加已存在的Python环境",btn:"添加",component:()=>s("div",{class:"p-[1.6rem]"},[s(a,null,null)]),onConfirm:async()=>!!(await t()).status})},G={class:"p-2rem"},I=o({__name:"index",setup(a){const{BtTable:t,refresh:n}=C({request:L,empty:()=>s("div",{class:"text-secondary text-base"},[l("暂无数据,"),s("span",{class:"bt-link",onClick:()=>V("py",n)},[l("点击安装Python")])]),columns:[{label:"名称",prop:"name",render:e=>s("div",{class:"truncate flex items-center gap-2",title:"".concat(e.name).concat(e.isCurrent?"【命令行使用】":"")},[s("span",{class:"truncate"},[e.name]),s("span",{class:"shrink-0 px-2 py-1 bg-light text-gray-600 rounded"},[(a=>{if(e.bin_path.includes("/www/server/panel/pyenv"))return"宝塔面板环境";switch(a){case"venv":return"虚拟环境";case"system":return e.from_panel?"面板安装":"系统级环境";case"conda":return"Conda环境";default:return"未知"}})(e.type)])])},{label:"Python版本",prop:"version",width:130},{label:"解释器位置",prop:"bin_path",width:80,render:e=>s("span",{class:"flex"},[s("i",{title:"跳转解释器目录",class:"text-[var(--el-color-warning-light-3)] cursor-pointer svgtofont-folder-open !text-large",onClick:()=>j({path:e.bin_path})},null)])},{label:"使用项目",prop:"project_name",render:e=>{let a="--";return e.project_name&&e.project_name.length>0&&(a=e.project_name.join("、")),s(v,{effect:"dark",content:a,"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isOverflow},{default:()=>[s("div",{class:"max-w-[30rem] truncate",ref:a=>{a&&(e._isOverflow=a.scrollWidth>a.clientWidth)}},[a])]})}},{label:"备注",prop:"ps",render:e=>s(v,{effect:"dark",content:"".concat(e.ps).concat("venv"===e.type?"【来自".concat(e.system_data.name,"】"):""),"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isPsOverflow},{default:()=>[s("div",{class:"max-w-[30rem] truncate",ref:a=>{a&&(e._isPsOverflow=a.scrollWidth>a.clientWidth)}},["".concat(e.ps).concat("venv"===e.type?"【来自".concat(e.system_data.name,"】"):"")])]})},{label:"操作",align:"right",width:150,render:e=>{const a=[];return e.isCurrent&&a.push(s("span",{class:"shrink-0 text-secondary"},[l("当前命令行使用")])),e.can_remove&&a.push(s("span",{class:"cursor-pointer bt-link",onClick:()=>(async(e,a)=>{await w({title:"确定删除环境【".concat(a,"】吗？"),content:"删除后无法恢复，请谨慎操作",onConfirm:async()=>{await f({request:W({path_data:e}),loading:"正在删除，请稍后...",success:e=>{var a,t;e.status&&e.data.data[0].status?(g.success("删除成功"),A.value=!0):g.error((null==(t=null==(a=e.data.data)?void 0:a[0])?void 0:t.msg)||e.msg)}})}})})(e.bin_path,e.name)},[l("删除")])),s("div",{class:"flex items-center"},[a.map((e,t)=>a[t+1]?s(h,null,[e,s(z,null,null)]):e)])}}],extension:[x(A)]});return i(()=>{D.value=[]}),(a,n)=>{const r=m,o=e;return c(),u("div",G,[s(o,null,{"header-left":p(()=>[s(r,{type:"primary",onClick:d(M)},{default:p(()=>[...n[1]||(n[1]=[l("创建虚拟环境",-1)])]),_:1},8,["onClick"]),s(r,{class:"ml-[2rem]",type:"default",onClick:d(U)},{default:p(()=>[...n[2]||(n[2]=[l("添加",-1)])]),_:1},8,["onClick"]),s(r,{class:"ml-[2rem]",type:"default",onClick:n[0]||(n[0]=e=>d(V)("py"))},{default:p(()=>[...n[3]||(n[3]=[l("版本管理",-1)])]),_:1})]),content:p(()=>[s(d(t),{"max-height":400})]),_:1})])}}});export{I as default};
