import{c as e,r as l,o as a,w as t,v as s,a8 as i,x as o,y as n,A as r,L as u,J as c,bt as h,K as v,S as d,Q as p,F as f,b1 as m,n as w,e as g,C as k,B as b,aT as y,ay as C,bu as _}from"./base-lib.js?v=1763689792";import{aD as x}from"./validator.js?v=1763689792";import{b6 as P,t as F,b as j,_ as L}from"./utils-lib.js?v=1763689792";const M=["id"],U={class:"path-input"},B={class:"fold-dir-list"},R=["onClick"],T=["onClick"],W={class:"path-name"},A=["onClick"],K={class:"fold-dir-list"},S=["onClick"],q=L(e({__name:"files-path",props:{initialPath:{default:"/www/wwwroot"}},emits:["pathChange","refresh"],setup(e,{expose:L,emit:q}){const D=e,E=q,I=j(),z=l(P(10,"letter")),G=l(D.initialPath),J=l(),Q=l(!0),V=l([]),$=l(0),H=l(!1),N=a({showMore:!1,showUl:!1,list:[]}),O=async e=>{if(Q.value=e,e){if(G.value===D.initialPath)return;const e=G.value;if(e.length>0&&!e.includes("/"))return I.error("路径输入不符合规则"),void(G.value=D.initialPath);if(0===e.length)return void(G.value=D.initialPath);try{const l=await Y(e);G.value=l||e}catch(l){G.value=D.initialPath}}else F(J.value)},X=(e,l)=>{var a;""===e&&(G.value="/"),null==(a=J.value)||a.blur(),l||Y(e)},Y=async e=>{const l=e.replace(/\/+$/,"")||"/",a=Z(l);return"/.Recycle_bin"===e||"/www/.Recycle_bin"===e?(I.error("此为回收站目录，请在右上角按【回收站】按钮打开"),!1):(G.value=a,E("pathChange",a),a)},Z=e=>{let l=e;return l=l.replace(/(\\\/|\/\\)/g,"/"),l=l.replace(/\\\\+/g,"/"),l=l.replace(/\/+/g,"/"),l},ee=e=>{if(!e)return;const l=e.split("/");"/"!==e?(V.value=l.map((e,a)=>({name:""===e?"根目录":e,path:""===e?"/":l.slice(0,a+1).join("/"),show:!0,showFold:!1,loading:!1,list:[]})),ae(),w(()=>{N.list=[],N.showMore=!1;const e=document.querySelectorAll("#".concat(z.value," .path-group-item")),l=document.querySelector("#".concat(z.value," .path-list-group")),a=Array.from(e).reduce((e,l)=>e+l.clientWidth+4,0);setTimeout(()=>{if(a>((null==l?void 0:l.clientWidth)||400)){let a=20;for(let t=e.length-1;t>=0;t--)a+=e[t].clientWidth,a>((null==l?void 0:l.clientWidth)||0)&&(V.value[t].show=!1,N.showMore=!0,N.list=V.value.slice(t+1));N.showMore&&(V.value[0].show=!1,N.list=V.value.slice(1))}},100)})):V.value=[{name:"根目录",path:"/",show:!0,list:[]}]},le=()=>{if(H.value)return;if(H.value=!0,"/"===G.value)return H.value=!1,I.error("当前目录为根目录");let e=G.value.split("/");e.pop();let l=e.join("/");""===l&&(l="/"),Y(l),setTimeout(()=>{H.value=!1},500)},ae=()=>{N.showUl=!1,V.value[$.value]&&(V.value=V.value.map(e=>({...e,showFold:!1}))),window.removeEventListener("click",ae)},te=async()=>{if(!H.value){H.value=!0;try{E("refresh")}catch(e){I.error("刷新失败")}finally{setTimeout(()=>{H.value=!1},500)}}};return t(()=>G.value,e=>{ee(e)},{immediate:!0}),t(()=>Q.value,()=>{Q.value||w(()=>{var e;null==(e=J.value)||e.select()})}),t(()=>D.initialPath,e=>{G.value=e}),s(()=>{ee(G.value)}),i(()=>{ae()}),L({dirPath:G,refreshList:te,goBack:le,cutDirPath:X,getPathListGroup:ee}),(e,l)=>{const a=y,t=C,s=_;return o(),n("div",{class:"nav-path",id:z.value},[r("div",{class:"back rounded-l-large relative",onClick:le},[r("i",{class:u(["svgtofont-el-back",{disabledBack:H.value}])},null,2)]),r("div",U,[c(r("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>G.value=e),ref_key:"pathInputRef",ref:J,type:"text",class:"h-full w-full pl-8px",onBlur:l[1]||(l[1]=e=>O(!0)),onKeydown:l[2]||(l[2]=d(()=>{},["stop"])),onKeyup:l[3]||(l[3]=p(e=>X(G.value,!0),["enter"]))},null,544),[[h,G.value],[v,!Q.value]]),c(r("div",{class:"path-list-group",onClick:l[5]||(l[5]=e=>O(!1))},[c(r("div",{class:"svgtofont-el-arrow-left font-bold px-[.2rem] h-full leading-[2.9rem] cursor-pointer border-l border-r border-lighter relative hover:border-darker hover:bg-light",onClick:l[4]||(l[4]=d(e=>N.showUl=!0,["stop"]))},[c(r("ul",B,[(o(!0),n(f,null,m(N.list,(e,t)=>(o(),n("li",{class:"fold-dir-item",key:t},[g(a,{effect:"dark",content:e.path,placement:"right","show-after":500},{default:k(()=>[r("div",{class:"w-full flex items-center",onClick:d(l=>X(e.path),["stop"])},[l[6]||(l[6]=r("span",{class:"dir-icon flex-shrink-0 !h-[1.6rem]"},null,-1)),r("span",null,b(e.name),1)],8,R)]),_:2},1032,["content"])]))),128))],512),[[v,N.showUl]])],512),[[v,N.showMore]]),(o(!0),n(f,null,m(V.value,(e,i)=>c((o(),n("div",{key:i,class:"path-group-item",onClick:d(l=>X(e.path),["stop"])},[g(a,{effect:"dark",content:e.name,placement:"bottom","show-after":500},{default:k(()=>[r("span",W,b(e.name),1)]),_:2},1032,["content"]),r("div",{class:"svgtofont-el-arrow-right path-name-icon",onClick:d(l=>(async(e,l)=>{try{ae(),V.value[l].showFold=!0,V.value[l].loading=!0;const{data:{dir:a}}=await x({path:e,p:1,showRow:2e3});V.value[l].loading=!1,V.value[l].list=a.map(l=>({name:l.nm,path:"".concat(e,"/").concat(l.nm).replace(/\/+/g,"/")})),$.value=l,window.addEventListener("click",ae)}catch(a){V.value[l].loading=!1}})(e.path,i),["stop"])},[c((o(),n("ul",K,[(o(!0),n(f,null,m(e.list,(e,t)=>(o(),n("li",{class:"fold-dir-item",key:t},[g(a,{effect:"dark",content:e.path,placement:"right","show-after":500},{default:k(()=>[r("div",{class:"w-full flex items-center",onClick:d(l=>X(e.path),["stop"])},[l[7]||(l[7]=r("span",{class:"dir-icon flex-shrink-0 !h-[1.6rem]"},null,-1)),r("span",null,b(e.name),1)],8,S)]),_:2},1032,["content"])]))),128)),c(g(t,{"image-size":60,description:"暂无数据"},null,512),[[v,!e.list.length]])])),[[v,e.showFold],[s,e.loading]])],8,A)],8,T)),[[v,e.show]])),128))],512),[[v,Q.value]])]),r("span",{class:"refresh rounded-r-large",onClick:te},[r("i",{class:u({"svgtofont-el-refresh-right":!H.value,"svgtofont-el-loading cursor-not-allowed animate-spin":H.value})},null,2)])],8,M)}}}),[["__scopeId","data-v-bad05061"]]);export{q as F};
