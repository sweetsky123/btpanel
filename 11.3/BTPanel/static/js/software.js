var e=Object.defineProperty,t=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);function s(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}window.plugin_view=new class{constructor(e=null){t(this,"loadList",[]),t(this,"pluginTimer",null),t(this,"fileList",{laydate:["static/laydate/laydate.js?v=1763689792"],echarts:["static/js/echarts.min.js?v=1763689792"],clipboard:["static/js/clipboard.min.js?v=1763689792"],qrcode:["static/js/jquery.qrcode.min.js?v=1763689792"],xterm:["static/css/xterm.css?v=1763689792","/static/js/xterm.js?v=1763689792"],jsencrypt:["static/js/jsencrypt.min.js?v=1763689792"],ace:["static/editor/ace.js?v=1763689792"]}),t(this,"triggerList",{laydate:["laydate.render"],echarts:["echarts.init"],clipboard:["ClipboardJS","bt.pub.copy_pass"],qrcode:["qrcode({"],xterm:["Term.run()","web_shell()"],jsencrypt:["JSEncrypt","rsa.encrypt_public"],ace:["ace.edit","bt.aceEditor","bt.fullScreenLog","bt.on_edit_file","bt.pub.on_edit_file","OnlineEditFile"]}),t(this,"getToken",()=>{const e=Date.now(),t=window.vite_public_proxy_key;return{request_time:e,request_token:window.md5(String(e).concat(window.md5(t)))}}),e&&this.renderPlugin(e)}async renderPlugin({pluginTitle:e,pluginName:t,pluginBuilt:s}){try{if(Number(s))window.soft.set_soft_config(t);else{const s=await this.getPluginHtml(t),n=await this.getPluginDependence(s);if(await this.loadFileList(n),"phpguard"===t)return void window.parent.postMessage("closePlugin&php守护已启动,无需设置!&success","*");this.openPluginView({title:e,name:t,rhtml:s})}}catch(n){window.parent.postMessage("closePlugin","*")}}async openPluginView({title:e,name:t,rhtml:s}){const n=s.replace(/[\"\']javascript\/text[\"\']/,'"text/javascript"');window.bt.open({type:1,shift:5,offset:"auto",closeBtn:2,area:e.indexOf("Node.js版本管理器")>-1?["700px","710px"]:"700px",title:'<img style="width: 24px;margin-right: 5px;margin-left: -10px;margin-top: -3px;" src="/static/img/soft_ico/ico-'.concat(t,'.png" />').concat(e),content:n,success:e=>{const t=$(window).height()||0,s=$(e).height()||0;s>=t?setTimeout(function(){$(e).css({top:"0px"})},100):($(e).find(".layui-layer-content").removeAttr("style").css({backgroundColor:"#fff"}),$(e).css({top:"".concat((t-s)/2,"px")}),$(e).find(".layui-layer-close").addClass("layui-layer-close2").removeClass("layui-layer-close1"));const n=$(window).width()||0;($(e).width()||0)>=n&&setTimeout(function(){$(e).css({left:"0px",width:"100%"})},100),window.parent.postMessage("pluginLoad","*")},end:()=>{this.checkPopup()}})}closePluginView(){clearInterval(this.pluginTimer),window.parent.postMessage("closePlugin","*")}checkPopup(){this.pluginTimer=setInterval(()=>{$(document).find(".layui-layer").length||this.closePluginView()},100)}message({message:e,type:t,time:s=2e3}){var n;null==(n=document.getElementById("el-message"))||n.remove();const i='<div id="el-message" class="el-message el-message--'.concat(t,'" style="z-index: 9999999;position:fixed">\n\t\t\t\t<div class="el-message__icon el-icon-').concat(t,'"></div>\n\t\t\t\t<div class="el-message__content">').concat(e||"","</div>\n\t\t\t</div>");window.document.body.insertAdjacentHTML("beforeend",i);const o=document.getElementById("el-message");o.style.top="calc(50% - ".concat(o.offsetHeight/2,"px)"),s&&setTimeout(()=>{const e=document.getElementById("el-message");e&&e.remove()},s)}objectToQueryString(e){return Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}isDev(){return!1}ajax(e,t,s="POST"){return new Promise((n,i)=>{const o=new XMLHttpRequest,r=this.isDev();if(r&&(e="/api/".concat(e).replace("//","/")),o.open(s,e,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r){const e=this.getToken();t={...t,...e}}else o.setRequestHeader("x-http-token",window.vite_public_request_token);o.onreadystatechange=()=>{if(o.readyState===XMLHttpRequest.DONE)if(200===o.status)try{const e=o.responseText;n(e)}catch(e){i(new Error("Error parsing response: ".concat(e)))}else i(new Error("Request failed with status: ".concat(o.status)))},o.onerror=()=>{i(new Error("Network error"))},"POST"===s&&t?o.send(this.objectToQueryString(t)):o.send()})}async getPluginHtml(e){try{return await this.ajax("/plugin?action=getConfigHtml",{name:e})}catch(t){return""}}getPluginDependence(e){const t=[],{triggerList:s,fileList:n,loadList:i}=this;for(const[o,r]of Object.entries(s))r.some(t=>e.includes(t))&&(i.includes(o)||t.push(...n[o]),i.push(o));return t}loadScriptFile(e){return new Promise((t,s)=>{const n=document.createElement("script");n.type="text/javascript",n.src=e,document.head.appendChild(n),n.onload=()=>t(!0),n.onerror=()=>s()})}loadCssFile(e){return new Promise((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,document.head.appendChild(n),n.onload=()=>t(!0),n.onerror=()=>s()})}async loadFileList(e){try{const t=[];return e.forEach(e=>{e.endsWith(".css?v=1763689792")?t.push(this.loadCssFile(e)):t.push(this.loadScriptFile(e))}),await Promise.all(t),Promise.resolve(!0)}catch(t){return Promise.reject(t)}}},window.addEventListener("message",e=>{const t=e.data;t.includes("pluginName")&&window.plugin_view.renderPlugin(JSON.parse(t))});export{s as __vite_legacy_guard};
