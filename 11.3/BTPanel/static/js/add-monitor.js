import{c as e,r as a,W as l,w as s,v as t,x as n,O as o,C as u,e as m,z as d,A as r,y as i,b1 as c,F as p,G as _,D as h,B as v,ad as f,am as b,an as V,ap as g,ak as w,aj as y,ab as U}from"./base-lib.js?v=1763689792";import{a_ as k,Q as x,k as D,ax as j,ag as E,$ as S}from"./utils-lib.js?v=1763689792";import{_ as R}from"./validator.js?v=1763689792";import{bx as q,by as A}from"./firewall.js?v=1763689792";import{_ as C}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const L={class:"flex"},P={class:"flex"},T={class:"flex min-h-[3.2rem] items-start"},H={class:"items-center h-[3.2rem]"},z=e({__name:"add-monitor",props:{compData:{default:()=>{}}},setup(e,{expose:z}){const B=a(null),F=e,I=a({name:"",method:2,site_name:"",site_url:"",access:"http",send_msg:!1,send_type:[],type:"day",week:1,where1:1,hour:1,minute:19,switch_config:!1,scan_config:{thesaurus:1,scan_args:!1,title_hash:!1,tail_hash:!1,keywords:!1,descriptions:!1,title:!1,search_monitor:!1,scan_ua:"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"},id:""}),J=l([]),N=["周一","周二","周三","周四","周五","周六","周日"],G=a(!!F.compData.id),M=[{content:"如果是本机端口转发，目标IP为：127.0.0.1"},{content:"如果目标IP不填写，默认则为本机端口转发!"}],O=[{label:"全站扫描",value:1},{label:"快速扫描",value:2},{label:"单URL",value:3}],Q=[{label:"HTTPS",value:"https"},{label:"HTTP",value:"http"}],W=[{label:"每天",value:"day"},{label:"N天",value:"day-n"},{label:"每星期",value:"week"},{label:"每月",value:"month"}],$={name:[{required:!0,trigger:["blur","change"],message:"请输入监控名"}],site_name:[{validator:(e,a,l)=>{if("auto"!==a)l();else{if(I.value.site_url||l(new Error("请输入网站域名")),3!==I.value.method&&!k(I.value.site_url))return l(new Error("检测网站域名格式不正确"));l()}},trigger:["blur","change"]}],send_type:[{required:!0,message:"请选择通知方式",trigger:["blur","change"]}],type:[{validator:(e,a,l)=>"day-n"!==a&&"month"!==a||!(I.value.where1<0||I.value.where1>31)?I.value.hour<0||I.value.hour>23?l(new Error("请输入正确小时范围[0-23]")):I.value.minute<0||I.value.minute>59?l(new Error("请输入正确分钟范围[0-59]")):void l():l(new Error("请输入正确天数范围[0-31]")),trigger:["blur","change"]}]},K=e=>{},X=e=>{var a;I.value.method=e,3===e?I.value.site_name="auto":F.compData.isSite&&(I.value.site_name=(null==(a=F.compData)?void 0:a.site_name)||F.compData.name||"")};return s(()=>I.value.site_name,()=>{const e=O.find(e=>e.value===I.value.method).label;I.value.name=(("auto"===I.value.site_name?I.value.site_url:I.value.site_name)||"")+e}),z({onConfirm:async e=>{await B.value.validate();let a="auto"===I.value.site_name?I.value.site_url:I.value.site_name,l={...I.value,site_name:a,url:I.value.access+"://"+a,send_msg:Number(I.value.send_msg)};const s=I.value;"week"===s.type&&(l.week=s.week),G.value&&(l.id=s.id),await x({loading:"正在提交，请稍后...",request:q(G.value,l),message:!0}),F.compData.refreshEvent&&F.compData.refreshEvent(),e()}}),t(()=>{(async()=>{await x({loading:"正在获取网站列表，请稍后...",request:A({type:"sites"}),data:{data:[Array,J]}}),I.value.site_name=G.value?F.compData.site_name:J.value[0].name,F.compData.isSite&&(I.value.site_name=F.compData.name)})(),G.value&&(()=>{var e,a,l,s,t;const n=F.compData;I.value={...n,...n.crontab_info,...n.scan_config,access:null==(e=n.url)?void 0:e.split("://")[0],where1:(null==(a=n.crontab_info)?void 0:a.where1)||1,hour:(null==(l=n.crontab_info)?void 0:l.where_hour)||1,minute:(null==(s=n.crontab_info)?void 0:s.where_minute)||30,send_msg:!!n.send_msg,id:n.id};let o=null==(t=F.compData.crontab_info)?void 0:t.type;I.value.type="每星期"===o?"week":"每月"===o?"month":"每天"===o?"day":"day-n"})()}),(a,l)=>{const s=D,t=f,k=j,x=b,q=V,A=E,z=g,F=R,G=w,Y=y,Z=S,ee=U;return n(),o(ee,{ref_key:"monitorFormRef",ref:B,rules:$,model:d(I),class:"p-[2rem] addfrom overflow-auto max-h-[60rem]","label-width":"10rem"},{default:u(()=>[m(t,{label:"监控名",prop:"name"},{default:u(()=>[m(s,{modelValue:d(I).name,"onUpdate:modelValue":l[0]||(l[0]=e=>d(I).name=e),width:"26rem",placeholder:"请输入监控名",clearable:""},null,8,["modelValue"])]),_:1}),m(t,{label:"检测方式"},{default:u(()=>[m(k,{modelValue:d(I).method,"onUpdate:modelValue":l[1]||(l[1]=e=>d(I).method=e),options:O,onChange:X,class:"!w-[26rem]"},null,8,["modelValue"])]),_:1}),m(t,{label:"检测网站",prop:"site_name"},{default:u(()=>[r("div",L,[m(q,{modelValue:d(I).site_name,"onUpdate:modelValue":l[2]||(l[2]=e=>d(I).site_name=e),class:"!w-[20rem] mr-4",disabled:!(3!==d(I).method&&!e.compData.isSite)},{default:u(()=>[(n(!0),i(p,null,c(d(J),(e,a)=>(n(),o(x,{key:a,value:e.name,label:"".concat(e.name,"[").concat(e.ps,"]")},null,8,["value","label"]))),128)),m(x,{label:"自定义网站",value:"auto"})]),_:1},8,["modelValue","disabled"]),"auto"===d(I).site_name?(n(),o(s,{key:0,modelValue:d(I).site_url,"onUpdate:modelValue":l[3]||(l[3]=e=>d(I).site_url=e),width:"20rem",placeholder:"请输入网站域名",clearable:""},null,8,["modelValue"])):_("",!0)])]),_:1}),m(t,{label:"访问网站方式"},{default:u(()=>[m(A,{modelValue:d(I).access,"onUpdate:modelValue":l[4]||(l[4]=e=>d(I).access=e),options:Q},null,8,["modelValue"])]),_:1}),m(t,{label:"发送告警"},{default:u(()=>[m(z,{modelValue:d(I).send_msg,"onUpdate:modelValue":l[5]||(l[5]=e=>d(I).send_msg=e)},null,8,["modelValue"])]),_:1}),!d(I).send_msg?_("",!0):(n(),o(t,{key:0,label:"通知方式",prop:"send_type"},{default:u(()=>[m(F,{modelValue:d(I).send_type,"onUpdate:modelValue":l[6]||(l[6]=e=>d(I).send_type=e),limit:["sms","wx_account"],onChange:K,multiple:!1,class:"!w-[26rem]"},null,8,["modelValue"])]),_:1})),m(t,{label:"检测频率",prop:"type"},{default:u(()=>[r("div",P,[m(k,{class:"!w-[8rem] mr-4",modelValue:d(I).type,"onUpdate:modelValue":l[7]||(l[7]=e=>d(I).type=e),options:W},null,8,["modelValue"]),"week"===d(I).type?(n(),o(q,{key:0,class:"!w-[8rem] mr-4",modelValue:d(I).week,"onUpdate:modelValue":l[8]||(l[8]=e=>d(I).week=e)},{default:u(()=>[(n(),i(p,null,c(N,(e,a)=>m(x,{key:a,label:e,value:a+1},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):_("",!0),"day-n"===d(I).type||"month"===d(I).type?(n(),o(s,{key:1,type:"number",class:"!w-[13rem] mr-4",min:"0",max:"31",modelValue:d(I).where1,"onUpdate:modelValue":l[9]||(l[9]=e=>d(I).where1=e)},{append:u(()=>[h(v("day-n"===d(I).type?"天":"日"),1)]),_:1},8,["modelValue"])):_("",!0),m(s,{type:"number",class:"!w-[13rem] mr-4",min:"0",max:"23",modelValue:d(I).hour,"onUpdate:modelValue":l[10]||(l[10]=e=>d(I).hour=e)},{append:u(()=>[...l[21]||(l[21]=[h("时",-1)])]),_:1},8,["modelValue"]),m(s,{type:"number",class:"!w-[13rem]",min:"0",max:"59",modelValue:d(I).minute,"onUpdate:modelValue":l[11]||(l[11]=e=>d(I).minute=e)},{append:u(()=>[...l[22]||(l[22]=[h("分",-1)])]),_:1},8,["modelValue"])])]),_:1}),m(C,{"is-show-divider":!0},{config:u(()=>[m(t,{label:"敏感词库"},{default:u(()=>[m(Y,{modelValue:d(I).scan_config.thesaurus,"onUpdate:modelValue":l[12]||(l[12]=e=>d(I).scan_config.thesaurus=e),class:"border-darker border-1 !w-[26rem] rounded-small px-[1rem] py-[.5rem] flex flex-col !items-start"},{default:u(()=>[m(G,{value:1},{default:u(()=>[...l[23]||(l[23]=[h("全选",-1)])]),_:1}),m(G,{value:2},{default:u(()=>[...l[24]||(l[24]=[h("自定义词库",-1)])]),_:1}),m(G,{value:3},{default:u(()=>[...l[25]||(l[25]=[h("默认词库",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),m(t,{label:"检测带参数的URL"},{default:u(()=>[r("div",T,[r("div",H,[m(z,{modelValue:d(I).scan_config.scan_args,"onUpdate:modelValue":l[13]||(l[13]=e=>d(I).scan_config.scan_args=e)},null,8,["modelValue"])]),l[26]||(l[26]=r("div",{class:"unit"},[r("p",null,"扫描时检测带参数的URL，如URL: https://bt.cn?a=b"),r("p",null,[h(" 开启前 "),r("span",{class:"ml-[2rem]"},"不检测")]),r("p",null,[h(" 开启后 "),r("span",{class:"ml-[2rem]"},"检测")]),r("p",null,"注意，开启后检测页面将成倍增长，可能会导致检测时间大量增加")],-1))])]),_:1}),m(t,{label:"头部JS检测"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.title_hash,"onUpdate:modelValue":l[14]||(l[14]=e=>d(I).scan_config.title_hash=e)},null,8,["modelValue"]),l[27]||(l[27]=r("span",{class:"unit"},"监控页面源码中的title_hash标签是否有修改",-1))]),_:1}),m(t,{label:"尾部JS检测"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.tail_hash,"onUpdate:modelValue":l[15]||(l[15]=e=>d(I).scan_config.tail_hash=e)},null,8,["modelValue"]),l[28]||(l[28]=r("span",{class:"unit"},"监控页面源码中的tail_hash标签是否有修改",-1))]),_:1}),m(t,{label:"关键词检测"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.keywords,"onUpdate:modelValue":l[16]||(l[16]=e=>d(I).scan_config.keywords=e)},null,8,["modelValue"]),l[29]||(l[29]=r("span",{class:"unit"},"监控页面源码中的keywords标签是否有修改",-1))]),_:1}),m(t,{label:"描述检测"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.descriptions,"onUpdate:modelValue":l[17]||(l[17]=e=>d(I).scan_config.descriptions=e)},null,8,["modelValue"]),l[30]||(l[30]=r("span",{class:"unit"},"监控页面源码中的descriptions标签是否有修改",-1))]),_:1}),m(t,{label:"标题检测"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.title,"onUpdate:modelValue":l[18]||(l[18]=e=>d(I).scan_config.title=e)},null,8,["modelValue"]),l[31]||(l[31]=r("span",{class:"unit"},"监控页面源码中的title标签是否有修改",-1))]),_:1}),m(t,{label:"搜索引擎收录监控"},{default:u(()=>[m(z,{modelValue:d(I).scan_config.search_monitor,"onUpdate:modelValue":l[19]||(l[19]=e=>d(I).scan_config.search_monitor=e)},null,8,["modelValue"]),l[32]||(l[32]=r("span",{class:"unit"},"监控搜索引擎是否存在风险关键词",-1))]),_:1}),m(t,{label:"自定义访问UA"},{default:u(()=>[m(s,{type:"textarea",modelValue:d(I).scan_config.scan_ua,"onUpdate:modelValue":l[20]||(l[20]=e=>d(I).scan_config.scan_ua=e),width:"36rem",height:"10rem",placeholder:"请输入自定义访问UA",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),m(Z,{options:M,class:"pl-[3.6rem] mt-[2rem]"})]),_:1},8,["model"])}}});export{z as default};
