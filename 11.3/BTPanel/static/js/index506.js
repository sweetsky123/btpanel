import{_ as e}from"./index123.js?v=1763689792";import{Q as l,b as a,p as t,$ as o,k as s,ax as n,j as i,B as d,_ as m}from"./utils-lib.js?v=1763689792";import{r,o as c,c as u,v as p,I as v,J as f,z as g,x as y,y as _,e as b,C,D as k,A as x,F as w,b1 as V,S as j,L as h,B as q,K as E,R as U,H as L,ad as S,ab as B,G as H,O as I}from"./base-lib.js?v=1763689792";import{B as R}from"./column.js?v=1763689792";import{getServiceLog as z,modifyService as A,addService as F,getServicesInfo as J,delService as O,handleService as D}from"./site.js?v=1763689792";import{u as G}from"./useStore4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const K=a(),{siteInfo:N}=G(),Q=r([]),$=r(!1),M=r(),P=r(!1),T=c({name:"",command:"",sid:"",level:11,log_type:"append",isEdit:!1}),W=r(!1),X=r(!1),Y=r([{label:"追加记录",value:"append"},{label:"启动时清空",value:"cover"}]),Z=r(!1),ee=c({logContent:"",logLoading:!1,title:"",sid:""}),le=c({name:[{required:!0,message:"请输入服务名称",trigger:"blur"}],command:[{required:!0,message:"请输入启动命令",trigger:"blur"}],level:[{required:!0,message:"请输入优先级",trigger:"blur"}]}),ae=r([{content:"协同服务用于管理那些与web服务同时运行的，用于处理一些事务的服务，如：任务队列、定时队列等，例如：celery等。"},{content:"当前工作方式为启动项目时检测这些服务，若未启动则执行启动，若已启动则不进行操作；停止项目时执行所有服务的停止操作"}]),te=e=>{T.log_type=e},oe=()=>{ue(),$.value=!0},se=e=>{T.name=e.name,T.command=e.command,T.sid=e.sid,T.level=e.level,T.log_type=e.log_type,T.isEdit=!0,$.value=!0},ne=async e=>{try{!e&&(ee.logLoading=!0);const{data:l}=await z({project_name:N.value.name,sid:ee.sid});ee.logContent=l.data,ee.logLoading=!1,e&&K.success("刷新成功")}catch(l){}},ie=e=>{ee.sid=e.sid,ee.title="main"===e.sid?"项目主服务":e.name,Z.value=!0,ne(!1)},de=async e=>{await t({icon:"warning-filled",title:"删除服务【".concat(e.name,"】"),content:"删除服务【".concat(e.name,"】后，将无法管理该服务，是否继续？")});(await l({loading:"正在删除服务，请稍后...",request:O({project_name:N.value.name,sid:e.sid}),message:!0})).status&&pe()},me=async(e,a)=>{(await l({loading:"正在修改服务状态，请稍后...",request:D({project_name:N.value.name,sid:a.sid,option:e}),message:!0})).status&&pe()},re=()=>{$.value=!1,ue()},ce=async()=>{await M.value.validate();let e={project_name:N.value.name,service_conf:JSON.stringify({name:T.name,command:T.command,level:T.level,log_type:T.log_type})};T.isEdit&&(e.sid=T.sid);const a=T.isEdit?A:F;(await l({loading:P,request:a(e),message:!0})).status&&($.value=!1,ue(),pe())},ue=()=>{T.name="",T.command="",T.sid="",T.level=11,T.log_type="append",T.isEdit=!1},pe=async(e=!1)=>{e&&(X.value=!0),await l({request:J({project_name:N.value.name}),data:{data:[Array,Q]}}),e&&(X.value=!1)},ve={class:"overflow-auto mt-1rem max-h-[61rem]"},fe={class:"flex flex-col p-[16px]"},ge={class:"service-info"},ye={class:"item-info"},_e={class:"flex items-center"},be={class:"item-info"},Ce={key:0},ke={key:1},xe={key:0,class:"item-info"},we={class:"!w-[100%]"},Ve=["onClick"],je={class:"flex items-center mt-[16px]"},he={class:"p-2rem"},qe={class:"ml-[1rem] text-primary w-[16rem] select-none"},Ee={class:"py-[2rem] pt-[0]"},Ue={class:"p-2rem flex flex-col"},Le=m(u({__name:"index",setup:l=>(p(()=>{pe(!0)}),(l,a)=>{const t=L,m=o,r=s,c=S,u=n,p=B,z=i,A=e,F=v("bt-loading");return f((y(),_("div",null,[b(t,{type:"primary",onClick:g(oe)},{default:C(()=>[...a[9]||(a[9]=[k("添加服务",-1)])]),_:1},8,["onClick"]),x("div",ve,[(y(!0),_(w,null,V(g(Q),(e,l)=>(y(),_("div",{class:"border rounded-small border-lighter mb-[16px]",key:l},[x("div",fe,[x("div",ge,[x("div",ye,[x("div",null,"服务："+q(e.name),1),x("div",_e,[a[10]||(a[10]=k("状态：",-1)),b(g(R),{modelValue:!!e.pid},null,8,["modelValue"])])]),x("div",be,[e.pid?(y(),_("div",Ce,"pid："+q(e.pid),1)):H("",!0),e.ports.length?(y(),_("div",ke,"端口："+q(e.ports.join(", ")),1)):H("",!0)]),e.sid&&"main"!==e.sid?(y(),_("div",xe,[x("div",we,[k(" 启动命令："+q(e.command)+" ",1),x("i",{class:"svgtofont-el-document-copy cursor-pointer text-default text-base copy ml-[4px]",title:"复制启动命令",onClick:()=>g(d)({value:e.command})},null,8,Ve)])])):H("",!0)]),x("div",je,[e.pid?(y(),I(t,{key:1,type:"default",onClick:l=>g(me)("stop",e)},{default:C(()=>[...a[12]||(a[12]=[k("停止",-1)])]),_:1},8,["onClick"])):(y(),I(t,{key:0,type:"default",onClick:l=>g(me)("start",e)},{default:C(()=>[...a[11]||(a[11]=[k("启动",-1)])]),_:1},8,["onClick"])),b(t,{type:"default",onClick:l=>g(me)("restart",e)},{default:C(()=>[...a[13]||(a[13]=[k("重启",-1)])]),_:1},8,["onClick"]),"main"!==e.sid?(y(),_(w,{key:2},[b(t,{type:"default",onClick:l=>g(se)(e)},{default:C(()=>[...a[14]||(a[14]=[k("编辑",-1)])]),_:1},8,["onClick"]),b(t,{type:"default",onClick:l=>g(ie)(e)},{default:C(()=>[...a[15]||(a[15]=[k("日志",-1)])]),_:1},8,["onClick"]),b(t,{type:"default",onClick:l=>g(de)(e)},{default:C(()=>[...a[16]||(a[16]=[k("删除",-1)])]),_:1},8,["onClick"])],64)):H("",!0)])])]))),128))]),b(m,{options:g(ae)},null,8,["options"]),b(z,{title:"".concat(g(T).isEdit?"编辑":"添加","服务"),modelValue:g($),"onUpdate:modelValue":a[6]||(a[6]=e=>U($)?$.value=e:null),area:50,"show-footer":!0,onConfirm:g(ce),onCancel:g(re)},{default:C(()=>[x("div",he,[b(p,{rules:g(le),"label-width":"90px",model:g(T),ref_key:"servicesFormRef",ref:M,disabled:g(P),size:"small",onSubmit:a[5]||(a[5]=j(()=>{},["prevent"]))},{default:C(()=>[b(c,{label:"名称",prop:"name"},{default:C(()=>[b(r,{modelValue:g(T).name,"onUpdate:modelValue":a[0]||(a[0]=e=>g(T).name=e),name:"name",width:"32rem"},null,8,["modelValue"])]),_:1}),b(c,{label:"启动命令",prop:"command"},{default:C(()=>[b(r,{modelValue:g(T).command,"onUpdate:modelValue":a[1]||(a[1]=e=>g(T).command=e),name:"command",width:"32rem"},null,8,["modelValue"])]),_:1}),x("div",{class:"more flex items-center cursor-pointer pl-[10rem] my-[2rem] px-[2rem]",onClick:a[2]||(a[2]=e=>W.value=!g(W))},[x("i",{class:h(g(W)?"svgtofont-el-arrow-down":"svgtofont-el-arrow-right")},null,2),x("div",qe,q("更多设置，".concat(g(W)?"点击收回":"点击查看")),1)]),f(x("div",Ee,[b(c,{label:"优先级",prop:"level"},{default:C(()=>[b(r,{modelValue:g(T).level,"onUpdate:modelValue":a[3]||(a[3]=e=>g(T).level=e),type:"number",name:"level",width:"32rem"},null,8,["modelValue"])]),_:1}),b(c,{label:"日志管理",prop:"log_type"},{default:C(()=>[b(u,{modelValue:g(T).log_type,"onUpdate:modelValue":a[4]||(a[4]=e=>g(T).log_type=e),options:g(Y),onChange:g(te),class:"!w-32rem"},null,8,["modelValue","options","onChange"])]),_:1})],512),[[E,g(W)]])]),_:1},8,["rules","model","disabled"]),f(b(m,{class:"pl-4rem",options:[{content:"【优先级】执行项目启动时，会按照优先级从高到低一次启动服务，主服务的优先级为10"}]},null,512),[[E,g(W)]])])]),_:1},8,["title","modelValue","onConfirm","onCancel"]),b(z,{title:"【".concat(g(ee).title,"】服务日志"),modelValue:g(Z),"onUpdate:modelValue":a[8]||(a[8]=e=>U(Z)?Z.value=e:null),area:70},{default:C(()=>[f((y(),_("div",Ue,[x("div",null,[b(t,{onClick:a[7]||(a[7]=e=>g(ne)(!0)),type:"default",class:"!mb-1rem"},{default:C(()=>[...a[17]||(a[17]=[k("刷新日志",-1)])]),_:1})]),b(A,{content:g(ee).logContent,isHtml:!0,class:"h-41rem","full-screen":{title:"全屏查看【".concat(g(ee).title,"】服务日志"),onRefresh:()=>g(ne)}},null,8,["content","full-screen"])])),[[F,g(ee).logLoading]])]),_:1},8,["title","modelValue"])])),[[F,g(X)]])})}),[["__scopeId","data-v-78d0322b"]]);export{Le as default};
