!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function s(t,a,i,o){var s=a&&a.prototype instanceof u?a:u,d=Object.create(s.prototype);return r(d,"_invoke",function(t,r,a){var i,o,s,u=0,d=a||[],l=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return i=n,o=0,s=e,m.n=t,c}};function f(t,r){for(o=t,s=r,n=0;!l&&u&&!a&&n<d.length;n++){var a,i=d[n],f=m.p,p=i[2];t>3?(a=p===r)&&(s=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=f&&((a=t<2&&f<i[1])?(o=0,m.v=r,m.n=i[1]):f<p&&(a=t<3||i[0]>r||r>p)&&(i[4]=t,i[5]=r,m.n=p,o=0))}if(a||t>1)return c;throw l=!0,r}return function(a,d,p){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&f(d,p),o=d,s=p;(n=o<2?e:s)||!l;){i||(o?o<3?(o>1&&(m.n=-1),f(o,s)):m.n=s:m.v=s);try{if(u=2,i){if(o||(a="next"),n=i[a]){if(!(n=n.call(i,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,o<2&&(o=0)}else 1===o&&(n=i.return)&&n.call(i),o<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((n=(l=m.n<0)?s:t.call(r,m))!==c)break}catch(n){i=e,o=1,s=n}finally{u=1}}return{value:n,done:l}}}(t,i,o),!0),d}var c={};function u(){}function d(){}function l(){}n=Object.getPrototypeOf;var m=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),f=l.prototype=u.prototype=Object.create(m);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,r(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=l,r(f,"constructor",l),r(l,"constructor",d),d.displayName="GeneratorFunction",r(l,o,"GeneratorFunction"),r(f),r(f,o,"Generator"),r(f,i,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:p}})()}function r(e,n,t,a){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,n,t,a){function o(n,t){r(e,n,function(e){return this._invoke(n,t,e)})}n?i?i(e,n,{value:t,enumerable:!a,configurable:!a,writable:!a}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},r(e,n,t,a)}function a(e,n,t,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(r,a)}function i(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var o=e.apply(n,t);function s(e){a(o,r,i,s,c,"next",e)}function c(e){a(o,r,i,s,c,"throw",e)}s(void 0)})}}System.register(["./index-legacy109.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./column-legacy.js?v=1763689792","./database-legacy.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792"],function(n,r){"use strict";var a,o,s,c,u,d,l,m,f,p,E,g,b,v,h,T,y,R,A,S,w,_,C,O,P,D,I,L,j,k,N,U,x,V,G,F,W,H,B;return{setters:[function(e){a=e._},function(e){o=e.p,s=e.M,c=e.Q,u=e.l,d=e.j},function(e){l=e.c,m=e.t,f=e.r,p=e.g,E=e.o,g=e.aE,b=e.v,v=e.I,h=e.x,T=e.y,y=e.e,R=e.C,A=e.D,S=e.J,w=e.z,_=e.A,C=e.O,O=e.S,P=e.F,D=e.b1,I=e.K,L=e.H,j=e.am,k=e.an,N=e.bc,U=e.ad,x=e.b$,V=e.ab,G=e.bp},function(e){F=e.u},function(e){W=e.getDatabasesList,H=e.delUserGrants,B=e.addUserGrants},null,null],execute:function(){var r=[{name:"数据权限",msg:"数据权限",description:"数据权限",select:!0,id:1,children:[{id:2,name:"SELECT",description:"SELECT--允许用户查询（读取）数据库中的数据。",select:!0,msg:"读取数据"},{id:3,name:"INSERT",description:"INSERT--允许用户向数据库表中插入新数据。",select:!0,msg:"插入/替换数据"},{id:4,name:"UPDATE",description:"UPDATE--允许用户修改数据库表中的数据。",select:!0,msg:"修改数据"},{id:5,name:"DELETE",description:"DELETE--允许用户从数据库表中删除数据。",select:!0,msg:"删除数据"},{name:"FILE",id:22,description:"允许用户读取或写入文件。",msg:"文件读取/写入"}]},{name:"结构权限",msg:"结构权限",description:"结构权限",select:!0,id:6,children:[{id:7,name:"CREATE",description:"允许用户创建新的数据库、表格或索引。",select:!0,msg:"创建数据库/表"},{id:8,name:"ALTER",description:"允许用户修改数据库表的结构（例如，添加、删除列）。",select:!0,msg:"修改表结构"},{id:9,name:"INDEX",description:"允许用户创建和删除索引，以提高查询性能。",select:!0,msg:"创建/删除索引"},{id:10,name:"DROP",description:"允许用户删除数据库、表格或索引。",select:!0,msg:"删除数据库/表"},{id:11,name:"CREATE TEMPORARY TABLES",description:"允许用户创建临时表格，这些表格在会话结束后会自动删除。",select:!0,msg:"创建临时表格"},{id:12,name:"SHOW VIEW",description:"允许用户查看数据库中的视图。",select:!0,msg:"查看视图"},{id:13,name:"CREATE ROUTINE",description:"允许用户创建存储过程和函数。",select:!0,msg:"创建存储过程/函数"},{id:14,name:"ALTER ROUTINE",description:"允许用户修改存储过程和函数。",select:!0,msg:"修改存储过程/函数"},{id:15,name:"EXECUTE",description:"允许用户执行存储过程和函数。",select:!0,msg:"执行存储过程/函数"},{id:16,name:"CREATE VIEW",description:"允许用户创建数据库中的视图。",select:!0,msg:"创建视图"},{id:17,name:"EVENT",description:"允许用户创建、修改和删除数据库事件。",select:!0,msg:"创建/修改/删除事件"},{id:18,name:"TRIGGER",description:"允许用户创建和管理数据库触发器。",select:!0,msg:"创建/管理触发器"}]},{name:"管理权限",msg:"管理权限",description:"管理权限",include:!0,id:19,children:[{id:20,name:"GRANT",description:"允许用户授予、撤销或管理其他用户的权限。",msg:"添加用户/权限,不重载权限"},{id:23,name:"SUPER",description:"允许用户执行特殊操作，如启动或停止数据库服务器。",msg:"达到最大连接数时,杀死其他用户进程"},{id:24,name:"PROCESS",description:"允许用户查看其他用户的数据库连接进程。",msg:"查看其他用户的连接进程"},{id:25,name:"RELOAD",description:"允许用户重新加载数据库服务器的配置。",msg:"重载数据库的配置"},{id:26,name:"SHUTDOWN",description:"允许用户关闭数据库服务器。",msg:"关闭数据库服务器"},{id:27,name:"SHOW DATABASES",description:"允许用户查看可用的数据库列表。",msg:"查看可用的数据库列表"},{id:21,name:"LOCK TABLES",description:"允许用户锁定表格，以控制并发访问。",select:!0,msg:"锁定表格"},{id:32,name:"REFERENCES",description:"允许用户创建和使用外键，以维护数据完整性。",msg:"创建/使用外键"},{id:29,name:"REPLICATION CLIENT",description:"允许用户作为复制客户端连接到主从复制系统。",msg:"作为复制客户端连接到主从复制系统"},{id:30,name:"REPLICATION SLAVE",description:"允许用户作为复制从属连接到主从复制系统。",msg:"作为复制从属连接到主从复制系统"},{id:31,name:"CREATE USER",description:"允许用户创建、更改和删除数据库用户账户。",msg:"创建/更改/删除数据库用户"}]}],M=[{name:"数据权限",msg:"数据权限",description:"数据权限",select:!0,id:1,children:[{id:2,name:"SELECT",description:"SELECT--允许用户查询（读取）数据库中的数据。",select:!0,msg:"读取数据"},{id:3,name:"INSERT",description:"INSERT--允许用户向数据库表中插入新数据。",select:!0,msg:"插入/替换数据"},{id:4,name:"UPDATE",description:"UPDATE--允许用户修改数据库表中的数据。",select:!0,msg:"修改数据"},{id:5,name:"DELETE",description:"DELETE--允许用户从数据库表中删除数据。",select:!0,msg:"删除数据"}]},{name:"结构权限",msg:"结构权限",description:"结构权限",select:!0,id:6,children:[{id:7,name:"CREATE",description:"允许用户创建新的数据库、表格或索引。",select:!0,msg:"创建数据库/表"},{id:8,name:"ALTER",description:"允许用户修改数据库表的结构（例如，添加、删除列）。",select:!0,msg:"修改表结构"},{id:9,name:"INDEX",description:"允许用户创建和删除索引，以提高查询性能。",select:!0,msg:"创建/删除索引"},{id:10,name:"DROP",description:"允许用户删除数据库、表格或索引。",select:!0,msg:"删除数据库/表"},{id:11,name:"CREATE TEMPORARY TABLES",description:"允许用户创建临时表格，这些表格在会话结束后会自动删除。",select:!0,msg:"创建临时表格"},{id:12,name:"SHOW VIEW",description:"允许用户查看数据库中的视图。",select:!0,msg:"查看视图"},{id:13,name:"CREATE ROUTINE",description:"允许用户创建存储过程和函数。",select:!0,msg:"创建存储过程/函数"},{id:14,name:"ALTER ROUTINE",description:"允许用户修改存储过程和函数。",select:!0,msg:"修改存储过程/函数"},{id:15,name:"EXECUTE",description:"允许用户执行存储过程和函数。",select:!0,msg:"执行存储过程/函数"},{id:16,name:"CREATE VIEW",description:"允许用户创建数据库中的视图。",select:!0,msg:"创建视图"},{id:17,name:"EVENT",description:"允许用户创建、修改和删除数据库事件。",select:!0,msg:"创建/修改/删除事件"},{id:18,name:"TRIGGER",description:"允许用户创建和管理数据库触发器。",select:!0,msg:"创建/管理触发器"}]},{name:"管理权限",msg:"管理权限",description:"管理权限",include:!0,id:19,children:[{id:20,name:"GRANT",description:"允许用户授予、撤销或管理其他用户的权限。",msg:"添加用户/权限,不重载权限"},{id:21,name:"LOCK TABLES",description:"允许用户锁定表格，以控制并发访问。",select:!0,msg:"锁定表格"},{id:22,name:"REFERENCES",description:"允许用户创建和使用外键，以维护数据完整性。",msg:"创建/使用外键"}]}],X={class:"p-[20px]"},q={class:"p-[20px]"},K={class:"w-[38rem] max-h-[18rem] overflow-auto border border-solid p-[12px] border-darker"};n("default",l({__name:"user-auth",props:{compData:{default:{}}},setup:function(n){var l=n,$=G().proxy,Y=m(l.compData),z=Y.row,J=Y.sid,Q=f(!1),Z=f(),ee=f([]),ne=p(function(){var e;return"*"===ae.dbname?r:"*"!==ae.dbname&&"*"!==ae.tbname?null===(e=M.find(function(e){return 1===e.id}))||void 0===e?void 0:e.children:M}),te=p(function(){return"*"===ae.dbname?[]:[1,6,21,22]}),re=E({children:"children",label:"msg",disabled:function(e){return"*"!==ae.dbname&&"*"!==ae.tbname&&![1,2,3,4,5].includes(e.id)}}),ae=E({database:"",table:"",access:[],dbname:"*",tbname:"*",loading:!1,selected:[1,6,21,22]}),ie={dbname:[{required:!0,message:"请选择数据库",trigger:["blur"]}],tbname:[{validator:function(e,n,t){""===n&&"*"!==ae.dbname?t(new Error("请选择数据库表")):t()},trigger:["blur"]}]},oe=function(){var e=i(t().m(function e(){var n,r;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,ae.loading=!0,e.n=1,W({sid:J.value});case 1:n=e.v,r=n.data,ee.value=r.data,le.addPermissionPopup=!0,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.p=3,ae.loading=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}));return function(){return e.apply(this,arguments)}}(),se=function(){var e=i(t().m(function e(n){var r;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,o({title:"删除权限",icon:"warning-filled",content:"即将删除【"+n.database+"】的权限，是否继续?"});case 1:return e.n=2,H({sid:J.value,host:z.value.host,username:z.value.user,db_name:n.database,tb_name:n.table,access:n.access.map(function(e){return e.access}).join(","),with_grant:0});case 2:r=e.v,de(z.value.user,z.value.host),s.request(r),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}));return function(n){return e.apply(this,arguments)}}(),ce=function(){var e=$.$refs.tree.getCheckedNodes().filter(function(e){return e.name&&!e.children}).map(function(e){return e.name}).join(",");return{sid:J.value,host:z.value.host,username:z.value.user,db_name:ae.dbname,tb_name:ae.tbname,access:e,with_grant:0}},ue=function(){var e=i(t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Z.value.validate();case 1:if(ae.loading=!0,""!==(n=ce()).access){e.n=2;break}return e.a(2,s.error("权限不可为空，请选择权限！"));case 2:return e.n=3,c({loading:"正在添加权限，请稍后...",request:B(n),message:!0,success:function(){le.addPermissionPopup=!1,de(z.value.user,z.value.host)}});case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.p=5,ae.loading=!1,e.f(5);case 6:return e.a(2)}},e,null,[[0,4,5,6]])}));return function(){return e.apply(this,arguments)}}(),de=function(){var e=i(t().m(function e(n,r){var a,i,o,s;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,Q.value=!0,e.n=1,l.compData.refreshEvent();case 1:a=e.v,i=a.data,o=i.find(function(e){return e.user===n}).list,s=o.find(function(e){return e.host===r}).access_list,le.associatedData=s,Q.value=!1,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.p=3,Q.value=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}));return function(n,t){return e.apply(this,arguments)}}(),le=E({addPermissionPopup:!1,associatedData:[],associatedDataColumn:[{label:"数据库",render:function(e){return"*"===e.database?e.database+" -所有数据库":e.database}},{label:"表",render:function(e){return"*"===e.table?e.table+" -所有表":e.table}},{label:"权限",width:"320",render:function(e){return g("div",{class:"truncate break-words max-h-[8rem] overflow-auto whitespace-nowrap"},[e.access.map(function(e){return"".concat(e.title?e.title:e.msg,"：").concat(e.access?e.access:e.name)}).join("\n")])}},F([{title:"删除",onClick:se}])]});return b(i(t().m(function e(){return t().w(function(e){for(;;)switch(e.n){case 0:le.associatedData=z.value.access_list;case 1:return e.a(2)}},e)}))),function(n,t){var r=L,i=u,o=j,s=k,c=N,l=U,m=x,f=V,p=d,E=a,g=v("bt-loading");return h(),T("div",X,[y(E,null,{"header-left":R(function(){return[y(r,{type:"primary",onClick:oe},{default:R(function(){return e(t[4]||(t[4]=[A("添加权限",-1)]))}),_:1})]}),content:R(function(){return[S(y(i,{"max-height":"500",data:w(le).associatedData,column:w(le).associatedDataColumn,"default-sort":{prop:"user",order:"descending"}},null,8,["data","column"]),[[g,w(Q)],[g,"正在加载列表，请稍后...","title"]])]}),popup:R(function(){return[y(p,{title:"添加权限",modelValue:w(le).addPermissionPopup,"onUpdate:modelValue":t[3]||(t[3]=function(e){return w(le).addPermissionPopup=e}),area:60,onConfirm:ue,"show-footer":""},{default:R(function(){return[_("div",q,[S((h(),C(f,{rules:ie,"label-width":"100px",model:w(ae),ref_key:"addUserPermissionFormRef",ref:Z,"label-position":"right",onSubmit:t[2]||(t[2]=O(function(){},["prevent"]))},{default:R(function(){return[y(l,{label:"数据库权限关联",prop:"dbname"},{default:R(function(){return[y(c,{span:8},{default:R(function(){return[y(s,{class:"!w-[15rem]",modelValue:w(ae).dbname,"onUpdate:modelValue":t[0]||(t[0]=function(e){return w(ae).dbname=e})},{default:R(function(){return[(h(!0),T(P,null,D(w(ee),function(e,n){return h(),C(o,{key:n,label:e.name,value:e.value},null,8,["label","value"])}),128))]}),_:1},8,["modelValue"])]}),_:1}),S(y(c,{span:10},{default:R(function(){return[y(l,{prop:"tbname"},{default:R(function(){return[y(s,{class:"!w-[22.3rem] ml-[1rem]",modelValue:w(ae).tbname,"onUpdate:modelValue":t[1]||(t[1]=function(e){return w(ae).tbname=e})},{default:R(function(){return[(h(!0),T(P,null,D(w(ee).find(function(e){return e.value===w(ae).dbname}).tb_list,function(e,n){return h(),C(o,{key:n,label:e.name,value:e.value},null,8,["label","value"])}),128))]}),_:1},8,["modelValue"])]}),_:1})]}),_:1},512),[[I,"*"!==w(ae).dbname]])]}),_:1}),y(l,{label:"基础权限"},{default:R(function(){return[_("div",K,[y(m,{data:w(ne),"node-key":"id","default-expand-all":"","show-checkbox":"",ref:"tree","default-checked-keys":w(te),props:w(re)},null,8,["data","default-checked-keys","props"])])]}),_:1})]}),_:1},8,["model"])),[[g,w(ae).loading]])])]}),_:1},8,["modelValue"])]}),_:1})])}}}))}}})}();
