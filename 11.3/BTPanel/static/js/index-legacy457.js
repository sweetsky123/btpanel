!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function u(n,r,o,u){var a=r&&r.prototype instanceof l?r:l,s=Object.create(a.prototype);return i(s,"_invoke",function(n,r,o){var u,a,i,l=0,s=o||[],p=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return u=t,a=0,i=e,f.n=n,c}};function m(n,r){for(a=n,i=r,t=0;!p&&l&&!o&&t<s.length;t++){var o,u=s[t],m=f.p,d=u[2];n>3?(o=d===r)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=e):u[0]<=m&&((o=n<2&&m<u[1])?(a=0,f.v=r,f.n=u[1]):m<d&&(o=n<3||u[0]>r||r>d)&&(u[4]=n,u[5]=r,f.n=d,a=0))}if(o||n>1)return c;throw p=!0,r}return function(o,s,d){if(l>1)throw TypeError("Generator is already running");for(p&&1===s&&m(s,d),a=s,i=d;(t=a<2?e:i)||!p;){u||(a?a<3?(a>1&&(f.n=-1),m(a,i)):f.n=i:f.v=i);try{if(l=2,u){if(a||(o="next"),t=u[o]){if(!(t=t.call(u,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,a<2&&(a=0)}else 1===a&&(t=u.return)&&t.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=e}else if((t=(p=f.n<0)?i:n.call(r,f))!==c)break}catch(t){u=e,a=1,i=t}finally{l=1}}return{value:t,done:p}}}(n,o,u),!0),s}var c={};function l(){}function s(){}function p(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),m=p.prototype=l.prototype=Object.create(f);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=p,i(m,"constructor",p),i(p,"constructor",s),s.displayName="GeneratorFunction",i(p,o,"GeneratorFunction"),i(m),i(m,o,"Generator"),i(m,r,function(){return this}),i(m,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m:d}})()}function i(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,t,n,r){function u(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(u("next",0),u("throw",1),u("return",2))},i(e,t,n,r)}function c(e,t,n,r,o,u,a){try{var i=e[u](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var u=e.apply(t,n);function a(e){c(u,r,o,a,i,"next",e)}function i(e){c(u,r,o,a,i,"throw",e)}a(void 0)})}}System.register(["./index-legacy109.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy130.js?v=1763689792","./index-legacy110.js?v=1763689792","./column-legacy.js?v=1763689792","./site-legacy.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792"],function(e,n){"use strict";var r,u,i,c,s,p,f,m,d,h,y,b,w,v,g,k,_,j,O,S,x,V,N,T,I,D,E,P,A,C,U,B,F,H,M,G,q,R,$,z,W,J,K,L,Q,X,Y,Z,ee;return{setters:[function(e){r=e._},function(e){u=e.p,i=e.Q,c=e.M,s=e.aK,p=e.l,f=e.k,m=e.ax,d=e.$,h=e.j,y=e._},function(e){b=e.c,w=e.r,v=e.av,g=e.o,k=e.g,_=e.v,j=e.I,O=e.x,S=e.y,x=e.e,V=e.C,N=e.A,T=e.z,I=e.R,D=e.D,E=e.J,P=e.O,A=e.F,C=e.b1,U=e.G,B=e.W,F=e.ap,H=e.H,M=e.ad,G=e.am,q=e.an,R=e.ab},function(e){$=e._},function(e){z=e._},function(e){W=e.u},function(e){J=e.restoreBackup,K=e.downloadBackup,L=e.deleteBackup,Q=e.getBackupList,X=e.editBackupConfig,Y=e.getBackupType,Z=e.setBackupStatus,ee=e.getBackupConfig},null],execute:function(){var n={class:"flex items-center"},te={class:"flex items-center"},ne={class:"p-[20px]"},re={class:"flex items-center"},oe=b({__name:"index",props:{compData:{default:function(){return[]}}},setup:function(e,y){var b=y.expose,oe=e,ue=w(!1),ae=w(!1),ie=w(!1),ce=w([]),le=v(oe.compData,"path"),se=w(),pe=g({path:le.value,time:"30分钟",backupTo:"localhost",type:"day",week:"1",hour:"1",minute:"30",second:"",where1:"1",timeSet:["1"],timeType:"sday"}),fe="",me=k(function(){return de.value.findIndex(function(e){return e.type===pe.type})||0}),de=w([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1}]),he=w([]),ye=w(!0),be=g({backupTo:[{required:!0,message:"请选择备份到",trigger:"change"}],where1:[{validator:function(e,t,n){"day-n"===pe.type||"month"===pe.type?Number.parseInt(t)>31||Number.parseInt(t)<1||!Number.isInteger(parseFloat(t))?n(new Error("请输入1-31的整数")):""===t?n(new Error("请输入天数")):n():n()},trigger:["blur","change"]}],hour:[{validator:function(e,t,n){"minute-n"!==pe.type&&"hour"!==pe.type&&"second-n"!==pe.type||n(),Number.parseInt(t)>23||Number.parseInt(t)<0||!Number.isInteger(parseFloat(t))?n(new Error("请输入0-23的整数")):""===t?n(new Error("请输入小时")):"hour-n"===pe.type&&0===Number.parseInt(t)&&0===Number.parseInt(pe.minute)?n(new Error("小时和分钟不能同时为0")):n()},trigger:["blur","change"]}],minute:[{validator:function(e,t,n){Number.parseInt(t)>59||Number.parseInt(t)<0||!Number.isInteger(parseFloat(t))?n(new Error("请输入0-59的整数")):""===t?n(new Error("请输入分钟")):"hour-n"===pe.type&&0===Number.parseInt(t)&&0===Number.parseInt(pe.hour)?n(new Error("小时和分钟不能同时为0")):"minute-n"===pe.type&&(Number.parseInt(t)<1||!/^[1-9]\d*$/.test(t))?n(new Error("请输入1-59的整数")):n()},trigger:["blur","change"]}],second:[{validator:function(e,t,n){"second-n"===pe.type?!Number.isInteger(parseFloat(t))||Number.parseInt(t)>59||Number.parseInt(t)<1?n(new Error("请输入1-59的整数")):""===t?n(new Error("请输入秒")):n():n()},trigger:["blur","change"]}],timeSet:[{validator:function(e,t,n){"sweek"!==pe.type||t.length?n():n(new Error("请选择时间"))},trigger:"change"}]}),we=w([{content:"温馨提示：如果文件未发生改变，则不会触发增量备份"},{content:"增量备份第一次备份，会备份一个完整的备份用于恢复，之后的备份则仅备份修改的文件"}]),ve=function(){var e=l(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({title:"恢复数据",content:"恢复备份【".concat(t.name,"】到文件后，文件将被覆盖，是否继续操作？"),icon:"warning-filled"});case 1:i({loading:"正在恢复备份，请稍后...",request:J({backup_file:t.name,backup_id:t.id}),message:!0});case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=l(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i({request:K({backup_file:t.name,cron_id:fe,backup_id:t.id}),data:{path:String,is_local:Boolean}});case 1:(n=e.v).path&&window.open("".concat(n.is_local?"/download?filename="+encodeURIComponent(n.path):n.path),"_blank","noopener,noreferrer");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ke=function(){var e=l(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({width:50,title:"删除备份",content:"删除备份【".concat(t.name,"】后，备份文件将被删除，是否继续操作？"),icon:"warning-filled"});case 1:return e.n=2,i({loading:"正在删除备份，请稍后...",request:L({backup_file:t.name,backup_id:t.id}),message:!0});case 2:if(!e.v.status){e.n=3;break}return e.n=3,Se();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),_e=function(){var e=l(a().m(function e(){var t,n,r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,ee({src_folder:oe.compData.path});case 1:t=e.v,n=t.data,r=n.msg,n.status,ie.value=!(!Array.isArray(r)||!r.length)&&!!r[0].status,Array.isArray(r)&&r.length?(fe=r[0].id,Object.keys(pe).forEach(function(e){r[0].hasOwnProperty(e)&&(pe[e]=r[0][e]),r[0].hasOwnProperty("where_".concat(e))&&(pe[e]=r[0]["where_".concat(e)])}),pe.backupTo=r[0].backupTo||"localhost",pe.path=r[0].sName,je(pe.type)):fe="",e.n=3;break;case 2:e.p=2,o=e.v,s(o);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),je=function(e){pe.type=e,pe.where1="1","minute-n"===pe.type&&(pe.where1=pe.minute),"hour-n"===pe.type&&(pe.where1=pe.hour),se.value&&se.value.clearValidate()},Oe=function(){var e=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,_e();case 1:Se();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=l(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,ye.value=!0,e.n=1,Q({src_folder:oe.compData.path,cron_id:fe});case 1:(t=e.v).status?ce.value=t.data.msg:c.error(t.msg),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.p=3,ye.value=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,se.value.validate();case 1:return e.n=2,i({loading:"正在保存配置，请稍后...",request:X(o(o({name:"网站增量备份[ ".concat(oe.compData.name," ]")},pe),{},{backupTo:pe.backupTo,sName:pe.path,sBody:"",sType:"toShell"})),message:!0});case 2:if(!e.v.status){e.n=3;break}return ae.value=!1,e.n=3,_e();case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ve=function(){var e=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return pe.path=oe.compData.path,e.n=1,Ne();case 1:ae.value=!0;case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ne=function(){var e=l(a().m(function e(){var t,n,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,ue.value=!0,e.n=1,Y({type:"sites"});case 1:n=e.v,he.value=(null==n||null===(t=n.data)||void 0===t||null===(t=t.orderOpt)||void 0===t?void 0:t.map(function(e){return{label:e.name,value:e.value}}))||[],he.value.unshift({label:"服务器磁盘",value:"localhost"}),e.n=3;break;case 2:e.p=2,r=e.v,s(r);case 3:return e.p=3,ue.value=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=pe.week,t=pe.hour,n=pe.minute,r=pe.where1,o=pe.type,u=pe.path,a=pe.backupTo;return{name:"网站增量备份[ ".concat(oe.compData.name," ]"),week:e,hour:t,minute:n,where1:r,type:o,sName:fe?u:oe.compData.path,sBody:"",sType:"toShell",backupTo:fe?a:"localhost"}},Ie=function(){var e=l(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(!t){e.n=4;break}if(fe){e.n=1;break}n=Te(),X(n),Ve(),ae.value=!0,e.n=3;break;case 1:return e.n=2,De();case 2:return e.n=3,_e();case 3:e.n=7;break;case 4:return e.n=5,u({title:"关闭增量文件备份",content:"关闭增量文件备份后，将会删除增量备份配置，是否继续操作？",icon:"warning-filled"});case 5:return e.n=6,De();case 6:return e.n=7,_e();case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),De=function(){var e=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i({request:Z({id:fe}),message:!0});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ee=B([{prop:"name",label:"备份名称",showOverflowTooltip:!0,minWidth:100,render:function(e){return x("span",{class:"truncate"},[e.name])}},{prop:"backupTo",label:"存储位置"},{prop:"size",label:"备份大小"},{prop:"time",label:"备份时间",width:150},{prop:"type",label:"备份类型",width:80},W([{onClick:ve,width:60,title:"恢复备份"},{onClick:ge,title:"下载"},{onClick:ke,title:"删除"}])]);return _(Oe),b({init:Oe}),function(e,o){var u=F,a=z,i=H,c=$,l=p,s=f,y=M,b=G,w=q,v=m,g=R,k=d,_=h,B=r,W=j("bt-loading");return O(),S("div",null,[x(B,null,{"header-left":V(function(){return[N("div",n,[N("div",te,[o[11]||(o[11]=N("span",{class:"mr-[4px]"},"启用增量文件备份",-1)),x(u,{modelValue:T(ie),"onUpdate:modelValue":o[0]||(o[0]=function(e){return I(ie)?ie.value=e:null}),onChange:Ie},null,8,["modelValue"])]),x(a),x(i,{type:"default",onClick:Ve},{default:V(function(){return t(o[12]||(o[12]=[D("增量备份配置",-1)]))}),_:1})])]}),"header-right":V(function(){return[x(c,{onRefresh:Se})]}),content:V(function(){return[E(x(l,{ref:"incrementSiteTable",height:"400",data:T(ce),column:T(Ee)},null,8,["data","column"]),[[W,T(ye)],[W,"正在加载列表，请稍后...","title"]])]}),"footer-right":V(function(){return t(o[13]||(o[13]=[]))}),popup:V(function(){return[x(_,{title:"增量文件备份配置",modelValue:T(ae),"onUpdate:modelValue":o[10]||(o[10]=function(e){return I(ae)?ae.value=e:null}),area:60,onConfirm:xe,showFooter:""},{default:V(function(){return[N("div",ne,[E((O(),P(g,{ref_key:"configFormRef",ref:se,model:T(pe),rules:T(be)},{default:V(function(){return[x(y,{label:"备份目录"},{default:V(function(){return[x(s,{disabled:"",modelValue:T(pe).path,"onUpdate:modelValue":o[1]||(o[1]=function(e){return T(pe).path=e}),width:"34rem",title:T(pe).path},null,8,["modelValue","title"])]}),_:1}),x(y,{label:"执行周期"},{default:V(function(){var e,n,r,u;return[N("div",re,[x(w,{class:"!w-[8rem] mr-1rem",modelValue:T(pe).type,"onUpdate:modelValue":o[2]||(o[2]=function(e){return T(pe).type=e}),onChange:o[3]||(o[3]=function(e){return je(T(pe).type,!0)})},{default:V(function(){return[(O(!0),S(A,null,C(T(de),function(e,t){return O(),S(A,null,["second-n"!==e.type?(O(),P(b,{key:t,label:e.text,value:e.type},null,8,["label","value"])):U("",!0)],64)}),256))]}),_:1},8,["modelValue"]),"week"==T(pe).type?(O(),P(y,{key:0,class:"el-form-item-item"},{default:V(function(){return[x(w,{modelValue:T(pe).week,"onUpdate:modelValue":o[4]||(o[4]=function(e){return T(pe).week=e}),class:"mr-1rem !w-[8rem]"},{default:V(function(){return[x(b,{label:"周一",value:"1"}),x(b,{label:"周二",value:"2"}),x(b,{label:"周三",value:"3"}),x(b,{label:"周四",value:"4"}),x(b,{label:"周五",value:"5"}),x(b,{label:"周六",value:"6"}),x(b,{label:"周日",value:"7"})]}),_:1},8,["modelValue"])]}),_:1})):U("",!0),null!==(e=T(de)[T(me)])&&void 0!==e&&e.showDay?(O(),P(y,{key:1,class:"el-form-item-item mr-1rem",prop:"where1"},{default:V(function(){return[x(s,{modelValue:T(pe).where1,"onUpdate:modelValue":o[5]||(o[5]=function(e){return T(pe).where1=e}),min:1,width:"10rem",type:"number"},{append:V(function(){return t(o[14]||(o[14]=[D("天",-1)]))}),_:1},8,["modelValue"])]}),_:1})):U("",!0),null!==(n=T(de)[T(me)])&&void 0!==n&&n.showHour?(O(),P(y,{key:2,class:"el-form-item-item mr-1rem",prop:"hour"},{default:V(function(){return[x(s,{modelValue:T(pe).hour,"onUpdate:modelValue":o[6]||(o[6]=function(e){return T(pe).hour=e}),width:"12rem",max:"23",min:"0",type:"number"},{append:V(function(){return t(o[15]||(o[15]=[D("小时",-1)]))}),_:1},8,["modelValue"])]}),_:1})):U("",!0),null!==(r=T(de)[T(me)])&&void 0!==r&&r.showMinute?(O(),P(y,{key:3,class:"el-form-item-item",prop:"minute"},{default:V(function(){return[x(s,{class:"mr-1rem",modelValue:T(pe).minute,"onUpdate:modelValue":o[7]||(o[7]=function(e){return T(pe).minute=e}),width:"12rem",max:"59",min:"0",type:"number"},{append:V(function(){return t(o[16]||(o[16]=[D("分钟",-1)]))}),_:1},8,["modelValue"])]}),_:1})):U("",!0),null!==(u=T(de)[T(me)])&&void 0!==u&&u.showSecond?(O(),P(y,{key:4,class:"el-form-item-item",prop:"second"},{default:V(function(){return[x(s,{modelValue:T(pe).second,"onUpdate:modelValue":o[8]||(o[8]=function(e){return T(pe).second=e}),width:"10rem",max:"59",min:"0",type:"number"},{append:V(function(){return t(o[17]||(o[17]=[D("秒",-1)]))}),_:1},8,["modelValue"])]}),_:1})):U("",!0)])]}),_:1}),x(y,{label:"备份到"},{default:V(function(){return[x(v,{modelValue:T(pe).backupTo,"onUpdate:modelValue":o[9]||(o[9]=function(e){return T(pe).backupTo=e}),options:T(he),class:"!w-24rem"},null,8,["modelValue","options"])]}),_:1})]}),_:1},8,["model","rules"])),[[W,T(ue)]]),x(k,{options:[T(we)[0]],class:"mt-[16px] pl-[5rem]"},null,8,["options"])])]}),_:1},8,["modelValue"])]}),_:1}),x(k,{options:T(we),class:"mt-[16px] pl-[20px]"},null,8,["options"])])}}});e("default",y(oe,[["__scopeId","data-v-3dd546b4"]]))}}})}();
