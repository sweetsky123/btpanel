import{fa as e,ak as a,V as t,fb as l,R as n,u as o,_ as s,aw as i,E as r,fc as u,e as c,fd as d,Q as p,fe as m,$ as v,ff as f,fg as y,n as b,fh as h,fi as g,fj as _,M as x,fk as w,p as k,fl as C,fm as V,H as E,an as D,fn as T,aA as j,fo as B,fp as R,fq as M,fr as S,L as O,fs as U,ft as A,fu as H,fv as L,fw as q,fx as $,ap as I,fy as z,fz as P,fA as F,B as N,fB as W,fC as J,fD as G,fE as K,fF as Q,fG as Y,fH as Z,fI as X,aC as ee}from"./utils-lib.js?v=1763689792";import{r as ae,bL as te,c as le,Y as ne,Z as oe,x as se,O as ie,C as re,D as ue,B as ce,y as de,b1 as pe,z as me,F as ve,an as fe,am as ye,e as be,A as he,al as ge,aj as _e,ba as xe,s as we,R as ke,o as Ce,b8 as Ve,v as Ee,bc as De,bd as Te,w as je,g as Be,n as Re,L as Me,N as Se,H as Oe,U as Ue,ad as Ae,ab as He,av as Le,$ as qe,a8 as $e,J as Ie,K as ze,M as Pe,d as Fe,ap as Ne,ak as We,T as Je,j as Ge,G as Ke,m as Qe,aB as Ye,a9 as Ze}from"./base-lib.js?v=1763689792";import{u as Xe,o as ea,g as aa}from"./useMethod9.js?v=1763689792";import{_ as ta}from"./header-nav-tools.vue_vue_type_script_setup_true_lang.js?v=1763689792";import{a as la,s as na,e as oa,b as sa,t as ia,c as ra,d as ua,f as ca,m as da}from"./useMethod10.js?v=1763689792";import{o as pa}from"./validator.js?v=1763689792";import{_ as ma}from"./index109.js?v=1763689792";import{u as va,a as fa,c as ya}from"./column.js?v=1763689792";import{_ as ba}from"./index110.js?v=1763689792";import{b as ha}from"./form-item.js?v=1763689792";class ga{constructor(){}static getInstance(){return ga.instance||(ga.instance=te()),ga.instance}}const _a=ae(!1),xa=ae("value"),wa=ae({type:"today",data:function(){const{start:e,end:a}=function(e){const a=new Date(e);a.setHours(0,0,0,0);const t=new Date(e);return t.setHours(23,59,59,999),{start:a,end:t}}(new Date);return[e.getTime(),a.getTime()]}()});function ka(){const l=ga.getInstance();return{getRate:e=>e>=0?"".concat(e,"%"):"--",getChartTime:(e,a)=>{let l=new Date;return"hourly"===e?(l.setMinutes(0),l.setSeconds(0),l.setHours(a)):"daily"===e&&(l=new Date(1e3*a)),t(l)},getOverview:async function(){try{_a.value=!0;const{data:t}=await e({..."value"!==xa.value?{domain:xa.value}:{},start_time:Math.floor(wa.value.data[0]/1e3),end_time:Math.floor(wa.value.data[1]/1e3)});a(t)&&l.trigger(t)}finally{_a.value=!1}},onResult:l.on}}const Ca=le({__name:"domain-select",props:ne({all:{type:Boolean,default:!0},showTag:{type:Boolean,default:!0}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,t=oe(e,"value"),o=ae([]),s=e=>a.showTag?"域名：".concat(e):e,{loading:i,setLoading:r}=Xe();return(async()=>{try{r(!0);const{data:{data:e}}=await l();n(e)&&(o.value=e.map(e=>({label:e,value:e})),a.all?o.value.unshift({label:"全部",value:"value"}):t.value=e[0]||"")}finally{r(!1)}})(),(e,a)=>{const l=ye,n=fe;return se(),ie(n,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:me(i),filterable:!0},{label:re(({label:e,value:a})=>[ue(ce(s(e)),1)]),default:re(()=>[(se(!0),de(ve,null,pe(me(o),e=>(se(),ie(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])}}}),Va={class:"ml-8px"},Ea=le({__name:"date",props:{type:{},typeModifiers:{},value:{default:()=>[]},valueModifiers:{}},emits:["update:type","update:value"],setup(e){const a=oe(e,"type"),t=oe(e,"value");function l(e=new Date){const a=na(e),t=oa(e);return[a.getTime(),t.getTime()]}const n=e=>{switch(e){case"today":t.value=l();break;case"yesterday":t.value=l(la(new Date,-1));break;case"7day":t.value=(()=>{const e=new Date,a=oa(e);return[na(la(e,-6)).getTime(),a.getTime()]})()}},o=e=>{const a=new Date,t=la(a,-30);return na(t).getTime()>e||oa(a).getTime()<e},s=e=>{a.value="custom",t.value=[na(e[0]).getTime(),oa(e[1]).getTime()]};return(e,l)=>{const i=ge,r=_e,u=xe;return se(),de(ve,null,[be(r,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),onChange:n},{default:re(()=>[be(i,{label:"今日",value:"today"}),be(i,{label:"昨日",value:"yesterday"}),be(i,{label:"最近7天",value:"7day"})]),_:1},8,["modelValue"]),he("div",Va,[be(u,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),type:"daterange","disabled-date":o,onChange:s},null,8,["modelValue"])])],64)}}}),Da={class:"flex items-center justify-between"},Ta={class:"flex items-center gap-16px"},ja={class:"w-240px"},Ba={class:"flex items-center"},Ra=le({__name:"index",setup(e){const a=o(),{getOverview:t}=ka();we(a);const l=()=>{t()},n=()=>{t()};return(e,a)=>(se(),de("div",Da,[he("div",Ta,[he("div",ja,[be(Ca,{value:me(xa),"onUpdate:value":[a[0]||(a[0]=e=>ke(xa)?xa.value=e:null),l]},null,8,["value"])]),be(ta)]),he("div",Ba,[be(Ea,{type:me(wa).type,"onUpdate:type":a[1]||(a[1]=e=>me(wa).type=e),value:me(wa).data,"onUpdate:value":[a[2]||(a[2]=e=>me(wa).data=e),n]},null,8,["type","value"])])]))}}),Ma={class:"rate-box"},Sa={class:"rate-list"},Oa={class:"rate-text"},Ua={class:"rate-list"},Aa={class:"rate-text"},Ha=s(le({__name:"index",setup(e){const{onResult:a,getRate:t}=ka(),l=Ce({delivery:0,open:0,click:0,bounce:0});return a(e=>{l.delivery=e.dashboard.delivery_rate,l.open=e.dashboard.open_rate,l.click=e.dashboard.click_rate,l.bounce=e.dashboard.bounce_rate}),(e,a)=>(se(),de("div",Ma,[he("div",Sa,[a[0]||(a[0]=he("div",{class:"rate-title"},"送达率",-1)),he("div",Oa,ce("".concat(me(l).delivery,"%")),1)]),he("div",Ua,[a[1]||(a[1]=he("div",{class:"rate-title"},"退信率",-1)),he("div",Aa,ce(me(t)(me(l).bounce)),1)])]))}}),[["__scopeId","data-v-1528d793"]]),La={class:"total-list"},qa={class:"total-item"},$a={class:"total-value text-primary text-subtitleLarge"},Ia={class:"total-item"},za={class:"total-value text-medium"},Pa={class:"total-item"},Fa={class:"total-value text-medium"},Na={class:"w-100% h-300px"},Wa=s(le({__name:"index",setup(e){const{onResult:a,getChartTime:t,getOverview:l}=ka(),o=ae(null),s=ae({delivered:0,delivery_rate:0,failed:0,failure_rate:0,sends:0}),{BtECharts:u,getEChart:c,setOption:d,setQuickOption:p}=i({options:{}}),m=Ve({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},legend:{top:0,itemGap:16,icon:"circle",itemWidth:10,itemHeight:10,data:["发件成功","发件失败"],textStyle:{lineHeight:12,padding:[0,0,-2,0],rich:{a:{verticalAlign:"middle"}}}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},yAxis:{type:"value",boundaryGap:[0,"6%"],splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:r.value?"#999":"#ebeef5"}}},xAxis:v(),series:[{type:"bar",name:"发件成功",data:[]},{type:"bar",name:"发件失败",data:[]}],events:{click:e=>{if("bar"===e.componentSubType&&n(e.value)&&"daily"===e.value[2]){const a=new Date(e.value[0]);wa.value.type="custom",wa.value.data=[na(a).getTime(),oa(a).getTime()],l()}}}});function v(e="HH:mm"){return{type:"category",axisLabel:{formatter:a=>"HH:mm"===e?a.match(/\d{2}:\d{2}/)[0]:a.split(" ")[0]}}}return Ee(()=>{a(e=>{e.send_mail_chart&&(s.value=e.send_mail_chart.dashboard,(e=>{const a=[],l=[];e.data.forEach(n=>{a.push([t(e.column_type,n.x),n.failed,e.column_type]),l.push([t(e.column_type,n.x),n.delivered,e.column_type])}),m.series=[{type:"bar",name:"发件失败",data:a,stack:"total",itemStyle:{color:"#1A519B"}},{type:"bar",name:"发件成功",data:l,stack:"total",itemStyle:{color:"#91CC75"}}],m.xAxis=v("hourly"===e.column_type?"HH:mm":"yyyy-MM-dd")})(e.send_mail_chart),o.value=c(),d(m))})}),(e,a)=>(se(),de(ve,null,[a[3]||(a[3]=he("div",{class:"mb-16px font-bold text-medium text-default"},"今日发送",-1)),he("div",La,[he("div",qa,[a[0]||(a[0]=he("div",{class:"total-label"},"发件成功率",-1)),he("div",$a,ce(me(s).delivery_rate)+"%",1)]),he("div",Ia,[a[1]||(a[1]=he("div",{class:"total-label"},"发件成功",-1)),he("div",za,ce(me(s).delivered),1)]),he("div",Pa,[a[2]||(a[2]=he("div",{class:"total-label"},"发件失败",-1)),he("div",Fa,ce(me(s).failed),1)])]),he("div",Na,[be(me(u),{style:{height:"300px"}})])],64))}}),[["__scopeId","data-v-ce656b9d"]]),Ja={class:"flex-center !h-370px"},Ga=le({__name:"bounce",setup(e){const{onResult:a,getChartTime:t}=ka(),l=Ve({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"2%",containLabel:!0},yAxis:{name:"%",type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:r.value?"#999":"#ebeef5"}},max:({max:e})=>e>100?100:e},xAxis:n(),series:o()});function n(e="HH:mm"){return{type:"category",axisLabel:{formatter:a=>"HH:mm"===e?a.match(/\d{2}:\d{2}/)[0]:a.split(" ")[0]}}}function o(e=[]){return[{name:"退信率",type:"line",data:e,itemStyle:{color:"var(--el-color-primary)"},smooth:!1,showSymbol:!1,sampling:"average"}]}const{BtECharts:s,getEChart:u,setOption:c,setQuickOption:d}=i({options:{}});return a(e=>{const{bounce_rate_chart:a}=e;if(a){const e=a.data.map(e=>[t(a.column_type,e.x),e.bounce_rate]);l.series=o(e),l.xAxis=n("hourly"===a.column_type?"HH:mm":"yyyy-MM-dd"),c(l)}}),(e,a)=>(se(),de(ve,null,[a[0]||(a[0]=he("div",{class:"mb-16px font-bold text-medium text-default"},"退信率%",-1)),he("div",Ja,[be(me(s),{style:{height:"370px"}})])],64))}}),Ka={class:"overview-card"},Qa={class:"overview-card"},Ya=s(le({__name:"index",setup(e){const{getOverview:a}=ka();return a(),(e,a)=>{const t=De,l=Te;return se(),de("div",null,[be(Ra),be(Ha),be(l,{gutter:16},{default:re(()=>[be(t,{span:12},{default:re(()=>[he("div",Ka,[be(Wa)])]),_:1}),be(t,{span:12},{default:re(()=>[he("div",Qa,[be(Ga)])]),_:1})]),_:1})])}}}),[["__scopeId","data-v-c63fc35f"]]);const Za={class:"flex items-center"},Xa={class:"w-260px"},et={class:"ml-10px"},at=le({__name:"template",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e,{expose:a}){const t=oe(e,"value"),l=ae([]),{loading:o,setLoading:s}=Xe(),i=()=>{sa("template")},r=async()=>{try{s(!0);const{data:e}=await u();n(e)&&e.length>0&&(l.value=e.map(e=>({label:e.name,value:e.id})),t.value||(t.value=e[0].id))}finally{s(!1)}};return r(),a({getList:r}),(e,a)=>{const n=ye,s=fe,r=c;return se(),de("div",Za,[he("div",Xa,[be(s,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:me(o),filterable:!0},{default:re(()=>[(se(!0),de(ve,null,pe(me(l),e=>(se(),ie(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),he("div",et,[be(r,{onClick:i},{default:re(()=>[...a[1]||(a[1]=[ue("创建",-1)])]),_:1})])])}}}),tt={class:"w-170px mr-10px"},lt={class:"w-180px"},nt=le({__name:"sender",props:{value:{},valueModifiers:{}},emits:ne(["change"],["update:value"]),setup(e,{emit:t}){const o=t,s=ae(null),i=oe(e,"value"),r=ae([]),u=ae([]),c=ae([]),p=e=>{const a=c.value.find(a=>a.username===e);a&&o("change",a.full_name)},m=ae(!1),v=ae(!1),f=async()=>{try{m.value=!0;const{data:{data:e}}=await l();n(e)&&(r.value=e.map(e=>({label:e,value:e})),s.value=e[0]||null)}finally{m.value=!1}},y=async()=>{try{v.value=!0;const{data:{data:e}}=await d();n(e)&&e.length>0&&(c.value=e)}finally{v.value=!1}},b=()=>{u.value=c.value.filter(e=>e.domain===s.value).map(e=>({data:e,label:e.username,value:e.username}))},h=()=>{if(u.value[0]){const{data:e}=u.value[0];i.value="".concat(u.value[0].value),a(e)&&o("change",e.full_name)}else i.value=null,o("change","")},g=()=>{b(),h()};return(async()=>{if(await Promise.all([f(),y()]),b(),i.value){for(const e of c.value)if(e.username===i.value){s.value=e.domain;break}}else h()})(),(e,a)=>{const t=ye,l=fe;return se(),de(ve,null,[he("div",tt,[be(l,{modelValue:me(s),"onUpdate:modelValue":a[0]||(a[0]=e=>ke(s)?s.value=e:null),loading:me(m),onChange:g},{default:re(()=>[(se(!0),de(ve,null,pe(me(r),e=>(se(),ie(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),he("div",lt,[be(l,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),loading:me(v),onChange:p},{default:re(()=>[(se(!0),de(ve,null,pe(me(u),e=>(se(),ie(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])],64)}}}),ot={class:"flex"},st={class:"ml-40px"},it=le({__name:"import",props:ne({path:{default:""},accept:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:ne(["change"],["update:value"]),setup(e,{emit:a}){const t=e,{path:l,accept:n}=t,o=oe(e,"value");je(o,e=>{s("change",e)});const s=a,i=()=>{ea({path:l,size:5,uploadData:{accept:n.map(e=>".".concat(e)).join(","),multiple:!1,limit:1},refreshEvent:(e,a)=>{o.value=e[0].name,a()}})};return(e,a)=>{const t=Oe;return se(),de("div",null,[he("div",ot,[be(t,{type:"primary",onClick:i},{default:re(()=>[...a[0]||(a[0]=[ue("导入",-1)])]),_:1}),he("div",st,[a[1]||(a[1]=ue(" 文件名: ",-1)),he("span",{class:Me(o.value?"text-primary":"text-dangerDark")},ce(o.value||"未选择任何文件"),3)])]),Se(e.$slots,"default")])}}}),rt={class:"p-20px"},ut={class:"w-250px"},ct=le({__name:"type-create",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=ae(null),o=Ce({mail_type:"",file:""}),s={mail_type:{required:!0,message:"请输入分组名称",trigger:["blur","input"]},file:{required:!0,message:"请上传文件",trigger:["blur","change"]}};return a({onConfirm:async e=>{var a;await(null==(a=n.value)?void 0:a.validate()),p({loading:"正在导入...",message:!0,request:m({...o}),success:a=>{var t;a.status&&(null==(t=l.refresh)||t.call(l),e())}})}}),(e,a)=>{const t=Ue,l=Ae,i=He,r=v;return se(),de("div",rt,[be(i,{ref_key:"formRef",ref:n,model:me(o),rules:s},{default:re(()=>[be(l,{label:"分组名称",prop:"mail_type"},{default:re(()=>[he("div",ut,[be(t,{modelValue:me(o).mail_type,"onUpdate:modelValue":a[0]||(a[0]=e=>me(o).mail_type=e),placeholder:"请输入分组名称"},null,8,["modelValue"])])]),_:1}),be(l,{label:"邮箱",prop:"file"},{default:re(()=>[be(it,{value:me(o).file,"onUpdate:value":a[1]||(a[1]=e=>me(o).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])]),_:1})]),_:1},8,["model"]),be(r,{class:"mt-4px"},{default:re(()=>[...a[2]||(a[2]=[he("li",null," 文件类型: txt/json 每行一个邮箱 不超过5 MB ",-1)])]),_:1})])}}}),dt={class:"flex-1"},pt={class:"flex items-center"},mt={class:"w-260px"},vt={class:"ml-10px"},ft={class:"mt-8px"},yt=le({__name:"type",props:{value:{},valueModifiers:{},name:{},nameModifiers:{}},emits:["update:value","update:name"],setup(e,{expose:t}){const l=oe(e,"value"),o=oe(e,"name"),s=ae([]),i=ae([]),r=ae(0),{loading:u,setLoading:d}=Xe(),p=async()=>{try{d(!0);const{data:e}=await f({});n(e)&&(i.value=e,s.value=e.map(e=>({label:e.mail_type,value:e.id})),l.value&&l.value.length>0&&m(l.value))}finally{d(!1)}},m=async e=>{o.value=i.value.filter(a=>e.includes(a.id)).map(e=>e.mail_type);const{data:t}=await y({etypes:e.join(",")});a(t)&&(r.value=t.data)},v=()=>{b({title:"创建新的分组",area:48,showFooter:!0,compData:{refresh:p},component:ct})};return p(),t({getType:p}),(e,a)=>{const t=ye,n=fe,o=c;return se(),de("div",dt,[he("div",pt,[he("div",mt,[be(n,{class:"bt-multiple-select",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),loading:me(u),multiple:"",filterable:"",placeholder:"请选择分组",onChange:m},{default:re(()=>[(se(!0),de(ve,null,pe(me(s),e=>(se(),ie(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),he("div",vt,[be(o,{onClick:v},{default:re(()=>[...a[1]||(a[1]=[ue("创建",-1)])]),_:1})])]),he("div",ft,[a[2]||(a[2]=ue("发送邮件 (",-1)),he("b",null,ce(me(r)),1),a[3]||(a[3]=ue(" 个收件人)",-1))])])}}});var bt=(e=>(e.Columns="columns",e.Button="button",e.Divider="divider",e.Header="header",e.Text="text",e.Image="image",e.Menu="menu",e.Html="html",e.commonComp="commonComp",e))(bt||{});const ht=["button","divider","header","text","image","menu","html","commonComp"];function gt(e){return"border"==e||"padding"==e||"borderRadius"==e}function _t(e,...a){if(null==e||"object"!=typeof e)return e;for(const t of a)if(null!=t)for(const a in t){const l=e[a],n=t[a];void 0!==l?null===l||null===n||"object"!=typeof l||"object"!=typeof n||Array.isArray(l)||Array.isArray(n)||l instanceof Date||l instanceof RegExp||l instanceof Map||l instanceof Set||_t(l,n):e[a]=ol(n)}return e}const xt={comp_type:{button:()=>Ft}};function wt(){const e=Object.keys(xt.comp_type);Object.entries(Rt.value).forEach(([,a])=>{e.includes(a.type)&&Object.entries(Ot.value).forEach(([e,t])=>{if(e===a.key){const e=xt.comp_type[a.type]();t.style=_t(t.style,e)}})})}const kt=ae(!1),Ct=ae(""),Vt=ae(""),Et=ae("");ae("bottom");const Dt=ae(""),Tt=ae([]),jt=ae({}),Bt=ae({}),Rt=ae({}),Mt=ae({}),St=ae({}),Ot=ae({}),Ut=ae({}),At=ae({backgroundColor:"#ffffff",maxWidth:"500px"}),Ht=ae(),Lt=Be(()=>({version:1.5,columns_source:Tt.value,column_map:jt.value,cell_map:Bt.value,cell_style_map:Mt.value,column_row_style_map:St.value,comp_style_map:Ot.value,compOptions:Ut.value,comp_map:Rt.value,page_style:At.value})),qt=ae(!0),$t=ae(async()=>!1),It=ae([{type:"columns",name:"行",icon:"el-semi-select",key:"0",children:[]},{type:"button",icon:"el-empty",name:"按钮",key:"0"},{type:"divider",name:"分割线",icon:"icon-drag",key:"0"},{type:"header",name:"标题",icon:"el-info-filled",key:"0"},{type:"text",name:"文本",icon:"file-text",key:"0"},{type:"image",name:"图片",icon:"el-folder-opened",key:"0"},{type:"menu",name:"菜单",icon:"menu-setting",key:"0"}]),zt={style:{backgroundColor:"transparent",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""},border:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},Pt={style:{backgroundColor:"transparent",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},Ft={border:{more:!1,all:"",top:"",right:"",bottom:"",left:""},padding:{more:!0,all:"",top:"10px",left:"20px",right:"20px",bottom:"10px"},borderRadius:{more:!1,all:"4px",top:"",left:"",right:"",bottom:""},width:"auto",lineHeight:"120%",color:"#ffffff",display:"inline-block",backgroundColor:"#3AAEE0",FontWeight:"normal",fontSize:"14px",textAlign:"center",LetterSpacing:"0px"},Nt={button:{style:Ft,general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank"},content:"按钮"},divider:{style:{borderTop:"1px solid #bbbbbb",width:"100%",display:"inline-block",lineHeight:"1px",height:"0px",verticalAlign:"middle"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{}},header:{style:{position:"relative",display:"block",lineHeight:"140%",fontWeight:"normal",fontSize:"22px",letterSpacing:"0px",color:"#333333"},general:{textAlign:"left",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"标题"},text:{style:{fontSize:"14px",fontWeight:"normal",color:"#333",textAlign:"left",lineHeight:"140%",letterSpacing:"0px"},general:{padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"文本"},image:{style:{display:"inline-block",width:"100%"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank",src:"",alt:""}},menu:{style:{fontWeight:"normal",fontSize:"14px",letterSpacing:"0px",color:"#444444",linkColor:"#0068A5",padding:{more:!0,all:"",top:"5px",left:"15px",right:"15px",bottom:"5px"}},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{layout:"horizontal"},links:[{id:Tl(6),label:"菜单 1",href:""},{id:Tl(6),label:"菜单 2",href:""}]}},Wt={events:{makeDom:[function(){let e=null;return()=>{clearTimeout(e),e=setTimeout(()=>{Ht.value=Kt().outerHTML,Jt()},300)}}()]},$emit(e,a){this.events[e]&&this.events[e].forEach(e=>e(a))}};const Jt=function(){let e=null;return()=>{qt.value&&(qt.value=!1,clearTimeout(e),e=setTimeout(async()=>{await $t.value(),qt.value=!0},1e3))}}();function Gt(){const e=function(){var e,a,t,l,n,o,s;const i={};for(const r in Rt.value){const u=document.createElement("div");Qt(u,Ot.value[r]);let c=null;switch(Rt.value[r].type){case"button":c=document.createElement("a"),Yt(c,Ot.value[r]);break;case"divider":c=document.createElement("div"),Zt(c,Ot.value[r]);break;case"header":c=document.createElement("div"),Xt(c,Ot.value[r]);break;case"text":c=document.createElement("div"),el(c,Ot.value[r]);break;case"image":if(null==(e=Ot.value[r].info)?void 0:e.href){c=document.createElement("a"),c.href=null==(a=Ot.value[r].info)?void 0:a.href,c.target=null==(t=Ot.value[r].info)?void 0:t.target;const e=document.createElement("img");e.src=(null==(l=Ot.value[r].info)?void 0:l.src)||"",e.alt=(null==(n=Ot.value[r].info)?void 0:n.alt)||"",e.style.display="block",e.style.width="100%",c.appendChild(e)}else c=document.createElement("img"),c.src=(null==(o=Ot.value[r].info)?void 0:o.src)||"",c.alt=(null==(s=Ot.value[r].info)?void 0:s.alt)||"";al(c,Ot.value[r]);break;case"menu":c=document.createElement("div"),tl(c,Ot.value[r])}c&&u.appendChild(c),i[r]={dom:u,general:{},info:Ot.value[r].info}}return i}(),a={};for(const t in Bt.value){const l=document.createElement("td");l.style.width=Bt.value[t].width,nl(l,Mt.value[t]),Bt.value[t].children.forEach(a=>{if(e[a]){l.appendChild(e[a].dom);for(const t in e[a].general)l.style[t]=e[a].general[t]}}),a[t]={dom:l}}return a}function Kt(){const e=function(){const e=Gt(),a={};for(const t in jt.value){const l=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("div");ll(o,St.value[t]);const s=document.createElement("table");s.style.width="100%";const i=document.createElement("tr");jt.value[t].children.forEach(a=>{i.appendChild(e[a].dom)}),s.appendChild(i),o.appendChild(s),n.appendChild(o),l.appendChild(n),a[t]={dom:l}}return a}(),a=document.createElement("table");a.setAttribute("width",At.value.maxWidth),a.style.margin="0 auto",a.style.backgroundColor=At.value.backgroundColor;for(const t of Tt.value)a.appendChild(e[t].dom);return a}function Qt(e,a){const t=Bl(a,"general");t&&Object.entries(t).forEach(([a,t])=>{e.style[a]=t})}function Yt(e,a){const t=Bl(a),l=Bl(a,"general");for(const o in t)e.style[o]=t[o];e.innerText=a.content;const{info:n}=a;return n&&(e.href=n.href,e.target=n.target),{generalStyle:l}}function Zt(e,a){const t=Bl(a),l=Bl(a,"general");for(const n in t)e.style[n]=t[n];return{generalStyle:l}}function Xt(e,a){const t=Bl(a),l=Bl(a,"general");for(const n in t)e.style[n]=t[n];return e.innerText=a.content,{generalStyle:l}}function el(e,a){const t=Bl(a),l=Bl(a,"general");for(const n in t)e.style[n]=t[n];return e.innerText=a.content,{generalStyle:l}}function al(e,a){const t=Bl(a);for(const l in t)e.style[l]=t[l]}function tl(e,a){const{links:t,info:l}=a;t.forEach(t=>{const n=document.createElement("a");!function(e,a){const t=Bl(a);for(const l in t)e.style[l]=t[l]}(n,a),n.style.display="vertical"===(null==l?void 0:l.layout)?"block":"inline-block",n.href=t.href,n.target="_blank",n.innerText=t.label,e.appendChild(n)})}function ll(e,a){const t=Bl(a);for(const l in t)e.style[l]=t[l]}function nl(e,a){const t=Bl(a);for(const l in t)e.style[l]=t[l]}function ol(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(e instanceof Map){const a=new Map;return e.forEach((e,t)=>{a.set(ol(t),ol(e))}),a}if(e instanceof Set){const a=new Set;return e.forEach(e=>{a.add(ol(e))}),a}if(Array.isArray(e))return e.map(e=>ol(e));const a=Object.create(Object.getPrototypeOf(e));return[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)].forEach(t=>{const l=Object.getOwnPropertyDescriptor(e,t);if(l){const e={...l};void 0!==l.value&&(e.value=ol(l.value)),Object.defineProperty(a,t,e)}}),a}function sl(e,a){if("0"==e.key){const e=Tl();!function(e,a){Tt.value.splice(a,0,e),Wt.$emit("makeDom")}(e,a),function(e){const a=Tl();jt.value[e]={type:bt.Columns,name:"列",key:e,children:[a]},rl(a),function(e){St.value[e]=ol(Pt)}(e),Wt.$emit("makeDom")}(e),pl(e,"columns")}Wt.$emit("makeDom")}function il(e,a){jt.value[e].children.push(a),rl(a),Wt.$emit("makeDom")}function rl(e){Bt.value[e]={width:"100%",key:e,children:[]},function(e){Mt.value[e]=ol(zt)}(e),Wt.$emit("makeDom")}function ul(e,a,t){Bt.value[e].children.push(a),dl(a,t),Wt.$emit("makeDom")}function cl(e,a,t,l){Bt.value[e].children.splice(l,0,a),dl(a,t),Wt.$emit("makeDom")}function dl(e,a){Rt.value[e]={key:e,type:a},pl(e,a),Wt.$emit("makeDom")}function pl(e,a){Ot.value[e]=ol(Nt[a]),Wt.$emit("makeDom")}function ml(e,a){!function(e){delete Ot.value[e],Wt.$emit("makeDom")}(e),delete Rt.value[e],Bt.value[a].children=Bt.value[a].children.filter(a=>a!==e),Wt.$emit("makeDom")}function vl(e,a){Bt.value[e].children.forEach(a=>{ml(a,e)}),delete Bt.value[e],jt.value[a].children=jt.value[a].children.filter(a=>a!==e),Wt.$emit("makeDom")}function fl(e){Ct.value="",Vt.value="",jt.value[e].children.forEach(a=>{vl(a,e)}),delete jt.value[e],Tt.value=Tt.value.filter(a=>a!==e),Wt.$emit("makeDom")}function yl(e,a,t){const l=Bt.value[e].children.findIndex(e=>e==a),n=Bt.value[e].children.findIndex(e=>e==t);-1!==l&&-1!==n&&l>n&&(Bt.value[e].children.splice(l,1),Bt.value[e].children.splice(n,0,a)),Wt.$emit("makeDom")}function bl(e,a,t){const l=Bt.value[e].children.findIndex(e=>e==a),n=Bt.value[e].children.findIndex(e=>e==t);-1!==l&&-1!==n&&l<n&&(Bt.value[e].children.splice(n,1),Bt.value[e].children.splice(l,0,t)),Wt.$emit("makeDom")}function hl(e,a){const t=Tt.value.findIndex(a=>a==e),l=Tt.value.findIndex(e=>e==a);-1!==t&&-1!==l&&t<l&&(Tt.value[t]=a,Tt.value[l]=e),Wt.$emit("makeDom")}function gl(e,a){const t=Tt.value.findIndex(a=>a==e),l=Tt.value.findIndex(e=>e==a);-1!==t&&-1!==l&&t>l&&(Tt.value[t]=a,Tt.value[l]=e),Wt.$emit("makeDom")}function _l(e,a){const t=jt.value[a].children;if(t.length<e.length){const l=e.length-t.length;for(let e=0;e<l;e++){const e=Tl();il(a,e)}}else{t.splice(e.length).forEach(e=>{vl(e,a)})}t.forEach((a,t)=>{Bt.value[a].width=e[t]+"%"}),Wt.$emit("makeDom")}function xl(e){const a=[];jt.value[e].children.forEach(e=>{a.push(Number(Bt.value[e].width.split("%")[0]))});const t=100/(a.length+1),l=a.reduce((e,a)=>e+a,0),n=(100-(l+t))/l;a.push(t);for(let o=0;o<a.length-1;o++)a[o]+=a[o]*n;_l(a,e),Wt.$emit("makeDom")}function wl(e,a){const t=jt.value[a].children.reduce((a,t)=>{const l=Number(Bt.value[e].width.split("%")[0]);return{...a,[t]:l}},{});delete t[e];let l=Object.values(t);const n=l.reduce((e,a)=>e+a,0),o=(100-n)/n;l=l.map(e=>parseFloat((e*(1+o)).toFixed(2)));const s=100-l.reduce((e,a)=>e+a,0);0!==s&&(l[l.length-1]+=s),vl(e,a),_l(l,a),Wt.$emit("makeDom")}function kl(e,a){const t=Bt.value[a],l=Rt.value[e],n=Ot.value[e];if(t&&l&&n){const a=ol(n),o=ol(l),s=Tl(),i=t.children.findIndex(a=>a===e);-1!==i&&t.children.splice(i+1,0,s),o.key=s,Rt.value[s]=o,Ot.value[s]=a}}function Cl(e){const a=JSON.parse(e);Ut.value=a.compOptions,Mt.value=a.cell_style_map,St.value=a.column_row_style_map,jt.value=a.column_map,Rt.value=a.comp_map,Bt.value=a.cell_map,Ot.value=a.comp_style_map,Tt.value=a.columns_source,a.page_style&&(At.value=a.page_style)}function Vl(e){e&&(Cl(e),wt(),Wt.$emit("makeDom"))}function El(){Tt.value=[],jt.value={},Bt.value={},Rt.value={},Mt.value={},St.value={},Ot.value={},Ut.value={}}function Dl(e){if(!e)return;return 1.5!==JSON.parse(e).version?(Cl(e),wt(),{content:Kt().outerHTML,render:Lt.value}):null}function Tl(e=10){return Math.random().toString(16).slice(2,2+e)}function jl(e,a){let t="",l="",n="",o="",s="";return"border"==a&&(t="border",l="borderTop",n="borderRight",o="borderBottom",s="borderLeft"),"padding"==a&&(t="padding",l="paddingTop",n="paddingRight",o="paddingBottom",s="paddingLeft"),"borderRadius"==a&&(t="borderRadius",l="borderTopLeftRadius",n="borderTopRightRadius",o="borderBottomRightRadius",s="borderBottomLeftRadius"),e.more?{[l]:e.top,[n]:e.right,[o]:e.bottom,[s]:e.left}:{[t]:e.all}}function Bl(e,a="style"){if(!e)return;const t={};for(const l in e[a])gt(l)?Object.assign(t,jl(e[a][l],l)):t[l]=e[a][l];return t}function Rl(e,a=0,t={}){let l,n,o,s,i,r,u=0,c=!1,d=!1,p=!0;function m(a){const t=l,o=n;return l=n=void 0,u=a,s=e.apply(o,t),s}function v(e,a){return setTimeout(e,a)}function f(e){const t=e-(r||0);return void 0===r||t>=a||t<0||d&&e-u>=(o||0)}function y(){const e=Date.now();if(f(e))return b(e);i=v(y,function(e){const t=e-u,l=a-(e-(r||0));return d?Math.min(l,(o||0)-t):l}(e))}function b(e){return i=void 0,p&&l?m(e):(l=n=void 0,s)}function h(...e){const t=Date.now(),o=f(t);if(l=e,n=this,r=t,o){if(void 0===i)return function(e){return u=e,i=v(y,a),c?m(e):s}(r);if(d)return i=v(y,a),m(r)}return void 0===i&&(i=v(y,a)),s}return a=Number(a)||0,t&&(c=!!t.leading,d="maxWait"in t,o=d?Math.max(Number(t.maxWait)||0,a):void 0,p="trailing"in t?!!t.trailing:p),h.cancel=function(){void 0!==i&&clearTimeout(i),u=0,l=r=n=i=void 0},h.flush=function(){return void 0===i?s:b(Date.now())},h.pending=function(){return void 0!==i},h}const Ml=["innerHTML"],Sl=le({__name:"preview",props:{id:{}},setup(e){const t=Le(e,"id"),l=ae(""),n=async()=>{if(!t.value)return;const{data:e}=await h({id:t.value});if(a(e)){const a=Dl(e.render);a&&1===e.type?(l.value=a.content,await g({id:t.value,type:e.type,temp_name:e.name,render:JSON.stringify(a.render),content:a.content},!1)):l.value=e.content}};return je(()=>t.value,()=>{n()}),n(),(e,a)=>(se(),de("div",{class:"flex-1 min-w-[520px] overflow-auto border-lighter border-1 border-solid rounded-base p-[12px]",innerHTML:me(l)},null,8,Ml))}}),Ol={class:"mb-12px font-bold text-medium text-default leading-28px"},Ul={class:"flex flex-col w-550px"},Al={class:"form-card mb-16px pt-20px"},Hl={class:"w-360px"},Ll={class:"w-360px"},ql={class:"w-[60px] ml-[24px]"},$l={class:"form-card flex-1 py-[10px]"},Il={class:"w-360px"},zl={class:"flex w-360px"},Pl={class:"flex-1 mr-10px"},Fl={class:"form-card flex flex-col items-center w-640px ml-16px pt-12px p-16px overflow-hidden"},Nl={class:"mb-12px"},Wl={class:"min-w-260px text-small"},Jl={class:"min-w-260px text-small"},Gl={class:"min-w-260px text-small"},Kl={class:"mt-[16px]"},Ql=s(le({__name:"index",props:ne({row:{},isEdit:{type:Boolean,default:!1},refresh:{type:Function,default:()=>{}}},{show:{type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const a=e,{refresh:t}=a,l=oe(e,"show");o();const n=qe("formRef"),s=qe("containerRef"),{height:i}=function(e){const a=ae(0),{mainHeight:t}=we(o());return je(()=>t.value,t=>{Re(()=>{if(!e.value)return;const{top:l}=e.value.getBoundingClientRect();a.value=t-l-16-16-52})},{immediate:!0}),{height:Be(()=>0===a.value?"auto":a.value+"px")}}(s),r=Ce({task_name:_(12),addresser:null,full_name:"",subject:"",temp_id:ia.value,is_record:0,etypes:[],unsubscribe:1,threadsType:0,threads:1,start_time:null,pause:0,remark:"",mail_to:""}),u=ae([]),c={full_name:{trigger:["blur","input"],validator:()=>""!==r.full_name||new Error("请输入显示名称")},subject:{trigger:["blur","input"],validator:()=>""!==r.subject||new Error("请输入邮件主题")},etypes:{trigger:"change",validator:()=>0!==r.etypes.length||new Error("请选择联系人")},temp_id:{trigger:"change",validator:()=>null!==r.temp_id||new Error("请选择邮件模板")},start_time:{validator:()=>1!==r.pause||null!==r.start_time||new Error("请选择发送时间")}},d=e=>{r.full_name=e||""},m=qe("startTimeRef"),v=()=>{Re(()=>{var e;null==(e=m.value)||e.restoreValidation()})},f=()=>{var e;null==(e=m.value)||e.validate()},y=()=>{b({title:"退订设置",area:45,component:Fe(()=>E(()=>import("./unsubscribe.js?v=1763689792"),__vite__mapDeps([]),import.meta.url))})},h=qe("subjectRef"),g=qe("mailToRef"),D=async()=>{var e,a;return""===r.subject?(null==(e=h.value)||e.focus(),void x.error("请输入邮件主题")):""===r.mail_to?(null==(a=g.value)||a.focus(),void x.error("请输入测试邮箱")):void(null!==r.temp_id?p({loading:"正在发送...",request:w({mail_from:r.addresser||"",subject:r.subject,mail_to:r.mail_to,temp_id:r.temp_id||0}),message:!0}):x.error("请选择邮件模板"))},T=()=>{r.subject||r.etypes.length>0?k({title:"提示",content:"确定放弃当前编辑吗？",onConfirm:()=>{l.value=!1}}):l.value=!1},j=async()=>{var e;await(null==(e=n.value)?void 0:e.validate());const o={task_name:r.task_name,addresser:r.addresser||"",full_name:r.full_name,subject:r.subject,temp_id:r.temp_id||0,is_record:r.is_record,unsubscribe:r.unsubscribe,threads:0===r.threadsType?0:r.threads,etypes:r.etypes.join(","),start_time:0===r.pause?Math.floor((new Date).getTime()/1e3):Math.floor((r.start_time||0)/1e3),remark:r.remark},{isEdit:s,row:i}=a;p({loading:"正在保存...",request:s&&i?C({...o,id:i.id}):V(o),message:!0,success:e=>{e.status&&(l.value=!1,null==t||t())}})};return $e(()=>{ia.value=null,ra.value=!1}),(()=>{const{row:e,isEdit:t}=a;e&&(r.task_name=t?e.task_name:"".concat(e.task_name,"_").concat(_(4)),r.addresser=e.addresser,r.full_name=e.full_name,r.subject=e.subject,r.is_record=e.is_record,r.unsubscribe=e.unsubscribe,r.threadsType=0===e.threads?0:1,r.threads=e.threads,r.etypes=e.etypes.split(",").map(e=>aa(e)),1e3*e.start_time>(new Date).getTime()&&(r.pause=1,r.start_time=1e3*e.start_time),r.temp_id=e.temp_id,r.remark=e.remark)})(),(a,t)=>{const l=Ae,o=Ue,p=Ne,b=Oe,_=We,x=_e,w=Je,k=xe,C=He;return se(),ie(C,{ref_key:"formRef",ref:n,model:me(r),rules:c,"label-width":"150px"},{default:re(()=>[he("div",Ol,ce(e.isEdit?"编辑发送任务":"添加发送任务"),1),he("div",{ref_key:"containerRef",ref:s,class:"flex min-h-654px",style:Pe({height:me(i)})},[he("div",Ul,[he("div",Al,[be(l,{label:"发件人",prop:"addresser"},{default:re(()=>[be(nt,{value:me(r).addresser,"onUpdate:value":t[0]||(t[0]=e=>me(r).addresser=e),onChange:d},null,8,["value"])]),_:1}),be(l,{label:"显示名称",prop:"full_name"},{default:re(()=>[he("div",Hl,[be(o,{modelValue:me(r).full_name,"onUpdate:modelValue":t[1]||(t[1]=e=>me(r).full_name=e),placeholder:"请输入显示名称"},null,8,["modelValue"])])]),_:1}),be(l,{label:"邮件主题",prop:"subject"},{default:re(()=>[he("div",Ll,[be(o,{ref_key:"subjectRef",ref:h,modelValue:me(r).subject,"onUpdate:modelValue":t[2]||(t[2]=e=>me(r).subject=e),placeholder:"请输入邮件主题"},null,8,["modelValue"])])]),_:1}),be(l,{label:"收件人",prop:"etypes"},{default:re(()=>[be(yt,{value:me(r).etypes,"onUpdate:value":t[3]||(t[3]=e=>me(r).etypes=e),name:me(u),"onUpdate:name":t[4]||(t[4]=e=>ke(u)?u.value=e:null)},null,8,["value","name"])]),_:1}),be(l,{label:"邮件模板",prop:"temp_id"},{default:re(()=>[be(at,{value:me(r).temp_id,"onUpdate:value":t[5]||(t[5]=e=>me(r).temp_id=e)},null,8,["value"])]),_:1}),be(l,{label:"保存到发件箱"},{default:re(()=>[be(p,{modelValue:me(r).is_record,"onUpdate:modelValue":t[6]||(t[6]=e=>me(r).is_record=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),be(l,{label:"退订链接"},{default:re(()=>[be(p,{modelValue:me(r).unsubscribe,"onUpdate:modelValue":t[7]||(t[7]=e=>me(r).unsubscribe=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),be(b,{class:"ml-16px",size:"small",onClick:y},{default:re(()=>[...t[14]||(t[14]=[ue("设置",-1)])]),_:1})]),_:1}),be(l,{label:"线程数",prop:"threads"},{default:re(()=>[be(x,{modelValue:me(r).threadsType,"onUpdate:modelValue":t[8]||(t[8]=e=>me(r).threadsType=e)},{default:re(()=>[be(_,{label:0},{default:re(()=>[...t[15]||(t[15]=[ue("自动",-1)])]),_:1}),be(_,{label:1},{default:re(()=>[...t[16]||(t[16]=[ue("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),Ie(he("div",ql,[be(w,{class:"!w-[60px]",modelValue:me(r).threads,"onUpdate:modelValue":t[9]||(t[9]=e=>me(r).threads=e),min:1,max:5,controls:!1,placeholder:"输入线程数"},null,8,["modelValue"])],512),[[ze,1===me(r).threadsType]])]),_:1})]),he("div",$l,[be(l,{ref_key:"startTimeRef",ref:m,label:"发送时间",prop:"start_time"},{default:re(()=>[be(x,{modelValue:me(r).pause,"onUpdate:modelValue":t[11]||(t[11]=e=>me(r).pause=e),class:"flex items-center",onChange:v},{default:re(()=>[be(_,{label:0},{default:re(()=>[...t[17]||(t[17]=[ue("立即发送",-1)])]),_:1}),be(_,{label:1},{default:re(()=>[be(k,{modelValue:me(r).start_time,"onUpdate:modelValue":t[10]||(t[10]=e=>me(r).start_time=e),type:"datetime",disabled:0===me(r).pause,clearable:"",onChange:f},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1},512),be(l,{label:"备注"},{default:re(()=>[he("div",Il,[be(o,{modelValue:me(r).remark,"onUpdate:modelValue":t[12]||(t[12]=e=>me(r).remark=e),placeholder:"请输入备注"},null,8,["modelValue"])])]),_:1}),be(l,{label:"发送测试邮件"},{default:re(()=>[he("div",zl,[he("div",Pl,[be(o,{ref_key:"mailToRef",ref:g,modelValue:me(r).mail_to,"onUpdate:modelValue":t[13]||(t[13]=e=>me(r).mail_to=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),be(b,{onClick:D},{default:re(()=>[...t[18]||(t[18]=[ue("发送测试邮件",-1)])]),_:1})])]),_:1})])]),he("div",Fl,[he("div",Nl,[be(l,{label:"From: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:re(()=>[he("div",Wl,ce(me(r).addresser),1)]),_:1}),be(l,{label:"To: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:re(()=>[he("div",Jl,ce(me(u).length>0?me(u).join(", "):"--"),1)]),_:1}),be(l,{label:"Subject: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:re(()=>[he("div",Gl,ce(me(r).subject||"--"),1)]),_:1})]),be(Sl,{id:me(r).temp_id},null,8,["id"])])],4),he("div",Kl,[be(b,{onClick:T},{default:re(()=>[...t[19]||(t[19]=[ue("取消",-1)])]),_:1}),be(b,{type:"primary",onClick:j},{default:re(()=>[...t[20]||(t[20]=[ue("确定",-1)])]),_:1})])]),_:1},8,["model"])}}}),[["__scopeId","data-v-8b711757"]]),Yl=Ge("MAIL_MARKET_TASK",()=>({formModal:Ce({row:null,isEdit:!1,title:""})})),{formModal:Zl}=we(Yl()),Xl=e=>{Zl.value.row=e,Zl.value.isEdit=!1,ra.value=!0},en=le({__name:"index",setup(e){const{mainHeight:a}=o(),l=ae({isEdit:!1,title:"",row:void 0}),{BtTable:n,BtPage:s,BtRefresh:i,BtTableCategory:r,BtRecommendSearch:u,BtColumn:c,BtBatch:d,BtErrorMask:m,refresh:v}=D({request:async e=>{let a={p:e.p,size:e.limit};const{data:t}=await T(a);return{data:t.data||[],total:j(t.page)||0}},columns:[{prop:"created",label:"时间",width:180,render:e=>t(e.created)},{prop:"subject",label:"邮件主题",showOverflowTooltip:!0},{prop:"addresser",label:"发件人",width:160,showOverflowTooltip:!0},{prop:"recipient_count",label:"收件人",width:160},{prop:"success_count",label:"成功",width:90,render:e=>2===e.task_process?e.recipient_count-e.count.error_count:"--"},{prop:"error_count",label:"失败",width:90,render:e=>2===e.task_process?be("a",{class:"bt-link !text-danger",href:"javascript:;",onClick:()=>{y(e)}},[e.count.error_count]):"--"},{prop:"task_process",label:"状态",width:90,render:e=>0===e.task_process?be("span",{class:"text-warning"},[ue(" 待处理 ")]):1===e.task_process?be("span",{class:"text-warning"},[ue(" 执行中 ")]):"完成"},{prop:"remark",label:"备注",showOverflowTooltip:!0},va(e=>[{title:"编辑",onClick:()=>{h(e)}},{title:"查看",onClick:()=>{f(e)}},{title:e.task_process?"暂停":"发送",isHide:e=>2===e.task_process,onClick:()=>{_(e)}},{title:"删除",onClick:()=>{g(e)}}])]}),f=e=>{b({title:"查看【".concat(e.subject||"","】"),area:64,compData:{row:e,onAdd:Xl},component:()=>E(()=>import("./index352.js?v=1763689792").then(e=>e.i),__vite__mapDeps([]),import.meta.url)})},y=e=>{b({title:"错误日志【".concat(e.subject,"】"),area:70,compData:{row:e},component:()=>E(()=>import("./index353.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},h=e=>{l.value.row=e,l.value.isEdit=!0,ra.value=!0},g=async e=>{k({title:"删除任务",content:"是否删除【".concat(e.subject,"】任务？"),onConfirm:async()=>{p({loading:"正在删除任务，请稍候...",message:!0,request:B({task_id:e.id}),success:()=>{v()}})}})},_=e=>{k({title:"更改任务状态【".concat(e.subject,"】"),content:e.task_process?"暂停任务后，可以继续发送任务！":"立即开始发送任务吗？",onConfirm:async()=>{p({loading:"正在处理，请稍候...",message:!0,request:R({task_id:e.id,pause:e.task_process?1:0}),success:()=>{v()}})}})};return je(ra,e=>{e||(l.value.row=void 0,l.value.isEdit=!1,l.value.title="")}),(e,t)=>{const o=Oe,i=ma;return se(),de("div",null,[Ie(be(i,null,{"header-left":re(()=>[be(o,{type:"primary",onClick:t[0]||(t[0]=e=>me(Xl)())},{default:re(()=>[...t[2]||(t[2]=[ue(" 添加发送任务 ",-1)])]),_:1}),be(ta,{class:"ml-16px"})]),content:re(()=>[be(me(n),{"min-height":me(a)},null,8,["min-height"])]),"footer-right":re(()=>[be(me(s))]),_:1},512),[[ze,!me(ra)]]),me(ra)?(se(),ie(Ql,{key:0,show:me(ra),"onUpdate:show":t[1]||(t[1]=e=>ke(ra)?ra.value=e:null),"is-edit":me(l).isEdit,title:me(l).title,row:me(l).row,refresh:me(v)},null,8,["show","is-edit","title","row","refresh"])):Ke("",!0)])}}}),an=le({__name:"type-select",props:{value:{default:()=>[]},valueModifiers:{}},emits:["update:value"],setup(e,{expose:a}){const t=oe(e,"value"),l=ae([]),{loading:o,setLoading:s}=Xe(),i=async()=>{try{s(!0);const{data:e}=await f({});n(e)&&(l.value=e.map(e=>({label:e.mail_type,value:e.id})))}finally{s(!1)}};return i(),Ee(()=>{}),a({getType:i}),(e,a)=>{const n=ye,s=fe;return se(),ie(s,Qe(e.$attrs,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:me(o)}),{default:re(()=>[(se(!0),de(ve,null,pe(me(l),e=>(se(),ie(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},16,["modelValue","loading"])}}}),tn={class:"px-[20px] pt-[24px] pb-[8px]"},ln={class:"w-300px"},nn={class:"w-300px"},on=le({__name:"index",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=ae(null),o=Ce({etypes:[]}),s={etypes:{trigger:"change",validator:()=>!!o.etypes.length||new Error("请选择邮件类型")}};return Ee(()=>{Re(()=>{o.etypes=l.row.mail_type.map(e=>Number(Object.keys(e)[0])).filter(e=>!Number.isNaN(e))})}),a({onConfirm:async e=>{p({request:M({etypes:o.etypes.join(","),recipients:l.row.recipient,active:l.row.active}),loading:"更改中...",message:!0,success:()=>{l.onRefresh(),e()}})}}),(e,a)=>{const t=Ue,i=Ae,r=He;return se(),de("div",tn,[be(r,{ref_key:"formRef",ref:n,model:me(o),rules:s},{default:re(()=>[be(i,{label:"邮箱"},{default:re(()=>[he("div",ln,[be(t,{value:me(l).row.recipient,"onUpdate:value":a[0]||(a[0]=e=>me(l).row.recipient=e),disabled:!0},null,8,["value"])])]),_:1}),be(i,{label:"分组",prop:"etypes"},{default:re(()=>[he("div",nn,[be(an,{ref:"typeSelect",modelValue:me(o).etypes,"onUpdate:modelValue":a[1]||(a[1]=e=>me(o).etypes=e),multiple:"",filterable:""},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])}}}),sn={class:"flex items-center"},rn={class:"ml-40px"},un=le({__name:"import",props:ne({path:{default:""},accept:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:ne(["change"],["update:value"]),setup(e,{emit:a}){const t=e,{path:l,accept:n}=t,o=oe(e,"value");je(o,e=>{s("change",e)});const s=a,i=()=>{ea({path:l,size:5,uploadData:{accept:n.map(e=>".".concat(e)).join(","),multiple:!1,limit:1},refreshEvent:(e,a)=>{o.value=e[0].name,a()}})};return(e,a)=>{const t=Oe;return se(),de("div",null,[he("div",sn,[be(t,{type:"primary",onClick:i},{default:re(()=>[...a[0]||(a[0]=[ue("导入",-1)])]),_:1}),he("div",rn,[a[1]||(a[1]=ue(" 文件名: ",-1)),he("span",{class:Me(o.value?"text-primary":"text-dangerDark")},ce(o.value||"未选择任何文件"),3)])]),Se(e.$slots,"default")])}}}),cn={class:"p-20px"},dn={class:"w-260px"},pn=le({__name:"index",props:{compData:{}},setup(e,{expose:a}){const t=Ye("popupClose"),l=e,{compData:n}=l,o=ae(null),s=Ce({etypes:-1!==n.group&&void 0!==n.group?[n.group]:[],file:""}),i={etypes:{trigger:"change",validator:()=>!!s.etypes.length||new Error("请选择邮件类型")},file:{required:!0,message:"请上传文件",trigger:["blur","change"]}};return a({onConfirm:async()=>{var e;await(null==(e=o.value)?void 0:e.validate()),p({request:S({etypes:s.etypes.join(","),file:s.file,active:n.active}),loading:"导入中...",message:!0,success:()=>{n.refresh(),null==t||t()}})}}),(e,a)=>{const t=Ae,l=He,n=v;return se(),de("div",cn,[be(l,{ref_key:"formRef",ref:o,model:me(s),rules:i},{default:re(()=>[be(t,{label:"分组",prop:"etypes"},{default:re(()=>[he("div",dn,[be(an,{ref:"typeSelect",class:"bt-multiple-select",value:me(s).etypes,"onUpdate:value":a[0]||(a[0]=e=>me(s).etypes=e),multiple:"",filterable:""},null,8,["value"])])]),_:1}),be(t,{label:"文件",prop:"file"},{default:re(()=>[be(un,{value:me(s).file,"onUpdate:value":a[1]||(a[1]=e=>me(s).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])]),_:1})]),_:1},8,["model"]),be(n,{class:"mt-4px"},{default:re(()=>[...a[2]||(a[2]=[he("li",null," 文件类型: txt/json 每行一个邮箱 不超过5 MB ",-1)])]),_:1})])}}}),mn=ae([]),vn=async()=>{const{data:e}=await f({});mn.value=n(e)?e:[]},fn={class:"p-20px"},yn={class:"mt-12px"},bn=le({__name:"set",setup(e){const a=ae(""),{BtTable:t,refresh:l}=D({request:async e=>(await vn(),{data:mn.value||[],total:mn.value.length||0}),columns:[{prop:"mail_type",label:"分组名称"},va(e=>[{render:e=>be("span",{class:""},[be("span",{class:"bt-link ".concat(0===e.id?"!cursor-not-allowed !opacity-50":""),onClick:()=>{0!==e.id&&o(e)}},[ue("编辑")]),be(ba,null,null)])},{render:e=>be("span",{class:"bt-link ".concat(0===e.id?"!cursor-not-allowed !opacity-50":""),onClick:()=>{0!==e.id&&s(e)}},[ue("删除")])}])]}),n=async()=>{const e=a.value.trim();""!==e?(await H({mail_type:e}),l(),a.value=""):x.error("请输入分组名称")},o=e=>{i.id=e.id,i.mail_type=e.mail_type;const{BtForm:a,submit:t}=O({data:()=>i,options:e=>Be(()=>[ha("分组名称","mail_type",{attrs:{placeholder:"请输入分组名称"},rules:[{required:!0,message:"请输入分组名称",trigger:"blur"}]})]),submit:async(e,a)=>(await a(),p({request:U(Ze(i)),loading:"编辑中...",message:!0,success:()=>{l()}}))});b({title:"编辑分组",component:()=>be(a,{class:"pt-[14px]"},null),area:35,showFooter:!0,onConfirm:t})},s=e=>{k({title:"删除分组【".concat(e.mail_type,"】"),content:"确定要删除该分组吗？",onConfirm:async()=>{p({request:A({ids:"".concat(e.id)}),loading:"删除中...",message:!0,success:()=>{l()}})}})};ae(null);const i=Ce({id:-1,mail_type:""});return(e,l)=>{const o=Ue,s=De,i=Oe,r=Te;return se(),de("div",fn,[be(r,{gutter:10},{default:re(()=>[be(s,{span:20},{default:re(()=>[be(o,{modelValue:me(a),"onUpdate:modelValue":l[0]||(l[0]=e=>ke(a)?a.value=e:null),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1}),be(s,{span:4},{default:re(()=>[be(i,{type:"primary",onClick:n},{default:re(()=>[...l[1]||(l[1]=[ue("添加",-1)])]),_:1})]),_:1})]),_:1}),he("div",yn,[be(me(t),{"max-height":300})])])}}}),hn={class:"w-200px"},gn={class:"px-[12px] py-[8px]"},_n=le({__name:"index",props:{value:{default:()=>-1},valueModifiers:{}},emits:["update:value"],setup(e){const a=oe(e,"value"),t=Be(()=>{const e=mn.value.map(e=>({label:e.mail_type,value:e.id}));return e.unshift({label:"全部",value:-1}),e}),l=e=>"分组: ".concat(e),n=()=>{b({title:"分组管理",area:36,component:bn})},{loading:o,setLoading:s}=Xe();return(async()=>{try{s(!0),await vn()}finally{s(!1)}})(),$e(()=>{mn.value=[]}),(e,s)=>{const i=Oe,r=ye,u=fe;return se(),de("div",hn,[be(u,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),loading:me(o)},{label:re(({label:e,value:a})=>[ue(ce(l(e)),1)]),footer:re(()=>[he("div",gn,[be(i,{class:"!w-full",onClick:n},{default:re(()=>[...s[1]||(s[1]=[ue("分组管理",-1)])]),_:1})])]),default:re(()=>[(se(!0),de(ve,null,pe(me(t),e=>(se(),ie(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])}}}),xn={class:"px-20px pt-24px pb-8px"},wn={class:"w-240px"},kn=le({__name:"batch",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=qe("formRef"),o=Ce({type:null}),s={type:{trigger:"change",validator:()=>null!==o.type||new Error("请选择邮件类型")}},i=Be(()=>mn.value.map(e=>({label:e.mail_type,value:e.id}))),{loading:r,setLoading:u}=Xe();(async()=>{try{u(!0),await vn()}finally{u(!1)}})();return a({onConfirm:async e=>{var a;await(null==(a=n.value)?void 0:a.validate()),p({loading:"修改中...",message:!0,request:L({etypes:"".concat(o.type||0),recipients:l.rows.map(e=>e.recipient).join(","),active:l.rows[0].active}),success:()=>{null==l||l.onRefresh(),e()}})}}),(e,a)=>{const t=ye,l=fe,u=Ae,c=He;return se(),de("div",xn,[be(c,{ref_key:"formRef",ref:n,model:me(o),rules:s},{default:re(()=>[be(u,{label:"分组",prop:"type"},{default:re(()=>[he("div",wn,[be(l,{modelValue:me(o).type,"onUpdate:modelValue":a[0]||(a[0]=e=>me(o).type=e),loading:me(r),multiple:"",filterable:""},{default:re(()=>[(se(!0),de(ve,null,pe(me(i),e=>(se(),ie(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])]),_:1})]),_:1},8,["model"])])}}}),Cn=["show"],Vn={class:"text-center fw-bold text-large text-darkSecondary"},En={class:"w-96% mx-auto"},Dn=le({__name:"index",props:{active:{default:0}},setup(e){const a=Le(e,"active"),t=(e=["1月","2月","3月","4月","5月","6月"])=>[{data:e}],l=(e=[0,0,0,0,0,0])=>[{name:"Count",type:"line",data:e,itemStyle:{color:"var(--el-color-primary)"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(var(--el-color-primar-rgb), 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}],o=Ve({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:t(),yAxis:{type:"value"},series:l()}),{loading:s,setLoading:r}=Xe(),{BtECharts:u,getEChart:c,setOption:d,setQuickOption:p}=i({options:{}}),m=async()=>{try{r(!0);const{data:{data:e}}=await q({active:a.value});if(n(e)){const a=e.map(e=>e.month),n=e.map(e=>e.count);o.xAxis=t(a),o.series=l(n)}d(o)}finally{r(!1)}};return m(),je(()=>a.value,()=>{m()}),(e,t)=>(se(),de("div",{class:"mb-16px",show:me(s)},[he("div",Vn,ce(me(a)?"订阅":"取消订阅")+" 趋势 ",1),he("div",En,[be(me(u),{class:"h-[20rem]"})])],8,Cn))}}),Tn=le({__name:"index",setup(e){const a=Ce({p:1,size:10,active:1,keyword:""}),l=async(e,a,t,l)=>{const{label:n,value:o}=l,s={del:"删除",subscribe:"订阅",unsubscribe:"取消订阅"};k({title:"批量".concat(s[o]),content:"确定".concat(s[o],"选定项吗？"),onConfirm:async()=>{let e=[],t=x.load("批量".concat(s[o],"中..."));await a(async a=>{const l=await(async e=>{const a=new Map([["subscribe",z],["unsubscribe",z],["del",P]]).get(o);switch(o){case"subscribe":case"unsubscribe":const t="subscribe"===o?1:0;if(a)return await a({recipient:e.recipient,active:t});break;case"del":if(a)return await a({ids:e.id,active:e.active})}})(a);e.push({name:a.recipient,status:l.status,message:l.msg,msg:l.msg}),t.close()}),pa(e,{title:"".concat(s[o])}),y()}})},n=I([{label:"删除",value:"del",event:l},{label:"订阅",value:"subscribe",event:l},{label:"取消订阅",value:"unsubscribe",event:l},{label:"设置分组",value:"category",event:(e,a,t,l)=>{b({title:"设置分组",area:45,showFooter:!0,compData:{rows:t.value,onRefresh:y},component:kn})}}]),{BtTable:o,BtPage:s,BtSearch:i,BtRefresh:r,BtColumn:u,BtBatch:c,BtTableCategory:d,BtErrorMask:m,tableRef:v,classList:f,refresh:y}=D({request:async e=>{let t={etype:ua.value,search:e.search,p:e.p,size:e.limit,active:a.active};-1===t.etype&&delete t.etype;const{data:{data:l,total:n}}=await $(t);return{data:l,total:n}},columns:[fa(),{prop:"recipient",label:"邮箱",showOverflowTooltip:!0},{prop:"mail_type",label:"分组",render:e=>e.mail_type.map(e=>Object.values(e)[0]).join(", ")},{prop:"created",label:"添加时间",width:140,render:e=>t(e.created)},va(e=>[{title:"更改列表",onClick:async()=>{b({title:"更改列表",area:50,showFooter:!0,compData:{row:e,onRefresh:()=>{y()}},component:on})}},{title:e.active?"取消订阅":"订阅",onClick:async()=>{k({title:"".concat(e.active?"取消订阅":"订阅"," [").concat(e.recipient,"]"),content:"您确定要从此邮箱".concat(e.active?"取消订阅":"订阅","吗？"),onConfirm:async()=>{p({request:z({recipient:e.recipient,active:0===e.active?1:0}),loading:"更改中...",message:!0,success:()=>{y()}})}})}},{title:"删除",onClick:async()=>{k({title:"删除 [".concat(e.recipient,"]"),content:"您确定要删除此".concat(e.active?"订阅":"取消订阅","邮件吗？"),onConfirm:async()=>{p({request:P({ids:e.id,active:e.active}),loading:"删除中...",message:!0,success:()=>{y()}})}})}}])],extension:[n]}),h=()=>{b({title:"导入联系人",area:45,showFooter:!0,compData:{active:a.active,group:ua.value,refresh:()=>{y()}},component:pn})},g=e=>{a.active=e,a.p=1,y()},_=()=>{a.p=1,y()};return $e(()=>{ua.value=-1}),(e,t)=>{const l=Oe,n=ge,r=_e,u=ma;return se(),de("div",null,[be(Dn,{active:me(a).active},null,8,["active"]),be(u,null,{"header-left":re(()=>[be(l,{type:"primary",onClick:h},{default:re(()=>[...t[3]||(t[3]=[ue("导入",-1)])]),_:1}),be(ta,{class:"ml-16px"})]),"header-right":re(()=>[be(r,{modelValue:me(a).active,"onUpdate:modelValue":t[0]||(t[0]=e=>me(a).active=e),onChange:g,class:"w-[120px] mr-[12px]"},{default:re(()=>[be(n,{label:"订阅",value:1}),be(n,{label:"取消订阅",value:0})]),_:1},8,["modelValue"]),be(_n,{value:me(ua),"onUpdate:value":[t[1]||(t[1]=e=>ke(ua)?ua.value=e:null),me(y)],class:"mr-[12px]"},null,8,["value","onUpdate:value"]),be(me(i),{modelValue:me(a).keyword,"onUpdate:modelValue":t[2]||(t[2]=e=>me(a).keyword=e),class:"!w-[240px]",placeholder:"请输入邮箱",onSearch:_},null,8,["modelValue"])]),content:re(()=>[be(me(o),{ref_key:"tableRef",ref:v},null,512)]),"footer-left":re(()=>[be(me(c),{ref:"batchRef"},null,512)]),"footer-right":re(()=>[be(me(s),{ref:"pageRef"},null,512)]),_:1})])}}}),jn={class:"p-[20px] pt-[24px] pb-[8px]"},Bn={class:"w-[200px]"},Rn=le({__name:"form",props:{compData:{}},setup(e,{expose:a}){const t=Ye("popupClose"),l=e,{row:n,isEdit:o,refresh:s}=l.compData,i=ae(null),r=Ce({mail_type:""}),u={mail_type:{required:!0,trigger:"blur",message:"请输入分组名"}};return a({onConfirm:async()=>{var e;await(null==(e=i.value)?void 0:e.validate()),p({loading:"正在".concat(o?"编辑":"添加","分组"),message:!0,request:o&&n?U({...Ze(r),id:n.id}):H(Ze(r)),success:e=>{e.status&&(null==t||t(),null==s||s())}})}}),(e,a)=>{const t=Ue,l=Ae,n=He;return se(),de("div",jn,[be(n,{ref_key:"formRef",ref:i,model:me(r),rules:u},{default:re(()=>[be(l,{label:"分组名",prop:"mail_type"},{default:re(()=>[he("div",Bn,[be(t,{modelValue:me(r).mail_type,"onUpdate:modelValue":a[0]||(a[0]=e=>me(r).mail_type=e),placeholder:"请输入组名"},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])}}}),Mn=le({__name:"index",setup(e,{expose:a}){const l=Ce({show:!1,title:"",data:{isEdit:!1,row:null,refresh:()=>{d()}}}),n=()=>{l.data.row=null,l.data.isEdit=!1,l.title="添加分组",b({title:"添加分组",component:Rn,compData:l.data,area:40,showFooter:!0})},o=I([{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"确定删除选定项吗？",column:[{label:"群组名称",prop:"mail_type"},ya()],onConfirm:async()=>{let e=[];await a(async a=>{const t=await W({ids:a.id});e.push({name:a.mail_type,status:t.status,message:t.msg,msg:t.msg})}),pa(e,{title:"删除"}),d()}})}}]),{BtTable:s,BtPage:i,BtRefresh:r,BtColumn:u,BtBatch:c,refresh:d,BtSearch:m}=D({request:async e=>{const{data:a}=await F(e);return{data:a.data||[],total:a.total||0}},columns:[fa(),{prop:"mail_type",label:"群组名称",render:e=>be("a",{class:"bt-link",href:"javascript:;",onClick:()=>{ca(e.id)}},[e.mail_type])},{prop:"subscribers",label:"订阅",align:"center"},{prop:"unsubscribers",label:"取消订阅",align:"center"},{prop:"created",label:"添加时间",render:e=>t(e.created)},va(e=>[{title:"复制链接",isHide:e=>!0,onClick:()=>{N(e.subscribe_url)}},{title:"重命名",onClick:()=>{(e=>{l.data.row=e,l.data.isEdit=!0,l.title="编辑分组",b({title:"编辑分组",component:Rn,compData:l.data,area:40,showFooter:!0})})(e)}},{title:"删除",onClick:()=>{e.subscribers||e.unsubscribers?x.error("请先修改或删除此类型下的取消订阅或订阅者，才能继续删除\t"):k({title:"删除",content:"确定删除【".concat(e.mail_type,"】分组吗？"),onConfirm:async()=>{p({loading:"正在删除",message:!0,request:W({ids:e.id}),success:()=>{d()}})}})}}])],extension:[o]});return a({init:d}),(e,a)=>{const t=Oe,l=ma;return se(),de("div",null,[be(l,null,{"header-left":re(()=>[be(t,{type:"primary",onClick:n},{default:re(()=>[...a[0]||(a[0]=[ue("添加",-1)])]),_:1}),be(ta,{class:"ml-16px"})]),"header-right":re(()=>[be(me(m),{class:"!w-[240px]",placeholder:"请输入名称",onSearch:me(d)},null,8,["onSearch"])]),content:re(()=>[be(me(s))]),"footer-left":re(()=>[be(me(c))]),"footer-right":re(()=>[be(me(i))]),_:1})])}}}),Sn=le({__name:"index",setup(e,{expose:a}){const l=Ce({p:1,size:10,status:"bounced",search:""}),o=I([{label:"删除",value:"del",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"您确定要删除选定项吗？",column:[{label:"邮箱",prop:"recipient"},ya()],onConfirm:async()=>{let e=[];await a(async a=>{const t=await G({ids:a.id});e.push({name:a.recipient,status:t.status,msg:t.msg})}),pa(e,{title:"批量删除"}),d()}})}}]),{BtTable:s,BtPage:i,BtRefresh:r,BtColumn:u,BtBatch:c,refresh:d,BtSearch:m}=D({request:async e=>{const{data:a}=await J(e);return{data:a.data||[],total:a.total||0}},columns:[fa(),{prop:"recipient",label:"邮箱"},{prop:"task_name",label:"邮件主题"},{prop:"status",label:"类型"},{prop:"state",label:"状态",render:e=>e.state||e.count>=3?"无效":"观察"},{prop:"created",label:"添加时间",render:e=>t(e.created)},va(e=>[{title:"删除",onClick:async()=>{k({title:"删除",content:"您确定要删除".concat(e.recipient,"吗？"),onConfirm:async()=>{p({loading:"正在删除，请稍候...",message:!0,request:G({ids:e.id}),success:()=>{d()}})}})}}])],extension:[o]}),v=ae([]),f=()=>{l.p=1,d()},y=()=>{k({title:"清空无效列表",content:"这将清除该类型下的所有数据，您确定要继续吗？",onConfirm:async()=>{await K({status:l.status}),d()}})},b=async()=>{await(async()=>{try{const{data:{data:e}}=await Q();n(e)&&(v.value=e.map(e=>({label:e.status,value:e.status})),v.value.length&&(l.status=v.value[0].value))}catch(e){}})(),d()};return b(),a({init:b}),(e,a)=>{const t=Oe,n=ye,o=fe,r=ma;return se(),de("div",null,[be(r,null,{"header-left":re(()=>[be(t,{type:"primary",onClick:me(d)},{default:re(()=>[...a[1]||(a[1]=[ue("刷新",-1)])]),_:1},8,["onClick"]),be(t,{onClick:y},{default:re(()=>[...a[2]||(a[2]=[ue("清空",-1)])]),_:1}),be(ta,{class:"ml-16px"})]),"header-right":re(()=>[be(o,{class:"!w-[200px] mr-[10px]",modelValue:me(l).status,"onUpdate:modelValue":a[0]||(a[0]=e=>me(l).status=e),onUpdate:f},{default:re(()=>[(se(!0),de(ve,null,pe(me(v),e=>(se(),ie(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),be(me(m),{class:"!w-[240px]",placeholder:"请输入名称",onSearch:me(d)},null,8,["onSearch"])]),content:re(()=>[be(me(s))]),"footer-left":re(()=>[be(me(c))]),"footer-right":re(()=>[be(me(i))]),_:1})])}}}),On=e=>{var a;a="task",da.value=a,ia.value=e,Re(()=>{ra.value=!0})},Un={class:"mb-20px"},An={class:"w-320px"},Hn={class:"flex items-center"},Ln=s(le({__name:"form",props:ne({data:{default:null},refresh:{}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(e){const t=e,l=Fe(()=>E(()=>import("./index354.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),n=Le(t,"data"),o=oe(e,"show"),s=qe("editorRef"),i=ae(1),r=ae(""),u=()=>{o.value=!1},c=ae(!1),d=async(e=!1)=>{var a,t;if(n.value)try{e||(c.value=!0),await g({id:n.value.id,type:i.value,temp_name:r.value,render:JSON.stringify(null==(a=s.value)?void 0:a.getEmailData()),content:(null==(t=s.value)?void 0:t.getEmailHTML())||""},e)}finally{e||(c.value=!1)}},p=async()=>{await d(!0),u(),t.refresh()};return Ee(()=>{(async()=>{c.value=!0,await Re(),setTimeout(async()=>{var e;if(n.value)try{r.value=n.value.name;const{data:t}=await h({id:n.value.id});a(t)&&(null==(e=s.value)||e.setEmailData(t.render))}finally{setTimeout(()=>{c.value=!1},500)}},500)})()}),(e,a)=>{const t=Ae,n=Ue,o=He,i=Oe;return se(),de("div",null,[a[6]||(a[6]=he("div",{class:"mb-14px font-bold text-large text-default leading-28px"},"邮件模板编辑",-1)),be(o,{"label-position":"left"},{default:re(()=>[Ke("",!0),he("div",Un,[be(me(l),{ref_key:"editorRef",ref:s,save:d},null,512)]),be(t,{label:"模板名称","label-width":"50px"},{default:re(()=>[he("div",An,[be(n,{modelValue:me(r),"onUpdate:modelValue":a[1]||(a[1]=e=>ke(r)?r.value=e:null)},null,8,["modelValue"])])]),_:1})]),_:1}),he("div",Hn,[be(i,{onClick:u},{default:re(()=>[...a[4]||(a[4]=[ue("返回",-1)])]),_:1}),be(i,{type:"primary",loading:me(c),disabled:me(c),class:"ml-12px",onClick:p},{default:re(()=>[...a[5]||(a[5]=[ue(" 保存 ",-1)])]),_:1},8,["loading","disabled"])])])}}}),[["__scopeId","data-v-a8721274"]]),qn=["innerHTML"],$n=le({__name:"preview",props:{compData:{}},setup(e){const t=Le(e.compData,"row"),l=ae("");return(async()=>{const{data:e}=await h({id:t.value.id});if(a(e)){const a=Dl(e.render);a&&1===e.type?(l.value=a.content,await g({id:t.value.id,type:e.type,temp_name:e.name,render:JSON.stringify(a.render),content:a.content},!1)):l.value=e.content}})(),(e,a)=>(se(),de("div",{class:"min-h-600px overflow-auto",innerHTML:me(l)},null,8,qn))}}),In={class:"relative"},zn=le({__name:"index",setup(e){const l=ae(!1),n=ae(null),o=async()=>{const e="template_".concat(t(new Date,"yyyyMMddHHmmss")),{data:{data:o}}=await Z({temp_name:e,type:1});m(),a(o)&&(n.value=o,l.value=!0)},s=I([{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"确定删除选定项吗？",column:[{label:"模板名称",prop:"name"},ya()],onConfirm:async()=>{p({loading:"删除中...",message:!0,request:X({id:t.value.map(e=>e.id)}),success:()=>{m()}})}})}}]),{BtTable:i,BtPage:r,BtRefresh:u,BtColumn:c,BtBatch:d,refresh:m,BtSearch:v}=D({request:async e=>{const{data:a}=await Y({p:e.p,size:e.limit});return{data:a.data||[],total:a.total||0}},columns:[fa(),{prop:"name",label:"名称"},{prop:"created",label:"创建时间",render:e=>t(e.created)},va(e=>[{title:"创建任务",onClick:()=>{On(e.id)}},{title:"查看",onClick:()=>{f(e)}},{title:"编辑",onClick:()=>{y(e)}},{title:"删除",onClick:()=>{h(e)}}])],extension:[s]}),f=e=>{b({title:"查看【".concat(e.name,"】"),area:80,compData:{row:e},component:$n})},y=e=>{n.value=e,l.value=!0},h=e=>{k({title:"删除【".concat(e.name,"】"),content:"确定删除该模板吗？",onConfirm:async()=>{p({loading:"删除中...",message:!0,request:X({id:e.id}),success:()=>{m()}})}})};return(e,a)=>{const t=Oe,s=ma;return se(),de("div",In,[Ie(be(s,null,{"header-left":re(()=>[be(t,{type:"primary",onClick:o},{default:re(()=>[...a[1]||(a[1]=[ue("添加模板",-1)])]),_:1}),be(ta,{class:"ml-16px"})]),content:re(()=>[be(me(i))]),"footer-left":re(()=>[be(me(d))]),"footer-right":re(()=>[be(me(r))]),_:1},512),[[ze,!me(l)]]),me(l)?(se(),ie(Ln,{key:0,show:me(l),"onUpdate:show":a[0]||(a[0]=e=>ke(l)?l.value=e:null),data:me(n),refresh:me(m)},null,8,["show","data","refresh"])):Ke("",!0)])}}}),Pn=le({__name:"index",setup(e){const a=ae([{label:"概览",name:"overview",lazy:!0,render:()=>be(Ya,null,null)},{label:"发送任务",name:"task",lazy:!0,render:()=>be(en,null,null)},{label:"模板",name:"template",lazy:!0,render:()=>be(zn,null,null)},{label:"订阅者",name:"contact",lazy:!0,render:()=>be(Tn,null,null)},{label:"群组",name:"mail",lazy:!0,render:()=>be(Mn,null,null)},{label:"无效列表",name:"invalid",lazy:!0,render:()=>be(Sn,null,null)}]),t=e=>{ra.value=!1,ia.value=null};return(e,l)=>{const n=ee;return se(),de("div",null,[be(n,{type:"card",options:me(a),modelValue:me(da),"onUpdate:modelValue":l[0]||(l[0]=e=>ke(da)?da.value=e:null),onChange:t},null,8,["options","modelValue"])])}}}),Fn=Object.freeze(Object.defineProperty({__proto__:null,default:Pn},Symbol.toStringTag,{value:"Module"}));export{hl as A,gl as B,Rl as C,bt as D,Tt as E,_l as F,xl as G,wl as H,$t as I,El as J,Vl as K,Lt as L,sl as M,Fn as N,Bt as a,It as b,ol as c,ht as d,Ht as e,yl as f,Tl as g,bl as h,ul as i,Bl as j,Ot as k,Rt as l,kl as m,Vt as n,kt as o,Ct as p,jt as q,Et as r,ml as s,Mt as t,Wt as u,Dt as v,cl as w,St as x,At as y,fl as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
