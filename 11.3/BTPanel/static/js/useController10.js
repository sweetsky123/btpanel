import{Q as a,M as e,aK as t,aA as s,W as l,u as n,R as r,ak as o,p as i,P as c,_ as u,ag as g,b3 as d,e$ as m,f0 as p,V as y,b as v,f1 as h,f2 as f,x as w,n as b,l as S,f3 as L,bR as k,H as T,f4 as _,f5 as x,f6 as q}from"./utils-lib.js?v=1763689792";import{_ as P}from"./index130.js?v=1763689792";import{j as F,s as C,r as D,W as E,g as O,o as M,c as A,w as R,x as V,y as j,A as I,O as B,z as H,R as N,G as W,M as J,F as z,b1 as K,e as Y,C as G,D as U,L as $,N as Q,ay as X,B as Z,v as aa,H as ea,ba as ta,J as sa,I as la}from"./base-lib.js?v=1763689792";import{_ as na}from"./index123.js?v=1763689792";import{d as ra,e as oa,f as ia,h as ca,s as ua,i as ga,j as da,k as ma,l as pa,m as ya,n as va,o as ha,p as fa,u as wa,L as ba,q as Sa,t as La,v as ka,w as Ta,x as _a,y as xa,z as qa,A as Pa,B as Fa,C as Ca,D as Da,E as Ea,F as Oa,G as Ma,H as Aa,I as Ra,J as Va}from"./useStore7.js?v=1763689792";import{_ as ja}from"./index109.js?v=1763689792";import{a as Ia,u as Ba,c as Ha}from"./column.js?v=1763689792";import{L as Na}from"./useStore8.js?v=1763689792";import{e as Wa}from"./validator.js?v=1763689792";var Ja=function(a){return a.TamperProof="网站防篡改",a.Syssafe="宝塔系统加固",a.Security="堡塔防入侵",a.TamperProofRefactored="网站防篡改程序-重构版",a}(Ja||{});const za=F("LOG-SOFT-STORE",()=>{const n=D([]),r=D(""),o=D(),i=D([]),c=D(""),u=D(""),g=D(""),d=D("login"),m=D("");Ja.TamperProof,Ja.Syssafe,Ja.Security,Ja.TamperProofRefactored;const p=async e=>{try{const{data:t}=await a({loading:"正在获取日志数据，请稍后...",request:ya({data:JSON.stringify({name:"syssafe",search:e.search,ROWS:e.ROWS})})});return{data:t.msg.data,total:t.total||s(t.msg.page),other:{}}}catch(l){return t(l),{total:0,data:[],other:{}}}},y=async e=>{try{const t=await a({loading:"正在获取日志数据，请稍后...",request:va({data:JSON.stringify({name:"bt_security",search:e.search,ROWS:e.ROWS})}),data:{"msg.data":[Array,a=>({data:a})],"msg.page":l()}});return{data:t.data,total:t.total,other:{}}}catch(t){return{total:0,data:[],other:{}}}},v=D("mysqlSlow"),h=D([]),f=async a=>{try{return{data:(await ha({data:JSON.stringify({limit:"5000",search:a})})).data.msg,status:!0,msg:""}}catch(e){return t(e),{status:!1,data:"",msg:"获取日志数据失败"}}},w=async(a,e)=>{try{return{data:(await fa({screening:h.value.length?h.value.join(","):"",keywords:a||""})).data,status:!0,msg:""}}catch(s){return t(s),{status:!1,data:"",msg:"获取日志数据失败"}}};return{menuOptions:n,currentName:r,searchValue:m,phpData:i,phpChecked:c,logsMsg:u,logPath:g,getMenuList:async()=>{try{const e=a=>a.map(a=>({name:a,id:a}));return{data:await a({loading:"正在获取日志菜单，请稍后...",request:ra(),data:[Array,e],success:a=>{var e;n.value=a,r.value=null==(e=a[0])?void 0:e.name}}),status:!0}}catch(e){return{status:!1,data:[],msg:"获取日志菜单失败"}}},getSoftLog:async(e="")=>{try{const t="Php"===r.value?oa:ia;return{...(await a({loading:"正在获取日志数据，请稍后...",request:t({data:JSON.stringify({name:r.value,search:e})})})).data}}catch(t){return{status:!1,data:[],msg:"获取日志数据失败"}}},ftpType:d,getFtpMenu:async()=>{try{const{data:e,status:t}=await a({loading:"正在获取FTP用户名,请稍后...",request:ma({p:1,limit:99999,search:"",table:"ftps"}),data:{data:Array}});return{data:e,status:t,msg:"获取用户成功"}}catch(e){return{status:!1,data:[],msg:"获取用户失败"}}},getFtpLogStatus:async()=>{const a=e.load("正在获取FTP日志状态，请稍后...");try{const{status:a,msg:e}=await ua({exec_name:"getlog"});return{status:a,data:e}}catch(s){return t(s),{status:!1,data:"获取FTP日志状态失败"}}finally{a.close()}},startFtpLog:async()=>{const a=e.load("正在开启FTP服务，请稍后...");try{const{status:a,msg:e}=await ua({exec_name:"start"});return{status:a,msg:e}}catch(s){return t(s),{status:!1,msg:"开启FTP服务失败"}}finally{a.close()}},getFtpLogData:async e=>{try{const t=await a({loading:"正在获取FTP日志,请稍后...",request:ga(e),data:{data:Array,page:String}});return Array.isArray(null==t?void 0:t.data)?{data:t.data,total:s(t.page),other:{}}:{total:0,data:[],other:{}}}catch(l){return t(l),{total:0,data:[],other:{}}}},getFtpActionLog:async e=>{try{const t=await a({loading:"正在获取FTP操作日志,请稍后...",request:da(e),data:{data:Array,page:String}});return Array.isArray(null==t?void 0:t.data)?{data:t.data,total:s(t.page),other:{}}:{total:0,data:[],other:{}}}catch(t){return{total:0,data:[],other:{}}}},renderSysSecurityLog:y,renderSysSafeLog:p,getPluginLogData:async e=>{try{let t=null;if("Docker"===r.value){const{data:l}=await a({request:pa(e)});t=l,t.total=s(l.page)}else r.value===Ja.Syssafe?t=await p(e):r.value===Ja.Security&&(t=await y(e));return{data:t.data,total:t.total,other:{}}}catch(l){return t(l),{total:0,data:[],other:{}}}},mysqlActive:v,checkList:h,getErrorMysqlData:w,getMysqlLogsData:f,handleMysqlTabClick:a=>{var e;return"mysqlSlow"===a||"mysqlSlow"===(null==(e=a.props)?void 0:e.name)?f():w()},delMysqlAllLogEvent:async()=>{try{let e={type:2,assort:"mysqlSlow"===v.value?"slow":"error"};return await a({loading:"正在清空日志,请稍候...",request:ca(e),message:!0}),{status:!0,msg:"清空日志成功"}}catch(e){return{status:!1,msg:"清空日志失败"}}},delAllLogDataEvent:async()=>{let e={type:1,path:g.value};return await a({loading:"正在清空日志,请稍候...",request:ca(e),message:!0})},delSoftLogEvent:async e=>{try{return await a({loading:"正在删除日志,请稍候...",request:ca({type:0,id:e.id}),message:!0,success:o.value}),{status:!0,msg:"删除日志成功"}}catch(t){return{status:!1,data:[],msg:"删除日志失败"}}},refreshPlugin:o}}),{payment:Ka}=n(),{currentName:Ya,logsMsg:Ga,phpChecked:Ua,phpData:$a,mysqlActive:Qa,ftpType:Xa,logPath:Za,refreshPlugin:ae}=(()=>{const a=za();return C(a)})(),{getSoftLog:ee,getFtpMenu:te,getFtpLogStatus:se,startFtpLog:le,getFtpActionLog:ne,getFtpLogData:re,delMysqlAllLogEvent:oe,delAllLogDataEvent:ie,getMysqlLogsData:ce,getErrorMysqlData:ue,delSoftLogEvent:ge}=za(),de=["Docker","宝塔系统加固","堡塔防入侵"],me={title:"FTP日志-功能介绍",ps:"记录FTP登录记录，FTP上传、下载、重命名和删除记录.",source:131,desc:["FTP登录记录","FTP上传记录","FTP重命名记录","FTP删除记录"],tabImgs:[{title:"FTP日志",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/logs/ftp-logs.png"}]},pe=D(!0);E();const ye=D(""),ve=D(""),he=D([]),fe=D(!1),we=async(a,e)=>{const{selectedItem:t}=wa();if(Ya.value=a.name,t.value=a.name,ye.value="",de.includes(a.name))return ae.value&&ae.value();if("Mysql"===a.name);else if("FTP"!==a.name)return await be(a)},be=async(a,e)=>{Ya.value=a.name;const t=await ee(e);if("Php"===Ya.value)r(t)?$a.value=t:$a.value=Object.values(t),$a.value=$a.value.filter(a=>a.status),""===Ua.value&&(Ua.value=$a.value[0].version),Le(Ua.value);else if(o(t)){const a=t;Za.value=(null==a?void 0:a.file)||"",Ga.value=(null==a?void 0:a.msg)||"暂无数据"}return t},Se=async a=>{await i({title:"清空日志【".concat(Ya.value,"】"),icon:"warning-filled",type:"calc",content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),await ie(),be({name:Ya.value})},Le=a=>{var e;null==(e=$a.value)||e.forEach(e=>{e.version==a&&(Ga.value=e.msg,Za.value=e.file)})},ke=()=>window.open("/download?filename="+Za.value,"_blank","noopener,noreferrer"),Te=async a=>{if("ltd"!==Ka.value.authType)return{data:[],total:0,other:{}};pe.value&&(await(async()=>{var a;if("ltd"!==Ka.value.authType)return;const{data:e}=await te();he.value=e.map(a=>({label:a.name,value:a.name,key:a.id})),ve.value=(null==(a=e[0])?void 0:a.name)||""})(),pe.value=!1);try{if(!(await(async()=>{if("stop"===(await se()).data){await i({title:"FTP服务",content:"FTP服务未启动，无法获取日志,是否立即开启FTP服务?"});const a=await le();return e.request(a),fe.value=!0,!1}return!0})()))return{data:[],total:0,other:{}};const t={...a};if(t.user_name=ve.value,delete t.ftpType,"login"===a.ftpType)return await re(t);if("action"===a.ftpType)return await ne(t)}catch(t){return{data:[],total:0,other:{}}}};var _e=function(a){return a.TamperProof="网站防篡改",a.Syssafe="宝塔系统加固",a.Security="堡塔防入侵",a.TamperProofRefactored="网站防篡改程序-重构版",a}(_e||{});_e.TamperProof,_e.Syssafe,_e.Security,_e.TamperProofRefactored;const xe=async a=>{await i({title:"删除日志【".concat(Ya.value,"】"),type:"calc",content:"风险操作，删除该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),ge(a)},qe=[{label:"Mysql慢日志",value:"mysqlSlow"},{label:"Mysql错误日志",value:"mysqlError"}],Pe=[{label:"删除",value:"delete",event:async(a,e)=>{const t=async a=>await ca({type:0,id:a.id});await a({title:"批量删除",content:"即将删除所选中的日志，是否继续操作?",column:[{prop:"log",label:"日志内容"},Ha()],onConfirm:async()=>(await e(t),ae.value(),!1)})}}],Fe=()=>[Ia(),{label:"用户",prop:"username"},{label:"详情",prop:"log"},{label:"操作时间",prop:"addtime",align:"right"},Ba([{title:"删除",onClick:xe}])],Ce=O(()=>"宝塔系统加固"===Ya.value?()=>Fe().slice(1):()=>Fe()),De=D(""),Ee=[{label:"警告",value:"warning"},{label:"错误",value:"error"},{label:"记录",value:"note"}],Oe=async()=>{await i({title:"清空日志【Mysql".concat("mysqlSlow"===Qa.value?"慢日志":"错误日志","】"),icon:"warning-filled",content:"您真的要清空所有【Mysql".concat("mysqlSlow"===Qa.value?"慢日志":"错误日志","】吗？")}),await oe(),Me()},Me=async a=>{let e=null;"mysqlSlow"===Qa.value&&(e=await ce(a)),"mysqlError"===Qa.value&&(e=await ue(a)),De.value=e.data||"暂无数据"},Ae=async({props:a})=>{Qa.value=a.name,Me("")},Re=["Mysql","FTP","Docker","宝塔系统加固","堡塔防入侵"],Ve=O(()=>Re.includes(Ya.value)),je=F("LOG-SITE-STORE",()=>{const l=ba(),{selectedWebSite:n}=C(l),r=D(!1),o=D(!1),i=D(),c=D(!1),u=D(""),g=M({ipArea:!1,typeValue:"access",timeValue:"",searchValue:"",keywordSwitch:!1,keywordConfig:{}}),d=D(),m=M({give:"",keyword:"",cycle:""}),p=D(!1),y=D(!1),v=D(),h=D(),f=D(!1),w=M({site:[]}),b=D(!1),S=D(),L=D([]),k=M({ip:"",id:0,port:""}),T=async()=>{var a,e;try{const{data:t}=await xa({sitename:n.value});return g.keywordConfig=t.config,m.give=null==(a=g.keywordConfig.channel)?void 0:a.split(",").filter(a=>""!==a),m.keyword=null==(e=g.keywordConfig.keys)?void 0:e.join(","),m.cycle=g.keywordConfig.cycle,g.keywordSwitch=t.status,{data:{...m},status:!0}}catch(s){return t(s,"getKeywordAlarmData"),{msg:"获取关键字告警配置失败",status:!1}}};D([]);const _=async()=>{try{const e=await a({loading:p,request:Ma(),data:Array});return{data:e,total:e.length,other:{}}}catch(e){return{data:[],total:0,other:{}}}};return{siteList:i,getSiteList:async()=>{try{return{data:(await a({loading:"正在获取网站列表，请稍后...",request:Sa(),data:{msg:[Array,a=>{i.value=a,n.value=i.value[0]||""}]}})).msg,status:!0}}catch(e){return{msg:"获取网站列表失败 ",status:!1}}},logParams:g,preLoading:c,logMsg:u,logScanForm:d,msgForm:m,getSiteLogsData:async e=>{if(n.value)try{const t=await a({loading:c,request:"error"===g.typeValue?Ta(e):_a(e),data:{msg:String}});return u.value=(null==t?void 0:t.msg)||"暂无数据",{data:t.msg||"暂无数据",status:!0}}catch(s){t(s,"getSiteLogsData")}},setKeyWordConfigEvent:async e=>{try{return await a({loading:"正在设置关键字告警...",request:qa(e),message:!0}),{status:!0,msg:"设置关键字告警成功"}}catch(t){return{status:!1,msg:"设置关键字告警失败"}}},clearWebLogEvent:async(e,t)=>{try{const s=await a({loading:"正在清理日志中，请稍后....",request:La({siteName:n.value,logType:t,time_search:JSON.stringify(e)}),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{msg:"清理失败",status:!1}}},outWebLogEvent:async(e,t)=>{try{const s=await a({loading:"正在导出日志中，请稍后....",request:ka({siteName:n.value,logType:t,time_search:JSON.stringify(e)}),data:{msg:String,status:Boolean}});return s.status&&window.open("/download?filename="+s.msg,"_blank","noopener,noreferrer"),{status:s.status,msg:"导出".concat(s.status?"成功":"失败"),data:s.msg}}catch(s){return{msg:"导出失败",status:!1}}},getKeywordAlarmData:T,getScanData:async()=>{try{const{data:e}=await a({loading:"正在获取关键字告警配置，请稍后...",request:xa({sitename:n.value})});return m.cycle=e.config.cycle,m.keyword=e.config.keys.join(","),""!=e.config.channel&&(m.give=e.config.channel.split(",")),{data:m,status:!0}}catch(e){return{msg:"获取关键字告警配置失败",status:!1}}},tableLoading:p,getOperateLog:async e=>{try{if(!n.value)return;e.search||(e.search=n.value);const t=await a({loading:p,request:Pa({data:JSON.stringify(e)}),data:{data:Array,page:String}});return{data:t.data,total:s(t.page),other:{}}}catch(t){return{data:[],total:0,other:{}}}},outLogs:async()=>{try{const a=await Fa({search:n.value});return window.open("/download?filename="+a.data.output_file,"_blank","noopener,noreferrer"),{status:!0,msg:"导出成功"}}catch(a){return{status:!1,msg:"导出失败"}}},sForm:h,logSysForm:S,sendSource:f,logSystemDialog:b,logSystemForm:k,sourceForm:w,logSystemData:v,logSystemLoad:y,logSystemList:L,getLogSystemData:_,getLogSystemSite:async()=>{try{return await a({loading:"正在获取日志服务系统配置中,请稍后...",request:Aa(),data:[Array,L]}),L.value.length>0&&(k.ip=L.value[0].ip,k.port=L.value[0].port,k.id=L.value[0].id),{data:L.value,status:!0}}catch(e){return{msg:"获取日志服务系统配置失败",status:!1}}},logSystemConfirm:async e=>{try{return await a({loading:"正在设置日志系统配置中...",request:e.server_id?Da(e):Ea(e),message:!0}),{status:!0,msg:"设置成功"}}catch(t){return{status:!1,msg:"设置失败"}}},sendSourceConfirm:async t=>{try{const s=await a({loading:"正在设置日志源中...",request:Oa(t)});return e.request(s.data[0]),f.value=!1,s}catch(s){return{status:!1,msg:"设置失败"}}},delLogSourceEvent:async e=>{try{return await a({loading:"正在删除日志源，请稍候...",request:Ca(e),message:!0,success:_}),{status:!0,msg:"删除成功"}}catch(t){return{status:!1,msg:"删除失败"}}},onConfirmKeyConfig:async e=>{try{return await a({loading:"正在设置关键字告警配置，请稍后...",request:qa(e),message:!0}),{status:!0,msg:"设置关键字告警成功"}}catch(t){return{status:!1,msg:"设置关键字告警失败"}}},isRefreshLogSystem:o,isRefreshList:r}}),Ie=()=>C(je()),{selectedItem:Be}=wa(),He=a=>{let e=[];const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()/1e3,l=Math.floor((new Date).getTime()/1e3);switch(a){case"7":e=[s-604800,l];break;case"30":e=[s-2592e3,l];break;case"180":e=[s-15552e3,l]}return e},Ne=async(a,e)=>{switch(a){case"ssh":Na().outLogs(e);break;case"login":Ra().outLoginLogEvent(e);break;case"crontab":Ra().outShellLogEvent(e);break;case"website":const a=He(e.day);je().outWebLogEvent(a,e.type)}},We=(a,t)=>{const s="crontab"===t?"id":"name";((a,e)=>{switch(e){case"soft":be(a);break;case"crontab":Kt(a)}})(a.find(a=>String(a[s])===Be.value),t),e.success("刷新成功")},Je=a=>Wa({type:22,name:"日志",id:999,...a}),ze={class:"flex items-start w-full"},Ke=["onClick","tabindex"],Ye={key:2,class:"menu p-[20px] bg-[#f1f1f120]"},Ge={class:"flex-1"},Ue={class:"log-view"},$e={class:"flex items-center"},Qe=u(A({__name:"index",props:{menuOptions:{default:()=>[]},logsType:{default:"pre"},width:{default:"24"},height:{default:"68"},logContent:{default:""}},emits:["tab-click","search"],setup(a,{emit:e}){const{mainHeight:t}=n(),s=a,l=e,r=ba(),{searchValue:o,selectedItem:i}=C(r),u=O(()=>"Mysql"===s.logsType?t.value-300:"crontab"===s.logsType?t.value-248:t.value-188),g=O(()=>"crontab"===s.logsType?"id":"name");return R(()=>s.menuOptions[0],a=>{a&&(i.value=String(a[g.value]))},{once:!0}),(e,t)=>{const s=c,n=X,r=na;return V(),j("div",ze,[I("div",{class:$("flex flex-col mr-[16px]"),style:J("width:".concat(a.width,"rem;"))},["crontab"==a.logsType?(V(),B(s,{key:0,class:"mb-[8px] !w-[24rem]",modelValue:H(o),"onUpdate:modelValue":t[0]||(t[0]=a=>N(o)?o.value=a:null),onSearch:H($t),placeholder:"请输入日志名称"},null,8,["modelValue","onSearch"])):W("",!0),a.menuOptions.length>0?(V(),j("div",{key:1,class:"menu",style:J("height:".concat(H(u)-("crontab"==a.logsType?56:-5),"px;min-height:400px"))},[(V(!0),j(z,null,K(a.menuOptions,(e,t)=>(V(),j("span",{onClick:a=>l("tab-click",e),tabindex:t,key:t,style:J("width:".concat(a.width,"rem")),class:$("menu-hover ".concat(String(e[H(g)])===H(i)?"activeClass":""))},Z(e.tabProps)+" "+Z(e.name),15,Ke))),128))],4)):(V(),j("span",Ye,[Y(n,null,{image:G(()=>[...t[2]||(t[2]=[I("i",{class:"svgtofont-empty !text-[4.8rem] text-#999"},null,-1)])]),description:G(()=>[...t[3]||(t[3]=[U("暂无数据",-1)])]),_:1})]))],4),Q(e.$slots,"LogView",{},()=>[I("div",Ge,[I("div",Ue,[I("div",$e,[Q(e.$slots,"LogLeft",{},void 0,!0),I("div",{class:"flex items-center",onClick:t[1]||(t[1]=a=>H(Je)())},[...t[4]||(t[4]=[I("i",{class:"svgtofont-desired text-medium"},null,-1),I("span",{class:"bt-link"},"需求反馈",-1)])])]),Q(e.$slots,"LogRight",{},void 0,!0)]),Y(r,{class:"w-full flex-1",content:a.logContent,isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-日志",onRefresh:()=>{H(We)(a.menuOptions,a.logsType)}},style:J("height:"+H(u)+"px;min-height:400px")},null,8,["content","fullScreen","style"])])],!0)])}}}),[["__scopeId","data-v-47ceb292"]]),Xe={class:"flex items-center"},Ze={key:0,class:"flex items-center inline-block"},at=A({__name:"crontab-log",setup(a){const{mainHeight:e}=n(),t=Ra(),{logsMsg:s,currentItem:l,crontabForm:r}=C(t);return aa(async()=>{await $t(),await Kt(Ct.value[0])}),(a,t)=>{const n=ea,o=g,i=ta,c=P;return V(),j("div",{class:"flex items-start",style:J({height:H(e)-195+"px",minHeight:"400px"})},[Y(Qe,{logsType:"crontab","menu-options":H(Ct),logContent:H(s),onTabClick:H(Kt),onSearch:H($t)},{LogLeft:G(()=>[Y(n,{class:"!mr-[12px]",onClick:t[0]||(t[0]=a=>H(Yt)(H(l)))},{default:G(()=>[...t[7]||(t[7]=[U(" 清理日志 ",-1)])]),_:1}),H(Dt)?(V(),B(n,{key:0,onClick:H(Ut)},{default:G(()=>[...t[8]||(t[8]=[U(" 导出日志 ",-1)])]),_:1},8,["onClick"])):W("",!0)]),LogRight:G(()=>[I("div",Xe,[H(Dt)?(V(),j("div",Ze,[Y(o,{class:"mr-[12px]",type:"button",onChange:t[1]||(t[1]=a=>H(Kt)(H(l))),modelValue:H(r).type,"onUpdate:modelValue":t[2]||(t[2]=a=>H(r).type=a),options:H(zt)},null,8,["modelValue","options"]),Y(i,{modelValue:H(r).time_search,"onUpdate:modelValue":t[3]||(t[3]=a=>H(r).time_search=a),format:"YYYY/MM/DD","value-format":"x",onChange:t[4]||(t[4]=a=>H(Kt)(H(l))),onClear:t[5]||(t[5]=a=>H(Kt)(H(l))),type:"daterange",placement:"bottom-end","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])):W("",!0),Y(c,{class:"ml-8px",onRefresh:t[6]||(t[6]=a=>H(Kt)(H(l)))})])]),_:1},8,["menu-options","logContent","onTabClick","onSearch"])],4)}}}),et={class:"flex items-center"},tt={class:"ml-1rem"},st=A({__name:"login-log",setup(a){n();const e=Ra(),{getLoginLogsEvent:t}=e,s=v(),{BtOperation:l}=d({options:[{label:"刷新日志",type:"button",onClick:async()=>{await u(),s.success("刷新成功")}},{label:"导出日志",type:"button",onClick:()=>{Wt(h.data)}},{label:"清空日志",type:"button",onClick:()=>{Nt(u)}}]}),r=m({options:Ot,key:"login_type"}),{BtTable:o,BtSearch:i,BtPage:c,refresh:u,BtRadioButton:g,config:h}=p({request:a=>{const{p:e,...s}=a;return t({page:e,...s})},columns:[{label:"IP地址（归属地）",prop:"remote_addr",minWidth:100,render:a=>{var e;return Y("span",null,[a.remote_addr,U("("),(null==(e=null==a?void 0:a.area)?void 0:e.info)||"",U(")")])}},{label:"用户代理",width:800,prop:"user_agent"},{label:"登录状态",render:a=>Y("span",{class:"text-".concat(a.login_type?"primary":"danger")},[U("登录"),a.login_type?"成功":"失败"])},{label:"时间",width:150,prop:"login_time",sortable:!0,align:"right",render:a=>y(a.login_time)}],extension:[r]});return(a,e)=>{const t=ja;return V(),B(t,null,{"header-left":G(()=>[I("div",et,[Y(H(l)),I("div",{class:"flex items-center ml-1rem",onClick:e[0]||(e[0]=a=>H(Je)())},[...e[1]||(e[1]=[I("i",{class:"svgtofont-desired text-medium"},null,-1),I("span",{class:"bt-link"},"需求反馈",-1)])])])]),"header-right":G(()=>[Y(H(g)),I("div",tt,[Y(H(i),{class:"w-[32rem]",placeholder:"请输入搜索关键字"})])]),content:G(()=>[Y(H(o),{onSortChange:H(Ht)},null,8,["onSortChange"])]),"footer-right":G(()=>[Y(H(c))]),_:1})}}}),lt={class:"flex items-center"},nt=A({__name:"operate-log",setup(a){n();const t=v(),{BtOperation:s}=d({options:[{type:"button",label:"刷新日志",onClick:async()=>{await c(),t.success("刷新成功")}},{type:"button",label:"导出日志",onClick:()=>{if(!m.data.length)return e.error("暂无数据导出");Rt({search:g.value.search})}},{type:"button",label:"清空日志",onClick:()=>jt(c)},{type:"button",label:"IP操作统计",onClick:Bt}]}),l=h({options:Mt,key:"log_type",other:{placeholder:"请选择分类",filterable:!0,class:"!w-16rem mr-1rem "}}),{BtTable:r,BtSearch:o,BtPage:i,refresh:c,BtTableSelect:u,param:g,config:m}=p({request:a=>Vt({...a,table:"logs"}),columns:[{label:"用户",prop:"username",width:180},{label:"操作类型",prop:"type",width:100,sortable:!0},{label:"详情",render:function(a){const e=(new DOMParser).parseFromString(a.log,"text/html");return Y("span",{innerHTML:f(e.body.innerHTML)},null)}},{label:"操作时间",width:150,prop:"addtime",align:"right",sortable:!0}],extension:[l]});return(a,e)=>{const t=ja;return V(),B(t,null,{"header-left":G(()=>[I("div",lt,[Y(H(s)),I("div",{class:"flex items-center ml-1rem",onClick:e[0]||(e[0]=a=>H(Je)())},[...e[1]||(e[1]=[I("i",{class:"svgtofont-desired text-medium"},null,-1),I("span",{class:"bt-link"},"需求反馈",-1)])])])]),"header-right":G(()=>[Y(H(u)),Y(H(o),{class:"!w-[28rem]",placeholder:"请输入搜索关键字"})]),content:G(()=>[Y(H(r))]),"footer-right":G(()=>[Y(H(i))]),_:1})}}}),rt={class:"flex items-center justify-between mb-[12px]"},ot={class:"flex items-center"},it={class:"ml-[1.6rem]"},ct={class:"inline-flex items-center"},ut=A({__name:"run-log",setup(a){const{mainHeight:e}=n(),t=Ra(),{search:s,logMsg:l,size:r}=C(t),{getRunDataEvent:o}=t,i=v(),{BtOperation:u}=d({options:[{label:"刷新日志",type:"button",onClick:async()=>{await o(),i.success("刷新成功")}},{label:"清空日志",type:"button",onClick:()=>Jt()}]});return aa(o),(a,t)=>{const n=c;return V(),j("div",null,[I("div",rt,[I("div",ot,[Y(H(u)),I("span",it,"日志大小："+Z(H(w)(H(r))),1),I("div",{class:"flex items-center ml-1rem",onClick:t[0]||(t[0]=a=>H(Je)())},[...t[2]||(t[2]=[I("i",{class:"svgtofont-desired text-medium"},null,-1),I("span",{class:"bt-link"},"需求反馈",-1)])])]),I("div",ct,[Y(n,{modelValue:H(s),"onUpdate:modelValue":t[1]||(t[1]=a=>N(s)?s.value=a:null),onSearch:H(o),placeholder:"请输入搜索关键字",class:"!w-[30rem]"},null,8,["modelValue","onSearch"])])]),Y(na,{content:H(l),isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-运行日志",onRefresh:H(o)},style:J("height:".concat(H(e)-240,"px;min-height:40rem"))},null,8,["content","fullScreen","style"])])}}}),{getLogsMenu:gt,outWebSiteEvent:dt,getLogsInfoEvent:mt,clearRunLogsEvent:pt,clearOpLogsEvent:yt,getLogsDataEvent:vt,clearShellLogEvent:ht,outShellLogEvent:ft,getIpDataEvent:wt,outLoginLogEvent:bt,clearLoginLogEvent:St}=Ra(),{clearDataForm:Lt,outDataForm:kt,configData:Tt,selectedItem:_t}=wa(),{currentItem:xt,isRefreshList:qt,crontabForm:Pt}=Va(),Ft=ba(),Ct=D([]),Dt=D(!1),Et=[{label:"操作日志",name:"operateLog",render:()=>Y(nt,null,null)},{label:"登录日志",name:"loginLog",lazy:!0,render:()=>Y(st,null,null)},{label:"运行日志",name:"runLog",lazy:!0,render:()=>Y(ut,null,null)},{label:"计划任务日志",name:"crontabLog",lazy:!0,render:()=>Y(at,null,null)}],Ot=[{label:"全部",value:""},{label:"登录成功",value:"1"},{label:"登录失败",value:"0"}],Mt=[{label:"全部",value:"全部"},{label:"网站管理",value:"网站管理"},{label:"用户登录",value:"用户登录"},{label:"数据库管理",value:"数据库管理"},{label:"FTP管理",value:"FTP管理"},{label:"文件管理",value:"文件管理"},{label:"安装器",value:"安装器"},{label:"软件管理",value:"软件管理"},{label:"守护程序",value:"守护程序"},{label:"面板设置",value:"面板设置"},{label:"进程管理",value:"进程管理"},{label:"面板配置",value:"面板配置"},{label:"PHP配置",value:"PHP配置"},{label:"计划任务",value:"计划任务"},{label:"防火墙管理",value:"防火墙管理"}],At=a=>{},Rt=async({search:a},e)=>{a&&await i({title:"导出日志",icon:"warning-filled",content:"是否导出关键字为【".concat(a,"】的面板操作日志？")});const t=await dt(a);window.open("/download?filename="+t.data.output_file,"_blank","noopener,noreferrer")},Vt=async a=>{try{const e=a;return e.search||delete e.search,"全部"===e.log_type&&(e.log_type=""),await mt(e)}catch(e){return{data:[],total:0,other:{}}}},jt=async a=>{await i({icon:"warning-filled",type:"input",title:"清空面板操作日志",input:{content:"清空日志"},content:"风险操作，清空该日志后，将无法查询面板以往的操作记录，是否继续操作？"});const e=await yt();a&&a(e)},It=[{label:"IP地址",prop:"ip"},{label:"IP属地",prop:"info"},{label:"操作次数",prop:"operation_num"}],Bt=async()=>{const{data:a}=await wt();a.sort((a,e)=>e.operation_num-a.operation_num),b({title:"IP操作统计",area:60,component:()=>Y("div",{class:"p-20px"},[sa(Y(S,{"max-height":"360",column:It,data:a},null),[[la("bt-loading"),"ipLoading"],[la("bt-loading"),"'正在加载表格数据,请稍后...'","title"]])])})},Ht=({column:a,prop:e,order:t},s)=>{const l=L((n=e,"ascending"===t?_(x(n)):q(x(n))),s);var n;return{data:l,total:l.length,other:{}}},Nt=async a=>{try{await i({icon:"warning-filled",type:"input",title:"清空面板登录日志",input:{content:"清空日志"},content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),await St(),qt.value=!0,a&&a()}catch(e){}},Wt=async a=>{if(0===a.length)return e.error("暂无数据导出");kt.value.type=Ft.getType("login"),Tt.value={type:"login"},b({title:"导出日志",area:44,component:()=>T(()=>import("./index303.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Jt=async a=>(await i({icon:"warning-filled",title:"清空面板运行日志",type:"calc",content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),await pt()),zt=[{label:"全部",value:""},{label:"异常",value:"warring"}],Kt=async a=>{try{if(!k(a,"object",!1,null,!0))return e.error("当前未选定日志数据");xt.value=a,_t.value=String(a.id),Dt.value="webshell"===a.sType;const{type:t,time_search:s}=Pt.value;let l=[];const n=s;r(n)&&n.length&&(l=[n[0]/1e3,n[1]/1e3]);const o={type:t,id:a.id,time_search:JSON.stringify(l)},{status:i,msg:c}=await vt(o);i||e.error(c)}catch(t){return{data:"获取日志错误!",status:!1}}},Yt=async a=>{b({title:"清理【"+a.name+"】日志",area:44,component:()=>T(()=>import("./index348.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{tips:"",type:"crontab",clearEvent:()=>Gt()},showFooter:!0})},Gt=async a=>{const{day:e}=Lt.value;await i({icon:"warning-filled",type:"calc",title:"清空日志",content:"清空".concat("all"!==e?e+"天外":"","日志后，将无法查询").concat("all"!==e?e+"天外":"","日志记录，此操作不可逆，是否继续清理？")});const t=await ht({id:xt.value.id,day:"all"===e?"":e});return qt.value=!0,t},Ut=async()=>{kt.value.type=ba().getType("crontab"),Tt.value={type:"crontab"},b({title:"导出日志",area:44,component:()=>T(()=>import("./index303.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{type:"crontab"},showFooter:!0})},$t=async a=>{const e=await gt(a);Ct.value=e.data};export{we as A,Qe as B,Ne as C,je as L,Pe as T,Je as a,pe as b,At as c,He as d,ve as e,he as f,za as g,Me as h,fe as i,qe as j,Oe as k,Ee as l,De as m,Ae as n,Ce as o,me as p,be as q,Te as r,ye as s,Et as t,Ie as u,Ve as v,de as w,ke as x,Se as y,Le as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
