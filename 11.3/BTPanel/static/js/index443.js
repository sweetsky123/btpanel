import{c as e,r as s,o as a,v as r,x as t,y as l,e as i,C as p,z as o,O as n,G as d,S as c,c1 as _,ad as u,ab as m}from"./base-lib.js?v=1763689792";import{k as g}from"./utils-lib.js?v=1763689792";import{t as h}from"./useController3.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const f={class:"p-2rem"},v=e({__name:"index",props:{compData:{default:()=>({})}},setup(e,{expose:v}){const y=e,b=s(),j=s(!1),x=s(),C=a({run_script_id:"",script:"",args:""}),k=a({is_args:"",args_holder:"",args_title:""}),V={label:"name",value:"script_id",children:"script_list"},w=a({run_script_id:[{required:!0,message:"请选择脚本",trigger:"change"}],args:[{required:!0,message:"请输入值",trigger:"blur"}]}),A=s(""),D=s([]),q=e=>{let s=x.value.getCheckedNodes()[0].data;C.script=s.script,1===s.is_args?(k.is_args=!0,k.args_holder=s.args_ps,k.args_title=s.args_title):k.is_args=!1};return r(async()=>{try{const e=await h();if("python"===y.compData.type){const s=[];Array.isArray(e)&&e.forEach(e=>{"自定义"===e.name&&e.script_list.length>0?s.push({script_id:e.script_id,name:e.name,script_list:e.script_list.filter(e=>"python"===e.script_type)}):"服务管理"!==e.name&&e.script_list.length>0&&s.push(e)}),D.value=s.reverse()}else D.value=Array.isArray(e)?e.filter(e=>"服务管理"==e.name):[]}catch(e){}}),v({onConfirm:async e=>{await b.value.validate(),A.value=""!==A.value?A.value+"\n"+C.script:C.script,-1!==C.script.indexOf("php_version")&&(A.value=A.value.replace("${1/./}",C.args)),y.compData.onConfirm({scriptText:A.value,args:C.args}),e()}}),(e,s)=>{const a=_,r=u,h=g,v=m;return t(),l("div",f,[i(v,{ref_key:"taskEvent",ref:b,disabled:o(j),"label-width":"80px",model:o(C),rules:o(w),onSubmit:s[2]||(s[2]=c(()=>{},["prevent"]))},{default:p(()=>[i(r,{label:"选择脚本",prop:"run_script_id"},{default:p(()=>[i(a,{"show-all-levels":!1,onChange:q,modelValue:o(C).run_script_id,"onUpdate:modelValue":s[0]||(s[0]=e=>o(C).run_script_id=e),ref_key:"scriptCascader",ref:x,props:V,options:o(D),placeholder:"请选择脚本,支持搜索",filterable:""},null,8,["modelValue","options"])]),_:1}),o(k).is_args?(t(),n(r,{key:0,label:o(k).args_title,prop:"args"},{default:p(()=>[i(h,{placeholder:o(k).args_holder,modelValue:o(C).args,"onUpdate:modelValue":s[1]||(s[1]=e=>o(C).args=e),width:"17rem"},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):d("",!0)]),_:1},8,["disabled","model","rules"])])}}});export{v as default};
