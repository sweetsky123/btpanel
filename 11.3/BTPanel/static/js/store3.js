import{j as e,aH as a,r as t,q as s,g as n}from"./base-lib.js?v=1763689792";import{u as l,Q as o,W as i,az as r,M as u,eG as c,p as d,af as p,aH as f,e_ as v}from"./utils-lib.js?v=1763689792";import{ax as m,ay as y,az as h,aA as g,p as w,aB as _,l as S,k as x}from"./validator.js?v=1763689792";const L=e("SOFTWARE-STORE",()=>{const e=a(),{forceLtd:L,aliyunEcsLtd:q,payment:I}=l(),b=t(""),C=t(!1),H=t([]),j=t(),A=t([]),E=t([]),P=t(!1),R=t(!1),k=t(0),F=t(!1);let M=t([]),T=[];const V=async(e="")=>{if(!F.value){if(r(e)&&""!==e){F.value=!0;const a=n(()=>{if(!e)return M.value;const a=e.toLowerCase();return T.filter(e=>e.name.toLowerCase().includes(a)||e.ps.toLowerCase().includes(a)||e.title.toLowerCase().includes(a))});return M.value=a.value,void(F.value=!1)}W(e)}},W=s(async e=>{await o({loading:F,request:m({p:1,type:-1,tojs:"soft.get_list",query:e,force:0,row:100}),data:{"list.data":[Array,M],"list.page":i(k)},success:e=>{M.value=e["list.data"].filter(e=>e.index_display).concat(e["list.data"].filter(e=>!e.index_display)),T=M.value}})},5e3),z=e=>{const a=e?T.filter(a=>{if(a.title.toLowerCase().includes(e.trim().toLowerCase()))return{value:a.title}}):T;let t=[];return a.forEach((e,a,s)=>{t.push({value:e.title})}),t},B=()=>{if(A.value.length<=12&&(H.value.length>0&&!q.value&&"ltd"!==I.value.authType?E.value=[...A.value,...H.value].slice(0,12):E.value=[...A.value].slice(0,12)),E.value.length<12)for(;E.value.length<12;)E.value.push({})},G=e=>{w({disablePro:!(8===e.type),sourceId:{total:41,monitor:175,btwaf:40,tamper_core:42,bt_security:43,oneav:44,security_notice:56}[e.name]||0})},O=()=>{const e=document.querySelector(".soft-wrapper");c.create(e,{animation:500,handle:".soft-move",chosenClass:"ghost",onEnd:async e=>{const a=E.value.splice(e.oldIndex,1)[0];E.value.splice(e.newIndex,0,a),D()}})},D=()=>{let e=E.value.filter(e=>void 0!==e.id&&e.name).map(e=>e.name).join("|");o({request:_({ssort:e})})};return{popShow:R,isGetSoft:P,pluginKeyword:b,recommendList:H,containerRef:j,mySoftList:M,tableLoading:F,softShowList:E,load:async()=>{let e=Math.ceil(k.value/12),a=Math.ceil(M.value.length/12);if(a>=e)return;const{data:t}=await m({p:a+1,type:-1,tojs:"soft.get_list",force:0,row:12});M.value=M.value.concat(t.list.data)},createSoftList:B,getHomeInstallSoftData:async()=>{await o({loading:P,request:g(),success:e=>{const a=e.data.filter(e=>e.setup);E.value=a,A.value=a,B(),O()}})},getRecommendInfo:async()=>{await o({request:v(),success:e=>{var a;Array.isArray(e.data)&&e.data.length>0&&(H.value=(null==(a=e.data[1])?void 0:a.list)||[])}})},goSoft:()=>{e.push({path:"/soft"})},showPopoverHandle:V,leave:e=>{const a=e.offsetX,t=e.offsetY,s=j.value.offsetWidth,n=j.value.offsetHeight;if(a<0||t<0||a>=s||t>=n){const e=document.querySelector(".soft-search-popover");e&&"none"!=(null==e?void 0:e.style.display)?R.value=!0:(R.value=!1,b.value="")}},querySearch:(e,a)=>{a(z(e))},searchPluginHandle:(e="")=>{""==b.value?(C.value=!1,V()):(C.value=!0,V(b.value))},renderSoftImages:e=>"".concat("/static/img/soft_ico","/ico-").concat(e.replace(/-+[{0-9},\.,]+$/,""),".png"),changeSwitchHandle:async(e,a)=>{const t=T.filter(e=>e.index_display).length;if(T.length,M.value.length,t>12&&e.index_display)return e.index_display=!e.index_display,u.error("首页最多只能显示12个软件!");try{const a=e.index_display?y:h;await o({loading:"正在处理，请稍后...",request:a(e.name),message:!0,success:e=>{e.status&&(M.value=M.value.map(e=>(e.name==e.name&&(e.index_display=e.index_display),e)),T=T.map(e=>(e.name==e.name&&(e.index_display=e.index_display),e)),A.value=T.filter(e=>e.index_display)),B()}})}catch(s){e.index_display=!e.index_display}},openSoftView:async e=>(e.endtime>=0||0===e.price?S({name:e.name,pluginInfo:e}):(await d({title:"购买插件",content:"插件已过期，是否前往购买？"}),G(e)),!1),softStatusColor:e=>e.status||"phpmyadmin"===e.name?"var(--el-color-primary)":"#FF4949",softStatus:e=>e.status||"phpmyadmin"===e.name?"start":"stop",openRecommendSoftView:e=>{if(e.name&&!e.install&&!p(e.isBuy))return S({name:e.name,pluginInfo:e}),!1},openSoftPreLink:e=>{window.open(e.preview,"_blank","noopener,noreferrer")},openLtdPayView:G,openInstall:async e=>{const{data:a}=await f({sName:e.name});if("-1"===a.task)return u.error("当前插件正在安装，不可重复安装");x({name:a.name,type:"i",pluginInfo:a})}}});export{L as H};
