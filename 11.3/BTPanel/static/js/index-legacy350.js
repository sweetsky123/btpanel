!function(){function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}var n=["limit"];function e(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return r(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function a(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),e.push.apply(e,r)}return e}function u(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?a(Object(e),!0).forEach(function(n){o(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):a(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function o(n,e,r){return(e=function(n){var e=function(n,e){if("object"!=t(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var a=r.call(n,e||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"==t(e)?e:e+""}(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function i(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function u(e,r,a,u){var i=r&&r.prototype instanceof c?r:c,l=Object.create(i.prototype);return s(l,"_invoke",function(e,r,a){var u,i,s,c=0,l=a||[],f=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,e){return u=n,i=0,s=t,p.n=e,o}};function v(e,r){for(i=e,s=r,n=0;!f&&c&&!a&&n<l.length;n++){var a,u=l[n],v=p.p,g=u[2];e>3?(a=g===r)&&(s=u[(i=u[4])?5:(i=3,3)],u[4]=u[5]=t):u[0]<=v&&((a=e<2&&v<u[1])?(i=0,p.v=r,p.n=u[1]):v<g&&(a=e<3||u[0]>r||r>g)&&(u[4]=e,u[5]=r,p.n=g,i=0))}if(a||e>1)return o;throw f=!0,r}return function(a,l,g){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&v(l,g),i=l,s=g;(n=i<2?t:s)||!f;){u||(i?i<3?(i>1&&(p.n=-1),v(i,s)):p.n=s:p.v=s);try{if(c=2,u){if(i||(a="next"),n=u[a]){if(!(n=n.call(u,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=u.return)&&n.call(u),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);u=t}else if((n=(f=p.n<0)?s:e.call(r,p))!==o)break}catch(n){u=t,i=1,s=n}finally{c=1}}return{value:n,done:f}}}(e,a,u),!0),l}var o={};function c(){}function l(){}function f(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(s(n={},r,function(){return this}),n),v=f.prototype=c.prototype=Object.create(p);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t}return l.prototype=f,s(v,"constructor",f),s(f,"constructor",l),l.displayName="GeneratorFunction",s(f,a,"GeneratorFunction"),s(v),s(v,a,"Generator"),s(v,r,function(){return this}),s(v,"toString",function(){return"[object Generator]"}),(i=function(){return{w:u,m:g}})()}function s(t,n,e,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}s=function(t,n,e,r){function u(n,e){s(t,n,function(t){return this._invoke(n,e,t)})}n?a?a(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e:(u("next",0),u("throw",1),u("return",2))},s(t,n,e,r)}function c(t,n,e,r,a,u,o){try{var i=t[u](o),s=i.value}catch(t){return void e(t)}i.done?n(s):Promise.resolve(s).then(r,a)}function l(t){return function(){var n=this,e=arguments;return new Promise(function(r,a){var u=t.apply(n,e);function o(t){c(u,r,a,o,i,"next",t)}function i(t){c(u,r,a,o,i,"throw",t)}o(void 0)})}}System.register(["./index-legacy109.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./useStore-legacy7.js?v=1763689792","./config-legacy.js?v=1763689792"],function(t,r){"use strict";var a,o,s,c,f,p,v,g,m,d,y,h,b,w,O,S,_,j,k,P,x,D,L,T,A,C,E,q,I,R,F,G,B,N,H,U,M,Q,W;return{setters:[function(t){a=t._},function(t){o=t.j,s=t.s,c=t.r,f=t.o,p=t.W,v=t.e,g=t.c,m=t.g,d=t.x,y=t.y,h=t.C,b=t.z,w=t.D,O=t.L,S=t.A,_=t.H},function(t){j=t.Q,k=t.M,P=t.aA,x=t.T,D=t.u,L=t.p,T=t.n,A=t.H,C=t.b,E=t.f0,q=t.ao,I=t._},function(t){R=t.K,F=t.M,G=t.N,B=t.O,N=t.P,H=t.Q,U=t.R,M=t.L},function(t){Q=t.u,W=t.Z}],execute:function(){var z=t("L",o("LOG-ANALYSE-STORE",function(){var t=c(!1),n=c({type:"logs",name:""}),e=c([]),r=c({status:!1,channel:"",cycle:0,path:"",task_id:null}),a=c({}),u=c(""),o=c(!1),s=c(0),p=f({p:1,row:10,path:""}),v=function(){var t=l(i().m(function t(){var e;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({loading:o,request:R({siteName:n.value.name}),data:{log_file:String,status:Boolean,msg:String},success:function(t){u.value=t.log_file,p.path=t.log_file,t.status||k.error(t.msg)}});case 1:return e=t.v,t.a(2,{data:e.log_file,status:e.status,msg:e.msg});case 2:return t.p=2,t.v,t.a(2,{data:"",status:!1,msg:"获取日志路径失败"})}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),g=function(){var t=l(i().m(function t(n){var e;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({loading:o,request:F(n),data:{data:Array,page:String}});case 1:return e=t.v,t.a(2,{data:e.data,total:P(e.page)});case 2:return t.p=2,t.v,t.a(2,{data:[],total:0,other:{}})}},t,null,[[0,2]])}));return function(n){return t.apply(this,arguments)}}(),m=function(){var t=l(i().m(function t(){var n,e,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({loading:o,request:G({path:u.value}),data:{status:Boolean,msg:String}});case 1:return n=t.v,e=n.status,r=n.msg,t.a(2,{status:e,msg:r});case 2:return t.p=2,t.v,t.a(2,{status:!1,msg:"扫描失败"})}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),d=function(){var n=l(i().m(function n(e){var r,a;return i().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,ht();case 1:r=n.v,a=setInterval(l(i().m(function n(){var o,c;return i().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,B({path:u.value});case 1:o=n.v,c=o.data,s.value=c.msg,100===c.msg&&(clearInterval(a),r.unmount(),k.success("扫描完成"),s.value=0,t.value=!0,e&&e());case 2:return n.a(2)}},n)})),1e3);case 2:return n.a(2)}},n)}));return function(t){return n.apply(this,arguments)}}(),y={status:!1,channel:[],cycle:0,path:""},h={give:[],status:!1,cycle:1,task_id:null},b=function(){var t=l(i().m(function t(){var e;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({request:x(),success:function(t){var e=t.data.data.find(function(t){var e;return(null===(e=t.task_data)||void 0===e?void 0:e.site_name)===n.value.name&&"web_log_scan"===t.source&&"110"===t.template_id});e?(Object.assign(r.value,{status:e.status,channel:e.sender,cycle:1,path:e.task_data.log_path}),Object.assign(D,{give:e.sender,status:e.status,cycle:1,task_id:e.id})):(Object.assign(r.value,y),Object.assign(D,h))}});case 1:return e=t.v,e.data,t.a(2,{data:{give:r.value.channel,status:r.value.status,cycle:1},status:!0,msg:"获取扫描数据成功"});case 2:return t.p=2,t.v,t.a(2,{status:!1,msg:"获取扫描数据失败"})}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),w=function(){var t=l(i().m(function t(){return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({loading:"正在清空日志，请稍后...",request:N({path:u.value}),message:!0});case 1:return t.a(2,{status:!0,msg:"清空日志成功"});case 2:return t.p=2,t.v,t.a(2,{status:!1,msg:"清空日志失败"})}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),O=c(),S=function(){var t=l(i().m(function t(){var e;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,H({path:"/www/wwwlogs/"+n.value.name+".log",type:a.value.type,time:a.value.start_time});case 1:return e=t.v,t.a(2,{data:e.data.msg||[],status:e.status,msg:"获取详情数据成功"});case 2:return t.p=2,t.v,t.a(2,{data:[],status:!1,msg:"获取详情数据失败"});case 3:return t.p=3,t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}));return function(){return t.apply(this,arguments)}}(),_=c(),D=f({give:r.value.channel,status:Boolean(r.value.status),cycle:1,task_id:r.value.task_id}),L=function(){var t=l(i().m(function t(n){return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,j({loading:"正在设置定期扫描,请稍候...",request:U(n),data:{msg:String},message:!0});case 1:return t.a(2,{status:!0,msg:"设置定期扫描成功"});case 2:return t.p=2,t.v,t.a(2,{status:!1,msg:"设置定期扫描失败"})}},t,null,[[0,2]])}));return function(n){return t.apply(this,arguments)}}();return{isRefreshList:t,routeData:n,logPath:u,msgForm:D,scanData:r,tableData:e,tableParam:p,loading:o,percentum:s,rowData:a,getLogsTableData:g,logScanEvent:m,delAllLogDataEvent:w,tableColumn:O,getDetailData:S,logScanForm:_,onConfirmScanConfig:L,getLogsPath:v,getScanData:b,startScanTimer:d}})),J=(t("u",function(){return s(z())}),C());D();var K=[["xss","XSS"],["sql","SQL"],["san","扫描"],["php","PHP攻击"],["ip","IP(top100)"],["url","URL(top100)"]],X=z(),Y=s(X),Z=Y.routeData,$=Y.logPath,V=Y.rowData,tt=Y.msgForm,nt=Y.isRefreshList,et=z(),rt=et.getLogsPath,at=et.getLogsTableData,ut=et.getScanData,ot=et.startScanTimer,it=et.logScanEvent,st=et.delAllLogDataEvent,ct=et.getDetailData,lt=(et.onConfirmScanConfig,function(){var t=l(i().m(function t(n,e){var r,a;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,Z.value=e,"site"===e.type||(r=s(M()),a=r.selectedWebSite,Z.value={name:a.value,type:e.type}),Z.value.name){t.n=1;break}return t.a(2,{data:[],total:0});case 1:return t.n=2,rt();case 2:return t.n=3,ut();case 3:return t.n=4,at(u(u({},n),{},{path:$.value}));case 4:return t.a(2,t.v);case 5:return t.p=5,t.v,t.a(2,{data:[],total:0})}},t,null,[[0,5]])}));return function(n,e){return t.apply(this,arguments)}}()),ft=function(){var t=l(i().m(function t(){return i().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,L({title:"清空扫描日志【".concat(Z.value.name,"】"),type:"input",input:{content:"清空日志"},icon:"warning-filled",content:"风险操作，清空该扫描日志后，将无法查到以往的扫描日志记录，此操作不可逆，是否继续清空？"});case 1:return t.n=2,st();case 2:nt.value=!0;case 3:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),pt=function(){var t=l(i().m(function t(){var n;return i().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,L({title:"日志扫描",icon:"warning-filled",content:"建议在服务器负载较低时进行安全分析，本次将对【".concat(Z.value.name,".log】文件进行扫描，可能等待时间较长，是否继续？")});case 1:return t.n=2,it();case 2:if((n=t.v).status){t.n=3;break}return t.a(2,J.error(n.msg));case 3:ot();case 4:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),vt=c([{label:"访问次数",prop:"num",width:80},{label:"访问路径",prop:"path",showOverflowTooltip:!0}]),gt=function(){var t=l(i().m(function t(n,e){return i().w(function(t){for(;;)switch(t.n){case 0:V.value=n,V.value.type=e,["sql","san","xss","php"].includes(e)||(vt.value[1].label="url"===e?"访问URL":"访问ip"),T({title:"日志详情",area:72,compData:{row:n,type:e},component:function(){return A(function(){return r.import("./log-detail-legacy.js?v=1763689792")},void 0,r.meta.url)}});case 1:return t.a(2)}},t)}));return function(n,e){return t.apply(this,arguments)}}(),mt=p([{label:"攻击ip",prop:"ip"},{label:"攻击时间",prop:"time"},{label:"user-agent",prop:"ua",showOverflowTooltip:!0},{label:"请求URL",width:210,render:function(t){return"san"===V.value.type?t.url:v("span",{class:"bg-lighter text-danger break-words"},[t.url])}}]),dt=t("t",c()),yt=(t("r",function(){var t=l(i().m(function t(n){var e,r,a,u;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,ct();case 1:if(e=t.v,r=e.data,a=e.status,u=["sql","san","xss","php"],dt.value=u.includes(n)?mt.value:vt.value,a){t.n=2;break}return t.a(2,{data:[],total:0,other:{}});case 2:return t.a(2,{data:r,total:r.length,other:{}});case 3:return t.p=3,t.v,t.a(2,{data:[],total:0,other:{}})}},t,null,[[0,3]])}));return function(n){return t.apply(this,arguments)}}()),t("s",function(){var t=l(i().m(function t(n,e,r){var a,u,o,s,c,l;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e();case 1:if(a=tt.value,u=a.give,a.cycle,o=a.status,s=a.task_id,c={template_id:110,task_data:JSON.stringify({task_data:{tid:"110",type:"web_log_scan",title:"Web日志扫描告警",status:o,count:0,interval:600,project:"",site_name:Z.value.name},sender:u||[]})},!o){t.n=3;break}return t.n=2,j({request:Q(c),loading:"正在设置定期扫描告警",message:!0});case 2:l=t.v,t.n=6;break;case 3:if(s){t.n=4;break}return J.error("请开启自动扫描"),t.a(2,!1);case 4:return t.n=5,j({loading:"正在关闭告警任务，请稍候...",request:W({task_id:s}),message:!0});case 5:l=t.v;case 6:return nt.value=!0,t.a(2,l.status);case 7:t.p=7,t.v;case 8:return t.a(2)}},t,null,[[0,7]])}));return function(n,e,r){return t.apply(this,arguments)}}()),function(){if(""===$.value)return J.error("配置文件丢失");T({title:"定期扫描",area:48,showFooter:!0,component:function(){return A(function(){return r.import("./scan-form-legacy.js?v=1763689792")},void 0,r.meta.url)}})}),ht=function(){return T({title:!1,component:function(){return A(function(){return r.import("./progress-legacy.js?v=1763689792")},void 0,r.meta.url)},area:40})},bt=g({__name:"index",props:{type:{default:"logs"},name:{default:""}},setup:function(t,r){var o=r.expose,i=t,c=D().mainHeight,l=m(function(){return"site"===i.type?426:c.value-426}),f=z(),p=s(f),g=p.isRefreshList,j=p.scanData,k=E({request:function(t){var e=t.limit,r=function(t,n){if(null==t)return{};var e,r,a=function(t,n){if(null==t)return{};var e={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==n.indexOf(r))continue;e[r]=t[r]}return e}(t,n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(r=0;r<u.length;r++)e=u[r],-1===n.indexOf(e)&&{}.propertyIsEnumerable.call(t,e)&&(a[e]=t[e])}return a}(t,n);return lt(u(u({},r),{},{row:e}),i)},columns:[{label:"扫描时间",prop:"start_time",showOverflowTooltip:!0},{label:"耗时",prop:"time",render:function(t){var n;return(null===(n=t.time)||void 0===n?void 0:n.substring(0,4))+"秒"}}].concat(e(K.map(function(t){return{label:t[1],prop:t[0],width:"ip"!==t[0]&&"php"!==t[0]&&"url"!==t[0]?50:"auto",render:function(n){return n[t[0]]?v("span",{class:"bt-link ".concat("ip"===t[0]||"url"===t[0]?"":"!text-danger"),onClick:function(){return gt(n,t[0])}},[n[t[0]]]):v("span",null,[n[t[0]]])}}})),[{label:"合计",render:function(t){var n=0;for(var e in t)"start_time"!=e&&"time"!=e&&"ip"!=e&&"url"!=e&&"is_status"!=e&&t[e]>0&&(n+=t[e]);return v("span",null,[n])}}]),extension:[q(g)]}),P=k.BtTable,x=k.BtPage;return o({init:k.refresh}),function(t,n){var r=_,u=a;return d(),y("div",null,[v(u,null,{"header-left":h(function(){return[v(r,{onClick:b(pt),type:"primary"},{default:h(function(){return e(n[0]||(n[0]=[w("日志扫描",-1)]))}),_:1},8,["onClick"]),v(r,{type:"default",class:O({"not-status":!Boolean(b(j).status)}),onClick:b(yt)},{default:h(function(){return[n[1]||(n[1]=w(" 定期扫描 ",-1)),S("i",{class:O("text-small svgtofont-icon-".concat(b(j).status?"start text-primary":"stop text-danger"," "))},null,2)]}),_:1},8,["class","onClick"]),v(r,{onClick:b(ft)},{default:h(function(){return e(n[2]||(n[2]=[w("清空扫描日志",-1)]))}),_:1},8,["onClick"])]}),content:h(function(){return[v(b(P),{"max-height":b(l)},null,8,["max-height"])]}),"footer-right":h(function(){return[v(b(x))]}),_:1}),n[3]||(n[3]=S("ul",{class:"mt-8px leading-8 text-small list-disc ml-20px"},[S("li",null,[w(" 日志安全分析：扫描网站(.log)日志中含有攻击类型的请求(类型包含： "),S("span",{class:"text-danger"},"xss,sql,san,php"),w(" ) ")]),S("li",null,"分析的日志数据包含已拦截的请求"),S("li",null,"如日志文件过大，扫描可能等待时间较长，请耐心等待")],-1))])}}});t("A",I(bt,[["__scopeId","data-v-55808dbc"]]))}}})}();
