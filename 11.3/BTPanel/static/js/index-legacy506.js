!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,o="function"==typeof Symbol?Symbol:{},l=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function a(t,o,l,i){var a=o&&o.prototype instanceof c?o:c,s=Object.create(a.prototype);return r(s,"_invoke",function(t,r,o){var l,i,a,c=0,s=o||[],f=!1,d={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return l=n,i=0,a=e,d.n=t,u}};function m(t,r){for(i=t,a=r,n=0;!f&&c&&!o&&n<s.length;n++){var o,l=s[n],m=d.p,p=l[2];t>3?(o=p===r)&&(a=l[(i=l[4])?5:(i=3,3)],l[4]=l[5]=e):l[0]<=m&&((o=t<2&&m<l[1])?(i=0,d.v=r,d.n=l[1]):m<p&&(o=t<3||l[0]>r||r>p)&&(l[4]=t,l[5]=r,d.n=p,i=0))}if(o||t>1)return u;throw f=!0,r}return function(o,s,p){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&m(s,p),i=s,a=p;(n=i<2?e:a)||!f;){l||(i?i<3?(i>1&&(d.n=-1),m(i,a)):d.n=a:d.v=a);try{if(c=2,l){if(i||(o="next"),n=l[o]){if(!(n=n.call(l,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,i<2&&(i=0)}else 1===i&&(n=l.return)&&n.call(l),i<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),i=1);l=e}else if((n=(f=d.n<0)?a:t.call(r,d))!==u)break}catch(n){l=e,i=1,a=n}finally{c=1}}return{value:n,done:f}}}(t,l,i),!0),s}var u={};function c(){}function s(){}function f(){}n=Object.getPrototypeOf;var d=[][l]?n(n([][l]())):(r(n={},l,function(){return this}),n),m=f.prototype=c.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=f,r(m,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,i,"GeneratorFunction"),r(m),r(m,i,"Generator"),r(m,l,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:a,m:p}})()}function r(e,n,t,o){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}r=function(e,n,t,o){function i(n,t){r(e,n,function(e){return this._invoke(n,t,e)})}n?l?l(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t:(i("next",0),i("throw",1),i("return",2))},r(e,n,t,o)}function o(e,n,t,r,o,l,i){try{var a=e[l](i),u=a.value}catch(e){return void t(e)}a.done?n(u):Promise.resolve(u).then(r,o)}function l(e){return function(){var n=this,t=arguments;return new Promise(function(r,l){var i=e.apply(n,t);function a(e){o(i,r,l,a,u,"next",e)}function u(e){o(i,r,l,a,u,"throw",e)}a(void 0)})}}System.register(["./index-legacy123.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./column-legacy.js?v=1763689792","./site-legacy.js?v=1763689792","./useStore-legacy4.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792"],function(n,r){"use strict";var o,i,a,u,c,s,f,d,m,p,v,y,g,b,_,h,w,k,C,j,x,S,V,O,E,A,q,G,I,T,U,L,P,F,B,H,R,z,J,N,$,D,K;return{setters:[function(e){o=e._},function(e){i=e.Q,a=e.b,u=e.p,c=e.$,s=e.k,f=e.ax,d=e.j,m=e.B,p=e._},function(e){v=e.r,y=e.o,g=e.c,b=e.v,_=e.I,h=e.J,w=e.z,k=e.x,C=e.y,j=e.e,x=e.C,S=e.D,V=e.A,O=e.F,E=e.b1,A=e.S,q=e.L,G=e.B,I=e.K,T=e.R,U=e.H,L=e.ad,P=e.ab,F=e.G,B=e.O},function(e){H=e.B},function(e){R=e.getServiceLog,z=e.modifyService,J=e.addService,N=e.getServicesInfo,$=e.delService,D=e.handleService},function(e){K=e.u},null,null],execute:function(){var r=a(),M=K().siteInfo,Q=v([]),W=v(!1),X=v(),Y=v(!1),Z=y({name:"",command:"",sid:"",level:11,log_type:"append",isEdit:!1}),ee=v(!1),ne=v(!1),te=v([{label:"追加记录",value:"append"},{label:"启动时清空",value:"cover"}]),re=v(!1),oe=y({logContent:"",logLoading:!1,title:"",sid:""}),le=y({name:[{required:!0,message:"请输入服务名称",trigger:"blur"}],command:[{required:!0,message:"请输入启动命令",trigger:"blur"}],level:[{required:!0,message:"请输入优先级",trigger:"blur"}]}),ie=v([{content:"协同服务用于管理那些与web服务同时运行的，用于处理一些事务的服务，如：任务队列、定时队列等，例如：celery等。"},{content:"当前工作方式为启动项目时检测这些服务，若未启动则执行启动，若已启动则不进行操作；停止项目时执行所有服务的停止操作"}]),ae=function(e){Z.log_type=e},ue=function(){ye(),W.value=!0},ce=function(e){Z.name=e.name,Z.command=e.command,Z.sid=e.sid,Z.level=e.level,Z.log_type=e.log_type,Z.isEdit=!0,W.value=!0},se=function(){var e=l(t().m(function e(n){var o,l;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,!n&&(oe.logLoading=!0),e.n=1,R({project_name:M.value.name,sid:oe.sid});case 1:o=e.v,l=o.data,oe.logContent=l.data,oe.logLoading=!1,n&&r.success("刷新成功"),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}(),fe=function(e){oe.sid=e.sid,oe.title="main"===e.sid?"项目主服务":e.name,re.value=!0,se(!1)},de=function(){var e=l(t().m(function e(n){return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({icon:"warning-filled",title:"删除服务【".concat(n.name,"】"),content:"删除服务【".concat(n.name,"】后，将无法管理该服务，是否继续？")});case 1:return e.n=2,i({loading:"正在删除服务，请稍后...",request:$({project_name:M.value.name,sid:n.sid}),message:!0});case 2:e.v.status&&ge();case 3:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=l(t().m(function e(n,r){return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i({loading:"正在修改服务状态，请稍后...",request:D({project_name:M.value.name,sid:r.sid,option:n}),message:!0});case 1:e.v.status&&ge();case 2:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),pe=function(){W.value=!1,ye()},ve=function(){var e=l(t().m(function e(){var n,r;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,X.value.validate();case 1:return n={project_name:M.value.name,service_conf:JSON.stringify({name:Z.name,command:Z.command,level:Z.level,log_type:Z.log_type})},Z.isEdit&&(n.sid=Z.sid),r=Z.isEdit?z:J,e.n=2,i({loading:Y,request:r(n),message:!0});case 2:e.v.status&&(W.value=!1,ye(),ge());case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ye=function(){Z.name="",Z.command="",Z.sid="",Z.level=11,Z.log_type="append",Z.isEdit=!1},ge=function(){var e=l(t().m(function e(){var n,r=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:return(n=r.length>0&&void 0!==r[0]&&r[0])&&(ne.value=!0),e.n=1,i({request:N({project_name:M.value.name}),data:{data:[Array,Q]}});case 1:n&&(ne.value=!1);case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),be={class:"overflow-auto mt-1rem max-h-[61rem]"},_e={class:"flex flex-col p-[16px]"},he={class:"service-info"},we={class:"item-info"},ke={class:"flex items-center"},Ce={class:"item-info"},je={key:0},xe={key:1},Se={key:0,class:"item-info"},Ve={class:"!w-[100%]"},Oe=["onClick"],Ee={class:"flex items-center mt-[16px]"},Ae={class:"p-2rem"},qe={class:"ml-[1rem] text-primary w-[16rem] select-none"},Ge={class:"py-[2rem] pt-[0]"},Ie={class:"p-2rem flex flex-col"},Te=g({__name:"index",setup:function(n){return b(function(){ge(!0)}),function(n,t){var r=U,l=c,i=s,a=L,u=f,p=P,v=d,y=o,g=_("bt-loading");return h((k(),C("div",null,[j(r,{type:"primary",onClick:w(ue)},{default:x(function(){return e(t[9]||(t[9]=[S("添加服务",-1)]))}),_:1},8,["onClick"]),V("div",be,[(k(!0),C(O,null,E(w(Q),function(n,o){return k(),C("div",{class:"border rounded-small border-lighter mb-[16px]",key:o},[V("div",_e,[V("div",he,[V("div",we,[V("div",null,"服务："+G(n.name),1),V("div",ke,[t[10]||(t[10]=S("状态：",-1)),j(w(H),{modelValue:!!n.pid},null,8,["modelValue"])])]),V("div",Ce,[n.pid?(k(),C("div",je,"pid："+G(n.pid),1)):F("",!0),n.ports.length?(k(),C("div",xe,"端口："+G(n.ports.join(", ")),1)):F("",!0)]),n.sid&&"main"!==n.sid?(k(),C("div",Se,[V("div",Ve,[S(" 启动命令："+G(n.command)+" ",1),V("i",{class:"svgtofont-el-document-copy cursor-pointer text-default text-base copy ml-[4px]",title:"复制启动命令",onClick:function(){return w(m)({value:n.command})}},null,8,Oe)])])):F("",!0)]),V("div",Ee,[n.pid?(k(),B(r,{key:1,type:"default",onClick:function(e){return w(me)("stop",n)}},{default:x(function(){return e(t[12]||(t[12]=[S("停止",-1)]))}),_:1},8,["onClick"])):(k(),B(r,{key:0,type:"default",onClick:function(e){return w(me)("start",n)}},{default:x(function(){return e(t[11]||(t[11]=[S("启动",-1)]))}),_:1},8,["onClick"])),j(r,{type:"default",onClick:function(e){return w(me)("restart",n)}},{default:x(function(){return e(t[13]||(t[13]=[S("重启",-1)]))}),_:1},8,["onClick"]),"main"!==n.sid?(k(),C(O,{key:2},[j(r,{type:"default",onClick:function(e){return w(ce)(n)}},{default:x(function(){return e(t[14]||(t[14]=[S("编辑",-1)]))}),_:1},8,["onClick"]),j(r,{type:"default",onClick:function(e){return w(fe)(n)}},{default:x(function(){return e(t[15]||(t[15]=[S("日志",-1)]))}),_:1},8,["onClick"]),j(r,{type:"default",onClick:function(e){return w(de)(n)}},{default:x(function(){return e(t[16]||(t[16]=[S("删除",-1)]))}),_:1},8,["onClick"])],64)):F("",!0)])])])}),128))]),j(l,{options:w(ie)},null,8,["options"]),j(v,{title:"".concat(w(Z).isEdit?"编辑":"添加","服务"),modelValue:w(W),"onUpdate:modelValue":t[6]||(t[6]=function(e){return T(W)?W.value=e:null}),area:50,"show-footer":!0,onConfirm:w(ve),onCancel:w(pe)},{default:x(function(){return[V("div",Ae,[j(p,{rules:w(le),"label-width":"90px",model:w(Z),ref_key:"servicesFormRef",ref:X,disabled:w(Y),size:"small",onSubmit:t[5]||(t[5]=A(function(){},["prevent"]))},{default:x(function(){return[j(a,{label:"名称",prop:"name"},{default:x(function(){return[j(i,{modelValue:w(Z).name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return w(Z).name=e}),name:"name",width:"32rem"},null,8,["modelValue"])]}),_:1}),j(a,{label:"启动命令",prop:"command"},{default:x(function(){return[j(i,{modelValue:w(Z).command,"onUpdate:modelValue":t[1]||(t[1]=function(e){return w(Z).command=e}),name:"command",width:"32rem"},null,8,["modelValue"])]}),_:1}),V("div",{class:"more flex items-center cursor-pointer pl-[10rem] my-[2rem] px-[2rem]",onClick:t[2]||(t[2]=function(e){return ee.value=!w(ee)})},[V("i",{class:q(w(ee)?"svgtofont-el-arrow-down":"svgtofont-el-arrow-right")},null,2),V("div",qe,G("更多设置，".concat(w(ee)?"点击收回":"点击查看")),1)]),h(V("div",Ge,[j(a,{label:"优先级",prop:"level"},{default:x(function(){return[j(i,{modelValue:w(Z).level,"onUpdate:modelValue":t[3]||(t[3]=function(e){return w(Z).level=e}),type:"number",name:"level",width:"32rem"},null,8,["modelValue"])]}),_:1}),j(a,{label:"日志管理",prop:"log_type"},{default:x(function(){return[j(u,{modelValue:w(Z).log_type,"onUpdate:modelValue":t[4]||(t[4]=function(e){return w(Z).log_type=e}),options:w(te),onChange:w(ae),class:"!w-32rem"},null,8,["modelValue","options","onChange"])]}),_:1})],512),[[I,w(ee)]])]}),_:1},8,["rules","model","disabled"]),h(j(l,{class:"pl-4rem",options:[{content:"【优先级】执行项目启动时，会按照优先级从高到低一次启动服务，主服务的优先级为10"}]},null,512),[[I,w(ee)]])])]}),_:1},8,["title","modelValue","onConfirm","onCancel"]),j(v,{title:"【".concat(w(oe).title,"】服务日志"),modelValue:w(re),"onUpdate:modelValue":t[8]||(t[8]=function(e){return T(re)?re.value=e:null}),area:70},{default:x(function(){return[h((k(),C("div",Ie,[V("div",null,[j(r,{onClick:t[7]||(t[7]=function(e){return w(se)(!0)}),type:"default",class:"!mb-1rem"},{default:x(function(){return e(t[17]||(t[17]=[S("刷新日志",-1)]))}),_:1})]),j(y,{content:w(oe).logContent,isHtml:!0,class:"h-41rem","full-screen":{title:"全屏查看【".concat(w(oe).title,"】服务日志"),onRefresh:function(){return w(se)}}},null,8,["content","full-screen"])])),[[g,w(oe).logLoading]])]}),_:1},8,["title","modelValue"])])),[[g,w(ne)]])}}});n("default",p(Te,[["__scopeId","data-v-78d0322b"]]))}}})}();
