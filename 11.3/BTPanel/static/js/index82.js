import{_ as e}from"./index109.js?v=1763689792";import{u as t}from"./index147.js?v=1763689792";import{r as a,c as s,s as n,e as r,D as o,w as i,v as l,x as c,O as u,C as m,z as p,A as d}from"./base-lib.js?v=1763689792";import{n as _,H as f,bR as g,M as v,p as j,u as y,b3 as b,an as w,q as h,ap as x}from"./utils-lib.js?v=1763689792";import{f as C}from"./validator.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import{c as S,a as O,d as k,g as B,u as P}from"./column.js?v=1763689792";import{c as T,h as L,d as R,e as I,g as J,i as N,s as E,u as M,a as A,k as q}from"./useController6.js?v=1763689792";import{u as D,S as G}from"./useStore4.js?v=1763689792";import{setProject as z,removeProject as H}from"./site.js?v=1763689792";const{activeType:U,settingTabActive:V,siteInfo:F,isRefreshList:K}=D(),{addGeneralProject:Q,editGeneralProject:W,delGeneralProjectEvent:X,setSiteInfo:Y,getRootUser:Z,getProjectConfig:$}=G(),ee=a([]),te=()=>{F.value=null,_({title:"添加通用项目",area:62,component:()=>f(()=>import("./index403.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},ae=(e,t)=>{Y(e,t),_({title:"通用项目管理["+e.name+"] -- 添加时间["+e.addtime+"]",area:[84,72],component:()=>f(()=>import("./index404.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},se=async(e,t,a,s)=>{const{label:n,value:r}=s,o=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(e,t)=>{const a=new Map([["start",z],["stop",z],["restart",z],["delete",H]]),{name:s}=e,n=a.get(r);switch(r){case"start":case"stop":case"restart":if(n){const t=await n({data:JSON.stringify({project_name:s})},U.value,r),a=t.status?1:2;return"start"===r?{...e,batchStatus:a,message:t.msg.replace(/<br>/g,"\n")}:{...e,batchStatus:a,message:t.status?t.data.msg:t.data.data}}case"delete":if(n)return await n({data:JSON.stringify({project_name:s})},U.value)}};await e({title:"批量".concat(n),content:"".concat(o.get(r),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},S()],onConfirm:async()=>(await t(i),K.value=!0,!1)})},ne=(e,t)=>{C({type:"file",path:e,change:e=>{t&&t(e)}})},re=async()=>{const{data:e}=await Z();if(ee.value=e.map(e=>({label:e,value:e})),F.value){const{data:e}=await $({data:JSON.stringify({project_name:F.value.name})});return{...null==e?void 0:e.project_config,project_ps:null==e?void 0:e.ps,is_power_on:!!(null==e?void 0:e.project_config.is_power_on),project_log:(null==e?void 0:e.project_config.project_log)?1:0,web_log:(null==e?void 0:e.project_config.web_log)?1:0}}return{project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1}},oe=async e=>{try{const t={...e};if(""!==t.domains){t.bind_extranet=1;const e=g(t.domains,"string","");t.domains=e.split("\n")}else t.bind_extranet=0,delete t.domains;F.value&&(t.id=F.value.id);const a=F.value?W:Q,s=await a({data:JSON.stringify(t)});return v.msg({dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",duration:s.status?2e3:0,showClose:!s.status,customClass:"!max-w-[66rem]"}),K.value=!0,s.status}catch(t){return{status:!1,msg:"发生错误"}}},ie=async e=>{try{await j({title:"删除项目-".concat(e.name),content:"风险操作，此操作不可逆，删除".concat(e.name,"项目后您将无法管理该项目，是否继续操作？"),type:"calc"});const t={data:JSON.stringify({project_name:e.name})},a=await X(t);return v.request(a),K.value=!0,a}catch(t){return{status:!1,msg:"删除项目失败"}}},le=s({__name:"index",setup(a){y();const{getSiteList:s,setSiteInfo:_}=G(),{isRefreshList:f,siteInfo:v}=n(G()),{BtOperation:j}=b({options:[{type:"button",label:"添加项目",active:!0,onClick:te}]}),C=t({key:"type_id",name:"Other分类",options:()=>[{label:"全部分类",value:"all"}],event:N,ignore:["0"],field:"type_name"}),S=x([{label:"启动项目",value:"start",event:se},{label:"停用项目",value:"stop",event:se},{label:"重启项目",value:"restart",event:se},M(),A({classList:q}),{label:"删除项目",value:"delete",event:se}]),{BtTable:D,BtPage:z,BtRefresh:H,BtSearch:U,BtColumn:V,BtBatch:F,BtTableCategory:K,refresh:Q,config:W}=w({request:e=>{const{type_id:t,...a}=e;return s({data:JSON.stringify({...a,type_id:h(t)||"all"===t?"":t})})},columns:[O(),T({onClick:e=>{ae(e)}}),L({onClick:(e,t)=>{if("setting"===t)return void ae(e,"state");const a=e.run?"stop":"start";E(e,"restart"===t?t:a)}}),{label:"运行端口",isCustom:!0,render:e=>{const t=g(e.listen,"array",[]);return 0==t.length?"--":t.join("、")}},k(),R(),B({table:"sites",width:200}),I({onClick:e=>{ae(e,"ssl")}}),P([{title:"设置",onClick:e=>ae(e)},{title:"删除",onClick:ie}])],extension:[C,S],empty:()=>r("span",null,[o("您的列表为空，您可以"),r("span",{class:"bt-link",onClick:te},[o("添加一个项目")])])});return i(f,async e=>{var t;if(e){if(await Q(),null==(t=v.value)?void 0:t.name){const e=W.data.find(e=>e.name===v.value.name);e&&_(e)}f.value=!1}}),l(()=>{}),(t,a)=>{const s=e;return c(),u(s,null,{"header-left":m(()=>[r(p(j)),d("div",{class:"flex items-center ml-1rem",onClick:a[0]||(a[0]=(...e)=>p(J)&&p(J)(...e))},[...a[1]||(a[1]=[d("i",{class:"svgtofont-desired text-medium"},null,-1),d("span",{class:"bt-link"},"需求反馈",-1)])])]),"header-right":m(()=>[r(p(K),{class:"!w-[200px] mr-[10px]"}),r(p(U),{class:"mr-[10px]",placeholder:"请输入项目名称或备注"}),r(p(H),{class:"mr-[10px]"}),r(p(V))]),content:m(()=>[r(p(D),null,{empty:m(()=>[...a[2]||(a[2]=[o(" 您的列表为空，您可以添加一个项目 ",-1)])]),_:1})]),"footer-left":m(()=>[r(p(F))]),"footer-right":m(()=>[r(p(z))]),_:1})}}}),ce=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{re as a,ce as i,ne as o,oe as s,ee as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
