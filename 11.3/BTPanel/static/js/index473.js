import{aK as e,Q as a,p as l,k as t,e as s,j as o,b as n,$ as r,L as i,b3 as u,n as c,H as p,l as d,ah as m,_,an as v,ao as f,u as h,aj as g}from"./utils-lib.js?v=1763689792";import{c as y,r as b,o as w,w as x,v as V,aG as k,x as C,y as j,z as P,O as q,C as U,D as N,G as z,A as H,e as I,F as T,b1 as A,B as O,R as E,am as R,an as S,H as D,ad as B,b2 as L,ab as G,I as F,J as M,V as W,a8 as J,K,ap as $,j as Q,s as X,g as Y,aA as Z,U as ee,bu as ae,W as le}from"./base-lib.js?v=1763689792";import{u as te}from"./useStore4.js?v=1763689792";import{_ as se}from"./index123.js?v=1763689792";import{_ as oe}from"./index107.js?v=1763689792";import{_ as ne}from"./index137.js?v=1763689792";import{f as re,k as ie}from"./validator.js?v=1763689792";import{getComposerVersion as ue,updateComposer as ce,deleteComposerFile as pe,execComposer as de,getComposerLine as me,setTomcatSettings as _e,getSitePhpVersion as ve,setPhpSiteGzip as fe,removePhpSiteGzip as he,getPhpSiteGzip as ge,getSecurityHeaders as ye,setSecurityHeaders as be,getCrossOriginAccess as we,setCrossOriginAccess as xe,deleteCrossOriginAccess as Ve,modifyCrontabStatus as ke,startTaskCrontab as Ce,removeCrontab as je,getCrontabList as Pe,getFreeTotalStatus as qe,setFreeTotalStatus as Ue,getPhpSiteCache as Ne,deletePhpSiteCache as ze}from"./site.js?v=1763689792";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1763689792";import{h as Ie}from"./form-item.js?v=1763689792";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang25.js?v=1763689792";import{_ as Ae}from"./index109.js?v=1763689792";import{a as Oe,b as Ee,u as Re,c as Se}from"./column.js?v=1763689792";import De from"./index480.js?v=1763689792";const Be={class:"p-1rem"},Le={class:"flex items-center"},Ge={key:0,class:"text-danger"},Fe={key:1,class:"text-danger text-small"},Me={class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},We={key:0},Je={class:"p-2rem h-50rem flex flex-col"},Ke={class:"mb-1rem"},$e={class:"flex-1 overflow-auto"},Qe=y({__name:"index",setup(r,{expose:i}){var u;const{siteInfo:c}=te(),p=null==(u=c.value)?void 0:u.project_type,d=n(),m=b(!1),_=b(!1),v=w({path:c.value.path,user:"phpasync"!==p?"www":"root",php:["静态","其它"].includes(c.value.php_version)?"auto":"PHP-"+c.value.php_version.replace(".",""),otherCommand:"",mirror:"https://mirrors.aliyun.com/composer/",command:"install",composerVersion:"install",version:"2.7.3",help_tips:"",comp_json:"",comp_lock:"",phpVersion:[],commandOptions:[{label:"install",value:"install"},{label:"update",value:"update"},{label:"require",value:"require"},{label:"create-project",value:"create-project"},{label:"自定义",value:""}]}),f=b("正在执行..."),h=b(!1),g=b(),y=b(!1);x(()=>c.value,e=>{v.php=["静态","其它"].includes(e.php_version)?"auto":"PHP-"+e.php_version.replace(".","")},{immediate:!0});const F=async a=>{m.value=!0;try{const e=await ue({path:a||c.value.path});e.data.status?(_.value=!1,v.phpVersion=e.data.php_versions.filter(e=>"00"!==e.version),v.phpVersion.unshift({name:"自动选择",version:"auto"}),v.comp_json=!1,v.comp_lock=!1,"string"==typeof e.data.comp_json&&(v.comp_json=e.data.comp_json),"string"==typeof e.data.comp_lock&&(v.comp_lock=e.data.comp_lock)):(_.value=!0,d.request(e))}catch(l){e(l)}finally{m.value=!1}},M=()=>{re({type:"dir",path:v.path,change:e=>{v.path=e,F(v.path)}})},W=()=>{a({loading:"正在更新，请稍后...",request:ce(),message:!0,success:e=>{e.status&&F(v.path)}})},J=async()=>{a({loading:"正在删除，请稍后...",request:pe({path:v.path+"/composer.lock"}),message:!0,success:e=>{e.status&&F(v.path)}})},K=async()=>{var e;let t={php_version:null==(e=v.php)?void 0:e.replace("PHP-",""),composer_args:v.command,composer_cmd:v.otherCommand,repo:v.mirror,path:v.path,user:v.user,composer_version:v.version,siteName:c.value.name};await l({title:"执行composer命令",content:"即将执行设定的composer命令，继续吗？",icon:"warning-filled"}),a({loading:"正在执行，请稍后...",request:de(t),message:!0,success:e=>{e.status&&(h.value=!0,(async()=>{g.value=setInterval(async()=>{try{$()}catch(e){clearInterval(g.value)}},2e3)})())}})},$=async(a=!1)=>{try{const e=await me({filename:"/tmp/composer_".concat(c.value.name,".log"),num:100});f.value=e.data.msg,a&&d.success("刷新成功")}catch(l){e(l)}},Q=()=>{y.value=!0,$()},X=()=>{clearInterval(g.value),h.value=!1,y.value=!1,f.value=""};return V(F),i({init:F}),k(()=>{clearInterval(g.value)}),(e,a)=>{const l=ne,n=R,r=S,i=D,u=B,c=t,d=oe,m=s,g=L,b=G,w=se,x=o;return C(),j("div",null,[P(_)?(C(),q(l,{key:0,width:"28rem",options:{name:"composer",title:"composer"}},{default:U(()=>[...a[11]||(a[11]=[N(" 没有找到可用的composer版本 ",-1)])]),_:1})):z("",!0),H("div",Be,[I(b,{model:P(v)},{default:U(()=>[I(u,{label:"Composer版本"},{default:U(()=>[H("div",Le,[I(r,{modelValue:P(v).version,"onUpdate:modelValue":a[0]||(a[0]=e=>P(v).version=e),class:"!w-[28rem]"},{default:U(()=>[I(n,{label:"2.7.3",value:"2.7.3"}),I(n,{label:"1.10.27",value:"1.10.27"})]),_:1},8,["modelValue"]),I(i,{type:"default",class:"!ml-1rem",onClick:W},{default:U(()=>[...a[12]||(a[12]=[N(" 升级Composer ",-1)])]),_:1})])]),_:1}),I(u,{label:"PHP版本"},{default:U(()=>["phpasync"!==P(p)?(C(),q(r,{key:0,class:"!w-[28rem]",modelValue:P(v).php,"onUpdate:modelValue":a[1]||(a[1]=e=>P(v).php=e)},{default:U(()=>[(C(!0),j(T,null,A(P(v).phpVersion,(e,a)=>(C(),q(n,{key:a,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(C(),q(c,{key:1,modelValue:P(v).php,"onUpdate:modelValue":a[2]||(a[2]=e=>P(v).php=e),disabled:""},null,8,["modelValue"]))]),_:1}),I(u,{label:"执行参数"},{default:U(()=>[I(r,{class:"!w-[28rem]","empty-values":[null,void 0],modelValue:P(v).command,"onUpdate:modelValue":a[3]||(a[3]=e=>P(v).command=e)},{default:U(()=>[(C(!0),j(T,null,A(P(v).commandOptions,(e,a)=>(C(),q(n,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I(u,{label:"补充命令"},{default:U(()=>[I(c,{modelValue:P(v).otherCommand,"onUpdate:modelValue":a[4]||(a[4]=e=>P(v).otherCommand=e),placeholder:"请输入补充命令",width:"28rem"},null,8,["modelValue"])]),_:1}),I(u,{label:"镜像源"},{default:U(()=>[I(r,{modelValue:P(v).mirror,"onUpdate:modelValue":a[5]||(a[5]=e=>P(v).mirror=e),filterable:"","allow-create":"","default-first-option":"",class:"!w-[28rem]"},{default:U(()=>[I(n,{label:"阿里云(mirrors.aliyun.com)",value:"https://mirrors.aliyun.com/composer/"}),I(n,{label:"官方源(packagist.org)",value:"repos.packagist"}),I(n,{label:"中国全量镜像(packagist.phpcomposer.com)",value:"https://packagist.phpcomposer.com"}),I(n,{label:"Packagist Mirror(packagist.mirrors.sjtug.sjtu.edu.cn)",value:"https://packagist.mirrors.sjtug.sjtu.edu.cn"}),I(n,{label:"腾讯源(mirrors.tencent.com)",value:"https://mirrors.tencent.com/composer/"}),I(n,{label:"华为云(mirrors.huaweicloud.com)",value:"https://mirrors.huaweicloud.com/repository/php/"})]),_:1},8,["modelValue"])]),_:1}),"phpasync"!==P(p)?(C(),q(u,{key:0,label:"执行用户",prop:"command"},{default:U(()=>[I(r,{modelValue:P(v).user,"onUpdate:modelValue":a[6]||(a[6]=e=>P(v).user=e),class:"!w-28rem"},{default:U(()=>[I(n,{label:"www(推荐)",value:"www"}),I(n,{label:"root(不推荐)",value:"root"})]),_:1},8,["modelValue"])]),_:1})):z("",!0),I(u,{label:"执行目录",prop:"composerVersion"},{default:U(()=>[I(d,{modelValue:P(v).path,"onUpdate:modelValue":a[7]||(a[7]=e=>P(v).path=e),icon:"el-folder-opened",onIconClick:M,width:"28rem"},null,8,["modelValue"])]),_:1}),I(u,{label:" ",prop:"composerVersion"},{default:U(()=>[H("div",null,[P(v).comp_lock?(C(),j("span",Ge,[N(O(P(v).comp_lock)+" ",1),I(m,{onClick:J},{default:U(()=>[...a[13]||(a[13]=[N("[点击删除]",-1)])]),_:1})])):z("",!0),P(v).comp_json?(C(),j("span",Fe,O(P(v).comp_json),1)):z("",!0)])]),_:1}),I(u,{label:" "},{default:U(()=>[I(i,{type:"primary",disabled:!!("boolean"!=typeof P(v).comp_json&&P(v).comp_json||"boolean"!=typeof P(v).comp_lock&&P(v).comp_lock),onClick:K},{default:U(()=>[...a[14]||(a[14]=[N(" 执行 ",-1)])]),_:1},8,["disabled"]),I(g,{direction:"vertical",class:"!h-1rem !mx-2rem"}),I(i,{onClick:Q},{default:U(()=>[...a[15]||(a[15]=[N("查看日志",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),H("ul",Me,[a[16]||(a[16]=H("li",null,"Composer是PHP主流依赖包管理器，若您的项目使用Composer管理依赖包，可在此处对依赖进行升级或安装",-1)),a[17]||(a[17]=H("li",null,"Composer版本：当前安装的Composer版本，可点击右侧的【升级Composer】将Composer升级到最新稳定版",-1)),a[18]||(a[18]=H("li",null,"PHP版本：用于执行composer的PHP版本，无特殊要求，默认即可，如安装出错，可尝试选择其它PHP版本",-1)),a[19]||(a[19]=H("li",null,"执行参数：按需选择执行参数,可配合补充命令使用",-1)),a[20]||(a[20]=H("li",null,"补充命令：若此处为空，则按composer.json中的配置执行，此处支持填写完整composer命令",-1)),a[21]||(a[21]=H("li",null,"镜像源：提供【阿里源】和【官方源】，建议国内服务器使用【阿里源】，海外服务器使用【官方源】",-1)),"phpasync"!==P(p)?(C(),j("li",We,"执行用户：默认为www用户，除非您的网站以root权限运行，否则不建议使用root用户执行composer")):z("",!0),a[22]||(a[22]=H("li",null,"执行目录：默认为当前网站根目录",-1))])]),I(x,{title:"请执行完毕确认结果无误后关闭此窗口",onCancel:X,modelValue:P(h),"onUpdate:modelValue":a[8]||(a[8]=e=>E(h)?h.value=e:null),area:[50,42]},{default:U(()=>[I(w,{class:"h-full",title:"全屏查看composer执行日志",content:P(f),isHtml:!0,isRefreshBtn:!1,isAuto:!0},null,8,["content"])]),_:1},8,["modelValue"]),I(x,{title:"composer执行日志",onCancel:X,modelValue:P(y),"onUpdate:modelValue":a[10]||(a[10]=e=>E(y)?y.value=e:null),area:60},{default:U(()=>[H("div",Je,[H("div",Ke,[I(i,{type:"primary",onClick:a[9]||(a[9]=e=>$(!0))},{default:U(()=>[...a[23]||(a[23]=[N(" 刷新日志 ",-1)])]),_:1})]),H("div",$e,[I(w,{class:"h-full",title:"全屏查看composer执行日志",content:P(f),isHtml:!0,isRefreshBtn:!1},null,8,["content"])])])]),_:1},8,["modelValue"])])}}}),Xe={class:"p-1rem relative"},Ye={class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},Ze={key:0},ea=y({__name:"index",setup(e,{expose:l}){const{siteInfo:t}=te(),o=b(!1),n=b(!1),r=w({tomcat:!1}),i=b(""),u=()=>{a({loading:"正在设置，请稍后...",request:_e({siteName:t.value.name}),message:!0,success:e=>{e.status&&c()}})},c=async()=>{a({loading:o,request:ve({siteName:t.value.name}),success:e=>{r.tomcat=e.data.tomcat>0,n.value=!e.data.tomcatversion,i.value=e.data.tomcatversion}})},p=()=>{ie({name:"tomcat",type:"i"})};return V(c),l({init:c}),(e,a)=>{const l=s,t=ne,c=W,d=F("bt-loading");return M((C(),j("div",null,[P(n)?(C(),q(t,{key:0,width:"28rem"},{content:U(()=>[a[2]||(a[2]=N(" 请先安装tomcat， ",-1)),I(l,{onClick:p,class:"!text-small"},{default:U(()=>[...a[1]||(a[1]=[N(" 立即安装 ",-1)])]),_:1})]),_:1})):z("",!0),H("div",Xe,[I(c,{modelValue:P(r).tomcat,"onUpdate:modelValue":a[0]||(a[0]=e=>P(r).tomcat=e),onChange:u},{default:U(()=>[...a[3]||(a[3]=[N(" 启用Tomcat ",-1)])]),_:1},8,["modelValue"]),H("ul",Ye,[P(i)?(C(),j("li",Ze,"当前版本为Tomcat"+O(P(i))+" ,若您需要其它版本,请到软件商店- 所有软件 中切换；",1)):z("",!0),a[4]||(a[4]=H("li",null,"部署顺序: 安装Tomcat >> 创建站点 >> 上传并配置项目 >> 启用Tomcat",-1)),a[5]||(a[5]=H("li",null,"若您的tomcat应用中有php脚本,访问时请添加.php扩展名",-1)),a[6]||(a[6]=H("li",null,"开启成功后,大概需要1-5分钟时间生效!",-1))])])])),[[d,P(o)]])}}}),{siteInfo:aa}=te(),la=b(),ta=b(!1),sa=b(!1),oa=b(!0),na=w({status:!1,gzip_types:"",comp_level:1,min_length:1,unit:"k"}),ra=[{label:"k",value:"k"},{label:"m",value:"m"}],ia=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，越高压缩率越高，但也更消耗CPU"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],ua={gzip_types:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],min_length:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(e,a,l)=>{a?isNaN(Number(a))?l(new Error("请输入数字")):Number(a)<1?l(new Error("请输入正确数字")):l():l(new Error("压缩最小长度不能为空"))}},{}]},ca=async()=>{await la.value.validate();const{gzip_types:e,comp_level:l,min_length:t,unit:s}=na,o={site_name:aa.value.name,gzip_types:e,comp_level:l,min_length:"".concat(t).concat(s)};await a({loading:sa,request:fe(o),message:!0})},pa=async()=>{if(!na.status)return await a({loading:sa,request:he({site_name:aa.value.name})});da()},da=async()=>{await a({loading:sa,request:ge({site_name:aa.value.name}),success:e=>{const{gzip_types:a,comp_level:l,min_length:t}=e.data;Object.assign(na,{gzip_types:a,comp_level:l,min_length:t.slice(0,-1),unit:t.slice(-1)}),oa.value&&(na.status=e.data.status,oa.value=!1)}})},ma={class:"p-[20px]"},_a={class:"mt-[1.6rem]"},va={class:"flex items-center"},fa={class:"ml-[20px]"},ha=y({__name:"index",setup:e=>(V(()=>{da()}),J(()=>{oa.value=!0}),(e,a)=>{const l=$,s=B,o=t,n=R,i=S,u=D,c=G,p=r,d=F("bt-loading");return C(),j("div",ma,[M((C(),q(c,{ref_key:"compressFormRef",ref:la,class:"h-[38rem]",model:P(na),rules:P(ua),"label-width":"100px",disabled:P(sa)},{default:U(()=>[I(s,{label:"内容压缩",prop:"status"},{default:U(()=>[I(l,{modelValue:P(na).status,"onUpdate:modelValue":a[0]||(a[0]=e=>P(na).status=e),onChange:P(pa)},null,8,["modelValue","onChange"])]),_:1}),M(H("div",_a,[I(s,{label:"压缩类型",prop:"gzip_types"},{default:U(()=>[I(o,{modelValue:P(na).gzip_types,"onUpdate:modelValue":a[1]||(a[1]=e=>P(na).gzip_types=e),type:"textarea",width:"42rem",rows:6,resize:"none"},null,8,["modelValue"])]),_:1}),I(s,{label:"压缩级别",prop:"comp_level"},{default:U(()=>[I(i,{class:"!w-[42rem]",modelValue:P(na).comp_level,"onUpdate:modelValue":a[2]||(a[2]=e=>P(na).comp_level=e)},{default:U(()=>[(C(),j(T,null,A(9,e=>I(n,{key:e,label:e,value:String(e)},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),I(s,{label:"压缩最小长度",prop:"min_length"},{default:U(()=>[H("div",va,[I(o,{modelValue:P(na).min_length,"onUpdate:modelValue":a[3]||(a[3]=e=>P(na).min_length=e)},null,8,["modelValue"]),I(s,{prop:"unit"},{default:U(()=>[I(i,{class:"ml-[1rem] !w-[8rem]",modelValue:P(na).unit,"onUpdate:modelValue":a[4]||(a[4]=e=>P(na).unit=e),placeholder:"请选择"},{default:U(()=>[(C(!0),j(T,null,A(P(ra),e=>(C(),q(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1})],512),[[K,P(na).status]]),M(I(s,{label:" ",class:"mt-[1.6rem]"},{default:U(()=>[I(u,{type:"primary",onClick:P(ca)},{default:U(()=>[...a[5]||(a[5]=[N("保存",-1)])]),_:1},8,["onClick"])]),_:1},512),[[K,P(na).status]])]),_:1},8,["model","rules","disabled"])),[[d,P(ta)]]),H("div",fa,[I(p,{options:P(ia)},null,8,["options"])])])})}),ga={class:"px-2rem"},ya={class:"ml-[8px]"},ba=y({__name:"index",setup(e,{expose:l}){const{siteInfo:t}=te(),s=b(!1),o=b([{help:"阻止浏览器上下文中执行恶意JavaScript代码",value:!1,field:"x_xss_protection"},{help:"阻止浏览器的内容嗅探",value:!1,field:"x_content_type_options"},{help:"让浏览器跳转时不携带referrer",value:!1,field:"referrer_policy"},{help:"让浏览器加载内容时只加载自己网站的内容",value:!1,field:"content_security_policy"},{help:"防止浏览器进行用户行为跟踪",value:!1,field:"permissions_policy"}]),n=()=>{let e={};o.value.forEach(a=>{e[a.field]=a.value});const l={site_name:t.value.name,security_info:JSON.stringify(e)};a({loading:"正在设置，请稍后...",request:be(l),message:!0,success:e=>{e.status&&r()}})},r=()=>{a({loading:s,request:ye({site_name:t.value.name}),success:e=>{o.value.forEach(a=>{e.data[a.field]&&(a.value=e.data[a.field])})}})};return V(r),l({init:r}),(e,a)=>{const l=$,t=F("bt-loading");return M((C(),j("div",ga,[(C(!0),j(T,null,A(P(o),(e,a)=>(C(),j("div",{key:a,class:"flex items-center mb-[12px]"},[I(l,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onChange:n},null,8,["modelValue","onUpdate:modelValue"]),H("span",ya,O(e.help),1)]))),128))])),[[t,P(s)]])}}}),wa=Q("CROSS-ORIGIN-ACCESS-STORE",()=>{const e=b({status:!1,siteName:null,project_type:null,allowed_origin:null,allowed_methods:null,allowed_headers:null,exposed_headers:null,allow_credentials:!1});return{formData:e,reset:()=>{e.value.status=!1,e.value.siteName=null,e.value.project_type=null,e.value.allowed_origin=null,e.value.allowed_methods=null,e.value.allowed_headers=null,e.value.exposed_headers=null,e.value.allow_credentials=!1}}}),xa=()=>X(wa()),{formData:Va}=xa(),ka=async e=>{a({request:we({siteName:e.siteName,project_type:e.project_type}),loading:"正在获取跨域访问配置...",success:({data:a})=>{Va.value.siteName=e.siteName,Va.value.project_type=e.project_type,Va.value.status=a.status,Va.value.allowed_origin=a.allowed_origins,Va.value.allowed_methods=a.allow_methods,Va.value.allowed_headers=a.allow_headers,Va.value.exposed_headers=a.expose_headers,Va.value.allow_credentials=a.allow_credentials}})},Ca=async e=>{Va.value.status?(async e=>{a({request:xe(e),loading:"正在设置跨域访问配置...",message:!0,success:a=>{a.status&&ka({siteName:e.siteName,project_type:e.project_type})}})})(e):(async e=>{a({request:Ve({siteName:e.siteName,project_type:e.project_type}),loading:"正在删除跨域访问配置...",message:!0,success:a=>{a.status&&ka({siteName:e.siteName,project_type:e.project_type})}})})(e)},ja={class:"w-full"},Pa=y({__name:"index",setup(e){const{siteInfo:a}=te(),{formData:l}=xa(),t=b(!1),{reset:s}=wa(),{BtForm:o,submit:n,param:r,ref:u}=i({data:()=>l.value,options:e=>Y(()=>[Ie("状态",()=>I("div",{class:"flex items-center"},[I($,{modelValue:e.value.status,"onUpdate:modelValue":a=>e.value.status=a,onChange:e=>{var a;e||null==(a=u.value)||a.clearValidate(["allowed_origin"])}},null),(null==e?void 0:e.value.status)?I("span",{class:"ml-[2rem] text-small text-[#606266]"},[N("当允许行跨域访问")]):null]),"status",{labelWidth:"140px"}),...(null==e?void 0:e.value.status)?[Ie("允许访问的域名",()=>I("div",{class:"flex items-center w-full"},[I("div",null,[I(Z,{placement:"top-start",width:"auto",trigger:"click","popper-class":"green-tips-popover !p-0 !border-none"},{default:()=>I("div",{class:"!p-[12px] bg-primary text-white leading-[2.4rem]"},[N("使用*代表所有域名都可以跨域访问"),I("br",null,null),N("多个域名用 , 分隔")]),reference:()=>I(ee,{type:"textarea",rows:4,class:"!w-[32rem]",placeholder:"使用*代表所有域名都可以跨域访问，多个域名用,分隔",modelValue:e.value.allowed_origin,"onUpdate:modelValue":a=>e.value.allowed_origin=a},null)})])]),"allowed_origin",{rules:[{required:!0,message:"请输入允许访问的域名",trigger:"blur",validator:(a,l,t)=>{var s;(null==(s=null==e?void 0:e.value)?void 0:s.status)?l?t():t(new Error("请输入允许访问的域名")):t()}}],labelWidth:"140px"}),{type:"slots",key:"custom"}]:[],Ie(" ",()=>I("div",{class:"flex items-center w-full ml-[6rem]"},[I(D,{type:"primary",onClick:()=>n()},{default:()=>[N("保存")]})]))]),submit:async(e,a)=>{try{return await a(),Ca(e.value),!0}catch(l){return!1}}});return V(async()=>{s(),t.value=!0,await ka({siteName:a.value.name,project_type:a.value.project_type}),t.value=!1}),(e,a)=>{const l=$,s=Z,n=B,i=ee,u=He,c=ae;return M((C(),j("div",ja,[I(P(o),null,{custom:U(()=>[I(u,null,{config:U(()=>[I(n,{"label-width":"140px",label:"允许跨域携带cookie",prop:"allow_credentials"},{default:U(()=>[I(l,{modelValue:P(r).allow_credentials,"onUpdate:modelValue":a[0]||(a[0]=e=>P(r).allow_credentials=e)},null,8,["modelValue"]),I(s,{placement:"top-start",width:"auto",trigger:"hover","popper-class":"green-tips-popover !p-0 !border-none"},{reference:U(()=>[...a[4]||(a[4]=[H("span",{class:"ml-[8px] bt-ico-ask"},"?",-1)])]),default:U(()=>[a[5]||(a[5]=H("div",{class:"!p-[12px] bg-primary text-white leading-[2.4rem]"},[N(" Access-Control-Allow-Credentials 允许/拒绝浏览器发送凭据（如Cookie）。 "),H("br"),N(" 设为 true 时，请求携带的凭据将被服务器接受，但需同时指定具体源（不能使用 *）。 ")],-1))]),_:1})]),_:1}),I(n,{"label-width":"140px",label:"允许跨域的请求方法",prop:"allowed_methods"},{default:U(()=>[I(s,{placement:"top-start",width:"auto",trigger:"click","popper-class":"green-tips-popover !p-0 !border-none"},{reference:U(()=>[I(i,{type:"textarea",rows:4,class:"!w-[32rem]",modelValue:P(r).allowed_methods,"onUpdate:modelValue":a[1]||(a[1]=e=>P(r).allowed_methods=e),placeholder:"允许跨域的请求方法，例如: GET, POST"},null,8,["modelValue"])]),default:U(()=>[a[6]||(a[6]=H("div",{class:"!p-[12px] bg-primary text-white leading-[2.4rem]"},[N(" Access-Control-Allow-Methods 指定允许的HTTP方法（如 GET, POST, OPTIONS）， "),H("br"),N(" 用于预检请求（OPTIONS）时告知客户端可支持的方法列表。 ")],-1))]),_:1})]),_:1}),I(n,{"label-width":"140px",label:"允许跨域携带的请求头",prop:"allowed_headers"},{default:U(()=>[I(s,{placement:"top-start",width:"auto",trigger:"click","popper-class":"green-tips-popover !p-0 !border-none"},{reference:U(()=>[I(i,{type:"textarea",rows:4,class:"!w-[32rem]",modelValue:P(r).allowed_headers,"onUpdate:modelValue":a[2]||(a[2]=e=>P(r).allowed_headers=e),placeholder:"允许跨域携带的请求头"},null,8,["modelValue"])]),default:U(()=>[a[7]||(a[7]=H("div",{class:"!p-[12px] bg-primary text-white leading-[2.4rem]"},[N(" Access-Control-Allow-Headers 在预检请求中定义允许携带的自定义请求头（如 Content-Type）， "),H("br"),N(" 告知客户端哪些头可安全用于实际请求。 ")],-1))]),_:1})]),_:1}),I(n,{"label-width":"140px",label:"允许浏览器访问的响应头",prop:"exposed_headers"},{default:U(()=>[I(s,{placement:"top-start",width:"auto",trigger:"click","popper-class":"green-tips-popover !p-0 !border-none"},{reference:U(()=>[I(i,{type:"textarea",rows:4,class:"!w-[32rem]",modelValue:P(r).exposed_headers,"onUpdate:modelValue":a[3]||(a[3]=e=>P(r).exposed_headers=e),placeholder:"允许跨域浏览器访问的响应头"},null,8,["modelValue"])]),default:U(()=>[a[8]||(a[8]=H("div",{class:"!p-[12px] bg-primary text-white leading-[2.4rem]"},[N(" Access-Control-Expose-Headers 暴露给浏览器脚本的响应头列表， "),H("br"),N(" 客户端只能访问在此列表中声明的头（如 Content-Range）。 ")],-1))]),_:1})]),_:1})]),_:1})]),_:1})])),[[c,P(t)]])}}}),qa=y({__name:"index",setup(e,{expose:t}){const{siteInfo:s}=te(),o=b(),n=b([]),r=b(!1),{BtOperation:i}=u({options:[{label:"添加计划任务",type:"button",active:!0,onClick:()=>f()}]}),_=async(e,a,l,t)=>{const{label:s,value:o}=t,n=new Map([["stark","即将批量执行选中的计划任务"],["start","即将批量开启选中任务"],["stop","即将批量停止选中任务"],["delete","即将批量删除选中任务"]]),r=async(e,a)=>{const l=new Map([["stark",Ce],["start",ke],["stop",ke],["delete",je]]),{id:t}=e,s=l.get(o);switch(o){case"stark":case"delete":if(s)return s({id:t});break;case"start":case"stop":if(s)return s({id:t,status:"start"===o?1:0})}};await e({title:"批量".concat(s),content:"".concat(n.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},Se()],onConfirm:async()=>(await a(r),w(),!1)})},v=async e=>{await l({title:e.status?"停用计划任务":"启用计划任务",content:e.status?"计划任务暂停后将无法继续运行，您真的要停用这个计划任务吗？":"该计划任务已停用，是否要启用这个计划任务？",icon:"question-filled"}),await a({loading:"正在设置计划任务状态，请稍候...",request:ke({id:e.id}),message:!0,success:w})},f=e=>{c({isAsync:!0,title:"".concat(e?"编辑":"添加","计划任务").concat(e?"【"+e.name+"】":""),area:74,component:()=>p(()=>import("./add-crontab.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:e||!1,sitename:s.value.name,refreshEvent:w},showFooter:!0})},h=e=>{c({isAsync:!0,title:"查看【"+(e.rname||e.name)+"】日志",area:80,compData:{id:e.id},component:()=>p(()=>import("./log-detail2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},g=async e=>{a({loading:"正在执行计划任务，请稍后...",request:Ce({id:e.id}),message:!0,success:()=>{h(e)}})},y=async({id:e,name:t})=>{await l({title:"删除计划任务",content:"您确定要删除计划任务【".concat(t,"】，是否继续？"),icon:"warning-filled"}),a({loading:"正在删除计划任务，请稍后...",request:je({id:e}),message:!0,success:w})},w=async()=>{a({loading:r,request:Pe({sitename:s.value.name}),data:{data:[Array,n]}})},x=le([Oe(),{label:"计划任务",prop:"rname",render:e=>e.rname||e.name},Ee({event:e=>{v(e)},data:["停用","正常"]}),{label:"执行周期",prop:"cycle"},{label:"上次执行时间",prop:"addtime"},Re([{onClick:g,title:"执行"},{onClick:e=>{f(e)},title:"编辑"},{onClick:e=>{h(e)},title:"日志"},{onClick:y,title:"删除"}])]),k=[{label:"执行任务",value:"stark",event:_},{label:"启动任务",value:"start",event:_},{label:"停止任务",value:"stop",event:_},{label:"删除任务",value:"delete",event:_}];return V(w),t({init:w}),(e,a)=>{const l=d,t=m,s=Ae,u=F("bt-loading");return C(),q(s,null,{"header-left":U(()=>[I(P(i))]),"header-right":U(()=>[...a[0]||(a[0]=[])]),content:U(()=>[M(I(l,{ref_key:"cronTableRef",ref:o,"max-height":560,column:P(x),data:P(n)},null,8,["column","data"]),[[u,"正在加载计划任务列表，请稍后...","title"],[u,P(r)]])]),"footer-left":U(()=>[I(t,{"table-ref":P(o),options:P(k)},null,8,["table-ref","options"])]),_:1})}}}),Ua={class:"flex flex-col site-globa-setting-module"},Na={class:"flex items-center"},za=_(y({__name:"index",setup(e){const{siteInfo:l}=te(),t=b(!1),s=w({total_flow:!1}),o=async()=>{a({loading:"正在设置，请稍后...",message:!0,request:Ue({site_id:l.value.id,status:s.total_flow?1:0}),success:e=>{e.status||(s.total_flow=!s.total_flow)}})};return V(()=>{(async()=>{t.value=!0;try{const{data:e}=await qe({site_id:l.value.id});s.total_flow=e.data.status}catch(e){}finally{t.value=!1}})()}),(e,a)=>{const l=$,n=B,i=G,u=r,c=F("bt-loading");return M((C(),j("div",Ua,[I(i,{model:P(s)},{default:U(()=>[I(n,{label:"日流量统计"},{default:U(()=>[H("div",Na,[I(l,{onChange:o,modelValue:P(s).total_flow,"onUpdate:modelValue":a[0]||(a[0]=e=>P(s).total_flow=e)},null,8,["modelValue"]),a[1]||(a[1]=H("span",{class:"text-tertiary ml-[4px]"},"*提示：开启会适量占用服务器内存。",-1))])]),_:1})]),_:1},8,["model"]),I(u,{options:[{content:"不影响监控报表插件的配置。"}],class:"ml-[20px] mt-[20px]"})])),[[c,P(t)]])}}}),[["__scopeId","data-v-34d0cc8a"]]),Ha=Q("cache",()=>({isRefreshCacheList:b(!1)})),Ia=te(),Ta=Ha(),Aa=e=>{const a=e?{...e,_original:{suffix:e.suffix}}:void 0;c({title:e?"编辑缓存规则":"添加缓存规则",area:50,component:()=>p(()=>import("./cache-dialog.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:a,btn:["保存","取消"]})},Oa=async e=>{const t=Array.isArray(e.suffix)?e.suffix.map(e=>".".concat(e)).join(", "):e.suffix;l({title:"删除缓存规则",content:"确定要删除缓存后缀【".concat(t,"】的规则吗？"),onConfirm:async()=>{a({loading:"删除中...",message:!0,request:ze({site_name:Ia.siteInfo.value.name,suffix:e.suffix}),success:()=>{Ta.isRefreshCacheList=!0}})}})},Ea=y({__name:"index",setup(e){const{isRefreshCacheList:a}=X(Ha()),{BtTable:l,BtRefresh:t}=v({request:e=>(async()=>{var e;const a=await Ne({site_name:Ia.siteInfo.value.name}),l=(null==(e=null==a?void 0:a.data)?void 0:e.data)||[];return{data:l,total:l.length}})(),columns:[{label:"缓存后缀",minWidth:200,render:e=>Array.isArray(e.suffix)?e.suffix.map(e=>"".concat(e)).join(", "):e.suffix||"--"},{label:"缓存时间",minWidth:150,render:e=>{const a=e.time_out||"",l=a.match(/^(\d+)([dhms])$/);if(l){const e=l[1],a=l[2],t={d:"天",h:"小时",m:"分钟",s:"秒"};return"".concat(e," ").concat(t[a]||a)}return a||"--"}},Re([{onClick:e=>Aa(e),title:"编辑"},{onClick:e=>Oa(e),title:"删除"}])],extension:[f(a)]});return(e,a)=>{const s=D,o=Ae;return C(),j("div",null,[I(o,null,{"header-left":U(()=>[I(s,{type:"primary",onClick:P(Aa)},{default:U(()=>[...a[0]||(a[0]=[N("添加",-1)])]),_:1},8,["onClick"])]),"header-right":U(()=>[I(P(t))]),content:U(()=>[I(P(l),{"max-height":530})]),_:1})])}}}),Ra=_(y({__name:"index",setup(e,{expose:a}){var l,t,s;const{siteInfo:o}=te(),{plugin:n}=h(),r=null==(l=o.value)?void 0:l.project_type,i=b((null==(t=o.value)?void 0:t.otherName)?null==(s=o.value)?void 0:s.otherName:"phpasync"!==r?"composer":"nginx"),u="phpasync"===r,c=b([{label:"Composer",name:"composer",lazy:!0,isHide:u,render:Qe},{label:"Tomcat",name:"tomcat",lazy:!0,isHide:u,render:ea},{label:"Gzip压缩",name:"gzip",lazy:!0,isHide:u,render:ha},{label:"缓存",name:"cache",lazy:!0,isHide:"nginx"!==n.value.webserver,render:Ea},{label:"请求头配置",name:"nginx",lazy:!0,render:ba},{label:"跨域配置",name:"cors",isHide:u,lazy:!0,render:Pa},{label:"默认文档",name:"defalut",isHide:!u,lazy:!0,render:Te},{label:"计划任务",name:"crontab",isHide:!u,lazy:!0,render:qa},{label:"网站告警",name:"siteAlarm",isHide:!u,lazy:!0,render:De},{label:"日流量统计",name:"totalFlow",lazy:!0,render:za}]),{BtTabs:p}=g({type:"card",value:i,options:c}),d=()=>{c.value=c.value.filter(e=>!0!==e.isHide)};return V(d),a({init:d}),(e,a)=>(C(),q(P(p)))}}),[["__scopeId","data-v-df52a1a3"]]),Sa=Object.freeze(Object.defineProperty({__proto__:null,default:Ra},Symbol.toStringTag,{value:"Module"}));export{Sa as i,Ha as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
