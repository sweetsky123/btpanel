import{L as e,k as t,bE as a,a_ as r,ax as o,N as l,d as s,aj as i}from"./utils-lib.js?v=1763689792";import{c as p,r as n,g as d,e as u,D as m,x as c,O as h,C as y,A as v,z as f,a1 as g,R as b,ad as x,s as w,v as _,y as j}from"./base-lib.js?v=1763689792";import{B as k}from"./index106.js?v=1763689792";import{h as T,f as V,t as C,i as U,S as $}from"./useController14.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./site.js?v=1763689792";import"./useController6.js?v=1763689792";const E={class:"flex items-center"},R=p({__name:"add-proxy-http",setup(i,{expose:p}){const w=n(!1),_=n(!1),j=async()=>{L.value.proxysite="url"===L.value.targetType?"http://":""},$=e=>{if("object"==typeof e)return;if("unix"===L.value.targetType)return void(L.value.todomain="$http_host");let t=e.replace(/^http[s]?:\/\//,"");t=t.replace(/(:|\?|\/|\\)(.*)$/,""),L.value.todomain=t},{BtForm:R,submit:I,param:L}=e({data:{isEdit:!1,targetType:"url",sitename:"",cache:!1,advanced:!1,cachetime:1,proxysite:"http://",todomain:"$http_host",remark:"",port:80,domains:""},options:e=>d(()=>[{type:"custom",render:()=>u(a,{label:"域名",prop:"domains"},{default:()=>[u(k,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"370",visible:w.value,"onUpdate:visible":e=>w.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>u("div",{class:"!p-[12px] bg-primary text-white"},[m("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),u("br",null,null),m("IP地址格式：192.168.1.199"),u("br",null,null),m("如另加端口格式为 www.domain.com:88")]),reference:()=>u(t,{modelValue:e.value.domains,"onUpdate:modelValue":t=>e.value.domains=t,type:"textarea",width:"42rem",rows:6,resize:"none",onInput:t=>{"object"!=typeof t&&(e.value.remark=t.split("\n")[0])},onFocus:()=>w.value=!0,placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n如另加端口格式为 www.domain.com:88"},null)})]}),rules:{domains:[{required:!0,message:"请输入域名",trigger:"blur"},{trigger:["blur","input","change"],validator:(e,t,a)=>{const o=t.split("\n").filter(e=>e.length),l=o.findIndex(e=>e.split(":")[0].length<3);o.map((e,t)=>{r(e.split(":")[0])||a(new Error("当前域名格式错误，第".concat(t+1,"行，内容:").concat(e)))}),-1!==l?a(new Error("第 ".concat(l+1," 个域名长度不符合要求（必须大于3个字符）"))):a()}}]}},{type:"slots",key:"proxysite",rules:{proxysite:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(t,a,r)=>{if(!a)return void r(new Error("url"===e.value.targetType?"目标地址不能为空":"请选择sock文件"));if("unix"===e.value.targetType)return void r();const o=a.trim();if(/^https?:\/\/$/.test(o))return void r(new Error("请输入目标URL域名"));if(!/^https?:\/\/.+/.test(o))return void r(new Error("目标URL格式不正确，应以http://或https://开头"));let l=a.replace(/^http[s]?:\/\//,"");l=l.replace(/(:|\?|\/|\\)(.*)$/,""),/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(l)?e.value.todomain="$http_host":e.value.todomain=l,r()}}]}},{type:"slots",key:"todomain",rules:{todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}]}},{type:"input",label:"备注",key:"remark",attrs:{placeholder:"请输入备注，可为空",width:"42rem"}},{type:"help",options:T}]),submit:V});return p({onConfirm:async e=>{await I()&&e("close")}}),(e,a)=>{const r=x;return c(),h(f(R),{class:"p-2rem","label-width":"100px"},{proxysite:y(()=>[u(r,{label:"目标",prop:"proxysite","label-width":"100px"},{default:y(()=>[v("div",E,[u(r,{"label-width":"50px"},{default:y(()=>[u(f(o),{modelValue:f(L).targetType,"onUpdate:modelValue":a[0]||(a[0]=e=>f(L).targetType=e),placeholder:"请选择",options:f(C),style:{width:"16rem","margin-right":"1rem"},onChange:j},null,8,["modelValue","options"])]),_:1}),u(f(t),{modelValue:f(L).proxysite,"onUpdate:modelValue":a[2]||(a[2]=e=>f(L).proxysite=e),placeholder:"url"===f(L).targetType?"请输入目标地址":"请选择sock文件",width:"24rem",iconType:"url"!==f(L).targetType&&"folder",onInput:$},g({_:2},["url"!==f(L).targetType?{name:"append",fn:y(()=>[u(f(l),{onClick:a[1]||(a[1]=e=>f(U)(f(L)))},{default:y(()=>[u(f(s),{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","iconType"])])]),_:1})]),todomain:y(()=>[u(r,{label:"发送域名(host)",prop:"todomain","label-width":"100px"},{default:y(()=>[u(f(k),{placement:"top-start",effect:"dark",title:"",content:"请求转发到后端服务器时的主机名，一般为$http_host，如果目标URL是域名，则需要改为域名",width:"400",visible:f(_),"onUpdate:visible":a[5]||(a[5]=e=>b(_)?_.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:y(()=>[u(f(t),{onFocus:a[3]||(a[3]=e=>_.value=!0),modelValue:f(L).todomain,"onUpdate:modelValue":a[4]||(a[4]=e=>f(L).todomain=e),placeholder:"请输入发送域名",width:"42rem"},null,8,["modelValue"])]),_:1},8,["visible"])]),_:1})]),_:1})}}}),I=p({__name:"index",emits:["close"],setup(e,{expose:t,emit:a}){const{proxyType:r}=w($()),o=n("http"),l=a,s=n(),{BtTabs:p,tabs:d,tabsRefs:m}=i({type:"card",value:o,options:[{label:"HTTP",name:"http",render:()=>u(R,null,null)}]});return t({onConfirm:()=>{switch(d.value){case"http":s.value.onConfirm(l);break;case"tcp":m().tcp.onConfirm(l)}}}),_(()=>{o.value=r.value}),(e,t)=>(c(),j("div",null,[u(R,{ref_key:"addProxyHttpRef",ref:s},null,512)]))}});export{I as default};
