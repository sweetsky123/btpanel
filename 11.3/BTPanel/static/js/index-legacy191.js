!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function l(n,a,u,o){var l=a&&a.prototype instanceof c?a:c,s=Object.create(l.prototype);return r(s,"_invoke",function(n,r,a){var u,o,l,c=0,s=a||[],f=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,n){return u=e,o=0,l=t,p.n=n,i}};function v(n,r){for(o=n,l=r,e=0;!f&&c&&!a&&e<s.length;e++){var a,u=s[e],v=p.p,d=u[2];n>3?(a=d===r)&&(l=u[(o=u[4])?5:(o=3,3)],u[4]=u[5]=t):u[0]<=v&&((a=n<2&&v<u[1])?(o=0,p.v=r,p.n=u[1]):v<d&&(a=n<3||u[0]>r||r>d)&&(u[4]=n,u[5]=r,p.n=d,o=0))}if(a||n>1)return i;throw f=!0,r}return function(a,s,d){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&v(s,d),o=s,l=d;(e=o<2?t:l)||!f;){u||(o?o<3?(o>1&&(p.n=-1),v(o,l)):p.n=l:p.v=l);try{if(c=2,u){if(o||(a="next"),e=u[a]){if(!(e=e.call(u,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=u.return)&&e.call(u),o<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),o=1);u=t}else if((e=(f=p.n<0)?l:n.call(r,p))!==i)break}catch(e){u=t,o=1,l=e}finally{c=1}}return{value:e,done:f}}}(n,u,o),!0),s}var i={};function c(){}function s(){}function f(){}e=Object.getPrototypeOf;var p=[][u]?e(e([][u]())):(r(e={},u,function(){return this}),e),v=f.prototype=c.prototype=Object.create(p);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,r(t,o,"GeneratorFunction")),t.prototype=Object.create(v),t}return s.prototype=f,r(v,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,o,"GeneratorFunction"),r(v),r(v,o,"Generator"),r(v,u,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:d}})()}function r(t,e,n,a){var u=Object.defineProperty;try{u({},"",{})}catch(t){u=0}r=function(t,e,n,a){function o(e,n){r(t,e,function(t){return this._invoke(e,n,t)})}e?u?u(t,e,{value:n,enumerable:!a,configurable:!a,writable:!a}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},r(t,e,n,a)}function a(t,e,n,r,a,u,o){try{var l=t[u](o),i=l.value}catch(t){return void n(t)}l.done?e(i):Promise.resolve(i).then(r,a)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(r,u){var o=t.apply(e,n);function l(t){a(o,r,u,l,i,"next",t)}function i(t){a(o,r,u,l,i,"throw",t)}l(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./validator-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./index-legacy106.js?v=1763689792","./index-legacy123.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./column-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792"],function(e,r){"use strict";var a,o,l,i,c,s,f,p,v,d,m,y,g,h,b,x,w,k,A,j,_,T,S,I,O,B,C,L,E,G,z,P,R,F,Z,q,M,J,Q,V,D,X,K,U,H,N,Y,W,$,tt,et,nt,rt,at,ut;return{setters:[function(t){a=t.u,o=t.br,l=t.ak,i=t.i3,c=t.ay,s=t.e,f=t.az,p=t.am,v=t.H,d=t.p,m=t.i4,y=t.b,g=t._,h=t.i5,b=t.n,x=t.f0,w=t.Q,k=t.i6,A=t.aA,j=t.d,_=t.f,T=t.i7,S=t.aj,I=t.bb},function(t){O=t.c,B=t.r,C=t.aB,L=t.v,E=t.I,G=t.J,z=t.z,P=t.x,R=t.y,F=t.A,Z=t.e,q=t.C,M=t.D,J=t.G,Q=t.F,V=t.b1,D=t.n,X=t.ay,K=t.b2,U=t.B,H=t.L,N=t.O,Y=t.av,W=t.g,$=t.w,tt=t.a0},function(t){et=t._},function(t){nt=t.aJ},function(t){rt=t._},function(t){at=t.B},function(t){ut=t._},null,null,null],execute:function(){var ot={class:"w-full h-full flex flex-col justify-center content-center"},lt={key:0,class:"h-full"},it={class:"flex align-middle justify-center h-full"},ct={key:1,class:"taskList pr-[10px] mb-[10px]"},st={key:0,class:"taskTips flex justify-between"},ft={class:"taskItemHeader"},pt={class:"taskItemName"},vt=["onClick"],dt={key:0,id:"taskRealTimeLogs",class:"taskRealTimeLog"},mt=O({__name:"task-list",setup:function(e,g){var h=g.expose,b=a().panel,x=y(),w=B(!0),k=B(!0),A=B([]),j=B(""),_=B(!1),T=B(C("msgBoxSockShell",null)),S=[],I=null,O=function(){var t=u(n().m(function t(){var e,r,a,u,c,s,f;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,w.value=!0,t.n=1,o();case 1:e=t.v,r=e.data,l(r)&&void 0!==r.task?(a=r.task,u=r.msg,b.value.msgBoxTaskCount=a.length,a.length>0&&(k.value=!0,A.value=a,c=a[0],s=c.type,f=c.status,"execshell"===s?"-1"===f?(N(),j.value="",j.value=u,D(function(){return i("#taskRealTimeLogs")}),_.value=!0):(setTimeout(function(){O()},2e3),_.value=!0):_.value=!1)):(b.value.msgBoxTaskCount=0,k.value=!1),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.p=3,w.value=!1,t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}));return function(){return t.apply(this,arguments)}}(),N=function(){var t=u(n().m(function t(){return n().w(function(t){for(;;)switch(t.n){case 0:if(!T.value){t.n=1;break}return t.a(2);case 1:T.value=c({route:"/sock_shell",onMessage:function(){var t=u(n().m(function t(e,r){var a;return n().w(function(t){for(;;)switch(t.n){case 0:if(!((a=r.data).indexOf("|-Successify --- 命令已执行! ---")>-1)){t.n=3;break}return t.n=1,O();case 1:return t.n=2,W();case 2:setTimeout(u(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,O();case 1:if(!_.value){t.n=2;break}return t.a(2);case 2:null===(e=T.value)||void 0===e||e.close(),T.value=null,j.value="";case 3:return t.a(2)}},t)})),2e3),t.n=5;break;case 3:if(!f(a)){t.n=5;break}if(S.push(a),(null==S?void 0:S.length)>50&&S.shift(),!p(I)){t.n=4;break}return t.a(2);case 4:I=setTimeout(function(){j.value=S.join(""),I=null},500);case 5:return t.a(2)}},t)}));return function(e,n){return t.apply(this,arguments)}}()}),T.value.send("tail -n 100 -f /tmp/panelExec.log");case 2:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=u(n().m(function t(e){var r,a,u;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return r=null,t.p=1,t.n=2,d({icon:"warning-filled",title:"删除任务",content:"删除当前选中任务，删除后将取消任务执行，是否继续操作？"});case 2:return r=x.load("正在删除任务，请稍后..."),t.n=3,m({id:e});case 3:u=t.v,x.request(u),u.status&&O(),null===(a=T.value)||void 0===a||a.close(),t.n=5;break;case 4:t.p=4,t.v;case 5:return t.p=5,r.close(),t.f(5);case 6:return t.a(2)}},t,null,[[1,4,5,6]])}));return function(e){return t.apply(this,arguments)}}(),W=function(){var t=u(n().m(function t(){var e,a,u;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,v(function(){return r.import("./validator-legacy.js?v=1763689792").then(function(t){return t.dk})},void 0,r.meta.url);case 1:e=t.v,a=e.useSoftStore,u=a(),(0,u.refreshRouteData)("1");case 2:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}();return h({init:O}),L(O),function(e,n){var r=X,a=s,u=K,o=et,l=E("scroll-bottom"),i=E("bt-loading");return G((P(),R("div",ot,[z(k)?(P(),R("div",ct,[z(A).length>0?(P(),R("div",st,[n[3]||(n[3]=F("span",null," 提示：若任务长时间未执行，请尝试点击【重启面板】来重置任务队列 ",-1)),Z(a,{onClick:z(nt)},{default:q(function(){return t(n[2]||(n[2]=[M("重启面板",-1)]))}),_:1},8,["onClick"])])):J("",!0),Z(u,{class:"!my-1rem"}),(P(!0),R(Q,null,V(z(A),function(t,e){return P(),R("div",{key:e,class:"taskItem"},["execshell"===t.type?(P(),R(Q,{key:0},[F("div",ft,[F("span",pt,U(t.name),1),F("span",null,[F("span",{class:H({leaveOut:"-1"===t.status})},U("0"===t.status?"等待":"正在安装"),3),Z(o),F("span",{class:"bt-link",onClick:function(e){return Y(t.id)}}," 删除 ",8,vt)])]),"-1"===t.status&&"execshell"===t.type?G((P(),R("pre",dt,[M(U(z(j)),1)])),[[l]]):J("",!0)],64)):J("",!0)])}),128))])):(P(),R("div",lt,[F("div",it,[Z(r,{class:"flex"},{image:q(function(){return t(n[0]||(n[0]=[F("i",{class:"!text-tertiary svgtofont-empty !text-[7rem]"},null,-1)]))}),description:q(function(){return t(n[1]||(n[1]=[F("span",{class:"text-medium text-secondary"},"当前没有任务执行",-1)]))}),_:1})])]))])),[[i,z(w)]])}}}),yt=g(mt,[["__scopeId","data-v-9c867db8"]]),gt={class:"mt-8px leading-8 text-small list-disc ml-20px"},ht={id:"wechat-customer",class:"wechat-customer"},bt={class:"customer-title"},xt={class:"flex border-solid border-b-1 border-primary text-primary justify-center items-center"},wt={class:"qrcode-wechat w-[128px] h-[128px] mt-[8px] mb-[4px]"},kt={id:"wechatCustomerQrcode"},At=O({__name:"completed-list",setup:function(e,a){var o=a.expose,l=B([{label:"名称",prop:"name",showOverflowTooltip:!0,render:function(t){return Z("div",null,[Z("span",{class:"mr-2 font-bold !text-small ".concat(t.install_status?"text-primary svgtofont-el-check":"text-danger svgtofont-el-close")},null),t.name])}},{label:"创建时间",prop:"addtime",width:110,render:function(t){return Z("span",null,[t.addtime.replace(/^\d{4}-/,"")])}},{label:"任务耗时",width:80,render:function(t){return Z("span",null,[h(t.end-t.start)])}},{label:"安装详情",width:140,showOverflowTooltip:!0,render:function(t){return Z("span",{class:t.install_status?"text-primary":"text-danger"},[t.install_status?"安装成功":"安装失败"])}},{label:"操作",align:"right",width:55,render:function(t){return null!==t.msg_info?Z("span",{class:"text-primary cursor-pointer",onClick:function(){return c(t)}},[M("详情")]):""}}]),i=function(){var t=u(n().m(function t(e){var r,a,u;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,w({request:k({table:"tasks",search:"1",limit:10,p:e.p}),data:{page:String,data:Array}});case 1:return r=t.v,a=r.data,u=r.page,t.a(2,{data:a,total:A(u),other:{}});case 2:return t.p=2,t.v,t.a(2,{data:[],total:0,other:{}})}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),c=function(t){return b({title:"当前状态：".concat(t.msg_info.title),area:[72,50],compData:t.msg_info,component:function(){return v(function(){return r.import("./details-legacy.js?v=1763689792")},void 0,r.meta.url)}})},f=x({request:i,columns:l.value}),p=f.BtTable,d=f.BtPage;return o({init:f.refresh}),function(e,n){var r=j,a=s,u=_,o=at,l=rt;return P(),N(l,null,{content:q(function(){return[Z(z(p)),F("ul",gt,[F("li",null,[n[4]||(n[4]=M(" 如安装或启动失败，请点击详情，截图相关错误信息 ",-1)),Z(o,{placement:"bottom-start",effect:"light","popper-class":"!p-0",trigger:"hover",width:"160px"},{reference:q(function(){return t(n[3]||(n[3]=[F("span",{class:"inline-block bt-link"},"咨询客服",-1)]))}),default:q(function(){return[F("div",ht,[F("div",bt,[Z(a,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-medium cursor-pointer flex flex-row items-center flex-nowrap"},{default:q(function(){return[F("div",xt,[n[0]||(n[0]=M(" 点击咨询客服 ",-1)),Z(r,{icon:"arrow",size:16,color:"var(--el-color-primary)",class:"ml-[5px]"})])]}),_:1})]),F("div",wt,[F("div",kt,[Z(u,{src:"/customer/customer-qrcode.png"})])]),n[1]||(n[1]=F("div",{class:"wechat-title flex"},[F("img",{class:"w-[14px] h-[14px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),F("div",{class:"text-base font-black"},"扫一扫")],-1)),n[2]||(n[2]=F("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[F("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]}),_:1}),n[5]||(n[5]=M(" 求助 ",-1))])])]}),"footer-right":q(function(){return[Z(z(d),{"pager-count":5,layout:"prev, pager, next, total, jumper"})]}),_:1})}}}),jt=g(At,[["__scopeId","data-v-5c82b1da"]]),_t=O({__name:"perform-log",setup:function(t,e){var r=e.expose,a=B(!1),o=B("获取中..."),l=function(){var t=u(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,w({loading:a,request:T(),data:String});case 1:e=t.v,o.value=e.trim()||"暂无执行日志",t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}();return r({init:l}),L(l),function(t,e){var n=ut,r=E("bt-loading");return G((P(),N(n,{class:"h-50rem",content:z(o)},null,8,["content"])),[[r,z(a)]])}}}),Tt=function(t){return t.taskList="taskList",t.completedList="completedList",t.performLog="performLog",t}(Tt||{});e("default",O({__name:"index",setup:function(t,e){var r=e.expose,o=a().panel,l=Y(o.value,"msgBoxTaskCount"),i=B(0),c=B(null),s=W(function(){return"任务列表(".concat(l.value,")")}),f=W(function(){return"消息列表(".concat(i.value,")")});$(l,function(t,e){e>t&&(i.value+=e-t)});var p=S({type:"left-bg-card",options:[{label:function(){return Z(Q,null,[s.value])},name:Tt.taskList,lazy:!0,render:yt},{label:function(){return Z(Q,null,[f.value])},name:"completedList",lazy:!0,render:jt},{label:"执行日志",name:"performLog",lazy:!0,render:_t}]}).BtTabs,v=function(){var t=u(n().m(function t(){var e,r;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,w({request:I({table:"tasks",search:"1",limit:11}),data:{page:String}});case 1:e=t.v,r=e.page,i.value=A(r),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}();return L(v),tt("msgBoxSockShell",c),r({onCancel:function(){c.value&&(c.value.close(),c.value=null)}}),function(t,e){return P(),N(z(p))}}}))}}})}();
