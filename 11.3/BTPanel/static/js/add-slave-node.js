import{L as e,M as s,lR as a,h9 as o}from"./utils-lib.js?v=1763689792";import{c as l,aH as t,r as i,g as n,e as r,an as d,am as p,D as m,x as u,y as _,z as c}from"./base-lib.js?v=1763689792";import{h as v,f}from"./form-item.js?v=1763689792";import{u as j}from"./index68.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./useController6.js?v=1763689792";import"./site.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";const g={class:"p-[2rem]"},w=l({__name:"add-slave-node",props:{compData:{default:()=>({group_id:"",nodes:[]})}},setup(l,{expose:w}){const{redisGroupDetail:b,isRedisRefreshList:h}=j(),x=t(),y=l,D=i(y.compData.nodes.map(e=>({label:"".concat(e.server_ip," - Redis ").concat(e.redis_version),value:e.id}))),{BtForm:R,submit:C}=e({data:{new_slave_node_id:[]},options:e=>n(()=>[v("选择节点",()=>r("div",{class:"w-full"},[r(d,{modelValue:e.value.new_slave_node_id,"onUpdate:modelValue":s=>e.value.new_slave_node_id=s,"popper-class":"slave-select-popper",placeholder:"请选择要添加的从节点"},{default:()=>r("div",null,[D.value.map(e=>r(p,{label:e.label,value:e.value},null))]),empty:()=>r("div",{style:"text-align: center;"},[m("暂无可用的Redis节点，"),r("span",{class:"bt-link",onClick:()=>{x&&"function"==typeof x.push?x.push({name:"node-mgt"}):window.location.href="/node/node-mgt"}},[m("去添加")])])})]),"new_slave_node_id",{rules:[{required:!0,message:"请选择要添加的从节点"}]}),f(" ",[{content:"只显示可用的Redis节点，已在复制组中的节点不会显示"}])]),submit:async(e,l,t)=>{let i=null;try{await l(),i=s.load("正在配置从节点信息，请稍后...");const{new_slave_node_id:t}=e.value,n=await a({group_id:y.compData.group_id,new_slave_node_id:t});if(n.status){const{data:e}=await o({group_id:y.compData.group_id});b.value.slave_details=e.data.slave_details,h.value=!0,s.success(n.msg||"添加从节点成功")}else s.error(n.msg||"添加从节点失败");return n.status}catch(n){return!1}finally{null==i||i.close()}}});return w({onConfirm:C}),(e,s)=>(u(),_("div",g,[r(c(R))]))}});export{w as default};
