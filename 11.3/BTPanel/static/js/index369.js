import{L as a,as as e,h6 as l,_ as t}from"./utils-lib.js?v=1763689792";import{c as s,r as o,g as i,e as u,c5 as n,H as p,D as d,az as r,ax as _,an as m,am as c,v as h,a8 as v,x as b,y as f,z as x}from"./base-lib.js?v=1763689792";import{b as w,h as g,j,F as y}from"./form-item.js?v=1763689792";import{u as k,h as C,c as D,a as H,r as V}from"./index67.js?v=1763689792";import{c as I}from"./useController12.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./index260.js?v=1763689792";const z={class:"p-[2rem]"},E=t(s({__name:"index",setup(t,{expose:s}){const{isHttpClbEdit:E,addNodeData:F,httpRowData:L,nodeClbHttpRefresh:N,domainList:P}=k(),R=o([{label:"轮询 - 按照权重依次分配请求到上游服务器",value:"round_robin"},{label:"coockie跟随 - 基于coockie选择实际的上游服务，保证每位访问者每次访问到同一个上游服务器",value:"sticky_cookie"},{label:"IP跟随 - 基于访问者的IP地址选择实际的上游服务，保证每位访问者每次访问到同一个上游服务器（拥有CDN的网站不推荐使用）",value:"ip_hash"},{label:"最少链接 - 每次优先选择当前链接数量较少的上游服务器来处理访问者的请求",value:"least_conn"}]),{BtForm:U,submit:q}=a({data:C,options:a=>i(()=>[w("名称","ps",{attrs:{disabled:E.value,class:"!w-[320px]",placeholder:"请输入负载均衡名称"},rules:[{required:!0,message:"请输入负载均衡名称"},{validator:(a,e,l)=>{e.length>=3?l():l(new Error("请输入至少大于3个字符"))},trigger:["blur","change"]}]}),!E.value&&g("选择网站",()=>u(n,{modelValue:a.value.site_name,"onUpdate:modelValue":e=>a.value.site_name=e,"fetch-suggestions":D(P.value),clearable:!0,class:"inline-input !w-[32rem]",onSelect:a=>a.value.value,"value-key":"label",placeholder:"请输入或选择网站"},null),"site_name"),j("负载方式","http_alg",R.value,{attrs:{placeholder:"请选择负载方式",class:"!w-[74rem]"}}),y(()=>u("div",null,[u("div",{class:"flex justify-between items-center mb-5"},[u(p,{type:"primary",onClick:H},{default:()=>[d("添加负载均衡节点")]})]),u(r,{data:F.value,"table-layout":"auto"},{default:()=>[u(_,{prop:"node_remarks",label:"负载均衡节点",width:"120"},null),u(_,{prop:"node_site_name",label:"节点网站",width:"120"},null),u(_,{prop:"port",label:"端口",width:"70"},null),u(_,{prop:"path",label:"验证路径",width:"100"},null),u(_,{prop:"node_status",label:"节点状态"},{default:({row:a})=>u(m,{modelValue:a.node_status,"onUpdate:modelValue":e=>a.node_status=e,style:"width: 70px"},{default:()=>[u(c,{label:"参与",value:"online"},null),u(c,{label:"备份",value:"backup"},null),u(c,{label:"停用",value:"down"},null)]})}),u(_,{prop:"weight",label:"权重",width:"60"},null),u(_,{prop:"max_fail",label:"最大失败次数",width:"90"},null),u(_,{prop:"fail_timeout",label:"恢复时间（秒）",width:"100"},null),u(_,{prop:"ps",label:"备注"},null),u(_,{label:"操作",width:"60"},{default:a=>u("span",{class:"bt-link",onClick:()=>V(a.$index)},[d("删除")])})]})]))]),submit:async(a,t,s)=>{var o,i,u,n;try{await t();let{ps:s,site_name:p,http_alg:d,site_id:r,load_id:_}=a.value;const m=e(F.value);r=null==(o=P.value.find(a=>a.label===p))?void 0:o.value;const c={ps:s,site_name:p,...l(r)?{}:{site_id:r},http_config:{http_alg:d,proxy_next_upstream:"error timeout http_500 http_502 http_503 http_504",proxy_cache_status:(null==(i=F.value.http_config)?void 0:i.proxy_cache_status)||!1,cache_time:(null==(u=F.value.http_config)?void 0:u.cache_time)||"1d",cache_suffix:(null==(n=F.value.http_config)?void 0:n.cache_suffix)||"css,js,jpe,jpeg,gif,png,webp,woff,eot,ttf,svg,ico,css.map,js.map"},nodes:m};return E.value&&(c.http_config.proxy_next_upstream=a.value.http_config.proxy_next_upstream,c.site_id=a.value.site_id,c.load_id=_,c.name=a.value.name),await I({mod_name:"node",sub_mod_name:"load",def_name:E.value?"modify_http_load":"create_http_load",ws_callback:E.value?"modify_http_load":"create_http_load",data:{...c}}),N.value=!0,!0}catch(p){return!1}}});return s({onConfirm:q}),h(()=>{l(L.value)||(F.value=e(L.value.nodes))}),v(()=>{F.value=[]}),(a,e)=>(b(),f("div",z,[u(x(U))]))}}),[["__scopeId","data-v-3289b3fd"]]);export{E as default};
