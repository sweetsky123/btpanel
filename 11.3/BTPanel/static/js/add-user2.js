import{c as e,r as a,o as s,v as l,I as r,x as d,y as o,J as t,z as u,O as m,C as n,e as i,F as p,b1 as b,K as c,S as h,am as f,an as w,ad as g,bc as _,ab as V}from"./base-lib.js?v=1763689792";import{b6 as v,ci as y,M as U,Q as j,k as q}from"./utils-lib.js?v=1763689792";import{getDatabasesList as x,addUser as D}from"./database.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const F={class:"p-[24px]"},k=e({__name:"add-user",props:{compData:{default:()=>{}}},setup(e,{expose:k}){const C=e,E=a([]),S=a(null),z=a(C.compData.serverList),H=s({sid:0,username:"",password:v(),host:"127.0.0.1",dbname:"*",tbname:"*",address:"",access:"",disabled:!1,selected:[1,6,21,22],loading:!1}),I={username:[{required:!0,message:"请输入用户名",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],address:[{required:!0,validator:(e,a,s)=>{y(a)||"ip"!==H.host?s():s(new Error("请输入正确的ip地址"))},trigger:["blur"]}],tbname:[{required:!0,validator:(e,a,s)=>{""===a&&"*"!==H.dbname?s(new Error("请选择数据库表")):s()},trigger:["blur"]}]},J=async()=>{try{H.loading=!0;const e=await x({sid:H.sid});E.value=e.data}catch(e){U.error(e)}finally{H.loading=!1}};return k({onConfirm:async e=>{try{await S.value.validate();const a=("ip"===H.host&&(H.host=H.address),"*"===H.dbname&&(H.tbname="*"),{sid:H.sid,username:H.username,password:H.password,host:H.host,db_name:H.dbname,tb_name:H.tbname});await j({loading:"正在添加用户,请稍后...",request:D(a),message:!0,success:a=>{a.status&&(C.compData.refreshFn&&C.compData.refreshFn(),e())}})}catch(a){}}}),l(J),(e,a)=>{const s=f,l=w,v=g,y=q,U=_,j=V,x=r("bt-loading");return d(),o("div",F,[t((d(),m(j,{"label-width":"90px",model:u(H),ref_key:"addUserFormRef",ref:S,rules:I,onSubmit:a[5]||(a[5]=h(()=>{},["prevent"]))},{default:n(()=>[i(v,{label:"服务器",prop:"password"},{default:n(()=>[i(l,{modelValue:u(H).sid,"onUpdate:modelValue":a[0]||(a[0]=e=>u(H).sid=e),class:"mr-[1.5rem] !w-[16rem]",placeholder:"请选择",onChange:J},{default:n(()=>[(d(!0),o(p,null,b(u(z),e=>(d(),m(s,{key:e.id,label:e.ps,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(v,{label:"用户名",prop:"username"},{default:n(()=>[i(y,{width:"38rem",placeholder:"请填写用户名",modelValue:u(H).username,"onUpdate:modelValue":a[1]||(a[1]=e=>u(H).username=e)},null,8,["modelValue"])]),_:1}),i(v,{label:"密码",prop:"password"},{default:n(()=>[i(y,{width:"38rem",iconType:"refresh",modelValue:u(H).password,"onUpdate:modelValue":a[2]||(a[2]=e=>u(H).password=e),"is-null":!0},null,8,["modelValue"])]),_:1}),i(v,{label:"访问权限",prop:"host"},{default:n(()=>[i(U,{span:8},{default:n(()=>[i(l,{modelValue:u(H).host,"onUpdate:modelValue":a[3]||(a[3]=e=>u(H).host=e),class:"!w-[16rem]"},{default:n(()=>[i(s,{label:"所有人",value:"%"}),i(s,{label:"本地服务器",value:"127.0.0.1"}),i(s,{label:"指定ip",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(i(v,{prop:"address"},{default:n(()=>[i(y,{placeholder:"请输入指定ip",modelValue:u(H).address,"onUpdate:modelValue":a[4]||(a[4]=e=>u(H).address=e),width:"22.3rem",class:"ml-[1rem]"},null,8,["modelValue"])]),_:1},512),[[c,"ip"===u(H).host]])]),_:1})]),_:1},8,["model"])),[[x,u(H).loading]])])}}});export{k as default};
