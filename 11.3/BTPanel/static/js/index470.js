import{u as e,p as a,aK as t,aC as l,e as s,$ as r,j as o,b as i,H as n}from"./utils-lib.js?v=1763689792";import{c as m,r as u,o as c,g as p,a0 as d,v,I as _,J as f,z as y,x as b,y as x,F as g,e as h,R as w,O as j,C as D,D as V,G as T,A as k,b1 as N,H as E,b9 as I,an as L,ad as R,ab as z,d as C,am as O}from"./base-lib.js?v=1763689792";import{_ as P}from"./index124.js?v=1763689792";import{_ as A}from"./index137.js?v=1763689792";import{o as S}from"./useController6.js?v=1763689792";import{serviceAdmin as U,getPluginInfo as F,getProofFind as H,setConfigSite as J}from"./site.js?v=1763689792";import{u as M}from"./useStore4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";const q=""+new URL("../images/soft_ico/tamper_core_service.png",import.meta.url).href,G={class:"relative h-full"},K={class:"flex items-center"},$={key:2,class:"absolute top-0 z-10 h-full w-full bg-lighter text-center flex flex-col items-center justify-center"},B={class:"p-2rem"},Q=m({__name:"index",props:{compData:{default:{}}},setup(m,{expose:Q}){const W=C(()=>n(()=>import("./overview.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),X=C(()=>n(()=>import("./exclude-protect-ext.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),Y=C(()=>n(()=>import("./protect-ext.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),Z=C(()=>n(()=>import("./advanced2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),ee=C(()=>n(()=>import("./white-list.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)),ae=i(),{payment:te}=e(),{siteInfo:le}=M(),se=u(!1),re=u(),oe=u("pro"===te.value.authType?"tamper_proof_refactored":"tamper_core"),ie=u(!1),ne=u(!1),me=u({}),ue=u(!1),ce=u(),pe=u(!1),de=c({sites:[],list:[]}),ve=c({sites:[{required:!0,message:"请选择同步配置",trigger:"blur"}]}),_e=[{isHtml:!0,content:'【一键应用】将当前网站已配置的<span class="text-danger">排除目录</span>，<span class="text-danger">防护文件</span>，同步配置到其他网站'}],fe=p(()=>{const e="tamper_core"==oe.value;return{title:"".concat(e?"堡塔企业级防篡改":"网站防篡改程序","-功能介绍"),height:36,ps:"".concat(e?"内核版防篡改,用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为，支持Centos/Debian/Ubuntu，注意：不能与其它防篡改软件同时使用":"事件型防篡改，用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为"),source:e?180:46,desc:["保护站点内容安全","阻止黑客非法修改网页","阻止网站被挂马","阻止其他入侵行为"],isInstall:ne.value,tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/".concat(e?"tamper_core_preview":"tamper_proof_preview",".png")],pluginInfo:me.value}}),ye=u("overview"),be=u(),xe=u(!0),ge=[{content:"启动",event:()=>he("start")},{content:"重启",event:()=>he("restart")},{content:"重载配置",event:()=>he("reload")}],he=async e=>{let l;try{let t="";switch(e){case"start":t="启动";break;case"restart":t="重启";break;case"reload":t="重载"}await a({title:"".concat(t,"防篡改服务"),content:"".concat(t,"项目后，当前服务将").concat(t,"运行，是否继续操作？")}),l=ae.load("正在".concat(t,"防篡改服务，请稍候..."));const s=await U({action:e});ae.msg({customClass:"bt-message-error-html !max-w-[36rem]",dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",showClose:!s.status,duration:s.status?5e3:0}),s.status&&we()}catch(s){t(s)}finally{null==l||l.close()}},we=async()=>{try{se.value=!0;const{data:e}=await F({sName:"tamper_core"}),{data:a}=await F({sName:"tamper_proof_refactored"}),t=e.setup&&e.endtime>0,l=a.setup&&a.endtime>=0;ie.value=!1,ne.value=!0,t?oe.value="tamper_core":l?oe.value="tamper_proof_refactored":(oe.value="pro"===te.value.authType?"tamper_proof_refactored":"tamper_core","free"===te.value.authType?ne.value=!1:ie.value=!0),ie.value=t||l,me.value="tamper_core"==oe.value?e:a;let s={type:oe.value,maskLayer:ie.value};"tamper_core"==oe.value?(s.isVersion=parseFloat(e.version)>=3.2,s.isNewAlarmVersion=parseFloat(e.version)>=5.6,be.value=[{label:"概览",name:"overview",lazy:!0,render:()=>h(W,{compData:s},null)},{label:"受保护的文件类型",lazy:!0,name:"protect",render:()=>h(Y,{compData:{...s,childType:"protect"}},null)},{label:"白名单",lazy:!0,name:"exclude",render:()=>h(ee,{compData:{...s,childType:"exclude"}},null)},{label:"高级设置",name:"advanced",lazy:!0,render:()=>h(Z,{compData:{...s,childType:"advanced"}},null)}]):be.value=[{label:"概览",name:"overview",lazy:!0,render:()=>h(W,{compData:s},null)},{label:"排除目录",name:"exclude",lazy:!0,render:()=>h(X,{compData:{...s,childType:"exclude"}},null)},{label:"保护文件/扩展名",name:"protect",lazy:!0,render:()=>h(X,{compData:{...s,childType:"protect"}},null)}]}catch(e){}finally{se.value=!1}},je=()=>{},De=()=>{var e,a,t;de.list=(null==(t=null==(a=null==(e=re.value)?void 0:e.getRef())?void 0:a.overview)?void 0:t.sitesList)||[],ue.value=!0},Ve=async()=>{var e;await ce.value.validate();try{const{data:a}=await H({siteName:le.value.name});let t={protectExt:JSON.stringify(a.protectExt),excludePath:JSON.stringify(a.excludePath),sites:JSON.stringify(de.sites.map(e=>{var a;return{siteName:e,path:null==(a=de.list)?void 0:a.find(a=>a.siteName==e).path}})),sourceSite:le.value.path};const l=await J(t);return ue.value=!1,void S({title:"批量设置配置",resultData:null==(e=l.data)?void 0:e.map(e=>({name:e.ps,status:e.status,msg:e.msg})),resultTitle:"配置",showMult:!1})}catch(a){t(a)}};return d("kernelModuleStatus",xe),v(we),Q({init:we}),(e,a)=>{const t=l,i=E,n=s,u=A,c=I,p=P,d=O,v=L,C=R,S=z,U=r,F=o,H=_("bt-loading");return f((b(),x("div",G,[y(ie)?(b(),x(g,{key:0},[h(t,{ref_key:"tamperRef",ref:re,type:"bg-card",modelValue:y(ye),"onUpdate:modelValue":a[0]||(a[0]=e=>w(ye)?ye.value=e:null),options:y(be)},null,8,["modelValue","options"]),"overview"!==y(ye)&&"tamper_proof_refactored"===y(oe)?(b(),j(i,{key:0,type:"primary",class:"absolute top-0 right-0",onClick:De},{default:D(()=>[...a[3]||(a[3]=[V(" 一键应用 ",-1)])]),_:1})):T("",!0),"tamper_core"==y(oe)&&parseFloat(y(me).version)<3.2?(b(),j(u,{key:1,visible:!0},{content:D(()=>[k("div",K,[a[5]||(a[5]=k("span",null,"版本过低无法使用，请点击更新",-1)),h(n,{onClick:je,class:"!font-bold !text-base"},{default:D(()=>[...a[4]||(a[4]=[V(" 【企业级防篡改】 ",-1)])]),_:1})])]),_:1})):"tamper_core"!=y(oe)||y(xe)?T("",!0):(b(),x("div",$,[a[6]||(a[6]=k("div",{class:"text-secondary text-subtitleLarge mb-1rem flex items-center"},[k("img",{width:"30",src:q}),V(" 【服务已停止】 ")],-1)),a[7]||(a[7]=k("div",{class:"text-tertiary text-base mb-2rem"},"检测到当前服务未开启，请尝试手动启动！否则无法正常使用防篡改插件功能",-1)),h(c,{options:ge})]))],64)):(b(),j(p,{key:1,data:y(fe),class:"p-20px"},null,8,["data"])),h(F,{title:"一键应用",modelValue:y(ue),"onUpdate:modelValue":a[2]||(a[2]=e=>w(ue)?ue.value=e:null),area:50,"show-footer":"",onConfirm:Ve},{default:D(()=>[k("div",B,[h(S,{ref_key:"applyFormRef",ref:ce,model:y(de),rules:y(ve),disabled:y(pe)},{default:D(()=>[h(C,{label:"同步配置",prop:"sites"},{default:D(()=>[h(v,{modelValue:y(de).sites,"onUpdate:modelValue":a[1]||(a[1]=e=>y(de).sites=e),multiple:"","collapse-tags":"",class:"!w-30rem",placeholder:"请选择"},{default:D(()=>[(b(!0),x(g,null,N(y(de).list,e=>(b(),x(g,null,[e.siteName!==m.compData.name?(b(),j(d,{key:e.siteName,label:e.siteName,value:e.siteName},null,8,["label","value"])):T("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"]),h(U,{options:_e,"list-style":"disc",class:"mt-2rem ml-2rem"})])]),_:1},8,["modelValue"])])),[[H,y(se)]])}}});export{Q as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
