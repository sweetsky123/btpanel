import{_ as e}from"./index109.js?v=1763689792";import{r as a,o as t,c as l,x as n,y as r,A as s,D as o,B as i,z as c,e as p,C as m,H as u}from"./base-lib.js?v=1763689792";import{_ as d}from"./index107.js?v=1763689792";import{n as v,H as h,b as f,p as _,Q as y,hy as g,ao as j,lS as b,B as w,_ as x}from"./utils-lib.js?v=1763689792";import{u as k}from"./useStore4.js?v=1763689792";import{u as C}from"./column.js?v=1763689792";import{getPythonEnvInfo as q,PythonRequirementSetting as E,editPythonRequirement as P}from"./site.js?v=1763689792";import{f as V}from"./validator.js?v=1763689792";const I=f(),{siteInfo:D}=k(),S=a(),O=a(!1),A=a([]),B=t({pyVersion:"",path:"",search:""}),M=a(!1),T=()=>{M.value=!0,O.value=!0},H=async e=>{try{const t=await q({project_name:D.value.name,force:M.value?1:0,search:e.search});if(M.value=!1,!1===t.data.status)return I.error(t.data.msg),{data:[],total:0};B.pyVersion=t.data.python_version,B.path=t.data.requirement_path,A.value=(a=t.data.pip_source,Object.entries(a).map(([e,a])=>({label:e,key:a,value:e})));let l=t.data.pip_list;return""!==e.search&&(l=l.filter(a=>a.name.includes(e.search))),{data:l,total:l.length}}catch(t){return{data:[],total:0}}var a},z=e=>{S.value=e||null,v({area:75,isAsync:!0,title:"安装第三方库",btn:"安装",component:()=>h(()=>import("./install-package.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{row:e,path:B.path,project_name:D.value.name,pipSource:A.value,refreshEvent:()=>{}}})},L=async e=>{await _({title:"卸载第三方库",icon:"warning-filled",content:"是否卸载第三方库【".concat(e.name,"】?")});(await y({loading:"正在卸载，请稍后...",request:E({project_name:D.value.name,package_name:e.name,active:"uninstall"}),message:!0})).status&&(O.value=!0)},R=()=>{V({type:"file",path:B.path,change:e=>{(async e=>{(await y({loading:"正在修改，请稍后...",request:P({project_name:D.value.name,requirement_path:e}),message:!0})).status&&(O.value=!0)})(e)}})},Q=a(),U=t({type:"common",name:"",version:"",file:"",pip:""}),F=t({name:[{validator:(e,a,t)=>{"common"===U.type?a?t():t(new Error("请输入名称")):t()}}],file:[{validator:(e,a,t)=>{"file"===U.type?a?t():t(new Error("请选择记录文件")):t()}}]}),G=()=>{V({type:"file",path:U.file,change:e=>{U.file=e}})},J=async()=>{var e,a;U.name=(null==(e=S.value)?void 0:e.name)||"",U.file=B.path||"",U.pip=(null==(a=A.value[0])?void 0:a.label)||""},K=async e=>{try{await Q.value.validate();const a="file"===U.type;let t={project_name:D.value.name,pip_source:U.pip};t=a?{...t,requirement_path:U.file}:{...t,package_name:U.name,package_version:U.version,active:"install"},v({title:"正在安装，请耐心等候...",area:52,component:()=>h(()=>import("./log2.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{type:"createPythonProject",logPath:"/www/server/python_project//vhost/logs/pip_".concat(t.project_name,".log"),endMsg:"安装结束",failMsg:"环境准备失败",successMsg:"安装结束",isClear:!0,completeEvent:(e,a)=>{O.value=!0,a()}}}),e();const l=await E(t);I.request(l)}catch(a){}},N={class:"grid grid-cols-1 gap-y-[1rem]"},W={class:"flex flex-col leading-[2rem]"},X={class:"flex items-center"},Y={class:"flex items-center"},Z={class:"h-[45rem] mt-[2rem]"},$=x(l({__name:"index",setup(a){const{siteInfo:t}=k(),{BtTable:l,BtSearch:v}=g({request:H,columns:[{label:"名称",prop:"name"},{label:"版本",prop:"version"},{label:"依赖记录文件中的版本",prop:"requirement"},C([{onClick:z,title:"安装",render:e=>{let a="--"===e.version;return a=a&&!e.requirement.includes("git")&&!e.requirement.includes("file"),a?p("span",{class:"text-primary cursor-pointer hover:text-primaryDark",onClick:()=>z(e)},[o("安装")]):""}},{onClick:L,isHide:e=>"--"===e.version,title:"卸载"}])],extension:[j(O),b()]});return(a,h)=>{const f=d,_=u,y=e;return n(),r("div",null,[s("div",N,[s("div",null,[h[3]||(h[3]=o(" Python版本 ",-1)),s("span",null,i(c(B).pyVersion),1)]),s("div",W,[h[5]||(h[5]=s("span",null,"命令行使用项目中的环境:",-1)),h[6]||(h[6]=s("span",null,[o("命令行可使用 "),s("code",null,"source py-project-env [项目名称]"),o(" 进入该项目虚拟环境，退出时使用"),s("code",null,"deactivate")],-1)),s("span",X,[h[4]||(h[4]=o(" 示例：",-1)),s("code",null,"source py-project-env "+i(c(t).name),1),s("i",{class:"svgtofont-el-document-copy cursor-pointer text-default text-base copy ml-[4px]",title:"复制启动命令",onClick:h[0]||(h[0]=()=>c(w)({value:"source py-project-env ".concat(c(t).name)}))})]),h[7]||(h[7]=s("span",null,"若提示没有py-project-env文件，可尝试关闭系统加固并重启面板，然后进入Python项目页面此，时会自动设置该文件",-1))]),s("div",Y,[h[8]||(h[8]=s("span",{class:"mr-[1rem] whitespace-nowrap"},"依赖记录文件",-1)),p(f,{modelValue:c(B).path,"onUpdate:modelValue":h[1]||(h[1]=e=>c(B).path=e),icon:"el-folder-opened",onIconClick:c(R),width:"40rem"},null,8,["modelValue","onIconClick"])])]),s("div",Z,[p(y,null,{"header-left":m(()=>[p(_,{type:"primary",onClick:h[2]||(h[2]=e=>c(z)())},{default:m(()=>[...h[9]||(h[9]=[o("安装",-1)])]),_:1})]),"header-right":m(()=>[p(c(v),{width:"20rem",placeholder:"搜索第三方库"}),p(_,{type:"default",class:"!ml-[1rem]",onClick:c(T)},{default:m(()=>[...h[10]||(h[10]=[o("强制刷新",-1)])]),_:1},8,["onClick"])]),content:m(()=>[p(c(l),{"max-height":480})]),_:1})])])}}}),[["__scopeId","data-v-88785ebf"]]),ee=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{G as a,Q as b,ee as c,J as g,U as i,K as o,A as p,F as r};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
