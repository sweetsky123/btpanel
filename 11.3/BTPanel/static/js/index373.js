import{L as a,ar as e}from"./utils-lib.js?v=1763689792";import{c as s,r as t,g as r,e as o,D as l,H as i,a8 as n,x as m,y as u,z as p}from"./base-lib.js?v=1763689792";import{j as c,b as d,h as v,f}from"./form-item.js?v=1763689792";import{b as _,f as h}from"./index67.js?v=1763689792";import{u as j,a as x}from"./useController12.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./index260.js?v=1763689792";const b={class:"p-[2rem]"},w=s({__name:"index",props:{compData:{default:()=>({nodes:[]})}},setup(s,{expose:w}){const{addTcpudpNodeData:g}=_(),{nodesStatusList:y,testLinkStatus:C}=j(),D=t(s.compData.nodes.map(a=>({label:"".concat(a.label," - ").concat(a.server_ip," (").concat(""==a.version?"本机地址":a.version," ").concat(x(a.version,"9.7.0")<0?"版本较低无法显示站点":"",")"),value:a.value,server_ip:a.server_ip}))),N=t(""),{BtForm:L,submit:k}=a({data:()=>({port:80,node_status:"online",weight:1,max_fail:3,fail_timeout:600,ps:""}),options:a=>r(()=>[c("负载均衡节点","node_id",D.value,{attrs:{class:"!w-[40rem]",placeholder:"请选择负载均衡节点",onChange:a=>{var e;N.value=(null==(e=D.value.find(e=>e.value===a))?void 0:e.server_ip)||""}},rules:[{required:!0,message:"负载均衡节点不能为空"}]}),d("端口","port",{attrs:{class:"!w-[40rem]",placeholder:"请输入端口"},rules:[e({message:"请输入端口"})]}),c("节点状态","node_status",y.value,{attrs:{class:"!w-[40rem]",defaultValue:"online"}}),d("权重","weight",{attrs:{class:"!w-[40rem]",placeholder:"请输入权重"}}),d("阈值","max_fail",{attrs:{class:"!w-[40rem]",placeholder:"请输入阈值"}}),d("恢复时间（秒）","fail_timeout",{attrs:{class:"!w-[39.5rem]",placeholder:"请输入恢复时间（秒）"}}),d("备注","ps",{attrs:{class:"!w-[40rem]",placeholder:"请输入备注"}}),v("测试连接",()=>o(i,{type:"primary",loading:C.value,onClick:()=>h({...a.value,host:N.value})},{default:()=>[l("测试连接")]})),f("",[{content:"备份状态: 指当其它节点都无法使用时才会使用此节点"},{content:"参与状态: 正常参与负载均衡,请至少添加1个普通节点"},{content:"IP地址: 仅支持IP地址,否则无法正常参与负载均衡"},{content:"阈值: 在恢复时间的时间段内，如果Nginx与节点通信尝试失败的次数达到此值，Nginx就认为服务器不可用"}],{attrs:{class:"!mt-[1rem]"}})]),submit:async(a,e,s)=>{var t;await e();const r=null==(t=D.value.find(e=>e.value===a.value.node_id))?void 0:t.server_ip,{port:o}=a.value,l={...a.value,port:Number(o),host:r};return g.value=[...g.value,l],!0}});return w({onConfirm:k}),n(()=>{C.value=!1}),(a,e)=>(m(),u("div",b,[o(p(L))]))}});export{w as default};
