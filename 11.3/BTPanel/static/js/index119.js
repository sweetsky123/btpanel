import"./ace.js?v=1763689792";import{E as e,bT as a,b8 as t,b as l}from"./utils-lib.js?v=1763689792";import{c as u,t as o,r as s,W as i,w as r,v as n,n as v,e as c,m as d,a9 as f}from"./base-lib.js?v=1763689792";const{load:m,request:h}=l(),g=u({name:"BtAceEditor",props:{modelValue:{type:String,default:""},isZoom:{type:Boolean,default:!1},isScrollBottom:{type:Boolean,default:!1},filePath:{type:String,default:""},request:{type:[Object,Boolean],default:!1},encoding:{type:String,default:"utf-8"},autoSave:{type:Boolean,default:!1},editorOption:{type:Object,default:()=>({})}},emits:["update:modelValue","save"],setup(u,{attrs:g,emit:p,expose:q}){const{modelValue:w,editorOption:y}=o(u),b=s("file"),V=s(),P=i(),S=s(!1),B={theme:e.value?"ace/theme/clouds_midnight":"ace/theme/chrome",mode:"ace/mode/nginx",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},C=s(!1),T=l();r(()=>w.value,e=>{var a,t;if(P.value){if(S.value)return void(S.value=!1);try{P.value.getValue()!==w.value&&(P.value.setValue(e||""),P.value.moveCursorTo(0,0)),u.isScrollBottom&&(null==(t=null==(a=P.value.renderer)?void 0:a.scrollBar)?void 0:t.scrollHeight)&&setTimeout(()=>{P.value&&P.value.getSession().setScrollTop(P.value.renderer.scrollBar.scrollHeight)},50)}catch(l){}}}),r(()=>u.filePath,(e,a)=>{e!==a&&P.value&&(O(),"model"!==b.value&&j({filePath:e,request:u.request}))}),r(()=>u.request,(e,a)=>{e!==a&&P.value&&(O(),"request"===b.value&&j({filePath:u.filePath,request:e}))},{deep:!0});const O=()=>{var e,a;""!==u.filePath?b.value="file":(null==(e=null==u?void 0:u.request)?void 0:e.get)&&(null==(a=null==u?void 0:u.request)?void 0:a.set)?b.value="request":b.value="model"},z=(e=!1)=>{try{if(!V.value)return!1;if(P.value&&P.value.container&&P.value.container.parentNode)return!0;if(!e){const e=V.value.getBoundingClientRect();if(0===e.width||0===e.height)return!1}V.value.innerHTML="",window.ace.config.set("basePath","/static/editor/");const a=window.ace.edit(V.value,{...f(B),...y.value});return a.commands.addCommand({name:"保存文件",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:()=>{p("save",a.getValue()),u.autoSave&&x({filePath:u.filePath,request:u.request,encoding:u.encoding})},readOnly:!1}),a.getSession().on("change",()=>{p("update:modelValue",a.getValue())}),P.value=a,!0}catch(a){return P.value=null,!1}},j=async({filePath:e,request:t})=>{const l=m("正在加载文件内容，请稍后...");try{if(!P.value)return;if("file"===b.value){const t=await a({path:e});if(t.status){const{data:e}=t,a=e&&e.data||"";P.value.setValue(a)}else h(t)}else if("request"===b.value){const{data:e}=await t.get();P.value.setValue(e||"")}else S.value=!0,p("update:modelValue",P.value.getValue());v(()=>{P.value&&(P.value.focus(),P.value.moveCursorTo(0,0))})}catch(u){}finally{l.close()}},x=async({filePath:e,request:a,encoding:l})=>{const u=T.load("正在保存文件，请稍后...");try{if("file"===b.value){const a=await t({path:e,encoding:l,data:P.value.getValue()});T.request(a)}else if("request"===b.value){const e=await a.set({data:P.value.getValue(),encoding:l});T.request(e)}else p("save",P.value.getValue())}catch(o){T.error(o)}finally{u.close()}},E=()=>{C.value=!C.value};let R=null;return n(async()=>{await v(),O(),z(),await v(),"model"!==b.value?j({filePath:u.filePath,request:u.request}):P.value&&(P.value.setValue(w.value||""),v(()=>{P.value&&(P.value.focus(),P.value.moveCursorTo(0,0))})),V.value&&window.ResizeObserver&&(R=new ResizeObserver(e=>{e.forEach(e=>{const{width:a,height:t}=e.contentRect;!(a>0&&t>0)||P.value&&P.value.container?P.value&&a>0&&t>0&&P.value.resize():(async()=>{await v(),!V.value||P.value&&P.value.container||z(!0)&&("model"!==b.value?j({filePath:u.filePath,request:u.request}):P.value&&(P.value.setValue(w.value||""),v(()=>{P.value&&(P.value.focus(),P.value.moveCursorTo(0,0))})))})()})}),R.observe(V.value))}),q({getEditor:()=>P.value}),()=>c("div",{class:"ace-editor-content h-full relative"},[c("div",d({class:"ace-editor ".concat((u.isZoom,"")),style:"height:100%",ref:V},g),null),u.isZoom?c("div",{class:"absolute right-0 top-0 icon-zoom",title:u.isZoom?"全屏显示":"退出全屏",onClick:E},null):null])}});export{g as B};
