import{c as a,Y as s,r as e,Z as t,g as n,w as l,v as i,I as u,x as o,O as r,C as c,J as p,z as d,y as v,A as m,e as f,B as g,L as _,G as y,bi as b,bj as h,H as w,aA as x}from"./base-lib.js?v=1763689792";import{aH as k,p as I,Q as j,bW as C,f as N,d as q,Z as z,b2 as B,_ as R}from"./utils-lib.js?v=1763689792";import{_ as A}from"./index110.js?v=1763689792";import{l as H}from"./validator.js?v=1763689792";const W={class:"flex items-center justify-center"},Z={class:"h-[2.2rem] w-[2.2rem] flex overflow-hidden justify-center items-center status-icon <2xl:hidden"},G={class:"<2xl:hidden"};var J=(a=>(a.stop="停止",a.start="启动",a.restart="重启",a.reload="重载",a))(J||{});const L=R(a({__name:"index",props:s({pluginInfo:{default:()=>({title:"",name:"defalut",status:!1,version:"",admin:!1,setup:!1,s_version:"",s_status:!1})},pluginName:{default:"defalut"},isRequest:{type:Boolean,default:!0}},{pluginInfo:{default:{title:"",name:"",status:!0,version:"",admin:!1,s_version:""}},pluginInfoModifiers:{}}),emits:["update:pluginInfo"],setup(a){const s=a,R=e(!1),L=e(!1),M=e(0),O=e(!1),Q=t(a,"pluginInfo"),T=n(()=>J[Q.value.s_status?"stop":"start"]);l(()=>s.pluginInfo,a=>{if(R.value=!1,!s.isRequest){if(z(a,"s_status"))Q.value={...a};else{const{title_en:s,name:e,version:t,admin:n,s_version:l,status:i}=a;Q.value={title:s,name:e,status:i,version:t,admin:n,s_version:l,s_status:i}}R.value=!0}},{immediate:!0,deep:!0});const Y=()=>{H({name:Q.value.name})},$=async a=>{try{const e=J[a],t=s.pluginInfo.s_version;await I({title:e+t,icon:"warning-filled",content:"你确定要".concat(e).concat(t,"服务，是否继续？")}),await j({loading:L,request:C({name:t,type:a}),message:!0,success:async()=>{await(async()=>{try{const a=["nginx","apache","openlitespeed"].includes(Q.value.name)?"web":"pureftpd"===Q.value.name?"pure-ftpd":Q.value.name,{data:s}=await B({name:a});setTimeout(()=>{Q.value=s,O.value=!0},100)}catch(a){Q.value.status=!1}})(),O.value=!0}})}catch(e){}},D=()=>{M.value=document.body.clientWidth};return i(()=>{(s.pluginInfo.title||s.pluginName)&&s.isRequest&&(async()=>{try{L.value=!0;const{data:a}=await k({sName:s.pluginInfo.name||s.pluginName});Q.value=a,O.value=!0}catch(a){Q.value.s_status=!1,O.value=!0}finally{L.value=!1,R.value=!1}})(),D(),window.onresize=D}),(s,e)=>{const t=A,n=N,l=q,i=w,k=x,I=u("bt-loading");return o(),r(k,{placement:"top-start",width:"redis"===Q.value.name?140:200,class:"","popper-class":"white-tips-popover",trigger:"hover"},{reference:c(()=>[p((o(),v("div",b(h(s.$attrs)),[d(R)?(o(),r(i,{key:0,type:Q.value.s_status?"default":"danger",class:"plugin-status-btn",plain:"",onClick:Y},{default:c(()=>[m("div",{class:_(["h-full inline-block flex items-center",Q.value.s_status?"hover:text-primary":"hover:text-danger"])},[m("span",Z,[f(n,{src:"/static/icons/soft/ico-".concat(Q.value.name||a.pluginName||"defalut",".svg"),class:"inline-block",all:!0},null,8,["src"])]),m("span",null,g(Q.value.title),1),m("span",G," "+g(Q.value.version),1),f(l,{icon:"icon-"+(Q.value.s_status?"start":"stop"),class:_(["ml-[4px]",Q.value.s_status?"!text-primary":"!text-danger"])},null,8,["icon","class"])],2)]),_:1},8,["type"])):y("",!0)],16)),[[I,d(L)],[I,"small","size"]])]),default:c(()=>[m("div",W,[m("span",{class:"bt-link",onClick:e[0]||(e[0]=a=>$(Q.value.s_status?"stop":"start"))},g(d(T)),1),f(t),m("span",{class:"bt-link",onClick:e[1]||(e[1]=a=>$("restart"))},"重启"),f(t),m("span",{class:"bt-link",onClick:e[2]||(e[2]=a=>$("reload"))},"重载"),"redis"!==Q.value.name?(o(),r(t,{key:0})):y("",!0),"redis"!==Q.value.name?(o(),v("span",{key:1,class:"bt-link",onClick:e[3]||(e[3]=a=>d(H)({name:Q.value.name}))},"告警设置")):y("",!0)])]),_:1},8,["width"])}}}),[["__scopeId","data-v-ef61e40a"]]);export{L as B};
