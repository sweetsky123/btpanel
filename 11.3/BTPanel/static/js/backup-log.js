import{_ as e}from"./index123.js?v=1763689792";import{c as a,r as s,w as l,v as t,aG as i,x as n,y as c,A as r,B as o,z as m,e as u,C as d,D as p,H as v}from"./base-lib.js?v=1763689792";import{b as f,p as g,Q as x}from"./utils-lib.js?v=1763689792";import{getBackupLogs as w,stopBackup as b}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const _={class:"p-2rem flex-wrap"},y={class:"relative w-full text-medium flex items-center leading-4rem mb-1rem justify-between"},j={class:"ml-1rem"},C={class:"grid grid-cols-3 leading-3rem py-1rem text-base"},D={class:"flex items-center mr-1rem"},h={class:"truncate flex-1"},k={class:"flex items-center mr-1rem"},H={class:"truncate flex-1"},T={class:"flex items-center"},M={class:"truncate flex-1"},q=a({__name:"backup-log",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,id:""})}},emits:["close","onCancel"],setup(a,{expose:q,emit:z}){const A=a,B=z,E=s(""),G=s(""),L=s(""),P=s("");l(()=>A.compData,e=>{I.value=!0,N()});const Q=f(),F=s("获取中...\t"),I=s(!0),J=s(null);let K=!1;const N=async()=>{if(!K)try{const{data:e}=await w({id:A.compData.id});if(F.value!==e.msg&&(F.value=e.msg),(null==e?void 0:e.total)&&(E.value=e.total,G.value=e.speed,L.value=e.site_name,P.value=e.title),e.stop)return I.value=!1,void(e.status?(Q.success(e.title),B("close"),R()):(Q.error(e.title),I.value=!1));!e.stop&&I.value&&(J.value=setTimeout(function(){N()},1e3))}catch(e){I.value&&N()}},O=async()=>{await g({width:"40rem",title:"取消备份",content:'<p>取消选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0}),await x({loading:"正在取消备份，请稍后...",request:b({id:A.compData.id}),message:!0}),B("close")},R=()=>{J.value&&clearTimeout(J.value)},S=()=>{A.compData.isClear&&clearTimeout(J.value)};return B("onCancel",S),t(()=>{N()}),i(()=>{R(),K=!0}),q({onCancel:S}),(a,s)=>{const l=v,t=e;return n(),c("div",_,[r("div",y,[r("div",null,[s[0]||(s[0]=r("i",{class:"svgtofont-el-loading text-iconLarge"},null,-1)),r("span",j,o(m(P)||"正在备份，请稍后..."),1)]),u(l,{type:"warning",plain:"",onClick:O},{default:d(()=>[...s[1]||(s[1]=[p("取消备份",-1)])]),_:1})]),s[5]||(s[5]=r("hr",{class:"!border-dark"},null,-1)),r("div",C,[r("div",D,[s[2]||(s[2]=r("span",null,"备份网站：",-1)),r("div",h,o(m(L)||"--"),1)]),r("div",k,[s[3]||(s[3]=r("div",null,"已备份：",-1)),r("div",H,o(m(E)||"--"),1)]),r("div",T,[s[4]||(s[4]=r("div",null,"备份速度：",-1)),r("div",M,o(m(G)||"--"),1)])]),u(t,{class:"h-[30rem]",content:m(F)},null,8,["content"])])}}});export{q as default};
