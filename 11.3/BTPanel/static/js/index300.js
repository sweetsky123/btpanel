import{q as e,Y as a,t as l,n as t,Z as s,l as o,o as n,_ as r,$ as i,m as d,a0 as u}from"./firewall.js?v=1763689792";import{Q as m,aH as c,M as p,r as f,aK as y,n as v,H as _,b6 as w,p as g,B as h,k as b,j as S,_ as x,X as V}from"./utils-lib.js?v=1763689792";import{c as k,o as H,r as C,w as L,v as j,I as P,x as q,y as I,e as K,C as R,J as B,z as E,O as U,A,L as D,B as F,D as O,S as M,H as N,ad as T,ap as z,ab as Z,W as $,F as J,b1 as Q,R as W,an as X,am as Y,N as G,M as ee}from"./base-lib.js?v=1763689792";import{k as ae}from"./validator.js?v=1763689792";import{c as le}from"./useMethod8.js?v=1763689792";import{g as te}from"./useStore6.js?v=1763689792";import{_ as se}from"./index107.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";const oe={class:"bt-line mt-2"},ne={class:"bt-line mt-2"},re=k({__name:"index",setup(t){var s,o;const{refs:{sshInfo:n}}=te(),r=H({sshBlastStatus:Boolean(null==(o=null==(s=n.value)?void 0:s.fail2ban)?void 0:o.status)}),i=C(),d=C(!1),u=C({}),w=async a=>{r.sshBlastStatus=!a;const l=await m({request:c({sName:"fail2ban"})});if(!l.data.setup)return ae({name:l.data.name,type:"i",pluginInfo:l.data}),void p.warn("请先安装防暴破插件");await m({loading:"正在"+(a?"开启":"关闭")+"防暴破，请稍后...",request:e({act:a}),message:!0}),r.sshBlastStatus=a,le()},g=async e=>{try{const{data:a}=await m({request:c({sName:"fail2ban"})});a.setup?e&&e():(ae({name:a.name,type:"i",pluginInfo:a}),p.warn("请先安装防暴破插件"))}catch(a){}},h=()=>{f.push({name:"fixed"})},b=async()=>{try{d.value=!0;const{data:e}=await a();if(u.value=e,e.status){u.value.type=!0;const e={mail:"邮件",sms:"短信",dingding:"钉钉",wx_account:"微信公众号",feishu:"飞书",weixin:"企业微信",webhook:"自定义通道"};u.value.text=u.value.channels.map(a=>e[a]).join("、")+"已配置"}else u.value={type:!1,text:"告警通知未配置"};return e}catch(e){y(e)}finally{d.value=!1}},S=async()=>{v({title:"SSH登录告警",area:104,compData:{alertStatus:i.value,refreshFn:b},component:()=>_(()=>import("./login-alert-setting.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})};return L(()=>n.value,()=>{var e,a;r.sshBlastStatus=Boolean(null==(a=null==(e=n.value)?void 0:e.fail2ban)?void 0:a.status)}),j(()=>{b()}),(e,a)=>{const t=N,s=T,o=z,n=Z,i=P("bt-loading");return q(),I("div",null,[K(n,{model:E(r),onSubmit:a[5]||(a[5]=M(()=>{},["prevent"]))},{default:R(()=>[B((q(),U(s,{class:"flex-col",label:"SSH登录告警"},{default:R(()=>[A("div",oe,[A("span",{onClick:a[0]||(a[0]=e=>S()),class:D(["!text-small cursor-pointer","text-".concat(E(u).type?"primary":"warning")])},F(E(u).text),3),K(t,{type:"primary",class:"!ml-4",onClick:a[1]||(a[1]=e=>S())},{default:R(()=>[...a[6]||(a[6]=[O(" 设置登录告警 ",-1)])]),_:1}),a[7]||(a[7]=A("span",{class:"text-tertiary ml-4 text-small"}," 推荐使用密钥登录，关闭密码，安全性更高 ",-1))])]),_:1})),[[i,E(d)]]),K(s,{class:"flex-col",label:"SSH安全防护"},{default:R(()=>[A("div",ne,[K(o,{modelValue:E(r).sshBlastStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>E(r).sshBlastStatus=e),width:36,onChange:w},null,8,["modelValue"]),K(t,{onClick:a[3]||(a[3]=e=>(async()=>{g(()=>v({title:"配置SSH防暴破",area:40,component:()=>_(()=>import("./anti-blast-view.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0}))})()),type:"primary",class:"!ml-8"},{default:R(()=>[...a[8]||(a[8]=[O(" 配置 ",-1)])]),_:1}),K(t,{onClick:a[4]||(a[4]=e=>(async()=>{g(()=>v({title:"防暴破日志",area:60,compData:{type:"AntiBlast",requestFn:()=>l()},component:()=>_(()=>import("./index304.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}))})())},{default:R(()=>[...a[9]||(a[9]=[O("日志",-1)])]),_:1}),a[10]||(a[10]=A("span",{class:"text-tertiary ml-4 text-small"}," 结合fail2ban服务自动阻止恶意IP地址的攻击、暴力破解等行为；首次安装后，请手动刷新页面 ",-1))])]),_:1}),K(s,{class:"flex-col"},{default:R(()=>[A("span",{class:"text-small text-tertiary"},[a[11]||(a[11]=O(" 更多SSH安全设置请使用系统加固模块 ",-1)),A("span",{class:"bt-link",onClick:h},">> 系统加固")])]),_:1})]),_:1},8,["model"])])}}}),ie={class:"bt-line mt-2"},de={class:"bt-line mt-2"},ue=x(k({__name:"root-setting",props:{data:{default:()=>({})}},emits:["refresh"],setup(e,{emit:a}){const l=e,r=a,i=$(l.data),d=C(),u=C("empty"),c=H({rootLogin:"",rootPwd:"",rootKey:""}),f=$(),y=C(!1),v=H({rootPwd:[{required:!1},{validator:(e,a,l)=>{if(!a)return u.value="empty",void l();const t=/[a-z]/.test(a),s=/[A-Z]/.test(a),o=/[0-9]/.test(a);a.length<8?(u.value="weak",l(new Error("密码长度至少".concat(8,"位")))):t?s?o?(u.value="strong",l()):(u.value="medium",l(new Error("密码必须包含至少一个数字"))):(u.value="weak",l(new Error("密码必须包含至少一个大写字母"))):(u.value="weak",l(new Error("密码必须包含至少一个小写字母")))},trigger:["blur","change"]}]}),_=async e=>{var a;if("yes"!==(null==(a=i.value)?void 0:a.pubkey))return p.error("请先开启SSH密钥登录，再"+(e?"查看":"下载")+"密钥");const l=await m({loading:"正在获取密钥信息，请稍后...",request:t()});e&&l.status?(c.rootKey=l.msg,y.value=!0):window.open("/ssh_security?action=download_key","_blank","noopener,noreferrer")},x=async()=>{if(!c.rootPwd)return p.error("请输入新密码");await g({title:"提示",content:"重置root密码后，之前的密码将失效，是否继续操作？",icon:"warning-filled"}),await m({loading:"正在重置root密码，请稍后...",request:s({username:"root",password:c.rootPwd}),message:!0}),r("refresh")},V=async e=>{await m({loading:"正在设置root登录，请稍后...",request:o({p_type:e}),message:!0}),r("refresh")},k=()=>{window.open("/ssh_security?action=download_key","_blank","noopener,noreferrer")},j=async()=>{var e;let a=null==(e=i.value)?void 0:e.pubkey;await m({loading:"正在重新生成SSH登录密钥，请稍后...",request:n({ssh:a,type:i.value.key_type}),message:!0});const l=await m({loading:"正在获取密钥信息，请稍后...",request:t()});if(!l.msg)return p.msg({type:"warning",message:"请重新开启SSH密钥登录再查看密钥！"});c.rootKey=l.msg,r("refresh")};return L(()=>l.data,e=>{f.value=Object.entries((null==e?void 0:e.root_login_types)||[]),c.rootLogin=null==e?void 0:e.root_login_type,i.value=e},{immediate:!0}),(e,a)=>{const l=Y,t=X,s=T,o=se,n=N,r=Z,i=b,m=S;return q(),I("div",null,[K(r,{ref_key:"rootFormRef",ref:d,model:E(c),rules:E(v),onSubmit:a[5]||(a[5]=M(()=>{},["prevent"]))},{default:R(()=>[K(s,{class:"flex-col",label:"Root密码登录设置",prop:"rootLogin"},{default:R(()=>[K(t,{modelValue:E(c).rootLogin,"onUpdate:modelValue":a[0]||(a[0]=e=>E(c).rootLogin=e),class:"!w-[26rem] mt-2",onChange:V},{default:R(()=>[(q(!0),I(J,null,Q(E(f),e=>(q(),U(l,{key:e[0],label:e[1],value:e[0]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),K(s,{class:D(["root-pwd flex-col",E(u)]),label:"Root密码",prop:"rootPwd"},{default:R(()=>[A("div",ie,[K(o,{modelValue:E(c).rootPwd,"onUpdate:modelValue":a[1]||(a[1]=e=>E(c).rootPwd=e),icon:"el-refresh",placeholder:"请输入新密码",onIconClick:a[2]||(a[2]=()=>E(c).rootPwd=E(w)(16)),width:"28rem"},null,8,["modelValue"]),K(n,{disabled:"strong"!==E(u),type:"primary",class:"!ml-4",onClick:x},{default:R(()=>[...a[9]||(a[9]=[O(" 重置 ",-1)])]),_:1},8,["disabled"]),a[10]||(a[10]=A("span",{class:"text-tertiary ml-4 text-small"}," 建议使用复杂度高的密码，修改后请及时保存，刷新页面会清空密码框 ",-1))]),A("span",{class:D(["pwd-status mt-2",E(u)])},F("empty"===E(u)?"修改密码会进行弱密码检测":"weak"===E(u)?"弱密码":"medium"===E(u)?"中等强度":"强密码"),3)]),_:1},8,["class"]),K(s,{class:"flex-col !mb-4",label:"Root密钥"},{default:R(()=>[A("div",de,[K(n,{type:"primary",onClick:a[3]||(a[3]=e=>_(!0))},{default:R(()=>[...a[11]||(a[11]=[O(" 查看密钥 ",-1)])]),_:1}),K(n,{onClick:a[4]||(a[4]=e=>_(!1))},{default:R(()=>[...a[12]||(a[12]=[O(" 下载 ",-1)])]),_:1}),a[13]||(a[13]=A("span",{class:"text-tertiary ml-4 text-small"}," 推荐使用密钥登录，关闭密码，安全性更高 ",-1))])]),_:1})]),_:1},8,["model","rules"]),K(m,{title:"SSH密钥登录",modelValue:E(y),"onUpdate:modelValue":a[8]||(a[8]=e=>W(y)?y.value=e:null),area:42},{default:R(()=>[K(r,{ref:"openSshKeyForm",model:E(c),class:"p-[2rem]","label-width":"5rem"},{default:R(()=>[K(s,null,{default:R(()=>[K(i,{modelValue:E(c).rootKey,"onUpdate:modelValue":a[6]||(a[6]=e=>E(c).rootKey=e),class:"sshKey",type:"textarea",readOnly:"",rows:12,width:"36rem"},null,8,["modelValue"])]),_:1}),K(s,null,{default:R(()=>[K(n,{type:"primary",class:"copySshPaw",onClick:a[7]||(a[7]=e=>{return a=E(c).rootKey,void h({value:a});var a}),textContent:"复制"}),K(n,{type:"primary",class:"copy",onClick:k,textContent:"下载"}),K(n,{type:"default",class:"copy",onClick:j,textContent:"重新生成"})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-ad1812b4"]]),me={class:"ssh-setting-wrapper"},ce={class:"bt-line"},pe={class:"bt-line"},fe={class:"bt-line"},ye={class:"p-20px"},ve=x(k({__name:"ssh-setting",props:{data:{default:()=>({})}},emits:["refresh"],setup(e,{emit:a}){var l,t;const s=e,o=a,{refs:{sshInfo:u}}=te(),c=$(null==s?void 0:s.data),f=C(!1),y=H({isPwdLogin:"yes"===(null==(l=c.value)?void 0:l.password),isKeyLogin:"yes"===(null==(t=c.value)?void 0:t.pubkey)}),v=H({ssh:"yes",type:"ed25519"}),_=async e=>{await m({loading:"正在"+(e?"开启":"关闭")+"SSH密码登录，请稍后...",request:r(Boolean(e)),message:!0})},w=async()=>{await m({loading:"正在处理，请稍候...",request:n(v),message:!0}),f.value=!1,v.ssh="yes",v.type="ed25519",o("refresh")},g=async e=>{e?(y.isKeyLogin=!e,f.value=!0):(await m({loading:"正在关闭SSH密钥登录，请稍后...",request:i(),message:!0}),o("refresh"))};return L(()=>s.data,e=>{e&&(c.value=e),y.isPwdLogin="yes"===(null==e?void 0:e.password),y.isKeyLogin="yes"===(null==e?void 0:e.pubkey)},{immediate:!0}),(e,a)=>{const l=z,t=T,s=se,n=N,r=Z,i=Y,c=X,h=S;return q(),I("div",me,[K(r,{ref:"sshFormRef",model:E(y),onSubmit:a[5]||(a[5]=M(()=>{},["prevent"])),"label-position":"top"},{default:R(()=>[K(t,{class:"flex-col",label:"SSH密码登录"},{default:R(()=>[A("div",ce,[K(l,{modelValue:E(y).isPwdLogin,"onUpdate:modelValue":a[0]||(a[0]=e=>E(y).isPwdLogin=e),width:36,onChange:_},null,8,["modelValue"]),a[9]||(a[9]=A("span",{class:"switch-text ml-4"},"允许使用密码进行SSH登录",-1))])]),_:1}),K(t,{class:"flex-col",label:"SSH密钥登录"},{default:R(()=>[A("div",pe,[K(l,{modelValue:E(y).isKeyLogin,"onUpdate:modelValue":a[1]||(a[1]=e=>E(y).isKeyLogin=e),width:36,onChange:g},null,8,["modelValue"]),a[10]||(a[10]=A("span",{class:"switch-text ml-4"},"允许使用密钥进行SSH登录",-1))])]),_:1}),K(t,{class:"flex-col !mb-4",label:"SSH端口"},{default:R(()=>[A("div",fe,[K(s,{modelValue:E(u).port,"onUpdate:modelValue":a[2]||(a[2]=e=>E(u).port=e),width:"20rem",class:"!max-w-[20rem]",placeholder:"请输入SSH端口",icon:"el-refresh",onIconClick:a[3]||(a[3]=()=>(()=>{const e=Math.floor(64536*Math.random())+1e3;u.value.port=e.toString()})())},null,8,["modelValue"]),K(n,{type:"primary",class:"!ml-4",onClick:a[4]||(a[4]=e=>(async()=>{V(u.value.port)?(await m({loading:"正在保存SSH端口，请稍后...",request:d(Number(u.value.port)),message:!0}),o("refresh")):p.error("端口格式错误，可用范围：1-65535")})())},{default:R(()=>[...a[11]||(a[11]=[O("保存",-1)])]),_:1}),a[12]||(a[12]=A("span",{class:"text-tertiary ml-4 text-small"},"当前SSH协议所使用的的端口，默认为22",-1))])]),_:1})]),_:1},8,["model"]),K(h,{title:"开启SSH密钥登录",modelValue:E(f),"onUpdate:modelValue":a[8]||(a[8]=e=>W(f)?f.value=e:null),area:40,onConfirm:w,showFooter:""},{default:R(()=>[A("div",ye,[K(r,{"label-position":"right",model:E(v)},{default:R(()=>[K(t,{label:"SSH密码登录"},{default:R(()=>[K(c,{modelValue:E(v).ssh,"onUpdate:modelValue":a[6]||(a[6]=e=>E(v).ssh=e),class:"!w-[20rem]"},{default:R(()=>[K(i,{label:"开启",value:"yes"}),K(i,{label:"关闭",value:"no"})]),_:1},8,["modelValue"])]),_:1}),K(t,{label:"密钥加密方式"},{default:R(()=>[K(c,{modelValue:E(v).type,"onUpdate:modelValue":a[7]||(a[7]=e=>E(v).type=e),class:"!w-[20rem]"},{default:R(()=>[K(i,{label:"ED25519(推荐)",value:"ed25519"}),K(i,{label:"ECDSA",value:"ecdsa"}),K(i,{label:"RSA",value:"rsa"}),K(i,{label:"DSA",value:"dsa"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c033e08f"]]),_e={class:"title"},we={class:"content"},ge=x(k({__name:"index",props:{title:{},style:{}},setup:e=>(a,l)=>(q(),I("div",{class:"firewall-section-ui",style:ee(e.style)},[A("div",_e,F(e.title),1),A("div",we,[G(a.$slots,"default",{},void 0,!0)])],4))}),[["__scopeId","data-v-5281641d"]]),he=x(k({__name:"index",setup(e){const a=C(),l=C(!0),t=async()=>{const e=await m({loading:l,request:u()});a.value=e.data};return j(()=>{t()}),(e,s)=>{const o=P("bt-loading");return B((q(),I("div",null,[K(ge,{title:"SSH基础设置"},{default:R(()=>[K(ve,{class:"top-label-title",data:E(a),onRefresh:t},null,8,["data"])]),_:1}),K(ge,{title:"Root设置"},{default:R(()=>[K(ue,{data:E(a),onRefresh:t},null,8,["data"])]),_:1}),K(ge,{title:"安全功能"},{default:R(()=>[K(re,{data:E(a),onRefresh:t},null,8,["data"])]),_:1})])),[[o,E(l)],[o,"正在获取配置信息,请稍后...","title"]])}}}),[["__scopeId","data-v-40d1eb4a"]]);export{he as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
