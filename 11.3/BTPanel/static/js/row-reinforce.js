import{Q as e,l as a,k as l,j as t,$ as o}from"./utils-lib.js?v=1763689792";import{_ as r}from"./index109.js?v=1763689792";import{c as s,W as d,r as m,e as n,v as p,I as i,x as u,y as c,C as _,D as h,J as f,z as b,R as w,H as g,ad as y,am as v,an as V,ab as j}from"./base-lib.js?v=1763689792";import{_ as x}from"./index107.js?v=1763689792";import{bG as k,bH as q,bI as C}from"./firewall.js?v=1763689792";import{u as U}from"./column.js?v=1763689792";import{f as D}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const H={class:"px-[1.6rem] py-[1.6rem]"},I=s({__name:"row-reinforce",props:{compData:{default:()=>({})}},setup(s){const I=s.compData.key,R=d(!1),F={a:"追加",i:"只读"},T=d([]),z=m(),A=d(!1),G=m({path:"",chattr:"i",d_mode:""}),J=[{content:"【只读】无法修改、创建、删除文件和目录"},{content:"【追加】只能追加内容，不能删除或修改原有内容"},{content:"【权限】设置文件或目录在受保护状态下的权限(非继承),关闭保护后权限自动还原"},{content:"【如何填写权限】请填写Linux权限代号,如:644、755、600、555等,如果不填写,则使用文件原来的权限"}],L={path:[{required:!0,message:"请输入被保护的文件或路径",trigger:["blur","change"]}],d_mode:[{required:!0,message:"请输入权限",trigger:["blur","change"]}]},O=async()=>{await e({loading:R,request:k({s_key:I}),data:{paths:[Array,T]}})},Q=()=>{D({type:"all",path:"/www/wwwroot",change:e=>{G.value.path=e}})},W=async()=>{await z.value.validate(),await e({loading:"正在添加保护文件/目录，请稍后...",request:C({...G.value,s_key:I}),message:!0}),A.value=!1,O(),G.value={path:"",chattr:"i",d_mode:""}},$=[{label:"路径",prop:"path",showOverflowTooltip:!0},{label:"模式",prop:"chattr",render:e=>F[e.chattr]},{label:"权限",prop:"s_mode",render:(e,a)=>n("span",null,[e.s_mode+(e.s_mode===e.d_mode?"":" >> "+e.d_mode)])},{label:"状态",prop:"state",render:e=>n("span",{class:"text-".concat(e.state?"primary":"danger")},[e.state?"已保护":"未保护"])},U([{title:"删除",onClick:async a=>{await e({request:q({s_key:I,path:a.path}),loading:"正在删除保护配置，请稍后...",message:!0}),O()}}])];return p(()=>O()),(e,s)=>{const d=g,m=a,p=x,k=y,q=v,C=V,U=l,D=j,I=t,F=r,O=o,B=i("bt-loading");return u(),c("div",H,[n(F,null,{"header-left":_(()=>[n(d,{type:"primary",onClick:s[0]||(s[0]=e=>A.value=!0)},{default:_(()=>[...s[5]||(s[5]=[h(" 添加保护文件/目录 ",-1)])]),_:1})]),content:_(()=>[f(n(m,{"max-height":"400",column:$,data:b(T)},null,8,["data"]),[[B,b(R)],[B,"正在加载中，请稍后...","title"]])]),popup:_(()=>[n(I,{title:"添加保护文件/目录",modelValue:b(A),"onUpdate:modelValue":s[4]||(s[4]=e=>w(A)?A.value=e:null),area:42,onConfirm:W,showFooter:""},{default:_(()=>[n(D,{class:"p-2rem",ref_key:"addReinforceFormRef",ref:z,model:b(G),rules:L},{default:_(()=>[n(k,{label:"路径",prop:"path"},{default:_(()=>[n(p,{icon:"icon-file_mode",modelValue:b(G).path,"onUpdate:modelValue":s[1]||(s[1]=e=>b(G).path=e),width:"24rem",placeholder:"被保护的文件或路径",onIconClick:Q,iconType:"folder"},null,8,["modelValue"])]),_:1}),n(k,{label:"模式"},{default:_(()=>[n(C,{modelValue:b(G).chattr,"onUpdate:modelValue":s[2]||(s[2]=e=>b(G).chattr=e),class:"!w-[24rem]"},{default:_(()=>[n(q,{label:"只读",value:"i"}),n(q,{label:"追加",value:"a"})]),_:1},8,["modelValue"])]),_:1}),n(k,{label:"权限",prop:"d_mode"},{default:_(()=>[n(U,{modelValue:b(G).d_mode,"onUpdate:modelValue":s[3]||(s[3]=e=>b(G).d_mode=e),width:"24rem",placeholder:"请输入权限",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),n(O,{options:J,class:"mx-[1.6rem] mt-[1.6rem]"})])}}});export{I as default};
