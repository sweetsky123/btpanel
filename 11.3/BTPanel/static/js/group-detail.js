import{n as a,H as t,p as e,b as o,l,j as s,eG as r,_ as n}from"./utils-lib.js?v=1763689792";import{_ as i}from"./index109.js?v=1763689792";import{r as c,c as u,e as p,o as m,v as d,a8 as _,I as f,x as v,y,C as g,D as h,B as D,z as w,J as b,K as k,A as j,O as x,G as E,R as T,n as C,H as I}from"./base-lib.js?v=1763689792";import{delGroupProject as q,getJavaGroupDetail as O,groupProjectOperation as A,editGroupProject as P,groupProjectType as V,getGroupLog as L}from"./site.js?v=1763689792";import{u as R}from"./column.js?v=1763689792";const S=c({}),z={class:"p-[2rem]"},G={class:"flex items-center"},H={key:2,class:"ml-[1rem]"},J={class:"p-[2rem]"},B=n(u({__name:"group-detail",props:{compData:{}},setup(n){const u=n,B=o();let F=0,K=null;const M=c([{name:"test",status:"test",pid:"test",listen:[]}]),N=c([]),U=c("simultaneous"),Q=c(!1),W=c(!0),X=[{prop:"name",label:"项目名称"},{prop:"pid",label:"PID"},{prop:"status",label:"项目状态",render:a=>{let t="--",e="var(--el-color-primary)";switch(a.project_status){case"succeeded":t="运行中";break;case"failed":t="未运行或运行异常",e="#ef0808";break;case"not_run":t="未运行",e="#ef0808";break;default:t="--",e="#555"}return p("span",{style:"color: ".concat(e,";")},[t])}},{prop:"listen",label:"端口",render(a){var t;return p("span",null,[(null==(t=a.listen)?void 0:t.join(","))||"--"])}},R([{onClick:e=>{a({isAsync:!0,title:"项目【".concat(u.compData.group_name,"】检查策略"),area:50,btn:"确定",component:()=>t(()=>import("./project-check.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{...e,group_id:u.compData.group_id,refreshEvent:na}})},title:"检测策略"},{onClick:async(a,t)=>{try{await e({title:"移除项目【".concat(a.name,"】"),width:"35rem",icon:"warning",content:"您真的要将项目【".concat(a.name,"】从本项目组移除吗？")});const t=await q({group_id:u.compData.group_id,project_id:a.id});B.request(t),t.status&&(na(),u.compData.refreshEvent&&u.compData.refreshEvent())}catch(o){}},title:"从项目组中移除",width:140}])],Y=[{label:"",width:50,render:a=>p("i",{class:"svgtofont-icon-drag cursor-move mover iconfont align-middle",title:"拖拽排序"},null)},{prop:"name",label:"项目名称"},{prop:"pid",label:"PID"},{prop:"port",label:"端口"}],Z=m({start:!1,stop:!1,termination:!1,statusText:""}),$=async()=>{a({title:"【".concat(u.compData.group_name,"】添加项目"),area:50,showFooter:!0,component:()=>t(()=>import("./group-add-projects.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{group_id:u.compData.group_id,refreshEvent:()=>{na(),u.compData.refreshEvent&&u.compData.refreshEvent()},projectList:M.value}})},aa=(a,t)=>(t||u.compData).operation_info.includes(a),ta=async a=>{try{const t=await A({group_id:u.compData.group_id},a);B.request(t),na()}catch(t){}},ea=async()=>{M.value.length?(N.value=[],N.value=M.value.map(a=>({id:a.id,name:a.name,check_info:a.check_info,level:a.level})),Q.value=!0,Q.value&&C(()=>{(()=>{const a=document.querySelector(".level-table .el-table__body-wrapper tbody");r.create(a,{animation:500,onEnd:async a=>{const t=N.value.splice(a.oldIndex,1)[0];N.value.splice(a.newIndex,0,t)}})})()})):B.error("暂无项目数据")},oa=async()=>{try{N.value.forEach((a,t)=>{a.level=t+1});const a=await P({group_id:u.compData.group_id,project_datas:JSON.stringify(N.value)});B.request(a),a.status&&(Q.value=!1,na())}catch(a){}},la=async()=>{try{const a=await V({group_id:u.compData.group_id,sort_type:"simultaneous"===U.value?"sequence":"simultaneous"});B.request(a),a.status&&(U.value="simultaneous"===U.value?"sequence":"simultaneous")}catch(a){}},sa=async()=>{a({isAsync:!0,title:"项目组【".concat(u.compData.group_name,"】日志"),area:84,component:()=>t(()=>import("./group-logs.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:u.compData,cancel:()=>{na()}})},ra=async()=>{try{const a=await L({group_id:u.compData.group_id,last_write_time:F});if(a.status){if(S.value=a.data,!a.data.running)return K&&clearTimeout(K),K=null,F=0,void na();if(a.data.last_write_time!=F){const a=await O({group_id:u.compData.group_id});a.status&&ia(a.data)}K=setTimeout(()=>{ra()},2e3),F=a.data.last_write_time}else K&&clearTimeout(K),K=null,F=0,na()}catch(a){}},na=async()=>{try{W.value=!0;const a=await O({group_id:u.compData.group_id});a.status?(ia(a.data),""!==a.data.now_operation&&a.data.now_operation&&!K?ra():(K&&clearTimeout(K),K=null,F=0)):B.error(a.msg)}catch(a){}finally{W.value=!1}},ia=a=>{M.value=a.projects,U.value=a.sort_type,Z.start=aa("start",a),Z.stop=aa("stop",a),Z.termination=aa("termination",a),Z.statusText="start"===a.now_operation?"状态：启动运行中":"状态：停止运行中"};return d(async()=>{await na()}),_(()=>{K&&clearTimeout(K),K=null,S.value={},u.compData.refreshEvent&&u.compData.refreshEvent()}),(a,t)=>{const e=I,o=l,r=i,n=s,c=f("bt-loading");return v(),y("div",z,[p(r,null,{"header-left":g(()=>[p(e,{type:"primary",onClick:$},{default:g(()=>[...t[4]||(t[4]=[h("添加新项目",-1)])]),_:1}),p(e,{type:"default",class:"ml-1rem",onClick:la},{default:g(()=>[h("启动方式："+D("simultaneous"==w(U)?"同时启动":"依次启动"),1)]),_:1}),b(p(e,{type:"default",class:"ml-[1rem]",onClick:ea},{default:g(()=>[...t[5]||(t[5]=[h("修改项目启动顺序",-1)])]),_:1},512),[[k,"sequence"==w(U)]])]),"header-right":g(()=>[j("div",G,[w(Z).start?(v(),x(e,{key:0,type:"default",class:"ml-[1rem]",onClick:t[0]||(t[0]=a=>ta("start"))},{default:g(()=>[...t[6]||(t[6]=[h("启动",-1)])]),_:1})):E("",!0),w(Z).stop?(v(),x(e,{key:1,type:"default",class:"ml-[1rem]",onClick:t[1]||(t[1]=a=>ta("stop"))},{default:g(()=>[...t[7]||(t[7]=[h("停止",-1)])]),_:1})):E("",!0),w(Z).termination?(v(),y("span",H,D(w(Z).statusText),1)):E("",!0),w(Z).termination?(v(),x(e,{key:3,type:"default",class:"ml-[1rem]",onClick:t[2]||(t[2]=a=>ta("termination"))},{default:g(()=>[...t[8]||(t[8]=[h("终止",-1)])]),_:1})):E("",!0),w(Z).termination?(v(),y("span",{key:4,class:"ml-[1rem] text-primary cursor-pointer",onClick:sa},"日志")):E("",!0)])]),content:g(()=>[b(p(o,{"max-height":300,column:X,data:w(M)},null,8,["data"]),[[c,w(W)]])]),"footer-left":g(()=>[...t[9]||(t[9]=[])]),popup:g(()=>[p(n,{title:"启动优先级排序",class:"overflow-hidden",modelValue:w(Q),"onUpdate:modelValue":t[3]||(t[3]=a=>T(Q)?Q.value=a:null),area:65,"show-footer":!0,onConfirm:oa},{default:g(()=>[j("div",J,[p(r,null,{content:g(()=>[b(p(o,{"max-height":300,class:"level-table","row-key":"name",column:Y,data:w(N)},null,8,["data"]),[[c,w(W)]])]),_:1}),t[10]||(t[10]=j("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-[2rem]"},[j("li",null,"拖拽排序，项目启动顺序将按照从上到下依次进行启动")],-1))])]),_:1},8,["modelValue"])]),_:1}),t[11]||(t[11]=j("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-[2rem]"},[j("li",null,"启动顺序为依次启动时,项目将按照从上到下依次进行启动")],-1))])}}}),[["__scopeId","data-v-ea7daa07"]]),F=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{F as g,S as j};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
