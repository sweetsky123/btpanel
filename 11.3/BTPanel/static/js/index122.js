import{az as e,p as s,e as a,b as l,_ as t}from"./utils-lib.js?v=1763689792";import{c as i,r,o as n,g as u,v as d,aG as o,x as c,y as p,J as m,K as f,z as v,A as g,F as b,e as y,C as w,D as k,G as h,B as x,L as _,M as z,O as S,at as j,as as C,ar as N,H as F,aT as L}from"./base-lib.js?v=1763689792";import{_ as P}from"./index110.js?v=1763689792";import{s as O}from"./vue-virtual-scroller.esm.js?v=1763689792";import{F as R,cI as D,cJ as E,cK as I}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const U={id:"upload-mask"},G={class:"p-[20px]"},H=["webkitdirectory"],J={class:"mb-[16px] flex justify-between"},K={key:1,class:"upload-press"},T={key:2,class:"upload-press"},X={key:3,class:"upload-files-tips"},A={key:4,class:"uploader-list"},B={class:"th"},M={class:"td justify-end"},q={class:"uploader-file tr"},Q={class:"td-block"},V={class:"td !w-[55%] flex"},W=["title"],Y={class:"td"},Z={class:"td"},$={class:"truncate"},ee={key:0},se={class:"td justify-end"},ae={class:"flex justify-end"},le=t(i({__name:"index",props:{compData:{default:()=>({path:""})}},setup(t,{expose:i}){const le=t,te=l(),{refreshFilesList:ie}=R();let re=null;const ne=r(),ue=r(!1),de=r("paused"),oe=r([]),ce=r(),pe=r(!1),me=n({totalProgress:0,uploadList:0,sizeUploaded:0,currentSpeed:0,timeRemaining:0,timeElapsed:0,averageSpeed:0,errorNumber:0,successNumber:0,uploadSize:""}),fe=new D({target:"/files?action=upload",uploadPath:le.compData.path||"/www/wwwroot",renewalData:e=>{oe.value=[...e]},renewalSpeed:e=>{me.totalProgress=e.totalProgress,me.uploadList=e.uploadList,me.sizeUploaded=e.sizeUploaded,me.currentSpeed=e.currentSpeed,me.timeRemaining=e.timeRemaining},renewalStatus:e=>{de.value=e.status,me.timeElapsed=e.timeElapsed,me.averageSpeed=e.averageSpeed,me.uploadSize=e.uploadSize,me.successNumber=e.successNumber,me.errorNumber=e.errorNumber}}),{uploadStatusInfo:ve,initData:ge,fileUploadLimit:be,cancelFile:ye}=fe,we=u(()=>!oe.value.length),ke=u(()=>!oe.value.length),he=e=>"".concat(e.path,"/").concat(e.name).replace(/\/\//,"/"),xe=e=>{if(e.isFolder)return"folder";const s=e.name.split(".").pop();return["zip","rar","gz","tar","war","tgz","bz2","7z","tar.gz"].includes(s)?"compress":s},_e=s=>{fe.isGetFiles=!0,"file"!==s&&e(s)?pe.value=!0:pe.value=!1,setTimeout(()=>{ce.value.click()},0)},ze=e=>{const{files:s}=e.target;for(let a=0;a<s.length;a++){const e="/".concat(""===s[a].webkitRelativePath?s[a].name:s[a].webkitRelativePath);if(!be(s[a],e))return!1}if(!fe.isGetFiles)return!1},Se=e=>"success"===e.status?{transform:"translateX(-0%)"}:{transform:"translateX(-".concat(100-e.progress,"%)")},je=()=>{if(0===oe.value.length)return te.error("请添加需要上传的文件");de.value="uploading",fe.useFileUploadExistsConfirm()},Ce=()=>{ge(),oe.value=[],de.value="paused",ce.value.value=""},Ne=()=>{ue.value=!0,"success"===de.value&&Ce()},Fe=()=>{ue.value=!1},Le=e=>{ue.value=!1,fe.fileSelectHandler(e,e=>{oe.value=e||[]})};return d(()=>{re={...E({dragenter:Ne,dragleave:Fe,drop:Le,dragover:()=>{}})}}),o(()=>{I(re)}),i({onCancel:async()=>{try{if(["uploading","paused"].includes(de.value)&&oe.value.length)return await s({title:"取消上传",width:"35rem",icon:"warning-filled",content:"是否取消上传，取消后将清空上传列表？"}),ie(),!0}catch(e){return!1}}}),(e,s)=>{const l=j,t=C,i=N,r=F,n=P,u=L,d=a;return c(),p("div",{ref_key:"upload",ref:ne,class:"upload-file-view"},[m(g("div",U,"请将需要上传的文件/文件夹拖到此处",512),[[f,v(ue)]]),g("div",G,[v(de).indexOf("paused")>-1?(c(),p(b,{key:0},[g("input",{ref_key:"uploadFileInput",ref:ce,type:"file",webkitdirectory:v(pe),style:{display:"none"},multiple:"",onChange:ze},null,40,H),g("div",J,[y(i,{"split-button":"",type:"default","show-timeout":50,"hide-timeout":50,onClick:_e,onCommand:_e},{dropdown:w(()=>[y(t,{class:"w-[10rem]"},{default:w(()=>[y(l,{command:"file"},{default:w(()=>[...s[0]||(s[0]=[k("上传文件",-1)])]),_:1}),y(l,{command:"dir"},{default:w(()=>[...s[1]||(s[1]=[k("上传文件夹",-1)])]),_:1})]),_:1})]),default:w(()=>[s[2]||(s[2]=k(" 上传文件 ",-1))]),_:1}),y(r,{disabled:v(we),onClick:Ce},{default:w(()=>[...s[3]||(s[3]=[k("清空列表",-1)])]),_:1},8,["disabled"])])],64)):h("",!0),v(de).indexOf("uploading")>-1?(c(),p("div",K,[g("span",null,"总进度："+x(v(me).totalProgress)+"%",1),y(n),g("span",null,"正在上传：("+x("".concat(v(me).uploadList,"/").concat(v(oe).length))+")",1),y(n),g("span",null,"上传速度："+x(v(me).currentSpeed)+"/s",1),y(n),g("span",null,"预计耗时："+x(v(me).timeRemaining),1)])):h("",!0),v(de).indexOf("success")>-1?(c(),p("div",T,[g("span",null,"上传大小："+x(v(me).uploadSize),1),y(n),g("span",null,"共耗时："+x(v(me).timeElapsed),1),y(n),g("span",null,"平均上传速度："+x(v(me).averageSpeed)+"/s",1),y(n),g("span",null,"上传成功："+x(v(me).successNumber)+"个",1),m(y(n,null,null,512),[[f,v(me).errorNumber>0]]),m(g("span",null,"上传失败："+x(v(me).errorNumber)+"个",513),[[f,v(me).errorNumber>0]])])):h("",!0),v(ke)?(c(),p("div",X,[...s[4]||(s[4]=[g("span",null,"请将需要上传的文件/文件夹拖到此处",-1)])])):(c(),p("div",A,[g("div",B,[s[5]||(s[5]=g("div",{class:"td !w-[55%]"},"文件名",-1)),s[6]||(s[6]=g("div",{class:"td"},"文件大小",-1)),s[7]||(s[7]=g("div",{class:"td"},"上传状态",-1)),m(g("div",M,"操作",512),[[f,"success"!==v(de)]])]),g("div",null,[y(v(O),{class:_(["!mb-0 overflow-auto file-upload-list files-list","!h-[400px]"]),items:v(oe),"item-size":45,buffer:800,"key-field":"vid"},{default:w(({item:e})=>[g("div",q,[g("div",{class:_({"td-progress":!0,error:"error"===e.status,success:"success"===e.status}),style:z(Se(e))},null,6),g("div",Q,[g("div",V,[g("i",{class:_(["icon-bg","".concat(xe(e),"-icon")])},null,2),g("span",{class:"flex-1 w-0 ml-[4px] truncate h-[20px] leading-[20px]",title:he(e)},x(he(e)),9,W)]),g("div",Y,x(e.size),1),g("div",Z,[m(y(u,{effect:"dark",content:"".concat(v(ve)(e.status)).concat(e.message?"，".concat(e.message):""),placement:"right","show-after":200},{default:w(()=>[m(g("span",$,[k(x(v(ve)(e.status))+" ",1),e.message?(c(),p("span",ee," ,"+x(e.message),1)):h("",!0)],512),[[f,"uploading"!==e.status]])]),_:2},1032,["content"]),[[f,"uploading"!==e.status]]),m(g("span",null,[g("span",null,"上传中("+x(parseInt(e.progress))+"%)",1)],512),[[f,"uploading"===e.status]])]),m(g("div",se,[m(y(d,{onClick:s=>v(ye)(e)},{default:w(()=>[...s[8]||(s[8]=[k("取消",-1)])]),_:1},8,["onClick"]),[[f,v(de).indexOf("paused")>-1]])],512),[[f,"success"!==v(de)]])])])]),_:1},8,["items"])])])),g("div",ae,[v(de).indexOf("paused")>-1?(c(),S(r,{key:0,type:"primary",onClick:je},{default:w(()=>[...s[9]||(s[9]=[k(" 开始上传 ",-1)])]),_:1})):h("",!0),["success","error"].includes(v(de))?(c(),S(r,{key:1,type:"primary",onClick:Ce},{default:w(()=>[...s[10]||(s[10]=[k(" 继续上传 ",-1)])]),_:1})):h("",!0)])])],512)}}}),[["__scopeId","data-v-1e82b219"]]);export{le as default};
