!function(){function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}var n=["status","data","msg"];function t(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,u,o,l=[],i=!0,c=!1;try{if(u=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;i=!1}else for(;!(i=(r=u.call(t)).done)&&(l.push(r.value),l.length!==n);i=!0);}catch(e){c=!0,a=e}finally{try{if(!i&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw a}}return l}}(e,n)||function(e,n){if(e){if("string"==typeof e)return r(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function a(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)t=u[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function u(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function l(t,r,a,u){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return o(s,"_invoke",function(t,r,a){var u,o,l,c=0,s=a||[],f=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return u=n,o=0,l=e,p.n=t,i}};function m(t,r){for(o=t,l=r,n=0;!f&&c&&!a&&n<s.length;n++){var a,u=s[n],m=p.p,d=u[2];t>3?(a=d===r)&&(l=u[(o=u[4])?5:(o=3,3)],u[4]=u[5]=e):u[0]<=m&&((a=t<2&&m<u[1])?(o=0,p.v=r,p.n=u[1]):m<d&&(a=t<3||u[0]>r||r>d)&&(u[4]=t,u[5]=r,p.n=d,o=0))}if(a||t>1)return i;throw f=!0,r}return function(a,s,d){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&m(s,d),o=s,l=d;(n=o<2?e:l)||!f;){u||(o?o<3?(o>1&&(p.n=-1),m(o,l)):p.n=l:p.v=l);try{if(c=2,u){if(o||(a="next"),n=u[a]){if(!(n=n.call(u,l)))throw TypeError("iterator result is not an object");if(!n.done)return n;l=n.value,o<2&&(o=0)}else 1===o&&(n=u.return)&&n.call(u),o<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),o=1);u=e}else if((n=(f=p.n<0)?l:t.call(r,p))!==i)break}catch(n){u=e,o=1,l=n}finally{c=1}}return{value:n,done:f}}}(t,a,u),!0),s}var i={};function c(){}function s(){}function f(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(o(n={},r,function(){return this}),n),m=f.prototype=c.prototype=Object.create(p);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=f,o(m,"constructor",f),o(f,"constructor",s),s.displayName="GeneratorFunction",o(f,a,"GeneratorFunction"),o(m),o(m,a,"Generator"),o(m,r,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),(u=function(){return{w:l,m:d}})()}function o(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,n,t,r){function u(n,t){o(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(u("next",0),u("throw",1),u("return",2))},o(e,n,t,r)}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach(function(n){c(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function c(n,t,r){return(t=function(n){var t=function(n,t){if("object"!=e(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var a=r.call(n,t||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"==e(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function s(e,n,t,r,a,u,o){try{var l=e[u](o),i=l.value}catch(e){return void t(e)}l.done?n(i):Promise.resolve(i).then(r,a)}function f(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var u=e.apply(n,t);function o(e){s(u,r,a,o,l,"next",e)}function l(e){s(u,r,a,o,l,"throw",e)}o(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./index-legacy109.js?v=1763689792"],function(e,r){"use strict";var o,l,c,s,p,m,d,v,y,b,g,h,w,j,k,O,x,_,P,S,D,I,T,z,N,C,G,E,q,A,B,M,U,L,F,W,H,V,R,$,J,K,Q,Y,X,Z,ee,ne,te;return{setters:[function(e){o=e.E,l=e.Q,c=e.jd,s=e.je,p=e.x,m=e.b,d=e.jf,v=e.aA,y=e.jg,b=e.n,g=e.H,h=e.jh,w=e.p,j=e.ji,k=e.ay,O=e.an,x=e._,_=e.aC,P=e.$,S=e.aj,D=e.O},function(e){I=e.r,T=e.e,z=e.aT,N=e.D,C=e.as,G=e.at,E=e.ar,q=e.i,A=e.a8,B=e.c,M=e.x,U=e.y,L=e.A,F=e.B,W=e.z,H=e.C,V=e.F,R=e.b1,$=e.R,J=e.ay,K=e.O,Q=e.aD,Y=e.P,X=e.b6,Z=e.v,ee=e.a0},function(e){ne=e._},function(e){te=e._}],execute:function(){var re=m(),ae=I("all"),ue=null,oe=function(e){return{request:(n=f(u().m(function n(t){var r;return u().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,se(i(i({},t),{},{service_name:e.value.serviceName}),ae.value);case 1:return r=n.v,n.a(2,r)}},n)})),function(e){return n.apply(this,arguments)}),columns:[{label:"名称",prop:"name",align:"center",width:200},{label:"描述",prop:"description",render:function(e){return T(z,{effect:"dark",content:e.description,"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isOverflow},{default:function(){return[T("div",{class:"w-[95%] truncate",ref:function(n){n&&(e._isOverflow=n.scrollWidth>n.clientWidth)}},[e.description])]}})}},{label:"版本",prop:"version",align:"center",width:100},{label:"大小",prop:"size",align:"center",width:100},{label:"状态",prop:"status",align:"center",width:100,renderHeader:function(){return T(E,{onCommand:function(n){return ce(n,ae,e.value)}},{default:function(){return T("div",{class:"flex items-center"},[T("span",null,[N("状态")]),T("span",null,["all"===ae.value?"":"(".concat(ie(ae.value),")")]),T("span",{class:"svgtofont-el-arrow-down"},null)])},dropdown:function(){var e,n;return T(C,null,"function"==typeof(n=e=le.map(function(e){return T(G,{command:e.value},{default:function(){return[e.label]}})}))||"[object Object]"===Object.prototype.toString.call(n)&&!q(n)?e:{default:function(){return[e]}})}})},render:function(n){var t="",r="",a="";switch(n.status){case"installed":t="已安装",r="primary";break;case"downloading":t="下载中",r="warning",a="cursor-pointer flex items-center";break;case"failed":t="失败",r="danger",a="cursor-pointer";break;default:t="未安装",r="#666"}return T("span",{class:"text-".concat(r," ").concat(a),onClick:function(){return pe(n,e.value)}},[t,"downloading"===n.status&&T("span",{class:"inline-block svgtofont-el-loading"},null)])}},{label:"操作",prop:"operate",fixed:"right",width:140,align:"right",render:function(n){return T("div",{class:"w-full flex items-center justify-end"},["installed"===n.status&&T("span",{class:"bt-link",onClick:function(){return fe(n,e.value)}},[N("查看详情")]),"downloading"===n.status&&T("span",null,[N("--")]),"installed"!==n.status&&"downloading"!==n.status&&T("span",{class:"bt-link",onClick:function(){return me(n,e.value)}},[N("下载")]),"installed"===n.status&&T("span",null,[T(ne,null,null),T("span",{class:"bt-link",onClick:function(){return de(n,e.value)}},[N("删除")])])])}}]};var n},le=[{label:"全部",value:"all"},{label:"已安装",value:"installed"},{label:"下载中",value:"downloading"},{label:"失败",value:"failed"},{label:"未安装",value:"uninstall"}],ie=function(e){return{all:"",installed:"已安装",downloading:"下载中",failed:"失败",uninstall:"未安装"}[e]},ce=function(e,n,t){n.value=e,1===t.param.p?t.refresh():t.param.p=1},se=(e("e",{mode:"ace/mode/json",theme:o.value?"ace/theme/clouds_midnight":"ace/theme/monokai",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!0,fontSize:"12px"}),function(){var e=f(u().m(function e(n,t){var r,a;return u().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,l({request:d(i(i({},n),{},{status:t})),loading:"正在获取模型列表"});case 1:if(r=e.v,!(a=r.data).status){e.n=2;break}return e.a(2,{total:v(a.page),data:a.data});case 2:return re.error(a.msg),e.a(2,{total:0,data:[]});case 3:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}()),fe=function(){var e=f(u().m(function e(n,t){return u().w(function(e){for(;;)switch(e.n){case 0:l({request:y({model_name:n.name,model_version:n.version,service_name:t.serviceName}),loading:"正在获取模型详情",success:function(e){e.status&&b({title:"模型详情-".concat(n.name),area:75,component:function(){return g(function(){return r.import("./model-detail-popup-legacy.js?v=1763689792")},void 0,r.meta.url)},compData:JSON.stringify(e.data,null,2),btns:!1})}});case 1:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),pe=function(){var e=f(u().m(function e(n,t){var a,o,l;return u().w(function(e){for(;;)switch(e.n){case 0:if("downloading"===n.status){e.n=1;break}return e.a(2);case 1:return a=[],o=I("正在获取日志"),l=null,function(){var e,n,r;null===(e=ue)||void 0===e||e.close(),null===(n=ue=k({route:"/sock_shell",onMessage:function(e,n){var r=n.data;a.push(r),a.length>50?o.value=a.slice(a.length-50).join("\n"):o.value=a.join("\n"),r.includes("bt_successful")&&(l&&l.unmount(),l=null,t.refresh())}}))||void 0===n||n.send({}),null===(r=ue)||void 0===r||r.send("tail -f /tmp/".concat(t.serviceName,".log"))}(),e.n=2,b({title:"模型安装日志-".concat(n.name),area:75,component:function(){return g(function(){return r.import("./model-install-log-legacy.js?v=1763689792")},void 0,r.meta.url)},compData:o,onCancel:function(){var e;null===(e=ue)||void 0===e||e.close(),l=null},btns:!1});case 2:return l=e.v,e.a(2,l)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),me=function(){var e=f(u().m(function e(n,t){return u().w(function(e){for(;;)switch(e.n){case 0:if(n.can_down){e.n=1;break}return e.a(2,re.error("当前已存在下载任务，请等待下载完成"));case 1:l({request:h({model_name:n.name,service_name:t.serviceName,model_version:n.version}),loading:"正在下载模型",success:function(e){e.status?(re.success("开始下载"),t.refresh(),pe({name:n.name,status:"downloading"},t)):re.error(e.msg)},error:function(){re.error("下载失败")}});case 2:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),de=function(){var e=f(u().m(function e(n,t){return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,w({title:"删除模型-".concat(n.name),content:"确定删除该模型吗？"});case 1:l({request:j({service_name:t.serviceName,model_name:n.name,model_version:n.version}),loading:"正在删除模型",success:function(e){e.status?(t.refresh(),re.success("删除成功")):re.error(e.msg)}}),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(n,t){return e.apply(this,arguments)}}(),ve=I({}),ye=function(e){var n,t,r;return null!=(n=e.power)&&n.current&&(n.current/=1e3),null!=n&&n.max&&(n.max/=1e3),t=e.memory,r=function(e){return p(e*Math.pow(1024,3))},null!=t&&t.free&&(t.free=r(t.free)),null!=t&&t.used&&(t.used=r(t.used)),null!=t&&t.size&&(t.size=r(t.size)),e},be=function(){var e=f(u().m(function e(r){var o,i,f,m,d,v,y;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,o=Number.isInteger(Number(r)),e.n=1,l({request:o?c({index:Number(r)}):s()});case 1:if(i=e.v,f=i.status,m=i.data,d=i.msg,a(i,n),!1!==f){e.n=2;break}return re.error(d),e.a(2,o?void 0:ve.value={system:!1,list:[],tableList:[]});case 2:if(!o){e.n=3;break}return ve.value.list[Number(r)]={key:r,value:ye(m)},e.a(2);case 3:return v=[],y=Object.entries(m).filter(function(e){return"system"!==t(e,1)[0]}).map(function(e){var n,r=t(e,2),a=r[0],u=r[1],o=ye(u);return null===(n=o.processes)||void 0===n||n.forEach(function(e){return v.push({gpu:a,pid:e.pid,type:e.type,name:e.name,memory:p(e.usedGpuMemory)})}),{key:a,value:o}}),m.system.version.cuda="".concat(m.system.version.cuda).split("0").filter(Boolean).join("."),ve.value={system:m.system,list:y,tableList:v},e.a(2,{data:v,total:m.system.count});case 4:e.p=4,e.v,ve.value={system:!1,list:[],tableList:[]};case 5:return e.a(2)}},e,null,[[0,4]])}));return function(n){return e.apply(this,arguments)}}(),ge=x({name:"ollama",props:["compData"],setup:function(e){var n=I(),t=O(oe(n)),r=t.BtTable,a=t.BtPage,u=t.BtSearch,o=t.BtRefresh,l=t.refresh,i=t.param;return n.value={refresh:l,serviceName:e.compData.service_name,param:i},A(function(){ae.value="all",ve.value={}}),function(){return T("div",{class:"relative"},[T(te,null,{"header-left":function(){return T("div",{class:"flex items-center"},[T(u,{class:"!w-[47rem]",placeholder:"请输入模型名称/描述"},null)])},"header-right":function(){return T(o,null,null)},content:function(){return T("div",null,[T(r,{key:"ollamaTable","max-height":410,class:"!min-h-[350px]"},null)])},"footer-right":function(){return T(a,null,null)}})])}}},[["__scopeId","data-v-20353357"]]),he={key:0},we={class:"flex items-center mb-[2rem]"},je={class:"text-base leading-[2.1rem]"},ke={class:"text-base leading-[2.1rem] ml-[2rem]"},Oe={key:1},xe=B({__name:"gpu-info",props:{compData:{}},setup:function(e){var n,t=B({props:{data:{type:Object,required:!0},cpuIndex:{type:Number,required:!0}},setup:function(e){var n=function(n){var t;return"cpuIndex"===n?e.cpuIndex:null!==(t=n.split(".").reduce(function(e,n){return e&&e[n]},e.data))&&void 0!==t?t:"null"},t=[{name:"GPU",key:"cpuIndex"},{name:"型号",key:"name"},{name:"核心频率",key:"clock.graphics",unit:"MHz"},{name:"内存频率",key:"clock.memory",unit:"MHz"},{name:"显存大小",key:"memory.size"},{name:"已使用显存",key:"memory.used"},{name:"剩余显存",key:"memory.free"},{name:"当前功耗",key:"power.current",unit:"W"},{name:"最大功耗",key:"power.max",unit:"W"},{name:"风扇转速",key:"fan",unit:"%"}],r=[{content:"显示null说明可能因驱动版本过低或显卡版本过低无法获取对应数据"}],a=[{name:"GPU使用率",key:"utilization.gpu",unit:"%"},{name:"GPU温度",key:"temperature",unit:"°C"}];return function(){return T("div",{class:"flex h-[41.5rem]"},[T("div",{class:"flex flex-1 justify-evenly"},[a.map(function(e){return T("div",null,[T("div",{class:"flex justify-center mb-[2rem]"},[e.name]),T("div",{class:"p-[12px] flex flex-col items-start"},[T(X,{width:170,type:"circle",percentage:n(e.key),"stroke-width":12,color:"var(--el-color-primary)"},{default:function(){return T("div",null,[T("div",{class:"font-bold text-medium"},[n(e.key)+(e.unit||"")]),T("div",{class:"mt-[1rem] text-base"},[e.name])])}})])])})]),T("div",{class:"flex flex-col items-center justify-start max-w-[20rem]"},[t.map(function(e){return T("div",{class:"flex items-center justify-start w-full text-base leading-[2.6rem]"},[T("span",null,[e.name,N("：")]),T("span",null,[n(e.key)]),T("span",null,[e.unit||""])])}),T(P,{class:"mt-[2.2rem]",options:r},null)])])}}}),r=I("".concat(null===(n=e.compData.value.list[0])||void 0===n?void 0:n.key)||"");return function(n,a){var u,o,l=_,i=J;return M(),U("div",null,[e.compData.value.list&&e.compData.value.list.length>0?(M(),U("div",he,[L("div",we,[L("span",je,"驱动版本："+F(null===(u=W(ve))||void 0===u||null===(u=u.system)||void 0===u?void 0:u.version.driver),1),L("span",ke,"Cuda版本："+F(null===(o=W(ve))||void 0===o||null===(o=o.system)||void 0===o?void 0:o.version.cuda),1)]),T(l,{modelValue:W(r),"onUpdate:modelValue":a[0]||(a[0]=function(e){return $(r)?r.value=e:null}),onChange:W(be)},{default:H(function(){return[(M(!0),U(V,null,R(e.compData.value.list,function(e){return M(),K(W(Q),{key:e.key,name:e.key,label:"gpu".concat(e.key)},{default:H(function(){return[(M(),K(Y(W(t)),{data:e.value,cpuIndex:e.key},null,8,["data","cpuIndex"]))]}),_:2},1032,["name","label"])}),128))]}),_:1},8,["modelValue","onChange"])])):(M(),U("div",Oe,[T(i,{description:"未找到GPU设备或未安装GPU驱动"})]))])}}}),_e={name:"ProcessInfo",props:["compData"],setup:function(e){var n,t=O({request:(n=f(u().m(function n(t){return u().w(function(n){for(;;)if(0===n.n)return n.a(2,{data:e.compData.value.tableList,total:e.compData.value.tableList.length})},n)})),function(e){return n.apply(this,arguments)}),columns:[{label:"GPU",prop:"gpu"},{label:"PID",prop:"pid"},{label:"TYPE",prop:"type"},{label:"进程名称",prop:"name"},{label:"显存占用",prop:"memory"}]}),r=t.BtTable,a=t.refresh,o=null;return Z(function(){o=setInterval(function(){a()},2e3)}),A(function(){clearInterval(o)}),function(){return T("div",null,[T(te,null,{content:function(){return T(r,{"max-height":500},null)}})])}}},Pe=B({__name:"index",props:{compData:{type:Object,default:function(){return{}}}},setup:function(e){var n=e,t=I(!1),r=I(n.compData.tabActive||"manager");ee("gpuOpenStatus",t);var a=S({type:"left-bg-card",value:r,options:[{label:"模型管理",name:"manager",lazy:!0,render:function(){return T(ge,{compData:n.compData},null)}},{label:"显卡信息",name:"gpu",lazy:!0,render:function(){return T(xe,{compData:ve},null)}},{label:"进程信息",name:"process",lazy:!0,render:function(){return T(_e,{compData:ve},null)}}]}).BtTabs,u=null;return Z(function(){if(n.compData.appinfo&&n.compData.appinfo.length>0){var e=n.compData.appinfo.find(function(e){return"gpu"===e.fieldKey});e&&e.fieldValue&&(t.value=!0)}t.value?(be(),u=setInterval(function(){D(["/mod/docker/gpu/get_all_device_info"]),be()},3e3)):ve.value={system:!1,list:[],tableList:[]}}),A(function(){u&&clearInterval(u)}),function(e,n){return M(),K(W(a))}}}),Se=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));e("i",Se)}}})}();
