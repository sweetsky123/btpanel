import{B as e}from"./index119.js?v=1763689792";import{u as a,p as l,Q as t,ax as s,l as i,ah as r,e as n,j as c,b as o,_ as d}from"./utils-lib.js?v=1763689792";import{c as m,t as u,s as v,r as p,g as f,e as x,be as w,w as y,I as b,x as _,y as g,A as h,z as k,F as j,B as C,b1 as V,M as S,R as M,C as q,D,J as T,H,ap as U,b2 as z,f as F,aY as L}from"./base-lib.js?v=1763689792";import{_ as A}from"./index109.js?v=1763689792";import{H as I}from"./index344.js?v=1763689792";import{a as J,u as N}from"./column.js?v=1763689792";import{dd as B,de as E,df as O,c_ as P}from"./validator.js?v=1763689792";import{S as R}from"./useStore4.js?v=1763689792";import{f as Q}from"./useMethod8.js?v=1763689792";import"./ace.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";import"./site.js?v=1763689792";import"./firewall.js?v=1763689792";import"./useStore6.js?v=1763689792";const Y={class:"text-right text-secondary mb-2"},G={class:"flex mb-[1.6rem] p-[1.6rem] border-[0.1rem] border-lighter rounded-base"},K={class:"text-small text-secondary mb-[1.6rem]"},W={class:"flex justify-between items-center"},X={class:"flex items-center"},Z={class:"flex items-center"},$={key:1,class:"p-[1rem]"},ee={class:"flex justify-between items-center px-4"},ae={class:"text-extraLarge"},le=["innerHTML"],te={class:"text-medium mt-[1.2rem]"},se={class:"text-base"},ie={class:"flex justify-center"},re={class:"p-[2rem]"},ne={class:"flex items-center mb-[1.6rem]"},ce={class:"flex-1 truncate"},oe={class:"flex items-center mb-[1.6rem]"},de={class:"flex-1 truncate"},me={class:"flex items-center mb-[1.6rem]"},ue={class:"flex-1 truncate"},ve={class:"flex items-center mb-[1.6rem]"},pe={class:"flex-1 truncate"},fe={class:"flex items-center mb-[1.6rem]"},xe={class:"flex-1 truncate"},we={class:"flex items-center mb-[1.6rem]"},ye={class:"flex-1 truncate"},be={class:"flex items-center"},_e={class:"flex-1"},ge={class:"p-20px"},he=d(m({__name:"malware",setup(d){const{payment:m}=a(),{authType:he}=u(m.value),ke=I(),{repairTypeActive:je,tootipTotal:Ce,malwareData:Ve}=v(ke),{getScanTotal:Se,openPayView:Me,convertDataStructure:qe,malwareAdvanced:De,setMalwareConfig:Te}=ke,He=o(),{getFileEvent:Ue,saveFileEvent:ze}=R(),Fe=p(),Le=p([{title:"总检测文件数",value:0,style:"color: var(--el-color-text-primary)"},{title:"高危",value:0,style:"color: var(--el-color-danger);",id:2},{title:"中危",value:0,style:"color: var(--el-color-warning)",id:1},{title:"低危",value:0,style:"color: var(--el-color-warning-light-3)",id:0}]),Ae=[{label:"不限时间",value:""},{label:"最近1天",value:1},{label:"最近7天",value:7},{label:"最近30天",value:30}],Ie=p("");p(!1);const Je=p(!1),Ne=p(!1),Be=p({filename:"",filepath:"",threat_type:"",md5:"",risk_level:0,time:"",quarantined:!1,rule:"",processed:0,risk_level_desc:""}),Ee=p(""),Oe=p(""),Pe=p(!1),Re=p({total:0,loading:!1,data:[]}),Qe=f(()=>{const e=Ce.value.malware;return e?'<span class="text-danger">'.concat(e,"</span>个高危文件待处理！总扫描文件数量").concat(Le.value[0].value,"个"):"已完成".concat(Le.value[0].value,"个文件深度扫描，未发现任何恶意文件或异常行为")}),Ye=[J({key:"keyid"}),{label:"文件名",prop:"filename"},{label:"威胁标签",prop:"threat_type",width:86,render:e=>x(w,{type:"info",effect:"plain"},{default:()=>["网站后门"]})},{label:"MD5",prop:"md5",width:140,render:e=>x("div",{class:"truncate w-[15rem]",title:e.md5},[e.md5])},{label:"等级",prop:"risk_level_desc",width:50,render:e=>{var a;let l=null==(a=Le.value.find(a=>a.id===e.risk_level))?void 0:a.style;return x("span",{style:l},[e.risk_level_desc])}},{label:"检测时间",prop:"time",width:140},N([{onClick:async e=>{await l({title:"忽略恶意文件",content:"是否忽略该文件？",onConfirm:async()=>{const{filepath:a,md5:l,filename:s,risk_level:i}=e,r=await t({loading:"正在保存配置，请稍后...",request:B({filepath:a,md5:l,filename:s,risk:i})});r.status?He.success("忽略成功"):He.error(r.msg),await ea()}})},title:"忽略"},{onClick:async e=>{await l({title:"处理恶意文件",content:"是否要删除关联的源文件？",onConfirm:async()=>{await t({loading:"正在保存配置，请稍后...",request:E({file_list:JSON.stringify([{filepath:e.filepath,md5:e.md5}]),action_type:"delete"}),message:!0}),await ea()}})},title:"处理"},{onClick:async e=>{Be.value=e,Ne.value=!0},title:"详情"}])],Ge=async e=>{Ie.value=e,await We()},Ke=async e=>{let a=e?"开启":"关闭",t=e?"将全天候检测系统是否存在恶意文件":"将不再检测系统是否存在恶意文件";await l({title:"".concat(a,"动态查杀"),content:"".concat(a,"后，").concat(t,"，是否继续？")}),Je.value=e,await Te({dynamic_detection:Je.value})},We=async()=>{Re.value.loading=!0;const e=""!==Ie.value?{day:Number(Ie.value)}:void 0,{data:a}=await O(e);Re.value.loading=!1,Re.value.data=a.detected.map((e,a)=>({...e,keyid:a})),Ee.value=a.last_scan_time;const{total_scanned_files:l,risk_stats:t}=a;Le.value[0].value=l,Le.value[1].value=t[2],Le.value[2].value=t[1],Le.value[3].value=t[0]},Xe=async()=>{const e=await Ue({path:Be.value.filepath});if(!e.status)return He.error(e.data.msg),!1;Oe.value=e.data.data||e.msg,Pe.value=!0},Ze=async()=>{const e=await ze({path:Be.value.filepath,data:Oe.value,encoding:"utf-8"});He.request(e)},$e=[{label:"处理恶意文件",value:"delete",event:async(e,a)=>{await Q(e,a,async e=>{const a={filepath:e.filepath,md5:e.md5};return await E({file_list:JSON.stringify([a]),action_type:"delete"})},{label:"文件名",prop:"filename"},ea)}}],ea=async(e=!1)=>{await(async()=>{const{data:e}=await P(),a=e.data;Je.value=a.dynamic_detection,Ve.value.autoIntercept=a.quarantine,Ve.value.ossConfig={status:a.scan_oss,isHasMounts:a.has_oss_mounts},Ve.value.exclude_dirs=qe(a.exclude_dirs),Ve.value.monitor_dirs=qe(a.monitor_dirs)})(),await We(),e||await Se()};return y(je,e=>{"malware"===e&&ea(!0)}),(a,l)=>{const t=s,o=H,d=U,m=i,u=r,v=A,p=z,f=F,w=n,y=L,I=c,J=e,N=b("bt-loading");return _(),g("div",null,[l[20]||(l[20]=h("div",{class:"text-large mb-6"},"恶意文件检测",-1)),"ltd"===k(he)?(_(),g(j,{key:0},[h("div",Y,"最近一次扫描时间："+C(k(Ee)),1),h("div",G,[(_(!0),g(j,null,V(k(Le),e=>(_(),g("div",{class:"flex-1",key:e.title},[h("div",K,C(e.title),1),h("div",{class:"text-subtitleLarge",style:S(e.style)},C(e.value),5)]))),128))]),h("div",W,[x(t,{modelValue:k(Ie),"onUpdate:modelValue":l[0]||(l[0]=e=>M(Ie)?Ie.value=e:null),options:Ae,onChange:Ge,class:"mr-[1rem] !w-[12rem]","empty-values":[null,void 0]},null,8,["modelValue"]),h("div",X,[x(o,{size:"small",onClick:k(De)},{default:q(()=>[...l[5]||(l[5]=[D("高级设置",-1)])]),_:1},8,["onClick"]),l[7]||(l[7]=h("span",{class:"text-tertiary mx-[1.2rem]"},"|",-1)),h("div",Z,[l[6]||(l[6]=h("span",{class:"mr-[.8rem]"},"动态查杀开关",-1)),x(d,{modelValue:k(Je),"onUpdate:modelValue":l[1]||(l[1]=e=>M(Je)?Je.value=e:null),size:"small",onChange:Ke},null,8,["modelValue"])])])]),x(v,null,{content:q(()=>[T(x(m,{ref_key:"malwareTable",ref:Fe,column:Ye,data:k(Re).data,"max-height":"270",description:"文件列表为空"},null,8,["data"]),[[N,k(Re).loading],[N,"正在获取恶意文件列表，请稍后...","title"]])]),"footer-left":q(()=>[x(u,{"table-ref":k(Fe),options:$e},null,8,["table-ref"])]),_:1}),l[8]||(l[8]=h("ul",{class:"ml-6 mt-6 list-disc leading-10"},[h("li",{class:"text-secondary"},"恶意文件检测每6小时自动运行，24小时不间断保护您的系统安全，无需任何手动操作！")],-1))],64)):(_(),g("div",$,[h("div",ee,[h("div",ae,[h("span",{class:"font-bold",innerHTML:k(Qe)},null,8,le),h("p",te,"上一次扫描时间："+C(k(Ee)),1)]),x(o,{type:"primary",onClick:k(Me),class:"h-[4rem] w-[10rem]",size:"large"},{default:q(()=>[h("span",se,C(k(Ce).malware>0?"立即处理":"立即开启"),1)]),_:1},8,["onClick"])]),x(p),h("div",ie,[x(f,{class:"w-[63rem] mr-[2rem]",fit:"scale-down",src:"https://www.bt.cn/Public/new/plugin/introduce/home/malware.png"}),l[9]||(l[9]=h("div",{class:"max-w-[22rem]"},[h("span",{class:"text-large font-bold"},"恶意文件检测工具介绍"),h("ul",{class:"block leading-[2.6rem] mx-[2rem] list-square mt-[2rem]"},[h("li",null,[D("支持检测21种恶意文件类型： "),h("br"),D("反弹Shell后门、DDoS木马、下载器木马、 黑客工具、高危程序、被污染的基础软件、 恶意脚本、恶意程序、挖矿程序、 代理工具、勒索病毒、高危软件、 Rootkit、窃密工具、恶意扫描器、 可疑程序、感染型病毒、网站后门、 蠕虫病毒、广告程序、破解程序")])])],-1))])])),x(I,{modelValue:k(Ne),"onUpdate:modelValue":l[2]||(l[2]=e=>M(Ne)?Ne.value=e:null),title:"[".concat(k(Be).filename,"]详情"),area:54},{default:q(()=>[h("div",re,[h("div",ne,[l[10]||(l[10]=h("div",{class:"text-small text-black w-[10rem]"},"文件名称",-1)),h("div",ce,C(k(Be).filename),1)]),h("div",oe,[l[11]||(l[11]=h("div",{class:"text-small text-black w-[10rem]"},"文件路径",-1)),h("div",de,C(k(Be).filepath),1)]),h("div",me,[l[12]||(l[12]=h("div",{class:"text-small text-black w-[10rem]"},"MD5",-1)),h("div",ue,C(k(Be).md5),1)]),h("div",ve,[l[13]||(l[13]=h("div",{class:"text-small text-black w-[10rem]"},"威胁标签",-1)),h("div",pe,C(k(Be).threat_type),1)]),h("div",fe,[l[14]||(l[14]=h("div",{class:"text-small text-black w-[10rem]"},"是否已进行隔离",-1)),h("div",xe,C(k(Be).quarantined?"是":"否"),1)]),h("div",we,[l[16]||(l[16]=h("div",{class:"text-small text-black w-[10rem]"},"样本文件",-1)),h("div",ye,[x(w,{onClick:Xe},{default:q(()=>[...l[15]||(l[15]=[D("查看",-1)])]),_:1})])]),l[19]||(l[19]=h("div",{class:"mb-[1rem] mt-[4rem] font-bold text-default text-base"},"事件说明",-1)),h("div",be,[h("div",_e,[x(y,{style:{width:"480px"},shadow:"always",class:"p-[1rem]"},{default:q(()=>[l[17]||(l[17]=D(" 发现了一个可疑文件，建议您先确认文件合法性并进行处理 ",-1)),x(p,{class:"!my-1.2rem"}),l[18]||(l[18]=h("div",{class:"flex flex-wrap"},[h("div",null,"处置建议:"),h("div",null,"如果您确认该文件不是自己部署的业务所需文件，请隔离该文件，或直接删除。如果您确定为误报，请先忽略该告警。")],-1))]),_:1})])])])]),_:1},8,["modelValue","title"]),x(I,{title:"在线编辑",showFooter:"",modelValue:k(Pe),"onUpdate:modelValue":l[4]||(l[4]=e=>M(Pe)?Pe.value=e:null),area:70,onConfirm:Ze},{default:q(()=>[h("div",ge,[x(J,{modelValue:k(Oe),"onUpdate:modelValue":l[3]||(l[3]=e=>M(Oe)?Oe.value=e:null),class:"!h-[40rem]"},null,8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c7e16b8f"]]);export{he as default};
