import{_ as e}from"./index109.js?v=1763689792";import{p as a,M as s,Q as i,l as t,j as d}from"./utils-lib.js?v=1763689792";import{c as n,t as l,r as m,g as c,o as r,aE as o,v as p,I as u,x as E,y as g,e as b,C as T,D as R,J as f,z as h,A as v,O as A,S as C,F as _,b1 as S,K as D,H as L,am as w,an as I,bc as P,ad as y,b$ as N,ab as O,bp as U}from"./base-lib.js?v=1763689792";import{u as V}from"./column.js?v=1763689792";import{getDatabasesList as k,delUserGrants as x,addUserGrants as j}from"./database.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const W=[{name:"数据权限",msg:"数据权限",description:"数据权限",select:!0,id:1,children:[{id:2,name:"SELECT",description:"SELECT--允许用户查询（读取）数据库中的数据。",select:!0,msg:"读取数据"},{id:3,name:"INSERT",description:"INSERT--允许用户向数据库表中插入新数据。",select:!0,msg:"插入/替换数据"},{id:4,name:"UPDATE",description:"UPDATE--允许用户修改数据库表中的数据。",select:!0,msg:"修改数据"},{id:5,name:"DELETE",description:"DELETE--允许用户从数据库表中删除数据。",select:!0,msg:"删除数据"},{name:"FILE",id:22,description:"允许用户读取或写入文件。",msg:"文件读取/写入"}]},{name:"结构权限",msg:"结构权限",description:"结构权限",select:!0,id:6,children:[{id:7,name:"CREATE",description:"允许用户创建新的数据库、表格或索引。",select:!0,msg:"创建数据库/表"},{id:8,name:"ALTER",description:"允许用户修改数据库表的结构（例如，添加、删除列）。",select:!0,msg:"修改表结构"},{id:9,name:"INDEX",description:"允许用户创建和删除索引，以提高查询性能。",select:!0,msg:"创建/删除索引"},{id:10,name:"DROP",description:"允许用户删除数据库、表格或索引。",select:!0,msg:"删除数据库/表"},{id:11,name:"CREATE TEMPORARY TABLES",description:"允许用户创建临时表格，这些表格在会话结束后会自动删除。",select:!0,msg:"创建临时表格"},{id:12,name:"SHOW VIEW",description:"允许用户查看数据库中的视图。",select:!0,msg:"查看视图"},{id:13,name:"CREATE ROUTINE",description:"允许用户创建存储过程和函数。",select:!0,msg:"创建存储过程/函数"},{id:14,name:"ALTER ROUTINE",description:"允许用户修改存储过程和函数。",select:!0,msg:"修改存储过程/函数"},{id:15,name:"EXECUTE",description:"允许用户执行存储过程和函数。",select:!0,msg:"执行存储过程/函数"},{id:16,name:"CREATE VIEW",description:"允许用户创建数据库中的视图。",select:!0,msg:"创建视图"},{id:17,name:"EVENT",description:"允许用户创建、修改和删除数据库事件。",select:!0,msg:"创建/修改/删除事件"},{id:18,name:"TRIGGER",description:"允许用户创建和管理数据库触发器。",select:!0,msg:"创建/管理触发器"}]},{name:"管理权限",msg:"管理权限",description:"管理权限",include:!0,id:19,children:[{id:20,name:"GRANT",description:"允许用户授予、撤销或管理其他用户的权限。",msg:"添加用户/权限,不重载权限"},{id:23,name:"SUPER",description:"允许用户执行特殊操作，如启动或停止数据库服务器。",msg:"达到最大连接数时,杀死其他用户进程"},{id:24,name:"PROCESS",description:"允许用户查看其他用户的数据库连接进程。",msg:"查看其他用户的连接进程"},{id:25,name:"RELOAD",description:"允许用户重新加载数据库服务器的配置。",msg:"重载数据库的配置"},{id:26,name:"SHUTDOWN",description:"允许用户关闭数据库服务器。",msg:"关闭数据库服务器"},{id:27,name:"SHOW DATABASES",description:"允许用户查看可用的数据库列表。",msg:"查看可用的数据库列表"},{id:21,name:"LOCK TABLES",description:"允许用户锁定表格，以控制并发访问。",select:!0,msg:"锁定表格"},{id:32,name:"REFERENCES",description:"允许用户创建和使用外键，以维护数据完整性。",msg:"创建/使用外键"},{id:29,name:"REPLICATION CLIENT",description:"允许用户作为复制客户端连接到主从复制系统。",msg:"作为复制客户端连接到主从复制系统"},{id:30,name:"REPLICATION SLAVE",description:"允许用户作为复制从属连接到主从复制系统。",msg:"作为复制从属连接到主从复制系统"},{id:31,name:"CREATE USER",description:"允许用户创建、更改和删除数据库用户账户。",msg:"创建/更改/删除数据库用户"}]}],G=[{name:"数据权限",msg:"数据权限",description:"数据权限",select:!0,id:1,children:[{id:2,name:"SELECT",description:"SELECT--允许用户查询（读取）数据库中的数据。",select:!0,msg:"读取数据"},{id:3,name:"INSERT",description:"INSERT--允许用户向数据库表中插入新数据。",select:!0,msg:"插入/替换数据"},{id:4,name:"UPDATE",description:"UPDATE--允许用户修改数据库表中的数据。",select:!0,msg:"修改数据"},{id:5,name:"DELETE",description:"DELETE--允许用户从数据库表中删除数据。",select:!0,msg:"删除数据"}]},{name:"结构权限",msg:"结构权限",description:"结构权限",select:!0,id:6,children:[{id:7,name:"CREATE",description:"允许用户创建新的数据库、表格或索引。",select:!0,msg:"创建数据库/表"},{id:8,name:"ALTER",description:"允许用户修改数据库表的结构（例如，添加、删除列）。",select:!0,msg:"修改表结构"},{id:9,name:"INDEX",description:"允许用户创建和删除索引，以提高查询性能。",select:!0,msg:"创建/删除索引"},{id:10,name:"DROP",description:"允许用户删除数据库、表格或索引。",select:!0,msg:"删除数据库/表"},{id:11,name:"CREATE TEMPORARY TABLES",description:"允许用户创建临时表格，这些表格在会话结束后会自动删除。",select:!0,msg:"创建临时表格"},{id:12,name:"SHOW VIEW",description:"允许用户查看数据库中的视图。",select:!0,msg:"查看视图"},{id:13,name:"CREATE ROUTINE",description:"允许用户创建存储过程和函数。",select:!0,msg:"创建存储过程/函数"},{id:14,name:"ALTER ROUTINE",description:"允许用户修改存储过程和函数。",select:!0,msg:"修改存储过程/函数"},{id:15,name:"EXECUTE",description:"允许用户执行存储过程和函数。",select:!0,msg:"执行存储过程/函数"},{id:16,name:"CREATE VIEW",description:"允许用户创建数据库中的视图。",select:!0,msg:"创建视图"},{id:17,name:"EVENT",description:"允许用户创建、修改和删除数据库事件。",select:!0,msg:"创建/修改/删除事件"},{id:18,name:"TRIGGER",description:"允许用户创建和管理数据库触发器。",select:!0,msg:"创建/管理触发器"}]},{name:"管理权限",msg:"管理权限",description:"管理权限",include:!0,id:19,children:[{id:20,name:"GRANT",description:"允许用户授予、撤销或管理其他用户的权限。",msg:"添加用户/权限,不重载权限"},{id:21,name:"LOCK TABLES",description:"允许用户锁定表格，以控制并发访问。",select:!0,msg:"锁定表格"},{id:22,name:"REFERENCES",description:"允许用户创建和使用外键，以维护数据完整性。",msg:"创建/使用外键"}]}],H={class:"p-[20px]"},B={class:"p-[20px]"},F={class:"w-[38rem] max-h-[18rem] overflow-auto border border-solid p-[12px] border-darker"},X=n({__name:"user-auth",props:{compData:{default:{}}},setup(n){const X=n,{proxy:q}=U(),{row:K,sid:M}=l(X.compData),Y=m(!1),$=m(),z=m([]),J=c(()=>{var e;return"*"===ee.dbname?W:"*"!==ee.dbname&&"*"!==ee.tbname?null==(e=G.find(e=>1===e.id))?void 0:e.children:G}),Q=c(()=>"*"===ee.dbname?[]:[1,6,21,22]),Z=r({children:"children",label:"msg",disabled:e=>"*"!==ee.dbname&&"*"!==ee.tbname&&![1,2,3,4,5].includes(e.id)}),ee=r({database:"",table:"",access:[],dbname:"*",tbname:"*",loading:!1,selected:[1,6,21,22]}),ae={dbname:[{required:!0,message:"请选择数据库",trigger:["blur"]}],tbname:[{validator:(e,a,s)=>{""===a&&"*"!==ee.dbname?s(new Error("请选择数据库表")):s()},trigger:["blur"]}]},se=async()=>{try{ee.loading=!0;const{data:e}=await k({sid:M.value});z.value=e.data,de.addPermissionPopup=!0}catch(e){}finally{ee.loading=!1}},ie=async()=>{try{await $.value.validate(),ee.loading=!0;const e=(()=>{const e=q.$refs.tree.getCheckedNodes().filter(e=>e.name&&!e.children).map(e=>e.name).join(",");return{sid:M.value,host:K.value.host,username:K.value.user,db_name:ee.dbname,tb_name:ee.tbname,access:e,with_grant:0}})();if(""===e.access)return s.error("权限不可为空，请选择权限！");await i({loading:"正在添加权限，请稍后...",request:j(e),message:!0,success:()=>{de.addPermissionPopup=!1,te(K.value.user,K.value.host)}})}catch(e){}finally{ee.loading=!1}},te=async(e,a)=>{try{Y.value=!0;const{data:s}=await X.compData.refreshEvent();let i=s.find(a=>a.user===e).list.find(e=>e.host===a).access_list;de.associatedData=i,Y.value=!1}catch(s){}finally{Y.value=!1}},de=r({addPermissionPopup:!1,associatedData:[],associatedDataColumn:[{label:"数据库",render:e=>"*"===e.database?e.database+" -所有数据库":e.database},{label:"表",render:e=>"*"===e.table?e.table+" -所有表":e.table},{label:"权限",width:"320",render:e=>o("div",{class:"truncate break-words max-h-[8rem] overflow-auto whitespace-nowrap"},[e.access.map(e=>"".concat(e.title?e.title:e.msg,"：").concat(e.access?e.access:e.name)).join("\n")])},V([{title:"删除",onClick:async e=>{try{await a({title:"删除权限",icon:"warning-filled",content:"即将删除【"+e.database+"】的权限，是否继续?"});const i=await x({sid:M.value,host:K.value.host,username:K.value.user,db_name:e.database,tb_name:e.table,access:e.access.map(e=>e.access).join(","),with_grant:0});te(K.value.user,K.value.host),s.request(i)}catch(i){}}}])]});return p(async()=>{de.associatedData=K.value.access_list}),(a,s)=>{const i=L,n=t,l=w,m=I,c=P,r=y,o=N,p=O,U=d,V=e,k=u("bt-loading");return E(),g("div",H,[b(V,null,{"header-left":T(()=>[b(i,{type:"primary",onClick:se},{default:T(()=>[...s[4]||(s[4]=[R("添加权限",-1)])]),_:1})]),content:T(()=>[f(b(n,{"max-height":"500",data:h(de).associatedData,column:h(de).associatedDataColumn,"default-sort":{prop:"user",order:"descending"}},null,8,["data","column"]),[[k,h(Y)],[k,"正在加载列表，请稍后...","title"]])]),popup:T(()=>[b(U,{title:"添加权限",modelValue:h(de).addPermissionPopup,"onUpdate:modelValue":s[3]||(s[3]=e=>h(de).addPermissionPopup=e),area:60,onConfirm:ie,"show-footer":""},{default:T(()=>[v("div",B,[f((E(),A(p,{rules:ae,"label-width":"100px",model:h(ee),ref_key:"addUserPermissionFormRef",ref:$,"label-position":"right",onSubmit:s[2]||(s[2]=C(()=>{},["prevent"]))},{default:T(()=>[b(r,{label:"数据库权限关联",prop:"dbname"},{default:T(()=>[b(c,{span:8},{default:T(()=>[b(m,{class:"!w-[15rem]",modelValue:h(ee).dbname,"onUpdate:modelValue":s[0]||(s[0]=e=>h(ee).dbname=e)},{default:T(()=>[(E(!0),g(_,null,S(h(z),(e,a)=>(E(),A(l,{key:a,label:e.name,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(b(c,{span:10},{default:T(()=>[b(r,{prop:"tbname"},{default:T(()=>[b(m,{class:"!w-[22.3rem] ml-[1rem]",modelValue:h(ee).tbname,"onUpdate:modelValue":s[1]||(s[1]=e=>h(ee).tbname=e)},{default:T(()=>[(E(!0),g(_,null,S(h(z).find(e=>e.value===h(ee).dbname).tb_list,(e,a)=>(E(),A(l,{key:a,label:e.name,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512),[[D,"*"!==h(ee).dbname]])]),_:1}),b(r,{label:"基础权限"},{default:T(()=>[v("div",F,[b(o,{data:h(J),"node-key":"id","default-expand-all":"","show-checkbox":"",ref:"tree","default-checked-keys":h(Q),props:h(Z)},null,8,["data","default-checked-keys","props"])])]),_:1})]),_:1},8,["model"])),[[k,h(ee).loading]])])]),_:1},8,["modelValue"])]),_:1})])}}});export{X as default};
