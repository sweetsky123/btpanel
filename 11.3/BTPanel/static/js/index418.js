import{B as a,Q as e,L as t,k as l,bE as s,l as r,$ as n,b as i}from"./utils-lib.js?v=1763689792";import{r as u,e as o,D as v,aT as d,c,s as m,g as p,H as f,w as y,v as _,a8 as b,I as h,x,y as g,A as w,B as k,z as j,J as S,C}from"./base-lib.js?v=1763689792";import{u as D}from"./useStore12.js?v=1763689792";import{s as T,n as B}from"./ssl.js?v=1763689792";import{_ as L}from"./index110.js?v=1763689792";import{u as V}from"./useStore11.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./site.js?v=1763689792";import"./useStore4.js?v=1763689792";const q=u(!1),H=u([]),J=u({verify_name:"",verify_value:"",domain:""}),O=u(null),R=u({}),U=u([{label:"URL",prop:"domain",showOverflowTooltip:!0,render:a=>o("span",null,[A(a)])},{label:"验证结果",prop:"status",width:100,render:a=>o("span",{class:"".concat(a.status?"text-primary":"text-danger")},[a.status?"成功":"失败"])},{label:"自动设置验证值",prop:"verify_status",width:120,isHide:()=>3===O.value,render:a=>a.verify_status?o("span",{class:"text-primary"},[v("成功")]):o(d,{placement:"top",content:a.msg,enterable:!1},{default:()=>[o("span",{class:"text-danger"},[v("失败")])]})},{label:"操作",align:"right",width:160,render:(e,t)=>{const l=[];return 3===O.value&&l.push(o("span",{class:"cursor-pointer bt-link",onClick:()=>a({value:A(e)})},[v("复制")]),o(L,null,null),o("a",{class:"bt-link",href:A(e),target:"_blank"},[v("打开")]),o(L,null,null)),l.push(o("span",{class:"cursor-pointer bt-link",onClick:()=>I(e,t)},[v("重新验证")])),o("div",{class:"flex items-center justify-end"},[l])}}]),A=a=>3!==O.value?a.domain:"http://".concat(a.domain).concat(J.value.verify_name),I=async(a,t)=>{try{const{verify_name:l,verify_value:s}=J.value,r=X({domain:a.domain,verify_name:l,verify_value:s,dns_id:""}),n=3===O.value,{data:i}=await e({loading:"正在重新验证，请稍候...",request:T({verify_type:n?"file":"dns",verify_data:JSON.stringify(r),set_verify_value:!1})}),{local_verify:u,status:o}=i.data[0].rep;H.value[t].status=u,H.value[t].verify_status=o}catch(l){}},N=async()=>{var a;q.value=!0;const t=3===O.value,{domain:l,verify_name:s,verify_value:r}=J.value,{set_verify:n,dns_id:i}=R.value;try{const u=X({domain:l,verify_name:s,verify_value:r,dns_id:i}),{data:o}=await e({request:T({verify_type:t?"file":"dns",verify_data:JSON.stringify(u),set_verify_value:Boolean(n)})});H.value=null==(a=o.data)?void 0:a.map(a=>({domain:a.domain,status:a.rep.local_verify,verify_status:a.rep.status,msg:a.rep.msg}))}catch(u){}finally{q.value=!1}},X=a=>{const{domain:e,verify_name:t,verify_value:l,dns_id:s}=a;return 3===O.value?[{domain:e,file_name:t,file_value:l}]:[{domain:e,record_type:"TXT",dns_id:s||"",sub_domain:t,dns_value:l}]},z={class:"p-[5rem]"},E={class:"text-base mb-[2rem]"},F={class:"text-primary"},P={class:"mt-[20px]"},Q=c({__name:"index",props:{compData:{}},emits:["close"],setup(d,{emit:c}){var T,L,A;const{otherPopup:I,isRefreshBtSSL:X}=D(),{btIsRefresh:Q}=m(V()),$=i(),G=d;R.value=G.compData,J.value=(null==(T=G.compData)?void 0:T.cert_info)||{},O.value=null==(L=G.compData)?void 0:L.product_id;const K=null==(A=G.compData)?void 0:A.id,M=3===O.value,W=u([{content:"本次验证结果是由【本服务器验证】，实际验证将由【CA服务器】进行验证，请耐心等候"},{content:"请确保以上列表所有项都验证成功后点击【验证域名】重新提交验证"},{content:()=>o("span",null,[v("如何添加域名解析，《"),o("a",{href:"https://cloud.tencent.com/document/product/302/3446",class:"text-primary",target:"__blink"},[v("点击查看教程")]),v("》，和咨询服务器运营商")])}]),Y=p(()=>{const{verify_name:a,verify_value:e}=J.value;return null===a||null===e}),Z=e=>{a({value:e})},{BtForm:aa,param:ea}=t({data:()=>({verify_name:J.value.verify_name||"",verify_value:J.value.verify_value||""}),options:a=>p(()=>[{type:"custom",render:()=>o(s,{label:M?"文件名：":"主机记录："},{default:()=>[o(l,{modelValue:a.value.verify_name,"onUpdate:modelValue":e=>a.value.verify_name=e,class:"!w-[36rem] mr-[1rem]",type:"text",readonly:!0},null),o(f,{type:"primary",onClick:()=>Z(a.value.verify_name)},{default:()=>[v("复制")]})]})},{type:"custom",render:()=>o(s,{label:"记录值："},{default:()=>[o("div",{class:"flex"},[o(l,{modelValue:a.value.verify_value,"onUpdate:modelValue":e=>a.value.verify_value=e,class:"!w-[36rem] mr-[1rem]",type:"textarea",rows:3,readonly:!0},null),o(f,{type:"primary",onClick:()=>Z(a.value.verify_value),class:"align-top"},{default:()=>[v("复制")]})])]})}])});y(()=>J.value,a=>{ea.value&&(ea.value.verify_name=a.verify_name||"",ea.value.verify_value=a.verify_value||"")},{deep:!0}),_(()=>{(async()=>{if(M&&W.value.splice(2,1,{content:()=>o("span",null,[v("SSL添加文件验证方式 ->> "),o("a",{href:"https://www.bt.cn/bbs/thread-56802-1-1.html",target:"_blank",class:"text-primary"},[v("查看教程")])])}),!Y.value)return void N();const a=$.load("正在获取证书详情，请稍后...");try{const{data:a}=await e({request:B({url:"/api/v1/ssl/cert/get_cert_detail",order_id:K})});J.value=a.data.cert_data||{},N()}catch(t){}finally{a.close()}})()}),b(()=>{I.value=null});const ta=c;return(a,e)=>{var t,l;const s=r,i=n,u=h("bt-loading");return x(),g("div",z,[w("div",E,[e[2]||(e[2]=v(" 请给以下域名【 ",-1)),w("span",F,k(null==(l=null==(t=G.compData)?void 0:t.cert_info)?void 0:l.domain),1),e[3]||(e[3]=v(" 】 ",-1)),w("span",null,"添加“"+k(M?"文件验证":"TXT")+"”记录解析，解析参数如下：",1)]),o(j(aa),{class:"mb-[20px]"}),S(o(s,{column:j(U),data:j(H)},null,8,["column","data"]),[[u,j(q)]]),o(i,{options:j(W),class:"ml-[20px] mt-[12px]"},null,8,["options"]),w("div",P,[o(j(f),{type:"primary",onClick:e[0]||(e[0]=a=>{var e;return(async a=>{var e;const t=$.load("正在验证域名，请稍后...");try{const{data:t}=await B({url:"/api/v1/ssl/cert/submit_verify",order_id:a});t.status&&(null==(e=I.value)||e.unmount(),X.value=!0,Q.value=!0),$[t.status?"success":"error"](t.msg)}catch(l){}finally{t.close()}})(null==(e=G.compData)?void 0:e.id)})},{default:C(()=>[...e[4]||(e[4]=[v("验证域名",-1)])]),_:1}),o(j(f),{type:"default",onClick:e[1]||(e[1]=a=>ta("close"))},{default:C(()=>[...e[5]||(e[5]=[v("返回列表",-1)])]),_:1})])])}}});export{Q as default};
