import{s as e,r as a,g as l,o as s,c as o,e as t,H as n,D as u,v as d,a8 as i,x as r,y as m,C as p,z as c,F as v,b1 as f,O as b,A as _,B as y,aj as h,R as x,ak as V,J as w,L as j,K as k,aT as S,S as g,am as T,an as C,ad as D,U as H,ab as U}from"./base-lib.js?v=1763689792";import{cf as I,a_ as R,ci as A,Q as P,b as E,L as N,bE as L,k as X,e as q,$ as B,j as F,_ as O}from"./utils-lib.js?v=1763689792";import{S as M,u as W}from"./useStore12.js?v=1763689792";import{a6 as z,a as J,q as K,F as Q,P as $}from"./useController15.js?v=1763689792";import{n as G,t as Y}from"./ssl.js?v=1763689792";import{u as Z}from"./useStore11.js?v=1763689792";import{d as ee}from"./useMethod6.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./site.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./index109.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./useController6.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController5.js?v=1763689792";import"./useMethod5.js?v=1763689792";import"./useController4.js?v=1763689792";import"./useStore5.js?v=1763689792";const{getDomainListEvent:ae}=M(),{btIsRefresh:le}=e(Z()),{sslDnsApiInfo:se,isRefreshBtSSL:oe,otherPopup:te}=W(),ne=E(),ue=a({});a(!1);const de=a(!1),ie=a("dns"),re=a("TXT_CSR_HASH"),me=a({domains:"",interface:""}),pe=a(!1),ce=a(""),ve=a([]),fe=a([]),be=a(""),_e=a(!1),ye=a(),he=a({domain:""}),xe=a([]);l(()=>{const e=2===ue.value.product_id,a=e?"*":"www";return"请输入需要申请证书的域名（单域名".concat(e?"通配符":"","证书），必填项，例如：").concat(a,".bt.cn")});const Ve=a([{value:"TXT_CSR_HASH",label:"DNS验证(TXT解析)",tips:"如网站还未备案完成，可选【DNS验证】",checkTips:[]}]),we=a([{value:"HTTP_CSR_HASH",label:"文件验证",tips:"",checkTips:[]}]),je=s({domain:[I({message:"域名不能为空"}),{validator:(e,a,l)=>{R(a)?1===ue.value.product_id&&a.indexOf("*")>-1?l(new Error("当前为单域名证书，不支持通配符申请")):l():l(new Error("域名格式错误，请重新输入"))},trigger:["change"]}]}),ke=async()=>{var e;await(null==(e=ye.value)?void 0:e.validate()),_e.value=!1,me.value.domains=he.value.domain},Se=async()=>{var e,a;try{const l=await ae(),s=ue.value.product_id;ve.value=l.data.map(e=>{const a=e.name&&e.name.startsWith("*."),l=1===s&&a;return{label:e.name,value:e.name,disabled:l,disabledTooltip:l?"当前为单域名证书，不支持通配符申请":void 0,...e}}),pe.value=!0;const o=ve.value.find(e=>!e.disabled);be.value=(null==o?void 0:o.name)||(null==(a=null==(e=ve.value)?void 0:e[0])?void 0:a.name)||"",fe.value=ve.value}catch(l){}},ge=async()=>{me.value.domains=be.value,pe.value=!1},Te=e=>{ve.value=[],fe.value.forEach(a=>{a.name.indexOf(e)>-1&&ve.value.push(a)}),ve.value.length||(ve.value=fe.value)},Ce=e=>{const a=ie.value;if("dns"!==a){const l=se.value.find(e=>e.value===a);if(l){const a=!l.data;(!e||e&&a)&&z({title:"设置".concat(l.info.title,"接口"),row:l.info})}}},De={class:"px-3rem py-1.2rem"},He={key:0,class:"flex items-center gap-[8px] flex-wrap"},Ue={class:"dns-option-content"},Ie={class:"dns-name font-500"},Re={class:"dns-domains text-tertiary text-small my-2"},Ae={class:"flex items-center"},Pe={class:"flex-shrink-0"},Ee={key:1,class:"flex flex-col"},Ne={class:"mr-[2px]"},Le={class:"flex justify-between"},Xe={class:"p-[20px]"},qe={class:"mb-[8px] border-light"},Be={class:"py-[.5rem] px-[1.1rem]"},Fe={class:"p-[20px]"},Oe=O(o({__name:"index",props:{compData:{}},emits:["close"],setup(e,{emit:a}){const{sslDnsApiInfo:s}=W(),o=l(()=>s.value?s.value.filter(e=>"dns"===e.value):[]),R=a,E=e,O=()=>{R("close"),ee()},{BtForm:M,param:z}=N({data:me.value,options:e=>l(()=>[{type:"custom",render:()=>t(L,{label:"证书信息"},{default:()=>[t("span",{class:"text-primary"},[E.compData.product_name])]})},{type:"slots",key:"sslVerifyType"},{type:"slots",key:"domains",rules:{domains:[I({message:3===E.compData.product_id?"IP地址不能为空":"域名不能为空"})]}},{type:"custom",render:()=>t(L,{label:" "},{default:()=>[t(n,{type:"primary",onClick:()=>(async e=>{if(!e.value.domains){const e=de.value?"IP地址不能为空":"域名不能为空";return ne.error(e)}const a=e.value.domains.trim();if(de.value){if(!A(a))return ne.error("IP证书申请域名格式错误，请输入正确的ipv4地址")}else if(2===ue.value.product_id&&!a.startsWith("*."))return ne.error("证书类型不匹配，请使用带通配符的域名格式。比如：*.bt.cn");let l=null;try{l=ne.load("正在提交证书信息，请稍后...");const e={domain:a,check_type:de.value?2:1,order_id:ue.value.id},{data:s}=await P({request:G({url:"/api/v1/ssl/cert/apply_cert",...e})});s.status&&(oe.value=!0,le.value=!0,te.value&&(te.value.unmount(),te.value=null),J({id:ue.value.id,product_id:ue.value.product_id,set_verify:!0,dns_id:me.value.interface,cert_info:{domain:s.data.domain,verify_name:null}})),ne[s.status?"success":"error"](s.msg)}catch(s){}finally{l&&l.close()}})(e)},{default:()=>[u("提交资料")]})]})},{type:"help",options:K.value}])});return d(()=>{ue.value=E.compData,(async()=>{var e,a;try{const{data:l}=await P({request:Y()});xe.value=l.map(e=>({label:e.ps?"".concat(e.dns_name," - ").concat(e.ps):e.dns_name,value:e.id,domains:e.domains,ps:e.ps})),me.value.interface=null==(a=null==(e=xe.value)?void 0:e[0])?void 0:a.value}catch(l){}})(),de.value=3===ue.value.product_id,re.value=de.value?"HTTP_CSR_HASH":"TXT_CSR_HASH"}),i(()=>{me.value.domains="",he.value.domain="",ie.value="dns"}),(e,a)=>{const l=T,s=q,d=C,i=D,I=H,R=B,A=F,P=U;return r(),m("div",De,[t(c(M),{"label-width":"80px"},{domains:p(()=>[t(i,{label:3===c(ue).product_id?"IP地址":"域名",prop:"domains"},{default:p(()=>[3!==c(ue).product_id?(r(),m("div",He,[t(c(X),{modelValue:c(z).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>c(z).domains=e),width:"28rem",class:"disabled-input flex-shrink-0",placeholder:c(Q)},null,8,["modelValue","placeholder"]),t(d,{modelValue:c(z).interface,"onUpdate:modelValue":a[1]||(a[1]=e=>c(z).interface=e),placeholder:"选择DNS接口",class:"domain-select !w-[14rem] flex-shrink-0",placement:"bottom"},{default:p(()=>[(r(!0),m(v,null,f(c(xe),e=>(r(),b(l,{key:e.value,label:e.label,value:e.value,class:"dns-option flex flex-col justify-center !h-[5rem] !leading-auto !line-height-normal"},{default:p(()=>[_("div",Ue,[_("div",Ie,y(e.label),1),_("div",Re,y(e.domains.length?e.domains.join(","):"manual"===e.value?"手动解析":"未添加域名"),1)])]),_:2},1032,["label","value"]))),128)),t(l,{label:"更多类型",value:"none",disabled:""},{default:p(()=>[_("p",Ae,[a[15]||(a[15]=_("span",null,"更多类型，请添加DNS接口",-1)),t(s,{class:"ml-2 underline",onClick:O},{default:p(()=>[...a[14]||(a[14]=[u("点击添加",-1)])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),_("div",Pe,[_("span",{class:"bt-link",onClick:a[2]||(a[2]=(...e)=>c(Se)&&c(Se)(...e))},"选择已有域名")])])):(r(),m("div",Ee,[t(c(X),{modelValue:c(z).domains,"onUpdate:modelValue":a[3]||(a[3]=e=>c(z).domains=e),width:"42rem",class:"disabled-input",placeholder:"请输入正确的ipv4地址，例如：192.168.1.1"},null,8,["modelValue"])]))]),_:1},8,["label"])]),sslVerifyType:p(()=>[t(c(L),{label:"验证方式"},{default:p(()=>[t(c(h),{class:"!leading-[2.4rem]",modelValue:c(re),"onUpdate:modelValue":a[4]||(a[4]=e=>x(re)?re.value=e:null)},{default:p(()=>[(r(!0),m(v,null,f(3===c(ue).product_id?c(we):c(Ve),e=>(r(),m("div",{class:"item",key:e.value},[t(c(V),{value:e.value},{default:p(()=>[_("span",Ne,y(e.label),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])]),_:1})]),dnsVerify:p(()=>[t(c(L),{label:"选择DNS接口"},{default:p(()=>[t(d,{class:"mr-1rem !w-[16rem]",modelValue:c(ie),"onUpdate:modelValue":a[5]||(a[5]=e=>x(ie)?ie.value=e:null),placeholder:"请选择",onChange:a[6]||(a[6]=e=>c(Ce)(!0))},{default:p(()=>[(r(!0),m(v,null,f(c(o),e=>(r(),b(l,{key:e.value,label:e.label,value:e.value},{default:p(()=>[_("span",Le,[_("span",null,y(e.label),1),w(_("span",{class:j(e.data?"text-primary":"text-orange")},y(e.data?"[已配置]":"[未配置]"),3),[[k,e.config]])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),w(t(c(n),{type:"default",onClick:a[7]||(a[7]=e=>c(Ce)(!1))},{default:p(()=>[...a[16]||(a[16]=[u("配置",-1)])]),_:1},512),[[k,"dns"!==c(ie)]])]),_:1})]),_:1}),t(A,{title:"选择域名",modelValue:c(pe),"onUpdate:modelValue":a[10]||(a[10]=e=>x(pe)?pe.value=e:null),area:57,"show-footer":!0,"append-to-body":!0,onConfirm:c(ge)},{default:p(()=>[_("div",Xe,[t(I,{class:"!w-[53rem] mb-[16px]",modelValue:c(ce),"onUpdate:modelValue":a[8]||(a[8]=e=>x(ce)?ce.value=e:null),placeholder:"支持字段模糊搜索",onInput:c(Te),clearable:""},null,8,["modelValue","onInput"]),_("div",qe,[a[17]||(a[17]=_("div",{class:"flex justify-between items-center bg-base py-[1rem] pl-[1rem]"},"域名",-1)),t(c(h),{modelValue:c(be),"onUpdate:modelValue":a[9]||(a[9]=e=>x(be)?be.value=e:null),class:"custom-radio-group whitespace-nowrap py-[2px] w-full"},{default:p(()=>[(r(!0),m(v,null,f(c(ve),e=>(r(),m(v,{key:e.value},[e.disabled&&e.disabledTooltip?(r(),b(c(S),{key:0,placement:"top"},{content:p(()=>[_("span",Be,y(e.disabledTooltip),1)]),default:p(()=>[t(c(V),{value:e.value,disabled:e.disabled,class:"custom-radio-item"},{default:p(()=>[u(y(e.label),1)]),_:2},1032,["value","disabled"])]),_:2},1024)):(r(),b(c(V),{key:1,value:e.value,disabled:e.disabled,class:"custom-radio-item"},{default:p(()=>[u(y(e.label),1)]),_:2},1032,["value","disabled"]))],64))),128))]),_:1},8,["modelValue"])]),t(R,{options:c($),class:"ml-[20px]"},null,8,["options"])])]),_:1},8,["modelValue","onConfirm"]),t(A,{title:"自定义域名",modelValue:c(_e),"onUpdate:modelValue":a[13]||(a[13]=e=>x(_e)?_e.value=e:null),area:57,"show-footer":!0,"append-to-body":!0,onConfirm:c(ke)},{default:p(()=>[_("div",Fe,[t(P,{class:"mb-[16px]",ref_key:"customDomainRef",ref:ye,model:c(he),rules:c(je),onSubmit:a[12]||(a[12]=g(()=>{},["prevent"]))},{default:p(()=>[t(i,{label:"自定义域名",prop:"domain"},{default:p(()=>[t(I,{autofocus:"",class:"!w-[40rem] mb-[8px]",modelValue:c(he).domain,"onUpdate:modelValue":a[11]||(a[11]=e=>c(he).domain=e),placeholder:"请输入需要申请证书的域名（单域名证书），必填项，例如：www.bt.cn"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(R,{options:c($),class:"ml-[20px]"},null,8,["options"])])]),_:1},8,["modelValue","onConfirm"])])}}}),[["__scopeId","data-v-e65e0bbf"]]);export{Oe as default};
