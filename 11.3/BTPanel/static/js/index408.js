import{r as e,g as t,c as s,v as l,w as i,I as a,J as n,z as c,x as r,y as u,A as o,e as d,C as p,F as m,b1 as v,K as b,L as f,bt as y,B as x,D as _,G as g,aZ as h,an as w,H as A,O as k,am as L}from"./base-lib.js?v=1763689792";import{C}from"./useController15.js?v=1763689792";import{V as P,b as j,Q as T,n as I,H as N,_ as D}from"./utils-lib.js?v=1763689792";import{u as M}from"./useStore12.js?v=1763689792";import{n as S}from"./ssl.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./site.js?v=1763689792";import"./index109.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController5.js?v=1763689792";import"./useMethod5.js?v=1763689792";import"./useController4.js?v=1763689792";const{btCertPollingPopup:E}=M(),U=e(null),V=e([]),B=t(()=>{const e=new Map;return V.value.forEach(t=>{e.set(t.id,t)}),e}),F=j(),H=e({num:1,certClassAcitve:"DV",certClass:[{name:"DV证书",title:"推荐个人，测试使用",value:"DV",subscript:"热销",tips:["DV证书一般用于个人网站/测试使用，签发速度快、无需人工审核，确保域名验证信息正确的情况下1-15分钟就能签发","DV证书无法为特殊域名/公网IP签发证书（例如：edu、.gov、.org、.jp（国家缩写）等后缀的域名）。"]}],certBrandAcitve:"宝塔证书",certBrand:[{name:"宝塔证书",title:"宝塔证书",value:"宝塔证书",subscript:"推荐",tips:["宝塔SSL证书是一款通用型证书产品，提供快速的颁发时间和简化的验证流程，帮助您快速启用HTTPS，增加用户对网站的信任。"]}],certTypeAcitve:"single",certType:[{name:"single",title:"单域名",value:"single",tips:[]},{name:"wildcard",title:"泛域名",value:"wildcard",tips:[]},{name:"ip",title:"IP证书",value:"ip",tips:[]}],certLifeAcitve:1,certLife:[{name:"1年",title:"1年",value:1,tips:[]}]}),K={single:["仅支持绑定一个二级域名或者子域名，例如 bt.com、cloud.bt.com、dnspod.cloud.bt.com的其中之一 。","如需要绑定同级的所有子域名，例如*.bt.com，请购买泛域名证书。"],wildcard:["带通配符的域名，例如：*.bt.com、*.cloud.bt.com均为泛域名，包含同一级的全部子域名。","注意泛域名不支持跨级，例如*.bt.com 不包含 *.cloud.bt.com的支持"],ip:["DV 单IP型SSL证书是一款入门型证书产品，使用您服务器的公网IP申请一个浏览器可信的IP型商用SSL证书。"]},O=e(!1),q=e(0),z={defalutList:[],typeList:[]},G=e({addPrice:0,productName:"",price:0,totalPrice:0,originalPrice:0,discountAmount:0,deploymentPrice:0,product_id:0,years:1,yearsPrice:0,number:1,extraNumber:0,extraPrice:0}),J=e=>{switch(e){case"single":default:return 1;case"wildcard":return 2;case"ip":return 3}},Q=async()=>{try{O.value=!0,await re(),se(),R(),Z()}finally{O.value=!1}},R=()=>{H.value.certTypeAcitve="single",H.value.certLifeAcitve=1},Z=()=>{const{type:e}=W(),t=z.defalutList.filter(t=>t.certType===e);z.typeList=t,te()},W=(e={})=>{let{num:t,type:s,life:l}=e;const i=H.value;return t||(t=i.num),s||(s=i.certTypeAcitve),l||(l=i.certLifeAcitve),{num:t,type:s,life:l}},X=t(()=>{const e=H.value.certType.filter(e=>e.value===H.value.certTypeAcitve);return e&&e.length>0?e[0].tips:[]}),Y=t(()=>{const e=H.value.certLife.filter(e=>e.value===parseInt(H.value.certLifeAcitve));return e&&e.length>0?e[0].tips:[]}),$=(e=H.value.num)=>{let t=(e=>{if(null==e?void 0:e.target){const t=Number(e.target.value),s=Math.trunc(t)||1;return e.target.value=String(s),s}return void 0!==(null==e?void 0:e.data)?Math.trunc(Number(e.data))||1:"number"==typeof e?Math.trunc(H.value.num+e)||1:Math.trunc(Number(H.value.num))||1})(e);(t<1||t>99)&&(t=t<1?1:99,F.error("域名数量范围为".concat(1,"-").concat(99))),H.value.num=t,Z()},ee=(e,t)=>{"".concat(t,"Acitve")in H.value&&(H.value["".concat(t,"Acitve")]=e),Z()},te=()=>{const e=z.typeList[0]||null;if(q.value=(null==e?void 0:e.num)||0,e){const{num:t,life:s}=W(),{price:l,other_price:i,add_price:a,product_id:n,num:c}=e,r=0;let u=l*t*s,o=0;const d=U.value&&B.value.get(U.value)||null;d&&(0===d.rule?o=Math.min(Number(d.discount),u):1===d.rule?o=u*(Number(d.discount)/100):2===d.rule&&(o=l*s-Number(d.discount)));const p=Math.max(0,u-o),m=i*t*s,v=m-p;G.value={addPrice:a||0,productName:e.title,price:l,totalPrice:p,originalPrice:m,discountAmount:v,product_id:n,years:s,yearsPrice:l*s*t,number:c,extraNumber:r,extraPrice:0,deploymentPrice:0}}},se=async()=>{U.value=null;const{data:e}=await S({url:"/api/v1/ssl/get_user_discount_list",status:0});if(V.value=e.data||[],!U.value&&V.value.length>0){const e=J(H.value.certTypeAcitve),t=V.value.find(t=>!ie(t.end_at).isExpired&&(0===t.product_id||t.product_id===e));t&&(U.value=t.id,te())}},le=36e5,ie=e=>{if(!e)return{text:"无期限",isUrgent:!1,isExpired:!1};try{const t=new Date(e).getTime()-288e5,s=t-Date.now();if(s<0)return{text:"已过期",isUrgent:!1,isExpired:!0};const l=P(t/1e3,"yyyy-MM-dd HH:mm:ss"),{text:i,isUrgent:a}=((e,t)=>{const s=Math.floor(e/le),l=Math.floor(e%le/6e4),i=Math.floor(e/864e5);if(s<24){const e=!0;if(s>0){const i=l>0?"".concat(l,"分钟"):"";return{text:"过期时间：".concat(t,"（剩").concat(s,"小时").concat(i,"）"),isUrgent:e}}return{text:"过期时间：".concat(t,"（剩").concat(l,"分钟）"),isUrgent:e}}return{text:"过期时间：".concat(t,"（剩").concat(i,"天）"),isUrgent:!1}})(s,l);return{text:i,isUrgent:a,isExpired:!1}}catch(t){return{text:"无期限",isUrgent:!1,isExpired:!1}}},ae=e({}),ne=(e,t,s)=>{if(!(null==e?void 0:e.discount_condition))return null;const l=((e,t,s)=>{if(!(null==e?void 0:e.trim()))return!0;try{const l=e.replace(/\band\b/gi,"&&").replace(/\bor\b/gi,"||").replace(/\bnot\b/gi,"!");return Boolean(new Function("num","amount","return ".concat(l))(t,s))}catch(l){return!1}})(e.discount_condition,t,s);return l?null:e.discount_condition_description||e.discount_condition},ce=async e=>{E.value=I({title:"支付宝塔证书订单",area:[60],component:()=>N(()=>import("./index509.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:e})},re=async()=>{try{(e=>{const t=[];Array.isArray(e)&&0!==e.length?(e.forEach(e=>{const s=1===e.id?"single":2===e.id?"wildcard":3===e.id?"ip":null;if(!s)return;const l={...e,certType:s,price:Number(e.amount)||0,title:e.name||"",other_price:Number(e.other_price)||0,add_price:0,product_id:e.id,num:1};t.push(l)}),z.defalutList=t):z.defalutList=[]})((await S({url:"/api/v1/ssl/get_cert_products"})).data),H.value.certType=(e=H.value.certType,t=K,e.map((e,s)=>{const l=t[e.value];return{...e,tips:l}}))}catch(s){}var e,t},ue={class:"px-[3rem] py-[2rem] min-h-[62rem]"},oe={class:"ssl-bus-pay-form"},de={class:"ssl-line"},pe={class:"ssl-content"},me={class:"ssl-option-list w-full"},ve=["onClick"],be={class:"ssl-type-title"},fe={class:"ssl-type-tips"},ye={key:0,class:"ssl-subscript-tips"},xe={class:"ssl-tips-list mb-[4px]"},_e={class:"ssl-line"},ge={class:"ssl-content"},he={class:"ssl-option-list"},we=["onClick"],Ae={class:"ssl-type-title !font-normal border-none"},ke={key:0,class:"ssl-subscript-tips"},Le={class:"ssl-tips-list mb-[4px]"},Ce={class:"ssl-line"},Pe={class:"ssl-content"},je={class:"ssl-option-list"},Te=["onClick"],Ie={class:"ssl-type-title !font-normal border-none"},Ne={key:0,class:"ssl-subscript-tips"},De={class:"ssl-tips-list mb-[4px]"},Me={class:"ssl-line"},Se={class:"ssl-content"},Ee={class:"ssl-option-list"},Ue=["onClick"],Ve={class:"ssl-type-title !font-normal border-none"},Be={key:0,class:"ssl-subscript-tips"},Fe={class:"ssl-tips-list mb-[4px]"},He={class:"mt-[4px]"},Ke={class:"ssl-line"},Oe={class:"ssl-content"},qe={class:"ssl-box mb-[4px]"},ze={class:"ssl-number-select"},Ge={class:"ssl-service"},Je={class:"ssl-line"},Qe={class:"ssl-content"},Re={class:"ssl-box mb-[4px]"},Ze={class:"coupon-option-content"},We={class:"coupon-name text-small mb-3"},Xe={class:"ssl-tips"},Ye={class:"ssl-info-view rounded-sm"},$e={class:"flex justify-between w-full"},et={class:"flex flex-col"},tt={class:"mb-[4px]"},st={class:"mr-[1rem]"},lt={class:"flex flex-col"},it={class:"flex h-[2.2rem] items-end mb-[4px]"},at={class:"text-warning text-small"},nt={class:"text-extraLarge font-bold"},ct={key:0,class:"discount-amount ml-[1rem] text-small"},rt={class:"pl-[6rem] text-small text-tertiary line-through"},ut={class:"flex items-center"},ot=D(s({__name:"index",emits:["close"],setup(e,{emit:s}){const P=s;l(Q);const j=t(()=>V.value.filter(e=>function(e){if(0===e)return!0;return J(H.value.certTypeAcitve)===e}(e.product_id)).map(e=>({...e,_timeInfo:ie(e.end_at)}))),I=t(()=>{if(!U.value)return"请选择优惠券";const e=B.value.get(U.value);return(null==e?void 0:e.discount_condition_description)||""});function N(e){const t=e.discount_name||"通用券",s=function(e){switch(e.rule){case 0:return"立减 ".concat(Number(e.discount).toFixed(2)," 元");case 1:return"立减 ".concat(e.discount,"%");case 2:return"首张 ".concat(Number(e.discount).toFixed(2)," 元");default:return""}}(e);return"".concat(t," - ").concat(s)}function D(e){U.value=null!=e?e:null,te()}i(()=>H.value.certTypeAcitve,()=>{U.value=null,te()});const M=()=>(async e=>{const t=J(H.value.certTypeAcitve),s=H.value.num,l=z.typeList[0]||null,{life:i}=W(),a=((null==l?void 0:l.price)||0)*s*i;if(U.value){const e=B.value.get(U.value),t=ne(e,s,a);if(t)return F.error("当前订单不符合优惠券使用条件：".concat(t)),!1}const n={product_id:t,num:s,...U.value&&{discount_code:U.value}},c=await T({loading:"正在创建宝塔证书订单，请稍后...",request:S({url:"/api/v1/ssl/create_cert_order",data:[n]})}),{status:r}=c;if(!r)return F.error(c.msg),!1;const{actual_amount:u,ali:o,discount_amount:d,pay_id:p,total_amount:m,wx:v}=c.data;return ae.value={actual_amount:u,ali:o,discount_amount:d,pay_id:p,total_amount:m,wx:v},ce({...ae.value,productInfo:{...G.value,num:s}}),V.value=[],U.value=null,H.value.num=1,null==e||e(),!0})(()=>P("close"));return(e,t)=>{var s;const l=h,i=L,P=w,T=A,S=a("bt-loading");return n((r(),u("div",null,[o("div",ue,[d(l,{type:"error",closable:!1},{title:p(()=>[...t[5]||(t[5]=[o("span",{class:"text-small"},[o("i",{calss:"svgtofont-el-warning-outline text-small"}),o("span",null," 禁止含有诈骗、赌博、色情、木马、病毒等违法违规业务信息的站点申请SSL证书，如有违反，撤销申请，停用账号。 ")],-1)])]),_:1}),o("div",oe,[o("div",de,[t[6]||(t[6]=o("div",{class:"ssl-label"},"证书分类",-1)),o("div",pe,[o("div",me,[(r(!0),u(m,null,v(c(H).certClass,e=>(r(),u("div",{class:f(["ssl-option-item w-1/3",{"is-active":e.value===c(H).certClassAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:t=>c(ee)(e.value,"certClass")},[o("div",be,x(e.name),1),o("div",fe,x(e.title),1),e.subscript?(r(),u("em",ye,x(e.subscript),1)):g("",!0)],10,ve))),128))]),o("div",xe,[(r(!0),u(m,null,v(c(H).certClass[0].tips,(e,t)=>(r(),u("p",{class:"mt-[4px]",key:t},x(e),1))),128))])])]),o("div",_e,[t[7]||(t[7]=o("div",{class:"ssl-label"},"证书品牌",-1)),o("div",ge,[o("div",he,[(r(!0),u(m,null,v(c(H).certBrand,e=>(r(),u("div",{class:f(["ssl-option-item min-w-[9rem]",{"is-active":e.value===c(H).certBrandAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:t=>c(ee)(e.value,"certBrand")},[o("div",Ae,x(e.title),1),e.subscript?(r(),u("em",ke,x(e.subscript),1)):g("",!0)],10,we))),128))]),o("div",Le,[(r(!0),u(m,null,v(c(H).certBrand[0].tips,(e,t)=>(r(),u("p",{class:"mt-[4px]",key:t},x(e),1))),128))])])]),o("div",Ce,[t[8]||(t[8]=o("div",{class:"ssl-label"},"证书类型",-1)),o("div",Pe,[o("div",je,[(r(!0),u(m,null,v(c(H).certType,e=>(r(),u("div",{class:f(["ssl-option-item min-w-[9rem]",{"is-active":e.value===c(H).certTypeAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:t=>c(ee)(e.value,"certType")},[o("div",Ie,x(e.title),1),e.subscript?(r(),u("em",Ne,x(e.subscript),1)):g("",!0)],10,Te))),128))]),o("div",De,[(r(!0),u(m,null,v(c(X),(e,t)=>(r(),u("p",{class:"mt-[4px]",key:t},x(e),1))),128))])])]),o("div",Me,[t[9]||(t[9]=o("div",{class:"ssl-label"},"购买年限",-1)),o("div",Se,[o("div",Ee,[(r(!0),u(m,null,v(c(H).certLife,e=>(r(),u("div",{class:f(["ssl-option-item min-w-[9rem]",{"is-active":e.value===c(H).certLifeAcitve}]),key:e.value,onClick:t=>c(ee)(e.value,"certLife")},[o("div",Ve,x(e.title),1),e.subscript?(r(),u("em",Be,x(e.subscript),1)):g("",!0)],10,Ue))),128))]),o("div",Fe,[(r(!0),u(m,null,v(c(Y),(e,t)=>(r(),u("p",{class:"mt-[4px]",key:t},x(e),1))),128)),n(o("p",He,"部署成功后会生成自动续签任务 请不要变更DNS验证内容",512),[[b,c(H).certLifeAcitve>1]])])])]),o("div",Ke,[t[12]||(t[12]=o("div",{class:"ssl-label"},"购买数量",-1)),o("div",Oe,[o("div",qe,[o("div",ze,[o("div",{class:f(["del-number",{"is-disable":1===c(H).num}]),onClick:t[0]||(t[0]=e=>c($)(-1))},null,2),n(o("input",{type:"number",class:"input-number",min:"1",max:"99","onUpdate:modelValue":t[1]||(t[1]=e=>c(H).num=e),onInput:t[2]||(t[2]=(...e)=>c($)&&c($)(...e)),onKeydown:t[3]||(t[3]=e=>"."===e.key&&e.preventDefault())},null,544),[[y,c(H).num]]),o("div",{class:f(["add-number",{"is-disable":99===c(H).num}]),onClick:t[4]||(t[4]=e=>c($)(1))},null,2)]),o("div",Ge,[d(C,{placement:"right"},{default:p(()=>[...t[10]||(t[10]=[o("div",{class:"flex items-center"},[o("i",{class:"mx-[4px] text-1.6rem svgtofont-el-service text-primary"}),o("span",null,"教我选择？")],-1)])]),_:1})])]),t[11]||(t[11]=o("div",{class:"ssl-tips"},"请选择购买证书的数量",-1))])]),o("div",Je,[t[13]||(t[13]=o("div",{class:"ssl-label"},"优惠券",-1)),o("div",Qe,[o("div",Re,[d(P,{"model-value":null!=(s=c(U))?s:void 0,placeholder:"请选择优惠券",clearable:"",class:"w-full max-w-[40rem]","onUpdate:modelValue":D},{default:p(()=>[(r(!0),u(m,null,v(c(j),e=>(r(),k(i,{key:e.id,label:N(e),value:e.id,disabled:e._timeInfo.isExpired,class:"coupon-option !h-[5.4rem] !leading-auto !line-height-normal flex flex-col justify-center"},{default:p(()=>[o("div",Ze,[o("div",We,x(N(e)),1),o("div",{class:f(["coupon-sublabel text-small",{"text-tertiary":!e._timeInfo.isUrgent&&!e._timeInfo.isExpired,"text-danger":e._timeInfo.isUrgent||e._timeInfo.isExpired}])},x(e._timeInfo.text),3)])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["model-value"])]),o("span",Xe,"使用条件："+x(c(I)),1)])])])]),o("div",Ye,[o("div",$e,[o("div",et,[o("div",tt,[t[14]||(t[14]=_(" 商品包含： ",-1)),o("span",st,x("".concat(c(G).productName," * ").concat(c(H).num)),1)]),o("div",lt,[o("div",it,[t[15]||(t[15]=o("span",null,"总计费用：",-1)),o("div",at,[o("span",nt,x((c(G).totalPrice||0).toFixed(2)),1),o("span",null," 元/"+x(c(G).years)+"年",1)]),(c(G).discountAmount||0)>0?(r(),u("div",ct," 券后立减 "+x((c(G).discountAmount||0).toFixed(2))+" 元 ",1)):g("",!0)]),o("div",rt," 原价 "+x((c(G).originalPrice||0).toFixed(2))+" 元/"+x(c(G).years)+"年 ",1)])]),o("div",ut,[d(T,{type:"primary",onClick:M},{default:p(()=>[...t[16]||(t[16]=[_(" 立即购买 ",-1)])]),_:1})])])])])),[[S,c(O)],[S,"正在获取宝塔证书信息，请稍后...","title"]])}}}),[["__scopeId","data-v-622df6b3"]]);export{ot as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
