import{o as a,u as e,b as t,n as o,H as l,V as s,Q as r,p as n}from"./utils-lib.js?v=1763689792";import{s as i,j as c,r as u,g as d,t as m,e as v,D as p,aT as y}from"./base-lib.js?v=1763689792";import{b as _}from"./validator.js?v=1763689792";const w=e=>a.post("/mod/domain/domain/domain_proxy",{data:{data:JSON.stringify(e)},check:"object",customType:"model"}),g=e=>a.post("/mod/domain/domain/get_domain_status",{data:e,check:"object",customType:"model"}),h=e=>a.post("/mod/domain/domain/create_dns_record",{data:e,check:"object",customType:"model"}),f=e=>a.post("/ssl?action=get_cert_list",{data:e,check:"object",customType:"model"}),b=e=>a.post("/mod/domain/domain/poxy_whois_query",{data:e,check:"object",customType:"model"}),x=e=>a.post("/mod/domain/domain/set_analysis_ip",{data:e,check:"object",customType:"model"}),D=e=>a.post("ssl/data/get_domain_list",{data:e,customType:"model",check:"object"}),I=c("DOMAIN-REGISTER-STORE",()=>{const{plugin:a,getGlobalInfo:t,mainWidth:o}=e(),l=u(),s=u(!1),r=u(""),n=u(""),i=u(""),c=u(null),m=u(""),v=u(!1),p=u(!1),y=u(!1);return{registerRowData:l,isRegListRefresh:s,searchWidth:d(()=>o.value>1530?320:o.value>1400?200:o.value>1200?180:140),domainSearchValue:r,whoisSearchValue:n,ipSearchValue:i,publicIp:m,isLoadingIp:v,showMask:p,isUserBound:y,domainSearchDialog:c}}),P=()=>i(I()),{isLoadingIp:E,publicIp:j,showMask:T,isUserBound:R}=P(),k=t(),{payment:O}=e(),{bindUser:S}=m(O.value),L=async()=>{try{const e=await a.post("/mod/domain/domain/get_public_ip",{check:"object",customType:"model"});return e.data.status?e.data.data:"获取公网IP失败"}catch(e){return"获取公网IP失败"}},V=async()=>{const a=k.load("正在检测授权状态，请稍候...");E.value=!0;try{if(R.value=!!S.value,!R.value)return _(),void(T.value=!0);if(j.value=await L(),j.value){const a=await(async a=>{var e;try{const t=await w({url:"/api/v1/user/security/check_panel_access",ip_address:a});return t.data.status&&!0===(null==(e=t.data.data)?void 0:e.allowed)}catch(t){return!1}})(j.value);T.value=!a}}catch(e){T.value=!0}finally{E.value=!1,a.close()}},{isRegListRefresh:A,domainSearchDialog:C}=P(),M=t(),N=u(""),F=u(""),B=u("wechat"),Y=u(null),W=u({domain:"",firstYearPrice:"¥0.00",renewalPrice:"¥0.00",totalPrice:"",years:1,accountBalance:"¥0.00",type:"purchase"}),q=d(()=>"renewal"===W.value.type),U=u(""),G=u({wx:"",ali:""}),H=u(!1),J=u(!1),Q=u(null),z=u(!1),K=u(!1),X=u(!1),Z=async(a,e="payment")=>{const t="renewal"===e?"域名续费":"支付订单",s="renewal"===e?{...a,type:"renewal"}:a,r=await o({title:t,area:54,btn:!1,showFooter:!1,compData:s,component:()=>l(()=>import("./index276.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{la(),N.value="",F.value="",Y.value=null,K.value=!1}});Y.value=r},$=async a=>{la();const e=String(a);if(B.value=e,"balance"===e)return void(U.value="");const t="wechat"===e?G.value.wx:G.value.ali;if(t)return U.value=t,void oa();H.value=!0,U.value="",await sa()},aa=async()=>{var a,e;if(q.value||X.value){J.value=!0;try{const t=await w({url:"/api/v1/order/buy/buy_payment",order_no:F.value});return t.data.status?(K.value=!0,M.success(t.data.msg||"支付成功！"),A.value=!0,Y.value&&(null==(e=null==(a=Y.value.config)?void 0:a.globalProperties)?void 0:e.close)&&(C.value&&C.value.close(),Y.value.config.globalProperties.close()),!0):(M.error(t.data.msg),!1)}catch(t){}finally{J.value=!1}}else M.warn("请先同意协议条款")},ea=u("¥0.00"),ta=async()=>{try{const a=await w({url:"/api/v1/order/buy/get_buy"});if(a.data.status){const e=a.data.data.balance||"0.00";ea.value="¥".concat((Number(e)/100).toFixed(2))}else M.error(a.data.msg)}catch(a){}},oa=()=>{z.value||Q.value||(z.value=!0,Q.value=setInterval(()=>{(async()=>{var a,e;if(F.value)try{const t=await w({url:"/api/v1/order/payment/status",order_no:F.value});t.data.status?1===t.data.data.status?(la(),K.value=!0,M.success("支付成功！"),A.value=!0,Y.value&&(null==(e=null==(a=Y.value.config)?void 0:a.globalProperties)?void 0:e.close)&&Y.value.config.globalProperties.close()):2===t.data.data.status?(M.warn("订单已取消，请重新操作"),U.value=""):3===t.data.data.status&&(la(),M.error("订单已退款"),U.value=""):(la(),M.error(t.data.msg||"支付失败"),U.value="")}catch(t){}})()},3e3))},la=()=>{Q.value&&(clearInterval(Q.value),Q.value=null),z.value=!1},sa=async()=>{try{const a=q.value?await(async a=>{try{const e=await w({url:"/api/v1/order/renew",domain_list:[{domain:a.domain,year:a.years,domain_service:0}]});return{success:e.data.status,data:e.data.data,message:e.data.msg}}catch(e){return H.value=!1,{success:!1,message:"创建订单失败，请重试"}}finally{H.value=!1}})({domain:W.value.domain,totalPrice:W.value.totalPrice,years:W.value.years,accountBalance:W.value.accountBalance}):await(async a=>{H.value=!0;try{const e=a.domain,t=e.lastIndexOf("."),o=await w({url:"/api/v1/order/direct_purchase_domain",domain_name:e.substring(0,t),suffix:a.suffix||(t>0?e.substring(t+1):""),years:a.years});return{success:o.data.status,data:o.data.data,message:o.data.msg}}catch(e){return{success:!1,message:"创建订单失败，请重试"}}finally{H.value=!1}})({domain:W.value.domain,firstYearPrice:W.value.firstYearPrice,totalPrice:W.value.totalPrice,years:W.value.years,accountBalance:W.value.accountBalance,suffix:W.value.suffix});if(a.success){N.value=a.data.order_id,F.value=a.data.order_no||"",W.value.totalPrice=String(a.data.total_price||"0"),G.value.wx=a.data.wx||"",G.value.ali=a.data.ali||"";const e="wechat"===B.value?G.value.wx:G.value.ali;U.value=e,e&&oa()}else M.error(a.message||"获取支付二维码失败")}catch(a){}},ra=async a=>{if(la(),U.value="",N.value="",F.value="",G.value.wx="",G.value.ali="",H.value=!0,W.value.years=a,q.value&&W.value.currentExpiry){const e=new Date(W.value.currentExpiry),t=new Date(e);t.setFullYear(t.getFullYear()+a),W.value.newExpiry=s(t,"yyyy-MM-dd")}await sa()},na=async a=>{a?(X.value=!1,await o({title:"域名注册注意事项",area:60,btn:["同意并继续"],component:()=>l(()=>import("./agreement-dialog.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onConfirm:()=>(X.value=!0,!0)})):X.value=!1},{isRegListRefresh:ia,ipSearchValue:ca,domainSearchDialog:ua}=P(),{payment:da}=e(),{bindUser:ma}=m(da.value);let va={};const pa=async a=>{if(!ma.value)return _(),!1;const e=await o({title:"域名注册",area:60,compData:{domainName:a.value},component:()=>l(()=>import("./index277.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{a.value=""}});ua.value={close:()=>{var a,t;e&&(null==(t=null==(a=e.config)?void 0:a.globalProperties)?void 0:t.close)&&e.config.globalProperties.close()}}},ya=a=>{o({title:"修改解析IP",area:50,btn:["修改","取消"],compData:{currentIp:a},component:()=>l(()=>import("./index278.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),onConfirm:()=>{ia.value=!0}})},_a=a=>{o({title:"WHOIS查询",area:70,compData:{domainName:a.value},component:()=>l(()=>import("./index279.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},wa=()=>({label:"状态",prop:"status",minWidth:100,isCustom:!0,render:a=>{const e={0:{text:"待注册",color:"var(--el-color-info)"},1:{text:"正常",color:"var(--el-color-primary)"},2:{text:"即将到期",color:"var(--el-color-warning)"},3:{text:"已过期",color:"var(--el-color-danger)"},4:{text:"待赎回",color:"var(--el-color-warning)"},5:{text:"注册失败",color:"var(--el-color-danger)"}}[a.status]||{text:"未知",color:"var(--el-color-info)"};return v("span",{style:{color:e.color}},[e.text])}}),ga=()=>({label:"实名状态",prop:"real_name_status",width:100,isCustom:!0,render:a=>{const e={0:{text:"未认证",color:"var(--el-color-warning)"},1:{text:"认证中",color:"var(--el-color-info)"},2:{text:"已认证",color:"var(--el-color-primary)"},3:{text:"认证失败",color:"var(--el-color-danger)"}}[a.real_name_status]||{text:"未知",color:"var(--el-color-info)"};return v("span",{style:{color:e.color}},[e.text])}}),ha=()=>({label:"宝塔DNS",prop:"ns_status",minWidth:100,isCustom:!0,render:a=>{const e=0===a.ns_status,t=e?"var(--el-color-error)":"var(--el-color-primary)";return e?v(y,{placement:"top"},{default:()=>v("span",{style:{color:t,cursor:"pointer"},onClick:()=>{window.open("https://www.bt.cn/domain/domain-resolve","_blank")}},[p("未生效")]),content:()=>"该域名需前往后台设置"}):v("span",{style:{color:t}},[p("已生效")])}}),fa=a=>{o({title:a.full_domain,area:120,compData:{domain:a.full_domain,domainId:a.id},component:()=>l(()=>import("./index280.js?v=1763689792").then(a=>a.i),__vite__mapDeps([]),import.meta.url)})},ba=a=>{Z({domain:a.full_domain,years:1,currentExpiry:s(a.expire_time,"yyyy-MM-dd"),newExpiry:((a,e)=>{const t=new Date(1e3*a),o=new Date(t);return o.setFullYear(o.getFullYear()+e),s(o,"yyyy-MM-dd")})(a.expire_time,1),type:"renewal"},"renewal")},xa=a=>{o({title:"实名信息详情",area:50,showFooter:!1,compData:{domainId:a.id,domain:a.full_domain},component:()=>l(()=>import("./index281.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Da=async a=>{await n({title:"删除域名【"+a.full_domain+"】",content:"即将删除域名【"+a.full_domain+"】，是否继续操作？",icon:"warning",onConfirm:()=>{const e={url:"/api/v1/domain/manage/delete_domain",id:a.id};r({loading:"正在删除域名，请稍后...",request:w(e),message:!0,success:()=>{ia.value=!0}})}})},Ia=a=>{o({title:"域名【"+a.full_domain+"】选择实名模板",area:50,btn:"提交认证",compData:{domainName:a.full_domain,domainId:a.id},component:()=>l(()=>import("./index282.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Pa=a=>{o({title:"创建网站 - 【"+a.full_domain+"】",area:80,btn:["创建","取消"],showFooter:!0,compData:{domainId:a.id,domainName:a.full_domain,type:"domain"},component:()=>l(()=>import("./index283.js?v=1763689792").then(a=>a.i),__vite__mapDeps([]),import.meta.url)})},Ea=async a=>{const e=JSON.stringify(a),t=Date.now();try{const o={url:"/api/v1/domain/manage/list",p:a.p||1,rows:a.limit||30,keyword:a.search||""},l=(await w(o)).data.data;return va[e]={data:{data:l.data||[],total:l.count||0,other:{search_history:l.search_history||[]}},timestamp:t},va[e].data}catch(o){return"canceled"===o.message&&va[e]&&t-va[e].timestamp<100?va[e].data:{data:[],total:0}}},ja=async()=>{try{const e=await a.post("/mod/domain/domain/get_analysis_ip",{check:"object",customType:"model"});return e.data.status?e.data.data:""}catch(e){return""}},Ta=async()=>{try{const a=await ja();ca.value=a}catch(a){}},Ra=async()=>{await r({loading:"正在刷新本地缓存，请稍后...",request:a.post("/mod/domain/domain/refresh_domain_cache",{check:"object",customType:"model"}),message:!0,success:()=>{ia.value=!0}})};export{F as A,J as B,Y as C,ra as D,K as E,H as F,ta as G,sa as H,la as I,U as J,N as K,G as L,X as M,q as N,$ as O,na as P,h as Q,D as R,g as S,f as T,Ta as a,_a as b,ya as c,wa as d,ha as e,ga as f,Ea as g,pa as h,Da as i,fa as j,ba as k,V as l,xa as m,Ia as n,Pa as o,L as p,w as q,Ra as r,Z as s,x as t,P as u,W as v,b as w,ea as x,aa as y,B as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
