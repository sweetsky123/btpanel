import{c as e,s as a,g as l,e as s,J as t,K as o,D as r,H as i,v as n,x as u,y as d,C as m,z as p,A as c,F as v,b1 as f,R as y,am as b,an as h,ad as _,aj as x,ax as V,az as g,U as C,ab as A,O as w,B as k,L as j,S,G as H,ak as T,aT as U}from"./base-lib.js?v=1763689792";import{L as N,bE as I,M,ci as R,ak as D,k as E,ag as P,e as z,j as L,$ as O,_ as B}from"./utils-lib.js?v=1763689792";import{n as F}from"./form-item.js?v=1763689792";import{_ as J}from"./input-popover.vue_vue_type_script_setup_true_lang.js?v=1763689792";import{n as q,p as G,q as K,v as Q,w as W,x as X,y as Y,z as Z,A as $,B as ee,D as ae,E as le,F as se,G as te,H as oe,I as re,J as ie,K as ne,L as ue,M as de,N as me,O as pe,P as ce,Q as ve,R as fe,S as ye,T as be,U as he,V as _e,W as xe,X as Ve,Y as ge,Z as Ce}from"./useController15.js?v=1763689792";import{u as Ae,S as we}from"./useStore12.js?v=1763689792";import{applyBusSsl as ke}from"./site.js?v=1763689792";import{c as je}from"./useMethod12.js?v=1763689792";import{u as Se}from"./useStore11.js?v=1763689792";import{d as He}from"./useMethod6.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./useStore4.js?v=1763689792";import"./useController6.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController5.js?v=1763689792";import"./useMethod5.js?v=1763689792";import"./useController4.js?v=1763689792";import"./ssl.js?v=1763689792";import"./useMethod7.js?v=1763689792";import"./useStore5.js?v=1763689792";const Te={class:"px-3rem py-1.2rem"},Ue={key:0,class:"flex items-flex-start"},Ne={class:"flex flex-col max-h-[16rem] overflow-y-auto"},Ie={class:"flex items-center gap-[8px]"},Me={class:"dns-option-content"},Re={class:"dns-name font-500"},De={class:"dns-domains text-tertiary text-small my-2"},Ee={class:"flex items-center"},Pe={key:1,class:"flex"},ze={class:"flex items-center gap-[8px]"},Le={class:"dns-option-content"},Oe={class:"dns-name font-500"},Be={class:"dns-domains text-tertiary text-small my-2"},Fe={class:"flex items-center"},Je={class:"mr-[2px]"},qe=["onClick"],Ge={key:1,class:"!caret-medium inline-flex items-center"},Ke={class:"flex justify-between"},Qe={class:"flex flex-col p-[20px] error"},We={class:"p-[20px]"},Xe={class:"mb-[8px] border-light"},Ye={class:"p-[20px]"},Ze=B(e({__name:"index",props:{compData:{}},emits:["close"],setup(e,{emit:B}){const{activeTabs:Ze,sslIsRefresh:$e,testIsRefresh:ea,encryptIsRefresh:aa,otherIsRefresh:la}=a(Se()),{orderInfo:sa,sslDnsApiInfo:ta,sslApplicationInfo:oa}=Ae(),{verifyBusCertEvent:ra,getCertAdminInfoEvent:ia}=we(),na=B,ua=e,da=()=>{na("close"),He()},{BtForm:ma,param:pa,submit:ca}=N({data:q.value,options:e=>l(()=>[{type:"custom",render:()=>s(I,{label:"证书信息"},{default:()=>[s("span",{class:"text-primary"},[s("span",null,[sa.value.title]),t(s("span",null,[r("，包含"),sa.value.limit,r("个域名")]),[[o,sa.value.limit>1]])])]})},{type:"slots",key:"sslVerifyType"},{type:"slots",key:"domains",rules:{}},F(G,"证书用户信息"),...G.value?[{type:"custom",render:()=>s(I,{label:"所在地区"},{default:()=>[s("div",{class:"flex flex-row"},[s(J,{"custom-class":"mr-[16px] !w-[20rem]",modelValue:e.value.Administrator.state,"onUpdate:modelValue":a=>e.value.Administrator.state=a,"placeholder-tips":"请输入所在省份，必填项"},null),s(J,{"custom-class":"!w-[20rem]",modelValue:e.value.Administrator.city,"onUpdate:modelValue":a=>e.value.Administrator.city=a,"placeholder-tips":"请输入所在市/县，必填项"},null)])]})},..."dv"!==sa.value.type?[{type:"custom",render:()=>s(I,{label:"公司详细地址"},{default:()=>[s(J,{"custom-class":"!w-[42rem]",modelValue:e.value.Administrator.address,"onUpdate:modelValue":a=>e.value.Administrator.address=a,"placeholder-tips":"请输入公司详细地址，具体要求见说明，必填项"},null)]})}]:[],{type:"custom",render:()=>s(I,{label:"公司名称"},{default:()=>[s(J,{"custom-class":"!w-[42rem]",modelValue:e.value.Administrator.organation,"onUpdate:modelValue":a=>e.value.Administrator.organation=a,"placeholder-tips":"请输入公司名称，如为个人申请请输入个人姓名，必填项"},null)]})},{type:"custom",render:()=>s(I,{label:"姓名"},{default:()=>[s(J,{"custom-class":"!w-[42rem]",modelValue:e.value.Administrator.name,"onUpdate:modelValue":a=>e.value.Administrator.name=a,"placeholder-tips":"请输入姓名，必填项"},null)]})},{type:"custom",render:()=>s(I,{label:"邮箱"},{default:()=>[s(J,{"custom-class":"!w-[42rem]",modelValue:e.value.Administrator.email,"onUpdate:modelValue":a=>e.value.Administrator.email=a,"placeholder-tips":"请输入邮箱地址，必填项"},null)]})},{type:"custom",render:()=>s(I,{label:"手机"},{default:()=>[s(J,{"custom-class":"!w-[42rem]",modelValue:e.value.Administrator.mobile,"onUpdate:modelValue":a=>e.value.Administrator.mobile=a,"placeholder-tips":"请输入手机号码，若为空，则使用当前绑定手机号"},null)]})}]:[],{type:"custom",render:()=>s(I,{label:" "},{default:()=>[s(i,{type:"primary",onClick:()=>ca()},{default:()=>[r("提交资料")]})]})},{type:"help",options:K.value}]),submit:async(e,a)=>{try{await a()}catch(l){return!1}return await va()}}),va=async()=>{var e;let a=null;if(!q.value.domains&&!Q.value)return M.error("域名不能为空");if(W.value&&!R(q.value.domains))return M.error("IP证书申请域名格式错误，请输入正确的ipv4地址");if(!q.value.Administrator.state&&!q.value.Administrator.city)return M.error("所在地区不能为空");if(!q.value.Administrator.address&&"dv"!==sa.value.type)return M.error("公司详细地址不能为空");if(!q.value.Administrator.organation)return M.error("公司名称不能为空");if(!q.value.Administrator.name)return M.error("姓名不能为空");if(!q.value.Administrator.email)return M.error("邮箱不能为空");if(!q.value.Administrator.mobile)return M.error("手机不能为空");try{a=M.load("正在提交证书信息，请稍后...");const{cert_ssl_type:l}=ua.compData.orderInfo,{job:s,postCode:t,country:o,firstName:r,lastName:i,name:n,state:u,city:d,address:m,organation:p,email:c,mobile:v}=q.value.Administrator,f=await ke(JSON.stringify({pid:sa.value.pid,cert_ssl_type:l,oid:sa.value.oid,domains:Q.value?X.value.map(({value:e})=>null==e?void 0:e.trim()):[q.value.domains.trim()],dcvMethod:Y.value,auth_to:Z.value,Administrator:{job:s,postCode:t,country:o,lastName:n,state:u,city:d,address:m,organation:p,email:c,mobile:v}}));if(D(f.data.msg)&&f.data.msg.hasOwnProperty("code")){let e=f.data.errors;$.value=[],Object.keys(e).forEach(a=>{e[a].forEach((e,l)=>{$.value.push({field:a,error:e})})}),ee.value=!0}else{let e=f.msg||f.data.msg,a=f.data.status;M.request(f.data||{msg:a?e||"提交成功":e||"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:a})}if(f.data.status){na("close");const a={ssl:()=>$e.value=!0,test:()=>ea.value=!0,encrypt:()=>aa.value=!0,other:()=>la.value=!0};null==(e=a[Ze.value])||e.call(a);const s={interface:Q.value?X.value:q.value.interface,set_verify_value:!0};je(sa.value.oid,l,sa.value.pid,s),q.value.domains="",q.value.interface="",Ve.value=!1,ie.value=[{value:"CNAME_CSR_HASH",label:"DNS验证(CNAME解析)",tips:"如网站还未备案完成，可选【DNS验证】",isCheck:"",checkTips:[]},{value:"HTTP_CSR_HASH",label:"文件验证(HTTP)",tips:"如网站未开启301、302、强制HTTPS、反向代理功能，请选择HTTP",isCheck:"",checkTips:[]},{value:"HTTPS_CSR_HASH",label:"文件验证(HTTPS)",tips:"如网站开启【强制HTTPS】，请选【HTTPS验证】",isCheck:"",checkTips:[]}]}}catch(l){}finally{a&&a.close()}};return n(async()=>{const e=await ia();oa.value={...oa.value,...e.data},ae(),le()}),(e,a)=>{const l=b,n=z,N=h,R=_,D=T,B=U,F=x,J=V,q=g,G=L,K=C,ae=O,le=A;return u(),d("div",Te,[s(p(ma),{"label-width":"80px"},{domains:m(()=>[p(Q)?(u(),d("div",Ue,[a[14]||(a[14]=c("span",{class:"el-form-item__label",style:{width:"80px"}},"域名",-1)),c("div",Ne,[(u(!0),d(v,null,f(p(X),(e,i)=>(u(),w(R,{key:e.key,prop:"_domain_".concat(i),rules:[{validator:(a,l,s)=>{e.value&&String(e.value).trim()?s():s(new Error("域名不能为空"))},trigger:["blur","change"]}]},{default:m(()=>[c("div",Ie,[s(p(E),{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,disabled:!p(Q),width:"CNAME_CSR_HASH"===p(Y)?"29rem":"44rem",class:"disabled-input",placeholder:p(se)},null,8,["modelValue","onUpdate:modelValue","disabled","width","placeholder"]),t(s(N,{modelValue:e.interface,"onUpdate:modelValue":a=>e.interface=a,placeholder:"选择DNS接口",class:"domain-select !w-[14rem]",placement:"bottom"},{default:m(()=>[(u(!0),d(v,null,f(p(te),e=>(u(),w(l,{key:e.value,label:e.label,value:e.value,class:"dns-option flex flex-col justify-center !h-[5rem] !leading-auto !line-height-normal"},{default:m(()=>[c("div",Me,[c("div",Re,k(e.label),1),c("div",De,k(e.domains.length?e.domains.join(","):"manual"===e.value?"手动解析":"未添加域名"),1)])]),_:2},1032,["label","value"]))),128)),s(l,{label:"更多类型",value:"none",disabled:""},{default:m(()=>[c("p",Ee,[a[13]||(a[13]=c("span",null,"更多类型，请添加DNS接口",-1)),s(n,{class:"ml-2 underline",onClick:da},{default:m(()=>[...a[12]||(a[12]=[r("点击添加",-1)])]),_:1})])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"]),[[o,"CNAME_CSR_HASH"===p(Y)]])])]),_:2},1032,["prop","rules"]))),128))])])):(u(),d("div",Pe,[s(R,{label:"域名",prop:"domains"},{default:m(()=>[c("div",ze,[s(p(E),{modelValue:p(pa).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>p(pa).domains=e),disabled:!p(Q),width:"CNAME_CSR_HASH"===p(Y)?"29rem":"44rem",class:"disabled-input",placeholder:p(se)},null,8,["modelValue","disabled","width","placeholder"]),t(s(N,{modelValue:p(pa).interface,"onUpdate:modelValue":a[1]||(a[1]=e=>p(pa).interface=e),placeholder:"选择DNS接口",class:"domain-select !w-[14rem]",placement:"bottom"},{default:m(()=>[(u(!0),d(v,null,f(p(te),e=>(u(),w(l,{key:e.value,label:e.label,value:e.value,class:"dns-option flex flex-col justify-center !h-[5rem] !leading-auto !line-height-normal"},{default:m(()=>[c("div",Le,[c("div",Oe,k(e.label),1),c("div",Be,k(e.domains.length?e.domains.join(","):"manual"===e.value?"手动解析":"未添加域名"),1)])]),_:2},1032,["label","value"]))),128)),s(l,{label:"更多类型",value:"none",disabled:""},{default:m(()=>[c("p",Fe,[a[16]||(a[16]=c("span",null,"更多类型，请添加DNS接口",-1)),s(n,{class:"ml-2 underline",onClick:da},{default:m(()=>[...a[15]||(a[15]=[r("点击添加",-1)])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),[[o,"CNAME_CSR_HASH"===p(Y)]])]),t(c("div",null,[s(p(i),{size:"small",type:"primary",onClick:p(oe)},{default:m(()=>[...a[17]||(a[17]=[r("选择已有域名",-1)])]),_:1},8,["onClick"]),s(p(i),{size:"small",type:"default",onClick:p(re)},{default:m(()=>[...a[18]||(a[18]=[r("自定义域名",-1)])]),_:1},8,["onClick"])],512),[[o,!p(Q)]])]),_:1})]))]),sslVerifyType:m(()=>[s(p(I),{label:"验证方式"},{default:m(()=>[s(F,{class:"!leading-[2.4rem]",modelValue:p(Y),"onUpdate:modelValue":a[2]||(a[2]=e=>y(Y)?Y.value=e:null)},{default:m(()=>[(u(!0),d(v,null,f(p(ie),e=>(u(),d(v,{key:e.value},[p(ge)(p(Ce),p(W),e)?(u(),w(B,{key:e.value,effect:"dark",content:e.tips,placement:"top-start",enterable:!1},{default:m(()=>[s(D,{value:e.value},{default:m(()=>[c("span",Je,k(e.label),1),""!==e.isCheck?(u(),d("span",{key:0,class:j(["cursor-pointer",e.isCheck?"!text-primary":"!text-danger"]),onClick:S(a=>(e=>{M.msg({customClass:"el-error-html-message",dangerouslyUseHTMLString:!0,message:e.join("<br>"),type:"error"})})(e.checkTips),["stop"])}," ["+k(e.isCheck?"正常":"异常")+"] ",11,qe)):H("",!0),p(Ve)?(u(),d("span",Ge,[...a[19]||(a[19]=[r(" [ ",-1),c("i",{class:"svgtofont-el-loading mx-[2px]"},null,-1),c("span",{class:"align-middle"},"检测中",-1),r(" ] ",-1)])])):H("",!0)]),_:2},1032,["value"])]),_:2},1032,["content"])):H("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1})]),dnsVerify:m(()=>[s(p(I),{label:"选择DNS接口"},{default:m(()=>[s(N,{class:"mr-[16px] !w-[16rem]",modelValue:p(Z),"onUpdate:modelValue":a[3]||(a[3]=e=>y(Z)?Z.value=e:null),placeholder:"请选择",onChange:a[4]||(a[4]=e=>p(ne)(!0))},{default:m(()=>[(u(!0),d(v,null,f(p(ta),e=>(u(),w(l,{key:e.value,label:e.label,value:e.value},{default:m(()=>[c("span",Ke,[c("span",null,k(e.label),1),t(c("span",{class:j(e.data?"text-primary":"text-warning")},k(e.data?"[已配置]":"[未配置]"),3),[[o,e.config]])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),t(s(p(i),{class:"ml-[8px]",type:"default",onClick:a[5]||(a[5]=e=>p(ne)(!1))},{default:m(()=>[...a[20]||(a[20]=[r("配置",-1)])]),_:1},512),[[o,"dns"!==p(Z)]])]),_:1})]),_:1}),s(G,{modelValue:p(ee),"onUpdate:modelValue":a[6]||(a[6]=e=>y(ee)?ee.value=e:null),area:50},{default:m(()=>[c("div",Qe,[a[21]||(a[21]=c("span",{class:"flex items-center mb-[12px]"},[c("i",{class:"svgtofont-el-warning text-warning text-titleLarge mr-[4px]"}),c("span",{class:"text-medium"},"当前提交信息存在以下问题，请解决后重新提交！")],-1)),s(q,{data:p($),border:""},{default:m(()=>[s(J,{prop:"field",label:"错误字段"}),s(J,{prop:"error",label:"错误信息"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),s(G,{title:"选择域名",modelValue:p(ve),"onUpdate:modelValue":a[9]||(a[9]=e=>y(ve)?ve.value=e:null),area:57,"show-footer":!0,onConfirm:p(fe)},{default:m(()=>[c("div",We,[s(K,{class:"!w-[53rem] mb-[16px]",modelValue:p(ue),"onUpdate:modelValue":a[7]||(a[7]=e=>y(ue)?ue.value=e:null),placeholder:"支持字段模糊搜索",onInput:p(de),clearable:""},null,8,["modelValue","onInput"]),c("div",Xe,[a[22]||(a[22]=c("div",{class:"flex justify-between items-center bg-light py-[1rem] pl-[1rem]"},"域名",-1)),s(p(P),{modelValue:p(me),"onUpdate:modelValue":a[8]||(a[8]=e=>y(me)?me.value=e:null),options:p(pe),class:"custom-radio-group whitespace-nowrap py-[2px] w-full"},null,8,["modelValue","options"])]),s(ae,{options:p(ce),class:"ml-[20px]"},null,8,["options"])])]),_:1},8,["modelValue","onConfirm"]),s(G,{title:"自定义域名",modelValue:p(_e),"onUpdate:modelValue":a[11]||(a[11]=e=>y(_e)?_e.value=e:null),area:57,"show-footer":!0,onConfirm:p(xe)},{default:m(()=>[c("div",Ye,[s(le,{class:"mb-[16px]",ref_key:"customDomainRef",ref:ye,model:p(be),rules:p(he)},{default:m(()=>[s(R,{label:"自定义域名",prop:"domain"},{default:m(()=>[s(K,{autofocus:"",class:"!w-[40rem] mb-[8px]",modelValue:p(be).domain,"onUpdate:modelValue":a[10]||(a[10]=e=>p(be).domain=e),placeholder:"请输入需要申请证书的".concat(p(W)?"IP（IP证书）":"域名（单域名证书）","，必填项，例如：").concat(p(W)?"192.168.1.1":"www.bt.cn")},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model","rules"]),s(ae,{options:p(ce),class:"ml-[20px]"},null,8,["options"])])]),_:1},8,["modelValue","onConfirm"])])}}}),[["__scopeId","data-v-0b06e420"]]);export{Ze as default};
