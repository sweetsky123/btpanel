import{_ as a}from"./index124.js?v=1763689792";import{_ as e}from"./index109.js?v=1763689792";import{u as s,Q as t,W as l,M as r,p as n,P as i,l as o,ah as d,$ as u,j as c,_ as m}from"./utils-lib.js?v=1763689792";import{c as p,r as f,o as v,e as _,D as g,v as y,I as w,x as I,y as P,z as b,O as h,C as x,G as j,A as V,R as k,B as S,J as C,ap as U,H as q,b2 as N,U as J}from"./base-lib.js?v=1763689792";import{_ as O}from"./index118.js?v=1763689792";import{_ as T}from"./index137.js?v=1763689792";import{R,S as A,T as H,U as $,V as M,W}from"./firewall.js?v=1763689792";import{p as z}from"./validator.js?v=1763689792";import{r as B,f as D}from"./useMethod8.js?v=1763689792";import{a as F,u as G}from"./column.js?v=1763689792";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1763689792";import{g as E}from"./useStore6.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./index107.js?v=1763689792";const K={class:"min-h-[30rem]"},L={class:"flex items-center text-secondary"},X={class:"mr-[8px]"},Y={class:"p-[2rem]"},Z={class:"flex items-center"},aa=m(p({__name:"index",setup(m){const{payment:p}=s(),{refs:{systemTabActive:aa,firewallInfo:ea}}=E(),sa=f(null),ta=f([]),la=f(""),ra=f(0),na=f("--"),ia=f("--"),oa=f(0),da=f(!1),ua=f(!1),ca=v({p:1,limit:20}),ma=f(!1),pa=f(0),fa={title:"恶意IP自动封禁-功能介绍",ps:"从宝塔官网获取最新的恶意IP名单，与访问本机的IP做对比，将吻合的恶意IP全部IP加入黑名单，黑名单将从系统防火墙(网络层)隔离，黑名单内的恶意IP将无法访问任何端口、服务，大大提升本机的安全性。",source:362,desc:["每天自动更新最新恶意IP","全自动管理","防入侵","准确性高"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/firewall/malicious.png"}]},va=async()=>{"banned"===aa.value&&(_a(),await t({loading:ua,request:R({data:JSON.stringify({...ca,query:la.value})}),data:{data:[Array,ta],page:l(ra)},success:a=>{}}))},_a=async()=>{try{const{data:a}=await A();a.status?(ma.value=a.data.status,pa.value=a.data.ip_count||0,na.value=a.data.runtime||"--",ia.value=a.data.bantime,oa.value="永久封禁"===ia.value?0:Number(ia.value.replace("天",""))):r.error(a.msg)}catch(a){}},ga=async()=>{await n({icon:"warning",title:"清空恶意IP",content:"将清空所有恶意IP，是否继续操作？"}),await t({loading:"正在清空恶意IP列表，请稍后...",request:H(),message:!0,success:va})},ya=async a=>{try{ma.value=!a,await n({icon:"warning",title:"自动封禁开关提示",content:"".concat(a?"开启":"关闭","自动封禁功能后，系统将").concat(a?"会":"不会","运行封禁恶意IP，是否继续操作？")});(await t({loading:"正在".concat(a?"开启":"关闭","自动封禁功能，请稍后..."),request:$({data:JSON.stringify({status:a?1:0})}),message:!0,success:R})).status&&(ma.value=a)}catch(e){}},wa=async()=>{if(!/^[1-9]\d*$|^0$/.test(oa.value.toString()))return r.error("请输入正确的封禁时间"),!1;try{await t({loading:"正在设置封禁时间，请稍后...",request:M(Number(oa.value)),message:!0,success:va}),da.value=!1}catch(a){}},Ia=[{label:"删除",value:"delete",event:async(a,e)=>{await D(a,e,async(a,e)=>await W({data:JSON.stringify({id:a.id,address:a.address})}),{label:"恶意IP地址",prop:"address"},va)}}],Pa=[F({key:"id"}),{label:"IP地址",prop:"address",width:120},{label:"IP归属地",render:a=>"ltd"!=p.value.authType?_("span",{class:"bt-link",onClick:()=>z({sourceId:362})},[g("点击查看")]):_("span",null,[(a.area.continent||"")+(a.area.info||"--")])},{label:"时间",prop:"addtime",renderHeader:()=>B("添加时间","封禁时间:".concat(ia.value))},G([{onClick:async a=>{await n({icon:"warning-filled",title:"删除恶意IP【"+a.address+"】",content:"删除选中的IP后，该IP将不再被监控，是否继续操作？"}),await t({loading:"正在删除恶意IP，请稍后...",request:W({data:JSON.stringify({id:a.id,address:a.address})}),message:!0,success:va})},title:"删除"}])];return y(va),(s,t)=>{const l=T,r=U,n=q,m=N,f=i,v=o,y=d,R=O,A=J,H=u,$=c,M=e,W=a,z=w("bt-loading");return I(),P("div",K,[b(ea).init_status?j("",!0):(I(),h(l,{key:0,width:"38rem"},{content:x(()=>[_(Q)]),_:1})),"ltd"===b(p).authType?(I(),h(M,{key:1},{"header-left":x(()=>[V("div",L,[t[11]||(t[11]=g(" 自动封禁开关 ",-1)),_(r,{modelValue:b(ma),"onUpdate:modelValue":t[0]||(t[0]=a=>k(ma)?ma.value=a:null),class:"mx-[0.8rem]",onChange:ya},null,8,["modelValue"]),g(" 封禁总数: "+S(b(pa))+" ",1),_(n,{onClick:ga,class:"mx-[0.8rem]"},{default:x(()=>[...t[9]||(t[9]=[g("清空",-1)])]),_:1}),V("span",null,"系统将于每日"+S(b(na))+"自动同步IP情报库",1),_(m,{direction:"vertical"}),V("span",X,"封禁时间："+S(b(ia)),1),_(n,{onClick:t[1]||(t[1]=a=>da.value=!0)},{default:x(()=>[...t[10]||(t[10]=[g("修改",-1)])]),_:1})])]),"header-right":x(()=>[_(f,{class:"!w-[32rem]",modelValue:b(la),"onUpdate:modelValue":t[2]||(t[2]=a=>k(la)?la.value=a:null),onSearch:t[3]||(t[3]=a=>va()),placeholder:"请输入恶意IP地址"},null,8,["modelValue"])]),content:x(()=>[C(_(v,{ref_key:"ipTableRef",ref:sa,column:Pa,data:b(ta),description:"恶意IP列表为空"},null,8,["data"]),[[z,b(ua)],[z,"正在加载IP列表，请稍后...","title"]])]),"footer-left":x(()=>[_(y,{"table-ref":b(sa),options:Ia},null,8,["table-ref"])]),"footer-right":x(()=>[_(R,{ref:"ipRulesPager",total:b(ra),page:b(ca).p,"onUpdate:page":t[4]||(t[4]=a=>b(ca).p=a),row:b(ca).limit,"onUpdate:row":t[5]||(t[5]=a=>b(ca).limit=a),onChange:t[6]||(t[6]=a=>va()),name:"ip"},null,8,["total","page","row"])]),popup:x(()=>[_($,{title:"设置封禁时间",modelValue:b(da),"onUpdate:modelValue":t[8]||(t[8]=a=>k(da)?da.value=a:null),area:42,onConfirm:wa,showFooter:""},{default:x(()=>[V("div",Y,[V("div",Z,[t[12]||(t[12]=g(" 设置封禁时间: ",-1)),_(A,{modelValue:b(oa),"onUpdate:modelValue":t[7]||(t[7]=a=>k(oa)?oa.value=a:null),class:"mx-[0.8rem] !w-[26rem]",placeholder:"请输入要修改的封禁时间"},null,8,["modelValue"])]),_(H,{options:[{content:"0为永久封禁"},{content:"修改后下一次运行生效"}],class:"mt-[1rem]"})])]),_:1},8,["modelValue"])]),_:1})):(I(),h(W,{key:2,data:fa,class:"px-[20%] py-[2rem]"}))])}}}),[["__scopeId","data-v-b1e218f5"]]);export{aa as default};
