import{_ as a}from"./index109.js?v=1763689792";import{V as e,x as s,Q as l,p as t,iT as i,l as o,j as n}from"./utils-lib.js?v=1763689792";import{c as r,r as m,bQ as d,aE as p,v as u,I as c,x as f,y as g,e as y,C as b,D as v,J as w,z as _,R as h,A as x,F as j,b1 as k,H as V,an as C,O,am as q}from"./base-lib.js?v=1763689792";import{g as S}from"./useStore2.js?v=1763689792";import{getRedisBackupList as D,restoreModuleBack as J,backModuleDatabase as T}from"./database.js?v=1763689792";import{u as L}from"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const N={class:"p-20px"},z={class:"flex items-center p-20px"},A=r({__name:"index",props:{compData:{default:()=>({sid:0,keyList:[]})}},setup(r){const A=r,{refreshTableList:H}=S(),Q=m(!1),U=m([]),B=m(0),E=m(!1),F=d(A.compData,"keyList"),I=d(A.compData,"sid"),R=async()=>{await l({loading:Q,request:D({data:JSON.stringify({sort:"desc"})}),data:[Array,U]})},G=async()=>{await l({loading:"正在备份数据库,请稍后...",request:T({},"redis"),message:!0}),R()},K=async()=>{await l({loading:"正在备份数据库,请稍后...",request:T({data:JSON.stringify({db_idx:String(B.value),sid:I.value})},"redis"),message:!0}),R(),E.value=!1},M=[{label:"名称",prop:"name",showOverflowTooltip:!0},{label:"路径",prop:"filepath",showOverflowTooltip:!0},{label:"备份时间",prop:"mtime",render:a=>p("span",e(a.mtime))},{label:"大小",render:a=>p("span",s(a.size))},L([{onClick:async a=>{await t({title:"覆盖数据",icon:"warning-filled",type:"input",input:{content:"覆盖数据"},content:"即将使用【"+a.name+"】对数据进行覆盖，是否继续?"}),await l({loading:"正在恢复备份中，请稍后...",request:J({data:JSON.stringify({file:a.filepath,sid:I.value})},"redis"),message:!0}),H()},title:"恢复"},{onClick:async a=>{await t({title:"删除备份【"+a.name+"】",content:"是否删除【"+a.name+"】备份?"}),await l({loading:"正在备份数据库,请稍后...",request:i({path:a.filepath}),message:!0}),R()},title:"删除"}])];return u(()=>R()),(e,s)=>{const l=V,t=o,i=q,r=C,m=n,d=a,p=c("bt-loading");return f(),g("div",N,[y(d,null,{"header-left":b(()=>[y(l,{type:"primary",onClick:G},{default:b(()=>[...s[3]||(s[3]=[v("立即备份",-1)])]),_:1}),y(l,{onClick:s[0]||(s[0]=a=>E.value=!0)},{default:b(()=>[...s[4]||(s[4]=[v("指定备份",-1)])]),_:1})]),content:b(()=>[w(y(t,{"max-height":"400",ref:"routeBackup",data:_(U),class:"h-full",column:M},null,8,["data"]),[[p,_(Q)],[p,"正在加载备份列表，请稍后...","title"]])]),popup:b(()=>[y(m,{area:36,title:"指定备份数据库",onConfirm:K,"show-footer":"",modelValue:_(E),"onUpdate:modelValue":s[2]||(s[2]=a=>h(E)?E.value=a:null)},{default:b(()=>[x("div",z,[s[5]||(s[5]=v(" 数据库 ",-1)),y(r,{modelValue:_(B),"onUpdate:modelValue":s[1]||(s[1]=a=>h(B)?B.value=a:null),class:"ml-20px !w-[24rem]"},{default:b(()=>[(f(!0),g(j,null,k(_(F),(a,e)=>(f(),O(i,{key:e,value:a.id,label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])]),_:1})])}}});export{A as default};
