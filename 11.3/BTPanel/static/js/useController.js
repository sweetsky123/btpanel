import{u as e,v as a,bN as t,q as s,n as o,H as n,bO as l,bP as c,b as r}from"./utils-lib.js?v=1763689792";import{r as i,p as u}from"./base-lib.js?v=1763689792";const d=r(),{forceLtd:w,payment:h,getGlobalInfo:v}=e(),m=async({isCheck:e,userInfo:o,userToken:n})=>{const l={...o};if(e.value){if(!o.code)return d.error("请输入验证码");l.token=n.value,delete l.password}else delete l.code;const c=d.load("绑定堡塔账号，请稍候 ...");try{l.username=await a(l.username),l.password=await a(l.password);const o=await t({...l});if(d.request(o),o.status)return f();if(s(o.data))return!1;if(!o.status&&"[]"===JSON.stringify(o.data))return d.request(o);-1===o.data.code&&(n.value=o.data.token,e.value=!0)}catch(r){}finally{c.close()}},f=async(e="/")=>{if(w.value)return await v(),h.value.noExceedLimit?p():h.value.authExpirationTime>-1&&h.value.userGive?window.location.reload():(d.warn("当前账号领取企业版次数已达到上线，请购买企业版，正在跳转请稍候..."),setTimeout(()=>window.location.reload(),2e3));y(e)},p=()=>{o({title:!1,area:["49","38"],component:()=>n(()=>import("./ltd-recom-view.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),close:()=>{y()}})},y=e=>{u("newsslDiscountStatus",!0),setTimeout(()=>{window.location.href=e||"/"},500)},b=e=>{const a=i(!1),t=i(null),s=i(null),o=async(a,t)=>{const s=d.load("正在配置面板用户信息，请稍后...");try{const s=await l({code:a,state:t});s.status?(d.success("微信绑定成功"),y(e)):d.error(s.msg||"微信绑定失败")}catch(o){d.error("微信绑定失败")}finally{s.close()}},n=async()=>{a.value=!0;try{const e=await c();if(e.status){const a=600,s=500,l=window.screen.width/2-a/2,c=window.screen.height/2-s/2;t.value=window.open(e.msg.replace("login.html","new/wxBindPanel.html"),"_blank","width=".concat(a,",height=").concat(s,",left=").concat(l,",top=").concat(c)),window.addEventListener("message",e=>{var a,s,l;switch(null==(a=e.data)?void 0:a.type){case"wechat_auth_error":d.error(e.data.msg);try{null==(s=t.value)||s.close(),n()}catch(c){}break;case"wechat_auth_complete":const{code:a,state:r}=e.data.data||{};null==(l=t.value)||l.close(),o(a,r)}})}}catch(e){}finally{a.value=!1}};return{qrcodeLoading:a,wechatWindow:t,checkWindowTimer:s,openWechatLogin:n,handleWechatAuth:o,onCancelWechat:()=>{s.value&&(clearInterval(s.value),s.value=null),t.value&&!t.value.closed&&(t.value.close(),t.value=null)}}};export{m as b,f,b as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
