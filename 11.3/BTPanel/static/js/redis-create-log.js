import{_ as t}from"./index123.js?v=1763689792";import{c as s,r as e,v as a,a8 as l,x as i,y as r,e as o,C as n,F as u,b1 as m,z as c,O as d,cc as p,cd as v,A as f}from"./base-lib.js?v=1763689792";import{lc as x,M as _,_ as g}from"./utils-lib.js?v=1763689792";import{u as j}from"./index68.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./index110.js?v=1763689792";import"./useController6.js?v=1763689792";import"./site.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";const b={class:"p-[2rem] master-redis-create-log"},k=g(s({__name:"redis-create-log",props:{compData:{default:()=>({task_id:""})}},setup(s){const{isRedisRefreshList:g}=j(),k=s,w=e(""),h=["配置主Redis节点","配置从Redis节点","验证复制状态","主从配置完成"],y=e(h.map(t=>({name:t,status:"wait"}))),D=e(0);let R=null;const I={wait:()=>o("span",{class:"svgtofont-el-more-filled text-disabled mr-2px !text-large"},null),completed:()=>o("span",{class:"svgtofont-el-circle-check text-primary mr-2px !text-large"},null),failed:()=>o("span",{class:"svgtofont-el-circle-close text-dangerDark mr-2px !text-large"},null),running:()=>o("span",{class:"svgtofont-el-loading animate-spin text-supplement mr-2px !text-large"},null)},T={wait:"",completed:"完成",failed:"失败",running:"进行中"},C=async()=>{if(!k.compData.task_id)return;const{data:t}=await x({task_id:k.compData.task_id});if(!t.status)return void _.error(t.msg);const s=t.data;var e;w.value=s.logs||"",e=s.steps||[],y.value=h.map((t,s)=>{const a=e[s];return{name:t,status:(null==a?void 0:a.status)||"wait",start_time:null==a?void 0:a.start_time,completed_time:null==a?void 0:a.completed_time,updated_time:null==a?void 0:a.updated_time}});const a=y.value.findIndex(t=>"running"===t.status),l=y.value.map(t=>t.status).lastIndexOf("completed");D.value=-1!==a?a:-1!==l?l:0;const i=y.value.some(t=>"failed"===t.status);"completed"===s.status||"failed"===s.status||i?R&&(clearTimeout(R),g.value=!0,R=null):R=setTimeout(C,2e3)};return a(()=>{C()}),l(()=>{w.value="",R&&(clearTimeout(R),R=null)}),(s,e)=>{const a=t;return i(),r("div",b,[o(c(v),{direction:"vertical",space:"4rem",active:c(D)},{default:n(()=>[(i(!0),r(u,null,m(c(y),(t,s)=>{var e;return i(),d(c(p),{key:s,title:t.name,icon:I[t.status]?I[t.status]():I.wait(),description:null!=(e=T[t.status])?e:"",status:"completed"===t.status?"success":"running"===t.status?"process":"failed"===t.status?"error":"wait"},null,8,["title","icon","description","status"])}),128))]),_:1},8,["active"]),e[0]||(e[0]=f("h3",{class:"text-base mb-[1rem] mt-[1rem] color-[#666]"},"实时日志",-1)),o(a,{content:c(w),isHtml:!0,autoScroll:!0,style:{height:"14rem"}},null,8,["content"])])}}}),[["__scopeId","data-v-8388a2bd"]]);export{k as default};
