import{Q as a,j as e,b as l}from"./utils-lib.js?v=1763689792";import{c as s,s as t,r as i,v as o,x as n,y as u,A as r,D as m,e as d,C as c,F as p,b1 as v,z as f,O as x,R as y,B as b,am as _,an as j,b2 as w,H as g}from"./base-lib.js?v=1763689792";import{B as h}from"./index119.js?v=1763689792";import{h as V,i as C,o as k}from"./validator.js?v=1763689792";import{S as D}from"./useStore4.js?v=1763689792";import{getRewriteLists as H,batchPhpRewrite as P}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./ace.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const S={class:"p-2rem"},U={class:"flex items-center"},O={class:"relative h-full"},B={class:"p-20px"},F={class:"overflow-auto h-[12rem] border border-lighter p-12px"},J={class:"absolute bottom-0 w-full bg-light flex items-center justify-end p-12px"},N=s({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(s,{expose:N,emit:q}){const{batchConfig:z}=t(D()),{getFileEvent:A}=D(),E=l(),Q=s,R=q,G=i(""),I=i(!1),K=i([]),L=i([]),M=i(),T=i(),W=async a=>{await Y(a),T.value=""},X=async a=>{await Y(a),M.value=""},Y=async a=>{try{const{data:e}=await A({path:a});G.value=e.data}catch(e){}},Z=async()=>{const e=JSON.stringify(Q.compData.map(a=>{const e=K.value.find(e=>e.id===a.id);return{id:a.id,name:a.name,file:e.file}})),{exclude:l,enable:s}=z.value,t=V(!1,l,s,{params:{site_list:e,project_type:"PHP",rewrite_data:G.value}});a({loading:"正在部署，请稍后...",request:P(t),success:a=>{const{data:e}=C(a.data);k(e,{title:"部署伪静态"}),I.value=!1,R("close")}})};return N({onConfirm:()=>{M.value||T.value?I.value=!0:E.error("请选择一种伪静态规则")}}),o(async()=>{await(async()=>{try{const a=await H({site_ids:JSON.stringify(Q.compData.map(a=>a.id)),site_type:"PHP"});K.value=a.data.site_rewrites,L.value=a.data.template_rewrites}catch(a){}})()}),(a,l)=>{const t=_,i=j,o=w,V=h,C=g,k=e;return n(),u("div",S,[r("div",U,[l[5]||(l[5]=m(" 站点已有伪静态规则： ",-1)),d(i,{class:"mx-12px !w-16rem",modelValue:f(M),"onUpdate:modelValue":l[0]||(l[0]=a=>y(M)?M.value=a:null),onChange:W},{default:c(()=>[(n(!0),u(p,null,v(f(K),a=>(n(),x(t,{key:a.id,label:a.name+"站点的伪静态配置",value:a.file},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[6]||(l[6]=m(" 模板伪静态规则： ",-1)),d(i,{class:"mx-12px !w-16rem",modelValue:f(T),"onUpdate:modelValue":l[1]||(l[1]=a=>y(T)?T.value=a:null),onChange:X},{default:c(()=>[(n(!0),u(p,null,v(f(L),a=>(n(),x(t,{key:a.id,label:a.name+"模板的伪静态配置",value:a.file},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d(o),d(V,{modelValue:f(G),"onUpdate:modelValue":l[2]||(l[2]=a=>y(G)?G.value=a:null),class:"!h-[42rem]"},null,8,["modelValue"]),d(k,{title:"部署当前伪静态",modelValue:f(I),"onUpdate:modelValue":l[4]||(l[4]=a=>y(I)?I.value=a:null),area:[52,28]},{default:c(()=>[r("div",O,[r("div",B,[l[7]||(l[7]=r("span",{class:"!mb-4px inline-block"},"如下是需要批量部署伪静态的站点：",-1)),r("div",F,[(n(!0),u(p,null,v(s.compData,(a,e)=>(n(),u("div",{key:e,class:"p-4px w-full"},b(a.name),1))),128))]),l[8]||(l[8]=r("div",{class:"text-danger mt-4px"},"注意：批量设置站点伪静态后，原有站点伪静态配置将被覆盖。",-1))]),r("div",J,[d(C,{type:"warning",onClick:l[3]||(l[3]=a=>I.value=!1)},{default:c(()=>[...l[9]||(l[9]=[m("取消",-1)])]),_:1}),d(C,{type:"primary",onClick:Z},{default:c(()=>[m("部署("+b(s.compData.length)+"项)",1)]),_:1})])])]),_:1},8,["modelValue"])])}}});export{N as default};
