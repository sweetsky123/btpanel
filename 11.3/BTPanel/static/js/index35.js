import{aQ as e,Q as t,cC as a,p as s,cD as l,M as r,n as o,cE as i,cF as n,cG as c,H as u,cH as m,cI as p,L as d,cJ as v,cK as g,cL as y,U as _,F as h,ay as x,x as k,e as f,j as w,_ as b}from"./utils-lib.js?v=1763689792";import{B as C}from"./index119.js?v=1763689792";import{r as D,c as V,aE as q,v as T,a8 as P,g as j,bq as S,I as U,J as O,z as H,x as N,y as E,A as I,e as J,F as R,b1 as z,C as F,R as B,D as L,H as A,ap as M,U as G,B as K,O as Q,P as $,G as W}from"./base-lib.js?v=1763689792";import{h as X,c as Y,b as Z,f as ee,F as te,d as ae,g as se,i as le}from"./form-item.js?v=1763689792";import{m as re}from"./validator.js?v=1763689792";import{_ as oe}from"./index123.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./ace.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const{refs:{settingData:ie,loading:ne},getSet:ce,getDockerState:ue}=e(),me=D(!1),pe=D(""),de=D({}),ve=[{name:"主机名",key:"Name"},{name:"系统版本",key:"OperatingSystem"},{name:"架构",key:"Architecture"},{name:"内核版本",key:"KernelVersion"},{name:"CPU核心",key:"NCPU"},{name:"内存大小",key:"MemTotal"},{name:"Docker版本",key:"ServerVersion"},{name:"docker-compose版本",key:"DockerComposeVersion",append:V({name:"UpdateButton",setup:()=>()=>q("span",{class:"bt-link ml-[1rem]",onClick:async()=>{await s({title:"更新docker-compose版本",content:"是否更新docker-compose版本？"}),t({request:l(),loading:"正在更新docker-compose版本,请稍后...",success:e=>{e.status?o({title:"更新日志",area:56,btns:!1,component:V({setup(){let e=null;const t=D(""),a=S(),s=(s,l)=>{try{const s=l.data;t.value+=s,(s.includes("bt_successful")||s.includes("bt_failed"))&&(null==e||e.close(),a("close"),ue())}catch(r){null==e||e.close()}};return T(()=>{e=x({route:"/sock_shell",onMessage:s}),null==e||e.send("tail -f /tmp/update_dk-compose.log")}),P(()=>{null==e||e.close()}),()=>q("div",{class:"overflow-y-auto"},q(oe,{class:"!h-[40rem]",content:t.value,isHtml:!0}))}})}):r.error(e.msg)}})}},"更新")})},{name:"unix地址",key:"DockerUnixSocket"},{name:"数据目录",key:"DockerRootDir"}],ge=e=>{switch(e){case"MemTotal":return k(de.value.MemTotal);case"DockerUnixSocket":return ie.value.socket;case"DockerComposeVersion":return ie.value.docker_compose_version;default:return de.value[e]}},ye=()=>{t({request:a({data:JSON.stringify({daemon_json:pe.value})}),message:!0,success:({status:e})=>{e&&(me.value=!1)}})},_e=async e=>{try{(ie.value.service_status||"toggle"!==e)&&await s({title:"".concat("reset"===e?"重启":"关闭","Docker服务"),content:"是否".concat("reset"===e?"重启":"关闭","Docker服务？")}),ne.value=!0,"reset"===e?(await i({data:JSON.stringify({act:"restart"})}),window.location.reload()):t({request:i({data:JSON.stringify({act:ie.value.service_status?"stop":"start"})}),message:!0,success:e=>{e.status&&window.location.reload()}})}catch(a){}finally{ne.value=!1}},he=async()=>{try{await s({title:"修复docker模块",content:"修复docker可能会导致容器异常，修复大约5分钟，是否继续修复？"}),t({request:n(),message:!0,success:e=>{e.status&&re()}})}catch(e){}},xe=async()=>{try{const e=await c();o({component:()=>u(()=>import("./index272.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{needForce:!e.status,msg:e.msg},title:"卸载Docker",btn:"确定",area:45})}catch(e){}},ke=async e=>{ie.value.monitor_status=e,t({request:m({data:JSON.stringify({act:e?"start":"stop"})}),message:!0,success:ce})},fe=async()=>{o({component:()=>u(()=>import("./index274.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"设置Compose路径",area:45,btn:!0})},we=async e=>{try{if(e)return void be();await s({icon:"question-filled",title:e?"开启日志切割":"关闭日志切割",content:"".concat(e?"开启":"关闭","日志切割后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置日志切割,请稍后...",request:v({log_cutting:e?JSON.stringify({"max-file":ie.value.log_cutting.file,"max-size":"".concat(ie.value.log_cutting.size,"m")}):JSON.stringify({})}),message:!0,success:ue,error:()=>{ie.value.log_cutting.status=!e}})}catch(a){ie.value.log_cutting.status=!e}},be=()=>{const{BtForm:e,submit:a}=d({data:()=>({"max-file":Number(ie.value.log_cutting.file)||1,"max-size":Number(ie.value.log_cutting.size)||10}),options:()=>j(()=>[Z("文件大小","max-size",{attrs:{placeholder:"文件大小",style:"width:27rem;"},slots:{unit:()=>q("div",{class:"inline-block w-[3rem] text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"MB")},rules:[{required:!0,message:"请输入文件大小",trigger:"blur"},{validator:(e,t,a)=>{t&&/^\d+$/.test(t)?a():a(new Error("请输入正整数"))}}]}),Z("保留份数","max-file",{attrs:{placeholder:"保留份数",style:"width:27rem;"},slots:{unit:()=>q("div",{class:"inline-block w-[3rem] text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"份")},rules:[{required:!0,message:"请输入保留份数",trigger:"blur"},{validator:(e,t,a)=>{t&&/^\d+$/.test(t)?a():a(new Error("请输入正整数"))}}]}),ee("",[{content:"当前配置只会影响新创建的容器,已经创建的容器需要重新创建使配置生效"},{content:"如果你的容器中有重要数据，确保在执行重建操作之前进行备份"}])]),submit:async(e,a)=>{try{await a();return!!(await t({request:v({log_cutting:JSON.stringify({"max-file":e.value["max-file"],"max-size":"".concat(e.value["max-size"],"m")})}),message:!0,loading:"正在设置日志切割,请稍后..."})).status&&(ue(),!0)}catch(s){return!1}}});return o({component:()=>q("div",{class:"p-[1.6rem]"},q(e)),title:"设置日志切割",area:45,btn:!0,onConfirm:a,onCancel:()=>{ue()}})},Ce=async(e,a)=>{try{let l="";switch(e){case"iptables":l="iptables";break;case"live_restore":l="live_restore"}await s({icon:"question-filled",title:a?"开启".concat(l):"关闭".concat(l),content:"".concat(a?"开启":"关闭").concat(l,"后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置".concat(l,",请稍后..."),request:v({[e]:a?1:0}),message:!0,success:ue,error:()=>{ie.value[e]=!a}})}catch(l){ie.value[e]=!a}},De=()=>o({component:()=>u(()=>import("./index275.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"ipv6设置",btn:"确定",area:60}),Ve=async e=>{try{await s({icon:"question-filled",title:e?"开启IPV6":"关闭IPV6",content:"".concat(e?"开启":"关闭","IPV6后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置IPV6,请稍后...",request:v({status:e?1:0}),message:!0,success:ue,error:()=>{ie.value.ipv6=!e}})}catch(a){ie.value.ipv6=!e}},qe=async e=>{if(!1!==e){const{BtForm:e,submit:a}=d({data:()=>({http_proxy:ie.value.proxy.http_proxy||"http://",https_proxy:ie.value.proxy.https_proxy||"https://",no_proxy:ie.value.proxy.no_proxy||"localhost,127.0.0.1"}),options:e=>j(()=>[Z("HTTP代理","http_proxy",{attrs:{placeholder:"请输入HTTP代理地址",style:"width:32rem",onInput:t=>{const a=t.replace(/^http:\/\//,"");e.value.https_proxy="https://".concat(a)}},rules:[{required:!0,message:"请输入HTTP代理地址",trigger:"blur"},{pattern:/^http:\/\/.+/,message:"HTTP代理必须以http://开头",trigger:"blur"}]}),Z("HTTPS代理","https_proxy",{attrs:{placeholder:"请输入HTTPS代理地址",style:"width:32rem"},rules:[{required:!0,message:"请输入HTTPS代理地址",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"HTTPS代理必须以http://或https://开头",trigger:"blur"}]}),Z("不代理的地址","no_proxy",{attrs:{placeholder:"请输入无需代理的地址,多个地址用逗号分隔",style:"width:32rem"}}),te(()=>q("span",{class:"text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"*设置代理后需要重启Docker服务才能生效")),te(()=>q("div",{class:"text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"*http示例：http://127.0.0.1:8888")),te(()=>q("div",{class:"text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"*https示例：https://127.0.0.1:8888"))]),submit:async(e,a)=>{try{await a(),await s({icon:"question-filled",title:"设置Docker代理",content:"设置代理后需要重启docker，请确保可以重启docker再操作。是否继续？"});const l={http_proxy:e.value.http_proxy,https_proxy:e.value.https_proxy,no_proxy:e.value.no_proxy};return(await t({loading:"正在设置Docker代理,请稍后...",request:v({proxy_settings:JSON.stringify(l)}),message:!0,success:ue})).status}catch(l){return!1}}});return o({component:()=>q("div",{class:"p-2rem"},q(e)),title:"Docker代理设置",area:50,btn:"确定",onConfirm:a,onCancel:()=>{ue()}})}try{await s({icon:"question-filled",title:"关闭Docker代理",content:"是否关闭Docker代理？"}),await t({loading:"正在关闭Docker代理？,请稍后...",request:v({proxy_settings:JSON.stringify({})}),message:!0,success:ue,error:()=>{ue()}})}catch(a){ie.value.proxy.status=!e}},Te=e=>X("",()=>q("span",{class:"text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"".concat(e))),Pe=()=>{ce(!1),t({request:g(),success:e=>{de.value=e.data}})},je={class:"module-ui mb-16px !mt-0",shadow:"never",header:"全局设置","body-style":{padding:0,display:"flex",minHeight:"5.2rem"}},Se={class:"module-ui mb-16px",shadow:"never",header:"系统信息","body-style":{padding:0,display:"flex",minHeight:"5.2rem"}},Ue={class:"leading-[3.2rem]"},Oe={key:0},He={class:"h-[50rem] p-2rem"},Ne=b(V({__name:"index",setup(a){const{refs:{settingData:l,loading:i}}=e(),n=j(()=>!l.value.docker_installed||!l.value.docker_compose_installed),{BtForm:c}=d({data:()=>l.value,options:e=>j(()=>[X("服务状态",()=>J("div",null,[n.value?J("span",null,[L("当前状态：未安装")]):J("span",{class:"flex items-center text-small"},[L("当前状态："),l.value.service_status?"开启":"停止",J("span",{class:l.value.service_status?"svgtofont-icon-start text-primary":"svgtofont-icon-stop text-danger"},null),J(A,{class:"!ml-[2rem]",onClick:()=>_e("toggle")},{default:()=>[l.value.service_status?"停止":"开启"]}),J(A,{onClick:()=>_e("reset")},{default:()=>[L("重启")]}),!l.value.service_status&&J(A,{onClick:he},{default:()=>[L("修复")]})])])),...l.value.monitor_status?[ae([X("容器监控",()=>J(M,{modelValue:l.value.monitor_status,"onUpdate:modelValue":e=>l.value.monitor_status=e,onChange:ke},null),"monitor_status"),Te("*设置容器页面监控开关,关闭后CPU使用率将不再监控")]),ae([Z("监控天数","monitor_save_date",{attrs:{class:"!w-[32rem]",placeholder:"请输入保存天数"}}),se("保存",{attrs:{class:"!ml-4px",type:"primary",onClick:()=>(async e=>{"date"===e&&t({request:p({data:JSON.stringify({save_date:ie.value.monitor_save_date})}),message:!0,success:ce()})})("date")}}),Te("*设置容器页面监控保存天数")])]:[],ae([Z("加速URL","url",{attrs:{class:"!w-[32rem]",placeholder:"加速URL",disabled:!0}}),se("修改",{attrs:{class:"!ml-4px",type:"primary",onClick:()=>(async e=>{o({component:()=>u(()=>import("./index273.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),title:"设置加速URL",area:64,btn:!0,compData:{url:e}})})(e.value.url)}}),te(()=>J(f,{class:"mx-[2rem] text-primary cursor-pointer leading-[3.2rem] mb-[1.8rem]",target:"_blank",href:"https://www.bt.cn/bbs/thread-134771-1-1.html"},{default:()=>[L(">>帮助")]})),...l.value.bad_registry?[Te("*提示：检测到您上次拉取镜像出现异常，请尝试更换推荐的加速站: ".concat(l.value.bad_registry_path))]:[]]),ae([Z("docker compose","docker_compose_path",{attrs:{class:"!w-[32rem]",placeholder:"docker compose路径",disabled:!0}}),se("修改",{attrs:{class:"!ml-4px",type:"primary",onClick:fe}}),Te("*docker compose路径")]),ae([Y("私有仓库","warehouse",{attrs:{class:"!w-[32rem]",disabled:!0,rows:4,autosize:{minRows:4,maxRows:4},placeholder:"Docker私有仓库地址"}}),se("修改",{attrs:{class:"!ml-4px self-end",type:"primary",onClick:()=>(e=>{const{BtForm:a,submit:l}=d({data:()=>({warehouse:e.replaceAll(/,/g,"\n")}),options:()=>j(()=>[Y("私有仓库","warehouse",{attrs:{placeholder:"请输入私有仓库地址,一行一个,如:\n192.168.1.111:8087\n192.168.1.112:8087",style:"width:27rem;",rows:5},rules:[]}),Te("*设置后将重启Docker")]),submit:async(e,a)=>{try{return await a(),await s({title:"提示",content:"即将重启Docker，是否继续？"}),!!(await t({request:v({warehouse:e.value.warehouse.replace(/ /g,"").replaceAll(/\n/g,",")}),message:!0,loading:"正在设置私有仓库,请稍后..."})).status&&(ue(),!0)}catch(l){return!1}}});o({component:()=>q("div",{class:"p-[1.6rem]"},q(a)),title:"设置私有仓库",area:45,btn:!0,onConfirm:l})})(e.value.warehouse)}})]),ae([X("日志切割",()=>J(M,{modelValue:l.value.log_cutting.status,"onUpdate:modelValue":e=>l.value.log_cutting.status=e,onChange:we},null),"log_cutting",{onClick:e=>e.preventDefault()}),se("设置",{attrs:{class:"!ml-[1rem]",type:"primary",onClick:()=>be()}}),X("",()=>q("span",{class:"text-tertiary mt-[2px] leading-[2rem] text-small ml-[20px]"},"*切割文件大小".concat(l.value.log_cutting.size,"MB，保留份数").concat(l.value.log_cutting.file,"份")))]),ae([X("ipv6",()=>J(M,{modelValue:l.value.ipv6,"onUpdate:modelValue":e=>l.value.ipv6=e,onChange:Ve},null),"ipv6",{onClick:e=>e.preventDefault()}),se("ipv6地址配置",{attrs:{class:"!ml-[1rem]",type:"primary",onClick:De}}),Te("*此ipv6范围将会在默认的bridge网络中使用，启用或关闭ipv6后需要重启docker，请确保可以重启docker再操作")]),ae([X("iptables",()=>J(M,{modelValue:l.value.iptables,"onUpdate:modelValue":e=>l.value.iptables=e,onChange:e=>Ce("iptables",e)},null),"iptables",{onClick:e=>e.preventDefault()}),Te("*Docker 对 iptables 规则的自动配置")]),ae([X("live_restore",()=>J(M,{modelValue:l.value.live_restore,"onUpdate:modelValue":e=>l.value.live_restore=e,onChange:e=>Ce("live_restore",e)},null),"live_restore",{onClick:e=>e.preventDefault()}),Te("*开启后Docker守护进程发生意外停机或崩溃时保留正在运行的容器状态")]),ae([le("cgroup driver","driver",[{label:"cgroupfs",value:"cgroupfs"},{label:"systemd",value:"systemd"}],{attrs:{onChange:e=>(async e=>{try{await s({icon:"question-filled",title:"设置cgroup driver",content:"设置cgroup driver后需要重启docker，请确保可以重启docker再操作。是否继续？"}),await t({loading:"正在设置cgroup driver,请稍后...",request:v({driver:e}),message:!0,success:ue})}catch(a){ue()}})(e)}})]),X("配置文件",()=>J(A,{type:"primary",title:"全局配置文件",onClick:()=>me.value=!0},{default:()=>[L("打开配置文件")]})),X("Docker代理",()=>J("div",null,[J(M,{class:"mr-[1rem]",modelValue:l.value.proxy.status,"onUpdate:modelValue":e=>l.value.proxy.status=e,onChange:qe},null),J(A,{type:"primary",onClick:qe},{default:()=>[L("设置代理")]})]),"customProxy",{onClick:e=>e.preventDefault()}),X("应用商店目录",()=>J("div",{class:"flex items-center"},[J(G,{modelValue:l.value.dk_project_path,"onUpdate:modelValue":e=>l.value.dk_project_path=e,disabled:!l.value.allow_update_install_path,style:"width: 32rem",placeholder:"请输入目录"},null),J(A,{type:"primary",class:"ml-4px",disabled:!l.value.allow_update_install_path,onClick:()=>{(async e=>{try{if(!e||"string"!=typeof e||!/^\/.+/.test(e))return void r.error("请输入有效的目录路径！");await s({title:"设置应用商店目录",content:"修改应用商店目录将会重启面板，是否继续？"}),await t({request:y({path:e}),loading:"正在设置应用商店目录,请稍后...",success:e=>{e.status||r.error(e.msg)}}),await t({loading:"正在重启面板，请稍候...",request:_(),message:!0,success:e=>{e.status&&setTimeout(()=>{h(),window.location.reload()},1e3)}})}catch(a){return!1}})(l.value.dk_project_path)}},{default:()=>[L("修改")]}),l.value.allow_update_install_path?null:J("span",{class:"ml-[1.6rem] text-red-500 text-small"},[L("当前已有应用存在，无法修改")])]),"dk_project_path"),X("卸载Docker",()=>J(A,{type:"default",onClick:xe},{default:()=>[L("卸载")]}))])});return T(()=>{Pe()}),P(()=>{me.value=!1,pe.value="",de.value={}}),(e,t)=>{const a=C,s=w,r=U("bt-loading");return O((N(),E("div",null,[I("div",je,[J(H(c),{"label-position":"right",labelWidth:"9.6rem"})]),I("div",Se,[I("div",Ue,[(N(!0),E(R,null,z(H(ve),e=>(N(),E("div",{key:e.key,class:"line text-small !leading-[3.2rem]"},[I("div",null,K(e.name),1),I("div",null,K(H(ge)(e.key)),1),e.append?(N(),E("div",Oe,[(N(),Q($(e.append)))])):W("",!0)]))),128))])]),J(s,{title:"全局配置文件",modelValue:H(me),"onUpdate:modelValue":t[1]||(t[1]=e=>B(me)?me.value=e:null),showFooter:"",area:64,onConfirm:H(ye)},{default:F(()=>[I("div",He,[J(a,{modelValue:H(pe),"onUpdate:modelValue":t[0]||(t[0]=e=>B(pe)?pe.value=e:null),filePath:H(l).daemon_path,autoSave:!1,editorOption:{mode:"ace/mode/nginx"}},null,8,["modelValue","filePath"])])]),_:1},8,["modelValue","onConfirm"])])),[[r,H(i)],[r,"正在获取docker设置，请稍候...","title"]])}}}),[["__scopeId","data-v-4d49196b"]]);export{Ne as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
