import{u as a,br as e,ak as t,i3 as s,ay as l,e as n,az as r,am as o,H as i,p as c,i4 as u,b as m,_ as p,i5 as d,n as v,f0 as f,Q as g,i6 as x,aA as y,d as h,f as b,i7 as k,aj as w,bb as _}from"./utils-lib.js?v=1763689792";import{c as A,r as j,aB as T,v as I,I as L,J as B,z as C,x as E,y as S,A as R,e as O,C as z,D as Z,G as V,F as q,b1 as D,n as F,ay as J,b2 as M,B as P,L as Q,O as G,av as X,g as K,w as H,a0 as U}from"./base-lib.js?v=1763689792";import{_ as N}from"./index110.js?v=1763689792";import{aJ as Y}from"./validator.js?v=1763689792";import{_ as W}from"./index109.js?v=1763689792";import{B as $}from"./index106.js?v=1763689792";import{_ as aa}from"./index123.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const ea={class:"w-full h-full flex flex-col justify-center content-center"},ta={key:0,class:"h-full"},sa={class:"flex align-middle justify-center h-full"},la={key:1,class:"taskList pr-[10px] mb-[10px]"},na={key:0,class:"taskTips flex justify-between"},ra={class:"taskItemHeader"},oa={class:"taskItemName"},ia=["onClick"],ca={key:0,id:"taskRealTimeLogs",class:"taskRealTimeLog"},ua=p(A({__name:"task-list",setup(p,{expose:d}){const{panel:v}=a(),f=m(),g=j(!0),x=j(!0),y=j([]),h=j(""),b=j(!1),k=j(T("msgBoxSockShell",null)),w=[];let _=null;const A=async()=>{try{g.value=!0;const{data:a}=await e();if(t(a)&&void 0!==a.task){const{task:e,msg:t}=a;if(v.value.msgBoxTaskCount=e.length,e.length>0){x.value=!0,y.value=e;const{type:a,status:l}=e[0];"execshell"===a?"-1"===l?(G(),h.value="",h.value=t,F(()=>s("#taskRealTimeLogs")),b.value=!0):(setTimeout(()=>{A()},2e3),b.value=!0):b.value=!1}}else v.value.msgBoxTaskCount=0,x.value=!1}catch(a){}finally{g.value=!1}},G=async()=>{k.value||(k.value=l({route:"/sock_shell",onMessage:async(a,e)=>{const{data:t}=e;if(t.indexOf("|-Successify --- 命令已执行! ---")>-1)await A(),await X(),setTimeout(async()=>{var a;await A(),b.value||(null==(a=k.value)||a.close(),k.value=null,h.value="")},2e3);else if(r(t)){if(w.push(t),(null==w?void 0:w.length)>50&&w.shift(),o(_))return;_=setTimeout(()=>{h.value=w.join(""),_=null},500)}}}),k.value.send("tail -n 100 -f /tmp/panelExec.log"))},X=async()=>{const{useSoftStore:a}=await i(()=>import("./validator.js?v=1763689792").then(a=>a.dk),__vite__mapDeps([]),import.meta.url),{refreshRouteData:e}=a();e("1")};return d({init:A}),I(A),(a,e)=>{const t=J,s=n,l=M,r=N,o=L("scroll-bottom"),i=L("bt-loading");return B((E(),S("div",ea,[C(x)?(E(),S("div",la,[C(y).length>0?(E(),S("div",na,[e[3]||(e[3]=R("span",null," 提示：若任务长时间未执行，请尝试点击【重启面板】来重置任务队列 ",-1)),O(s,{onClick:C(Y)},{default:z(()=>[...e[2]||(e[2]=[Z("重启面板",-1)])]),_:1},8,["onClick"])])):V("",!0),O(l,{class:"!my-1rem"}),(E(!0),S(q,null,D(C(y),(a,e)=>(E(),S("div",{key:e,class:"taskItem"},["execshell"===a.type?(E(),S(q,{key:0},[R("div",ra,[R("span",oa,P(a.name),1),R("span",null,[R("span",{class:Q({leaveOut:"-1"===a.status})},P("0"===a.status?"等待":"正在安装"),3),O(r),R("span",{class:"bt-link",onClick:e=>(async a=>{var e;let t=null;try{await c({icon:"warning-filled",title:"删除任务",content:"删除当前选中任务，删除后将取消任务执行，是否继续操作？"}),t=f.load("正在删除任务，请稍后...");const s=await u({id:a});f.request(s),s.status&&A(),null==(e=k.value)||e.close()}catch(s){}finally{t.close()}})(a.id)}," 删除 ",8,ia)])]),"-1"===a.status&&"execshell"===a.type?B((E(),S("pre",ca,[Z(P(C(h)),1)])),[[o]]):V("",!0)],64)):V("",!0)]))),128))])):(E(),S("div",ta,[R("div",sa,[O(t,{class:"flex"},{image:z(()=>[...e[0]||(e[0]=[R("i",{class:"!text-tertiary svgtofont-empty !text-[7rem]"},null,-1)])]),description:z(()=>[...e[1]||(e[1]=[R("span",{class:"text-medium text-secondary"},"当前没有任务执行",-1)])]),_:1})])]))])),[[i,C(g)]])}}}),[["__scopeId","data-v-9c867db8"]]),ma={class:"mt-8px leading-8 text-small list-disc ml-20px"},pa={id:"wechat-customer",class:"wechat-customer"},da={class:"customer-title"},va={class:"flex border-solid border-b-1 border-primary text-primary justify-center items-center"},fa={class:"qrcode-wechat w-[128px] h-[128px] mt-[8px] mb-[4px]"},ga={id:"wechatCustomerQrcode"},xa=p(A({__name:"completed-list",setup(a,{expose:e}){const t=j([{label:"名称",prop:"name",showOverflowTooltip:!0,render:a=>O("div",null,[O("span",{class:"mr-2 font-bold !text-small ".concat(a.install_status?"text-primary svgtofont-el-check":"text-danger svgtofont-el-close")},null),a.name])},{label:"创建时间",prop:"addtime",width:110,render:a=>O("span",null,[a.addtime.replace(/^\d{4}-/,"")])},{label:"任务耗时",width:80,render:a=>O("span",null,[d(a.end-a.start)])},{label:"安装详情",width:140,showOverflowTooltip:!0,render:a=>O("span",{class:a.install_status?"text-primary":"text-danger"},[a.install_status?"安装成功":"安装失败"])},{label:"操作",align:"right",width:55,render:a=>null!==a.msg_info?O("span",{class:"text-primary cursor-pointer",onClick:()=>s(a)},[Z("详情")]):""}]),s=a=>v({title:"当前状态：".concat(a.msg_info.title),area:[72,50],compData:a.msg_info,component:()=>i(()=>import("./details.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),{BtTable:l,BtPage:r,refresh:o}=f({request:async a=>{try{const{data:e,page:t}=await g({request:x({table:"tasks",search:"1",limit:10,p:a.p}),data:{page:String,data:Array}});return{data:e,total:y(t),other:{}}}catch(e){return{data:[],total:0,other:{}}}},columns:t.value});return e({init:o}),(a,e)=>{const t=h,s=n,o=b,i=$,c=W;return E(),G(c,null,{content:z(()=>[O(C(l)),R("ul",ma,[R("li",null,[e[4]||(e[4]=Z(" 如安装或启动失败，请点击详情，截图相关错误信息 ",-1)),O(i,{placement:"bottom-start",effect:"light","popper-class":"!p-0",trigger:"hover",width:"160px"},{reference:z(()=>[...e[3]||(e[3]=[R("span",{class:"inline-block bt-link"},"咨询客服",-1)])]),default:z(()=>[R("div",pa,[R("div",da,[O(s,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-medium cursor-pointer flex flex-row items-center flex-nowrap"},{default:z(()=>[R("div",va,[e[0]||(e[0]=Z(" 点击咨询客服 ",-1)),O(t,{icon:"arrow",size:16,color:"var(--el-color-primary)",class:"ml-[5px]"})])]),_:1})]),R("div",fa,[R("div",ga,[O(o,{src:"/customer/customer-qrcode.png"})])]),e[1]||(e[1]=R("div",{class:"wechat-title flex"},[R("img",{class:"w-[14px] h-[14px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),R("div",{class:"text-base font-black"},"扫一扫")],-1)),e[2]||(e[2]=R("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[R("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]),_:1}),e[5]||(e[5]=Z(" 求助 ",-1))])])]),"footer-right":z(()=>[O(C(r),{"pager-count":5,layout:"prev, pager, next, total, jumper"})]),_:1})}}}),[["__scopeId","data-v-5c82b1da"]]),ya=A({__name:"perform-log",setup(a,{expose:e}){const t=j(!1),s=j("获取中..."),l=async()=>{try{const a=await g({loading:t,request:k(),data:String});s.value=a.trim()||"暂无执行日志"}catch(a){}};return e({init:l}),I(l),(a,e)=>{const l=aa,n=L("bt-loading");return B((E(),G(l,{class:"h-50rem",content:C(s)},null,8,["content"])),[[n,C(t)]])}}});var ha=function(a){return a.taskList="taskList",a.completedList="completedList",a.performLog="performLog",a}(ha||{});const ba=A({__name:"index",setup(e,{expose:t}){const{panel:s}=a(),l=X(s.value,"msgBoxTaskCount"),n=j(0),r=j(null),o=K(()=>"任务列表(".concat(l.value,")")),i=K(()=>"消息列表(".concat(n.value,")"));H(l,(a,e)=>{e>a&&(n.value+=e-a)});const{BtTabs:c}=w({type:"left-bg-card",options:[{label:()=>O(q,null,[o.value]),name:ha.taskList,lazy:!0,render:ua},{label:()=>O(q,null,[i.value]),name:"completedList",lazy:!0,render:xa},{label:"执行日志",name:"performLog",lazy:!0,render:ya}]});return I(async()=>{try{const{page:a}=await g({request:_({table:"tasks",search:"1",limit:11}),data:{page:String}});n.value=y(a)}catch(a){}}),U("msgBoxSockShell",r),t({onCancel:()=>{r.value&&(r.value.close(),r.value=null)}}),(a,e)=>(E(),G(C(c)))}});export{ba as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
