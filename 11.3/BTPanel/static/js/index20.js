import{u as e,n as a,H as s,M as t,Q as l,W as i,e as r,aC as n,P as o,l as d,ah as m,p as c}from"./utils-lib.js?v=1763689792";import{_ as p}from"./index109.js?v=1763689792";import{_ as u}from"./index118.js?v=1763689792";import{c as _,r as f,g as y,o as v,e as b,w as x,v as g,I as h,x as w,y as k,z as L,O as j,C,G as V,A as N,D as S,R as D,F as O,b1 as R,L as A,M as E,B as J,J as T,H as q,an as U,am as H,aD as I}from"./base-lib.js?v=1763689792";import{_ as P}from"./index137.js?v=1763689792";import{g as F}from"./useStore2.js?v=1763689792";import{getRedisKey as M,getRedisKeyValue as z,delBatchRedisValue as B,delRedisValue as G,getModulesCloudServer as K}from"./database.js?v=1763689792";import{a as Q,u as W,c as X}from"./column.js?v=1763689792";import{o as Y,a as Z,m as $}from"./useMethod4.js?v=1763689792";import{B as ee}from"./index138.js?v=1763689792";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1763689792";import{e as se,h as te,i as le,o as ie}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./index107.js?v=1763689792";const re={class:"flex items-center"},ne={class:"flex items-center mx-4px inline-flex"},oe={class:"flex items-center"},de={class:"mr-[1.6rem] text-small"},me={class:"!float-right mb-8px !w-[24rem]"},ce=_({__name:"index",setup(_){e();const{refs:{isRefreshTable:ce,envStatus:pe,isHaveServer:ue,softData:_e},resetRefresh:fe,refreshTableList:ye}=F(),ve=f("0"),be=f(),xe=f(!1),ge=f(0),he=y(()=>!pe.value.setup&&!ue.value),we=v({serverList:[],keyList:[],valueList:[]}),ke=f(0),Le=v({search:"",sid:0,limit:10,db_idx:0,p:1}),je=f({db_status:!0,msg:"加载中"}),Ce=y(()=>je.value.db_status?"check":"close"),Ve=()=>{a({title:"数据库备份",area:78,compData:{sid:Le.sid,keyList:we.keyList},component:()=>s(()=>import("./index140.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Ne=()=>{a({title:"清理数据库",area:42,compData:{sid:Le.sid,keyList:we.keyList},showFooter:!0,component:()=>s(()=>import("./index141.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Se=async e=>{const a=t.load("正在切换服务器,请稍后...");Le.sid=Number(e),await Je(),a.close()},De=(e,a)=>{Le.db_idx=Number(e),Re()},Oe=async e=>{const a=await l({request:M({data:JSON.stringify({sid:e})}),data:Array});return we.keyList=a,a},Re=async()=>{const e=await l({request:z({data:JSON.stringify({...Le})}),data:{data:Array,page:i(ke)}});we.valueList=e.data||[]},Ae=[Q({type:"page",key:"name"}),{label:"键",prop:"name"},{label:"值",prop:"val",width:320,render:e=>b("span",{class:"truncate !w-[30rem]",title:e.val},[e.val])},{label:"数据类型",prop:"type"},{label:"数据长度",prop:"len"},{label:"有效期",prop:"showtime"},W([{onClick:e=>{a({title:"编辑redis数据库",area:44,compData:{refresh:()=>Oe(Le.sid),row:{...e,db_idx:Number(ve.value)}},showFooter:!0,component:()=>s(()=>import("./index142.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},title:"编辑"},{onClick:async e=>{await c({icon:"warning-filled",title:"提示",content:"此操作将删除选中的数据【".concat(e.name,"】, 是否继续?")}),await l({request:G({data:JSON.stringify({sid:Le.sid,db_idx:Number(ve.value),key:e.name})}),message:!0}),ye()},title:"删除"}])],Ee=[{label:"删除",value:"delete",event:async(e,a,s,t,l,i)=>{const{label:r,value:n}=t,{enable:o,exclude:d}=i;await e({title:"批量".concat(r,"键"),content:"即将批量".concat(r,"键，是否继续操作！"),column:[{label:"键名",prop:"name"},X()],onConfirm:async()=>{const e=s.value.map(e=>({key:e.name})),a=te(!1,d,o,{params:{database_list:JSON.stringify(e),sid:Le.sid,db_idx:Number(ve.value)}}),t=await B(a);ye();const{data:i}=le(t.data);ie(i,{title:"删除键"}),null==l||l()}})}}],Je=async()=>{try{const e=await $(Le.sid);if(je.value=e,(async()=>{const e=await l({request:K({data:JSON.stringify({type:"redis"})},"redis"),data:Array});we.serverList=e,we.serverList.length&&(ue.value=!0)})(),!e.db_status)return we.valueList=[],we.keyList=[],ue.value=!1,!1;Oe(Le.sid),Re()}catch(e){}};return x(()=>ce.value,async e=>{e&&(await Oe(Le.sid),await Re()),fe()}),g(Je),(e,a)=>{const s=P,t=q,l=r,i=H,c=U,_=I,f=n,y=o,v=d,x=m,g=u,F=p,M=h("bt-loading");return w(),k("div",null,[L(he)?(w(),j(s,{key:0},{content:C(()=>[b(ae,{type:"Redis"})]),_:1})):V("",!0),b(F,null,{"header-left":C(()=>[N("div",re,[b(t,{type:"primary",onClick:a[0]||(a[0]=e=>L(Y)(()=>Oe(L(Le).sid),L(Le).sid,L(ve)))},{default:C(()=>[...a[7]||(a[7]=[S("添加Key",-1)])]),_:1}),b(t,{onClick:L(Z)},{default:C(()=>[...a[8]||(a[8]=[S("远程数据库",-1)])]),_:1},8,["onClick"]),b(t,{onClick:Ve},{default:C(()=>[...a[9]||(a[9]=[S("备份列表",-1)])]),_:1}),b(t,{onClick:Ne},{default:C(()=>[...a[10]||(a[10]=[S("清空数据库",-1)])]),_:1}),b(ee,{pluginName:"redis","plugin-info":L(_e),"is-request":!1,class:"ml-8px"},null,8,["plugin-info"]),b(l,{onClick:a[1]||(a[1]=e=>L(se)({name:"数据库",type:12,id:17})),class:"ml-[12px] <2xl:hidden"},{default:C(()=>[...a[11]||(a[11]=[S(" 需求反馈 ",-1)])]),_:1})])]),"header-right":C(()=>[N("div",ne,[a[12]||(a[12]=N("span",{class:"text-warning inline-block whitespace-nowrap flex items-center"},[N("i",{class:"svgtofont-el-info-filled mt-2px mr-4px"}),S("当前所有操作都关联至 ")],-1)),b(c,{modelValue:L(ge),"onUpdate:modelValue":a[2]||(a[2]=e=>D(ge)?ge.value=e:null),class:"!w-[16rem] mx-4px",onChange:Se},{default:C(()=>[(w(!0),k(O,null,R(L(we).serverList,e=>(w(),j(i,{key:e.ps,label:e.ps,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),N("div",oe,[N("i",{class:A("text-base mt-4px mr-2px svgtofont-el-circle-".concat(L(Ce),"-filled text-").concat("close"===L(Ce)?"danger":"primary"))},null,2),N("div",de,[a[13]||(a[13]=N("span",null,"状态：",-1)),N("span",{style:E("color:".concat(L(je).db_status?"var(--el-color-primary)":"#ef0808"))},J(L(je).msg),5)])])]),content:C(()=>[b(f,{modelValue:L(ve),"onUpdate:modelValue":a[3]||(a[3]=e=>D(ve)?ve.value=e:null),type:"card",onChange:De,class:"tab-switch"},{default:C(()=>[(w(!0),k(O,null,R(L(we).keyList,(e,a)=>(w(),j(_,{class:"h-0 !p-0",key:a,label:e.name+"【"+e.keynum+"】",name:String(e.id),lazy:!0},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),N("div",me,[b(y,{modelValue:L(Le).search,"onUpdate:modelValue":a[4]||(a[4]=e=>L(Le).search=e),onSearch:Re,placeholder:"请输入键名称"},null,8,["modelValue"])]),T(b(v,{ref_key:"redisTableRef",ref:be,column:Ae,data:L(we).valueList,total:L(ke)},null,8,["data","total"]),[[M,L(xe)]])]),"footer-left":C(()=>[b(x,{"table-ref":L(be),options:Ee},null,8,["table-ref"])]),"footer-right":C(()=>[b(g,{page:L(Le).p,"onUpdate:page":a[5]||(a[5]=e=>L(Le).p=e),row:L(Le).limit,"onUpdate:row":a[6]||(a[6]=e=>L(Le).limit=e),total:L(ke),onChange:Re},null,8,["page","row","total"])]),_:1})])}}});export{ce as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
