import{Q as a,l as e,k as l,j as s}from"./utils-lib.js?v=1763689792";import{c as d,r as t,v as u,I as o,x as n,y as i,J as r,z as m,e as p,C as c,A as b,R as v,F as _,b1 as f,O as V,D as y,ad as j,am as q,an as w,ab as x}from"./base-lib.js?v=1763689792";import{getSiteInfo as g,getMysqlInfo as h,modifyMysqlLink as k}from"./database.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const U={class:"p-[20px]"},C=d({__name:"index",setup(d,{expose:C}){const A=t(!1),z=t(!1),D=t([]),F=t([]),H=t({sql_id:"",pid:"",database:""}),I=[{prop:"name",label:"数据库"},{label:"站点名称",render:function(a){return p("div",null,[a.rname||"--"," ",p("span",{class:"cursor-pointer bt-link",onClick:()=>J(a)},[y("切换")])])}}],J=async a=>{var e;try{const l=await g();D.value=l.data,H.value.database=a.name,H.value.sql_id=a.id,H.value.pid=a.pid?a.pid:null==(e=D.value[0])?void 0:e.id,A.value=!0}catch(l){}},O=async()=>{await a({request:h(),loading:z,data:[Array,F]})},Q=async()=>{const e={pid:H.value.pid,sql_id:H.value.sql_id};await a({request:k(e),loading:"正在切换中...",message:!0,success:()=>{A.value=!1,O()}})};return u(O),C({init:O}),(a,d)=>{const t=e,u=l,y=j,g=q,h=w,k=x,C=s,J=o("bt-loading");return n(),i("div",null,[r(p(t,{"max-height":"560",column:I,data:m(F)},null,8,["data"]),[[J,m(z)]]),p(C,{title:"切换网站",modelValue:m(A),"onUpdate:modelValue":d[3]||(d[3]=a=>v(A)?A.value=a:null),area:42,"show-footer":"",onConfirm:Q},{default:c(()=>[b("div",U,[p(k,{modelValue:m(H),"onUpdate:modelValue":d[2]||(d[2]=a=>v(H)?H.value=a:null)},{default:c(()=>[p(y,{label:"数据库"},{default:c(()=>[p(u,{disabled:"",modelValue:m(H).database,"onUpdate:modelValue":d[0]||(d[0]=a=>m(H).database=a),width:"24rem"},null,8,["modelValue"])]),_:1}),p(y,{label:"站点名称"},{default:c(()=>[p(h,{modelValue:m(H).pid,"onUpdate:modelValue":d[1]||(d[1]=a=>m(H).pid=a),class:"!w-[24rem]"},{default:c(()=>[(n(!0),i(_,null,f(m(D),(a,e)=>(n(),V(g,{key:e,label:a.rname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}});export{C as default};
