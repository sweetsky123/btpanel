import{u as e,hy as l,ao as a,L as t,k as s,ax as r,bE as u,n,V as o,d as i,e as c,$ as m,aC as d}from"./utils-lib.js?v=1763689792";import{c as p,t as f,v,I as y,x as b,y as _,z as x,O as g,C as w,A as h,e as V,D as q,G as j,J as k,B as C,H as U,g as B,aZ as F,b2 as z,r as L,R as D,aD as H}from"./base-lib.js?v=1763689792";import{u as I}from"./useStore4.js?v=1763689792";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1763689792";import{_ as N}from"./index109.js?v=1763689792";import{_ as W}from"./index137.js?v=1763689792";import{b as A,u as E}from"./column.js?v=1763689792";import{cV as G}from"./validator.js?v=1763689792";import{g as J,c as O,d as Q,e as R,f as S,v as T,j as X,k as Z,l as $,n as K,r as P,q as Y,s as ee,t as le,u as ae}from"./useController17.js?v=1763689792";import{B as te}from"./index422.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./site.js?v=1763689792";import"./index110.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./index107.js?v=1763689792";import"./useController6.js?v=1763689792";import"./config.js?v=1763689792";const se={class:"flex items-center"},re={class:"whitespace-normal leading-1.8rem ml-[4px]"},ue={key:0,class:"flex items-center"},ne={class:"bg-lighter mb-[12px] flex items-center border border-dark justify-evenly p-[8px] py-[12px]"},oe={class:"flex flex-col justify-center items-center"},ie={class:"flex flex-col justify-center items-center"},ce=p({__name:"index",setup(d){const{payment:p}=e();f(p.value);const{BtTable:L}=l({request:J,columns:[{label:"类型",width:80,render:e=>({monitor_traffic_attack:"动态检查",monitor_traffic_total:"累计限制",monitor_http_flood:"动态检查"}[e.source])},{label:"描述",prop:"view_msg"},A({minWidth:100,event:Z,data:["停用","正常"]}),E([{title:"删除",onClick:$}])],extension:[a(le)]}),D=()=>{const{BtForm:e,submit:l,param:a}=t({data:{cycle:5,cycle_unit:"m",traffic:1,traffic_unit:"mb",request:10,request_unit:"kc",type:"total",sender:[],total:3},options:e=>B(()=>[{type:"custom",render:()=>V(F,{title:"实时检查近一段时间内的资源消耗情况，当出现超过阀值的高资源占用时，发出告警信息",type:"warning",closable:!1,"show-icon":!0,class:"!mb-[12px]"},null)},{type:"custom",render:()=>V(u,{label:"周期",prop:"cycle"},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"7rem",type:"number",min:"1",modelValue:e.value.cycle,"onUpdate:modelValue":l=>e.value.cycle=l},null),V(r,{class:"!w-[7rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.cycle_unit,"onUpdate:modelValue":l=>e.value.cycle_unit=l,options:[{label:"分钟",value:"m"},{label:"小时",value:"h"}]},null)])]})},{type:"custom",render:()=>V(u,{label:"阈值信息",prop:"total"===e.value.type?"traffic":"request"},{default:()=>{var l,a;return[V("div",{class:"flex items-center"},[V(r,{class:"!w-[10rem] !mr-[.4rem] !mt-[2px]",modelValue:e.value.type,"onUpdate:modelValue":l=>e.value.type=l,options:[{value:"total",label:"流量"},{value:"request",label:"请求数"}],onChange:l=>{"total"===l?(e.value.cycle_unit="m",e.value.traffic=1,e.value.traffic_unit="mb"):(e.value.cycle_unit="h",e.value.request=10,e.value.request_unit="kc")}},null),"total"===e.value.type?V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:e.value.traffic,"onUpdate:modelValue":l=>e.value.traffic=l},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.traffic_unit,"onUpdate:modelValue":l=>e.value.traffic_unit=l,options:K},null)]):V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:e.value.request,"onUpdate:modelValue":l=>e.value.request=l},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.request_unit,"onUpdate:modelValue":l=>e.value.request_unit=l,options:P},null)])]),V("span",{class:"text-small text-secondary"},["近".concat(e.value.cycle).concat("m"===e.value.cycle_unit?"分钟":"小时","内的").concat("total"===e.value.type?"流量":"请求数","超过").concat("total"===e.value.type?e.value.traffic:e.value.request).concat("total"===e.value.type?null==(l=K.find(l=>l.value===e.value.traffic_unit))?void 0:l.label:null==(a=P.find(l=>l.value===e.value.request_unit))?void 0:a.label,"就触发告警")])]}}),rules:{traffic:[{required:!0,message:"请输入流量阈值",trigger:"blur"}],request:[{required:!0,message:"请输入请求数阈值",trigger:"blur"}]}},G("告警方式","sender",{attrs:{class:"!w-24rem",limit:["sms"]},rules:{sender:[{required:!0,message:"请选择告警方式",trigger:"blur"}]}}),{type:"custom",render:()=>V(u,{label:"发送次数",prop:"total"},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"0",modelValue:e.value.total,"onUpdate:modelValue":l=>e.value.total=l},{append:"次"}),V("span",{class:"text-small text-secondary ml-[12px]"},[q("后将不再发送告警信息，无需限制次数可填0次表示不限制")])])]}),rules:{total:[{required:!0,message:"请输入发送次数",trigger:"blur"}]}}]),submit:async(e,l)=>(await l(),await Y(e.value))});n({title:"添加动态异常告警",area:60,component:()=>V("div",{class:"p-[2rem]"},[V(e,null,null)]),showFooter:!0,onConfirm:l})},H=()=>{const e=100,{BtForm:l,submit:a,param:i}=t({data:{cycle:0,traffic:1,traffic_unit:"mb",sender:[],total:3},options:l=>B(()=>[{type:"custom",render:()=>V(F,{title:"监控某段时间内的流量累计使用情况，当使用量超过当前规则设置的阀值，则发出告警信息",type:"warning",closable:!1,"show-icon":!0,class:"!mb-[12px]"},null)},{type:"custom",render:()=>V(u,{label:"时间段",prop:"cycle","label-width":e},{default:()=>[V("div",null,[V(te,{modelValue:l.value.cycle,"onUpdate:modelValue":e=>l.value.cycle=e,"value-format":"X",class:"date",type:"date",placeholder:0===l.value.cycle?"每个自然月":"请选择时间",onChange:e=>l.value.cycle=Number(e)},null),V(U,{type:"default",class:"!ml-[.4rem]",onClick:()=>l.value.cycle=0},{default:()=>[q("设为每个自然月")]}),0!==l.value.cycle&&V("span",{class:"block text-small text-secondary"},[q("自"),o(l.value.cycle,"yyyy-MM-dd"),q("日起(包含该日)")])])]})},{type:"custom",render:()=>V(u,{label:"流量使用量阈值",prop:"traffic","label-width":e},{default:()=>{var e;return[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:l.value.traffic,"onUpdate:modelValue":e=>l.value.traffic=e},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px] !mr-[12px]",modelValue:l.value.traffic_unit,"onUpdate:modelValue":e=>l.value.traffic_unit=e,options:K},null)]),V("span",{class:"block text-small text-secondary"},["每个自然月的流量累计超过".concat(l.value.traffic).concat(null==(e=K.find(e=>e.value===l.value.traffic_unit))?void 0:e.label,"就触发告警")])]}}),rules:{traffic:[{required:!0,message:"请输入流量阈值",trigger:"blur"}]}},G("告警方式","sender",{attrs:{class:"!w-24rem",limit:["sms"],labelWidth:e},rules:{sender:[{required:!0,message:"请选择告警方式",trigger:"blur"}]}}),{type:"custom",render:()=>V(u,{label:"发送次数",prop:"total","label-width":e},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"0",modelValue:l.value.total,"onUpdate:modelValue":e=>l.value.total=e},{append:"次"}),V("span",{class:"text-small text-secondary ml-[12px]"},[q("后将不再发送告警信息，无需限制次数可填0次表示不限制")])])]}),rules:{total:[{required:!0,message:"请输入发送次数",trigger:"blur"}]}}]),submit:async(e,l)=>(await l(),await ee(e.value))});n({title:"添加流量使用提醒",area:60,component:()=>V("div",{class:"p-[2rem]"},[V(l,null,null)]),showFooter:!0,onConfirm:a})};return v(()=>{O()}),(e,l)=>{const a=i,t=c,s=W,r=z,u=N,n=m,o=y("bt-loading");return b(),_("div",null,[x(Q)?(b(),g(s,{key:0,showConfig:{width:"44rem"}},{content:w(()=>[h("div",se,[V(a,{icon:"el-warning",color:"#fc6d26",size:18}),h("div",re,[x(R).total_status?j("",!0):(b(),_("span",ue,[l[2]||(l[2]=q(" 当前尚未安装监控报表插件 ",-1)),V(t,{onClick:l[0]||(l[0]=e=>x(S)("install")),class:"!text-small ml-4px"},{default:w(()=>[...l[1]||(l[1]=[q("点击安装",-1)])]),_:1})]))])])]),_:1})):j("",!0),h("div",null,[k((b(),_("div",ne,[h("div",oe,[l[3]||(l[3]=h("span",null,"当前流量",-1)),h("span",null,C(x(X).traffic),1)]),V(r,{direction:"vertical"}),h("div",ie,[l[4]||(l[4]=h("span",null,"当前请求数",-1)),h("span",null,C(x(X).request),1)])])),[[o,x(T)]]),V(u,null,{"header-left":w(()=>[V(x(U),{type:"primary",onClick:D},{default:w(()=>[...l[5]||(l[5]=[q("添加动态检查告警",-1)])]),_:1}),V(x(U),{onClick:H},{default:w(()=>[...l[6]||(l[6]=[q("添加流量使用提醒",-1)])]),_:1})]),content:w(()=>[V(x(L),{"max-height":400})]),_:1}),V(n,{options:[{content:"流量限额可设置多条规则，统计周期产生的流量/请求超过限额会告警"}]})])])}}}),me=p({__name:"index",setup(e){var l;const{siteInfo:a}=I(),t=L((null==(l=a.value)?void 0:l.tabName)||"flowLimit");return v(()=>{ae()}),(e,l)=>{const a=H,s=d;return b(),g(s,{type:"card",modelValue:x(t),"onUpdate:modelValue":l[0]||(l[0]=e=>D(t)?t.value=e:null)},{default:w(()=>[V(a,{label:"流量限制",name:"flowLimit"},{default:w(()=>[V(M)]),_:1}),V(a,{label:"流量限额",name:"flowQuota",lazy:!0},{default:w(()=>[V(ce)]),_:1})]),_:1},8,["modelValue"])}}});export{me as default};
