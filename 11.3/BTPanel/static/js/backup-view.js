import{_ as e}from"./index109.js?v=1763689792";import{aQ as a,V as l,x as s,Q as t,jj as o,jk as n,p as i,jl as u,jm as r,l as c,j as d,b as p}from"./utils-lib.js?v=1763689792";import{c as m,r as f,o as _,W as b,e as k,v,I as w,x as h,y,C as g,D as j,J as z,z as V,R as C,A as x,S as q,K as D,B as F,O as R,G as U,H,b4 as I,ad as Q,V as S,ab as A}from"./base-lib.js?v=1763689792";import{d as B,u as G}from"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const J={class:"p-2rem"},K={class:"p-[2rem]"},L={class:"flex items-center"},N=m({__name:"backup-view",props:{compData:{default:()=>{}}},setup(m){const N=m,{refs:{isRefreshInstallList:O}}=a(),W={"x-http-token":window.vite_public_request_token},$=f(!1),E=f(null),M=f(null),P=window.location.protocol+"//"+window.location.host+"/mod/docker/com/upload_backup",T=_({id:N.compData.id,restore_backup:!1,backup:!1,f_size:0,f_path:"/www/dk_project/backup/apps",f_name:"",f_start:0}),{id:X}=N.compData,Y=f(!1),Z=p(),ee=b([]),ae=b(!1),le=async()=>{t({request:o({id:X}),loading:ae,success:e=>{ee.value=e.data.data}})},se=async()=>{t({request:n({id:X}),loading:"正在备份中，请稍后...",message:!0,success:le})},te=async()=>{var e;if(T.f_name)return Y.value=Z.load("正在上传中，请稍后..."),await(null==(e=E.value)?void 0:e.submit()),!1;Z.error("请选择文件")},oe=e=>{var a;Z.request(e),$.value=!1,T.f_name="",le(),null==(a=Y.value)||a.close(),e.status&&($.value=!1)},ne=e=>{T.f_size=e.size,T.f_name=e.name},ie=()=>{var e;Z.error("导入失败"),T.f_name="",null==(e=Y.value)||e.close(),le()},ue=()=>{M.value.$el.click()},re=()=>{var e;null==(e=E.value)||e.clearFiles(),$.value=!1,T.f_name="",T.restore_backup=!1},ce=[{label:"备份名称",prop:"file_name",width:160},{label:"类型",render:e=>k("span",null,["local"===e.backup_type?"本地":e.backup_type])},{label:"备份时间",width:140,render:e=>k("span",null,[l(Number(e.backup_time))])},B({prop:"backup_path",label:"备份目录"}),{label:"大小",render:e=>k("span",null,[s(e.size)])},G([{title:"恢复",onClick:async e=>{await i({content:"恢复备份将会覆盖已有数据，是否继续？",title:"恢复备份-"+e.file_name,icon:"warning-filled",type:"check",check:{content:"备份覆盖前的数据",onConfirm:async a=>{await t({request:r({id:X,file_name:e.file_name,backup:a}),loading:"正在恢复中，请稍后...",message:!0}),le(),O.value=!0}}})}},{title:"下载",onClick:async e=>{window.open("/download?filename="+e.backup_path+"/"+e.file_name,"_blank","noopener,noreferrer")}},{title:"删除",onClick:async e=>{await i({content:"即将删除备份文件，是否继续？",title:"删除备份-"+e.file_name,icon:"warning-filled"}),t({request:u({id:X,file_name:e.file_name}),loading:"正在删除中，请稍后...",message:!0,success:le})}}])];return v(le),(a,l)=>{const s=H,t=c,o=I,n=Q,i=S,u=A,r=d,p=e,m=w("bt-loading");return h(),y("div",J,[k(p,null,{"header-left":g(()=>[k(s,{type:"primary",onClick:se},{default:g(()=>[...l[5]||(l[5]=[j("点击备份",-1)])]),_:1}),k(s,{onClick:l[0]||(l[0]=e=>$.value=!0)},{default:g(()=>[...l[6]||(l[6]=[j("上传备份",-1)])]),_:1})]),content:g(()=>[z(k(t,{column:ce,data:V(ee),"max-height":500},null,8,["data"]),[[m,V(ae)]])]),popup:g(()=>[k(r,{title:"上传文件",modelValue:V($),"onUpdate:modelValue":l[4]||(l[4]=e=>C($)?$.value=e:null),area:50,onConfirm:te,onCancel:re,showFooter:""},{default:g(()=>[x("div",K,[k(u,{ref:"cmdFormRef",size:"default",model:V(T),class:"relative w-full","label-position":"right",onSubmit:l[3]||(l[3]=q(()=>{},["prevent"]))},{default:g(()=>[k(n,{prop:"dep_zip",label:"上传文件"},{default:g(()=>[x("div",L,[k(o,{class:"upload-demo h-[0] w-[0]",ref_key:"upload",ref:E,name:"blob",data:V(T),action:P,headers:W,accept:".zip,.gz,.tar","show-file-list":!1,"on-error":ie,multiple:!1,"auto-upload":!1,"on-success":oe,"on-change":ne},{default:g(()=>[z(k(s,{ref_key:"open",ref:M,size:"default",type:"default"},{default:g(()=>[...l[7]||(l[7]=[j(" 选择文件 ",-1)])]),_:1},512),[[D,!1]])]),_:1},8,["data"]),k(s,{title:"导入项目",size:"default",class:"!mr-[.5rem]",onClick:ue},{default:g(()=>[...l[8]||(l[8]=[j(" 选择文件 ",-1)])]),_:1}),x("span",null,F(V(T).f_name||"未选择"),1)])]),_:1}),k(n,{label:" "},{default:g(()=>[k(i,{modelValue:V(T).restore_backup,"onUpdate:modelValue":l[1]||(l[1]=e=>V(T).restore_backup=e)},{default:g(()=>[...l[9]||(l[9]=[j(" 是否立即导入备份文件 ",-1)])]),_:1},8,["modelValue"])]),_:1}),V(T).restore_backup?(h(),R(n,{key:0,label:" "},{default:g(()=>[k(i,{modelValue:V(T).backup,"onUpdate:modelValue":l[2]||(l[2]=e=>V(T).backup=e)},{default:g(()=>[...l[10]||(l[10]=[j(" 是否备份覆盖前的数据 ",-1)])]),_:1},8,["modelValue"])]),_:1})):U("",!0),l[11]||(l[11]=x("ul",{class:"mt-[.8rem] leading-8 text-small list-disc ml-[2rem]"},[x("li",null,"立即导入备份文件将覆盖现有文件数据，请做好相关数据备份")],-1))]),_:1},8,["model"])])]),_:1},8,["modelValue"])]),_:1})])}}});export{N as default};
