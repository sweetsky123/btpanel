import{r as e,o as a,c as l,v as s,x as t,y as r,A as o,e as u,C as n,z as i,D as m,B as d,O as p,G as c,F as g,V as v,aA as _,b2 as b,ak as y,aj as f,ad as h,H as V,ab as w}from"./base-lib.js?v=1763689792";import{x,p as z,Q as B,b as N,k as j}from"./utils-lib.js?v=1763689792";import{Q as k,R as C,S as U}from"./useController3.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const E=N(),S=e(),q=e({status:!1,num:180,compress:!1,log_size:10,stype:"day",hour:2,minute:0}),M=e("开启后默认每天 2 点 0 分进行切割日志文件，如需修改下面配置"),I=a({num:[{validator:(e,a,l)=>{const s="日志保留最新份必须大于0",t="请输入整数";""===a?l(new Error("请输入日志保留最新份")):isNaN(a)||Number(a)<1?l(new Error(s)):Number.isInteger(Number(a))?l():l(new Error(t))},trigger:"blur"}],log_size:[{required:!0,message:"请输入日志大小",trigger:"blur"},{validator:(e,a,l)=>{!/^\d+(\.\d+)?$/.test(a)||a<=0?l(new Error("请输入大于0的数")):l()},trigger:["blur","change"]}],hour:[{required:!0,message:"请输入小时",trigger:"blur"},{validator:(e,a,l)=>{a<0||a>23||!Number.isInteger(Number(a))?l(new Error("请输入0-23之间的整数")):l()},trigger:["blur","change"]}],minute:[{required:!0,message:"请输入分钟",trigger:"blur"},{validator:(e,a,l)=>{a<0||a>59||!Number.isInteger(Number(a))?l(new Error("请输入0-59之间的整数")):l()},trigger:["blur","change"]}]}),A=async()=>{try{const e=await k(),{status:a,log_size:l}=e.data.value;q.value=e.data.value,q.value.status=Boolean(a),q.value.log_size=l?x(l,!1,2,"MB"):"10.00",M.value="开启后".concat("size"===q.value.stype?"日志文件大小超过":"默认每天").concat("size"===q.value.stype?q.value.log_size+"MB":" ".concat(q.value.hour," 点 ").concat(q.value.minute," 分"),"进行切割日志文件，如需修改下面配置")}catch(e){}},H=async e=>{q.value.status=!e,await z({title:"设置日志切割任务",content:(e?"开启后":"关闭后停止")+"对计划任务日志进行切割，是否继续操作？"}),await B({loading:"正在设置，请稍后...",request:C(),message:!0,success:A})},Q=()=>{var e,a;M.value="开启后".concat("size"===q.value.stype?"日志文件大小超过 ":"默认每天 ").concat("size"===q.value.stype?q.value.log_size+" MB ":"".concat((null==(e=q.value.hour)?void 0:e.toString())||"-"," 点 ").concat((null==(a=q.value.minute)?void 0:a.toString())||"-"," 分"),"进行切割日志文件，如需修改下面配置")},R=e=>e<10?"0".concat(e):"".concat(e),D=async()=>{await S.value.validate();const{stype:e,log_size:a}=q.value;if("size"===e&&a<=0)return void E.error("日志大小必须大于0");let l={...q.value};l.status=Number(q.value.status),l.compress=Number(q.value.compress),"day"===l.stype&&(l.log_size=0),await B({loading:"正在设置，请稍后...",request:U(l),message:!0}),A()},F={class:"p-[20px]"},G={class:"mt-[16px] flex items-center"},O={class:"ml-[8px]"},$={class:"py-[20px]"},J={class:"flex items-center"},K={class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},L={key:0},P=l({__name:"index",setup:(e,{expose:a})=>(a({onConfirm:D}),s(()=>A()),(e,a)=>{var l;const s=v,x=_,z=b,B=y,N=f,k=h,C=j,U=V,E=w;return t(),r("div",F,[o("div",G,[u(x,{placement:"bottom",width:"200","popper-class":"green-tips-popover",trigger:"hover"},{reference:n(()=>[u(s,{modelValue:i(q).status,"onUpdate:modelValue":a[0]||(a[0]=e=>i(q).status=e),onChange:i(H)},{default:n(()=>[...a[7]||(a[7]=[m("日志切割",-1)])]),_:1},8,["modelValue","onChange"])]),default:n(()=>[a[8]||(a[8]=o("span",{class:"p-[8px] inline-block"},"当日志文件过大时，读取和搜索时间会增加，同时也会占用存储空间，因此需要对日志进行切割以方便管理和维护。",-1))]),_:1}),o("span",O,d(i(M)),1)]),u(z),o("div",$,[u(E,{ref_key:"logSplitRef",ref:S,model:i(q),rules:i(I),class:"-ml-3rem"},{default:n(()=>[u(k,{label:"切割方式"},{default:n(()=>[u(N,{modelValue:i(q).stype,"onUpdate:modelValue":a[1]||(a[1]=e=>i(q).stype=e),onChange:i(Q)},{default:n(()=>[u(B,{value:"size"},{default:n(()=>[...a[9]||(a[9]=[m("按日志大小",-1)])]),_:1}),u(B,{value:"day"},{default:n(()=>[...a[10]||(a[10]=[m("按执行周期",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1}),"day"==i(q).stype?(t(),p(k,{key:0,label:"执行时间"},{default:n(()=>[o("div",J,[u(k,{label:"",prop:"hour"},{default:n(()=>[u(C,{onBlur:i(Q),type:"number",width:"18.6rem",modelValue:i(q).hour,"onUpdate:modelValue":a[2]||(a[2]=e=>i(q).hour=e),min:"0",max:"23"},{prepend:n(()=>[...a[11]||(a[11]=[m("每天",-1)])]),append:n(()=>[...a[12]||(a[12]=[m("时",-1)])]),_:1},8,["onBlur","modelValue"])]),_:1}),u(k,{label:"",prop:"minute",class:"!mt-0"},{default:n(()=>[u(C,{type:"number",width:"12rem",min:"0",onBlur:i(Q),max:"59",modelValue:i(q).minute,"onUpdate:modelValue":a[3]||(a[3]=e=>i(q).minute=e)},{append:n(()=>[...a[13]||(a[13]=[m("分",-1)])]),_:1},8,["onBlur","modelValue"])]),_:1})])]),_:1})):"size"==i(q).stype?(t(),p(k,{key:1,label:"日志大小",prop:"log_size"},{default:n(()=>[u(C,{onBlur:i(Q),type:"number",width:"16rem",modelValue:i(q).log_size,"onUpdate:modelValue":a[4]||(a[4]=e=>i(q).log_size=e)},{append:n(()=>[...a[14]||(a[14]=[m("MB",-1)])]),_:1},8,["onBlur","modelValue"])]),_:1})):c("",!0),u(k,{label:"保留最新",prop:"num"},{default:n(()=>[u(C,{type:"number",modelValue:i(q).num,"onUpdate:modelValue":a[5]||(a[5]=e=>i(q).num=e),min:1,width:"14rem"},{append:n(()=>[...a[15]||(a[15]=[m("份",-1)])]),_:1},8,["modelValue"])]),_:1}),u(k,{label:" "},{default:n(()=>[u(s,{modelValue:i(q).compress,"onUpdate:modelValue":a[6]||(a[6]=e=>i(q).compress=e)},{default:n(()=>[...a[16]||(a[16]=[m("切割后压缩日志",-1)])]),_:1},8,["modelValue"])]),_:1}),u(k,{label:" "},{default:n(()=>[u(U,{type:"primary",onClick:i(D)},{default:n(()=>[...a[17]||(a[17]=[m("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"]),o("ul",K,["day"===i(q).stype?(t(),r("li",L," 每天的 "+d((null==(l=i(q).hour)?void 0:l.toString())?i(R)(i(q).hour):"--")+":"+d(i(q).minute.toString()?i(R)(i(q).minute):"--")+" 执行一次， 被切割后日志将会被清空 ",1)):(t(),r(g,{key:1},[a[18]||(a[18]=o("li",null,"每5分钟执行一次， 被切割后日志将会被清空",-1)),a[19]||(a[19]=o("li",null,"【日志大小】：日志文件大小超过指定大小时进行切割日志文件",-1))],64)),a[20]||(a[20]=o("li",null,"【保留最新】：保留最新的日志文件，超过指定数量时，将自动删除旧的日志文件",-1)),a[21]||(a[21]=o("li",null,"该功能开启后会对计划任务在/www/server/cron目录下产生的日志(.log格式)进行切割",-1))])])])})});export{P as default};
