!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function u(t,o,i,a){var u=o&&o.prototype instanceof s?o:s,c=Object.create(u.prototype);return r(c,"_invoke",function(t,r,o){var i,a,u,s=0,c=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,a=0,u=e,d.n=r,l}};function p(t,r){for(a=t,u=r,n=0;!f&&s&&!o&&n<c.length;n++){var o,i=c[n],p=d.p,v=i[2];t>3?(o=v===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(a=0,d.v=r,d.n=i[1]):p<v&&(o=t<3||i[0]>r||r>v)&&(i[4]=t,i[5]=r,d.n=v,a=0))}if(o||t>1)return l;throw f=!0,r}return function(o,c,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===c&&p(c,v),a=c,u=v;(n=a<2?e:u)||!f;){i||(a?a<3?(a>1&&(d.n=-1),p(a,u)):d.n=u:d.v=u);try{if(s=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((n=(f=d.n<0)?u:t.call(r,d))!==l)break}catch(n){i=e,a=1,u=n}finally{s=1}}return{value:n,done:f}}}(t,i,a),!0),c}var l={};function s(){}function c(){}function f(){}n=Object.getPrototypeOf;var d=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),p=f.prototype=s.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=f,r(p,"constructor",f),r(f,"constructor",c),c.displayName="GeneratorFunction",r(f,a,"GeneratorFunction"),r(p),r(p,a,"Generator"),r(p,i,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:u,m:v}})()}function r(e,t,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,t,n,o){function a(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},r(e,t,n,o)}function n(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}System.register(["./base-lib-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./index-legacy68.js?v=1763689792","./form-item-legacy.js?v=1763689792","./useController-legacy12.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./column-legacy.js?v=1763689792","./index-legacy110.js?v=1763689792","./useController-legacy6.js?v=1763689792","./site-legacy.js?v=1763689792","./validator-legacy.js?v=1763689792","./index-legacy107.js?v=1763689792","./useStore-legacy4.js?v=1763689792"],function(e,r){"use strict";var o,a,u,l,s,c,f,d,p,v,y,m,g,b,_,j,h,w,O,x,P,S,k,T,E,q,C,G,I,R,D;return{setters:[function(e){o=e.c,a=e.r,u=e.g,l=e.J,s=e.I,c=e.e,f=e.D,d=e.ag,p=e.V,v=e.aT,y=e.aZ,m=e.U,g=e.H,b=e.a8,_=e.x,j=e.y,h=e.z,w=e.i},function(e){O=e.L,x=e.aq,P=e.y,S=e.M,k=e.l9,T=e._},function(e){E=e.u,q=e.o},function(e){C=e.b,G=e.j,I=e.h,R=e.f},function(e){D=e.a},null,null,null,null,null,null,null,null,null],execute:function(){var r={class:"p-[2rem] master-redis-add-form"};var N=o({__name:"index",setup:function(e,o){var T,N,V=o.expose,F=E(),H=F.redisAvailableNodes,U=F.openNodesLoading,J=a(!1),L=O({data:{slave_node_ids:[]},options:function(e){return u(function(){return[C("主从名称","group_name",{attrs:{placeholder:"请输入主从复制组名称",class:"!w-[46rem]"},rules:[{required:!0,message:"主从名称不能为空",trigger:["blur","change"]}]}),G("主节点选择","master_node_id",H.value.nodes||[],{attrs:{placeholder:"请选择主节点",class:"!w-[46rem]",loading:U.value,onChange:function(t){var r=H.value.nodes.find(function(e){return e.value===t});e.value.master_ip=r.server_ip,e.value.slave_node_ids=(e.value.slave_node_ids||[]).filter(function(e){return e!==t})}},rules:[{required:!0,message:"请选择主节点",trigger:["blur","change"]}]}),C("主节点IP","master_ip",{attrs:{placeholder:"请输入主节点IP地址",class:"!w-[46rem]"},rules:[i({required:!0},x())]}),I("可用从节点",function(){var t,r;return l(c("div",{class:"slave-checkbox-list border w-full rounded p-[12px] max-h-[42rem] overflow-y-auto",style:{minHeight:U.value?"10rem":"auto"}},[!U.value&&!H.value.row.length&&c("div",{class:"text-small text-tertiary leading-[12px]"},[f("暂无可用Redis从节点，请先在前往 节点管理 -")," ",c("span",{class:"bt-link",onClick:function(){return location.href="/node/node-mgt"}},[f("添加节点")])]),c(d,{modelValue:e.value.slave_node_ids,"onUpdate:modelValue":function(t){return e.value.slave_node_ids=t}},(r=t=H.value.row.map(function(t){var r=c("span",{class:"text-small flex-1"},[t.server_ip,f(" - "),t.name]);return c("div",{class:"flex justify-between items-center mb-[8px] last:mb-0",key:t.id},[c(p,{value:t.id,class:"mr-[8px]",disabled:t.id===e.value.master_node_id||t.is_in_replication_group},{default:function(){var e;return[t.is_in_replication_group?c(v,{content:"节点已在主从组 - ".concat(null===(e=t.group_info)||void 0===e?void 0:e.group_name),placement:"top"},{default:function(){return r}}):r]}}),c("span",{class:"ml-[12px] text-small px-[8px] py-[2px] leading-[22px] rounded",style:{background:1===D(t.redis_version,"7.0.0")?"#f6ffed":"#fff7e6",color:1===D(t.redis_version,"7.0.0")?"#52c41a":"#fa8c16"}},[f("Redis "),t.redis_version])])}),"function"==typeof r||"[object Object]"===Object.prototype.toString.call(r)&&!w(r)?t:{default:function(){return[t]}}))]),[[s("bt-loading"),U.value]])},"slave_node_ids",{rules:[{required:!0,trigger:["blur","change"],validator:function(e,t,r){if(!t||0===t.length)return J.value=!1,void r(new Error("请选择主从节点"));var n=H.value.row.filter(function(e){return t.includes(e.id)}).map(function(e){return e.redis_version}),o=n.every(function(e){return e===n[0]});J.value=!o,r()}}]}),J.value&&I(" ",function(){return c(y,{"show-icon":!0,title:"警告：检测到版本不一致，建议使用相同版本的Redis节点",effect:"light",closable:!1,type:"warning"},null)}),I("Redis密码",function(){return c("div",{class:"flex items-center w-full"},[c(m,{modelValue:e.value.redis_password,"onUpdate:modelValue":function(t){return e.value.redis_password=t},placeholder:"请输入Redis密码",class:"!w-[38rem]",type:"password","show-password":!0},null),c(g,{class:"ml-[8px]",type:"default",onClick:function(){return e.value.redis_password=P(16)}},{default:function(){return[f("生成密码")]}})])},"redis_password",{rules:[{required:!0,message:"Redis密码不能为空",trigger:["blur","change"]}]}),R(" ",[{content:"设置的密码将会覆盖当前redis密码"},{content:"redis密码建议使用包含字母、数字和特殊字符的复杂密码确保安全性"},{content:"如有安全组，请执行以下两步操作"},{content:"在主节点与从节点设置本机IP为白名单，放行6379端口"},{content:"在主节点机器，设置从节点IP为白名单，放行6379端口"},{content:"只支持通过app/或api添加的节点"}])]})},submit:(T=t().m(function e(r,n,o){var a,u,l,s;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=null,e.p=1,e.n=2,n();case 2:return a=S.load("正在创建主从复制组，请稍候..."),u=i(i({},r.value),{},{slave_node_ids:JSON.stringify(r.value.slave_node_ids)}),e.n=3,k(u);case 3:return(l=e.v).data.status?(q(l.data.msg.task_id),S.success(l.data.msg.message)):S.error(l.data.msg||"创建主从复制组失败"),e.a(2,l.status);case 4:return e.p=4,e.v,e.a(2,!1);case 5:return e.p=5,null===(s=a)||void 0===s||s.close(),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}),N=function(){var e=this,t=arguments;return new Promise(function(r,o){var i=T.apply(e,t);function a(e){n(i,r,o,a,u,"next",e)}function u(e){n(i,r,o,a,u,"throw",e)}a(void 0)})},function(e,t,r){return N.apply(this,arguments)})}),z=L.BtForm;L.param;return V({onConfirm:L.submit}),b(function(){H.value={row:[],nodes:[]},U.value=!0}),function(e,t){return _(),j("div",r,[c(h(z))])}}});e("default",T(N,[["__scopeId","data-v-2cb6efdc"]]))}}})}();
