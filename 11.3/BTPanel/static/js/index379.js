import{c as a,g as e,e as l,D as s,H as t,J as i,I as r,az as o,ax as n,aT as d,b2 as p,a8 as u,x as c,y as m,A as v,z as f}from"./base-lib.js?v=1763689792";import{M as x,h8 as g,n as _,H as b,p as h,Q as y,h9 as w,la as j,lb as k,h6 as L,L as C,_ as R}from"./utils-lib.js?v=1763689792";import{h as D}from"./form-item.js?v=1763689792";import{u as I,h as T,f as q}from"./index68.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index109.js?v=1763689792";import"./column.js?v=1763689792";import"./useController6.js?v=1763689792";import"./site.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore4.js?v=1763689792";const{redisGroupDetail:S,isRedisRefreshList:z}=I(),H=async a=>{const{row:e,slaveListLoad:l,api:s,loadingText:t,needConfirm:i,confirmOptions:r}=a,o=e.data.node_id,n=S.value.group_info.group_id;try{i&&r&&await h(r),await y({loading:t,request:s({group_id:n,slave_node_id:o}),message:!0,success:async a=>{l.value=!0;const{data:e}=await w({group_id:n});S.value.slave_details=e.data.slave_details,l.value=!1,z.value=!0}})}catch(d){}},O={class:"p-[2rem] redis-mgt-group-page"},P=R(a({__name:"index",setup(a){const{redisGroupDetail:h,slaveListLoad:y}=I(),w=e(()=>{var a,e,t,i,r,o,n;const d=(null==(e=null==(a=h.value)?void 0:a.master_detail)?void 0:e.data)||{},p=d.memory||{},u=d.performance||{},c=l("span",{class:"text-tertiary"},[s("...")]);return[{label:"节点地址",value:null!=(t=d.address)?t:c},{label:"Redis版本",value:null!=(i=d.redis_version)?i:c},{label:"运行天数",value:L(d.uptime_days)?c:d.uptime_days+"天"},{label:"内存使用",value:null!=(r=p.used_memory_human)?r:c},{label:"当前QPS",value:null!=(o=u.qps)?o:c},{label:"连接数",value:null!=(n=d.connected_slaves)?n:c}]}),{BtForm:R}=C({data:h.value,options:a=>e(()=>[D("",()=>l("div",{class:"w-full mb-[32px]"},[l("div",{class:"flex items-center mb-[20px]"},[l("span",{class:"text-base mr-[1rem]"},[s("基本信息")]),l(t,{disabled:y.value,type:"default",class:"!h-[28px] !text-small",onClick:()=>T(h,"master")},{default:()=>[s("查看详细信息")]})]),l("div",{class:"grid grid-cols-2 gap-x-[24px] gap-y-[12px] text-secondary"},[w.value.map(a=>l("div",{class:"flex justify-between items-center bg-lighter rounded-medium px-[16px] py-[8px]"},[l("span",{class:"font-bold w-[90px] flex-shrink-0"},[a.label]),l("span",{class:"flex-1 text-right"},[a.value])]))])]),"base_info"),D("",()=>{var a;return l("div",{class:"w-full"},[l("div",{class:"flex items-center mb-[12px]"},[l("span",{class:"text-base"},[s("从节点列表")]),l(t,{type:"primary",class:"ml-auto !h-[28px] !px-[12px] !text-small",onClick:()=>(async a=>{var e;const l=null==(e=a.group_info)?void 0:e.group_id,s=x.load("正在获取可用从节点，请稍后...");try{const{data:a}=await g();a.status||x.error(a.msg||"获取可用节点数据失败！");const e=a.data.filter(a=>null===a.group_info);_({title:"添加从节点",area:50,btn:["添加从节点","取消"],component:()=>b(()=>import("./add-slave-node.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{group_id:l,nodes:e||[]}})}catch(t){}finally{null==s||s.close()}})(h.value)},{default:()=>[s("添加从节点")]})]),i(l(o,{data:h.value.slave_details,"table-layout":"auto",height:(null==(a=h.value.slave_details)?void 0:a.length)>10?"40rem":"auto",class:"w-full"},{default:()=>[l(n,{prop:"server_ip",label:"地址","min-width":"140"},{default:({row:a})=>l("span",{class:"text-small"},[a.data.server_ip])}),l(n,{prop:"status",label:"状态",width:"80"},{default:({row:a})=>"online"===a.data.status?l("span",{class:"bg-[var(--el-color-success-light-8)] text-primary px-[8px] py-[2px] rounded"},[s("在线")]):l("span",{class:"bg-light text-danger cursor-pointer px-[8px] py-[2px] rounded"},[s("离线"),l(d,{content:a.data.replication.error,placement:"top"},{default:()=>[l("span",{class:"ml-4px bt-ico-ask"},[s("?")])]})])}),l(n,{prop:"health_score",label:"健康度",width:"80"},{default:({row:a})=>{const e=a.data.health_score||0,t="online"===a.data.status;return l("span",{style:{display:"inline-flex",alignItems:"center"}},[l("span",{style:{display:"inline-flex",justifyContent:"center",alignItems:"center",width:"40px",height:"40px",borderRadius:"50%",background:t?"var(--el-color-primary)":"var(--el-color-danger)",color:"var(--el-color-white)",fontWeight:700,fontSize:"12px",marginRight:"4px",transition:"background 0.2s"}},[e,s("%")])])}}),l(n,{prop:"memory",label:"内存",width:"60"},{default:({row:a})=>q(a.data.memory.usage_percent)}),l(n,{prop:"qps",label:"QPS",width:"80"},{default:({row:a})=>a.data.performance.qps||"--"}),l(n,{prop:"lag",label:"延迟（秒）",width:"80"},{default:({row:a})=>a.data.replication.lag||"--"}),l(n,{prop:"delay",label:"偏移量",width:"80"},{default:({row:a})=>a.data.replication.repl_offset||"--"}),l(n,{align:"right",label:"操作",width:"140"},{default:({$index:a,row:e})=>l("div",{class:"flex items-center justify-end"},["offline"===e.data.status&&l("span",null,[l("span",{class:"bt-link",onClick:()=>((a,e)=>H({row:a,slaveListLoad:e,api:k,loadingText:"正在重连，请稍后..."}))(e,y)},[s("重启")]),l(p,{direction:"vertical"},null)]),l("span",{class:"bt-link",onClick:()=>T(e,"slave")},[s("详情")]),"online"===e.data.status&&l("span",null,[l(p,{direction:"vertical"},null),l("span",{class:"bt-link",onClick:()=>((a,e)=>H({row:a,slaveListLoad:e,api:j,loadingText:"正在移除从节点，请稍后...",needConfirm:!0,confirmOptions:{icon:"warning-filled",title:"移除从节点",content:"即将移除该从节点，是否继续操作？"}}))(e,y)},[s("移除")])])])})]}),[[r("bt-loading"),y.value]])])},"slave_table")])});return u(()=>{h.value={},y.value=!0}),(a,e)=>(c(),m("div",O,[v("div",null,[l(f(R))])]))}}),[["__scopeId","data-v-f6121d5a"]]);export{P as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
