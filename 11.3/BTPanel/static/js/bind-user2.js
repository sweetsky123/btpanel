import{c as e,z as a,r as t,o as l,v as s,x as r,O as n,C as o,J as i,K as d,A as c,e as u,B as p,L as m,Q as v,y as f,D as w,G as g,M as h,b2 as b}from"./base-lib.js?v=1763689792";import{_ as y}from"./bt_logo_new.js?v=1763689792";import{s as x,f as k,t as _,h as D,i as V}from"./api2.js?v=1763689792";import{_ as j}from"./utils-lib.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const E={class:"flex !justify-center !w-full items-center"},C={class:"text-extraLarge text-default inline-block mr-2 font-bold mt-12x"},z={key:0,class:"absolute el-form-item__error"},I={class:"flex justify-end items-center text-small mt-[1rem]"},q={key:0,class:"view-con",style:{background:"var(--el-color-white)"}},B={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-primary",size:"default"},H={key:1,class:"flex justify-end items-center text-small mt-[1rem] h-[1.68rem]"},U={key:0},K={class:"more-bind"},M=j(e({__name:"bind-user",props:{compData:{default:null}},emits:["close"],setup(e,{expose:j,emit:M}){const F=e,{BtLink:L,BtDivider:O,BtImage:A,ElForm:J,ElFormItem:T,ElPopover:$,ElInput:G,ElButton:N}=a(F.compData.dependencies.components),{Message:P,isUndefined:Q,inputFocus:S,rsaEncrypt:R,useAxios:W}=a(F.compData.dependencies.hooks);x(W);const X=M,Y=t(!1),Z=t("获取验证码"),ee=l({username:"",password:"",code:""}),ae=l({username:!1,password:!1,code:!1}),te=t(""),le=t(0),se=t(),re=t(!1),ne=t(1),oe=t({username:[{validator:(e,a,t)=>{var l,s;if((null==(l=F.compData)?void 0:l.dependencies.title)&&(re.value=!1),/^1[3456789]\d{9}$/.test(a))t();else if(""===a)t(new Error("请输入宝塔官网账号"));else{if(null==(s=F.compData)?void 0:s.dependencies.title)return re.value=!0,void t(new Error(" "));t(new Error(" 请输入正确的手机号 "))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,t)=>{a.length>=8?t():t(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,t)=>{Y.value||t(),6===a.length?t():t(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ie=async()=>{await se.value.validate();const e={...ee};if(Y.value){if(!ee.code)return P.error("请输入验证码");e.token=te.value,delete e.password}else delete e.code;const a=P.load("绑定堡塔账号，请稍候 ...");try{e.username=R(e.username),e.password=R(e.password);const a=await k({...e});if(P.request(a),a.status)return window.location.reload(),void X("close");if(Q(a.data))return!1;if(!a.status&&"[]"===JSON.stringify(a.data))return P.request(a);-1===a.data.code&&(te.value=a.data.token,Y.value=!0)}catch(t){}finally{a.close()}},de=async()=>{let e;try{e=P.load("正在绑定中......");const{data:a}=await _({client:2});a.status||a.success?window.location.href="/":(e.close(),P.error(a.msg||a.res))}catch(a){null==e||e.close()}},ce=async()=>{if(!ee.username||!ee.password)return P.error("请先输入手机号和密码");ae.username=!0,ae.password=!0,(e=>{le.value&&clearInterval(le.value);const a=()=>{if(--e<=0)return clearInterval(le.value),Z.value="获取验证码",void(ae.code=!1);Z.value="重新获取验证码(".concat(e,"s)")};a(),le.value=setInterval(a,1e3),ae.code=!0})(60);const e=await D({username:ee.username,token:te.value});P.request(e)},ue=t(!1),pe=e=>{var a;ne.value=e,(null==(a=F.compData)?void 0:a.dependencies.onChangeType)&&F.compData.dependencies.onChangeType(1===e?"bind":"other")};return j({onOpen:()=>{S(se.value.$el,"username")},onCancel:()=>{se.value.clearValidate()}}),s(()=>{var e;(async()=>{try{const e=await V();e.status?(ue.value=2===e.data.client&&1===e.data.login,2===e.data.client&&1===e.data.login?pe(2):pe(1)):pe(1)}catch(e){pe(1)}})(),null==(e=se.value)||e.clearValidate()}),(t,l)=>{var s;const x=b;return r(),n(a(J),{ref_key:"bindUserInfo",ref:se,size:"medium",rules:a(oe),model:a(ee),autocomplete:"off",class:m(["bind-user-info",{"bind-form":!!(null==(s=e.compData)?void 0:s.dependencies.title)}])},{default:o(()=>{var t,s,b,k,_,D,V,j,M,F,A,J,P;return[i(c("div",null,[u(a(T),{class:"text-center !mb-5 flex justify-center"},{default:o(()=>{var t;return[c("div",E,[c("h3",C,p((null==(t=e.compData)?void 0:t.dependencies.title)||"切换宝塔官网账号"),1),u(a($),{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:o(()=>[...l[9]||(l[9]=[c("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(r(),n(a(T),{key:1,prop:"username",class:m({"!mb-[3rem]":!!(null==(t=e.compData)?void 0:t.dependencies.title)})},{default:o(()=>{var t;return[u(a(G),{modelValue:a(ee).username,"onUpdate:modelValue":l[0]||(l[0]=e=>a(ee).username=e),clearable:"",required:"",name:"username",autocomplete:"off",class:"!leading-[4rem] !h-[4rem]",placeholder:"宝塔官网账号",disabled:a(ae).username,onKeyup:l[1]||(l[1]=v(e=>ie(),["enter"]))},null,8,["modelValue","disabled"]),(null==(t=e.compData)?void 0:t.dependencies.title)&&a(re)?(r(),f("span",z,[l[11]||(l[11]=c("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),u(a(L),{class:"!text-small",href:"https://www.bt.cn/register"},{default:o(()=>[...l[10]||(l[10]=[w(" 免费注册 ",-1)])]),_:1})])):g("",!0)]}),_:1},8,["class"])),(r(),n(a(T),{key:2,prop:"password"},{default:o(()=>[u(a(G),{modelValue:a(ee).password,"onUpdate:modelValue":l[2]||(l[2]=e=>a(ee).password=e),clearable:"",required:"",type:"password",name:"password",class:"!leading-[4rem] !h-[4rem]",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:a(ae).password,onKeyup:l[3]||(l[3]=v(e=>ie(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),i(u(a(T),{prop:"code"},{default:o(()=>[u(a(G),{modelValue:a(ee).code,"onUpdate:modelValue":l[4]||(l[4]=e=>a(ee).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",type:"text",onKeyup:l[5]||(l[5]=v(e=>ie(),["enter","native"]))},{append:o(()=>[u(a(N),{class:"relative top-0 rounded-none rounded-r-base",type:"primary",size:"default",disabled:a(ae).code,plain:"",onClick:ce},{default:o(()=>[w(p(a(Z)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[d,a(Y)]]),u(a(N),{type:"primary",class:"w-[100%] mt-[1.2rem]",size:"default",onClick:l[6]||(l[6]=e=>ie())},{default:o(()=>{var a,t;return[w(p((null==(a=e.compData)?void 0:a.dependencies.btn)||((null==(t=e.compData)?void 0:t.dependencies.title)?"绑定账号":"切换账号")),1)]}),_:1}),c("div",I,[u(a(L),{href:"https://www.bt.cn/register"},{default:o(()=>[...l[12]||(l[12]=[w("注册账号",-1)])]),_:1}),u(a(O)),u(a(L),{href:"https://www.bt.cn/login.html?page=reset"},{default:o(()=>[...l[13]||(l[13]=[w("忘记密码",-1)])]),_:1}),u(a(O)),u(a(L),{href:"https://www.bt.cn/bbs"},{default:o(()=>[...l[14]||(l[14]=[w("问题反馈",-1)])]),_:1})])],512),[[d,1===a(ne)]]),i(c("div",null,[(null==(s=e.compData)?void 0:s.dependencies.title)?g("",!0):(r(),f("div",{key:0,class:"view-con",style:h((null==(b=e.compData)?void 0:b.dependencies.title)?"":"background:var(--el-color-white);")},[c("div",{class:"app-box",style:h((null==(k=e.compData)?void 0:k.dependencies.title)?"":"background:var(--el-color-white);")},[...l[15]||(l[15]=[c("img",{alt:"",src:y},null,-1)])],4),l[17]||(l[17]=c("div",{class:"change-icon"},[c("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[c("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1)),c("div",{class:"app-box",style:h((null==(_=e.compData)?void 0:_.dependencies.title)?"":"background:var(--el-color-white);")},[...l[16]||(l[16]=[c("div",{class:"ali-icon"},null,-1)])],4)],4)),c("div",{class:m({"bg-light":null==(D=e.compData)?void 0:D.dependencies.title,"rounded-base":null==(V=e.compData)?void 0:V.dependencies.title}),style:h({border:(null==(j=e.compData)?void 0:j.dependencies.title)?"1px solid #ddd":"none","padding-top":(null==(M=e.compData)?void 0:M.dependencies.title)?"2rem":"0"})},[(null==(F=e.compData)?void 0:F.dependencies.title)?(r(),f("div",q,[...l[18]||(l[18]=[c("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[c("img",{alt:"",src:y})],-1),c("div",{class:"change-icon"},[c("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[c("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"var(--el-color-text-tertiary)","p-id":"19920"})])],-1),c("div",{class:"app-box",style:{background:"var(--el-color-white)"}},[c("div",{class:"ali-icon"})],-1)])])):g("",!0),u(a(T),{class:m(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(A=e.compData)?void 0:A.dependencies.title,"!pt-0":null==(J=e.compData)?void 0:J.dependencies.title}])},{default:o(()=>[u(x),l[19]||(l[19]=c("h3",{class:"text-base w-full text-secondary inline-block font-bold"},"阿里云用户专享特权：",-1)),l[20]||(l[20]=c("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] flex items-center"},[c("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 免费使用原本需要付费的功能： ")],-1)),l[21]||(l[21]=c("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1rem] ml-[1.9rem] flex items-center"},[c("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),w(" 异常监控推送 ")],-1)),l[22]||(l[22]=c("h3",{class:"text-small leading-[1] w-full text-tertiary inline-block mt-[1.5rem] flex items-center"},[c("span",{class:"svgtofont-el-check text-primaryDark font-bold mr-[.5rem]"}),w(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"]),u(a(N),{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:de},{default:o(()=>[...l[23]||(l[23]=[w("一键激活专享特权",-1)])]),_:1}),c("div",B,[c("span",{class:"cursor-pointer hover:text-primaryDark",onClick:l[7]||(l[7]=e=>pe(1))},"已有宝塔账号登录")]),(null==(P=e.compData)?void 0:P.dependencies.title)?(r(),f("div",H)):g("",!0)],6)],512),[[d,2===a(ne)]]),1===a(ne)&&a(ue)?(r(),f("div",U,[l[25]||(l[25]=c("div",{class:"more-title"},[c("span",null,"更多绑定方式")],-1)),c("div",K,[i(c("div",{class:"bind-box",onClick:l[8]||(l[8]=e=>pe(2))},[...l[24]||(l[24]=[c("i",{class:"tencent_ico"},null,-1),w(" 阿里云账号 ",-1)])],512),[[d,1===a(ne)]])])])):g("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-5bb3719d"]]);export{M as default};
