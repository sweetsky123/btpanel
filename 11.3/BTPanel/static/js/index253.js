import{c as a,t as e,s as t,o as s,r as l,v as i,I as d,x as n,y as r,z as o,A as p,e as c,C as u,D as m,G as f,B as x,J as b,F as v,b1 as y,O as h,V as g,T as w,H as M,aT as j}from"./base-lib.js?v=1763689792";import{checkDelData as k,batchDelSite as _,deleteAsync as D,deleteSite as S}from"./site.js?v=1763689792";import{u as V,R as F,M as P,bR as z,r as L,Q as C,aK as R,x as H}from"./utils-lib.js?v=1763689792";import{h as O,i as A}from"./validator.js?v=1763689792";import{o as T}from"./useController6.js?v=1763689792";import{u as U}from"./useStore4.js?v=1763689792";import{u as I}from"./useController5.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useMethod5.js?v=1763689792";const q={class:""},J={key:0,class:"p-[20px] w-[480px]"},B={class:"flex items-center ml-[48px] mt-[12px]"},G={key:0,class:"!mt-[12px] text-danger ml-[48px]"},K={key:0},N={key:1},Q={key:2},E={class:"p-[20px] bg-base mt-[12px]"},W={class:"mx-[1rem]"},X={key:1,class:"p-[20px] w-[610px]"},Y={class:"border border-base min-h-[12rem] overflow-auto mt-[20px] mb-1rem max-h-[40rem]"},Z={class:"inline-flex items-center justify-between px-[12px] py-[8px] w-full"},$={class:"truncate w-[28%]"},aa={class:"inline-flex items-center justify-between flex-1"},ea={key:0,class:"flex item-center"},ta=["title"],sa={key:0,class:"text-danger flex items-center"},la={key:1},ia={class:"truncate !w-[180px] flex-shrink-0"},da={key:0,class:"flex items-center justify-between px-[12px] py-[8px] w-full border-t-1 border-extraLight"},na={class:"truncate w-[28%]"},ra={class:"items-center inline-flex justify-between flex-1"},oa={class:"truncate mr-12px flex items-center"},pa={class:"truncate !w-[180px] flex-shrink-0"},ca={key:0},ua={class:"text-danger bold"},ma={key:1,class:"text-danger"},fa={class:"bg-light footer-btn flex items-center justify-end p-[12px] w-full"},xa=a({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(a,{emit:xa}){const ba=a,{panel:va}=V(),{isFileRecycle:ya,isDbRecycle:ha}=e(va.value),{isRefreshList:ga,batchConfig:wa}=U(),{isRefreshLocalList:Ma}=t(I()),ja=xa,ka=s({addend1:Math.round(9*Math.random()+1),addend2:Math.round(9*Math.random()+1),sum:void 0,steps:1,isFtp:!1,isDatabase:!1,isSite:!1,data:{},isMult:!1,fileSize:0,dbSize:0}),_a=()=>{ja("close"),ka.steps=1,ka.addend1=Math.round(9*Math.random()+1),ka.addend2=Math.round(9*Math.random()+1),ka.sum=void 0,ka.isFtp=!1,ka.isDatabase=!1,ka.isSite=!1},Da=l(!1),Sa=l(5),Va=async()=>{var a,e;if(ka.sum===ka.addend1+ka.addend2){let s;if(ka.isFtp||ka.isDatabase||ka.isSite){try{let t;ka.data.hasOwnProperty("id")?t=[ka.data.id]:(t=null==(a=ka.data)?void 0:a.map(a=>a.id),ka.isMult=!0),s=P.load("正在检查要删除的数据,请稍后...");const l=await k({ids:JSON.stringify(t)}),i=null==(e=z(l.data.data,"array",[]))?void 0:e.map(a=>{var e,t,s,l;return"PHPMOD"===(Array.isArray(ka.data)?null==(t=null==(e=ka.data.find(e=>e.id===a.id))?void 0:e.project_config)?void 0:t.type:(null==(l=null==(s=ka.data)?void 0:s.project_config)?void 0:l.type)||ka.data.project_type)?{...a,project_config:{type:"PHPMOD"}}:a});ka.data=i,ka.fileSize=l.data.file_size,ka.dbSize=l.data.db_size}catch(t){}finally{null==s||s.close()}ka.steps=2,ka.addend1=Math.round(9*Math.random()+1),ka.addend2=Math.round(9*Math.random()+1),ka.sum=void 0}else Array.isArray(ka.data)||(ka.data=[ka.data]),await Pa(),ka.addend1=Math.round(9*Math.random()+1),ka.addend2=Math.round(9*Math.random()+1),ka.sum=void 0;(()=>{Da.value=!0,Sa.value=5;const a=setInterval(()=>{Sa.value-=1,Sa.value<=0&&(clearInterval(a),Da.value=!1)},1e3)})()}else P.error("计算错误，请重新计算")},Fa=async(a,e,t)=>{var s;const l=ka.data[e],i=(null==(s=l.project_config)?void 0:s.type)||l.project_type;let d={id:l.id,webname:l.name,ftp:ka.isFtp?1:0,database:ka.isDatabase?1:0,path:ka.isSite?1:0};ka.isFtp||delete d.ftp,ka.isDatabase||delete d.database,ka.isSite||delete d.path;const n="PHPMOD"===i?await D({id:l.id,webname:l.name}):await S(d);a.push({name:l.name,status:!0}),e===ka.data.length-1&&(ga.value=!0,Ma.value=!0,t?T({resultData:a,resultTitle:"删除结果"}):P.request(n)),e<ka.data.length-1&&Fa(a,e+1,t)},Pa=async()=>{let a=P.load("正在删除站点..."),e=[];const{fullPath:t}=L.currentRoute.value;try{if(ka.isMult&&t.includes("site")){const{enable:a,exclude:e}=wa.value,t=O(ka.data,e,a,{params:{project_type:"PHP",ftp:ka.isFtp?1:0,database:ka.isDatabase?1:0,path:ka.isSite?1:0}});C({loading:"正在删除站点,请稍后...",request:_(t),success:a=>{const{data:e}=A(a.data);T({resultData:e,title:"批量删除站点"}),ga.value=!0,Ma.value=!0}})}else await Fa(e,0,ka.isMult);a.close(),ja("close")}catch(s){R(s)}finally{ka.steps=1}},za=async()=>{1===ka.steps?ka.sum===ka.addend1+ka.addend2?(await Pa(),ja("close")):P.error("计算错误，请重新计算"):(await Pa(),ja("close"))};return i(()=>{ka.data=ba.compData,F(ba.compData)&&(ka.isMult=!0)}),(a,e)=>{const t=g,s=w,l=j,i=M,k=d("focus");return n(),r("div",q,[1===o(ka).steps?(n(),r("div",J,[e[11]||(e[11]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning-filled !text-titleLarge"}),p("span",{class:"text-base ml-[8px] leading-10"},"是否要删除关联的FTP、数据库、站点目录！")],-1)),p("div",B,[c(t,{modelValue:o(ka).isFtp,"onUpdate:modelValue":e[0]||(e[0]=a=>o(ka).isFtp=a)},{default:u(()=>[...e[4]||(e[4]=[m("FTP",-1)])]),_:1},8,["modelValue"]),c(t,{modelValue:o(ka).isDatabase,"onUpdate:modelValue":e[1]||(e[1]=a=>o(ka).isDatabase=a)},{default:u(()=>[...e[5]||(e[5]=[m("数据库",-1)])]),_:1},8,["modelValue"]),c(t,{modelValue:o(ka).isSite,"onUpdate:modelValue":e[2]||(e[2]=a=>o(ka).isSite=a)},{default:u(()=>[...e[6]||(e[6]=[m("站点目录",-1)])]),_:1},8,["modelValue"])]),o(ya)&&o(ha)?f("",!0):(n(),r("div",G,[p("span",null,[e[7]||(e[7]=m(" 当前 ",-1)),o(ya)||o(ha)?f("",!0):(n(),r("span",K,"【文件回收站】【数据库回收站】")),o(ya)&&!o(ha)?(n(),r("span",N,"【数据库回收站】")):f("",!0),!o(ya)&&o(ha)?(n(),r("span",Q,"【文件回收站】")):f("",!0),e[8]||(e[8]=m(" 尚未开启，请谨慎操作！ ",-1))])])),p("div",E,[e[9]||(e[9]=p("span",null,"计算结果：",-1)),p("span",W,x(o(ka).addend1)+" + "+x(o(ka).addend2),1),e[10]||(e[10]=p("span",{class:"mr-[1rem]"},"=",-1)),b(c(s,{modelValue:o(ka).sum,"onUpdate:modelValue":e[3]||(e[3]=a=>o(ka).sum=a),autofocus:"true","controls-position":"right",size:"small"},null,8,["modelValue"]),[[k]])])])):f("",!0),2===o(ka).steps?(n(),r("div",X,[e[20]||(e[20]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning !text-titleLarge"}),p("span",{class:"text-extraLarge ml-[8px] leading-10 font-bold"},"堡塔温馨提示您，请冷静几秒钟，确认以下要删除的数据。")],-1)),p("div",Y,[(n(!0),r(v,null,y(o(ka).data,(a,t)=>(n(),r("div",{key:t,class:"flex items-center flex-col p-[12px] border-b-1 border-extraLight hover:bg-[rgba(var(--el-file-color-light-rgb),0.4)] last:border-b-0",style:{gap:"0.4rem"}},[p("div",Z,[p("span",$,"站点名:"+x(a.name),1),p("div",aa,[o(ka).isSite?(n(),r("div",ea,[p("span",{class:"truncate w-[110px]",title:a.path},"目录:"+x(a.path),9,ta),a.total?(n(),r("span",sa,[m(" ("+x(o(H)(a.total))+") ",1),o(ka).fileSize<=a.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:u(()=>[e[12]||(e[12]=m(" 此目录较大，可能为重要数据，请谨慎操作！ ",-1)),e[13]||(e[13]=p("br",null,null,-1)),m(" 目录："+x(a.path),1)]),default:u(()=>[e[14]||(e[14]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px"},null,-1))]),_:2},1024)):f("",!0)])):f("",!0)])):f("",!0),o(ka).isSite?f("",!0):(n(),r("div",la,"仅删除记录")),p("span",ia,"创建时间:"+x(a.addtime),1)])]),a.database&&o(ka).isDatabase?(n(),r("div",da,[p("span",na,"数据库:"+x(a.database.name),1),p("div",ra,[p("span",oa,[m(" 大小:"+x(o(H)(a.database.total))+" ",1),o(ka).dbSize<=a.database.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:u(()=>[e[15]||(e[15]=m(" 此数据库较大，可能为重要数据，请谨慎操作！ ",-1)),e[16]||(e[16]=p("br",null,null,-1)),m(" 数据库："+x(a.database.name),1)]),default:u(()=>[e[17]||(e[17]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px text-dangerDark"},null,-1))]),_:2},1024)):f("",!0)]),p("span",pa,"创建时间:"+x(a.addtime),1)])])):f("",!0)]))),128))]),o(Sa)&&o(Da)?(n(),r("div",ca,[e[18]||(e[18]=m(" 请仔细阅读以上要删除信息，防止网站数据被误删，确认删除还有 ",-1)),p("span",ua,x(o(Sa)),1),e[19]||(e[19]=m(" 秒可以操作。 ",-1))])):(n(),r("div",ma,"注意：请仔细阅读以上要删除信息，防止网站数据被误删"))])):f("",!0),p("div",fa,[c(i,{type:"warning",onClick:_a},{default:u(()=>[...e[21]||(e[21]=[m("取消",-1)])]),_:1}),1===o(ka).steps?(n(),h(i,{key:0,type:"danger",onClick:Va},{default:u(()=>[...e[22]||(e[22]=[m("下一步",-1)])]),_:1})):f("",!0),2===o(ka).steps?(n(),h(i,{key:1,type:"danger",disabled:o(Da),onClick:za},{default:u(()=>[m(x(o(Sa)&&o(Da)?"等待".concat(o(Sa),"秒"):"确认删除数据"),1)]),_:1},8,["disabled"])):f("",!0)])])}}});export{xa as default};
