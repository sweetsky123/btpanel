import{c as e,r as l,aB as a,g as t,w as o,x as s,O as r,C as n,e as d,A as u,z as c,y as i,b1 as p,F as m,D as _,G as v,B as f,R as w,m as g,an as j,ad as y,aT as b,V as x,aA as h,am as V,M as k,H as U,L as C,ap as D}from"./base-lib.js?v=1763689792";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1763689792";import{L as N,k as O,cf as q,Q as B,bR as F,d as M,N as R,e as W,hv as z,ho as P}from"./utils-lib.js?v=1763689792";import{_ as S}from"./index107.js?v=1763689792";import{u as A}from"./useStore4.js?v=1763689792";import{f as E}from"./validator.js?v=1763689792";import{n as L,g as G,i as H,o as J,u as Q,s as T}from"./index76.js?v=1763689792";import{checkPathStatus as $,getRunList as K}from"./site.js?v=1763689792";import{B as X}from"./index119.js?v=1763689792";const Y={class:"flex items-center"},Z={class:"flex items-center"},ee={key:0,class:"text-small ml-[0.8rem] text-tertiary"},le={key:0,class:"text-danger text-small"},ae=e({__name:"advanced-config",props:{ps:{},rowData:{}},setup(e,{expose:k}){var U;const C=e,D=l(),I=l((null==(U=C.rowData)?void 0:U.project_name)||!1),q=l(!1),B=a("nodeData",{user_list:[]}),{BtForm:F,param:M}=N({data:()=>{var e,l,a,t,o;const s=(null==(l=null==(e=B.value)?void 0:e.user_list)?void 0:l.length)&&-1===(null==(a=B.value.user_list)?void 0:a.findIndex(e=>"www"===e));return{run_user:I.value?(null==(t=C.rowData)?void 0:t.run_user)||"":s?B.value.user_list[0]:"www",port:(null==(o=C.rowData)?void 0:o.port)||"",release_firewall:!1,project_ps:(null==C?void 0:C.ps)||"",domains:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{run_user:[{required:!0,message:"请选择运行用户",trigger:"change"}]}}])});return o(()=>C.ps,e=>{M.value.project_ps=e||""},{immediate:!0}),k({formData:M,popover:D}),(e,l)=>{const a=V,t=j,o=y,k=O,U=b,N=x,R=h;return s(),r(c(F),g({class:"mt-2rem"},e.$attrs),{custom:n(()=>[d(o,{label:"运行用户",prop:"run_user"},{default:n(()=>[u("div",Y,[d(t,{modelValue:c(M).run_user,"onUpdate:modelValue":l[0]||(l[0]=e=>c(M).run_user=e),class:"mr-8px !w-[16rem]"},{default:n(()=>[(s(!0),i(m,null,p(c(B).user_list,(e,l)=>(s(),r(a,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[7]||(l[7]=u("span",{class:"text-small text-secondary"},"* 无特殊需求请选择www用户",-1))])]),_:1}),d(o,{label:"项目端口"},{default:n(()=>{var e,a,t,o,p,w;return[u("div",Z,[d(k,{width:"20rem",type:"number",class:"mr-12px !w-[20rem]",min:1,max:65535,modelValue:c(M).port,"onUpdate:modelValue":l[1]||(l[1]=e=>c(M).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),c(I)?v("",!0):(s(),i(m,{key:0},[""===c(M).port?(s(),i("span",ee,"* 若不清楚端口可不填写")):(s(),r(N,{key:1,modelValue:c(M).release_firewall,"onUpdate:modelValue":l[2]||(l[2]=e=>c(M).release_firewall=e)},{default:n(()=>[l[9]||(l[9]=_(" 放行端口 ",-1)),d(U,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:n(()=>[...l[8]||(l[8]=[u("i",{class:"svgtofont-el-question text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))],64))]),c(I)&&(null==(a=null==(e=C.rowData)?void 0:e.listen)?void 0:a.length)&&!(null==(o=null==(t=C.rowData)?void 0:t.listen)?void 0:o.includes(c(M).port))?(s(),i("span",le," 项目端口可能有误，检测到当前项目监听了以下端口[ "+f(null==(w=null==(p=C.rowData)?void 0:p.listen)?void 0:w.join(","))+" ]",1)):v("",!0)]}),_:1}),d(o,{label:"项目备注"},{default:n(()=>[d(k,{modelValue:c(M).project_ps,"onUpdate:modelValue":l[3]||(l[3]=e=>c(M).project_ps=e),placeholder:"请输入项目备注",width:"24rem"},null,8,["modelValue"])]),_:1}),c(I)?v("",!0):(s(),r(o,{key:0,label:"绑定域名"},{default:n(()=>[d(R,{ref_key:"popover",ref:D,placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:c(q),"onUpdate:visible":l[6]||(l[6]=e=>w(q)?q.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:n(()=>[d(k,{rows:6,resize:"none",width:"40rem",modelValue:c(M).domains,"onUpdate:modelValue":l[4]||(l[4]=e=>c(M).domains=e),onFocus:l[5]||(l[5]=e=>q.value=!0),type:"textarea",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:n(()=>[l[10]||(l[10]=u("div",{class:"!p-[12px] bg-primary text-white"},[_(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),u("br"),_(" IP地址格式：192.168.1.199"),u("br"),_(" 泛解析添加方法 *.domain.com"),u("br"),_(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}))]),_:1},16)}}}),te={key:0,class:"ml-8px text-small text-danger leading-[2rem]"},oe={class:"flex items-center"},se={class:"flex items-center"},re={class:"flex items-center custom-refresh-select"},ne={class:"el-input-group__append !h-3rem !flex items-center"},de={class:"flex items-center"},ue={key:0,class:"pl-[12rem]"},ce=e({__name:"node-project",setup(e,{expose:o}){const{siteInfo:f}=A(),w=l(!1),g=l([]),b=l(""),h=l(L.value.nodejs_versions),C=l(L.value.package_managers),D=l(),z=a("getNodeData",e=>{}),P=async()=>{const e=await z(!0);h.value=e.nodejs_versions},X=()=>{E({type:"dir",path:pe.value.project_cwd,change:async e=>{var l;if(pe.value.project_cwd=e,!H.value){let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\W/g,"_");pe.value.project_name||(pe.value.project_name=a),b.value=a;const t=await le(pe.value.project_cwd);Object.assign(pe.value,t);const o=await Y(e);o.node_modules&&(pe.value.not_install_pkg=!0),w.value=!o.package_json}}})},Y=async e=>{const{data:l}=await B({request:$({path:e})});return l},Z=()=>{E({type:"file",path:pe.value.project_cwd,change:e=>{pe.value.userCmd=e}})},ee=async e=>{const l=await Q(e);C.value=l,pe.value.pkg_manager=l[0]||""},le=async e=>{let l={};try{const a=await K({data:JSON.stringify({project_cwd:e})}),t=F(a.data,"object",{});if(0===Object.keys(t).length)l.project_script="0";else{let e=Object.keys(t);g.value=e.map(e=>({label:e+":"+t[e],value:e})),l.project_script=e[0]||""}if(H.value){let e=f.value.project_config.project_script;l.project_script=e,l.userCmd=e,!g.value.find(l=>l.value===e)&&(l.project_script="0")}return l}catch(a){return l}},{BtForm:ce,submit:ie,param:pe}=N({data:async()=>{var e,l;if(await G(),C.value=L.value.package_managers,h.value=L.value.nodejs_versions,H.value){const{project_config:e,ps:l}=f.value,a=await le(e.project_cwd);return b.value=l,{...e,project_type:e.project_type||"nodejs",userCmd:"",...a}}return{project_name:"",project_script:"",project_cwd:"/www/wwwroot",project_type:"nodejs",pkg_manager:(null==(e=C.value)?void 0:e.at(0))||"",not_install_pkg:!1,run_user:"www",nodejs_version:(null==(l=h.value)?void 0:l.at(0))||"",userCmd:""}},options:e=>t(()=>[{type:"slots",key:"custom",rules:{project_cwd:[q({message:"请输入项目启动目录"})],project_name:[q({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_script:[q({message:"请选择项目启动脚本"})]}}]),submit:async(e,l)=>{await l();const a=D.value.formData;return{...e.value,project_script:"0"===e.value.project_script?e.value.userCmd:e.value.project_script,...a,domains:a.domains?a.domains.split("\n"):[]}}}),me=async()=>{const e=await ie();T(e)};return o({submit:ie}),(e,l)=>{const a=S,t=y,o=O,N=V,q=j,B=M,F=R,z=W,A=x,E=I,L=U;return s(),i("div",{class:"overflow-auto",style:k({"max-height":c(H)?"76rem":"50rem"})},[d(c(ce),{"label-width":"80px"},{custom:n(()=>[d(t,{label:"项目目录",prop:"project_cwd"},{default:n(()=>[u("div",null,[d(a,{modelValue:c(pe).project_cwd,"onUpdate:modelValue":l[0]||(l[0]=e=>c(pe).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择Node项目目录",onIconClick:X,width:"32rem"},null,8,["modelValue"]),c(w)?(s(),i("div",te,"* 文件夹中未检测到package.json文件，建议前往传统项目进行项目添加")):v("",!0)])]),_:1}),d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(o,{disabled:c(H),modelValue:c(pe).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>c(pe).project_name=e),width:"32rem",placeholder:"请输入Node项目名称"},null,8,["disabled","modelValue"])]),_:1}),d(t,{label:"启动选项",prop:"project_script"},{default:n(()=>[u("div",oe,[d(q,{placeholder:"请选择项目目录进行操作",modelValue:c(pe).project_script,"onUpdate:modelValue":l[2]||(l[2]=e=>c(pe).project_script=e),class:"!w-[30rem]",disabled:"/www/wwwroot/"===c(pe).project_cwd||"/www/wwwroot"===c(pe).project_cwd},{default:n(()=>[d(N,{label:"自定义启动命令",value:"0"}),(s(!0),i(m,null,p(c(g),e=>(s(),r(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l[7]||(l[7]=u("span",{class:"ml-8px text-small"},"* 自动获取package.json文件中的启动模式",-1))])]),_:1}),"0"===c(pe).project_script?(s(),r(t,{key:0,label:" "},{default:n(()=>[d(a,{modelValue:c(pe).userCmd,"onUpdate:modelValue":l[3]||(l[3]=e=>c(pe).userCmd=e),placeholder:"请输入自定义启动命令",icon:"el-folder-opened",onIconClick:Z,width:"32rem"},null,8,["modelValue"])]),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",se,[u("div",re,[d(q,{modelValue:c(pe).nodejs_version,"onUpdate:modelValue":l[4]||(l[4]=e=>c(pe).nodejs_version=e),class:"!w-[16rem]",onChange:ee},{default:n(()=>[(s(!0),i(m,null,p(c(h),e=>(s(),r(N,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",ne,[d(F,{title:"刷新Node版本",class:"!flex",onClick:P},{default:n(()=>[d(B,{icon:"el-refresh",class:"!text-base"})]),_:1})])]),l[9]||(l[9]=u("span",{class:"ml-8px text-small text-secondary"},"* 请根据项目选择合适的Node版本，",-1)),d(z,{onClick:c(J)},{default:n(()=>[...l[8]||(l[8]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),d(t,{label:"包管理器"},{default:n(()=>[u("div",de,[d(q,{modelValue:c(pe).pkg_manager,"onUpdate:modelValue":l[5]||(l[5]=e=>c(pe).pkg_manager=e),class:"!w-[16rem]"},{default:n(()=>[(s(!0),i(m,null,p(c(C),(e,l)=>(s(),r(N,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[11]||(l[11]=u("span",{class:"text-small text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),c(H)?v("",!0):(s(),r(A,{key:0,modelValue:c(pe).not_install_pkg,"onUpdate:modelValue":l[6]||(l[6]=e=>c(pe).not_install_pkg=e)},{default:n(()=>[...l[10]||(l[10]=[_(" 不安装node_module ",-1)])]),_:1},8,["modelValue"]))])]),_:1})]),_:1}),d(E,{isShowDivider:!c(H)},{config:n(()=>{var e,l;return[d(ae,{ref_key:"advancedConfigRef",ref:D,"label-width":"80px",type:"node",rowData:{...null==(e=c(f))?void 0:e.project_config,listen:null==(l=c(f))?void 0:l.listen},ps:c(b)},null,8,["rowData","ps"])]}),_:1},8,["isShowDivider"]),c(H)?(s(),i("div",ue,[d(L,{type:"primary",onClick:me},{default:n(()=>[...l[12]||(l[12]=[_("保存修改",-1)])]),_:1})])):v("",!0),l[13]||(l[13]=u("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-32px"},[u("li",null,"【启动选项】：默认读取package.json中的scripts列表，也可以选择[自定义启动命令]选项来手动输入启动命令"),u("li",null,"【自定义启动命令】：可以选择启动文件，或直接输入启动命令，支持的启动方式：例：npm/node/pm2/yarn"),u("li",null,"【项目端口】：错误的端口会导致访问502，若不知道端口，可先随意填写，启动项目后再改为正确端口"),u("li",null,"【运行用户】：为了安全考虑，默认使用www用户运行，root用户运行可能带来安全风险")],-1))],4)}}}),ie={class:"flex items-center"},pe={class:"flex items-center custom-refresh-select"},me={class:"el-input-group__append !h-3rem !flex items-center"},_e={key:1,class:"mt-2rem"},ve={class:"flex items-center"},fe={class:"flex items-center"},we={class:"text-small text-secondary ml-[0.8rem]"},ge={class:"flex items-center"},je={key:2,class:"mt-2rem"},ye={class:"flex items-center"},be={key:0,class:"mb-[2rem]"},xe=e({__name:"pm-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:w}=A(),g=l(L.value.nodejs_versions),b=l(L.value.package_managers),h=t(()=>H.value?w.value.ps:ee.value.project_name),B=l(),F=a("getNodeData",e=>{}),$=(e,l)=>{E({type:l,path:"file"===e?ee.value.project_file:ee.value.project_cwd,change:async l=>{var a,t;const o=ee.value.project_name;if("cwd"===e){ee.value.project_cwd=l;let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");o||(ee.value.project_name=e)}else{ee.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let a=null==(t=ee.value.project_cwd.substring(ee.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");if(o||(ee.value.project_name=a),"file"===e&&(ee.value.project_file=l),"config_file"===e){ee.value.config_file=l;const e=await(async e=>{try{const{data:l}=await P({path:e});return l.data}catch(l){}})(l);ee.value.config_body=e}}}})},K=async e=>{const l=await Q(e);b.value=l,ee.value.pkg_manager=l[0]||""},{BtForm:Y,submit:Z,param:ee,clearValidate:le}=N({data:async()=>{var e,l;if(await G(),b.value=L.value.package_managers,g.value=L.value.nodejs_versions,H.value){const{project_config:e,ps:l}=w.value;return{...e,project_ps:z(l),watch:"true"===e.watch}}return{add_type:0,project_name:"",project_type:"pm2",project_cwd:"",project_file:"",pkg_manager:(null==(e=b.value)?void 0:e.at(0))||"yarn",not_install_pkg:!1,nodejs_version:(null==(l=g.value)?void 0:l.at(0))||"",cluster:1,max_memory_limit:1024,watch:!1,config_file:"",config_body:"",project_args:"",env:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{project_name:[q({message:"请输入项目名称"})],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_cwd:[q({message:"请输入项目启动目录"})],cluster:[{required:!0,message:"请输入负载实例数量",trigger:["blur","change"]}],max_memory_limit:[{required:!0,message:"请输入内存上限",trigger:["blur","change"]}]}}]),submit:async(e,l)=>{let a;await l();let t=B.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},0===a.add_type&&(delete a.config_file,delete a.config_body),delete a.add_type,a}}),te=async()=>{const e=await Z();T(e)};return o({submit:Z}),(e,l)=>{const a=O,t=y,o=V,N=j,q=M,z=R,P=W,A=S,E=D,G=x,Q=X,T=I,Z=U;return s(),i("div",{class:"overflow-auto",style:k({"max-height":c(H)?"68rem":"55rem"})},[d(c(Y),{"label-width":"90px"},{custom:n(()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(a,{modelValue:c(ee).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>c(ee).project_name=e),width:"32rem",disabled:c(H),placeholder:"请输入Node项目名称"},null,8,["modelValue","disabled"])]),_:1}),c(H)&&c(ee).pm2_name?(s(),r(t,{key:0,label:"PM2服务名"},{default:n(()=>[d(a,{modelValue:c(ee).pm2_name,"onUpdate:modelValue":l[1]||(l[1]=e=>c(ee).pm2_name=e),width:"32rem",disabled:""},null,8,["modelValue"])]),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",ie,[u("div",pe,[d(N,{onChange:K,modelValue:c(ee).nodejs_version,"onUpdate:modelValue":l[2]||(l[2]=e=>c(ee).nodejs_version=e),class:"!w-[16rem]"},{default:n(()=>[(s(!0),i(m,null,p(c(g),e=>(s(),r(o,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",me,[d(z,{title:"刷新Node版本",class:"!flex",onClick:l[3]||(l[3]=e=>c(F)(!0))},{default:n(()=>[d(q,{icon:"el-refresh",class:"!text-base"})]),_:1})])]),l[21]||(l[21]=u("span",{class:"ml-8px text-small text-secondary"},"* 请根据项目选择合适的Node版本，",-1)),d(P,{onClick:c(J)},{default:n(()=>[...l[20]||(l[20]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),0===c(ee).add_type?(s(),i("div",_e,[d(t,{label:"启动文件",prop:"project_file"},{default:n(()=>[d(A,{modelValue:c(ee).project_file,"onUpdate:modelValue":l[4]||(l[4]=e=>c(ee).project_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目启动文件",onIconClick:l[5]||(l[5]=e=>$("file","file")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(A,{modelValue:c(ee).project_cwd,"onUpdate:modelValue":l[6]||(l[6]=e=>c(ee).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[7]||(l[7]=e=>$("cwd","dir")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"负载实例数量",prop:"cluster"},{default:n(()=>[u("div",ve,[d(a,{width:"10rem",class:"!w-[10rem]",type:"number",modelValue:c(ee).cluster,"onUpdate:modelValue":l[8]||(l[8]=e=>c(ee).cluster=e),min:1},null,8,["modelValue"]),l[22]||(l[22]=u("span",{class:"text-small text-secondary ml-[0.8rem]"},"* 若实例数量大于1，则开启集群模式",-1))])]),_:1}),d(t,{label:"内存上限",prop:"max_memory_limit"},{default:n(()=>[u("div",fe,[d(a,{width:"16rem",class:"!w-[16rem]",type:"number","text-type":"MB",min:1,modelValue:c(ee).max_memory_limit,"onUpdate:modelValue":l[9]||(l[9]=e=>c(ee).max_memory_limit=e)},null,8,["modelValue"]),u("span",we,"* 超过上限PM2会自动重启项目，系统最大可用内存为["+f(c(L).maximum_memory)+"MB]",1)])]),_:1}),d(t,{label:"自动重载"},{default:n(()=>[d(E,{modelValue:c(ee).watch,"onUpdate:modelValue":l[10]||(l[10]=e=>c(ee).watch=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"包管理器"},{default:n(()=>[u("div",ge,[d(N,{modelValue:c(ee).pkg_manager,"onUpdate:modelValue":l[11]||(l[11]=e=>c(ee).pkg_manager=e),class:"!w-[16rem]"},{default:n(()=>[(s(!0),i(m,null,p(c(b),(e,l)=>(s(),r(o,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[24]||(l[24]=u("span",{class:"text-small text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),c(H)?v("",!0):(s(),r(G,{key:0,modelValue:c(ee).not_install_pkg,"onUpdate:modelValue":l[12]||(l[12]=e=>c(ee).not_install_pkg=e)},{default:n(()=>[...l[23]||(l[23]=[_(" 不安装node_module ",-1)])]),_:1},8,["modelValue"]))])]),_:1})])):(s(),i("div",je,[d(t,{label:"配置文件"},{default:n(()=>[u("div",ye,[d(A,{modelValue:c(ee).config_file,"onUpdate:modelValue":l[13]||(l[13]=e=>c(ee).config_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目配置文件",onIconClick:l[14]||(l[14]=e=>$("config_file","file")),width:"32rem"},null,8,["modelValue"]),l[25]||(l[25]=u("span",{class:"text-small text-tertiary leading-[18px] ml-4px"},"* 请选择pm2的ecosystem配置文件或粘贴内容",-1))])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(A,{modelValue:c(ee).project_cwd,"onUpdate:modelValue":l[15]||(l[15]=e=>c(ee).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[16]||(l[16]=e=>$("cwd","dir")),width:"30rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"内容",prop:"config_body"},{default:n(()=>[d(Q,{modelValue:c(ee).config_body,"onUpdate:modelValue":l[17]||(l[17]=e=>c(ee).config_body=e),style:{height:"24rem"},class:"!h-[24rem] w-[58rem]"},null,8,["modelValue"])]),_:1})])),d(T,{"is-show-divider":!c(H)},{config:n(()=>{var e;return[0===c(ee).add_type?(s(),i("div",be,[d(t,{label:"参数"},{default:n(()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:c(ee).project_args,"onUpdate:modelValue":l[18]||(l[18]=e=>c(ee).project_args=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"环境变量"},{default:n(()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个",resize:"none",rows:3,modelValue:c(ee).env,"onUpdate:modelValue":l[19]||(l[19]=e=>c(ee).env=e),type:"textarea"},null,8,["modelValue"])]),_:1})])):v("",!0),d(ae,{ref_key:"advanceConfigRef",ref:B,"label-width":"90px",rowData:null==(e=c(w))?void 0:e.project_config,ps:c(h)},null,8,["rowData","ps"])]}),_:1},8,["is-show-divider"])]),_:1}),c(H)?(s(),r(Z,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:te},{default:n(()=>[...l[26]||(l[26]=[_(" 保存修改 ",-1)])]),_:1})):v("",!0),u("ul",{class:C(["mt-[8px] leading-8 text-small list-disc ml-32px",{"mb-[20px]":c(H)}])},[...l[27]||(l[27]=[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件",-1),u("li",null,"【配置文件】用于pm2直接启动服务的文件，通常是名为ecosystem.config.cjs",-1),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录",-1),u("li",null,"【负载实例数】集群模式，有些项目可能不支持，实例数量>1时为开启集群模式",-1),u("li",null,"【负载均衡】开启集群模式后将根据实例数自动负载均衡",-1)])],2)],4)}}}),he={class:"flex items-center"},Ve={class:"flex items-center custom-refresh-select"},ke={class:"el-input-group__append !h-3rem !flex items-center"},Ue=e({__name:"traditional-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:f}=A(),w=l(L.value.nodejs_versions);l(L.value.package_managers);const g=l(),b=a("getNodeData",e=>{}),x=async(e,l)=>{E({type:l,path:"file"===e?D.value.project_file:D.value.project_cwd,change:async l=>{var a,t;"file"===e?D.value.project_file=l:D.value.project_cwd=l;const o=D.value.project_name;if("cwd"===e&&""===o){let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");D.value.project_name=e}if("file"===e){D.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let e=null==(t=D.value.project_cwd.substring(D.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");""===o&&(D.value.project_name=e)}}})},{BtForm:h,submit:C,param:D}=N({data:async()=>{var e,l;return await G(),w.value=L.value.nodejs_versions,H.value?null==(e=f.value)?void 0:e.project_config:{project_name:"",nodejs_version:(null==(l=w.value)?void 0:l.at(0))||"",project_file:"",project_cwd:"",project_type:"general",project_args:"",env:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{project_name:[q({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],project_cwd:[q({message:"请输入项目启动目录"})]}}]),submit:async(e,l)=>{let a=!1;await l();let t=g.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},a}}),B=async()=>{const e=await C();T(e)};return o({submit:C}),(e,l)=>{const a=O,t=y,o=V,C=j,N=M,q=R,F=W,z=S,P=I,A=U;return s(),i("div",{class:"overflow-auto",style:k({"max-height":c(H)?"76rem":"52rem"})},[d(c(h),{"label-width":"80px"},{custom:n(()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(a,{modelValue:c(D).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>c(D).project_name=e),width:"32rem",disabled:c(H),placeholder:"请输入项目名称"},null,8,["modelValue","disabled"])]),_:1}),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",he,[u("div",Ve,[d(C,{modelValue:c(D).nodejs_version,"onUpdate:modelValue":l[1]||(l[1]=e=>c(D).nodejs_version=e),class:"!w-[16rem]"},{default:n(()=>[(s(!0),i(m,null,p(c(w),e=>(s(),r(o,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",ke,[d(q,{title:"刷新Node版本",class:"!flex",onClick:l[2]||(l[2]=e=>c(b)(!0))},{default:n(()=>[d(N,{icon:"el-refresh",class:"!text-base"})]),_:1})])]),l[10]||(l[10]=u("span",{class:"ml-8px text-small text-secondary"},"* 请根据项目选择合适的Node版本，",-1)),d(F,{onClick:c(J)},{default:n(()=>[...l[9]||(l[9]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),d(t,{label:"启动文件",prop:"project_file"},{default:n(()=>[d(z,{modelValue:c(D).project_file,"onUpdate:modelValue":l[3]||(l[3]=e=>c(D).project_file=e),readOnly:"",placeholder:"请选择项目启动文件",icon:"el-folder-opened",onIconClick:l[4]||(l[4]=e=>x("file","file")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(z,{modelValue:c(D).project_cwd,"onUpdate:modelValue":l[5]||(l[5]=e=>c(D).project_cwd=e),readOnly:"",placeholder:"请选择项目运行目录",icon:"el-folder-opened",onIconClick:l[6]||(l[6]=e=>x("cwd","dir")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"参数"},{default:n(()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:c(D).project_args,"onUpdate:modelValue":l[7]||(l[7]=e=>c(D).project_args=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"环境变量"},{default:n(()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个，格式参照key=value",resize:"none",rows:3,modelValue:c(D).env,"onUpdate:modelValue":l[8]||(l[8]=e=>c(D).env=e),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),d(P,{"is-show-divider":!c(H)},{config:n(()=>{var e,l;return[d(ae,{ref_key:"advanceConfigRef",ref:g,"label-width":"80px",rowData:{...null==(e=c(f))?void 0:e.project_config,listen:null==(l=c(f))?void 0:l.listen},ps:c(D).project_name},null,8,["rowData","ps"])]}),_:1},8,["is-show-divider"]),c(H)?(s(),r(A,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:B},{default:n(()=>[...l[11]||(l[11]=[_(" 保存修改 ",-1)])]),_:1})):v("",!0),l[12]||(l[12]=u("ul",{class:"mt-8px leading-8 text-small list-disc ml-32px"},[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件"),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录")],-1))],4)}}});export{ce as _,xe as a,Ue as b};
