import{L as e,cf as l,ar as a,e as t,hv as o,k as r,ax as s,$ as n,b as p}from"./utils-lib.js?v=1763689792";import{c as d,r as u,g as i,v as c,x as m,O as _,C as v,e as f,z as w,A as j,D as b,G as h,R as g,J as V,K as x,ad as y,aT as k,V as U,ak as P,aj as C,aA as I,H as O}from"./base-lib.js?v=1763689792";import{_ as A}from"./index107.js?v=1763689792";import{advanceCheckPort as z}from"./site.js?v=1763689792";import{f as J}from"./validator.js?v=1763689792";import{u as S,S as q}from"./useStore4.js?v=1763689792";import{a as B}from"./index77.js?v=1763689792";const F={class:"flex items-center"},G={class:"flex items-center"},H=d({__name:"index",setup(d,{expose:H}){const R=p(),{siteInfo:D}=S(),{getRootUser:E,getProjectConfig:K}=q(),L=u(!!D.value),M=u([]),N=u(!1),T=u(0),$=u({project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),Q=[{content:"执行命令：请输入项目需要携带的参数，默认请输入执行文件名"},{content:()=>f("span",null,[b("项目教程可参考:"),f(t,{target:"_blank",href:"https://www.bt.cn/bbs/thread-93034-1-1.html"},{default:()=>[b("https://www.bt.cn/bbs/thread-93034-1-1.html")]})])}],W=()=>{J({type:"file",path:$.value.project_exe,change:e=>{var l;$.value.project_exe=e,$.value.project_cmd=null==e?void 0:e.replace(/\/\//g,"/");let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\./g,"_");L.value||($.value.project_name=a),$.value.project_ps=a.replace(/\./g,"_")}})},X=e=>{$.value.project_ps=e},Y=async()=>{if($.value.port)try{const e=await z({port:$.value.port},"go");e.status||(R.request(e),$.value.port="")}catch(e){}},Z=()=>{J({type:"file",path:$.value.envPath,change:e=>{$.value.envPath=e}})},{BtForm:ee,submit:le}=e({data:$.value,options:e=>i(()=>[{type:"slots",key:"custom",rules:{project_exe:[l({message:"请选择项目可执行文件"})],project_name:[l({message:"请输入项目名称"})],port:[l({message:"请输入端口号",trigger:["change"]}),a()],project_cmd:[l({message:"请输入项目执行命令"})]}}]),submit:async(e,l)=>await B(e,l,T.value)});return c(async()=>{const e=await E();if(M.value=e.data.map(e=>({label:e,value:e})),Object.assign($.value,{project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),L.value){const{data:e}=await K({data:JSON.stringify({project_name:D.value.name})}),{env_list:l,env_file:a}=e.project_config;a&&(T.value=2),(null==l?void 0:l.length)>0&&(T.value=1),Object.assign($.value,{...null==e?void 0:e.project_config,project_ps:o(null==e?void 0:e.ps),is_power_on:!!(null==e?void 0:e.project_config.is_power_on),not_install_pkg:!!(null==e?void 0:e.project_config.not_install_pkg),envPath:a||"",env:(null==l?void 0:l.length)&&Array.isArray(l)?l.map(e=>e.k+"="+e.v).join("\n"):""})}}),H({onConfirm:le}),(e,l)=>{const a=A,t=y,o=r,p=k,d=U,u=P,i=C,c=s,z=I,J=O,S=n;return m(),_(w(ee),{"label-width":"100px",class:"p-[20px]"},{custom:v(()=>[f(t,{label:"项目执行文件",prop:"project_exe"},{default:v(()=>[f(a,{modelValue:w($).project_exe,"onUpdate:modelValue":l[0]||(l[0]=e=>w($).project_exe=e),icon:"el-folder-opened",placeholder:"请选择项目可执行文件",onIconClick:W,width:"32rem"},null,8,["modelValue"])]),_:1}),f(t,{label:"项目名称",prop:"project_name"},{default:v(()=>[f(o,{onInput:X,width:"32rem",disabled:w(L),modelValue:w($).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>w($).project_name=e),placeholder:"请输入GO项目名称"},null,8,["disabled","modelValue"])]),_:1}),f(t,{label:"项目端口",prop:"port"},{default:v(()=>[j("div",F,[f(o,{width:"20rem",type:"number",onBlur:Y,class:"mr-[12px]",modelValue:w($).port,"onUpdate:modelValue":l[2]||(l[2]=e=>w($).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),w(L)?h("",!0):(m(),_(d,{key:0,modelValue:w($).release_firewall,"onUpdate:modelValue":l[3]||(l[3]=e=>w($).release_firewall=e)},{default:v(()=>[l[15]||(l[15]=b(" 放行端口 ",-1)),f(p,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:v(()=>[...l[14]||(l[14]=[j("i",{class:"svgtofont-el-question-filled text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))])]),_:1}),f(t,{label:"执行命令",prop:"project_cmd"},{default:v(()=>[f(o,{modelValue:w($).project_cmd,"onUpdate:modelValue":l[4]||(l[4]=e=>w($).project_cmd=e),placeholder:"请输入项目的执行命令",width:"32rem"},null,8,["modelValue"])]),_:1}),f(t,{label:"环境变量",class:"mt-[1.6rem]"},{default:v(()=>[f(i,{modelValue:w(T),"onUpdate:modelValue":l[5]||(l[5]=e=>g(T)?T.value=e:null)},{default:v(()=>[f(u,{label:0},{default:v(()=>[...l[16]||(l[16]=[b("无",-1)])]),_:1}),f(u,{label:1},{default:v(()=>[...l[17]||(l[17]=[b("指定变量",-1)])]),_:1}),f(u,{label:2},{default:v(()=>[...l[18]||(l[18]=[b("从文件加载",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),V(f(t,{label:" "},{default:v(()=>[V(f(o,{width:"40rem",type:"textarea",rows:3,resize:"none",modelValue:w($).env,"onUpdate:modelValue":l[6]||(l[6]=e=>w($).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[x,1===w(T)]]),V(f(a,{modelValue:w($).envPath,"onUpdate:modelValue":l[7]||(l[7]=e=>w($).envPath=e),icon:"el-folder-opened",placeholder:"请选择环境变量文件",onIconClick:Z,width:"32rem"},null,8,["modelValue"]),[[x,2===w(T)]])]),_:1},512),[[x,0!==w(T)]]),f(t,{label:"运行用户"},{default:v(()=>[j("div",G,[f(c,{modelValue:w($).run_user,"onUpdate:modelValue":l[8]||(l[8]=e=>w($).run_user=e),options:w(M),class:"mr-[8px] !w-[16rem]"},null,8,["modelValue","options"]),l[19]||(l[19]=j("span",{class:"text-small text-secondary"},"* 无特殊需求请选择www用户",-1))])]),_:1}),f(t,{label:"开机启动"},{default:v(()=>[f(d,{modelValue:w($).is_power_on,"onUpdate:modelValue":l[9]||(l[9]=e=>w($).is_power_on=e)},{default:v(()=>[...l[20]||(l[20]=[b("是否设置开机自动启动（默认自带守护进程每120秒检测一次）",-1)])]),_:1},8,["modelValue"])]),_:1}),f(t,{label:"项目备注"},{default:v(()=>[f(o,{width:"32rem",modelValue:w($).project_ps,"onUpdate:modelValue":l[10]||(l[10]=e=>w($).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])]),_:1}),w(L)?h("",!0):(m(),_(t,{key:0,label:"绑定域名"},{default:v(()=>[f(z,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:w(N),"onUpdate:visible":l[13]||(l[13]=e=>g(N)?N.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:v(()=>[f(o,{rows:4,resize:"none",width:"40rem",modelValue:w($).domains,"onUpdate:modelValue":l[11]||(l[11]=e=>w($).domains=e),type:"textarea",onFocus:l[12]||(l[12]=e=>N.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:v(()=>[l[21]||(l[21]=j("div",{class:"!p-[12px] bg-primary text-white"},[b(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),j("br"),b(" IP地址格式：192.168.1.199"),j("br"),b(" 泛解析添加方法 *.domain.com"),j("br"),b(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1})),w(L)?(m(),_(t,{key:1,label:" "},{default:v(()=>[f(J,{type:"primary",onClick:w(le)},{default:v(()=>[...l[22]||(l[22]=[b("保存配置",-1)])]),_:1},8,["onClick"])]),_:1})):(m(),_(t,{key:2,label:""},{default:v(()=>[f(S,{options:Q})]),_:1}))]),_:1})}}});export{H as _};
