import{Q as e,p as a,k as t,e as l,l as s,j as r,b as n,ay as o,aj as i}from"./utils-lib.js?v=1763689792";import{c as p,r as u,v as m,aG as d,I as _,x as c,y as v,e as j,C as y,A as g,z as f,D as x,J as b,O as w,R as C,W as h,am as S,an as z,H as V,w as k,a0 as J}from"./base-lib.js?v=1763689792";import{g as L}from"./index76.js?v=1763689792";import{u as M,S as T}from"./useStore4.js?v=1763689792";import{_ as H,a as O,b as U}from"./traditional-project.vue_vue_type_script_setup_true_lang.js?v=1763689792";import{_ as I}from"./index.vue_vue_type_style_index_0_lang2.js?v=1763689792";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang14.js?v=1763689792";import{_ as q}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1763689792";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang15.js?v=1763689792";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang16.js?v=1763689792";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang17.js?v=1763689792";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang18.js?v=1763689792";import G from"./index504.js?v=1763689792";import{_ as P}from"./index.vue_vue_type_script_setup_true_lang19.js?v=1763689792";import{_ as Q}from"./index109.js?v=1763689792";import{u as R}from"./column.js?v=1763689792";import{getNodeModules as W,installPackages as E,installModule as K,upgradeModule as X,uninstallModule as Y}from"./site.js?v=1763689792";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1763689792";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang21.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index137.js?v=1763689792";import"./index110.js?v=1763689792";import"./validator.js?v=1763689792";import"./index107.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import"./useController6.js?v=1763689792";import"./index147.js?v=1763689792";import"./index131.js?v=1763689792";import"./index.vue_vue_type_script_setup_true_lang13.js?v=1763689792";import"./index119.js?v=1763689792";import"./ace.js?v=1763689792";import"./index442.js?v=1763689792";import"./form-item.js?v=1763689792";import"./useStore12.js?v=1763689792";import"./useController17.js?v=1763689792";import"./config.js?v=1763689792";import"./useController18.js?v=1763689792";import"./useController19.js?v=1763689792";import"./useStore14.js?v=1763689792";import"./useController15.js?v=1763689792";import"./useController5.js?v=1763689792";import"./useMethod5.js?v=1763689792";import"./useController4.js?v=1763689792";import"./ssl.js?v=1763689792";import"./useController20.js?v=1763689792";import"./index123.js?v=1763689792";import"./useController21.js?v=1763689792";import"./index350.js?v=1763689792";import"./useStore7.js?v=1763689792";const ee={class:"flex items-center"},ae={class:"flex items-center justify-center text-small"},te={class:"bg-darkPrimary p-[12px] h-[36rem] text-white overflow-auto"},le=["innerHTML"],se=p({__name:"index",props:{compData:{default:{}}},setup(i,{expose:p}){const{siteInfo:k}=M(),J=n(),L=u(!1),T=u([]),H=u(!1),O=u({mod_name:"",type:"yarn"}),U=u(),I=u("正在请求安装..."),N=async()=>{await e({loading:H,request:W({data:JSON.stringify({project_name:k.value.name,project_cwd:k.value.project_cwd})}),data:[Array,T]})},q=async(t,l)=>{var s,r,n;const{name:o}=k.value,{mod_name:i,type:p}=O.value;if(""===i&&"install"===l)return void J.error("请输入模块名称");"install"!==l&&await a({width:38,title:"".concat("update"===l?"更新":"卸载","模块【").concat(null==t?void 0:t.name,"】"),content:"".concat("update"===l?"更新":"卸载","模块后，可能影响项目正常运行，请谨慎操作，是否继续操作？"),type:"calc"});const u={install:{data:JSON.stringify({project_name:o,mod_name:i,pkg_manager:p})},update:{data:JSON.stringify({project_name:o,mod_name:null==t?void 0:t.name,type:p})},uninstall:{data:JSON.stringify({project_name:o,mod_name:null==t?void 0:t.name})}},m=new Map([["install",K],["update",X],["uninstall",Y]]).get(l),d=u[l],_=await e({loading:"正在操作,请稍后...",request:m(d)});(null==(s=null==_?void 0:_.data)?void 0:s.status)?(O.value.mod_name="",N(),J.success(null==(r=null==_?void 0:_.data)?void 0:r.data)):J.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:null==(n=null==_?void 0:_.data)?void 0:n.error_msg,type:"error",duration:0,showClose:!0})};let D=null;const A=(e,a)=>{const t=a.data;I.value+="\n"+t,t.includes("Done")&&(null==D||D.close())},B=async()=>{try{I.value="";const e=E({data:JSON.stringify({project_name:k.value.name})});D=o({route:"/sock_shell",onMessage:A}),null==D||D.send({"x-http-token":window.vite_public_request_token}),null==D||D.send("tail -f /www/server/panel/logs/npm-exec.log"),L.value=!0,U.value=await e;let{data:a}=await e;a.status||(J.request({status:a.status,msg:a.data||a.msg}),null==D||D.close()),J.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:U.value.data.data,type:U.value.status?"success":"error"})}catch(e){}},F=h([{label:"模块名称",prop:"name"},{label:"版本",prop:"version"},{label:"协议",prop:"license"},{label:"描述",prop:"description"},R([{onClick:e=>{q(e,"update")},title:"更新"},{onClick:e=>{q(e,"uninstall")},title:"卸载"}])]);return m(N),p({init:N}),d(()=>{null==D||D.close()}),(e,a)=>{const n=S,o=z,i=t,p=V,u=l,m=s,d=r,h=Q,k=_("bt-loading"),J=_("scroll-bottom");return c(),v("div",null,[j(h,null,{"header-left":y(()=>[g("div",ee,[j(o,{modelValue:f(O).type,"onUpdate:modelValue":a[0]||(a[0]=e=>f(O).type=e),class:"!w-[10rem]"},{default:y(()=>[j(n,{label:"yarn",value:"yarn"}),j(n,{label:"pnpm",value:"pnpm"}),j(n,{label:"npm",value:"npm"})]),_:1},8,["modelValue"]),j(i,{class:"ml-4px !w-[24rem]",modelValue:f(O).mod_name,"onUpdate:modelValue":a[1]||(a[1]=e=>f(O).mod_name=e),placeholder:"模块名称"},null,8,["modelValue"]),j(p,{type:"primary",class:"ml-1.4rem",onClick:a[2]||(a[2]=e=>q(null,"install"))},{default:y(()=>[...a[4]||(a[4]=[x("安装模块",-1)])]),_:1})])]),"header-right":y(()=>[j(p,{type:"primary",onClick:B},{default:y(()=>[...a[5]||(a[5]=[x("一键安装项目模块",-1)])]),_:1})]),content:y(()=>[b((c(),w(m,{"max-height":"620",column:f(F),data:f(T)},{empty:y(()=>[g("div",ae,[a[7]||(a[7]=x(" 未安装模块,点击 ",-1)),j(u,{onClick:B},{default:y(()=>[...a[6]||(a[6]=[x("一键安装项目模块",-1)])]),_:1})])]),_:1},8,["column","data"])),[[k,f(H)]])]),popup:y(()=>[j(d,{title:"正在安装模块,请稍后...",modelValue:f(L),"onUpdate:modelValue":a[3]||(a[3]=e=>C(L)?L.value=e:null),area:[50,36]},{default:y(()=>[b((c(),v("div",te,[g("pre",{class:"whitespace-pre-line",innerHTML:f(I)},null,8,le)])),[[J]])]),_:1},8,["modelValue"])]),_:1})])}}}),re=p({__name:"index",setup(e){const{siteInfo:a,settingTabActive:t,isJump:l}=M(),{resetTab:s}=T(),r=u(t.value||"project"),n=u(a.value),o=[{label:"项目配置",name:"project",lazy:!0,render:()=>{const e={node:H,pm2:O,general:U};return e[n.value.project_config.project_type]||e.node}},{label:"域名管理",name:"domain",lazy:!0,render:I},{label:"外网映射",name:"mapping",lazy:!0,render:N},{label:"流量限制",name:"limit",lazy:!0,render:q},{label:"伪静态",name:"pseudo",lazy:!0,render:D},{label:"配置文件",name:"configFile",lazy:!0,render:A},{label:"SSL",name:"ssl",lazy:!0,render:B},{label:"重定向",name:"redirect",render:F},{label:"负载状态",name:"load",lazy:!0,render:G},{label:"服务",name:"state",lazy:!0,render:P},{label:"模块管理",name:"modules",lazy:!0,render:se},{label:"项目日志",name:"projectLogs",lazy:!0,render:Z},{label:"网站日志",name:"siteLogs",lazy:!0,render:$}];if("general"===n.value.project_config.project_type){const e=o.findIndex(e=>"modules"===e.name);o.splice(e,1)}if("pm2"===n.value.project_config.project_type){const e=o.findIndex(e=>"load"===e.name);o.splice(e,1)}const{BtTabs:p}=i({type:"left-bg-card",value:r,options:o});k(()=>l.value,e=>{e&&(r.value=t.value,s())});const d=u({});return J("nodeData",d),m(async()=>{d.value=await L()}),(e,a)=>(c(),w(f(p),{type:"left-bg-card",modelValue:f(r),"onUpdate:modelValue":a[0]||(a[0]=e=>C(r)?r.value=e:null),options:o},null,8,["modelValue"]))}});export{re as default};
