import{Q as e,aH as a,n as t,H as s,bR as n,b as o,p as l,aK as r,u as i,b3 as c,an as m,q as p,x as u,ap as d}from"./utils-lib.js?v=1763689792";import{_}from"./index109.js?v=1763689792";import{g as v,r as f,p as y,c as j,s as g,e as b,D as h,w as x,v as k,n as w,x as C,y as O,z as E,O as P,C as L,A as N,G as S,R as I,F as R,b1 as T,L as B,an as D,am as V}from"./base-lib.js?v=1763689792";import{_ as A}from"./index137.js?v=1763689792";import{c as q,a as M,d as F,g as J,u as U}from"./column.js?v=1763689792";import{c as z,h as H,s as G,d as K,e as Q,g as W,i as X,u as Y,a as Z,k as $}from"./useController6.js?v=1763689792";import{u as ee,S as ae}from"./useStore4.js?v=1763689792";import{u as te}from"./index147.js?v=1763689792";import{getNodeVersionList as se,setDefaultEnv as ne,getNodeJsEnvironment as oe,delNodeProject as le,getPackageManagers as re,modifyNodeProject as ie,batchDelSite as ce,batchStatus as me}from"./site.js?v=1763689792";import{l as pe,i as ue,o as de,h as _e}from"./validator.js?v=1763689792";const ve=o(),{siteInfo:fe,isRefreshList:ye,activeType:je}=ee(),{setSiteInfo:ge}=ae(),be=v(()=>!!fe.value),he=f("0"),xe=f([]),ke=y("_node_mask",!1),we=async()=>{var a;const t=await e({loading:"正在设置，请稍后...",request:ne({version:he.value})});ve.request({status:null==(a=t.data)?void 0:a.status,msg:t.data.data||t.data.error_msg})},Ce=async()=>{try{const{data:e}=await a({sName:"nodejs"});await pe({name:"nodejs",softData:e})}catch(e){}},Oe=()=>{fe.value=null,t({title:"添加Node项目",area:80,component:()=>s(()=>import("./index389.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Ee=()=>{t({title:"PM2监控",area:120,showFooter:!1,component:()=>s(()=>import("./index390.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Pe=(e,a)=>{ge(e,a),t({isAsync:!0,title:"Node项目管理["+e.name+"] -- 添加时间["+e.addtime+"]",area:[87,71],component:()=>s(()=>import("./index391.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},Le=async e=>{try{const{data:a}=await re({version:e});return a.package_managers}catch(a){r(a)}},Ne=f({nodejs_versions:[],package_managers:[],user_list:[],maximum_memory:0}),Se=async()=>{var e,a,t,s;try{const o=await oe();return Object.assign(Ne.value,{...null==o?void 0:o.data,maximum_memory:(null==(e=null==o?void 0:o.data)?void 0:e.maximum_memory)||0,nodejs_versions:n(null==(a=null==o?void 0:o.data)?void 0:a.nodejs_versions,"array",[]),user_list:n(null==(t=null==o?void 0:o.data)?void 0:t.user_list,"array",[]),package_managers:n(null==(s=null==o?void 0:o.data)?void 0:s.package_managers,"array",[])}),o.data}catch(o){return Ne.value}},Ie=async a=>{a&&(await e({loading:"正在保存修改，请稍后...",request:ie(a),message:!0}),ye.value=!0)},Re=async(e,a,t,s,n,o)=>{const{label:l,value:r}=s,{enable:i,exclude:c}=o,m=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]);await e({title:"批量".concat(l),content:"".concat(m.get(r),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},q()],onConfirm:async()=>{const e=await(async()=>{const e=new Map([["start",me],["stop",me],["restart",me]]).get(r);switch(r){case"start":case"stop":case"restart":if(e){const a=t.value.map(e=>e.project_config.pm2_name?{id:e.id,project_name:e.name,project_type:e.project_config.project_type||"nodejs",pm2_name:e.project_config.pm2_name}:{id:e.id,project_name:e.name,project_type:e.project_config.project_type||"nodejs"}),s=_e(!1,c,i,{params:{site_list:JSON.stringify(a),status:r,project_type:"NODE"}});return await e(s,je.value)}case"delete":const a=t.value.map(e=>e.project_config.pm2_name?{id:e.id,name:e.name,project_type:e.project_config.project_type||"nodejs",pm2_name:e.project_config.pm2_name}:{id:e.id,name:e.name,project_type:e.project_config.project_type||"nodejs"}),s=_e(!1,c,i,{params:{project_type:je.value.toUpperCase(),site_list:JSON.stringify(a)}});return await ce(s)}})();ye.value=!0,n&&n();let{data:a}=ue(e.data);a=a.map(e=>({...e,name:e.name||e.project_name})),de(a,{title:"".concat(l,"网站")})}})},Te={class:"content-mask"},Be={class:"flex items-center mx-12px"},De=j({__name:"index",setup(e){i();const{getSiteList:a,setSiteInfo:t}=ae(),{activeType:o,isRefreshList:r,siteInfo:v,searchWidth:f}=g(ae()),{BtOperation:y}=c({options:[{type:"button",label:"添加项目",active:!0,onClick:()=>{var e;if(!(null==(e=xe.value)?void 0:e.length))return Ce();Oe()}},{type:"button",label:"Node版本管理器",onClick:Ce},{type:"button",label:"PM2监控",onClick:Ee}]}),j=te({key:"type_id",name:"Node分类",options:()=>[{label:"全部分类",value:"all"}],event:X,ignore:["0"],field:"type_name"}),q=d([{label:"启动项目",value:"start",event:Re},{label:"停用项目",value:"stop",event:Re},{label:"重启项目",value:"restart",event:Re},Y(),Z({classList:$}),{label:"删除项目",value:"delete",event:Re}]),{BtTable:ee,BtPage:ne,BtRefresh:oe,BtSearch:re,BtColumn:ie,BtBatch:ce,BtTableCategory:me,refresh:pe,config:ue}=m({request:e=>{const{type_id:t,...s}=e;return a({data:JSON.stringify({...s,type_id:p(t)||"all"===t?"":t})})},columns:[M({type:"page",key:"id"}),z({onClick:e=>{Pe(e)}}),H({type:o.value,onClick:(e,a)=>{if("setting"===a)return void Pe(e,"state");const t=e.run?"stop":"start";G(e,"restart"===a?a:t)}}),{label:"PID",isCustom:!0,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=[];for(var s in e.load_info)e.load_info.hasOwnProperty(s)&&t.push(s);return t.join(",")}},{label:"CPU",isCustom:!1,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=0;for(var s in e.load_info)t+=e.load_info[s].cpu_percent;return t.toFixed(2)+"%"}},{label:"内存",isCustom:!1,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=0;for(var s in e.load_info)t+=e.load_info[s].memory_used;return u(t)}},F(),K(),J({table:"sites",width:200}),{label:"Node版本",isCustom:!0,render:e=>e.project_config.nodejs_version||"--"},Q({onClick:e=>{Pe(e,"ssl")}}),U([{title:"设置",onClick:e=>{Pe(e)}},{title:"删除",onClick:e=>{(async e=>{await l({type:"default",title:"删除项目-".concat(e.name),content:"风险操作，此操作不可逆，删除【".concat(e.name,"】项目后您将无法管理该项目，是否继续操作？"),input:{content:"删除项目"}});try{let a=e.project_config,t={project_name:a.project_name,project_type:a.project_type||"nodejs"};a.pm2_name&&(t.pm2_name=a.pm2_name);const s=await le(t);ve.request(s),ye.value=!0}catch(a){}})(e)}}])],extension:[j,q],empty:()=>b("span",null,[h("您的列表为空，您可以"),b("span",{class:"bt-link",onClick:Oe},[h("添加一个项目")])])});return x(r,async e=>{var a;if(e){if(await pe(),null==(a=v.value)?void 0:a.name){const e=ue.data.find(e=>e.name===v.value.name);e&&t(e)}r.value=!1}}),k(()=>{(async()=>{var e;try{const a=await se();if(xe.value=[],!a.status)return void(ke.value=!0);ke.value=!1,null==(e=a.data)||e.forEach(e=>{e.setup&&xe.value.push({label:e.version,value:e.version}),1===e.is_default&&(he.value=e.version)}),xe.value.unshift({label:"未设置",value:"0"})}catch(a){}})(),w(()=>{s(()=>import("./index389.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),s(()=>import("./index391.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})}),(e,a)=>{const t=A,s=V,n=D,o=_;return C(),O("div",null,[E(ke)?(C(),P(t,{key:0},{content:L(()=>[N("div",Te,[a[4]||(a[4]=N("i",{class:"svgtofont-el-warning text-warning !text-subtitleLarge mr-4px"},null,-1)),a[5]||(a[5]=h(" 未安装Node版本管理器，",-1)),N("span",{class:"bt-link",onClick:a[0]||(a[0]=(...e)=>E(Ce)&&E(Ce)(...e))},"点击安装")])]),_:1})):S("",!0),b(o,null,{"header-left":L(()=>[b(E(y)),N("div",Be,[a[7]||(a[7]=N("span",{class:"mr-4px"},"命令行版本",-1)),b(n,{class:"!w-[10rem]",placeholder:"未设置",modelValue:E(he),"onUpdate:modelValue":a[2]||(a[2]=e=>I(he)?he.value=e:null),options:E(xe),onChange:E(we)},{footer:L(()=>[N("div",{class:"flex items-center justify-center py-[.8rem] cursor-pointer",onClick:a[1]||(a[1]=(...e)=>E(Ce)&&E(Ce)(...e))},[...a[6]||(a[6]=[N("span",{class:"bt-link"},"前往管理",-1)])])]),default:L(()=>[(C(!0),O(R,null,T(E(xe),(e,a)=>(C(),P(s,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","options","onChange"])]),N("div",{class:"flex items-center ml-1rem",onClick:a[3]||(a[3]=(...e)=>E(W)&&E(W)(...e))},[...a[8]||(a[8]=[N("i",{class:"svgtofont-desired text-medium"},null,-1),N("span",{class:"bt-link ml-1"},"需求反馈",-1)])])]),"header-right":L(()=>[b(E(me),{class:"!w-[140px] mr-[10px]"}),b(E(re),{class:B(["mr-[10px]","!w-[".concat(E(f),"px]")]),placeholder:"请输入项目名称或备注"},null,8,["class"]),b(E(oe),{class:"mr-[10px]"}),b(E(ie))]),content:L(()=>[b(E(ee))]),"footer-left":L(()=>[b(E(ce))]),"footer-right":L(()=>[b(E(ne))]),_:1})])}}}),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{Ve as a,Se as g,be as i,Ne as n,Ce as o,Ie as s,Le as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
