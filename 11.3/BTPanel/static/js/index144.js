import{E as a,az as e,n as l,H as t,b6 as s,Q as n,aA as o,M as i,f as c,P as r,l as u,ah as p,p as m,_ as d}from"./utils-lib.js?v=1763689792";import{B as h}from"./index119.js?v=1763689792";import{_ as v}from"./index109.js?v=1763689792";import{_ as f}from"./index118.js?v=1763689792";import{_ as b}from"./index130.js?v=1763689792";import{c as _,r as y,v as x,I as g,x as k,y as w,A as q,F as C,b1 as j,L as D,z as V,e as T,B as E,C as I,D as O,G as P,O as z,J as L,H as U,ay as A}from"./base-lib.js?v=1763689792";import{getSqliteTableList as F,getSqliteKeys as R,getSqliteTableInfo as S,querySql as H,deleteTableData as B}from"./database.js?v=1763689792";import{a as M,u as W,c as G}from"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./ace.js?v=1763689792";import"./index110.js?v=1763689792";const J={class:"flex w-full h-full"},Q={class:"man_l"},Y={class:"man_db"},K={class:"man_db_li"},N={class:"man_db_li_left"},X=["title"],Z={class:"cursor-pointer ml-8px"},$={class:"man_t"},aa=["onClick"],ea=["onClick"],la={class:"flex items-center"},ta={class:"inline-block max-w-[14rem] truncate"},sa={class:"man_r"},na={key:0,class:"flex items-center justify-center h-full"},oa=["onClick"],ia={class:"ul-item"},ca={class:"flex-1 flex items-center"},ra=["onClick"],ua={key:1,class:"nq_con"},pa={class:"p-[1.5rem]"},ma={class:"mt-[1rem]"},da={key:0,class:"result_table table",border:"1"},ha={key:1,class:"text-danger"},va=d(_({__name:"index",props:{compData:{default:{}}},setup(d){const _=d,va=y(),fa=y(),ba=y(!0),_a=y(0),ya=y(""),xa=y(!1),ga=y(!0),ka=y({p:1,limit:10,total:0,search:"",data:[],path:"",table:"",emptyText:"暂无数据，您可以添加数据"});let wa=y({});const qa=y([]),Ca=y([]),ja={mode:"ace/mode/nginx",theme:a.value?"ace/theme/clouds_midnight":"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},Da=a=>{l({title:"更改数据【"+a.id+"】",component:()=>t(()=>import("./insert-data.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:48,compData:{keys:Ca.value,row:a,path:ka.value.path,table:ka.value.table,refresh:Ua},showFooter:!0})},Va=async a=>{const e=Ca.value.find(a=>1===a.pk).name;await m({title:"删除表数据 [ "+a[e]+" ]",content:"删除选中表【"+ka.value.table+"】的数据后，该条数据将彻底消失，是否继续操作？"}),await n({loading:"正在删除表数据，请稍后...",request:B({path:ka.value.path,table:ka.value.table,where_data:a}),message:!0}),Ua()},Ta=y(),Ea=()=>{l({title:"添加数据",component:()=>t(()=>import("./insert-data.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:48,compData:{keys:Ca.value,path:ka.value.path,table:ka.value.table,refresh:Ia},showFooter:!0})},Ia=()=>{Ua(),Oa(_.compData.path,!0)},Oa=async(a,e)=>{var l;try{if(!wa.value[a]||e){const{data:l}=await F({path:a});wa.value={...wa.value,[a]:l},!e&&l.length>0&&Pa({path:a,name:l[0].name})}else(null==(l=wa.value[a])?void 0:l.length)>0&&Pa({path:a,name:wa.value[a][0].name})}catch(t){}},Pa=a=>{const{name:e,path:l}=a;if(ba.value=!1,"sql"===e){const a=s(8);return ga.value=!1,qa.value.push({name:"新建查询",path:"nq_con_"+a,sql:"",status:0,queryPath:l}),void(ya.value="nq_con_"+a)}ga.value=!0,qa.value.find(a=>a.path===l&&a.name===e)||qa.value.push({name:e,path:l}),za(a)},za=a=>{const{name:e,path:l}=a;ba.value=!1,"新建查询"===e?ya.value=l:(ga.value=!0,La(a))},La=async a=>{try{const{path:e,name:l}=a,{data:t}=await R({path:e,table:l});Ca.value=t;let s=[];t.forEach(a=>s.push({label:a.name,prop:a.name,showOverflowTooltip:!0})),Ta.value=[M({key:s[0].prop}),...s,W([{onClick:Da,title:"更改"},{onClick:Va,title:"删除"}])],ka.value.path=e,ka.value.table=l,Ua()}catch(e){}},Ua=async()=>{try{ya.value=ka.value.table;const{data:a}=await n({loading:xa,request:S({path:ka.value.path,table:ka.value.table,p:ka.value.p,search:ka.value.search})});ka.value.data=e(a.data)?[]:a.data,ka.value.emptyText=e(a.data)?a.data:"暂无数据，您可以添加数据",ka.value.total=o(a.page)}catch(a){}},Aa=a=>{a.deltaY>0?fa.value.scrollLeft+=100:fa.value.scrollLeft-=100},Fa=async()=>{await Oa(_.compData.path,!0),i.success("刷新成功")},Ra=async()=>{await Ua(),i.success("刷新成功")},Sa=[{label:"删除数据",value:"delete",event:async(a,e,l,t)=>{var s,n;await a({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:null==(s=Ta.value[1])?void 0:s.prop,label:null==(n=Ta.value[1])?void 0:n.label},G()],onConfirm:async()=>(await e(a=>B({path:ka.value.path,table:ka.value.table,where_data:a})),Ia(),!1)})}}];return x(()=>{const{list:a,path:e}=_.compData;_a.value=a.findIndex(a=>a.path===e)||0,Oa(e)}),(a,l)=>{const t=c,s=U,n=A,o=r,i=b,m=u,_=p,y=f,x=v,F=h,R=g("bt-loading");return k(),w("div",J,[q("div",Q,[q("ul",Y,[(k(!0),w(C,null,j(d.compData.list,(a,e)=>(k(),w(C,null,[a.path===d.compData.path?(k(),w("li",{key:e,class:D(e===V(_a)?"active":"")},[q("div",K,[q("div",N,[T(t,{src:"/database/database-icon.png",class:"w-[1.4rem] h-[1.4rem] mr-[4px] ml-[8px]"}),q("span",{title:a.name},E(a.name),9,X)]),q("div",Z,[T(s,{size:"small",onClick:Fa},{default:I(()=>[...l[3]||(l[3]=[q("i",{class:"svgtofont-el-refresh-right mr-4px"},null,-1),O(" 刷新 ",-1)])]),_:1})])]),q("ul",$,[q("li",{class:D(["new_query flex items-center",-1!==V(ya).indexOf("nq_con_")?"active":""]),onClick:e=>Pa({path:a.path,name:"sql"})},[T(t,{src:"/database/select-icon.png",class:"w-[1.4rem] mr-[4px] align-text-bottom"}),l[4]||(l[4]=q("span",null,"新建查询",-1))],10,aa),(k(!0),w(C,null,j(V(wa)[a.path],(e,l)=>(k(),w("li",{class:D(["flex items-center",e.name===V(ya)?"active":""]),key:l,onClick:l=>Pa({path:a.path,name:e.name})},[T(t,{src:"/database/table-icon.png",class:"w-[1.4rem] mr-[4px] align-text-bottom"}),q("span",la,[q("span",ta,E(e.name),1),O(" "+E("（"+e.count+"）"),1)])],10,ea))),128))])],2)):P("",!0)],64))),256))])]),q("div",sa,[V(ba)?(k(),w("div",na,[T(n,{description:"请点击左侧表查看数据"})])):(k(),w(C,{key:1},[q("div",{ref_key:"scrollDiv",ref:fa,class:"ul_scroll",onWheel:Aa},[q("ul",null,[(k(!0),w(C,null,j(V(qa),(a,e)=>(k(),w("li",{class:D(a.name===V(ya)||a.path===V(ya)?"active":""),key:e,onClick:e=>za(a)},[q("div",ia,[q("div",ca,[T(t,{src:"新建查询"===a.name?"/database/select-icon.png":"/database/table-icon.png",class:"w-[1.4rem] h-[1.4rem] mr-[4px] align-middle text-small"},null,8,["src"]),q("span",null,E(a.name),1)]),q("i",{class:"svgtofont-el-close ml-[4px]",onClick:a=>(a=>{qa.value.splice(a,1),qa.value.length?za(qa.value[a]||qa.value[a-1]):(ba.value=!0,ga.value=!1)})(e)},null,8,ra)])],10,oa))),128))])],544),V(ga)?(k(),z(x,{key:0,class:"p-[1.2rem]"},{"header-left":I(()=>[T(s,{type:"primary",onClick:Ea},{default:I(()=>[...l[5]||(l[5]=[O("添加数据",-1)])]),_:1})]),"header-right":I(()=>[T(o,{class:"mr-4px",modelValue:V(ka).search,"onUpdate:modelValue":l[0]||(l[0]=a=>V(ka).search=a),onSearch:Ua,placeholder:"搜索所有字段"},null,8,["modelValue"]),T(i,{onRefresh:Ra})]),content:I(()=>[L(T(m,{ref_key:"mangerTableRef",ref:va,"max-height":480,column:V(Ta),data:V(ka).data,description:V(ka).emptyText},null,8,["column","data","description"]),[[R,V(xa)]])]),"footer-left":I(()=>[T(_,{"table-ref":V(va),options:Sa},null,8,["table-ref"])]),"footer-right":I(()=>[T(y,{layout:"prev, pager, next,  total, jumper",type:"default",page:V(ka).p,"onUpdate:page":l[1]||(l[1]=a=>V(ka).p=a),row:V(ka).limit,"onUpdate:row":l[2]||(l[2]=a=>V(ka).limit=a),onChange:Ua,total:V(ka).total},null,8,["page","row","total"])]),_:1})):(k(),w("div",ua,[(k(!0),w(C,null,j(V(qa),(a,t)=>(k(),w(C,null,["新建查询"===a.name?(k(),w("div",{key:t,class:D(a.path===V(ya)?"":"hidden")},[q("div",pa,[T(F,{modelValue:a.sql,"onUpdate:modelValue":e=>a.sql=e,class:"!h-[21rem]","editor-option":ja},null,8,["modelValue","onUpdate:modelValue"]),T(s,{type:"default",class:"!mt-[1rem]",onClick:e=>(async a=>{try{if(a.status=1,a.sql){const{data:e}=await H({path:a.queryPath,sql_shell:a.sql});a.result=e.status?e.list:e.msg}else a.result="请输入sql语句查询";a.status=2}catch(e){}})(a),disabled:1===a.status},{default:I(()=>[O(E(1===a.status?"正在查询...":"运行"),1)]),_:2},1032,["onClick","disabled"])]),q("div",{class:D(["run_result p-[1.5rem]",a.status?"":"hidden"])},[l[6]||(l[6]=q("span",{class:"text-base"},"查询结果：",-1)),q("div",ma,[V(e)(a.result)?(k(),w("div",ha,E(a.result),1)):(k(),w("table",da,[q("tbody",null,[(k(!0),w(C,null,j(a.result,(a,e)=>(k(),w("tr",{key:e},[(k(!0),w(C,null,j(a,(a,e)=>(k(),w("td",{key:e},E(a),1))),128))]))),128))])]))])],2)],2)):P("",!0)],64))),256))]))],64))])])}}}),[["__scopeId","data-v-0ffeebd9"]]);export{va as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
