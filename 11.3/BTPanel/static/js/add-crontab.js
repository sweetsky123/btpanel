import{c as e,r as a,o as l,v as t,x as o,O as r,C as s,e as u,z as m,A as n,y as d,b1 as i,F as p,G as h,D as w,ad as c,am as y,an as f,V as v,aA as b,ab as _}from"./base-lib.js?v=1763689792";import{Q as V,k}from"./utils-lib.js?v=1763689792";import{modifyCrontab as x,addCrontab as g}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const D={class:"flex items-center"},H={class:"flex items-center"},M=e({__name:"add-crontab",props:{compData:{default:{}}},setup(e,{expose:M}){const U=e,B=a(!!U.compData.row),j=a(),q=a(!1),C=l({cron_name:"",type:"week",week:"1",where1:"3",hour:"1",minute:"30",flock:!1,sBody:""}),N=l({cron_name:[{required:!0,message:"请输入计划任务名称",trigger:"blur"}],hour:[{required:!0,message:"请输入执行时间",trigger:"blur"}],minute:[{required:!0,message:"请输入执行时间",trigger:"blur"}],sBody:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),z=a(5);let A=a([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0}]);const F=(e,a=!1)=>{C.type=e,z.value=A.value.findIndex(a=>a.type===e),"minute-n"===C.type&&(C.where1=C.minute),"hour-n"===C.type&&(C.where1=C.hour),j.value&&j.value.clearValidate()};return t(()=>{B.value=!!U.compData.row;const{type:e,where1:a,where_hour:l,where_minute:t,flock:o,sBody:r,rname:s,name:u}=U.compData.row;Object.assign(C,{cron_name:s||u||"",type:e||"week",week:"week"===e?a:"1",where1:a||"3",hour:l||"1",minute:t||"30",flock:!!o,sBody:r||""}),F(C.type)}),M({onConfirm:e=>{j.value.validate(a=>{if(!a)return;q.value=!0;let l={sitename:U.compData.sitename,...C,flock:C.flock?1:0};B.value&&(l.id=U.compData.row.id);const t=B.value?x:g;V({loading:"正在".concat(B.value?"修改":"添加","计划任务，请稍候..."),request:t(l),message:!0,success:a=>{q.value=!1,a.status&&(e(),U.compData.refreshEvent())}})})}}),(e,a)=>{const l=k,t=c,V=y,x=f,g=v,M=b,U=_;return o(),r(U,{ref_key:"crontabFormRef",ref:j,model:m(C),rules:m(N),disabled:m(q),"label-width":"80px",class:"p-2rem"},{default:s(()=>[u(t,{label:"任务名称",prop:"cron_name"},{default:s(()=>[u(l,{modelValue:m(C).cron_name,"onUpdate:modelValue":a[0]||(a[0]=e=>m(C).cron_name=e),placeholder:"请输入计划任务名称",width:"36rem"},null,8,["modelValue"])]),_:1}),u(t,{label:"执行周期"},{default:s(()=>{var e,c,y;return[n("div",D,[u(x,{onChange:a[1]||(a[1]=e=>F(m(C).type,!0)),class:"!w-[8rem] mr-1rem",modelValue:m(C).type,"onUpdate:modelValue":a[2]||(a[2]=e=>m(C).type=e)},{default:s(()=>[(o(!0),d(p,null,i(m(A),(e,a)=>(o(),r(V,{key:a,label:e.text,value:e.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),"week"==m(C).type?(o(),r(t,{key:0,class:"el-form-item-item mr-1rem"},{default:s(()=>[u(x,{class:"!w-[8rem]",modelValue:m(C).week,"onUpdate:modelValue":a[3]||(a[3]=e=>m(C).week=e)},{default:s(()=>[u(V,{label:"周一",value:"1"}),u(V,{label:"周二",value:"2"}),u(V,{label:"周三",value:"3"}),u(V,{label:"周四",value:"4"}),u(V,{label:"周五",value:"5"}),u(V,{label:"周六",value:"6"}),u(V,{label:"周日",value:"7"})]),_:1},8,["modelValue"])]),_:1})):h("",!0),(null==(e=m(A)[m(z)])?void 0:e.showDay)?(o(),r(t,{key:1,class:"el-form-item-item mr-1rem",prop:"where1"},{default:s(()=>[u(l,{modelValue:m(C).where1,"onUpdate:modelValue":a[4]||(a[4]=e=>m(C).where1=e),min:1,width:"12rem",type:"number"},{append:s(()=>[...a[9]||(a[9]=[w("天",-1)])]),_:1},8,["modelValue"])]),_:1})):h("",!0),(null==(c=m(A)[m(z)])?void 0:c.showHour)?(o(),r(t,{key:2,class:"el-form-item-item mr-1rem",prop:"hour"},{default:s(()=>{var e;return[(null==(e=m(A)[m(z)])?void 0:e.showHour)?(o(),r(l,{key:0,modelValue:m(C).hour,"onUpdate:modelValue":a[5]||(a[5]=e=>m(C).hour=e),width:"12rem",max:"23",min:"0",type:"number"},{append:s(()=>[...a[10]||(a[10]=[w("小时",-1)])]),_:1},8,["modelValue"])):h("",!0)]}),_:1})):h("",!0),(null==(y=m(A)[m(z)])?void 0:y.showMinute)?(o(),r(t,{key:3,class:"el-form-item-item",prop:"minute"},{default:s(()=>{var e;return[(null==(e=m(A)[m(z)])?void 0:e.showMinute)?(o(),r(l,{key:0,modelValue:m(C).minute,"onUpdate:modelValue":a[6]||(a[6]=e=>m(C).minute=e),width:"12rem",max:"59",min:"0",type:"number"},{append:s(()=>[...a[11]||(a[11]=[w("分钟",-1)])]),_:1},8,["modelValue"])):h("",!0)]}),_:1})):h("",!0)])]}),_:1}),u(t,{label:" ","label-width":"0rem"},{default:s(()=>[n("div",H,[u(g,{modelValue:m(C).flock,"onUpdate:modelValue":a[7]||(a[7]=e=>m(C).flock=e),disabled:m(B)},{default:s(()=>[...a[12]||(a[12]=[w("开启进程锁",-1)])]),_:1},8,["modelValue","disabled"]),u(M,{placement:"right-start",width:"440","popper-class":"white-tips-popover",trigger:"hover",content:""},{reference:s(()=>[...a[13]||(a[13]=[n("i",{class:"svgtofont-el-question-filled text-warning ml-[12px]"},null,-1)])]),default:s(()=>[a[14]||(a[14]=n("div",{class:"p-[12px]"},[n("span",{class:"text-secondary"},"在同一时间内只用一个进程在执行，若上一个进程未执行结束，下一次不执行")],-1))]),_:1})])]),_:1}),u(t,{label:"脚本内容",prop:"sBody"},{default:s(()=>[u(l,{width:"58rem",placeholder:"请输入脚本内容",type:"textarea",modelValue:m(C).sBody,"onUpdate:modelValue":a[8]||(a[8]=e=>m(C).sBody=e),resize:"both",rows:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])}}});export{M as default};
