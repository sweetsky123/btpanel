import{u as e,Q as a,eQ as t,p as s,V as i,F as n,n as r,H as o,M as l,r as u,eD as c,eL as d,eR as v,eS as m,eT as p,bz as g,eJ as y,eK as w,aK as h,af as f,az as _,eE as T,U as b,bW as S,eU as E,eV as I,eW as R,eX as x,eY as P,eZ as L}from"./utils-lib.js?v=1763689792";import{j as q,t as U,s as V,g as D,r as O,aB as j,o as k}from"./base-lib.js?v=1763689792";import{H}from"./store2.js?v=1763689792";import{av as A,p as C,aw as M}from"./validator.js?v=1763689792";const B=q("HOME-HEADER-STORE",()=>{const{panelVersion:q,payment:B,updatePush:N,panel:$,push:F,plugin:J,getUpdatePushInfo:z,getOldSenderAlarmListInfo:G,ltdRemarks:K,proRemarks:Q}=e(),{bindUser:W,authType:X,authExpirationTime:Y}=U(B.value),Z=H(),{panelInfo:ee,systemInfo:ae}=V(Z),{upgrade:te,currentInfo:se}=U(ee.value),ie=D(()=>{const e=[...K.value];return e.length=5,[...e,["other","更多特权>>"]]}),{isDebug:ne}=$.value,{isBeta:re,cloudBeta:oe,isUpgrade:le,grayscale:ue}=U(ee.value),ce=O(!1),de=O(!1),ve=O(""),me=O(!1),pe=O(null),ge=O({}),ye=O({}),we=O({phone:"",status:!1}),he=O({phone:[{validator:(e,a,t)=>{we.value.status?/^1[3456789]\d{9}$/.test(a)||/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(a)?t():t(new Error("请输入正确的手机号码或邮箱")):t()}}],give:[{required:!0,validator:(e,a,t)=>{0===a.length?t(new Error("请选择至少一种告警方式")):t()},trigger:["blur","change"]}]}),fe=j("popupClose",()=>{}),_e=async(e={})=>{try{const{data:a}=await y(e),t=window.vite_public_version,s=null==t?void 0:t.split(".").pop(),i=Number.parseInt(s).toString()===s&&2===s.length,{is_beta:n,version:r,beta:o,downUrl:l,updateMsg:u,uptime:c,grayscale_test:d}=a.msg;return oe.value=n,re.value=i,ge.value=o,ye.value={downUrl:l,updateMsg:u,version:r,uptime:c},ue.value=d,a.status&&(le.value=w(q.value,re.value?o.version:r)),a}catch(a){return h(a),!1}},Te=async e=>{be.value=e||!1,Re.value.switch=!0,r({title:"更新提示",area:50,btn:!0,component:()=>o(()=>import("./alarm.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},be=O(!1),Se=O(),Ee=O(),Ie=O(!1),Re=O({switch:N.value.updatePush,give:[""],option:{}}),xe=O(!0),Pe=O(!1),Le=O(),qe=O([]);let Ue;const Ve=k({webServe:!1,mysqlServe:!1,restartServe:!1,serveStart:!1}),De=()=>{Ue=setInterval(async()=>{try{const e=await I();e&&(e.hasOwnProperty("status")||void 0!==e.code)&&(l.success("服务器重启成功!"),setTimeout(()=>{n(),window.location.reload()},2e3),clearInterval(Ue))}catch(e){h(e)}},3e3)},Oe=O(""),je=async()=>{try{Ue&&clearTimeout(Ue);const{data:e}=await R();e.status||_(e.data)?(Oe.value=_(e.data)?e.data:e.msg||"暂无日志",_(e.data)?(l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg+"".concat(e.status?"<br>请按 Ctrl+F5 刷新缓存，或等待5s自动刷新！":""),type:e.status?"success":"error",showClose:!e.status,duration:e.status?5e3:0}),e.status&&setTimeout(()=>{n(),window.location.reload()},5e3)):Ue=setTimeout(()=>{n(),je()},2e3)):l.error(e.msg)}catch(e){Ue&&clearTimeout(Ue),Ue=setTimeout(()=>{je()},2e3)}},ke=O(!1),He=O([]);return{bindUser:W,authType:X,authExpirationTime:Y,systemInfo:ae,panelInfo:ee,panelVersion:q,formPhone:pe,jumpRouter:e=>{u.push({path:"/config/".concat(e)})},histVersionInfoDialog:async()=>r({title:"历史版本",area:[60,52],component:()=>o(()=>import("./index346.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),onRepair:async()=>{if(await A())return null;await a({loading:"正在获取数据，请稍后...",request:t(),success:async e=>{const u=e.data;1===u.upgrade?(await s({title:"修复面板",content:'<div class="flex items-center">\n              <div class="mr-1rem w-[4rem]"><img width="40" src="/static/icons/icon-upgrade.svg"></img></div>\n              <div class="flex-1">\n                <div class="text-medium leading-2.4rem">发现新版本，继续修复面板能修复使用中遇到的各种异常问题</div>\n              </div>\n            </div>\n            <div class="pl-5rem mt-[4px]">\n              <div>最新版本：'.concat(u.cloud.version,"</div>\n              <div>更新时间：").concat(i(1e3*u.cloud.update_time),"</div>\n            </div>"),icon:!1,width:"40rem",isHtml:!0,confirmText:"继续修复"}),a({loading:"正在修复面板，请稍后...",request:t({force:1}),message:!0,success:e=>{n(),e.status&&setTimeout(()=>{r({title:"正在".concat("repair"===u.type?"修复":"更新","面板，请耐心等候..."),area:70,compData:{type:"repair"},component:()=>o(()=>import("./index23.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},1500)}})):l.msg({message:'<div style="line-height:22px;">\n              <div>当前已是最新版本</div>\n              <div>当前版本：'.concat(u.local.version,"</div>\n              <div>更新时间：").concat(i(1e3*u.local.update_time),"</div>\n            </div>"),type:"success",dangerouslyUseHTMLString:!0})}})},restartSeverDialog:async()=>await A()?null:r({title:"重启服务器或者面板",area:[33,11],component:()=>o(()=>import("./index192.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),updateVersionDialog:async()=>await A()?null:r({area:50,component:()=>o(()=>import("./index347.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)}),advantageList:ie,productPayment:()=>{C({disablePro:!0,sourceId:300})},loading:ce,isUpgrade:le,grayscale:ue,isBeta:re,betaInfo:ge,officialInfo:ye,update:N,isNPSShow:me,questions:ve,form:we,rules:he,onOpen:async()=>{try{ce.value=!0;const e=await _e({check:!0});if(f(e))return;!e.status&&_(e.msg)&&(fe(),l.error(e.msg))}catch(e){h(e)}finally{ce.value=!1}},submit:async e=>{if(""===ve.value)throw l.error("还有必填项没有填写哦~"),new Error("还有必填项没有填写哦~");pe.value.validate(async t=>{if(t){const t=(s=we.value.phone,/^1[3456789]\d{9}$/.test(s)?"phone":/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(s)?"email":"unknown"),i={questions:JSON.stringify({22:ve.value}),product_type:18,software_name:1,rate:0};we.value.status&&(i.feedback=JSON.stringify("phone"===t?{phone:we.value.phone}:{email:we.value.phone})),a({loading:"正在提交问卷，请稍后...",request:g(i),success:a=>{a.status&&(M(),e())}})}var s})},ignoreUpdatEVersion:(e,t)=>{a({loading:"正在忽略本次更新，请稍后...",request:p({version:e}),message:!0,success:e=>{e.status&&t()}})},getUpdatePushInfo:z,openUpdateReminder:async()=>{N.value.updatePush?Te(!N.value.updatePush):a({loading:"正在设置更新提醒，请稍后...",request:c({task_id:N.value.updateTaskId,status:0}),message:!0})},updateReminderDialog:Te,updateVersion:async e=>{let t;try{if("boolean"!=typeof e)return 0!==te.value?(await s({title:"升级面板",content:'<div class="flex items-center">\n            <div class="mr-1rem w-[4rem]"><img width="40" src="/static/icons/icon-upgrade.svg"></img></div>\n              <div class="flex-1">\n                <div class="text-medium leading-2.4rem">升级面板可以修复大部分已知BUG，同时安装最新的功能，用户数据也不会受到影响</div>\n              </div>\n            </div>\n            <div class="pl-5rem mt-[4px]">\n              <div>即将更新到：'.concat(se.value.version,"</div>\n              <div>更新时间：").concat(i(1e3*se.value.update_time),"</div>\n            </div>"),icon:!1,width:"40rem",isHtml:!0,confirmText:"继续升级"}),void a({loading:"正在升级面板，请稍后...",request:d({force:!0,version:se.value.version}),message:!0,success:e=>{n(),e.status&&setTimeout(()=>{r({title:"正在更新面板，请耐心等候...",area:70,compData:{type:"upgrade"},component:()=>o(()=>import("./index23.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},1500)}})):void l.msg({message:'<div style="line-height:22px;">\n              <div>当前已是最新版本</div>\n              <div>当前版本：'.concat(se.value.version,"</div>\n              <div>更新时间：").concat(i(1e3*se.value.update_time),"</div>\n            </div>"),type:"success",dangerouslyUseHTMLString:!0});if(await s({title:"升级面板",content:"温馨提示：升级面板，有助于面板的BUG修复和功能加强，但不会影响用户的数据，即使面板发生故障，用户数据也不会受到影响。请您放心进行升级。"}),t=await(async e=>{let a;try{const t=e?"升级Linux测试版":"切换到正式版",i=e?"请仔细阅读内测升级须知，是否升级Linux测试版？":"是否从测试版切换到正式版？";await s({type:"calc",title:t,content:i}),a=l.load("正在".concat(t,"，请稍候...")),n(),ne&&(await m(),de.value=!0);const r=e?await P():await L();if(!r.status)return l.request(r)}catch(t){return!1}finally{fe(),n()}return a})(e),!t)return;await _e({check:!0});const u=await v({toUpdate:"yes"});de.value&&(await m(),de.value=!1),u.status?(l.success({msg:u.msg,onClose:()=>window.location.reload()}),setTimeout(()=>{window.location.reload()},2e3)):l.error(u.msg)}catch(u){t&&t.close()}finally{t&&t.close(),fe(),n()}},alarmRef:Se,pushMsgRef:Ee,msgForm:Re,checkedLoad:Ie,renderPushConfig:async()=>{Ie.value=!0,await G(),Ie.value=!1,Re.value.give=N.value.modulePush,Re.value.option=F.value.config},refreshAlarmEvent:()=>{var e;null==(e=Se.value)||e.refresh(),l.success("刷新成功")},onCancel:()=>{N.value.updatePush=be.value},onConfirm:e=>{Ee.value.validate(async t=>{if(t){const t={task_data:JSON.stringify({task_data:{tid:"10",type:"panel_update",title:"面板更新提醒",status:Re.value.switch,count:0,interval:600,project:""},status:Re.value.switch,sender:Re.value.give,number_rule:{day_num:0,total:2},time_rule:{send_interval:0,time_range:[0,86399]}}),template_id:"10"};a({loading:"正在提交更新提示，请稍后...",request:T(t),message:!0,success:a=>{e(),z()}})}})},showFooter:xe,showServer:Pe,serverRestartRef:Le,tipsList:qe,courseList:Ve,clearRestart:()=>{Ue&&clearInterval(Ue)},onRestartServer:async()=>{var e;try{ee.value.isRestart=!0,qe.value.splice(0,qe.value.length),xe.value=!1;const a=null==(e=Le.value)?void 0:e.closest(".el-dialog");if(a){const e=a.querySelector(".el-dialog__footer");a.querySelector(".el-dialog__body").style.height="49rem",e&&(e.style.display="none")}Ve.webServe=!0,await S({name:J.value.webserver,type:"stop"}),Ve.mysqlServe=!0,await S({name:"mysqld",type:"stop"}),Ve.restartServe=!0,await E(),Ve.serveStart=!0,De()}catch(a){h(a)}},onRestartPanel:async()=>{await s({icon:"warning-filled",title:"重启面板",content:"即将重启面板服务，继续吗？"}),a({loading:"正在重启面板，请稍候...",request:b(),message:!0,success:e=>{e.status&&setTimeout(()=>{n(),window.location.reload()},1e3)}})},logContent:Oe,getLog:je,hisLoading:ke,histVersion:He,getHistoryVersion:async()=>{await a({loading:ke,request:x(),data:[Array,He]})},$reset:()=>{me.value=!1,ve.value="",we.value={phone:"",status:!1}}}});export{B as H};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
