System.register(["./index-legacy113.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./utils-lib-legacy.js?v=1763689792","./validator-legacy.js?v=1763689792","./index-legacy104.js?v=1763689792","./column-legacy.js?v=1763689792","./__commonjsHelpers__-legacy.js?v=1763689792"],(function(e,t){"use strict";var n,s,i,a,r,c,l,o,d,m,u,g,b,f,p,y,v,_,k,x,L,w,j,O,h,S;return{setters:[function(e){n=e._},function(e){s=e.c,i=e.h,a=e.o,r=e.aB,c=e.k,l=e.l,o=e.p,d=e.I,m=e.q,u=e.J,g=e.v,b=e.e,f=e.x,p=e.y,y=e.aY,v=e.F,_=e.z,k=e.b7,x=e.A,L=e.aO},function(e){w=e.u,j=e.a7,O=e.M,h=e.d,S=e.e},null,null,null,null],execute:function(){var t={class:"p-2rem"},T={class:"scanHead flex justify-between mb-2rem"},H={class:"scanHead__left flex"},F={class:"w-[8rem] h-[8rem]"},J={class:"pt-[2rem] pl-2rem w-[40rem]"},M=["innerHTML"],B={class:"text-[#666] mt-1rem"},C={class:"scanHead__right pt-[2.6rem]"},N={class:"scanBody h-[50rem] overflow-auto"},I=["onClick"],E={class:"text-[1.4rem] font-bold leading-[3.5rem]"},W={key:0,class:"flex"},P={key:0,class:"text-danger"},q={key:1},z={key:2,class:"text-primary"},A={class:"scanBody__content mb-[2rem] mx-[2rem]"},Y={class:"scanBody__content__title border-b border-[#ececec] pb-[.4rem] mb-[.4rem]"},D={class:"scanBody__content__desc flex border-b border-[#ececec] pb-[.4rem] mb-[.4rem]"},G=["innerHTML"],K={class:"scanBody__content__repair flex"},Q=["innerHTML"];e("default",S(s({__name:"images-safe-scan-dialog",setup:function(e){var s=w().payment,S={title:"容器安全一键检测-功能介绍",ps:"检测敏感信息、后门、漏洞、可疑操作等常见风险。",source:151,desc:["异常历史命令","敏感信息泄露","后门排查","容器逃逸"],tabImgs:[{title:"容器检测",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/docker/dockerContainerScan.png"}]},R=[{color:"#ff0000",percentage:20},{color:"#ff0000",percentage:40},{color:"#fc6d26",percentage:60},{color:"#fc6d26",percentage:80},{color:"#20a53a",percentage:100}],U=i({title:"立即进行镜像检测,确保您的项目安全。",isFirst:!0,isScan:!1,isEnd:!1,iconType:"normal",detect:0,imageList:[],msg:"",btnObj:{text:"一键检测",type:"primary",disabled:!1},score:100,scanTime:0}),V=[],X=0,Z=null,$=function(e){return e+"分"},ee=null,te=function(){var e;null===(e=ee)||void 0===e||e.close(),ee=j({route:"/ws_model",onMessage:ne})},ne=function(e,t){var n=JSON.parse(t.data);if(n.hasOwnProperty("image_list"))return U.imageList=n.image_list.map((function(e){return e.active=!1,e})),void(V=JSON.parse(JSON.stringify(n.image_list)));if(n.hasOwnProperty("end")){U.msg=n.msg,U.score=U.score-n.score;var s,i=U.imageList[X-1];1!=n.status&&(U.detect++,null==i.riskList&&(i.riskList=[]),null===(s=i.riskList)||void 0===s||s.push(n)),n.end&&X>0&&(void 0===i.riskList&&(i.noWarring=!0),ie())}},se=function(){if(X=0,U.scanTime=0,U.detect=0,U.score=100,Z=setInterval((function(){U.scanTime++}),1e3),U.isFirst){if(0==U.imageList.length)return O.error("请先添加镜像");U.isScan||te(),ie(),U.isScan=!0,U.isFirst=!1,ae("scan")}else{var e;U.isScan?(null===(e=ee)||void 0===e||e.close(),re()):(U.imageList=JSON.parse(JSON.stringify(V)),ie(),U.isScan=!0,ae("scan"))}},ie=function(){var e;X<U.imageList.length?(null===(e=ee)||void 0===e||e.send({model_index:"btdocker",mod_name:"security",def_name:"image_safe_scan",image_id:U.imageList[X].id,ws_callback:"123"}),X++):(U.isScan=!1,U.isEnd=!0,U.imageList=U.imageList.sort((function(e,t){return e.noWarring?1:t.noWarring?-1:0})),clearInterval(Z),ae("end"))},ae=function(e){switch(e){case"scan":U.title="正在检测镜像，请稍候...",U.isEnd=!1,U.btnObj.text="取消检测",U.btnObj.type="default";break;case"restart":U.title="立即进行镜像检测,确保您的项目安全。",U.btnObj.text="重新检测",U.btnObj.type="primary";break;case"end":var t="";t=0==U.detect?"未发现安全漏洞":'一共发现<span class="text-[#fc6d26]">'.concat(U.detect,"</span>项风险"),U.title="检测完成,"+t,U.msg="检测完成，共耗时"+U.scanTime+"秒",U.btnObj.text="重新检测",U.btnObj.type="primary"}},re=function(){U.title="立即进行镜像检测,确保您的项目安全。",U.msg="",U.isFirst=!0,U.isScan=!1,U.isEnd=!1,U.iconType="normal",U.detect=0,U.imageList=JSON.parse(JSON.stringify(V)),U.btnObj.text="一键检测",U.btnObj.type="primary",U.btnObj.disabled=!1,U.score=100};return a((function(){var e;te(),null===(e=ee)||void 0===e||e.send({model_index:"btdocker",mod_name:"security",def_name:"get_image_list",ws_callback:"123"})})),r((function(){clearInterval(Z)})),function(e,i){var a=h,r=k,w=x,j=L,O=n;return c(),l("section",t,["ltd"===o(s).authType?(c(),l(d,{key:0},[m("div",T,[m("div",H,[m("div",F,[o(U).isFirst&&!o(U).isScan?(c(),u(a,{key:0,class:"w-full",src:"/firewall/icon-safe-detect.svg"})):(c(),u(r,{key:1,type:"circle",percentage:o(U).score,format:$,color:R,width:80},null,8,["percentage"]))]),m("div",J,[m("div",{class:"text-[1.8rem] font-bold",innerHTML:o(U).title},null,8,M),m("div",B,g(o(U).msg.length>35?o(U).msg.substring(0,35)+"...":o(U).msg),1)])]),m("div",C,[b(w,{type:o(U).btnObj.type,disabled:o(U).btnObj.disabled,onClick:se},{default:f((function(){return[p(g(o(U).btnObj.text),1)]})),_:1},8,["type","disabled"])])]),m("div",N,[(c(!0),l(d,null,y(o(U).imageList,(function(e,t){return c(),l("div",{key:t,class:v(["bg-[#FCFCFC] mb-1rem",e.active?"active":""])},[m("div",{class:"scanBody__title flex justify-between cursor-pointer rounded-[0.4rem] px-[2rem] h-[3.5rem] leading-[3.5rem] text-[1.3rem]",onClick:function(e){return n=t,void(U.imageList[n].active=!U.imageList[n].active);var n}},[b(j,{class:"item",effect:"dark",content:e.name,placement:"top-start"},{default:f((function(){return[m("span",E,g(e.name.length>50?e.name.substring(0,50)+"...":e.name),1)]})),_:2},1032,["content"]),o(U).isEnd||o(U).isScan?(c(),l("div",W,[e.riskList&&e.riskList.length>0?(c(),l("span",P,"发现"+g(e.riskList.length)+"项风险",1)):e.noWarring||e.riskList?(c(),l("span",z,"无风险项")):(c(),l("span",q,"检测中")),b(a,{src:"/firewall/arrow-down.svg",class:"w-[1.6rem] ml-2rem"})])):_("",!0)],8,I),m("div",A,[(c(!0),l(d,null,y(e.riskList,(function(e,t){return c(),l("div",{key:t,class:"bg-[#ff00000a] text-[#666] py-1rem px-[1.5rem] mb-[0.8rem] rounded-[0.4rem]"},[m("div",Y,g(e.msg),1),m("div",D,[i[0]||(i[0]=m("span",{class:"w-[6rem] flex-shrink-0 inline-block"},"详情：",-1)),m("span",{innerHTML:e.detail},null,8,G)]),m("div",K,[i[1]||(i[1]=m("span",{class:"w-[6rem] flex-shrink-0 inline-block"},"修复方案：",-1)),m("span",{innerHTML:e.repair},null,8,Q)])])})),128))])],2)})),128))])],64)):(c(),u(O,{key:1,data:S}))])}}}),[["__scopeId","data-v-dbc8284b"]]))}}}));
