!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=["dst_node_idx"];function n(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,l,u=[],i=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=o.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(c)throw a}}return u}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function s(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var i=r&&r.prototype instanceof u?r:u,c=Object.create(i.prototype);return d(c,"_invoke",function(n,r,a){var o,u,i,c=0,s=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,u=0,i=e,f.n=n,l}};function p(n,r){for(u=n,i=r,t=0;!d&&c&&!a&&t<s.length;t++){var a,o=s[t],p=f.p,v=o[2];n>3?(a=v===r)&&(i=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=n<2&&p<o[1])?(u=0,f.v=r,f.n=o[1]):p<v&&(a=n<3||o[0]>r||r>v)&&(o[4]=n,o[5]=r,f.n=v,u=0))}if(a||n>1)return l;throw d=!0,r}return function(a,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&p(s,v),u=s,i=v;(t=u<2?e:i)||!d;){o||(u?u<3?(u>1&&(f.n=-1),p(u,i)):f.n=i:f.v=i);try{if(c=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(d=f.n<0)?i:n.call(r,f))!==l)break}catch(t){o=e,u=1,i=t}finally{c=1}}return{value:t,done:d}}}(n,a,o),!0),c}var l={};function u(){}function i(){}function c(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(d(t={},r,function(){return this}),t),p=c.prototype=u.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,d(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return i.prototype=c,d(p,"constructor",c),d(c,"constructor",i),i.displayName="GeneratorFunction",d(c,a,"GeneratorFunction"),d(p),d(p,a,"Generator"),d(p,r,function(){return this}),d(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:o,m:v}})()}function d(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}d=function(e,t,n,r){function o(t,n){d(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},d(e,t,n,r)}function f(e,t,n,r,a,o,l){try{var u=e[o](l),i=u.value}catch(e){return void n(e)}u.done?t(i):Promise.resolve(i).then(r,a)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function l(e){f(o,r,a,l,u,"next",e)}function u(e){f(o,r,a,l,u,"throw",e)}l(void 0)})}}System.register(["./utils-lib-legacy.js?v=1763689792","./index-legacy109.js?v=1763689792","./index-legacy118.js?v=1763689792","./base-lib-legacy.js?v=1763689792","./column-legacy.js?v=1763689792","./index-legacy119.js?v=1763689792","./index-legacy123.js?v=1763689792","./form-item-legacy.js?v=1763689792","./validator-legacy.js?v=1763689792","./useController-legacy11.js?v=1763689792","./useStore-legacy10.js?v=1763689792","./index-legacy107.js?v=1763689792"],function(e,l){"use strict";var u,c,d,f,v,m,h,y,b,g,_,w,k,x,S,C,j,O,P,T,V,A,E,U,q,I,L,D,R,G,N,z,B,F,H,M,W,J,Q,$,K,Z,X,Y,ee,te,ne,re,ae,oe,le,ue,ie,ce,se,de,fe,pe,ve,me,he,ye,be,ge,_e,we,ke,xe,Se,Ce,je,Oe,Pe,Te,Ve,Ae,Ee,Ue,qe,Ie,Le,De,Re,Ge,Ne,ze,Be,Fe,He,Me;return{setters:[function(e){u=e.Q,c=e.hh,d=e.W,f=e.n,v=e.H,m=e.V,h=e.p,y=e.hi,b=e.hj,g=e.hk,_=e.P,w=e.l,k=e.ah,x=e.y,S=e.an,C=e.hl,j=e.hm,O=e.E,P=e.hn,T=e.aA,V=e.ho,A=e.u,E=e.M,U=e.gR,q=e.hp,I=e.eG,L=e.L,D=e.hq,R=e.k,G=e.ay,N=e._,z=e.aC},function(e){B=e._},function(e){F=e._},function(e){H=e.s,M=e.j,W=e.r,J=e.o,Q=e.W,$=e.c,K=e.v,Z=e.a8,X=e.I,Y=e.x,ee=e.y,te=e.e,ne=e.C,re=e.A,ae=e.z,oe=e.D,le=e.J,ue=e.H,ie=e.be,ce=e.aT,se=e.bO,de=e.F,fe=e.bP,pe=e.i,ve=e.bQ,me=e.aQ,he=e.an,ye=e.am,be=e.U,ge=e.ag,_e=e.V,we=e.Z,ke=e.g,xe=e.w,Se=e.n,Ce=e.aH,je=e.$,Oe=e.B,Pe=e.R,Te=e.K,Ve=e.b1,Ae=e.ay,Ee=e.O},function(e){Ue=e.a,qe=e.u,Ie=e.c},function(e){Le=e.B},function(e){De=e._},function(e){Re=e.b,Ge=e.e,Ne=e.h,ze=e.j},function(e){Be=e.f},function(e){Fe=e.e},function(e){He=e.u},function(e){Me=e._}],execute:function(){var We=M("NODE-SCRIPT-MASS-STORE",function(){return{activeTabs:W("script-distribute"),contentType:W("byCustom"),isExecute:W(!1),isCanReset:W(!1),currentTaskId:W(0),taskList:W([])}},{persist:{storage:localStorage,paths:["taskList","isCanReset","currentTaskId"]}}),Je=function(){return H(We())},Qe=J({p:1,limit:20,search:"",script_type:"all",group_id:"-1"}),$e=W();W(!1);var Ke,Ze=W(0),Xe=W([]),Ye=W(!1),et=W([]),tt=function(){var e=p(s().m(function e(t){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,h({title:"删除脚本",icon:"warning-filled",content:"删除后脚本信息不可恢复,是否继续操作？"});case 1:return e.n=2,u({loading:"正在删除脚本,请稍后...",request:y(t),message:!0,success:nt});case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=p(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({loading:Ye,request:c(Qe),data:{data:[Array,Xe],page:d(Ze)}});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),rt=function(e,t,n){if(st(),e){var r=t.id,a=t.name,o=t.content,u=t.description,i=t.script_type;Object.assign(it,{name:a,id:r,script_type:i,content:o,description:u})}var c;f({title:(e?"编辑":"创建")+"脚本",area:57,component:function(){return v(function(){return l.import("./add-script-legacy.js?v=1763689792")},void 0,l.meta.url)},onConfirm:(c=p(s().m(function t(){var r;return s().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,ct(!!e,!!n);case 1:return(r=t.v)&&(null==n||n()),t.a(2,r)}},t)})),function(){return c.apply(this,arguments)}),showFooter:!0})},at=[{label:"删除脚本",value:"delete",event:(Ke=p(s().m(function e(t,n){var r;return s().w(function(e){for(;;)switch(e.n){case 0:return r=function(){var e=p(s().m(function e(t){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y({id:t.id});case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t({title:"批量删除",content:"即将删除所选中的数据，是否继续操作?",column:[{prop:"name",label:"脚本名称"},Ie()],onConfirm:function(){var e=p(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n(r);case 1:return nt(),e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)})),function(e,t){return Ke.apply(this,arguments)})}];W();var ot=J({title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""}),lt=e("b",W()),ut=J({args_title:"",args_ps:""}),it=e("a",J({name:"",content:"",script_type:"shell",description:""})),ct=(e("h",[]),e("c",J({name:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],content:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]})),function(){var e=p(s().m(function e(t,n){var r,a,o;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,lt.value.validate();case 1:return r=i({},it),t||delete r.id,a=t?b:g,e.n=2,u({loading:"正在".concat(t?"编辑":"创建","脚本，请稍后..."),request:a(r),message:!0,success:function(e){e.status&&st(),!0!==n&&nt()}});case 2:return o=e.v,e.a(2,o.status)}},e)}));return function(t,n){return e.apply(this,arguments)}}()),st=function(){Object.assign(it,{name:"",content:"",script_type:"shell",description:"",id:""}),Object.assign(ut,{args_title:"",args_ps:""}),Object.assign(ot,{title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""})},dt=function(){Xe.value=[],et.value=[]},ft={class:"flex items-center"},pt={class:"flex items-center"},vt=$({__name:"index",setup:function(e,t){var n=t.expose,r=Q([Ue(),{label:"名称",prop:"name"},{label:"类型",prop:"script_type"},{label:"创建时间",render:function(e){return m(e.updated_at)}},{label:"备注",prop:"description",showOverflowTooltip:!0},qe([{onClick:function(e){return rt(!0,e)},title:"编辑"},{onClick:tt,title:"删除"}])]);return K(p(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:nt();case 1:return e.a(2)}},e)}))),Z(dt),n({init:nt}),function(e,t){var n=ue,o=_,l=w,u=k,i=F,c=B,s=X("bt-loading");return Y(),ee("div",null,[te(c,null,{"header-left":ne(function(){return[re("div",ft,[te(n,{onClick:t[0]||(t[0]=function(e){return ae(rt)()}),type:"primary"},{default:ne(function(){return a(t[4]||(t[4]=[oe("创建脚本",-1)]))}),_:1})])]}),"header-right":ne(function(){return[re("div",pt,[te(o,{modelValue:ae(Qe).search,"onUpdate:modelValue":t[1]||(t[1]=function(e){return ae(Qe).search=e}),class:"ml-12px !w-[32rem]",placeholder:"请输入搜索关键字",onSearch:ae(nt)},null,8,["modelValue","onSearch"])])]}),content:ne(function(){return[le(te(l,{ref_key:"scriptTableRef",ref:$e,column:ae(r),data:ae(Xe)},null,8,["column","data"]),[[s,ae(Ye)],[s,"正在加载中，请稍后...","title"]])]}),"footer-left":ne(function(){return[te(u,{"table-ref":ae($e),options:ae(at)},null,8,["table-ref","options"])]}),"footer-right":ne(function(){return[te(i,{total:ae(Ze),page:ae(Qe).p,"onUpdate:page":t[2]||(t[2]=function(e){return ae(Qe).p=e}),row:ae(Qe).limit,"onUpdate:row":t[3]||(t[3]=function(e){return ae(Qe).limit=e}),onChange:ae(nt)},null,8,["total","page","row","onChange"])]}),_:1})])}}});var mt=$({name:"Editor",props:{modelValue:{type:String,default:""},type:{type:String,default:"shell"}},setup:function(e){var t=ve(e,"modelValue"),n={mode:"ace/mode/".concat("python"===e.type?"python":"sh"),theme:O.value?"ace/theme/clouds_midnight":"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!0,fontSize:"12px"};return function(){return te("div",null,[te(Le,{class:"!h-[36rem] !w-[70rem]",modelValue:t.value,"onUpdate:modelValue":function(e){return t.value=e},editorOption:n},null)])}}}),ht=$({name:"Collapse",props:{modelValue:{type:Boolean,default:!1}},setup:function(e,t){var n=t.slots,r=ve(e,"modelValue"),a=W(null),o=function(e){e.style.height="0"},l=function(e){e.style.height=e.scrollHeight+"px"},u=function(e){e.style.height="auto"},i=function(e){e.style.height=e.scrollHeight+"px"},c=function(e){e.offsetHeight,e.style.height="0"},s=function(e){e.style.height="0"};return function(){return te("div",null,[te(me,{onBeforeEnter:o,onEnter:l,onAfterEnter:u,onBeforeLeave:i,onLeave:c,onAfterLeave:s},{default:function(){var e;return[r.value&&te("div",{ref:a,class:"collapse-content mt-[1.2rem]",style:{overflow:"hidden",transition:"height 0.3s ease"}},[null===(e=n.default)||void 0===e?void 0:e.call(n)])]}})])}}}),yt=function(e){var l=e.task_type;function i(e){var a,l=new Map,u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,u=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,l=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw l}}}}(e);try{for(u.s();!(a=u.n()).done;){var i=a.value,c=i.dst_node_idx,s=n(i,t);l.has(c)||l.set(c,[]),l.get(c).push(s)}}catch(d){u.e(d)}finally{u.f()}return Array.from(l,function(e){var t=r(e,2);return{dst_node_idx:t[0],data:t[1]}})}var c,d=S({request:(c=p(s().m(function t(){var n,r,a;return s().w(function(t){for(;;)switch(t.n){case 0:if(n=e.result){t.n=3;break}return t.n=1,u({request:"command"===e.task_type?C({task_id:e.id}):j({task_id:e.id})});case 1:if((r=t.v).status){t.n=2;break}return t.a(2,{data:[],total:0});case 2:n=r.data.data.data;case 3:return a=function(t){if("command"===e.task_type){var n=(null==t?void 0:t.sort(function(e,t){return e.dst_node_idx-t.dst_node_idx}))||[];return{data:n,total:n.length}}var r=i(t)||[];return{data:r,total:r.length}},t.a(2,a(n))}},t)})),function(){return c.apply(this,arguments)}),columns:[].concat(a("command"===e.task_type?[]:[{type:"expand",render:function(e){return te("div",{class:"px-[1.2rem]"},[e.data.map(function(e){var t=function(e){var t={color:"var(--el-color-text-secondary)",content:"等待执行"};switch(e){case 0:t.color="var(--el-color-text-secondary)",t.content="等待中";break;case 1:t.color="var(--el-color-text-secondary)",t.content="进行中";break;case 2:t.color="var(--el-color-success)",t.content="执行成功";break;case 3:t.color="var(--el-color-danger)",t.content="执行失败";break;case 4:t.color="var(--el-color-warning)",t.content="command"===l?"异常":"跳过"}return te("span",{style:{color:t.color}},[t.content])}(e.status);return te("div",{class:"flex items-center justify-between border-b py-[.8rem]"},[te("div",{class:"w-[600px] truncate",title:e.dst_file},[e.dst_file]),te("div",null,[t])])})])}}]),[{label:"节点地址",prop:"ssh_host",width:"command"===e.task_type?195:670,render:function(t){return"command"===e.task_type?t.ssh_host:e.dst_nodes[t.dst_node_idx].name}}],a("command"===e.task_type?[{label:"状态",width:80,render:function(e){var t={color:"var(--el-color-text-secondary)",content:"等待执行"};switch(e.status){case 0:t.color="var(--el-color-text-secondary)",t.content="等待中";break;case 1:t.color="var(--el-color-text-secondary)",t.content="进行中";break;case 2:t.color="var(--el-color-success)",t.content="执行成功";break;case 3:t.color="var(--el-color-danger)",t.content="执行失败";break;case 4:t.color="var(--el-color-warning)",t.content="command"===l?"异常":"跳过"}return te("span",{style:{color:t.color}},[t.content])}},qe([{title:"查看详情",width:80,onClick:function(e){xt(e.log_name,e.message,function(){})}}])]:[]))}),v=d.BtTable;f({title:"任务详情",area:"command"===e.task_type?40:75,component:function(){return te("div",{class:"p-[1.2rem]"},[te(v,{"max-height":300},null)])}})},bt=$({name:"TaskCard",props:{task:{type:Object,default:function(){return{}}},index:{type:Number,default:0},type:{type:String,default:"execute"}},emits:["edit"],setup:function(e,t){var n=t.emit,r=Je(),a=r.isExecute,o=r.taskList,l=(r.isCanReset,W(!0)),u=W(!1),c=W("show"===e.type),d={backgroundColor:"var(--el-fill-color-dark) !important",color:"var(--el-base-supplement) !important",borderColor:"var(--el-color-border-dark) !important"},v=function(t){switch(e.task.status){case 0:return{type:"info",content:"等待中"};case 1:return{type:"info",content:"进行中"};case 2:return{type:"success",content:"执行成功"};case 3:return{type:"danger",content:"执行失败"};case 4:return"command"===e.task.task_type?{type:"danger",content:"异常"}:{type:"danger",content:"执行失败"}}if(a.value&&void 0===t)return{type:"info",content:"执行中"};switch(t){case"success":return{type:"success",content:"执行成功"};case"error":return{type:"danger",content:"执行失败"}}return{type:"info",content:"等待执行"}};return function(){var t;return te("div",{class:"border border-light rounded-large p-[1.2rem] mb-[1.6rem] box-shadow-[0_0.1rem_0.3rem_rgba(0,0,0,0.1)] task-card"},[te("div",{class:"flex items-center justify-between py-[.8rem] h-[3rem] cursor-pointer",onClick:function(){return l.value=!l.value}},[te("div",{class:"flex items-center"},[!e.task.status&&!a.value&&!c.value&&te("i",{class:"svgtofont-icon-drag cursor-move mover align-middle mr-[.8rem]"},null),te("div",{class:"text-medium font-bold max-w-[40rem] truncate"},[e.task.name]),te("div",{class:"flex items-center gap-[.8rem] ml-[1.2rem]"},[te(ie,{type:"warning",style:"command"===e.task.task_type?d:{}},{default:function(){return["command"===e.task.task_type?"命令任务":"文件任务"]}}),te(ie,{type:v(e.task.status).type},{default:function(){return[v(e.task.status).content]}})]),!e.task.status&&!a.value&&!c.value&&te("div",{class:"flex items-center gap-[1.2rem] hover-btn"},[te(ce,{content:"编辑任务",placement:"top"},{default:function(){return[te(ue,{type:"default",class:"!ml-[.8rem]",style:{padding:"6px 12px !important"},size:"small",circle:!0,onClick:function(t){t.stopPropagation(),n("edit",e.task)}},{default:function(){return[te("i",{class:"svgtofont-el-edit"},null)]}})]}}),te(ce,{content:"复制任务",placement:"top"},{default:function(){return[te(ue,{type:"default",class:"!ml-0",style:{padding:"6px 12px !important"},size:"small",circle:!0,onClick:function(t){t.stopPropagation(),o.value.splice(e.index+1,0,i(i({},e.task),{},{id:x(16)}))}},{default:function(){return[te("i",{class:"svgtofont-el-document-copy"},null)]}})]}}),te(ce,{content:"删除任务",placement:"top"},{default:function(){return[te(ue,{type:"danger",class:"!ml-0",style:{padding:"6px 12px !important"},size:"small",circle:!0,onClick:(t=p(s().m(function t(n){return s().w(function(t){for(;;)switch(t.n){case 0:return n.stopPropagation(),t.n=1,h({title:"删除任务",content:"确定删除该任务吗？"});case 1:o.value=o.value.filter(function(t){return t.id!==e.task.id});case 2:return t.a(2)}},t)})),function(e){return t.apply(this,arguments)})},{default:function(){return[te("i",{class:"svgtofont-el-delete text-white"},null)]}})];var t}})])]),te("div",{class:"text-small"},[te("span",{class:l.value?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down"},null)])]),te(ht,{modelValue:l.value,"onUpdate:modelValue":function(e){return l.value=e}},{default:function(){return[te(se,{column:1,border:!0},{default:function(){return["command"===e.task.task_type?te(de,null,[te(fe,{label:"类型","label-class-name":"!w-[12rem]"},{default:function(){return[e.task.script_id?"脚本库":"自定义命令"]}}),!e.task.script_id&&te(fe,{label:"命令类型","label-class-name":"!w-[12rem]"},{default:function(){return[e.task.script_type]}}),te(fe,{label:"命令内容","label-class-name":"!w-[12rem]"},{default:function(){return[te("div",null,[te("pre",{class:"!text-small !whitespace-pre-wrap"},[u.value?e.task.script_content:e.task.script_content.length>120?e.task.script_content.substring(0,120)+"...":e.task.script_content]),e.task.script_content.length>120&&te("span",{class:"bt-link mt-[.8rem] text-small",onClick:function(){var t,n;e.task.script_content.length>1e3?(t=e.task.script_content,n=e.task.script_type,f({title:"命令详情",area:75,component:function(){return te("div",{class:"p-[1.2rem]"},[te(mt,{modelValue:t,"onUpdate:modelValue":function(e){return t=e},type:n},null)])}})):u.value=!u.value}},[u.value?"收起":"查看完整命令"])])]}})]):te(de,null,[te(fe,{label:"源节点","label-class-name":"!w-[12rem]"},(r=e.task,n=t=r.src_node?"".concat(r.src_node.name,"(").concat(r.src_node.address?r.src_node.address:"127.0.0.1",")"):"".concat(r.src_node_id,"(").concat(r.src_node_ip,")"),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!pe(n)?t:{default:function(){return[t]}})),e.task.path_list.map(function(e){return te(fe,{label:"传输路径","label-class-name":"!w-[12rem]"},{default:function(){return[te("div",{class:"w-full flex items-center justify-between"},[te("div",{class:"w-[41%] max-w-[34rem] truncate",title:e.path},[oe("源: "),e.path]),te("div",{class:""},[oe(">>已选择执行节点的:")]),te("div",{class:"w-[41%] max-w-[34rem] truncate",title:e.dst_path},[e.dst_path])])]}})})]),!a.value&&e.task.status||c.value?te(fe,{label:"执行结果","label-class-name":"!w-[12rem]"},{default:function(){return[te("span",{class:"bt-link",onClick:function(){return yt(e.task)}},[oe("点击查看")])]}}):null];var n,r}})]}})])}}}),gt=function(){var e=p(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({request:P(t)});case 1:return n=e.v,e.a(2,{data:n.data.data,total:T(n.data.page)})}},e)}));return function(t){return e.apply(this,arguments)}}(),_t=$({props:{task:{type:Object,default:function(){}}},setup:function(e){var t=W(!0);return function(){return te("div",{class:"p-[1.2rem]"},[te("div",{class:"p-[1.2rem] border border-dark rounded-large mb-[1.2rem]"},[te("div",{class:"flex items-center justify-between py-[.8rem] h-[3rem] cursor-pointer",onClick:function(){return t.value=!t.value}},[te("div",{class:"text-medium font-bold"},[oe("执行节点")])]),te(ht,{modelValue:t.value,"onUpdate:modelValue":function(e){return t.value=e}},{default:function(){return[te("div",{class:"grid grid-cols-4 gap-[1.4rem] max-h-[30rem] overflow-y-auto"},[e.task.server_list.map(function(e){return te("div",{key:e.id,class:"flex items-center p-3 border border-dark rounded-base transition-all  max-w-[24rem] duration-200 hover:shadow-md"},[te("div",{class:"flex-1 min-w-0"},[te("div",{class:"flex items-center gap-2 mb-[.5rem]"},[te("span",{class:"text-base h-[2rem] flex items-center truncate",title:e.name},[e.name])]),te("div",{class:"text-small font-mono text-tertiary"},[e.server_ip])])])})])]}})]),te("div",{class:"p-[1.2rem] border border-dark rounded-large"},[te("div",{class:"flex items-center justify-between py-[.8rem] h-[3rem] mb-[1.2rem]"},[te("div",{class:"text-medium font-bold"},[oe("任务列表")])]),e.task.steps.map(function(e){return te(bt,{key:e.id,task:e,type:"show"},null)})])])}}}),wt=function(e){f({title:"执行记录",area:110,component:function(){return te(_t,{task:e},null)}})},kt=$({props:{logName:{type:String,default:""},content:{type:String,default:""}},setup:function(e){var t=W(e.content||"获取中..."),n=function(){var n=p(s().m(function n(){var r,a;return s().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,V({path:"/www/server/panel/logs/executor_log/"+e.logName});case 1:r=n.v,a=r.data,t.value=a.data;case 2:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}();return e.content||n(),function(){return te("div",{class:"flex-wrap"},[te(De,{class:"h-[40rem] !rounded-none",content:t.value},null)])}}}),xt=function(){var e=p(s().m(function e(t,n,r){return s().w(function(e){for(;;)switch(e.n){case 0:f({title:"执行记录",component:function(){return te(kt,{logName:t,content:n},null)},area:55,onCancel:r});case 1:return e.a(2)}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),St={class:"relative"},Ct=$({__name:"index",setup:function(e,t){var n=t.expose,r=A().mainHeight,o=S({request:function(e){return gt(e)},columns:[{label:"执行时间",prop:"updated_at",width:160,render:function(e){return m(e.updated_at)}},{label:"执行节点",prop:"size",width:300,render:function(e){var t=e.server_list[0].name;return"".concat(t).concat(e.server_list.length>1?"等".concat(e.server_list.length,"个节点"):"")}},{label:"执行任务",prop:"script_content",showOverflowTooltip:!0,render:function(e){return e.steps.map(function(e){return e.name}).join("，")}},qe([{onClick:wt,width:80,title:"执行结果"}])]}),l=o.BtTable,u=o.BtPage;return n({init:o.refresh}),function(e,t){var n=B;return Y(),ee("div",St,[te(n,null,{"header-left":ne(function(){return a(t[0]||(t[0]=[re("div",{class:"flex items-center"},null,-1)]))}),"header-right":ne(function(){return a(t[1]||(t[1]=[]))}),content:ne(function(){return[te(ae(l),{"max-height":ae(r)-320},null,8,["max-height"])]}),"footer-left":ne(function(){return a(t[2]||(t[2]=[]))}),"footer-right":ne(function(){return[te(ae(u))]}),popup:ne(function(){return a(t[3]||(t[3]=[]))}),_:1})])}}});var jt=$({name:"ServerSelector",props:{value:{type:Array,default:function(){return[]}},options:{type:Array,default:function(){return[]}}},emits:["goAddNode","refresh"],setup:function(e,t){var n=t.emit,r=function(e){var t=we(e,"value"),n=we(e,"options"),r=W(e.options),o=W([]),l=He().nodeCategory,u=ke(function(){return l.value.filter(function(e){return"0"!==e.value&&"all"!==e.value})});K(function(){Fe()}),xe(n,function(){i()});var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=n.value.filter(function(e){return!e.is_local});o.value&&o.value.length>0&&(t=t.filter(function(e){return o.value.includes(e.category_id.toString())})),e&&(t=t.filter(function(t){var n;return t.remarks.toLowerCase().includes(e.toLowerCase())||(null===(n=t.address)||void 0===n?void 0:n.includes(e))})),r.value=t};return{selectedServers:t,filteredServers:r,filterServer:function(e){i(e)},handleServerToggle:function(e){t.value.includes(e)?t.value=t.value.filter(function(t){return t!==e}):t.value=[].concat(a(t.value),[e])},selectAllServers:function(){t.value=r.value.map(function(e){return e.id})},invertSelection:function(){var e=r.value.map(function(e){return e.id}),n=e.filter(function(e){return!t.value.includes(e)}),o=t.value.filter(function(t){return!e.includes(t)});t.value=[].concat(a(o),a(n))},clearSelection:function(){t.value=[]},serverGroups:u,selectedGroup:o,handleGroupChange:function(e){o.value=e,i()}}}(e),o=r.selectedServers,u=r.filteredServers,i=r.filterServer,c=r.selectAllServers,s=r.invertSelection,d=r.clearSelection,p=r.serverGroups,m=r.selectedGroup,h=r.handleGroupChange,y="";return function(){var e,t;return te("div",{class:"p-[1.2rem] border border-dark rounded-large space-y-3"},[te("div",{class:"flex flex-col sm:flex-row gap-2"},[te(he,{class:"!w-[20rem]",placeholder:"分组筛选",clearable:!0,multiple:!0,"collapse-tags":!0,"max-collapse-tags":1,modelValue:m.value,"onUpdate:modelValue":function(e){return m.value=e},onChange:h},(t=e=p.value.map(function(e){return te(ye,{key:e.value,value:e.value,label:e.label},null)}),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!pe(t)?e:{default:function(){return[e]}})),te("div",{class:"relative w-full max-w-[36rem]"},[te(be,{type:"text",placeholder:"搜索节点",modelValue:y,"onUpdate:modelValue":function(e){return y=e},clearable:!0,onInput:i,onClear:function(){return i("")}},null)]),te("div",{class:"flex gap-2"},[te(ue,{type:"default",onClick:c},{default:function(){return[oe("全选")]}}),te(ue,{type:"default",onClick:s},{default:function(){return[oe("反选")]}}),te(ue,{type:"default",onClick:d},{default:function(){return[oe("清空")]}})])]),te("div",{class:"max-h-[20rem] overflow-y-auto"},[u.value.length>0?te(ge,{modelValue:o.value,"onUpdate:modelValue":function(e){return o.value=e}},{default:function(){return[te("div",{class:"grid grid-cols-4 gap-[1.4rem]"},[u.value.map(function(e){var t,r=(null===(t=p.value.find(function(t){return t.value===e.category_id}))||void 0===t?void 0:t.label)||"未分组",u=o.value.includes(e.id),i=e.server_ip||e.ip,c=!e.has_ssh;return te(ce,{placement:"top",effect:"dark",content:"点击关联SSH",disabled:!c},{default:function(){return[te("div",{key:e.id,class:"flex items-center p-3 border rounded-base transition-all cursor-pointer max-w-[24rem] duration-200 hover:shadow-md ".concat(u?"border-primary":c?"":"border-light hover:border-dark"," ").concat(c?"opacity-50":""),onClick:function(){c?f({title:"添加root账号信息",area:50,compData:{node_id:e.id,server_ip:e.server_ip,ssh_conf:{},callback:function(){n("refresh")}},btn:["保存"],component:function(){return v(function(){return l.import("./ssh-edit-legacy.js?v=1763689792")},void 0,l.meta.url)}}):o.value=u?o.value.filter(function(t){return t!==e.id}):[].concat(a(o.value),[e.id])}},[te(_e,{class:"mr-3 pointer-events-none",value:e.id,checked:u,disabled:c},null),te("div",{class:"flex-1 min-w-0"},[te("div",{class:"flex items-center gap-2 mb-[.5rem]"},[te("span",{class:"text-base h-[2rem] flex items-center truncate",title:e.remarks},[e.remarks]),te("span",{class:"w-3 h-3 rounded-full ".concat(0===e.error_num?"bg-success":"bg-danger")},null)]),te("div",{class:"text-small font-mono text-darkTertiary"},[i])]),te("div",{class:"text-small text-right min-w-0"},[te("div",{class:"font-medium truncate",title:r},[r])])])]}})})])]}}):te("div",{class:"col-span-full p-4 text-center text-secondary text-small"},[oe("暂无数据,"),te("span",{class:"bt-link",onClick:function(){return n("goAddNode")}},[oe("前往添加节点")])])])])}}}),Ot=$({name:"ContentSelect",props:{modelValue:{type:Number||void 0,default:void 0},scriptType:{type:String,default:"shell"},content:{type:String,default:""}},setup:function(e,t){var n=t.expose,r=ve(e,"modelValue"),a=ve(e,"scriptType"),o=ve(e,"content"),l=W([]),i=W([]),s=[],d=function(){l.value=[],i.value=[],u({request:c({p:"1",limit:"200"}),success:function(e){e.status&&(s=e.data.data,e.data.data.forEach(function(e){"shell"===e.script_type?l.value.push({label:e.name,value:e.id,content:e.content}):"python"===e.script_type&&i.value.push({label:e.name,value:e.id,content:e.content})}))}})};return d(),n({getScriptData:d}),function(){return te("div",{class:"flex items-center gap-[1.2rem]"},[te(he,{class:"!w-[50rem]",placeholder:"请选择脚本",filterable:!0,modelValue:r.value,"onUpdate:modelValue":function(e){return r.value=e},onChange:function(e){var t=s.find(function(t){return t.id===e});t&&(o.value=t.content||"")}},{default:function(){return["shell"===a.value?l.value.map(function(e){return te(ce,{"popper-class":"!max-w-[35rem]",placement:"right"},{default:function(){return te(ye,{key:e.value,value:e.value,label:e.label},{default:function(){return[te("span",{class:"truncate max-w-[20rem]"},[e.label])]}})},content:function(){return te("pre",{class:"whitespace-pre-wrap"},[e.content.length>120?e.content.substring(0,120)+"...":e.content])}})}):i.value.map(function(e){return te(ce,{"popper-class":"!max-w-[35rem]",placement:"right"},{default:function(){return te(ye,{key:e.value,value:e.value,label:e.label},{default:function(){return[te("span",{class:"truncate max-w-[20rem]"},[e.label])]}})},content:function(){return te("pre",{class:"whitespace-pre-wrap"},[e.content.length>120?e.content.substring(0,120)+"...":e.content])}})})]}}),te("span",{class:"bt-link",onClick:function(){return rt(!1,void 0,d)}},[oe("创建脚本")])])}}}),Pt=function(){var e=p(s().m(function e(t,n){var r,o,l,u,c,d,v,m,h,y,b,g;return s().w(function(e){for(;;)switch(e.n){case 0:return r=[{label:"执行命令",value:"cmd"},{label:"发送文件",value:"file"}],o=[{label:"脚本库",value:"bySelect"},{label:"自定义命令",value:"byCustom"}],l=[{label:"Shell",value:"shell"},{label:"Python",value:"python"}],u=W(),c=W(!!n),d=W([]),v=L({data:function(){var e;return{name:(null==n?void 0:n.name)||"",taskType:"file"===(null==n?void 0:n.task_type)?"file":"cmd",script_content:(null!=n&&n.script_id?"":null==n?void 0:n.script_content)||"",cmd_type:c.value?null!=n&&n.script_id?"bySelect":"byCustom":"bySelect",script_type:(null!=n&&n.script_id?"shell":null==n?void 0:n.script_type)||"shell",script_id:(null==n?void 0:n.script_id)||void 0,source_node:(null==n?void 0:n.src_node_id)||void 0,pathArray:(null==n||null===(e=n.path_list)||void 0===e?void 0:e.map(function(e){return{key:e.key||x(16),sourcePath:e.path,isDir:e.is_dir,targetPath:e.dst_path}}))||[{key:x(16),sourcePath:"",isDir:!1,targetPath:""}]}},options:function(e){var t=ke(function(){return"shell"===e.value.script_type?"ace/mode/sh":"ace/mode/python"}),n=function(){var e;b();var n=null===(e=u.value)||void 0===e?void 0:e.getEditor();n&&n.session.setMode(t.value)};return ke(function(){return[Re("任务名称","name",{attrs:{placeholder:"请输入任务名称",class:"!w-[30rem]"},rules:[{required:!0,message:"请输入任务名称"}]}),Ge("任务类型","taskType",r,{attrs:{disabled:c.value}})].concat(a("cmd"===e.value.taskType?[Ge("来源","cmd_type",o,{attrs:{onChange:n}}),Ge("命令类型","script_type",l,{attrs:{onChange:function(){var n;if("bySelect"!==e.value.cmd_type){var r=null===(n=u.value)||void 0===n?void 0:n.getEditor();r&&r.session.setMode(t.value)}else e.value.script_id=void 0}}})].concat(a("byCustom"===e.value.cmd_type?[Ne("命令内容",function(){return te(Le,{class:"!h-[36rem] !w-[84rem]",ref:u,modelValue:e.value.script_content,"onUpdate:modelValue":function(t){return e.value.script_content=t},editorOption:{mode:t.value}},null)},"script_content",{rules:[{required:!0,message:"请输入命令内容"}]})]:[Ne("选择脚本",function(){return te(Ot,{modelValue:e.value.script_id,"onUpdate:modelValue":function(t){return e.value.script_id=t},scriptType:e.value.script_type,"onUpdate:scriptType":function(t){return e.value.script_type=t},content:e.value.script_content,"onUpdate:content":function(t){return e.value.script_content=t}},null)},"script_id",{rules:[{required:!0,message:"请选择脚本"}]})])):[ze("源节点","source_node",d.value.map(function(e){return{label:"".concat(e.remarks,"(").concat(e.server_ip,")"),value:e.id}}),{attrs:{class:"!w-[30rem]"},rules:[{required:!0,message:"请选择源节点"}]}),Ne("文件内容",function(){return te("div",null,[].concat(a(e.value.pathArray.map(function(t){return te("div",{class:"flex items-center mb-[1rem] gap-[1.2rem]"},[te(Me,{modelValue:t.sourcePath,"onUpdate:modelValue":function(e){return t.sourcePath=e},icon:"el-folder-opened",placeholder:"请选择源文件路径",readonly:!0,width:"32rem",onIconClick:(n=p(s().m(function n(){var r;return s().w(function(n){for(;;)switch(n.n){case 0:if(e.value.source_node){n.n=1;break}return null===(r=h.value)||void 0===r||r.validateField("source_node"),n.a(2);case 1:Be({type:"all",path:t.sourcePath||"/www/wwwroot",change:function(e,n){t.sourcePath=e,t.isDir="dir"===n},disabledCreate:!0,customRequest:!0,customRequestApi:function(t){return D(i(i({},t),{},{node_id:e.value.source_node}))}});case 2:return n.a(2)}},n)})),function(){return n.apply(this,arguments)})},null),te("span",null,[oe("传输到已选目标节点的:")]),te(R,{modelValue:t.targetPath,"onUpdate:modelValue":function(e){return t.targetPath=e},placeholder:"请输入目标文件路径",width:"32rem"},null),te("span",{class:"text-danger cursor-pointer",onClick:function(){e.value.pathArray=e.value.pathArray.filter(function(e){return t.key!==e.key})}},[oe("删除")])]);var n})),[te(ue,{type:"default",onClick:function(){e.value.pathArray.push({key:x(16),sourcePath:"",isDir:!1,targetPath:e.value.pathArray.length>0?e.value.pathArray[e.value.pathArray.length-1].targetPath:""})}},{default:function(){return[oe("添加传输文件")]}})]))},"filePath",{rules:[{required:!0,trigger:["blur","change"],validator:function(t,n,r){Vt(e.value.pathArray,r)}}]})]))})},submit:function(){var e=p(s().m(function e(t,r){var a,o;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r();case 1:return o=(null===(a=d.value.find(function(e){return e.id===t.value.source_node}))||void 0===a?void 0:a.server_ip)||"",Tt(t,c.value,o,null==n?void 0:n.id),e.a(2,!0)}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),m=v.BtForm,h=v.ref,y=v.submit,b=v.clearValidate,f({title:"".concat(c.value?"编辑":"添加","任务"),area:100,showFooter:!0,component:function(){return te("div",{class:"p-[1.2rem]"},[te(m,null,null)])},onConfirm:y}),e.n=1,t("file_src");case 1:g=e.v,d.value=g;case 2:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Tt=function(e,t,n,r){var a=Je(),o=a.taskList;a.currentTaskId.value=0;var l={id:x(16),task_type:"cmd"===e.value.taskType?"command":"file",name:e.value.name};switch(e.value.taskType){case"cmd":"byCustom"===e.value.cmd_type?(l.script_content=e.value.script_content,l.script_type=e.value.script_type):(l.script_id=e.value.script_id,l.script_content=e.value.script_content);break;case"file":l.src_node_id=e.value.source_node,l.src_node_ip=n,l.path_list=e.value.pathArray.map(function(e){return{path:e.sourcePath,dst_path:e.targetPath,is_dir:e.isDir}})}if(t){for(var u=0;u<o.value.length;u++)if(o.value[u].id===r){o.value[u]=i(i({},o.value[u]),l);break}}else o.value.push(l)},Vt=function(){var e=p(s().m(function e(t,n){var r,a,o,l;return s().w(function(e){for(;;)switch(e.n){case 0:if(0!=t.length){e.n=1;break}return!n&&E.error("请添加传输文件"),n&&n(new Error("请添加传输文件")),e.a(2,!1);case 1:r={},a=0;case 2:if(!(a<t.length)){e.n=7;break}o=t[a],l=!0,e.n=l===(""==o.sourcePath)?3:l===(""==o.targetPath)?4:5;break;case 3:return!n&&E.error("文件内容第".concat(a+1,"行")+"源文件路径不能为空"),n&&n(new Error("文件内容第".concat(a+1,"行")+"源文件路径不能为空")),e.a(2,!1);case 4:return!n&&E.error("文件内容第".concat(a+1,"行")+"目标文件路径不能为空"),n&&n(new Error("文件内容第".concat(a+1,"行")+"目标文件路径不能为空")),e.a(2,!1);case 5:r["".concat(o.sourcePath)]=o.targetPath;case 6:a++,e.n=2;break;case 7:return n&&n(),e.a(2,r)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),At=function(){var e,t=Je(),n=t.contentType,r=t.isExecute,a=t.taskList,o=t.isCanReset,l=t.currentTaskId,c=(e=W(),{createWebSocket:function(t,n){var r,a;null===(r=e.value)||void 0===r||r.close(),e.value=G({route:"/ws_modsoc",onMessage:n}),null===(a=e.value)||void 0===a||a.send(t)},closeWebSocket:function(){var t;null===(t=e.value)||void 0===t||t.close()}}),d=c.createWebSocket,f=c.closeWebSocket,v=W([]),m=W([]),y=W(!1),b=W(!1),g=function(){var e=p(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:if(!r.value||o.value){e.n=1;break}return e.a(2,E.error("当前存在正在执行中的任务，请先停止并清空任务"));case 1:if(!l.value){e.n=3;break}return e.n=2,h({title:"提示",content:"是否清空当前任务列表并新建任务？"});case 2:a.value=[],l.value=0,o.value=!1,r.value=!1;case 3:Pt(k);case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),_=function(){var e=p(s().m(function e(){var t,n=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!r.value){e.n=1;break}return e.a(2,E.error("当前任务正在执行，无法清空，请先停止任务"));case 1:if(!t){e.n=2;break}return e.n=2,h({title:"清空任务",content:"确定清空当前任务吗？"});case 2:S(),a.value=[];case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),w=function(){var e=p(s().m(function e(t){var n,u,c,d,p,v,m,h,y,g=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:if(c=g.length>1&&void 0!==g[1]&&g[1],b.value=!0,null===(n=t.data)||void 0===n||!n.steps){e.n=1;break}l.value=t.data.id,a.value=a.value.map(function(e,n){return i(i({},e),t.data.steps[n])}),e.n=7;break;case 1:if(null===(u=t.data)||void 0===u||!u.task_id){e.n=2;break}d=t.data,p=d.complete,v=d.error,m=d.count,h=m==v+p?v>0?"error":"success":void 0,a.value[t.data.flow_idx].status=h,t.data.data.forEach(function(e){a.value[t.data.flow_idx].result||(a.value[t.data.flow_idx].result=[]),a.value[t.data.flow_idx].result[e.log_idx]=e}),e.n=7;break;case 2:if("error"!==t.type){e.n=3;break}E.error(t.msg),l.value&&(o.value=!0),r.value=!1,f(),e.n=7;break;case 3:y=0;case 4:if(!(y<a.value.length)){e.n=6;break}if("error"!=a.value[y].status){e.n=5;break}return o.value=!0,e.a(3,6);case 5:y++,e.n=4;break;case 6:!c&&E.success("任务执行完成"),Se(function(){r.value=!1}),f();case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=p(s().m(function e(){var t,n,r=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"all",e.n=1,u({request:U({node_type:t})});case 1:if((n=e.v).status){e.n=2;break}return E.error(n.msg),e.a(2,[]);case 2:if("file_src"!==t){e.n=3;break}return e.a(2,n.data.data);case 3:v.value=n.data.data;case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=p(s().m(function e(){var t,n;return s().w(function(e){for(;;)switch(e.n){case 0:if(!r.value){e.n=1;break}return u({request:q({flow_id:l.value}),loading:"正在停止任务...",message:!0,success:function(e){e.status&&(r.value=!1,o.value=!0)}}),e.a(2);case 1:if(m.value.length||o.value){e.n=2;break}return e.a(2,E.error("请选择执行节点"));case 2:t={mod_name:"node",sub_mod_name:"executor",def_name:o.value?"retry_flow":"run_flow_task",callback:o.value?"retry_flow":"run_flow_task",data:i({},o.value?{flow_id:l.value}:{node_ids:m.value,flow_data:a.value,run_when_error:y.value})},r.value=!0,o.value=!1,n=E.load("开始创建任务..."),d(t,function(e,t){var r=JSON.parse(t.data);w(r),Se(function(){n.close()})});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),S=function(){m.value=[],o.value=!1,r.value=!1,l.value=0};return{contentType:n,serverList:v,selectedServers:m,fetchServerList:k,submit:x,init:function(){d({mod_name:"node",sub_mod_name:"executor",def_name:"flow_task_status",callback:"flow_task_status",data:{}},function(e,t){var n,r=JSON.parse(t.data);"end"!==r.type?b.value=!0:r.last_flow&&(null===(n=r.last_flow)||void 0===n?void 0:n.id)===l.value&&a.value.length>0&&(r.data=r.last_flow);w(r,!0)})},isAll:y,createTask:g,rowDrop:function(){var e,t=document.querySelector(".drug-task-list");I.create(t,{animation:500,handle:".svgtofont-icon-drag",chosenClass:"ghost",onEnd:(e=p(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:n=a.value.splice(t.oldIndex,1)[0],a.value.splice(t.newIndex,0,n);case 1:return e.a(2)}},e)})),function(t){return e.apply(this,arguments)})})},taskList:a,isShowTaskList:b,editTask:function(e){Pt(k,e)},clearTask:_,isCanReset:o,isExecute:r}},Et={class:"p-[1.2rem]"},Ut={class:"flex items-baseline"},qt={class:"ml-[2rem] text-small leading-[3rem] text-tertiary"},It={class:"ml-[2rem] text-small leading-[3rem] text-tertiary"},Lt={class:"flex items-center mt-[1.2rem]"},Dt={class:"drug-task-list mt-[1.2rem] w-[107rem]"},Rt={class:"w-[107rem]"},Gt=$({__name:"index",setup:function(e,t){var n=t.expose,r=At(),o=r.selectedServers,l=r.serverList,u=r.fetchServerList,i=r.submit,c=r.init,d=r.isAll,f=r.createTask,v=r.rowDrop,m=r.taskList,h=r.editTask,y=r.clearTask,b=r.isExecute,g=r.isCanReset,_=r.isShowTaskList,w=Ce();return je("script"),K(p(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return c(),e.n=1,u();case 1:v();case 2:return e.a(2)}},e)}))),n({init:c}),function(e,t){var n=ue,r=_e,c=Ae;return Y(),ee("div",Et,[re("div",Ut,[t[5]||(t[5]=re("h3",{class:"text-medium font-medium leading-[3rem]"},"选择执行节点:",-1)),re("span",qt,Oe("已选择".concat(ae(o).length,"个节点")),1),re("span",It,[t[4]||(t[4]=oe(Oe("关联SSH后可通过分发管理进行群发命令")+" ",-1)),re("span",{class:"bt-link ml-[.5rem]",onClick:t[0]||(t[0]=function(e){return ae(w).push("/node/node-mgt")})}," 前往添加节点 ")])]),te(ae(jt),{class:"w-[107rem]",value:ae(o),"onUpdate:value":t[1]||(t[1]=function(e){return Pe(o)?o.value=e:null}),options:ae(l),onGoAddNode:t[2]||(t[2]=function(e){return ae(w).push("/node/node-mgt")}),onRefresh:ae(u)},null,8,["value","options","onRefresh"]),re("div",Lt,[te(n,{type:"primary",onClick:ae(f)},{default:ne(function(){return a(t[6]||(t[6]=[oe("添加任务",-1)]))}),_:1},8,["onClick"]),te(n,{type:"default",class:"!hover:bg-[var(--el-color-danger-light-9)] !hover:text-danger !hover:border-[var(--el-color-danger-light-5)]",plain:"",onClick:ae(y)},{default:ne(function(){return a(t[7]||(t[7]=[oe("清空任务",-1)]))}),_:1},8,["onClick"]),te(r,{modelValue:ae(d),"onUpdate:modelValue":t[3]||(t[3]=function(e){return Pe(d)?d.value=e:null}),class:"ml-[1.2rem]"},{default:ne(function(){return a(t[8]||(t[8]=[oe("失败后继续执行",-1)]))}),_:1},8,["modelValue"])]),le(re("div",Dt,[(Y(!0),ee(de,null,Ve(ae(m),function(e,t){return Y(),Ee(ae(bt),{key:e.id,task:e,index:t,onEdit:ae(h)},null,8,["task","index","onEdit"])}),128))],512),[[Te,ae(_)]]),re("div",Rt,[le(te(n,{type:ae(b)?"danger":"primary",size:"large",class:"mt-[1.2rem] !text-base",style:{padding:"8px 16px !important"},onClick:ae(i)},{default:ne(function(){return[oe(Oe(ae(b)?"停止":ae(g)?"重新执行":"执行"),1)]}),_:1},8,["type","onClick"]),[[Te,ae(m).length>0&&ae(_)]]),le(te(c,{description:"还没有添加任务"},{default:ne(function(){return[te(n,{type:"primary",onClick:ae(f)},{default:ne(function(){return a(t[9]||(t[9]=[oe("添加第一个任务",-1)]))}),_:1},8,["onClick"])]}),_:1},512),[[Te,0===ae(m).length||!ae(_)]])])])}}}),Nt=N(Gt,[["__scopeId","data-v-69931ec1"]]),zt={class:"module-ui"},Bt=$({__name:"index",setup:function(e){var t=Je().activeTabs,n=W([{label:"分发",name:"script-distribute",lazy:!0,render:function(){return te(Nt,null,null)}},{label:"执行日志",name:"mass-table",lazy:!0,render:function(){return te(Ct,null,null)}},{label:"脚本库",name:"script-table",lazy:!0,render:function(){return te(vt,null,null)}}]);return function(e,r){var a=z;return Y(),ee("div",zt,[te(a,{type:"card",modelValue:ae(t),"onUpdate:modelValue":r[0]||(r[0]=function(e){return Pe(t)?t.value=e:null}),options:ae(n)},null,8,["modelValue","options"])])}}}),Ft=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"}));e("i",Ft)}}})}();
