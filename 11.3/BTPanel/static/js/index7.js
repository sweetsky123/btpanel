import{u as e,af as a,n as t,H as l,Q as s,T as n,p as o,ag as i,P as r,l as c,ah as d,_ as u,e as m,M as p,ai as w,W as v,aj as _}from"./utils-lib.js?v=1763689792";import{c as f,r as h,o as g,aE as b,aT as y,e as k,v as x,I as j,x as C,y as V,C as A,D as L,z as I,A as H,J as S,H as T,L as D,B as E,t as M,G as R,g as U,F as q,w as z,O,a9 as P}from"./base-lib.js?v=1763689792";import{_ as W}from"./index109.js?v=1763689792";import{a as B,b as F,u as G,c as J}from"./column.js?v=1763689792";import{t as N,Z as Q,_ as Z}from"./config.js?v=1763689792";import{s as K}from"./validator.js?v=1763689792";import{g as X}from"./useStore.js?v=1763689792";import{a as Y}from"./useMethod.js?v=1763689792";import{_ as $}from"./index118.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const ee={style:{"overflow-y":"hidden"}},ae=u(f({__name:"index",setup(u,{expose:m}){const{mainHeight:p,push:w,getSenderAlarmListInfo:v}=e(),_=h(),f=h(!1),D=h([]),E=g({p:1,rows:10,status:"",keyword:""}),M=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]),R=e=>{const s=!a(e);t({title:"".concat(s?"编辑":"添加","告警任务"),component:()=>l(()=>import("./index120.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:80,showFooter:!0,compData:{isEdit:s,row:e,onRefresh:U}})},U=async()=>{await s({loading:f,request:n({...E}),success:({data:e})=>{q(e.data)}})},q=e=>{D.value=null==e?void 0:e.map(e=>{const{sender:a}=e;return{...e,alarmAccounts:a.map(e=>{const a=w.value.config.find(a=>a.id===e);return a?"sms"===a.sender_type?{id:e,type:a.sender_type,title:"短信"}:{id:e,type:a.sender_type,title:M.get(a.sender_type)||"",account:a.data.title}:null})}})},z=async(e,a,t,l)=>{const s=async(e,a)=>{const{id:t,status:l}=e,s=new Map([["delete",Q],["start",N],["stop",N]]).get(o);switch(o){case"start":if(s)return await s({task_id:t,status:1});break;case"stop":if(s)return await s({task_id:t,status:0});break;case"delete":if(s)return await s({task_id:t})}},{label:n,value:o}=l;await e({title:"批量".concat(n,"告警"),content:"即将批量".concat(n,"告警，是否继续操作?"),column:[{label:"告警名称",prop:"title"},J()],onConfirm:async()=>(await a(s),U(),!1)})},O=[B(),{prop:"title",label:"标题",minWidth:140,width:300},F({minWidth:100,event:async e=>{await o({title:"".concat(e.status?"禁用":"启用","【").concat(e.title,"】任务"),content:"您真的要".concat(e.status?"禁用":"启用","【").concat(e.title,"】这个任务吗？")}),await s({loading:"正在修改告警任务状态，请稍候...",request:N({task_id:e.id,status:Number(!e.status)}),message:!0,success:U})},data:["停用","正常"]}),{label:"告警方式",width:260,render:e=>b(y,{content:e.alarmAccounts.filter(e=>null!==e).map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat((null==e?void 0:e.account)||"","(").concat((null==e?void 0:e.title)||"",")")).join(","),placement:"top",openDelay:500},[b("span",[e.alarmAccounts.filter(e=>null!==e).map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat(null==e?void 0:e.account,"(").concat(e.title,")")).join(",")])])},{label:"告警条件",minWidth:180,render:e=>k("span",{innerHTML:e.view_msg},null)},G([{title:"告警记录",width:70,onClick:e=>{t({title:"【".concat(e.title,"】告警记录"),component:()=>l(()=>import("./record.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),area:80,compData:e})}},{title:"编辑",onClick:e=>R(e)},{title:"删除",onClick:async e=>{await o({icon:"warning-filled",title:"删除告警任务",content:"删除后将不再告警此条任务，是否继续？"}),await s({loading:"正在删除告警任务，请稍候...",request:Q({task_id:e.id}),message:!0,success:U})}}])],P=[{label:"启动",value:"start",event:z},{label:"停止",value:"stop",event:z},{label:"删除",value:"delete",event:z}],Z=async()=>{await v(!0),await U()};return x(Z),m({init:Z}),(e,a)=>{const t=T,l=i,s=r,n=c,o=d,u=W,m=j("bt-loading");return C(),V("div",ee,[k(u,null,{"header-left":A(()=>[k(t,{type:"primary",onClick:a[0]||(a[0]=e=>R(!1))},{default:A(()=>[...a[3]||(a[3]=[L("添加任务",-1)])]),_:1})]),"header-right":A(()=>[k(l,{class:"alarm-custom-radio mr-[1rem]",type:"button",size:"default",modelValue:I(E).status,"onUpdate:modelValue":a[1]||(a[1]=e=>I(E).status=e),options:[{label:"全部",value:""},{label:"运行中",value:!0},{label:"已停止",value:!1}],onChange:U},null,8,["modelValue"]),H("div",null,[k(s,{modelValue:I(E).keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>I(E).keyword=e),onSearch:U,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])]),content:A(()=>[S(k(n,{ref_key:"alarmListRef",ref:_,data:I(D),column:O,"max-height":I(p)-300,description:"告警列表为空"},null,8,["data","max-height"]),[[m,I(f)],[m,"正在加载告警列表，请稍后...","title"]])]),"footer-left":A(()=>[k(o,{"table-ref":I(_),options:P},null,8,["table-ref"])]),_:1})])}}}),[["__scopeId","data-v-5d926d59"]]),te={class:"flex items-center"},le={class:"flex-1 leading-[1.5]"},se={class:"flex"},ne=u(f({__name:"module-name",props:{row:{}},setup:e=>(a,t)=>{const l=m;return C(),V("div",te,[H("div",{class:D(["icon",e.row.ps.indexOf("API")>-1?"webhook":e.row.name])},null,2),H("div",le,[H("span",{class:"text-base font-bold cursor-pointer",onClick:t[0]||(t[0]=a=>{e.row})},E(e.row.title),1),H("div",se,[H("span",null,E(e.row.ps),1),k(l,{href:e.row.help,target:"_blank"},{default:A(()=>[...t[1]||(t[1]=[L(">>帮助文档",-1)])]),_:1},8,["href"])])])])}}),[["__scopeId","data-v-4e5a9b81"]]),oe={key:1,class:"c7"},ie={key:1},re=f({__name:"module-content",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),l=a,{row:s}=M(l),n=async()=>{await t(!0),p.success("刷新成功")};return(e,a)=>{return C(),V("div",null,[0===I(s).list.length?(C(),V("span",{key:0,class:"text-danger cursor-pointer",onClick:a[0]||(a[0]=e=>I(K)(I(s)))},"未配置")):I(s).list.length>0?(C(),V("span",oe,["sms"!==I(s).name?(C(),V("span",{key:0,class:"cursor-pointer",onClick:a[1]||(a[1]=e=>I(K)(I(s)))},"已绑定【"+E((t=I(s).list,t.map(e=>e.data.title).join("、")))+"】,可继续配置绑定更多账号",1)):R("",!0),"sms"===I(s).name?(C(),V("span",ie,[L("今日剩余发送次数："+E(I(s).list.at(0).data.count)+"( ",1),H("span",{class:"bt-link",onClick:n},"刷新次数"),a[2]||(a[2]=L(")",-1))])):R("",!0)])):R("",!0)]);var t}}}),ce=f({__name:"module-action",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),{refs:{isRefreshList:l}}=X(),s=a,{row:n}=M(s),i=U(()=>n.value.list.at(0).used),r=async()=>{var e;try{await o({title:"".concat(i.value?"禁用":"开启","短信通知"),content:"您真的要".concat(i.value?"禁用":"开启","短信通知吗？")});const a=null==(e=n.value.list)?void 0:e.at(0).id,l=await w({sender_id:a});p.request(l),n.value.list.at(0).used=!i.value,t()}catch(a){}};return(e,a)=>(C(),V("div",null,["sms"!==I(n).name?(C(),V("span",{key:0,class:"bt-link",onClick:a[0]||(a[0]=e=>K({...n.value,callback:()=>{l.value=!0}}))},"配置")):(C(),V(q,{key:1},[I(i)?R("",!0):(C(),V("span",{key:0,class:"bt-link",onClick:r},"开启")),I(i)?(C(),V("span",{key:1,class:"bt-link",onClick:r},"禁用")):R("",!0)],64))]))}}),de=f({__name:"index",setup(a,{expose:t}){const{push:l,getSenderAlarmListInfo:s}=e(),{refs:{isRefreshList:n}}=X(),o=h(!1),i=h([]),r=[{label:"告警模块",width:400,render:e=>k(ne,{row:e},null)},{label:"配置情况",render:e=>k(re,{row:e},null)},{label:"操作",align:"right",width:100,render:e=>k(ce,{row:e},null)}],d=async(e=!0)=>{e&&(o.value=!0),await s(),i.value=Y(l.value.config),o.value=!1};return z(()=>n.value,e=>{n.value&&(d(!1),n.value=!1)},{immediate:!0}),x(d),t({init:d}),(e,a)=>{const t=c,l=W,s=j("bt-loading");return C(),O(l,null,{content:A(()=>[S(k(t,{data:I(i),column:r,description:"告警设置列表为空"},null,8,["data"]),[[s,I(o)],[s,"正在加载告警设置列表，请稍后...","title"]])]),_:1})}}}),ue=f({__name:"index",setup(a,{expose:t}){const{mainHeight:l}=e(),n=h([]),o=h(!1),d=h(0),u=g({p:1,limit:20,keyword:"",status:""}),m=async()=>{await s({loading:o,request:Z(P(u)),data:{data:[Array,n],page:v(d)}})},p=[{label:"标题",render:e=>k("span",{innerHTML:e.log},null)},{prop:"addtime",label:"时间",width:150}];return x(m),t({init:m}),(e,a)=>{const t=i,s=r,w=c,v=$,_=W,f=j("bt-loading");return C(),O(_,null,{"header-right":A(()=>[k(t,{type:"button",modelValue:I(u).status,"onUpdate:modelValue":a[0]||(a[0]=e=>I(u).status=e),options:[{label:"全部",value:""},{label:"发送成功",value:!0},{label:"发送失败",value:!1}],onChange:m,class:"mr-[1rem]"},null,8,["modelValue"]),H("div",null,[k(s,{modelValue:I(u).keyword,"onUpdate:modelValue":a[1]||(a[1]=e=>I(u).keyword=e),onSearch:m,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])]),content:A(()=>[S(k(w,{data:I(n),column:p,"max-height":I(l)-254,description:"告警日志列表为空"},null,8,["data","max-height"]),[[f,I(o)],[f,"正在加载告警日志列表，请稍后...","title"]])]),"footer-right":A(()=>[k(v,{total:I(d),page:I(u).p,"onUpdate:page":a[2]||(a[2]=e=>I(u).p=e),row:I(u).limit,"onUpdate:row":a[3]||(a[3]=e=>I(u).limit=e),onChange:m},null,8,["total","page","row"])]),_:1})}}}),me=f({__name:"index",setup(e){const{BtTabs:a}=_({type:"card",options:[{label:"告警列表",name:"list",lazy:!0,render:ae},{label:"告警设置",name:"set",lazy:!0,render:de},{label:"告警日志",name:"log",lazy:!0,render:ue}]});return(e,t)=>(C(),O(I(a)))}});export{me as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
