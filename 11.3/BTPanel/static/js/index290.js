import{c as e,s as a,r as t,o as l,v as s,x as o,y as r,e as i,C as n,z as d,D as m,aE as u,U as c,aT as p,ad as f,ab as v}from"./base-lib.js?v=1763689792";import{_ as y}from"./validator.js?v=1763689792";import{Q as b,T as _,k as g,b as h}from"./utils-lib.js?v=1763689792";import{g as j}from"./useStore5.js?v=1763689792";import{I as x,J as w}from"./ssl.js?v=1763689792";import{r as V}from"./useMethod7.js?v=1763689792";import{u as D}from"./useStore11.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";const N={class:"p-2rem"},T=e({__name:"index",props:{compData:{default:()=>({isMulti:!1})}},emits:["close"],setup(e,{expose:T,emit:U}){const q=e,A=U,E=h(),{refs:{tabActive:I,isRefreshDomainList:R}}=j(),{activeTabs:M,sslIsRefresh:k,testIsRefresh:C,encryptIsRefresh:S,otherIsRefresh:$}=a(D()),z=t(),H=t(!1),J=l({domain:"",title:"",cycle:30,allSsl:!1,total:2,sender:[]}),L=t({cycle:[{required:!0,message:"请输入剩余天数",trigger:"blur"},{validator:(e,a,t)=>{/^[1-9]\d*$/.test(a)?t():t(new Error("请输入大于0的正整数"))},trigger:["blur","change"]}],total:[{required:!0,message:"请输入总发送上线",trigger:"blur"},{validator:(e,a,t)=>{/^\d+$/.test(a)?t():t(new Error("请输入大于等于0的正整数"))},trigger:["blur","change"]}],sender:[{required:!0,message:"请选择通知方式",trigger:"blur"},{validator:(e,a,t)=>{0===a.length?t(new Error("请选择通知方式")):t()},trigger:["blur","change"]}]});return s(()=>{var e;"domain"===I.value?J.domain=q.compData.domain:(null==(e=q.compData)?void 0:e.isMulti)?(J.title=q.compData.data.map(e=>e.title).join(","),J.domain=q.compData.data.map(e=>!e.domainName||Array.isArray(e.domainName)&&0===e.domainName.length?"":Array.isArray(e.domainName)?e.domainName.join(","):e.domainName).filter(e=>""!==e).join(",")):(J.title=q.compData.title,J.domain=q.compData.domainName.join(",")),b({request:_(),success:({data:e})=>{const a=e.data.find(e=>e.id===q.compData.report_id);a&&(J.sender=a.sender,J.cycle=a.task_data.cycle,J.total=a.number_rule.total)}})}),T({onConfirm:async()=>{var e,a,t;try{if(!(await z.value.validate()))return;if(H.value=!0,null==(e=q.compData)?void 0:e.isMulti){const e=[],a=E.load("正在批量设置告警...");for(const t of q.compData.data)try{const a={cycle:J.cycle,total:J.total,sender:J.sender.join(","),ssl_id:t.ssl_id},l=await w(a);e.push({name:t.title,status:l.status})}catch(l){e.push({name:t.title,status:!1})}a.close();V({resultData:e,resultTitle:"设置告警",resultColumn:[{label:"名称",prop:"name"},{label:"结果",render:e=>{const a=e.status?"设置成功":"设置失败",t=e.status?"text-primary":"text-danger";return u("span",{class:t},a)}}]});const s={ssl:()=>k.value=!0,test:()=>C.value=!0,encrypt:()=>S.value=!0,other:()=>$.value=!0};null==(t=s[M.value])||t.call(s),A("close")}else{let e={cycle:J.cycle,total:J.total,sender:J.sender.join(",")};"domain"===I.value?e.domain=J.domain:e.ssl_id=q.compData.ssl_id;const t="domain"===I.value?await x(e):await w(e);if(E.request(t),t.status){if("domain"===I.value)R.value=!0;else{const e={ssl:()=>k.value=!0,test:()=>C.value=!0,encrypt:()=>S.value=!0,other:()=>$.value=!0};null==(a=e[M.value])||a.call(e)}A("close")}}}catch(s){}finally{H.value=!1}}}),(e,a)=>{const t=c,l=p,s=f,u=g,b=y,_=v;return o(),r("div",N,[i(_,{ref_key:"sslExpire",ref:z,disabled:d(H),rules:d(L),model:d(J),"label-width":"100px"},{default:n(()=>[i(s,{label:"域名"},{default:n(()=>[i(l,{content:d(J).domain,placement:"top","popper-class":"!max-w-[300px]"},{default:n(()=>[i(t,{class:"!w-[28rem]",modelValue:d(J).domain,"onUpdate:modelValue":a[0]||(a[0]=e=>d(J).domain=e),disabled:""},null,8,["modelValue"])]),_:1},8,["content"])]),_:1}),i(s,{label:"证书"},{default:n(()=>[i(l,{content:d(J).title,placement:"top","popper-class":"!max-w-[300px]"},{default:n(()=>[i(t,{class:"!w-[28rem]",modelValue:d(J).title,"onUpdate:modelValue":a[1]||(a[1]=e=>d(J).title=e),disabled:""},null,8,["modelValue"])]),_:1},8,["content"])]),_:1}),i(s,{label:"剩余天数",prop:"cycle"},{default:n(()=>[i(u,{modelValue:d(J).cycle,"onUpdate:modelValue":a[2]||(a[2]=e=>d(J).cycle=e),width:"14rem",textType:"天",min:"1",type:"number"},{append:n(()=>[...a[5]||(a[5]=[m(" 天 ",-1)])]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"总发送上限",prop:"total"},{default:n(()=>[i(u,{modelValue:d(J).total,"onUpdate:modelValue":a[3]||(a[3]=e=>d(J).total=e),width:"14rem",textType:"次",min:"0",type:"number"},{append:n(()=>[...a[6]||(a[6]=[m(" 次 ",-1)])]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"通知方式",prop:"sender"},{default:n(()=>[i(b,{modelValue:d(J).sender,"onUpdate:modelValue":a[4]||(a[4]=e=>d(J).sender=e),limit:["sms"],class:"!w-[28rem]"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","rules","model"])])}}});export{T as default};
