import{u as e,f as a,iF as t,E as l,an as s,n,M as r,H as o,e as i,N as p,d as c,_ as d}from"./utils-lib.js?v=1763689792";import{c as u,s as m,t as v,$ as f,g,aB as x,r as h,v as b,aG as y,I as C,J as w,z as _,x as k,y as U,F as I,A as L,e as j,M as V,B as P,bb as H,L as M,C as B,D as T,G as R,O as E,R as Z,K as q,aE as O,aT as z,aZ as A,ap as S,U as D,aA as F,ad as N,ab as G,H as $,bu as J,aC as K}from"./base-lib.js?v=1763689792";import{H as W}from"./store.js?v=1763689792";import{H as Q}from"./store2.js?v=1763689792";import{u as X}from"./column.js?v=1763689792";import{k as Y}from"./validator.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index107.js?v=1763689792";const ee={class:"absolute top-15px left-15px text-white text-base"},ae={class:"absolute top-15px left-15px text-white text-base"},te={class:"text-base mt-8 flex justify-between mb-16px mx-34px update-text"},le={class:""},se={key:0,class:"text-primary"},ne={class:""},re={class:"py-[.8rem] text-base flex items-center justify-between update-text bg-[var(--el-color-white-rgb)]"},oe={class:"flex items-center"},ie={key:0,class:"text-primary"},pe={class:"py-[.8rem] text-base flex items-center justify-between update-text bg-[var(--el-color-white-rgb)]"},ce={class:"flex items-center"},de={key:0,class:"text-primary"},ue={class:"text-extraLarge flex mt-2rem pb-8 font-bold items-center justify-center text-secondary bg-[var(--el-color-white-rgb)]"},me={class:"px-32px py-[1.6rem] text-base flex items-center justify-between update-text bg-[var(--el-color-white-rgb)]"},ve={class:"flex items-center"},fe={key:0,class:"text-primary"},ge={key:0,class:"rounded-base update-content"},xe=["innerHTML"],he={key:1},be={class:"flex flex-col justify-center leading-10 text-small text-secondary"},ye={class:"mt-0.6rem flex items-center"},Ce={key:2},we={class:"pt-[1rem] pb-[3rem] pl-[3.1rem] pr-[3rem]"},_e={class:"mt-[1rem]"},ke={class:"my-[1rem] flex items-center"},Ue={class:"flex flex-col items-center p-[2rem]"},Ie={key:3,class:"flex align-middle justify-center pb-10"},Le=d(u({__name:"index",setup(d,{expose:Le}){const je=Q(),{getUpdateInfoNew:Ve,downloadEnv:Pe}=je,{panelInfo:He}=m(je),{upgrade:Me,currentInfo:Be}=v(He.value),Te=W(),{panelInfo:Re,formPhone:Ee,loading:Ze,grayscale:qe,panelVersion:Oe,betaInfo:ze,officialInfo:Ae,isBeta:Se,update:De,isNPSShow:Fe,questions:Ne,form:Ge,rules:$e}=m(Te),Je=f("updateSvg"),Ke=g(()=>0!==Me.value),{mainHeight:We,mainWidth:Qe,updatePluginCheck:Xe}=e(),Ye=g(()=>Re.value.isBeta?"测试版":"正式版"),ea=x("popupClose",()=>{}),aa=h(!1),ta=h(!1),la=h(!1),sa=()=>{const{BtTable:e,refresh:t,BtRefresh:l}=s({request:()=>({data:Re.value.envUpgradeInfo.plugins_check}),columns:[{label:"插件名称",prop:"title",width:170,render:e=>{var t;const l="soft_ico/ico-"+((null==(t=e.name)?void 0:t.indexOf("php-"))>-1?"php":e.name)+".png",s=e.title.indexOf("PHP-")>-1?"PHP":e.title;return O("div",{class:"whitespace-normal inline-flex items-center p-[2px]",title:"".concat(s," ").concat(e.local_version)},[O(a,{src:l,class:"soft-ico-img",type:"img"},{error:()=>O("img",{src:"/static/images/soft_ico/icon_plug.svg",alt:""})}),O("span","".concat(s," ").concat(e.local_version||""))])}},{label:"等级",prop:"level",width:80,render:e=>{const a="must"===e.level;return O("span",{class:a?"text-primary":"text-secondary"},a?"必须更新":"可选更新")}},{label:"最低适配版本",width:100,prop:"version"},{label:"备注",prop:"tip"},X([{onClick:e=>{Xe.value.status=!0,Xe.value.callback=async()=>{await Ve(),t()},Y({name:e.name,type:"u"})},title:"更新"}])]}),o=u({setup(){const a=h(!1),l=x("popupClose",()=>{}),s=K(async()=>{a.value=!0,await Ve(),0!==Re.value.envUpgradeInfo.plugins_check.length?(t(),r.success("刷新成功"),a.value=!1):l()},100);return()=>O("div",{class:"p-[1.2rem]"},[O("div",{class:"flex justify-end mb-[1rem]"},O(p,{disabled:a.value,onClick:async()=>{s()}},[O(c,{icon:"el-refresh",class:"".concat(a.value?"!hidden":"")}),O("i",{class:"svgtofont-el-loading ".concat(a.value?"animation":"!hidden")})])),O(e,{class:"max-h-[40rem]"})])}});n({title:"待更新插件列表",area:76,component:()=>o})},na=g(()=>Je.value?Je.value.getBoundingClientRect():{top:0,left:0}),ra=async()=>{if(Re.value.envUpgradeInfo.env_update_running)oa();else{(await Pe()).status&&(oa(),Ve())}},oa=async()=>{n({title:"正在下载环境包，请耐心等候...",area:76,component:()=>o(()=>import("./down-log.js?v=1763689792"),__vite__mapDeps([]),import.meta.url)})},ia=()=>{if(Re.value.envUpgradeInfo.need_env_check&&!Re.value.envUpgradeInfo.has_env_py313){ta.value=!0;const e=setTimeout(()=>{ta.value=!1,clearTimeout(e)},3e3)}else if(Re.value.envUpgradeInfo.plugins_hasUpdate){la.value=!0;const e=setTimeout(()=>{la.value=!1,clearTimeout(e)},3e3)}else Te.updateVersion()};return b(async()=>{await Te.getUpdatePushInfo()}),y(()=>{Te.$reset()}),Le({onOpen:async()=>{if(!Be.value){aa.value=!0;const e=await Ve();aa.value=!1,(null==e?void 0:e.msg)&&(r.request(e),ea())}}}),(e,s)=>{var n,r,o,p,c,d,u,m,v,f,g;const x=i,h=z,b=A,y=S,O=D,K=F,W=N,Q=G,X=$,Y=C("bt-loading"),Le=J;return w((k(),U("div",{class:M((_(Ke)?"update-back ":"")+"flex relative w-[100%] flex-col h-[100%] rounded-small update-version-view")},[_(Ke)?(k(),U(I,{key:0},[L("div",{ref_key:"updateSvg",ref:Je,class:"w-full relative"},[...s[9]||(s[9]=[L("svg",{viewBox:"0 0 548 153.342",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"500",height:"139",fill:"none",customFrame:"#000000",preserveAspectRatio:"none meet"},[L("g",null,[L("path",{d:"M5.69224e-05 0L548 0L548 153L0 153L5.69224e-05 0Z",class:"update-fg-element","fill-rule":"evenodd"}),L("path",{d:"M0 127.609C22.361 115.208 74.099 102.187 102.17 149.311C102.17 149.311 125.906 81.105 185.763 112.107C185.763 112.107 211.563 67.671 262.132 88.339C289.308 88.683 353.348 76.698 390.5 18L403.518 25.3C396.638 40.458 387.831 79.038 407.646 112.107C424.846 101.429 467.916 89.165 502.592 125.542C514.976 121.753 541.396 116.241 548 124.508L548 151.039L0 151.039L0 127.609Z",class:"updateed-bg-element","fill-rule":"evenodd"}),L("path",{d:"M0 131.838L0 94.677C11.7134 92.3228 42.0593 92.6576 62.6202 112.94C75.0593 102.441 106.721 88.2543 133.86 115.508C140.8 103.149 165.607 82.413 209.319 98.3354C209.319 98.3354 239.44 59.7058 296.131 82.7745C296.131 82.7745 312.727 66.2293 343.685 71.0559C358.198 58.4547 388.474 31.2026 393.468 23L400.682 26.1796C392.71 38.5351 377.984 67.2003 382.87 83.0155C388.37 84.6108 400.597 90.6492 405.502 102.04C422.401 94.7122 462.566 88.1346 488.029 120.44C499.749 116.522 527.391 110.902 548 120.44L548 153.342L274.535 153.34L3.5882e-05 153.342L0.00011766 141.5L0 131.838Z",class:"updateed-bg-element","fill-rule":"evenodd"})])],-1)])],512),L("div",{class:"w-[150px] fixed right-30px",style:V("top:".concat(_(na).top?_(na).top-100:_(We)/2-360,"px;right:").concat(_(na).left?_(na).left+40:_(Qe)/2-105,"px"))},[j(_(a),{src:"/update/update_rocket.svg",alt:"rocket img"})],4),L("div",ee,[L("span",null,P("".concat(_(t)).concat(_(Ye),"本更新")),1)])],64)):(k(),U(I,{key:1},[s[10]||(s[10]=H('<div class="w-full" data-v-2ff3eca8><svg viewBox="0 0 500 83.775" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="500.000000" height="83.775002" fill="none" data-v-2ff3eca8><rect id="update_back2_new 1" width="500.000000" height="83.775002" x="0.000000" y="0.000000" data-v-2ff3eca8></rect><path class="update-fg-element" d="M493.826 60.0152C496.046 58.4396 498.083 56.6702 499.937 54.7072L500 19L0 19L0 53.9322C0 54.3652 2.3904 55.7552 2.77766 56.0372C3.88521 56.8297 5.01047 57.5984 6.15344 58.3432C15.524 64.3842 26.3309 69.6113 37.8194 70.1743C50.6284 70.8093 59.0042 63.9312 69.8956 58.8062C81.9499 53.1162 93.4593 55.2412 104.549 61.8262C112.295 66.4493 120.356 71.8963 129.476 71.6253C142.967 71.2123 154.224 63.0752 166.541 58.8352C180.304 54.1132 192.537 57.3652 204.098 65.4013C213.354 71.8463 221.855 79.9423 233.208 82.8624C245.472 86.0144 257.746 82.3793 267.295 74.8873C284.067 62.3002 287.222 55.4622 301.751 55.0192C318.123 54.5362 332.285 65.3213 347.17 70.2553C357.222 73.6283 368.553 74.4853 378.397 70.0133C387.139 66.0563 393.648 58.9372 402.505 55.1612C422.663 46.7322 439.256 63.8813 458.061 67.6973C464.319 68.9164 470.563 68.8497 476.791 67.4973C483.029 66.1713 488.707 63.677 493.826 60.0142L493.826 60.0152Z" fill-rule="evenodd" data-v-2ff3eca8></path><path class="update-bg-element" d="M493.865 42.73C496.07 41.1662 498.095 39.4096 499.937 37.46L500 0L0 0L0 36.69C0 37.12 2.375 38.5 2.76042 38.78C3.86458 39.57 4.97917 40.33 6.11458 41.07C15.4271 47.07 29.2917 52.26 40.7083 52.82C53.4375 53.45 61.7604 46.62 72.5833 41.53C84.5625 35.88 96 37.99 107.021 44.53C114.719 49.12 122.729 54.53 131.792 54.26C145.198 53.85 156.385 45.77 168.625 41.56C182.302 36.87 194.458 40.1 205.948 48.08C215.146 54.48 223.594 62.52 234.875 65.42C247.062 68.55 259.271 64.42 268.76 56.98C279.177 48.86 288.552 38.21 302.99 37.77C319.26 37.29 333.333 48 348.125 52.9C358.115 56.25 369.375 57.1 379.156 52.66C387.844 48.73 394.312 41.66 403.115 37.91C423.146 29.54 439.635 46.57 458.323 50.36C464.542 51.5705 470.747 51.5042 476.936 50.161C483.132 48.8452 488.775 46.3682 493.865 42.73L493.865 42.73Z" fill-rule="evenodd" data-v-2ff3eca8></path></svg></div>',1)),L("div",ae,[L("span",null,"宝塔"+P(_(t))+"面板",1)])],64)),w((k(),U("div",{class:M((_(Ke),"relative rounded-small"))},[_(Ke)?(k(),U(I,{key:0},[s[13]||(s[13]=L("div",{class:"text-extraLarge flex font-bold items-center justify-center text-secondary"},[L("span",null,"发现新的正式版本！")],-1)),L("div",te,[L("div",le,[s[12]||(s[12]=L("span",null,"最新版本: ",-1)),L("span",null,[j(x,{href:"https://www.bt.cn/bbs/forum-36-1.html"},{default:B(()=>{var e;return[T(P(_(t))+"-"+P(null==(e=_(Be))?void 0:e.version),1)]}),_:1})]),_(qe)<1?(k(),U("span",se,[j(h,{class:"item",effect:"dark",content:"提示：当前是正式版尝鲜阶段，为了验证新版本的稳定性和兼容性，确保全面推出之前，新功能能正常运行。",placement:"top"},{default:B(()=>[...s[11]||(s[11]=[L("span",null,[T("（尝鲜版"),L("i",{class:"svgtofont-el-question-filled"}),T("）")],-1)])]),_:1})])):R("",!0)]),L("div",ne,[L("span",null,"更新时间："+P(null==(n=_(Be))?void 0:n.uptime),1)])]),(null==(r=_(Re).envUpgradeInfo)?void 0:r.need_env_check)?(k(),E(b,{key:0,closable:!1,class:"!mx-[3.4rem] !w-[43rem]",style:V((null==(o=_(Re).envUpgradeInfo)?void 0:o.has_env_py313)?{backgroundColor:"var(--el-color-primary-light-9) !important",color:"var(--el-color-primary-dark-2) !important",border:"1px solid var(--el-color-primary-light-8) !important"}:{}),type:(null==(p=_(Re).envUpgradeInfo)?void 0:p.has_env_py313)?"primary":"error"},{default:B(()=>{var e,a;return[L("div",re,[L("span",oe,P("".concat((null==(e=_(Re).envUpgradeInfo)?void 0:e.has_env_py313)?"新版环境包已下载，可更新面板":"新版本需要更新环境，请先预下载新版环境","。")),1),(null==(a=_(Re).envUpgradeInfo)?void 0:a.has_env_py313)?R("",!0):(k(),U("span",ie,[j(h,{visible:_(ta),class:"item",effect:"dark",content:"提示：请先预下载环境包后，再升级面板版本。",placement:"top"},{default:B(()=>{var e;return[L("span",{class:"bt-link",onClick:ra},P((null==(e=_(Re).envUpgradeInfo)?void 0:e.env_update_running)?"查看日志":"预下载环境"),1)]}),_:1},8,["visible"])]))])]}),_:1},8,["style","type"])):R("",!0),(null==(c=_(Re).envUpgradeInfo)?void 0:c.plugins_check.length)>0?(k(),E(b,{key:1,closable:!1,class:"!mx-[3.4rem] !w-[43rem] !mt-[1rem]",style:V((null==(d=_(Re).envUpgradeInfo)?void 0:d.plugins_hasUpdate)?{}:{backgroundColor:"var(--el-color-primary-light-9) !important",color:"var(--el-color-primary-dark-2) !important",border:"1px solid var(--el-color-primary-light-8) !important"}),type:(null==(u=_(Re).envUpgradeInfo)?void 0:u.plugins_hasUpdate)?"error":"primary"},{default:B(()=>{var e,a;return[L("div",pe,[L("span",ce,P("".concat((null==(e=_(Re).envUpgradeInfo)?void 0:e.plugins_hasUpdate)?"新版本部分插件需要更新，请先更新插件":"必要插件已更新完毕，可更新面板","。")),1),(null==(a=_(Re).envUpgradeInfo)?void 0:a.plugins_check.length)>0?(k(),U("span",de,[j(h,{visible:_(la),class:"item",effect:"dark",content:"提示：请先更新插件后，再升级面板版本。",placement:"top"},{default:B(()=>[L("span",{class:"bt-link",onClick:sa},P("查看插件列表"))]),_:1},8,["visible"])])):R("",!0)])]}),_:1},8,["style","type"])):R("",!0)],64)):(k(),U(I,{key:1},[L("div",ue,[j(_(a),{src:"/update/update_icon.svg",alt:"icon",class:"h-12 mr-2 mt-1"}),s[14]||(s[14]=L("span",{class:"leading-10"},"当前已经是最新版本",-1))]),L("div",me,[L("span",ve,[s[16]||(s[16]=T(" 当前版本： ",-1)),j(x,{class:"bt-link text-small",href:"https://www.bt.cn/bbs/forum-36-1.html",textContent:P(_(t)+_(Ye)+_(Oe))},null,8,["textContent"]),_(qe)<1?(k(),U("span",fe,[j(h,{class:"item",effect:"dark",content:"提示：当前是正式版尝鲜阶段，为了验证新版本的稳定性和兼容性，确保全面推出之前，新功能能正常运行。",placement:"top"},{default:B(()=>[...s[15]||(s[15]=[L("span",null,[T("（尝鲜版"),L("i",{class:"svgtofont-el-question-filled"}),T("）")],-1)])]),_:1})])):R("",!0)]),L("span",null,"当前发布时间："+P(null==(m=_(Be))?void 0:m.uptime),1)])],64)),L("div",{class:M(_(Ke)?"mb-[3rem] mt-4 px-16px py-22px mx-34px ".concat((_(l),"bg-light")," rounded-small"):"mb-[2.2rem] mt-2 px-16px py-14px mx-32px border-1 border-light bg-light rounded-small")},[_(Ke)?(k(),U("div",ge,[L("div",{class:"leading-10 mr-2 text-small text-secondary overflow-auto",innerHTML:(null==(v=_(Be))?void 0:v.updateMsg)||"获取中"},null,8,xe)])):R("",!0),_(Ke)?(k(),U("hr",he)):R("",!0),L("div",be,[L("div",ye,[s[17]||(s[17]=L("span",{class:"mr-2"},"有更新时提醒我:",-1)),j(y,{class:"mr-4",modelValue:_(De).updatePush,"onUpdate:modelValue":s[0]||(s[0]=e=>_(De).updatePush=e),onChange:_(Te).openUpdateReminder,"active-color":"#13ce66"},null,8,["modelValue","onChange"]),L("span",{class:"bt-link",onClick:s[1]||(s[1]=e=>_(Te).updateReminderDialog(_(De).updatePush)),textContent:"提醒方式"})])])],2),_(Ke)?R("",!0):(k(),U("div",Ce,[L("div",{class:M(["nps_survey_banner flex items-center justify-center",_(Fe)?"":"mb-[2rem]"])},[L("span",{class:"text-base font-bold inline-block cursor-pointer text-primary mr-[.4rem]",onClick:s[2]||(s[2]=e=>Fe.value=!_(Fe)),style:{"vertical-align":"4px"}}," 点击此处"+P(_(Fe)?"折叠":"展开")+"需求反馈 ",1),L("i",{class:M(["cursor-pointer text-base",_(Fe)?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down"]),onClick:s[3]||(s[3]=e=>Fe.value=!_(Fe))},null,2)],2),w(L("div",we,[j(K,{placement:"top-start",width:"400","popper-class":"tips bg-primary text-white text-small w-[40.6rem] !p-12px leading-[20px]",trigger:"focus",content:"如果您在使用过程中遇到任何问题或功能不完善，请将您的问题或需求详细描述给我们，我们将尽力为您解决或完善。"},{reference:B(()=>[j(O,{type:"textarea",rows:5,modelValue:_(Ne),"onUpdate:modelValue":s[4]||(s[4]=e=>Z(Ne)?Ne.value=e:null),placeholder:"如果您在使用过程中遇到任何问题或功能不完善，请将您的问题或需求详细描述给我们，我们将尽力为您解决或完善。"},null,8,["modelValue"])]),_:1}),L("div",_e,[L("div",ke,[s[18]||(s[18]=L("span",{class:"text-base text-secondary"},"是否愿意接受回访：",-1)),j(y,{size:"small",modelValue:_(Ge).status,"onUpdate:modelValue":s[5]||(s[5]=e=>_(Ge).status=e)},null,8,["modelValue"])]),j(Q,{ref_key:"formPhone",ref:Ee,"label-position":"top",model:_(Ge),rules:_($e)},{default:B(()=>[w(j(W,{label:"",prop:"phone"},{default:B(()=>[j(O,{modelValue:_(Ge).phone,"onUpdate:modelValue":s[6]||(s[6]=e=>_(Ge).phone=e),placeholder:"请留下手机号码或邮箱"},null,8,["modelValue"])]),_:1},512),[[q,_(Ge).status]])]),_:1},8,["model","rules"])]),s[20]||(s[20]=L("div",{class:"mt-[.4rem] text-small text-primary leading-[3rem]"},"我们特别重视您的需求反馈，我们会每周进行需求评审，希望能更好的帮到您",-1)),L("div",Ue,[j(X,{type:"primary",class:"w-[12.5rem]",size:"large",onClick:s[7]||(s[7]=e=>_(Te).submit(_(ea)))},{default:B(()=>[...s[19]||(s[19]=[T("提交反馈",-1)])]),_:1})])],512),[[q,_(Fe)]])])),_(Ke)?(k(),U("div",Ie,[j(X,{type:"default",class:"ignore-renew text-base border-none h-38px mr-50px w-50 bg-base",size:"default",style:{color:"var(--el-base-tertiary)"},round:"",onClick:s[8]||(s[8]=e=>_(Te).ignoreUpdatEVersion(_(Be).version,_(ea)))},{default:B(()=>[...s[21]||(s[21]=[T("忽略本次更新",-1)])]),_:1}),j(X,{class:M(["border-none text-base w-50 h-38px",(null==(f=_(Re).envUpgradeInfo)?void 0:f.need_env_check)&&!(null==(g=_(Re).envUpgradeInfo)?void 0:g.has_env_py313)?"cursor-not-allowed":""]),type:"primary",round:"",onClick:ia},{default:B(()=>[...s[22]||(s[22]=[T("立即更新",-1)])]),_:1},8,["class"])])):R("",!0)],2)),[[Y,_(Ze)],[Y,"正在加载更新信息，请稍后...","title"]])],2)),[[Le,_(aa)]])}}}),[["__scopeId","data-v-2ff3eca8"]]);export{Le as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
