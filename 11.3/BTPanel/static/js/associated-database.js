import{Q as a,M as e,l,k as s,j as t}from"./utils-lib.js?v=1763689792";import{c as n,r as d,e as o,D as u,v as i,I as r,x as p,y as m,J as f,z as c,C as b,A as v,R as y,F as _,b1 as V,ad as q,an as j,ab as k,O as w,am as g}from"./base-lib.js?v=1763689792";import{getFtpInfo as x,getMysqlInfo as C,getSiteInfo as F,modifyFtpLink as U,modifyMysqlLink as h}from"./site.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";const A={class:"p-[20px]"},P=n({__name:"associated-database",setup(n){const P=d(!1),R=d(!1),T=d([]),z=d([]),D=d({pid:"",site:"",id:"",type:"mysql"}),H=d([{prop:"rname",label:"站点名称"},{label:"FTP用户",render:function(a){return o("div",null,[a.ftp.name?a.ftp.name:"--"," ",o("span",{class:"cursor-pointer bt-link",onClick:()=>{I(a,"ftp")}},[u("切换")])])}},{label:"数据库",render:function(a){return o("div",null,[a.mysql.name?a.mysql.name:"--"," ",o("span",{class:"cursor-pointer bt-link",onClick:()=>{I(a,"mysql")}},[u("切换")])])}}]),I=async(e,l)=>{D.value.type=l,await a({request:"ftp"===l?x():C(),data:[Array,T]}),D.value.pid=e[l].id,D.value.site=e.rname,P.value=!0,D.value.id=e.id},J=async()=>{a({loading:R,request:F(),data:[Array,z]})},M=async()=>{const{type:l,pid:s,id:t}=D.value;if(!s)return void e.error("请选择用户");const n={["ftp"===l?"ftp_id":"sql_id"]:s,pid:t},d="ftp"===l?U:h;(await a({loading:"正在切换，请稍后...",request:d(n),message:!0})).status&&(P.value=!1,J())};return i(J),(a,e)=>{const n=l,d=s,u=q,i=g,x=j,C=k,F=t,U=r("bt-loading");return p(),m("div",null,[f(o(n,{"max-height":"560",column:c(H),data:c(z)},null,8,["column","data"]),[[U,c(R)]]),o(F,{title:"ftp"===c(D).type?"切换FTP用户":"切换数据库用户",modelValue:c(P),"onUpdate:modelValue":e[3]||(e[3]=a=>y(P)?P.value=a:null),area:42,"show-footer":"",onConfirm:M},{default:b(()=>[v("div",A,[o(C,{modelValue:c(D),"onUpdate:modelValue":e[2]||(e[2]=a=>y(D)?D.value=a:null),ref:"websiteFormRef"},{default:b(()=>[o(u,{label:"站点名称"},{default:b(()=>[o(d,{class:"!w-[24rem]",disabled:"",modelValue:c(D).site,"onUpdate:modelValue":e[0]||(e[0]=a=>c(D).site=a)},null,8,["modelValue"])]),_:1}),o(u,{label:"ftp"===c(D).type?"ftp用户":"数据库用户",prop:"pid"},{default:b(()=>[o(x,{modelValue:c(D).pid,"onUpdate:modelValue":e[1]||(e[1]=a=>c(D).pid=a),class:"!w-[24rem]"},{default:b(()=>[(p(!0),m(_,null,V(c(T),(a,e)=>(p(),w(i,{key:e,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])]),_:1},8,["title","modelValue"])])}}});export{P as default};
