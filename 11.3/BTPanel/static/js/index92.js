import{_ as e}from"./index109.js?v=1763689792";import{u as a,hE as t,R as s,hF as l,x as n,hG as i,L as r,hH as o,az as d,hI as c,hJ as p,b as u,b6 as m,ag as _,bE as h,ax as x,hK as b,p as k,hL as g,ak as v,B as y,hM as f,hN as w,hO as C,n as j,hP as T,b3 as O,f0 as q,hx as B,hQ as D,e as V}from"./utils-lib.js?v=1763689792";import{_ as L}from"./we-com.js?v=1763689792";import{_ as E}from"./version-compare.vue_vue_type_script_setup_true_lang.js?v=1763689792";import{s as M,j as P,r as W,o as Y,g as A,c as z,bS as F,v as U,I as H,x as I,y as S,e as N,C as R,z as G,O as J,G as K,J as Q,A as X,B as Z,D as $,w as ee}from"./base-lib.js?v=1763689792";import{u as ae}from"./column.js?v=1763689792";import{u as te}from"./index147.js?v=1763689792";import{e as se}from"./validator.js?v=1763689792";import"./index.vue_vue_type_style_index_0_scoped_cdc7f4d3_lang.js?v=1763689792";import{B as le}from"./index106.js?v=1763689792";import{B as ne}from"./index422.js?v=1763689792";import{b as ie,k as re}from"./form-item.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";import"./index131.js?v=1763689792";import"./index107.js?v=1763689792";const oe=P("VHOST-ACCOUNT-STORE",()=>{const{payment:e}=a(),r=W(!1),o=Y({number:0,limit:0}),d=W({accunt_id:0,username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""}),c=W({}),p=W(0),u=A(()=>{switch(e.value.authType){case"pro":return o.limit=10,"当前为专业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit);case"ltd":return o.limit=30,"当前为企业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit)}}),m=W([]),_=W(!1),h=W([]),x=W(!1),b=W([]),k=W(!1),g=W({});return{isEdit:r,formData:d,editorForm:c,resetFormData:()=>{d.value={username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""},r.value=!1},packageOptions:m,packageLoading:_,renderPackageOptions:async()=>{try{_.value=!0;const{data:{list:e}}=await t();if(s(e)){if(r.value){const a=e.find(e=>e.package_id===d.value.package_id);g.value=a}else d.value.package_id=e[0].package_id,g.value=e[0];m.value=e.map(e=>({label:e.package_name+(e.remark?"(".concat(e.remark,")"):""),value:e.package_id,data:e}))}}catch(e){}finally{_.value=!1}},accountTypeLoading:k,renderAccountTypeOptions:async()=>{const{data:e}=await i();if(s(e))return b.value=e.map(e=>({label:e.type_name,value:e.type_id})),e},diskOptions:h,diskLoading:x,renderDiskOptions:async()=>{try{x.value=!0;const{data:e}=await l();if(s(e)){if(r.value){const{mountpoint:a}=e.find(e=>e.mountpoint===d.value.mountpoint);d.value.mountpoint=a}else d.value.mountpoint=e[0].mountpoint;h.value=e.map(e=>({label:"".concat(e.mountpoint,"(").concat(n(e.used),"/").concat(n(e.total),") 配额：").concat(e.is_user_quota?"启用":"未启用"),value:e.mountpoint,data:e}))}}catch(e){}finally{x.value=!1}},selectPackageOptions:g,changePackageEvent:e=>{const a=m.value.find(a=>a.data.package_id===e);g.value=a.data},refreshList:()=>{p.value=(new Date).getTime()},refreshInfo:p,checkedAccountLimit:u,accountAuth:o}}),de=()=>{const e=oe(),a=M(e);return{...e,...a}},ce={class:"p-[2rem]"},pe={class:"custom-table"},ue=["disabled"],me=z({__name:"index",setup(e,{expose:a}){const{isEdit:t,formData:s,packageOptions:l,packageLoading:i,renderPackageOptions:b,changePackageEvent:k,selectPackageOptions:g,diskOptions:v,diskLoading:y,renderDiskOptions:f,refreshList:w,resetFormData:C}=de(),{request:j,load:T}=u(),O=e=>e.getTime()<Date.now()-864e5,{BtForm:q,submit:B}=r({data:s.value,options:e=>A(()=>[ie("用户名","username",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入用户名",disabled:t.value},rules:[{required:!0,message:"用户名不能为空！",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}]}),re("密码","password",{attrs:{class:"!w-[32rem]",placeholder:"请输入密码"},rules:t.value?[]:[{required:!0,clearable:!0,message:"密码不能为空！"},o({complex:{length:6}})]},()=>e.value.password=m(12)),{type:"slots",key:"expire_time"},{type:"slots",key:"package_id"},!t.value&&{type:"slots",key:"mountpoint"},ie("备注","remark",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入备注内容，可为空"}})]),submit:async(e,a,s)=>{await a();let l={...e.value,email:"vhost@bt.cn"};0===l.expireType?l.expire_date="0000-00-00":l.expire_date=d(l.expire_date)?l.expire_date:F(l.expire_date,"YYYY-MM-DD"),delete l.expireType;const{max_site_limit:n,disk_space_quota:i,monthly_bandwidth_limit:r,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_}=g.value;l={...l,disk_space_quota:i,monthly_bandwidth_limit:r,max_site_limit:n,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_},t.value?delete l.mountpoint:delete l.account_id;let h=null;const x=T("正在提交表单信息，请稍候...");try{if(h=await(t.value?c(l):p(l)),j(h),!h.status)return!1;C(),w()}catch(b){}finally{x.close()}return h}});return U(()=>{b(),f()}),a({onConfirm:B,onCancel:C}),(e,a)=>{const r=_,o=ne,d=h,c=x,p=le,u=H("bt-loading");return I(),S("div",ce,[N(G(q),null,{expire_time:R(()=>[N(d,{prop:"expire_date",label:"到期时间"},{default:R(()=>[N(r,{modelValue:G(s).expireType,"onUpdate:modelValue":a[0]||(a[0]=e=>G(s).expireType=e),options:[{label:"永久",value:0},{label:"自定义",value:1}]},null,8,["modelValue"]),G(s).expireType?(I(),J(o,{key:0,"disabled-date":O,class:"!w-[15rem] ml-[3.5rem]",modelValue:G(s).expire_date,"onUpdate:modelValue":a[1]||(a[1]=e=>G(s).expire_date=e),type:"date","date-format":"YYYY-MM-DD",placeholder:"选择到期日期"},null,8,["modelValue"])):K("",!0)]),_:1})]),package_id:R(()=>[N(d,{prop:"expire_date",label:"资源包"},{default:R(()=>[Q((I(),S("div",null,[N(c,{modelValue:G(s).package_id,"onUpdate:modelValue":a[2]||(a[2]=e=>G(s).package_id=e),options:G(l),placeholder:"请选择资源包",onChange:G(k),clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options","onChange"]),N(p,{trigger:"hover",placement:"right","popper-style":"padding:0",width:"240px"},{reference:R(()=>[...a[4]||(a[4]=[X("span",{class:"bt-link text-small ml-[15px]"},"详情",-1)])]),default:R(()=>[X("table",pe,[X("tbody",null,[X("tr",null,[a[5]||(a[5]=X("td",null,"资源名称",-1)),X("td",null,Z(G(g).package_name),1)]),X("tr",null,[a[6]||(a[6]=X("td",null,"备注",-1)),X("td",null,Z(G(g).remark),1)]),X("tr",null,[a[7]||(a[7]=X("td",null,"磁盘配额（MB）",-1)),X("td",null,Z(G(g).disk_space_quota?G(n)(G(g).disk_space_quota,!0,0):"无限制"),1)]),X("tr",null,[a[8]||(a[8]=X("td",null,"每月带宽限制（MB）",-1)),X("td",null,Z(G(g).monthly_bandwidth_limit?G(n)(G(g).monthly_bandwidth_limit,!0,0):"无限制"),1)]),X("tr",null,[a[9]||(a[9]=X("td",null,"最大网站数",-1)),X("td",null,Z(G(g).max_site_limit?G(g).max_site_limit:"无限制"),1)]),X("tr",null,[a[10]||(a[10]=X("td",null,"数据库数量",-1)),X("td",null,Z(G(g).max_database?G(g).max_database:"无限制"),1)]),X("tr",null,[a[11]||(a[11]=X("td",null,"启动子进程数量",-1)),X("td",null,Z(G(g).php_start_children),1)]),X("tr",null,[a[12]||(a[12]=X("td",null,"最大子进程数量",-1)),X("td",null,Z(G(g).php_max_children),1)])])])]),_:1})])),[[u,G(i)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])]),_:1})]),mountpoint:R(()=>[N(d,{prop:"expire_date",label:"存储磁盘"},{default:R(()=>[Q((I(),S("div",{disabled:G(t)},[N(c,{modelValue:G(s).mountpoint,"onUpdate:modelValue":a[3]||(a[3]=e=>G(s).mountpoint=e),options:G(v),placeholder:"请选择存储磁盘",clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options"])],8,ue)),[[u,G(y)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])]),_:1})]),_:1})])}}}),{request:_e}=u(),{refreshList:he,accountAuth:xe,isEdit:be,formData:ke}=de(),ge=(e=!1)=>{if(v(e))be.value=!0,ke.value={account_id:e.account_id,username:e.username,password:"",email:e.email,package_id:e.package_id,expireType:"0000-00-00"!==e.expire_date?1:0,expire_date:"0000-00-00"!==e.expire_date?e.expire_date:"",mountpoint:e.mountpoint,remark:e.remark};else if(xe.value.number>=xe.value.limit)return void _e({type:"warning",content:"当前用户数量已达上限，如需更多用户管理，请联系客服。"});j({title:"".concat(e?"编辑":"添加","用户"),area:"500px",component:me,showFooter:!0})},ve=e=>{k({title:"删除用户".concat(e.username),content:"是否删除该用户".concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await T({account_id:e.account_id,is_del_resources:!0});_e(a),he()}})},ye=async e=>{const{data:a}=await g({account_id:e.account_id});v(a)&&window.open(a.login_url+"?token="+a.token,"_blank","noopener,noreferrer")},fe=async()=>{try{let e=[];const{data:a}=await i();return s(a)&&(e=[{label:"全部分类",value:"all"},...a.map(e=>({label:e.name,value:Number(e.type_id)}))]),e||[]}catch(e){return[]}},we={class:"ml-[10px] flex items-center h-[30px] font-bold text-secondary"},Ce=z({__name:"index",setup(t){const{mainHeight:s}=a(),{refreshInfo:l,checkedAccountLimit:i}=de(),{BtOperation:r}=O({options:[{type:"button",label:"添加用户",active:!0,onClick:()=>ge()}]}),{BtTable:o,BtSearch:d,BtRefresh:p,BtPage:u,BtColumn:m,BtTableCategory:_,refresh:h}=q({request:e=>(async e=>{const a=await b(e);return a.data.list?(xe.value.number=a.data.page.count,{data:a.data.list,total:a.data.page.count}):{data:[],total:0}})({rows:e.limit,search_value:e.search,p:e.p,type_id:e.type_id}),columns:[{label:"用户名",prop:"username",minWidth:100,render:e=>N("span",{class:"text-primary cursor-pointer",onClick:()=>ye(e)},[e.username])},{label:"资源包",prop:"package_name",isCustom:!0,minWidth:100},{label:"磁盘配额",prop:"quota",minWidth:100,isCustom:!0,render:e=>N("span",{class:0===e.disk_space_status?"text-error":""},[0===e.disk_space_used&&0===e.disk_space_quota?"-":n(e.disk_space_used,!0,0),$(" / "),0===e.disk_space_quota?"无限制":n(e.disk_space_quota,!0,0)])},{label:"带宽",prop:"name",minWidth:100,isCustom:!0,render:e=>N("span",{class:0===e.monthly_bandwidth_status?"text-error":""},[n(e.monthly_bandwidth_used,!0,0),$(" / "),0===e.monthly_bandwidth_limit?"无限制":n(e.monthly_bandwidth_limit,!0,0)])},{label:"状态",prop:"status",minWidth:60,isCustom:!0,render:e=>{const a=new Map([[-1,"所有"],[0,"停用"],[1,"正常"],[2,"过期"]]);return N("span",{onClick:()=>(async e=>{k({title:"".concat(1===e.status?"停用":"启用","用户").concat(e.username),content:"是否".concat(1===e.status?"停用":"启用","该用户").concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await c({account_id:e.account_id,status:1===e.status?0:1});_e(a),he()}})})(e),class:"cursor-pointer ".concat(1===e.status||-1===e.status?"text-primary":"text-danger")},[a.get(e.status)])}},{label:"过期时间",prop:"expire_date",minWidth:80,isCustom:!0,render:e=>"0000-00-00"===e.expire_date?"永久":e.expire_date},{label:"备注",prop:"remark",minWidth:200,isCustom:!0,render:e=>e.remark?e.remark:"--"},{label:"登录信息",prop:"info",minWidth:65,isCustom:!0,render:e=>N("span",{class:"text-primary cursor-pointer",onClick:()=>(e=>{const{login_url:a,username:t,init_password:s}=e;y({value:"账号: ".concat(a,"\n用户: ").concat(t,"\n初始密码: ").concat(s)})})(e)},[$("复制")])},ae([{onClick:ye,title:"登录虚拟主机",width:100},{onClick:e=>ge(e),title:"编辑"},{onClick:ve,title:"删除"}])],extension:[B(),D(),te({key:"type_id",name:"",options:()=>[{label:"全部分类",value:"all"}],event:{get:fe,add:f,update:w,delete:C}})]});return ee(()=>l.value,h),(a,t)=>{const l=V,n=e;return I(),S("div",null,[N(E),N(n,null,{"header-left":R(()=>[N(G(r)),X("div",we,[$(Z(G(i))+"，更多信息 ",1),N(l,{href:"https://www.bt.cn/new/wechat_customer",class:"mx-[10px]"},{default:R(()=>[...t[1]||(t[1]=[X("img",{src:L,class:"w-[14px] h-[14px]"},null,-1),$("联系客服",-1)])]),_:1})]),X("div",{class:"flex items-center mr-[10px]",onClick:t[0]||(t[0]=e=>G(se)({name:"用户管理",type:35,id:62}))},[...t[2]||(t[2]=[X("i",{class:"svgtofont-desired text-medium mr-[4px]"},null,-1),X("span",{class:"bt-link"},"需求反馈",-1)])]),N(l,{href:"https://www.bt.cn/bbs/thread-141273-1-1.html",class:"mr-[10px]"},{default:R(()=>[...t[3]||(t[3]=[$(">> 使用文档",-1)])]),_:1})]),"header-right":R(()=>[N(G(d),{placeholder:"请输入用户名称",class:"!w-[270px] mr-[10px]"}),N(G(p),{class:"mr-[10px]"}),N(G(m))]),content:R(()=>[N(G(o),{"min-height":G(s)},null,8,["min-height"])]),"footer-right":R(()=>[N(G(u))]),_:1})])}}});export{Ce as default};
