import{u as e,an as a,V as t,Q as l,n as s,H as n,p as i,M as r,ap as o,x as c,b6 as d,aK as m,bb as u,W as p,l as f,ah as b,j as _,k as v,R as x,az as g,_ as k,aC as y}from"./utils-lib.js?v=1763689792";import{c as h,g as w,o as D,r as C,v as V,x as q,y as j,z as B,O as P,G as T,A as z,B as E,J as O,L as U,e as M,C as R,D as F,aE as H,a8 as I,b6 as A,aZ as L,H as W,ba as S,am as Y,an as J,bu as G,aB as K,I as N,F as Q,R as Z,K as $,at as X,as as ee,ar as ae,ad as te,ab as le,aD as se}from"./base-lib.js?v=1763689792";import{g as ne}from"./useStore2.js?v=1763689792";import{_ as ie}from"./index124.js?v=1763689792";import{_ as re}from"./index109.js?v=1763689792";import{u as oe,c as ce,a as de,h as me,g as ue}from"./column.js?v=1763689792";import{getBinlogBackupFiles as pe,delBinlogBackupTask as fe,getBinlogBackupLogs as be,deleteBinlogBackupFile as _e,clearBinlogBackup as ve,restoreBinlogData as xe,getBinlogBackupTask as ge,getIncrementBackupInfo as ke,getRestoreProgress as ye,backDatabase as he,backModuleDatabase as we,delBackup as De,checkDatabasePass as Ce,restoreModuleBack as Ve,restoreBack as qe}from"./database.js?v=1763689792";import{_ as je}from"./index123.js?v=1763689792";import{_ as Be}from"./index107.js?v=1763689792";import{_ as Pe}from"./index118.js?v=1763689792";import{f as Te}from"./validator.js?v=1763689792";import{t as ze,w as Ee}from"./useMethod4.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./index110.js?v=1763689792";const Oe={key:0},Ue={class:"data-show"},Me={class:"bg-lighter rounded-lg border border-light p-6 mb-4"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-6 pb-6 border-b border-light"},Fe={class:"text-center md:text-left"},He={class:"text-medium"},Ie={class:"grid grid-cols-2 col-span-2 gap-6","element-loading-text":"获取中..."},Ae={class:"text-center md:text-left"},Le={class:"text-medium"},We={class:"text-center md:text-left"},Se={class:"text-medium"},Ye={class:"pt-6 pb-3"},Je={class:"flex items-center justify-between"},Ge={class:"flex items-center space-x-8"},Ke={class:"pb-3"},Ne={class:"flex items-center space-x-4"},Qe={class:"text-small text-secondary"},Ze={class:"text-small text-secondary"},$e={class:"flex items-center justify-between"},Xe={class:"flex items-center space-x-8"},ea={class:"text-small font-medium"},aa={class:"text-small font-medium"},ta={class:"flex items-center gap-4"},la={class:"flex items-center"},sa=h({__name:"index",props:{compData:{default:()=>[]},isRowBackup:{type:Boolean,default:!1}},setup(d,{expose:m}){const{payment:u}=e();w(()=>u.value.authType),ne();const p=d,f=D({name:"",tableCount:0,size:""}),b=C(!1),_=D({database_name:"test_db",full_backup_schedule:{type:"daily",time:"02:30:00",weekday:0,interval_days:0,interval_hours:0},incremental_backup_interval:30,enabled:!0,create_time:"",last_full_backup:"",last_incremental_backup:"",next_full_backup:"",next_incremental_backup:"",space_free:!0}),v=D({time:"",type:"all"}),x=D({disabledDate:e=>{const a=new Date;a.setHours(23,59,59,999);const t=a.getTime();return e.getTime()>t},defaultTime:[new Date,new Date]}),g={title:"企业增量备份",ps:"企业增量备份只定时备份发生变化新增、修改、删除文件和数据，不会每次都备份所有数据",source:54,desc:[],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/database/database_enterprise_backup.png"}]},k={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},y=w(()=>{if(!_.database_name)return"--";switch(_.full_backup_schedule.type){case"daily":return"每天 ".concat(_.full_backup_schedule.time," 备份");case"weekly":return"每周 ".concat(k[_.full_backup_schedule.weekday]," ").concat(_.full_backup_schedule.time," 备份");case"interval":return"每隔 ".concat(_.full_backup_schedule.interval_days," 天后 ").concat(_.full_backup_schedule.time," 备份");case"hours":return"每隔 ".concat(_.full_backup_schedule.interval_hours," 小时 ").concat(_.full_backup_schedule.time||""," 备份")}}),K=w(()=>_.database_name?_.incremental_backup_interval>60?"每 ".concat(Math.floor(_.incremental_backup_interval/60),"小时").concat(_.incremental_backup_interval%60,"分钟备份"):"每 ".concat(_.incremental_backup_interval," 分钟备份"):"--"),N=async()=>{s({title:"配置备份计划",area:85,component:()=>n(()=>import("./add-increment.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:{...p.compData,backupPlan:_,refreshEvent:()=>{se()}}})},Q=async()=>{_.enabled?(await i({title:"停止备份计划",content:"确定停止数据库【".concat(_.database_name,"】增量备份计划吗？停止后将无法进行增量备份")}),await l({loading:"停止备份计划中...",message:!0,request:fe({id:p.compData.id})}),se()):N()},Z=()=>{s({title:"备份日志",area:56,btns:!1,component:h({setup:()=>{const e=C("");return l({loading:"获取日志中...",request:be({id:p.compData.id}),success:a=>{if(!a.data.status)return r.error(a.data.msg);e.value=a.data.data.join("\n")}}),()=>H("div",{class:"overflow-y-auto"},H(je,{class:"!h-[40rem]",content:e.value,isHtml:!0}))}})})},$=async()=>{await i({title:"清空备份",content:"当前将清空【".concat(p.compData.name,"】下通过备份计划备份的全量与增量备份（不会清除手动备份），请确保当前数据已正常，再清空备份"),type:"calc"}),await l({loading:"清空备份中...",message:!0,request:ve({id:p.compData.id})}),te()},X=o([{label:"删除备份",value:"delete",event:()=>{}}]),{BtTable:ee,BtPage:ae,refresh:te,BtBatch:le}=a({request:async e=>{const a={id:p.compData.id,page:e.p,limit:e.limit,backup_type:v.type,...v.time?{date:t(v.time,"yyyy-MM-dd")}:{}},{data:s}=await l({loading:"获取备份记录中...",request:pe(a)});return{data:s.data.list,total:s.data.total}},columns:[{label:"备份时间",prop:"backup_time",showOverflowTooltip:!0,minWidth:100},{label:"备份类型",prop:"backup_type",minWidth:100,render:e=>"incremental"===e.backup_type?"增量备份":"全量备份"},{label:"备份大小",prop:"formatted_size",minWidth:100},oe([{onClick:e=>(async e=>{await i({title:"还原备份【".concat(e.backup_time,"】"),content:"此操作将覆盖当前数据库的所有数据，请确保已经备份现有数据！",type:"calc"});const a=await l({loading:"还原备份中...",request:xe({id:p.compData.id,restore_time:e.backup_time})});if(!a.data.status)return r.error(a.data.msg);s({title:"还原进度",area:56,btns:!1,component:h({setup:(e,{emit:t})=>{const s=D({status:"preparing",progress:0,message:"准备还原数据...",restore_time:"",start_time:"",update_time:"",error:null,backup_files:[]}),n=C(null),i=C(!0),o={preparing:{text:"准备还原数据",color:"#20a53a",progress:0},analyzing:{text:"分析备份文件",color:"#20a53a",progress:10},restoring:{text:"正在还原数据",color:"#20a53a",progress:20},finalizing:{text:"完成还原操作",color:"#20a53a",progress:90},completed:{text:"还原完成",color:"#20a53a",progress:100},failed:{text:"还原失败",color:"#f56c6c",progress:0},not_found:{text:"任务不存在",color:"#e6a23c",progress:0}},c=async()=>{var e,t,d,m,u;if(i.value)try{const p=await l({request:ye({task_id:a.data.data.task_id})});if(null==(e=null==p?void 0:p.data)?void 0:e.status){const e=p.data.data;s.status=e.status||"preparing",s.message=e.message||(null==(t=o[s.status])?void 0:t.text)||"处理中...",s.restore_time=e.restore_time||"",s.start_time=e.start_time||"",s.update_time=e.update_time||"",s.backup_files=e.backup_files||[],s.error=e.error||null,void 0!==e.progress?s.progress=Math.min(Math.max(e.progress,0),100):s.progress=(null==(d=o[s.status])?void 0:d.progress)||0;const a=["completed","failed","not_found"].includes(s.status);!a&&i.value?n.value=setTimeout(c,1500):a&&("completed"===s.status?(r.success("数据库还原成功"),te()):"failed"===s.status&&r.error(s.error||"还原失败，请查看错误信息"),i.value=!1)}else s.status="failed",s.message=(null==(m=null==p?void 0:p.data)?void 0:m.msg)||"获取进度失败",s.error=(null==(u=null==p?void 0:p.data)?void 0:u.error_msg)||"未知错误",i.value=!1}catch(p){s.status="failed",s.message="获取进度失败，请检查网络连接",s.error="网络连接异常",i.value=!1}};return c(),I(()=>{n.value&&(clearTimeout(n.value),n.value=null),i.value=!1}),()=>{var e,a;return M("div",{class:"p-[2rem]"},[M("div",{class:"flex items-center mb-[2rem]"},[M("i",{class:["!text-[3rem] mr-[1rem]","completed"===s.status?"svgtofont-el-success-filled text-primary":"failed"===s.status?"svgtofont-el-circle-close-filled text-danger":"svgtofont-el-loading animate-spin text-primary"]},null),M("div",{class:"flex-1"},[M("div",{class:"text-medium font-medium mb-[4px]"},["completed"===s.status?"还原成功":"failed"===s.status?"还原失败":"正在还原数据库"]),M("div",{class:"text-small text-secondary"},[F("数据库："),p.compData.name])])]),!["completed","failed"].includes(s.status)&&M("div",{class:"mb-[2rem]"},[M("div",{class:"flex justify-between items-center mb-[8px]"},[M("span",{class:"text-base"},[s.message]),M("span",{class:"text-small text-secondary"},[s.progress,F("%")])]),M(A,{percentage:s.progress,"stroke-width":8,"show-text":!1,color:(null==(e=o[s.status])?void 0:e.color)||"#20a53a"},null)]),M("div",{class:"bg-light rounded-lg p-[1.5rem] mb-[1.5rem]"},[M("div",{class:"text-base font-medium mb-[1rem] text-default"},[F("还原信息")]),M("div",{class:"space-y-[8px] text-small text-secondary"},[s.restore_time&&M("div",{class:"flex"},[M("span",{class:"w-[8rem] flex-shrink-0"},[F("还原时间点：")]),M("span",null,[s.restore_time])]),s.start_time&&M("div",{class:"flex"},[M("span",{class:"w-[8rem] flex-shrink-0"},[F("开始时间：")]),M("span",null,[s.start_time])]),s.update_time&&M("div",{class:"flex"},[M("span",{class:"w-[8rem] flex-shrink-0"},[F("更新时间：")]),M("span",null,[s.update_time])]),M("div",{class:"flex"},[M("span",{class:"w-[8rem] flex-shrink-0"},[F("当前状态：")]),M("span",{class:"flex items-center"},[M("span",{class:["w-[8px] h-[8px] rounded-full mr-[6px]","completed"===s.status?"bg-primary":"failed"===s.status?"bg-[#ef0808]":"hidden"]},null),(null==(a=o[s.status])?void 0:a.text)||s.message])])])]),s.backup_files&&s.backup_files.length>0&&M("div",{class:"bg-light rounded-lg p-[1.5rem] mb-[1.5rem]"},[M("div",{class:"text-base font-medium mb-[1rem] text-default"},[F("相关备份文件 ("),s.backup_files.length,F("个)")]),M("div",{class:"space-y-[4px] max-h-[8rem] overflow-y-auto"},[s.backup_files.map((e,a)=>M("div",{key:a,class:"text-[1.1rem] text-secondary bg-white px-[8px] py-[4px] rounded"},[e]))])]),"failed"===s.status&&s.error&&M("div",{class:"bg-light border rounded-lg p-[1.5rem] mb-[1.5rem]"},[M("div",{class:"text-base font-medium mb-[1rem] text-danger flex items-center"},[M("i",{class:"svgtofont-el-warning-filled mr-[6px]"},null),F("错误详情")]),M("div",{class:"text-small text-secondary whitespace-pre-wrap"},[s.error])])])}}})})})(e),title:"还原"},{onClick:e=>(async e=>{window.open("/download?filename="+e,"_blank")})(e.file_path),title:"下载"},{onClick:e=>(async e=>{await i({title:"删除备份",content:"确定删除该备份吗？删除后将无法恢复!"}),await l({loading:"删除备份中...",message:!0,request:_e({backup_id:e})}),te()})(e.backup_id),title:"删除"}])],extension:[X]}),se=async()=>{const{data:e}=await l({loading:"获取备份计划信息中...",request:ge({id:p.compData.id})});e.status?(_.database_name=e.data.database_name,_.full_backup_schedule=e.data.full_backup_schedule,_.incremental_backup_interval=e.data.incremental_backup_interval,_.enabled=e.data.enabled,_.create_time=e.data.create_time,_.last_full_backup=e.data.last_full_backup,_.last_incremental_backup=e.data.last_incremental_backup,_.next_full_backup=e.data.next_full_backup,_.next_incremental_backup=e.data.next_incremental_backup,_.space_free=e.data.space_free):_.database_name=""},ce=async()=>{f.name=p.compData.name,se();const{data:e}=await l({loading:b,request:ke({id:p.compData.id})});e.status&&(f.tableCount=e.data.table_count||0,f.size=c(e.data.db_size)||"--")};return V(ce),m({init:ce}),(e,a)=>{const t=L,l=W,s=S,n=Y,i=J,r=re,o=ie,c=G;return q(),j("div",null,["ltd"===B(u).authType?(q(),j("div",Oe,[B(_).space_free?T("",!0):(q(),P(t,{key:0,title:"当前磁盘空间不足1GB，已自动停止增量备份，如需继续请释放磁盘空间",type:"warning","show-icon":"",class:"!mb-4"})),z("div",Ue,[z("div",Me,[z("div",Re,[z("div",Fe,[a[2]||(a[2]=z("div",{class:"text-small text-secondary mb-1"},"数据库名称",-1)),z("div",He,E(B(f).name||"--"),1)]),O((q(),j("div",Ie,[z("div",Ae,[a[3]||(a[3]=z("div",{class:"text-small text-secondary mb-1"},"表数量",-1)),z("div",Le,E(B(f).tableCount||0),1)]),z("div",We,[a[4]||(a[4]=z("div",{class:"text-small text-secondary mb-1"},"数据库大小",-1)),z("div",Se,E(B(f).size||"--"),1)])])),[[c,B(b)]])]),z("div",Ye,[z("div",Je,[z("div",Ge,[a[5]||(a[5]=z("h3",{class:"text-base font-medium text-secondary"},"备份计划",-1)),z("span",{class:U(["px-3 py-1 rounded-full text-small font-medium cursor-pointer",B(_).enabled?"bg-[var(--el-color-primary-light-9)] text-primary":"bg-[var(--el-color-danger-light-9)] text-red-700"]),onClick:Q},E((d=B(_).enabled,d?"运行中":"已停止")),3)])])]),z("div",Ke,[z("div",Ne,[z("span",Qe,"全量: "+E(B(y)),1),a[7]||(a[7]=z("span",{class:"text-gray-300"},"|",-1)),z("span",Ze,"增量: "+E(B(K)),1),M(l,{type:"primary",class:"ml-[1rem]",size:"small",text:"",onClick:Z},{default:R(()=>[...a[6]||(a[6]=[F(" 查看日志 ",-1)])]),_:1})])]),z("div",null,[z("div",$e,[z("div",Xe,[a[8]||(a[8]=z("div",{class:"text-small text-secondary"},"最近执行时间",-1)),z("div",ea,E(B(_).last_incremental_backup||"--"),1),a[9]||(a[9]=z("div",{class:"text-small text-secondary"},"下次执行时间",-1)),z("div",aa,E(B(_).next_incremental_backup||"--"),1)]),a[10]||(a[10]=z("div",null,null,-1))])])])]),M(r,null,{"header-left":R(()=>[z("div",ta,[M(l,{type:"primary",onClick:N},{default:R(()=>[...a[11]||(a[11]=[F("编辑计划 ",-1)])]),_:1}),M(l,{type:"default",onClick:$},{default:R(()=>[...a[12]||(a[12]=[F("清空备份 ",-1)])]),_:1})])]),"header-right":R(()=>[z("div",la,[M(s,{type:"date",modelValue:B(v).time,"onUpdate:modelValue":a[0]||(a[0]=e=>B(v).time=e),"show-after":100,class:"!w-[24rem] !h-[30px]","disabled-date":B(x).disabledDate,placeholder:"请选择日期",format:"YYYY-MM-DD","value-format":"x",onChange:B(te)},null,8,["modelValue","disabled-date","onChange"]),M(i,{modelValue:B(v).type,"onUpdate:modelValue":a[1]||(a[1]=e=>B(v).type=e),class:"rounded-none !w-[12rem] ml-[1rem]",onChange:B(te)},{default:R(()=>[M(n,{label:"全部类型",value:"all"}),M(n,{label:"增量备份",value:"incremental"}),M(n,{label:"全量备份",value:"full"})]),_:1},8,["modelValue","onChange"])])]),content:R(()=>[M(B(ee),{"max-height":221})]),"footer-left":R(()=>[...a[13]||(a[13]=[])]),"footer-right":R(()=>[M(B(ae))]),popup:R(()=>[...a[14]||(a[14]=[])]),_:1}),a[15]||(a[15]=z("ul",{class:"mt-[8px] leading-8 text-small list-disc ml-[20px]"},[z("li",null,"还原数据等操作将会被增量备份记录，导致备份大小增大"),z("li",null,"建议确认数据正常后，手动备份并【清空备份】，重置为干净状态")],-1))])):(q(),P(o,{key:1,data:g,class:"p-20px"}))]);var d}}}),na={class:"p-20px"},ia={class:"p-20px"},ra={class:"mt-4px leading-8 text-small list-disc ml-[20px]"},oa=k(h({__name:"route-back",props:{compData:{default:()=>({id:0,name:""})}},setup(a){const t=a,{refs:{tabActive:o},refreshTableList:c}=ne(),{panel:k}=e(),y=K("popupClose"),h=C(),w=C(),T=C(),E=C([]),U=C(!1),H=C(!1),{id:I,name:A}=t.compData,L=D({search:I,type:1,table:"backup",total:0,p:1,limit:10}),S=C(!1),Y=D({backupPath:""}),J=C(),G=C(!1),se=D({pwd:""}),ie=[{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},ce()],onConfirm:async()=>(await a(ge),Me(),c(),!1)})}}],pe=()=>{Te({type:"dir",path:Y.backupPath,change:e=>{Y.backupPath=e}})},fe=async()=>{await i({title:"提示",content:"修改默认备份目录，会导致网站和站点默认备份会备份到该目录下，是否继续操作？"}),k.value.backupPath=Y.backupPath},be=({filename:e})=>(x(e)||g(e))&&-1!==e.indexOf("|"),_e=()=>{s({title:"表备份",area:60,component:()=>n(()=>import("./table-back.js?v=1763689792"),__vite__mapDeps([]),import.meta.url),compData:{...t.compData,refreshFn:Me},showFooter:!0})},ve=async()=>{const{router:e}=await n(()=>import("./utils-lib.js?v=1763689792").then(e=>e.lW),__vite__mapDeps([]),import.meta.url);y(),e.push({name:"crontab"})},xe=async e=>{let a=null;"mysql"===o.value&&(a=ze({type:"backup",config:{path:"/tmp/import_sql.log",id:t.compData.id,name:t.compData.name}}));let s={id:t.compData.id};e&&(s.password=se.pwd),await l({loading:"mysql"===o.value?void 0:"正在备份数据库，请稍后...",request:"mysql"===o.value?he(s):we({data:JSON.stringify(s)},o.value),message:!0,success:async e=>{const t=await a;null==t||t.unmount(),e.status&&(Me(),c())}})},ge=async(e,a=!1)=>{try{a&&await i({title:"删除备份",content:'<p>删除备份后，<span class="text-danger">备份数据将无法恢复</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});const t=await De({id:e.id});return a&&(r.request(t),Me()),t}catch(t){m(t,"delBackEvent")}finally{H.value&&H.value.close()}},ke=async(e,a=!1)=>{w.value=e,await i({title:"恢复数据库",content:"恢复备份文件将会覆盖当前数据库[".concat(t.compData.name,"]，是否继续？"),type:"calc",icon:"warning-filled"});let s={file:e.localexist?e.local:e.filename,name:t.compData.name};if(a&&(s.disk_check=!0),"mysql"===o.value){const{data:a}=await Ce({file:e.localexist?e.local:e.filename});if(a)return h.value=!0,void(G.value=!0);ye(s,e)}else s.file=e.local,l({loading:"正在恢复数据库,请稍后...",request:Ve({data:JSON.stringify(s)},o.value),message:!0})},ye=async(e,a)=>{const s=ze({type:"import",config:{path:"/tmp/import_sql.log",id:a.id,name:t.compData.name}});await l({request:qe(e),message:!0,success:async e=>{var t;if(-1!==(null==(t=e.msg)?void 0:t.indexOf("警告")))return await je(e.msg,"恢复"),void ke(a,!0)}});const n=await s;null==n||n.unmount()},je=(e,a)=>i({title:"提示",isHtml:!0,width:"50rem",confirmText:"继续".concat(a),content:'<div class="flex"><i class="svgtofont-el-warning-filled text-[4rem] text-warning mr-4"></i><div><div>'.concat(e,"</div><div>\n\t\t\t<p>如继续").concat(a,"可能会有以下影响：</p>\n\t\t\t<p>1.").concat(a,"数据不完整</p>\n\t\t\t<p>2.系统运行缓慢</p>\n\t\t\t<p>3.面板无法正常工作</p>\n\t\t\t<p>4.mysql无法正常运行</p></div></div></div>")}),Oe=e=>{switch(e){case"databaseBack":xe(!1);break;case"backPath":break;case"databasePwdBack":G.value=!0;break;case"tableBack":_e()}},Ue=async()=>{if(await J.value.validate(),h.value){const e={file:w.value.localexist?w.value.local:w.value.filename,name:t.compData.name,password:se.pwd};ye(e,w.value),G.value=!1,h.value=!1}else xe(!0),G.value=!1},Me=async()=>{l({request:u({...L}),loading:U,data:{data:[Array,E],page:p(L)}})},Re=[de(),{label:"文件名称",prop:"name",width:220,showOverflowTooltip:!0},{label:"存储对象",render:e=>{let a=!1,t="";return be(e)&&(a=!0,t=e.filename.match(/\|(.+)\|/,"$1")),M("span",null,[a?Ee[t[1]]:"本地"])}},me({prop:"size",width:100}),{width:160,prop:"addtime",label:"备份时间"},ue({table:"backup"}),oe([{isHide:e=>be(e),onClick:e=>ke(e),title:"恢复"},{onClick:e=>(async e=>{if("mysql"!==o.value||e.localexist)window.open("/download?filename="+e.local,"_blank");else{if(be(e))return void r.error("不支持从此处下载云存储备份，如需下载请在备份时勾选同时保留本地备份");r.error("备份文件不存在")}})(e),title:"下载"},{onClick:e=>ge(e,!0),title:"删除"}])];return V(Me),(e,a)=>{const t=X,l=ee,s=ae,n=W,i=f,r=b,c=Pe,m=Be,u=te,p=le,x=_,g=v,k=re,y=N("bt-loading");return q(),j("div",null,[M(k,null,{"header-left":R(()=>["mysql"==B(o)?(q(),P(s,{key:0,"split-button":"",type:"primary",onCommand:Oe,onClick:a[0]||(a[0]=e=>Oe("databaseBack"))},{dropdown:R(()=>[M(l,null,{default:R(()=>[M(t,{command:"databaseBack"},{default:R(()=>[...a[12]||(a[12]=[F(" 备份数据库 ",-1)])]),_:1}),M(t,{command:"databasePwdBack"},{default:R(()=>[...a[13]||(a[13]=[F(" 加密备份数据库 ",-1)])]),_:1}),M(t,{command:"tableBack"},{default:R(()=>[...a[14]||(a[14]=[F("表备份",-1)])]),_:1})]),_:1})]),default:R(()=>[a[15]||(a[15]=F(" 备份数据库 ",-1))]),_:1})):(q(),j(Q,{key:1},[M(n,{type:"primary",onClick:a[1]||(a[1]=e=>xe(!1))},{default:R(()=>[...a[16]||(a[16]=[F(" 备份数据库 ",-1)])]),_:1}),M(n,{type:"default",onClick:a[2]||(a[2]=e=>_e())},{default:R(()=>[...a[17]||(a[17]=[F(" 表备份 ",-1)])]),_:1})],64))]),"header-right":R(()=>[...a[18]||(a[18]=[])]),content:R(()=>[O(M(i,{ref_key:"routeBackupRef",ref:T,data:B(E),description:"暂无数据","max-height":460,column:B(Re)},null,8,["data","column"]),[[y,B(U)],[y,"正在加载中，请稍后...","title"]])]),"footer-left":R(()=>[M(r,{options:ie,"table-ref":B(T)},null,8,["table-ref"])]),"footer-right":R(()=>[M(c,{total:B(L).total,page:B(L).p,"onUpdate:page":a[3]||(a[3]=e=>B(L).p=e),row:B(L).limit,"onUpdate:row":a[4]||(a[4]=e=>B(L).limit=e),onChange:Me},null,8,["total","page","row"])]),popup:R(()=>[M(x,{title:"更换默认备份目录",modelValue:B(S),"onUpdate:modelValue":a[6]||(a[6]=e=>Z(S)?S.value=e:null),area:42,onConfirm:fe,showFooter:""},{default:R(()=>[z("div",na,[M(p,{ref:"ruleFormData",class:"mr-[16px] w-[80%]",model:B(Y),rule:{backupPath:[{required:!0,message:"请输入默认备份目录",trigger:"blur"}]}},{default:R(()=>[M(u,{label:"默认备份目录",prop:"backupPath"},{default:R(()=>[M(m,{icon:"icon-file_mode",modelValue:B(Y).backupPath,"onUpdate:modelValue":a[5]||(a[5]=e=>B(Y).backupPath=e),onIconClick:pe,width:"26rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),M(x,{title:B(h)?"数据库加密密码":"加密备份数据库",modelValue:B(G),"onUpdate:modelValue":a[10]||(a[10]=e=>Z(G)?G.value=e:null),area:42,onConfirm:Ue,showFooter:"",onCancel:a[11]||(a[11]=()=>B(se).pwd="")},{default:R(()=>[z("div",ia,[M(p,{ref_key:"pwdBackFormRef",ref:J,class:"mr-[16px] w-[80%]",model:B(se),rules:{pwd:[{required:!0,message:"请输入压缩密码",trigger:"blur"}]}},{default:R(()=>[M(u,{label:"压缩密码",prop:"pwd"},{default:R(()=>[B(h)?(q(),P(g,{key:1,modelValue:B(se).pwd,"onUpdate:modelValue":a[9]||(a[9]=e=>B(se).pwd=e),width:"26rem"},null,8,["modelValue"])):(q(),P(m,{key:0,modelValue:B(se).pwd,"onUpdate:modelValue":a[7]||(a[7]=e=>B(se).pwd=e),icon:"el-refresh",width:"26rem",onIconClick:a[8]||(a[8]=()=>B(se).pwd=B(d)(16)),"is-active":!0},null,8,["modelValue"]))]),_:1})]),_:1},8,["model"]),O(z("ul",ra,[...a[19]||(a[19]=[z("li",{class:"text-warning"},"设置密码后请注意保存密码，以防忘记密码导致无法恢复备份数据",-1)])],512),[[$,B(h)]])])]),_:1},8,["title","modelValue"])]),_:1}),z("ul",{class:"mt-8px leading-8 text-small list-disc ml-20px"},[z("li",null,[a[20]||(a[20]=F(" 定时备份请前往【 ",-1)),z("span",{title:"点击前往【计划任务】",class:"bt-link",onClick:ve}," 计划任务 "),a[21]||(a[21]=F(" 】增加【备份数据库】 ",-1))])])])}}}),[["__scopeId","data-v-68fe8236"]]),ca={class:"p-[20px] h-full"},da=h({__name:"index",props:{compData:{default:()=>({row:{}})}},emits:["close"],setup(e,{emit:a}){const{refs:{tabActive:t}}=ne(),l=C("routeBackup");return V(()=>{}),(a,s)=>{const n=se,i=y;return q(),j("div",ca,[M(i,{type:"card",modelValue:B(l),"onUpdate:modelValue":s[0]||(s[0]=e=>Z(l)?l.value=e:null),class:"bt-tabs bt-tabs-card"},{default:R(()=>[M(n,{name:"routeBackup",label:"常规备份",lazy:!0},{default:R(()=>[M(oa,{compData:e.compData.row},null,8,["compData"])]),_:1}),"mysql"==B(t)?(q(),P(n,{key:0,name:"increment",class:"mt-4",lazy:!0},{label:R(()=>[...s[1]||(s[1]=[z("span",{class:"flex items-center"},[z("i",{class:"mr-[4px] svgtofont-icon-ltd text-large text-[#9B7E48]"}),z("span",null,"增量备份")],-1)])]),default:R(()=>[M(sa,{compData:e.compData.row,isRowBackup:!0},null,8,["compData"])]),_:1})):T("",!0)]),_:1},8,["modelValue"])])}}});export{da as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
