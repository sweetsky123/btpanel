import{c as e,r as a,W as l,o as t,v as o,x as s,O as r,C as d,e as i,z as p,y as u,b1 as n,F as c,G as m,R as b,ad as f,an as y,U as _,ab as g,am as h}from"./base-lib.js?v=1763689792";import{u as w,lQ as v,Q as V,ax as D,k as P,$ as k,j as U,_ as j}from"./utils-lib.js?v=1763689792";import{_ as I}from"./index124.js?v=1763689792";import{G as x,F as S}from"./firewall.js?v=1763689792";import{a as A,g as T}from"./useMethod8.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";import"./column.js?v=1763689792";import"./index107.js?v=1763689792";import"./useStore6.js?v=1763689792";const C=j(e({__name:"add-port-rule",props:{compData:{default:()=>{}}},setup(e,{expose:j}){const C=e,{payment:N}=w(),{authType:O}=N.value,q=a(!1),F=a(),R=l(C.compData.isEdit),E={title:"指定域名-功能介绍",ps:"系统防火墙将会放行/阻止设置域名所解析的A/AAAA记录",source:106,desc:["放行/阻止域名解析记录"],tabImgs:[{title:"防火墙禁止端口",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_1.png"},{title:"域名解析已生效",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_2.png"},{title:"设置效果",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_3.png"}]},G=t({protocol:"tcp",port:"",choose:"all",types:"accept",brief:"",address:"",domain:"",chain:"INPUT"}),J=[{content:"支持添加多个端口，如：80,88"},{content:"支持添加多个端口范围，如：80,88,90-99,110-120"},{content:"默认配置下防火墙无法管理Docker容器端口"},{content:"此操作将重载防火墙，未持久化的 iptables 规则会清空，请先备份保存！"}],Q=[{title:"入站(默认)",key:"INPUT"},{title:"出站",key:"OUTPUT"}],z="请输入指定IP，多个IP请用,隔开或换行。例如192.168.1.1,192.168.1.2",H=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"},{label:"TCP/UDP",value:"all"}],M=[{title:"所有IP",key:"all"},{title:"指定IP",key:"point"}],W=[{title:"放行",key:"accept"},{title:"禁止",key:"drop"}],$={port:[{validator:v,trigger:["blur"],required:!0}],address:[{trigger:["blur","change"],required:!0,message:"请输入指定IP"}],domain:[{trigger:["blur","change"],required:!0,message:"请输入指定域名"}]},B=e=>{try{const a=/[^0-9,-]/g;G.port=e.replace(a,"")}catch(a){}},K=e=>{if(F.value.clearValidate(),"ltd"!==O&&"domain"===e)return G.choose="all",void(q.value=!0);G.choose=e};return o(()=>{var e,a;if(G.port=(null==(e=C.compData)?void 0:e.port)||"",C.compData.isEdit){const e="all"===(null==(a=C.compData)?void 0:a.Address);Object.assign(G,{protocol:C.compData.Protocol,port:C.compData.Port,types:C.compData.Strategy,brief:C.compData.brief,chain:C.compData.Chain,address:e?"":C.compData.Address,domain:C.compData.domain}),G.choose=e?"all":""===C.compData.domain?"point":"domain"}}),j({onConfirm:async e=>{await F.value.validate();const a=await(()=>{const e={...G,operation:"add",strategy:G.types};if("all"===e.choose&&delete e.address,e.brief||(e.brief=""),R.value&&(e.id=C.compData.id),R.value){const a={...C.compData};return a.noNps&&delete a.noNps,{old_data:JSON.stringify(a),new_data:JSON.stringify(e)}}return e})(),l="domain"===G.choose;await V({loading:"正在提交，请稍后...",message:!0,request:R.value?x(a,l):S(a,l),success:a=>{a.status&&e()}}),C.compData.refreshFn(),await A(),T(),R.value}}),(e,a)=>{const l=D,t=f,o=P,w=h,v=y,V=_,j=k,x=I,S=U,A=g;return s(),r(A,{ref_key:"editPortRulesRef",ref:F,rules:$,model:p(G),class:"p-[2rem] addfrom"},{default:d(()=>[i(t,{label:"协议"},{default:d(()=>[i(l,{modelValue:p(G).protocol,"onUpdate:modelValue":a[0]||(a[0]=e=>p(G).protocol=e),class:"!w-[24rem]",options:H},null,8,["modelValue"])]),_:1}),i(t,{label:"端口",prop:"port"},{default:d(()=>[i(o,{modelValue:p(G).port,"onUpdate:modelValue":a[1]||(a[1]=e=>p(G).port=e),width:"24rem",placeholder:"请输入端口",disabled:p(R),onInput:B},null,8,["modelValue","disabled"])]),_:1}),i(t,{label:"来源"},{default:d(()=>[i(v,{modelValue:p(G).choose,"onUpdate:modelValue":a[2]||(a[2]=e=>p(G).choose=e),onChange:K,class:"!w-[24rem]"},{default:d(()=>[(s(),u(c,null,n(M,(e,a)=>i(w,{key:a,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),"point"===p(G).choose?(s(),r(t,{key:0,label:"指定IP",prop:"address"},{default:d(()=>[i(o,{type:"textarea",rows:3,width:"24rem",modelValue:p(G).address,"onUpdate:modelValue":a[3]||(a[3]=e=>p(G).address=e),placeholder:z,clearable:""},null,8,["modelValue","placeholder"])]),_:1})):m("",!0),i(t,{label:"策略"},{default:d(()=>[i(v,{modelValue:p(G).types,"onUpdate:modelValue":a[4]||(a[4]=e=>p(G).types=e),class:"!w-[24rem]"},{default:d(()=>[(s(),u(c,null,n(W,(e,a)=>i(w,{key:a,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),i(t,{label:"方向"},{default:d(()=>[i(v,{modelValue:p(G).chain,"onUpdate:modelValue":a[5]||(a[5]=e=>p(G).chain=e),class:"!w-[24rem]"},{default:d(()=>[(s(),u(c,null,n(Q,e=>i(w,{key:e.key,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),i(t,{label:"备注"},{default:d(()=>[i(V,{modelValue:p(G).brief,"onUpdate:modelValue":a[6]||(a[6]=e=>p(G).brief=e),class:"!w-[24rem] special-input",clearable:"",placeholder:"请填写备注，可为空"},null,8,["modelValue"])]),_:1}),i(j,{options:J,listStyle:"disc",class:"pl-[6rem] pt-[1.2rem]"}),i(S,{title:"指定域名-功能介绍",area:60,modelValue:p(q),"onUpdate:modelValue":a[7]||(a[7]=e=>b(q)?q.value=e:null)},{default:d(()=>[i(x,{data:E,class:"p-4rem"})]),_:1},8,["modelValue"])]),_:1},8,["model"])}}}),[["__scopeId","data-v-247d5224"]]);export{C as default};
