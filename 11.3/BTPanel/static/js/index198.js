import{_ as e}from"./index109.js?v=1763689792";import{L as a,e as t,Q as s,ic as l,az as r,b as i,bj as n,_ as c,as as o,id as u,b6 as d,u as p,hy as m,n as v,N as w,p as b,ie as h,ig as g,ih as y,ii as f,ij as _}from"./utils-lib.js?v=1763689792";import{c as x,t as q,r as k,g as T,e as S,D as U,v as C,x as j,y as D,z as P,o as R,I as z,C as A,A as L,bb as M,J as O,H as J,U as N,a9 as V,S as H,O as F}from"./base-lib.js?v=1763689792";import{u as B}from"./column.js?v=1763689792";import{g as I}from"./useStore.js?v=1763689792";import{_ as W}from"./index110.js?v=1763689792";import{b as E,c as Q,f as G,d as K,j as X,e as Y,h as Z,F as $}from"./form-item.js?v=1763689792";import{_ as ee}from"./index437.js?v=1763689792";import{_ as ae}from"./index113.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./config.js?v=1763689792";const te={class:"w-[460px] px-[16px] py-[24px] input_autofill"},se="w-[320px]",le=c(x({__name:"mail",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(e,{expose:c}){const o=e,{type:u,row:d}=q(o.compData),p="https://www.bt.cn/bbs/thread-108097-1-1.html",m=k({title:"",qq_mail:"",qq_stmp_pwd:"",hosts:"",port:"465",receiveMail:""}),{BtForm:v,submit:w}=a({data:()=>m.value,options:()=>T(()=>[E("名称","title",{attrs:{placeholder:"请输入邮箱名称",class:se},rules:[{required:!0,message:"请输入名称",trigger:["blur","change"]},{max:15,message:"名称不能超过15个字符",trigger:["blur","change"]}]}),E("发送人邮箱","qq_mail",{attrs:{placeholder:"请输入发送人邮箱",class:se,autocomplete:"new-password"},rules:[{required:!0,message:"请输入发送人邮箱",trigger:["blur","change"]}]}),E("SMTP密码","qq_stmp_pwd",{attrs:{placeholder:"请输入SMTP密码",showPassword:!0,class:se},rules:[{required:!0,message:"请输入SMTP密码",trigger:["blur","change"]}]}),E("SMTP服务器","hosts",{attrs:{placeholder:"请输入SMTP服务器",class:se},rules:[{required:!0,message:"请输入SMTP服务器",trigger:["blur","change"]}]}),E("端口","port",{attrs:{placeholder:"请输入端口",class:se},rules:[{required:!0,message:"请输入端口",trigger:["blur","change"]}]}),Q("邮箱","receiveMail",{attrs:{placeholder:"接收者邮箱，每行1个",rows:6,class:se},rules:[{required:!0,message:"请输入接收者邮箱",trigger:["blur","change"]}]}),G(" ",[{content:"推荐使用465端口，协议为SSL/TLS"},{content:"25端口为SMTP协议，587端口为STARTTLS协议"},{content:S(t,{href:p,target:"_blank"},{default:()=>[U("配置教程")]})}])]),submit:async(e,a)=>(await a(),b())}),b=async e=>{try{const e=(()=>{const e={qq_mail:m.value.qq_mail,qq_stmp_pwd:m.value.qq_stmp_pwd,hosts:m.value.hosts,port:m.value.port},a=m.value.receiveMail.split("\n").filter(e=>""!==e&&" "!==e),t={sender_type:u.value,sender_data:JSON.stringify({send:e,receive:a,title:m.value.title})};return n("id",d.value)&&(t.sender_id=d.value.id),t})();return(await s({loading:"正在设置,请稍候...",request:l(e),success:e=>{e.status&&o.compData.callback(!0),r(e.data.data)&&!e.status?i().error("".concat(e.msg,"【").concat(e.data.data,"】")):i().request(e)}})).status}catch(a){}};return C(()=>{if(!d.value||!("id"in d.value))return;const{send:e,receive:a=[],title:t=""}=d.value.data||{},{hosts:s,port:l,qq_mail:r,qq_stmp_pwd:i}=e||{};m.value.hosts=s,m.value.port=l,m.value.qq_mail=r,m.value.qq_stmp_pwd=i,m.value.receiveMail=Array.isArray(a)?a.join("\n"):"",m.value.title=t}),c({onConfirm:async e=>await w()&&e()}),(e,a)=>(j(),D("div",te,[S(P(v),{size:"small"})]))}}),[["__scopeId","data-v-a5bea34c"]]),re={class:"w-[90%] px-16px py-24px"},ie=x({__name:"web-hook",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(e,{expose:n}){const c=e,{type:u,row:d}=q(c.compData),p="自定义webhook",m="https://www.bt.cn/bbs/thread-143326-1-1.html",v=k({title:"",url:"",atall:"True",method:"POST",body_type:"json",custom_parameter:"",headers:""}),w=[{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],b=[{label:"application/json",value:"json"},{label:"x-www-form-urlencoded",value:"form_data"}],h={class:"!w-[140px]"},g=e=>({placeholder:"非必填，可输入标准JSON格式的字符串，例如：{aa:bb}",autosize:{minRows:e,maxRows:e},resize:"none"}),y=T(()=>[E("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["blur","change"]}]}),Q("URL","url",{attrs:{placeholder:"请输入".concat(p,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(p,"机器人URL"),trigger:["blur","change"]}]}),K([X("请求方式","method",w,{attrs:h}),X("参数格式","body_type",b,{attrs:h,labelAttrs:{labelWidth:"w-[120px]"}})]),X("证书校验","ssl_verify",[{label:"开启",value:1},{label:"关闭",value:0}],{attrs:h,labelAttrs:{labelWidth:"w-[120px]"}}),Q("自定义参数","custom_parameter",{attrs:{...g(4),class:"w-[320px]"}}),Q("请求头","headers",{attrs:{...g(2),class:"w-[320px]"}}),G(" ",[{content:S(t,{href:m},{default:()=>["如何使配置并使用自定义消息通道"]})}])]),{BtForm:f,submit:_}=a({data:()=>v.value,options:y,submit:async(e,a)=>(await a(),x())}),x=async()=>{try{const e=(()=>{var e,a;const t=o(v.value);["custom_parameter","query","headers"].forEach(e=>{try{t[e]=""===t[e]||void 0===t[e]?{}:JSON.parse(t[e])}catch(a){t[e]={}}});const s=(null==(e=d.value)?void 0:e.data)||{},l={sender_type:u.value,sender_data:JSON.stringify({...s,...t,ssl_verify:1===t.ssl_verify})};return(null==(a=d.value)?void 0:a.id)&&(l.sender_id=d.value.id),l})();return(await s({loading:"正在设置,请稍候...",request:l(e),success:e=>{e.status&&c.compData.callback(!0),r(e.data.data)&&!e.status?i().error(e.msg+"【"+e.data.data+"】"):i().request(e)}})).status}catch(e){}};return C(()=>{if(!d.value||!("id"in d.value))return;const{title:e,url:a,method:t,body_type:s,custom_parameter:l,headers:r,ssl_verify:i}=d.value.data;v.value.title=e,v.value.url=a,v.value.method=t,v.value.body_type=s,v.value.custom_parameter=l?JSON.stringify(l):"",v.value.headers=r?JSON.stringify(r):"",v.value.atall="True",v.value.ssl_verify=!1===i?0:1}),n({onConfirm:async e=>await _()&&e()}),(e,a)=>(j(),D("div",re,[S(P(f))]))}}),ne={class:"p-[16px]"},ce={class:"flex items-center justify-around mt-[1.6rem]"},oe={class:"bind"},ue={class:"code p-[1rem]"},de=c(x({__name:"wx-account",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(e,{expose:a}){const t=e,l=k(!1),r=R({bindCode:"www.bt.cn"});return C(async()=>{try{await s({loading:l,request:u(),success:e=>{e.status?r.bindCode=e.data.res:r.bindCode="二维码失效，请重新获取"}})}catch(e){}}),a({onCancel:()=>t.compData.callback(!0)}),(e,a)=>{const t=ae,s=ee,i=z("bt-loading");return j(),D("div",ne,[S(t,{closable:!1,"show-icon":!0,type:"warning"},{title:A(()=>[...a[0]||(a[0]=[L("div",null,"没有绑定微信公众号无法接收面板告警信息",-1),L("div",null,"当前为体验版，限制每个宝塔账号发送频率100条/天",-1)])]),_:1}),L("div",ce,[a[2]||(a[2]=M('<div class="bind" data-v-0c295be0><div class="title" data-v-0c295be0><span class="steps" data-v-0c295be0>1</span>关注堡塔公众号</div><div class="code" data-v-0c295be0><img src="https://www.bt.cn/Public/img/bt_wx.jpg" alt="堡塔公众号" class="w-[160px]" data-v-0c295be0></div></div>',1)),L("div",oe,[a[1]||(a[1]=L("div",{class:"title"},[L("span",{class:"steps"},"2"),U("绑定微信账号")],-1)),O((j(),D("div",ue,[S(s,{value:P(r).bindCode,logo:"/static/images/config/wx_logo.png",level:"L",size:140},null,8,["value"])])),[[i,P(l)],[i,"正在获取二维码，请稍候...","title"]])])])])}}}),[["__scopeId","data-v-0c295be0"]]),pe={class:"w-[470px] px-16px py-24px"},me=x({__name:"common",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(e,{expose:n}){const c=e,{title:o,type:u,row:p}=q(c.compData),m=k({title:"",url:"",send_type:"markdown",remindType:"all",specifiedUser:[{id:"",name:"",key:d(10)}]}),v=T(()=>[{name:"dingding",ps:"如何创建钉钉机器人",help:"https://www.bt.cn/bbs/thread-108081-1-1.html"},{name:"feishu",ps:"如何创建飞书机器人",help:"https://www.bt.cn/bbs/thread-108274-1-1.html"},{name:"weixin",ps:"如何创建企业微信机器人",help:"https://www.bt.cn/bbs/thread-108116-1-1.html"}].find(e=>e.name===u.value)),w=["weixin","dingding","feishu"],b=T(()=>{var e;return[E("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["change","blur"]}]}),Q("URL","url",{attrs:{placeholder:"请输入".concat(o.value,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(o.value,"机器人URL"),trigger:["change","blur"]}]}),...w.includes(u.value)?[Y("提醒","remindType",[{label:"所有用户(@所有人)",value:"all"},{label:"指定用户",value:"specified"},{label:"不提醒",value:"none"}],{attrs:{size:"default"}}),..."specified"===x.value.remindType?[...h(),Z(" ",()=>S(J,{type:"default",size:"default",class:"!mt-[1rem]",onClick:g},{default:()=>[U("添加指定用户 ")]}))]:[]]:[],..."weixin"===u.value?[X("发送类型","send_type",[{label:"文本",value:"text"},{label:"markdown",value:"markdown"}],{attrs:{placeholder:"请选择发送类型",class:"!w-[320px]"},rules:[{required:!0,message:"请选择发送类型",trigger:["change","blur"]}]})]:[],G(" ",[{content:S(t,{href:null==(e=v.value)?void 0:e.help},{default:()=>{var e;return[null==(e=v.value)?void 0:e.ps]}})}])]}),h=()=>x.value.specifiedUser.map(e=>{switch(u.value){case"weixin":return K([Z(" ",()=>S(N,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"微信用户名",class:"!w-[28rem] mt-[1.6rem]"},null)),$(()=>S("span",{class:"text-[1.4rem] text-danger cursor-pointer ml-[1rem] mt-[1.6rem] flex items-center",onClick:()=>y(e)},[U("删除")]))]);case"dingding":return K([Z(" ",()=>S(N,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"钉钉手机号",class:"!w-[28rem] mt-[1.6rem]"},null)),$(()=>S("span",{class:"text-[1.4rem] text-danger cursor-pointer ml-[1rem] mt-[1.6rem] flex items-center",onClick:()=>y(e)},[U("删除")]))]);case"feishu":return K([Z(" ",()=>S(N,{modelValue:e.id,"onUpdate:modelValue":a=>e.id=a,placeholder:"用户id",class:"!w-[14rem] mt-[1.6rem]"},null)),$(()=>S(N,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"用户名",class:"!w-[14rem] ml-[1rem] mt-[1.6rem]"},null)),$(()=>S("span",{class:"text-[1.4rem] text-danger cursor-pointer ml-[1rem] mt-[1.6rem] flex items-center",onClick:()=>y(e)},[U("删除")]))])}return null}),g=()=>{if("feishu"===u.value)x.value.specifiedUser.push({id:"",name:"",key:d(10)});else x.value.specifiedUser.push({name:"",key:d(10)})},y=e=>{x.value.specifiedUser=x.value.specifiedUser.filter(a=>a.key!==e.key)},{BtForm:f,submit:_,param:x}=a({data:()=>m.value,options:b,submit:async(e,a)=>{try{return await a(),R(e)}catch(t){}}}),R=async e=>{try{"weixin"!==u.value&&delete e.value.send_type;const a=V(e.value);if(w.includes(u.value)){if(a.isAtAll="all"===a.remindType,"specified"===a.remindType)if("feishu"===u.value)a.user=a.specifiedUser.filter(e=>""!==e.id&&""!==e.name).map(e=>"".concat(e.id,"|").concat(e.name));else a.user=a.specifiedUser.filter(e=>""!==e.name).map(e=>e.name);else a.user=[];delete a.remindType,delete a.specifiedUser}const t={sender_type:u.value,sender_data:JSON.stringify({...a})};p.value&&"id"in p.value&&(t.sender_id=p.value.id);return(await s({loading:"正在设置,请稍候...",request:l(t),success:e=>{e.status&&c.compData.callback(!0),r(e.data.data)&&!e.status?i().error("".concat(e.msg,"【").concat(e.data.data,"】")):i().request(e)}})).status}catch(a){}};return C(()=>{if(!p.value||!("id"in p.value))return;const{data:{title:e,url:a,send_type:t,isAtAll:s,user:l}}=p.value;m.value.title=e,m.value.url=a,m.value.send_type=t,m.value.remindType=!1!==s?"all":l&&l.length>0?"specified":"none",m.value.specifiedUser=(null==l?void 0:l.map(e=>({name:e,key:d(10)})))||[{name:"",key:d(10)}],"feishu"===u.value&&(m.value.specifiedUser=(null==l?void 0:l.map(e=>({id:e.split("|")[0],name:e.split("|")[1],key:d(10)})))||[{id:"",name:"",key:d(10)}])}),n({onConfirm:async e=>await _()&&e()}),(e,a)=>(j(),D("div",pe,[S(P(f),{size:"small",onSubmit:a[0]||(a[0]=H(()=>{},["prevent"]))})]))}}),ve=x({__name:"index",props:{compData:{default:()=>({type:"",title:"",callback:()=>{}})}},setup(a,{expose:t}){const{refs:{isRefreshList:l}}=I(),n=a,{compData:c}=q(n),{getSenderAlarmListInfo:o,push:u}=p(),d=async e=>{const a=(e=>{switch(e){case"mail":return le;case"webhook":return ie;case"wx_account":return de;default:return me}})(c.value.type);await v({title:"".concat(n.compData.title,"配置"),area:"webhook"===n.compData.type?60:50,compData:{row:e,...c.value,callback:()=>{T(),l.value=!0}},showFooter:"wx_account"!==n.compData.type,component:a})},x=async e=>{try{await b({title:"设置默认配置",content:"设置【".concat(e.data.title,"】为默认配置后，将会覆盖原有默认配置，是否继续操作？")}),await s({loading:"正在设置，请稍后...",message:!0,request:h({sender_id:e.id,sender_type:e.sender_type}),success:e=>{e.status&&T()}})}catch(a){}},{BtTable:k,refresh:T}=m({request:async()=>{const e=await(async(e=!1)=>{try{await o(e)}catch(a){}return u.value.config})(),a=e.filter(e=>e.sender_type===c.value.type)||[];return{data:a,total:a.length,other:e}},columns:(()=>{var e;const a=(null==(e=[{label:"邮箱",name:"mail"},{label:"公众号",name:"wx_account"},{label:"钉钉机器人",name:"dingding"},{label:"飞书机器人",name:"feishu"},{label:"企业微信机器人",name:"weixin"},{label:"自定义Webhook",name:"webhook"}].find(e=>e.name===c.value.type))?void 0:e.label)||"自定义Webhook";return[{label:a,prop:"data.title",render:e=>{var a;return S("div",null,[null==(a=e.data)?void 0:a.title,e.original?"【默认配置】":""])}},{label:"状态",width:65,render:e=>S("span",{class:"".concat(e.used?"bt-link":"bt-link !text-danger"),onClick:()=>(async(e,a)=>{try{await b({title:"".concat(e.used?"禁用":"启用").concat(a,"【").concat(e.data.title,"】"),content:"您真的要".concat(e.used?"禁用":"启用").concat(a,"【").concat(e.data.title,"】吗？")}),await s({loading:"正在设置，请稍后...",message:!0,request:g({sender_id:e.id}),success:e=>{e.status&&T()}})}catch(t){}})(e,a)},[e.used?"已启用":"未启用"])},B([{onClick:x,isHide:e=>e.original,title:"设置默认",width:60},{onClick:d,isHide:e=>"wx_account"===e.sender_type,title:"编辑"},{title:"测试",render:e=>S("div",{class:"item-center inline-flex"},[S("span",{class:"bt-link",onClick:async()=>{e.load||(e.load=!0,await(async e=>{try{await s({loading:"正在测试，请稍后...",request:y({sender_id:e.id}),success:e=>{r(e.data.data)&&!e.status?i().error("".concat(e.msg,"【").concat(e.data.data,"】")):i().request(e)}})}catch(a){}})(e),e.load=!1)}},[e.load?"测试中":"测试"]),S(W,{class:"mt-[4px]"},null)])},{onClick:e=>(async(e,a)=>{try{await b({title:"解绑【".concat(e.data.title,"】").concat(a),content:"您真的要解绑".concat(a,"【").concat(e.data.title,"】吗？")});const t={sender_id:e.id},r="wx_account"===e.sender_type;await s({loading:"正在解绑，请稍后...",message:!0,request:r?f(t):_(t),success:e=>{e.status&&(T(),l.value=!0)}})}catch(t){}})(e,a),title:"解绑"}])]})()});return t({onCancel:n.compData.callback}),(a,t)=>{const s=w,l=e;return j(),F(l,{class:"p-[2rem]"},{"header-left":A(()=>[S(s,{type:"primary",onClick:t[0]||(t[0]=e=>d())},{default:A(()=>[...t[1]||(t[1]=[U("添加",-1)])]),_:1})]),content:A(()=>[S(P(k),{"max-height":350})]),_:1})}}});export{ve as default};
