import{b6 as a,M as e,aK as l,Q as t,l as s,$ as o}from"./utils-lib.js?v=1763689792";import{_ as n}from"./index109.js?v=1763689792";import{_ as m}from"./index107.js?v=1763689792";import{c as r,r as i,o as c,W as u,g as d,v as p,I as b,x as _,y as v,e as f,C as g,J as y,z as x,A as j,O as h,D as q,G as w,ak as k,aj as V}from"./base-lib.js?v=1763689792";import{g as S}from"./useStore2.js?v=1763689792";import{getTableInfo as C,getModulesTableInfo as z}from"./database.js?v=1763689792";import{y as D}from"./useMethod4.js?v=1763689792";import{a as J}from"./column.js?v=1763689792";import"./__commonjsHelpers__.js?v=1763689792";import"./validator.js?v=1763689792";import"./index110.js?v=1763689792";const O={class:"p-[20px]"},N={class:"flex items-center mt-[16px] leading-[3rem]"},Q={key:0,class:"flex items-center mt-16px"},U=r({__name:"table-back",props:{compData:{default:()=>({name:"",id:0})}},setup(r,{expose:U}){const A=r,{refs:{tabActive:I}}=S(),{name:L,id:M}=A.compData,F=i("mongodb"===I.value?"bson":"db"),G=i(!1),H=i([]),K=i([]),W=c({id:M,table_list:K.value,storage_type:F.value,file_type:F.value,password:""}),$=u([J({key:"mongodb"==I.value?"collection_name":"table_name"}),{prop:"mongodb"==I.value?"collection_name":"table_name",label:"表名"},{prop:"mongodb"==I.value?"count":"rows_count",label:"行数"},{prop:"mongodb"===I.value?"size":"pgsql"===I.value?"table_size":"data_size",label:"大小"}]),B=d(()=>{let a=[{content:"分表导出：一张表存储为一个SQL文件。"},{content:"合并导出：将选中的表导出到一个SQL文件内"},{content:"备份格式：打包后压缩包内的文件格式"}];return"mysql"==I.value&&a.push({content:"压缩密码：设置备份压缩密码后请注意保存好密码！",class:"text-warning"}),a}),E=a=>{K.value=a};return p(()=>{(async()=>{const{data:a}=await t({loading:G,request:"mysql"===I.value?C({db_name:L}):z({data:JSON.stringify({db_name:L})},I.value)});"mysql"===I.value&&(H.value=a.tables),"mongodb"===I.value&&(H.value=a.data.collection_list),"pgsql"===I.value&&(H.value=a.data.table_list)})()}),U({onConfirm:async a=>{var t,s;try{if(0===K.value.length)return void e.error("请至少选择一项要备份的表");let l={...W,collection_list:K.value.map(a=>a.collection_name),table_list:JSON.stringify(K.value.map(a=>"".concat(a.schema,".").concat(a.table_name)))};switch(I.value){case"mongodb":l.file_type=W.storage_type,l.storage_type="table";break;case"pgsql":l.table_list=K.value.map(a=>"".concat(a.schema,".").concat(a.table_name));break;case"mysql":l.table_list=JSON.stringify(K.value.map(a=>"".concat(a.table_name)))}const o=await D(l);e.request(o),null==(s=(t=A.compData).refreshFn)||s.call(t),a()}catch(o){l(o,"数据库-表备份-onConfirm")}}}),(e,l)=>{const t=s,r=k,i=V,c=m,u=n,d=o,p=b("bt-loading"),S=b("focus");return _(),v("div",O,[f(u,null,{content:g(()=>[y(f(t,{onSelectionChange:E,"max-height":"260",column:x($),data:x(H)},null,8,["column","data"]),[[p,x(G)],[p,"正在加载列表，请稍后...","title"]])]),"footer-left":g(()=>[j("div",null,[j("div",N,[l[8]||(l[8]=j("span",{class:"mr-[16px]"},"备份方式",-1)),"mongodb"!==x(I)?(_(),h(i,{key:0,modelValue:x(W).storage_type,"onUpdate:modelValue":l[0]||(l[0]=a=>x(W).storage_type=a)},{default:g(()=>[f(r,{value:"db"},{default:g(()=>[...l[4]||(l[4]=[q("合并导出",-1)])]),_:1}),f(r,{value:"table"},{default:g(()=>[...l[5]||(l[5]=[q("分表导出",-1)])]),_:1})]),_:1},8,["modelValue"])):w("",!0),"mongodb"==x(I)?(_(),h(i,{key:1,modelValue:x(W).storage_type,"onUpdate:modelValue":l[1]||(l[1]=a=>x(W).storage_type=a)},{default:g(()=>[f(r,{value:"bson"},{default:g(()=>[...l[6]||(l[6]=[q("bson",-1)])]),_:1}),f(r,{value:"json"},{default:g(()=>[...l[7]||(l[7]=[q("json",-1)])]),_:1})]),_:1},8,["modelValue"])):w("",!0)]),"mysql"==x(I)?(_(),v("div",Q,[l[9]||(l[9]=j("span",{class:"mr-16px !w-[6.4rem]"},"压缩密码",-1)),y(f(c,{placeholder:"请输入压缩密码，可为空",modelValue:x(W).password,"onUpdate:modelValue":l[2]||(l[2]=a=>x(W).password=a),icon:"el-refresh",onIconClick:l[3]||(l[3]=()=>x(W).password=x(a)(16))},null,8,["modelValue"]),[[S]])])):w("",!0)])]),_:1}),f(d,{options:x(B),"list-style":"disc",class:"ml-[20px] mt-[36px]"},null,8,["options"])])}}});export{U as default};
